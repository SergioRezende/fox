*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*
*------------------------------------------------------------
SET TALK ON
SET ESCAPE ON
SET STEP ON
CLOSE ALL
SET DELE ON
SET TALK ON

USE Q:\SCGC\CENTRAL\NOTAENT
SET ORDER TO TAG NOTA
GO TOP

SELE 0

USE Q:\SCGC\CENTRAL\NOTAITE
SET ORDER TO TAG CHV_BKP
GO TOP

SELE 0

USE Q:\SCGC\CENTRAL\ITEMMOV
SET ORDER TO 
GO 118437

DO WHILE !EOF()
	SCATTER MEMVAR

	IF LEFT(M.operacao,1) = "E"
	   SELE NOTAENT
	   SEEK STR(M.EMPRESA,3)+STR(M.CODFORN,5)+STR(M.NOTA,6)+M.SERIE+LEFT(M.TIPO,1)
       IF FOUND()	
			SELE NOTAITE
			SEEK STR(M.EMPRESA,3)+STR(M.FAVORECIDO,14)+STR(M.ORCAMENTO,6)+STR(M.ORDEM,3)
			IF FOUND()
			   IF ITEMMOV.TIPO <> NOTAENT.TIPO

				  SELE NOTAENT
				  SCATTER MEMVAR
				  SELE NOTAITE
				   =RLOCK()
			      REPLACE TIPO WITH M.TIPO
			      REPLACE CH_OPERA WITH CH_OPERA
			      REPLACE CH_PRODU WITH CH_PRODU
			      REPLACE CH_MOTIV WITH CH_MOTIV
   			      REPLACE CH_DESTI WITH CH_DESTI
			      REPLACE CH_CONTR WITH CH_CONTR
			      REPLACE CH_CONDI WITH CH_CONDI
			      


				  SELE ITEMMOV
				   =RLOCK()
			      REPLACE TIPO WITH M.TIPO
			      REPLACE CH_OPERA WITH CH_OPERA
			      REPLACE CH_PRODU WITH CH_PRODU
			      REPLACE CH_MOTIV WITH CH_MOTIV
   			      REPLACE CH_DESTI WITH CH_DESTI
			      REPLACE CH_CONTR WITH CH_CONTR
			      REPLACE CH_CONDI WITH CH_CONDI
			   ENDIF
			ENDIF
		ENDIF
	ENDIF
	SELE ITEMMOV
	SKIP
ENDDO

