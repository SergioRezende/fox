*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º 13/11/2000            SCGC234.SPR              17:01:44 º
*       º                                                         º
*       ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
*       º                                                         º
*       º Author's Name                                           º
*       º                                                         º
*       º Copyright (c) 2000 Company Name                         º
*       º Address                                                 º
*       º City,     Zip                                           º
*       º                                                         º
*       º Description:                                            º
*       º This program was automatically generated by GENSCRN.    º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º          SCGC234/MS-DOS Setup Code - SECTION 1          º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 1
*~ WIZARDSCREEN
*---------------------------------------------------------------------*
* ARQUIVOS UTILIZADOS :                                               *
*              - orcament,TAB001,usuario,empresa
* OBJETIVOS : listagem de osi no periodo
*	
*---------------------------------------------------------------------*
******>>>> INICIO CONTROLE AMBIENTAL
CLEAR TYPEAHEAD
PUSH KEY CLEAR		&& desabilita teclas de atalho def. anteriormente
ON KEY LABEL F1		DO HLP2000.SPR WITH  POPUP(),PROMPT(),PROGRAM(),;
							WONTOP(),VARREAD()
******************************************************************
PRIVATE wl_areant, isediting,isadding,isreading,wp_record,wp_flgfecha
PRIVATE LFjanela, wp_ref_local
PRIVATE VLleitura, VLlerfim, VLcompara, VLchvlimi
PRIVATE LFosi,LFtmp,LF001,LFusr,LFemp
*****************************************************************
ON KEY LABEL ESCAPE
wl_areant = ALLTRIM(ALIAS()) && PERMITE RETORNAR A AREA ANTER. A CHAMADA

m.isediting	=	.F.
m.isadding	=	.F.
m.isreading =   .F.
wp_flgfecha = 	.F. 		&& defaut nao fechamento da secao
WP_RECORD 	= 	0

LFnfs 	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFosi 	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFtmp 	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LF001 	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFusr 	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFemp 	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
wp_ref_local =  .f.     && NAO POSSUI CONTROLE DE REFRESH LOCAL
m.tp_rel = 1

******>>>> INICIO CONTROLE ARQUIVOS
IF !USED("nota")
	LFnfs	= .T.
	IF ! NetUse("nota")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("tab001")
	LF001	= .T.
	IF ! NetUse("tab001")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("usuario")
	LFusr 	= .T.
	IF ! NetUse("usuario")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("empresa")
	LFemp 	= .T.
	IF ! NetUse("empresa")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("orcatmp")
	LFtmp 	= .T.
	IF ! NetUse("orcatmp")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("clienc")
	LFosi 	= .T.
	IF ! NetUse("clienc")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("orcament")
	LFosi 	= .T.
	IF ! NetUse("orcament")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF

IF wp_flgfecha
	do ULfecha
	RETURN
ENDIF

#REGION 0
REGIONAL m.currarea, m.talkstat, m.compstat

IF SET("TALK") = "ON"
	SET TALK OFF
	m.talkstat = "ON"
ELSE
	m.talkstat = "OFF"
ENDIF
m.compstat = SET("COMPATIBLE")
SET COMPATIBLE FOXPLUS

*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º                MS-DOS Window definitions                º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

IF NOT WEXIST("scgc234") ;
	OR UPPER(WTITLE("SCGC234")) == "SCGC234.PJX" ;
	OR UPPER(WTITLE("SCGC234")) == "SCGC234.SCX" ;
	OR UPPER(WTITLE("SCGC234")) == "SCGC234.MNX" ;
	OR UPPER(WTITLE("SCGC234")) == "SCGC234.PRG" ;
	OR UPPER(WTITLE("SCGC234")) == "SCGC234.FRX" ;
	OR UPPER(WTITLE("SCGC234")) == "SCGC234.QPR"
	DEFINE WINDOW scgc234 ;
		FROM INT((SROW()-16)/2),INT((SCOL()-70)/2) ;
		TO INT((SROW()-16)/2)+15,INT((SCOL()-70)/2)+69 ;
		TITLE "[ Relatorio de OSI ]" ;
		FOOTER "[ 234 ]" ;
		FLOAT ;
		NOCLOSE ;
		SHADOW ;
		NOMINIMIZE ;
		NONE ;
		COLOR SCHEME 1
ENDIF


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º          SCGC234/MS-DOS Setup Code - SECTION 2          º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 1
******>>>> INICIO CONTROLE LOCAL


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º              SCGC234/MS-DOS Screen Layout               º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 1
IF WVISIBLE("scgc234")
	ACTIVATE WINDOW scgc234 SAME
ELSE
	ACTIVATE WINDOW scgc234 NOSHOW
ENDIF
@ 0,0 TO 15,69 ;
	COLOR SCHEME 23
@ 1,2 TO 3,30 ;
	COLOR SCHEME 23
@ 3,3 TO 3,29 ;
	COLOR SCHEME 24
@ 3,30 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 2,30 SAY "³" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,30 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,4 SAY "[Filial]" ;
	SIZE 1,8, 0
@ 4,2 TO 6,33 ;
	COLOR SCHEME 23
@ 6,3 TO 6,32 ;
	COLOR SCHEME 24
@ 6,33 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 5,33 SAY "³" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 4,33 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 12,2 TO 14,18 ;
	COLOR SCHEME 24
@ 14,3 TO 14,17 ;
	COLOR SCHEME 23
@ 13,18 SAY "³" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 14,18 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 12,18 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 12,27 TO 14,43 ;
	COLOR SCHEME 24
@ 14,28 TO 14,42 ;
	COLOR SCHEME 23
@ 13,43 SAY "³" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 14,43 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 12,43 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 12,50 TO 14,66 ;
	COLOR SCHEME 24
@ 14,51 TO 14,65 ;
	COLOR SCHEME 23
@ 13,66 SAY "³" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 14,66 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 12,66 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 15,1 TO 15,68 ;
	COLOR SCHEME 24
@ 15,69 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 0,69 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,69 TO 14,69 ;
	COLOR SCHEME 24
@ 0,62 SAY "[234]" ;
	SIZE 1,5, 0
@ 2,7 SAY "-" ;
	SIZE 1,1, 0
@ 0,11 SAY "[ Relatorios Para Acompahamento de Notas e OSI ]" ;
	SIZE 1,48, 0
@ 4,36 TO 11,67 ;
	COLOR SCHEME 23
@ 11,37 TO 11,66 ;
	COLOR SCHEME 24
@ 11,67 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 4,67 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 5,67 TO 10,67 ;
	COLOR SCHEME 24
@ 5,17 SAY "a" ;
	SIZE 1,1, 0
@ 4,3 SAY "[Avaliar Registro OSIs de : ]" ;
	SIZE 1,29, 0
@ 2,4 GET m.empresa ;
	SIZE 1,3 ;
	DEFAULT " " ;
	PICTURE "999" ;
	WHEN _08u10hzbc() ;
	VALID _08u10hzcg()
@ 2,8 GET m.nome_emp ;
	SIZE 1,20 ;
	DEFAULT " " ;
	PICTURE "@!K" ;
	WHEN _08u10hzdy()
@ 5,7 GET m.dt_inicio ;
	SIZE 1,8 ;
	DEFAULT {  /  /  } ;
	WHEN _08u10hzeo() ;
	VALID _08u10hzfi()
@ 5,20 GET m.dt_fim ;
	SIZE 1,8 ;
	DEFAULT {  /  /  } ;
	WHEN _08u10hzg9() ;
	VALID m.dt_fim >= m.dt_inicio ;
	MESSAGE "Data Final deve ser maior ou igual a Inicial"
@ 5,38 GET M.TPrel ;
	PICTURE "@*RVN OSIs Pendentes;OSIs Canceladas;OSIs Abertas;OSIs Faturadas;Notas Canceladas;Itens Cancelados em OSIs" ;
	SIZE 1,28,0 ;
	DEFAULT 1 ;
	WHEN _08u10hzh1() ;
	VALID _08u10hzhn()
@ 13,6 GET m.edit_btn ;
	PICTURE "@*HN \<Edita" ;
	SIZE 1,9,1 ;
	DEFAULT 1 ;
	WHEN _08u10hzie() ;
	VALID btn_val1('EDIT') ;
	MESSAGE 'Permite a alteracao de dados do registro corrente'
@ 13,31 GET m.imp_btn ;
	PICTURE "@*HN \<Imprime" ;
	SIZE 1,9,1 ;
	DEFAULT 1 ;
	VALID _08u10hzj7() ;
	DISABLE
@ 13,54 GET m.canc_btn ;
	PICTURE "@*HN \<Saida" ;
	SIZE 1,9,1 ;
	DEFAULT 1 ;
	VALID _08u10hzle()

IF NOT WVISIBLE("scgc234")
	ACTIVATE WINDOW scgc234
ENDIF


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º     MS-DOSREAD contains clauses from SCREEN scgc234     º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

READ CYCLE MODAL ;
	ACTIVATE READACT() ;
	DEACTIVATE READDEAC() ;
	NOLOCK

RELEASE WINDOW scgc234

#REGION 0
IF m.talkstat = "ON"
	SET TALK ON
ENDIF
IF m.compstat = "ON"
	SET COMPATIBLE ON
ENDIF


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º               SCGC234/MS-DOS Cleanup Code               º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 1
DO ULfecha
************************************
POP KEY 			&& reabilita teclas de atalho def. anteriormente

RETURN



*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º   SCGC234/MS-DOS Supporting Procedures and Functions    º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 1
PROCEDURE ULfecha
	IF LFnfs   		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("nota")
	ENDIF
	IF LFosi   		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("orcament")
	ENDIF
	IF LFtmp   		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("orcatmp")
	ENDIF
	IF LF001   		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("tab001")
	ENDIF
	IF LFusr   		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("usuario")
	ENDIF
	IF LFemp   		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("empresa")
	ENDIF
	wp_flgfecha = .F. 		&& defaut nao fechamento da secao
	IF !EMPTY(wl_areant)
		SELECT &wl_areant
	ENDIF
	ON KEY LABEL ESCAPE
	SET FORMAT TO
RETURN

*************
PROCEDURE BTN_VAL1
	PARAMETER tecla, m.chv_ler, m.chv_compara, m.chv_brow
	LN_prxobj = _CUROBJ
	SHOW GET wp_empresa
	SHOW GET wp_nome_emp
    DO CASE
		CASE tecla = "EDIT" AND !isediting   && INICIA EDICAO
			SHOW GET edit_btn,1 PROMPT "\<Ok"
			SHOW GET m.imp_btn DISABLE
			isediting = .t.
			_CUROBJ = 1	
		    ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
			ON KEY LABEL END DO BTN_VAL1 WITH 'DELETE'
		CASE tecla = "EDIT" AND isediting     && CONFIRMA EDICAO
			SHOW GET edit_btn,1 PROMPT "\<Edita"
			isediting = .f.
			_CUROBJ = 1	
			SHOW GET m.imp_btn ENABLE
		    ON KEY LABEL ESCAPE
			ON KEY LABEL END
		CASE tecla = "DELETE" AND isediting     && CANCELA EDICAO
			SHOW GET edit_btn,1 PROMPT "\<Edita"
			isediting = .f.
			_CUROBJ = 1	
			SHOW GET m.imp_btn DISABLE
		    ON KEY LABEL ESCAPE
			ON KEY LABEL END
	ENDCASE
RETURN


FUNCTION ULsituacao
	PARAMETER LSsit,Lvias

	Lvias = Lvias -1
	SELE TAB001
	SEEK "ST1"+LEFT(LSsit,1)
	m.nome_sit = RTRIM(tab001.descricao)
	SEEK "ST2"+RIGHT(LSsit,1)
	m.nome_sit = m.nome_sit+" "+RTRIM(tab001.descricao)
	IF Lvias > 1
		m.nome_sit = RTRIM(m.nome_sit) + ;
					 "/"+"OSI.Impresa "+str(Lvias,2)+" Vias"
	ENDIF	
	SELE orcament
RETURN(m.nome_sit)

FUNCTION ULfim
	LF_imp  = .f.
RETURN(" ")

*******************************************************************
PROCEDURE  ULrelorcamento		&& Relatorios Relacionados a Orcamentos

	DO RELINIC.PRG          && INICIA VAR P/ TERMOMETRO
 	***************
	wl_arqtmp = ""
	LNtmp     = 65		&& TABELA ASCII A = 65
	IF !UPabretmp("tmp")
		UNLOCK
		SELE orcament
 		RETURN
	ENDIF
	**************
	LStmp = "&wp_dirtmp"+"&wl_arqtmp"
	**************
	WAIT WINDOW "AGUARDE. Gerando Arq. Temporario....." NOWAIT
	DO CASE
		CASE  m.TPrel = 1		&& OSIs PENDENTES	
				SELECT orcament
				SET ORDER TO TAG situacao
				SET NEAR ON
				SEEK STR(m.empresa,3)+"A"
				SET NEAR OFF
				IF EOF()
			 		WAIT WINDOW "Nao Foram encotrados dados para impessao."
			 		SELE orcament
					UNLOCK
			 		RETURN
			 	ENDIF		
				COPY TO &LStmp 	FOR !(LEFT(orcament.situacao,1) $ "AI") ;
			    				AND orcament.data >= m.dt_inicio ;
			    				AND orcament.data <= m.dt_fim ;
			    				WHILE orcament.empresa = m.empresa WITH CDX
				m.titulo   = " OSIs  P E N D E N T E S"
		CASE  m.TPrel = 2	&& OSIs CANCELADAS
							&& USANDO A DT_FAT COMO DATA DE CANCELAMENTO
							&& E DTREGIS P/ORIENTAR A LITURA TRATARA
							&& APENAS OSIs CANCELADOS NO PERIODO
				SELECT orcament
				SET ORDER TO TAG data_fat
				SET NEAR ON
				SEEK STR(m.empresa,3)+DTOS(m.dt_inicio)
				SET NEAR OFF
				IF EOF() OR	orcament.dt_fat > m.dt_fim
			 		WAIT WINDOW "Nao Foram encotrados dados para impessao."
			 		SELE orcament
					UNLOCK
			 		RETURN
			 	ENDIF		
				COPY TO &LStmp 	FOR (LEFT(orcament.situacao,1) $ "Y") ;
				    	WHILE orcament.empresa = m.empresa and ;
	    					orcament.dt_fat <= m.dt_fim WITH CDX
				m.titulo   = " OSIs  C A N C E L A D A S"
		CASE  m.TPrel = 3
				SELECT orcament
				SET ORDER TO TAG situacao
				SET NEAR ON
				SEEK STR(m.empresa,3)+"A"
				SET NEAR OFF
				IF EOF()
			 		WAIT WINDOW "Nao Foram encotrados dados para impessao."
			 		SELE orcament
					UNLOCK
			 		RETURN
			 	ENDIF		
				COPY TO &LStmp 	FOR (LEFT(orcament.situacao,1) $ "AI") ;
			    		WHILE orcament.empresa = m.empresa WITH CDX

				m.titulo   = " OSIs  A B E R T A S"
		CASE  m.TPrel = 4
				SELECT orcament
				SET ORDER TO TAG data_fat
				SET NEAR ON
				SEEK STR(m.empresa,3)+DTOS(m.dt_inicio)
				SET NEAR OFF
				IF EOF() OR	orcament.dt_fat > m.dt_fim
			 		WAIT WINDOW "Nao Foram encotrados dados para impessao."
			 		SELE orcament
					UNLOCK
			 		RETURN
			 	ENDIF		
				COPY TO &LStmp 	FOR !(LEFT(orcament.situacao,1) $ "YZ") ;
						    	WHILE orcament.empresa = m.empresa and ;
		    					orcament.dt_fat <= m.dt_fim WITH CDX
				m.titulo   = " OSIs  F A T U R A D A S"
	ENDCASE

	LSorienta  =  " WHILE LFsegue  "

	SELE 0
	USE &LStmp
	SET ORDER TO TAG geral
	SELE  &wl_arqtmp
	SET ORDER TO TAG GERAL
	GO TOP
	IF  EOF()
		USE
		WAIT WINDOW "Nao Foram Encontrados Dados Solicitados. <ENTER>"
		SELE orcament
		RETURN
	ENDIF	
    LNimpressao = RECCOUNT()
	LNimpressos = 0
	GO TOP
*******************
*---->   (INICIALIZACAO DO CONTROLE DE STATUS IMPRESSAO)
*******************	
	LFsegue = .t.
*******************
*---->   (COMPLETADO PREPARACAO DO CONTROLE DE STATUS IMPRESSAO)
*******************	
	LF_imp  = .t.   && controla a impressao de transportar
*******************
	SELE usuario
	SET ORDER TO TAG usuario
	SELE  &wl_arqtmp
	SET RELATION TO operador INTO usuario	
	SET RELATION TO STR(EMPRESA,3)+STR(ORCAMENTO,6) INTO CLIENC ADDIT
**************************>>> REGISTRO DE SAIDAS
	wp_arqname = ""
    LSrel = "REL234"      && relatorio padrao p/ impressoras ex: epson
	DO UPimpressao    && COORDENA TRABALHO DE IMPRESSAO
	SELE  &wl_arqtmp
	USE
	SELE orcament
	
RETURN

*********************************************************************

PROCEDURE ULrelnotas			&& Relatorios Relacionados a NFS

	SELECT nota
	SET ORDER TO TAG data
	SET NEAR ON
	SEEK STR(m.empresa,3)+DTOS(m.dt_inicio)
	SET NEAR OFF
	IF EOF() OR	nota.data > m.dt_fim
 		WAIT WINDOW "Nao Foram encotrados dados para impessao."
 		SELE orcament
		UNLOCK
 		RETURN
 	ENDIF		
*******************
*---->   (INICIALIZACAO DO CONTROLE DE STATUS IMPRESSAO)
*******************	

SET STEP ON

	RELE LNregistro
	DO RELINIC.PRG
	
	LFsegue = .t.
	LNregistro = RECNO()
	
	
    COUNT 		FOR nota.status = 2 ;
				    	WHILE nota.empresa = m.empresa and ;
	    				nota.data <= m.dt_fim;
    				 	TO   LNimpressao
	LNimpressos = 0
	GO LNregistro
*******************
*---->   (COMPLETADO PREPARACAO DO CONTROLE DE STATUS IMPRESSAO)
*******************	
	LF_imp  = .t.   && controla a impressao de transportar
*******************
	SELE usuario
	SET ORDER TO TAG usuario

	SELE orcament
	SET ORDER TO TAG geral

	SELE nota
	SET RELATION TO operador INTO usuario	
	SET RELATION TO STR(empresa,3)+STR(referencia,6) INTO orcament ADDITIVE

**************************>>> REGISTRO DE SAIDAS
	wp_arqname = ""
    LSrel = "REL234A"      && relatorio padrao p/ impressoras ex: epson

	LSorienta  = ;
			   " FOR nota.status = 2 " + ;
	   			   " WHILE empresa = m.empresa and data <= m.dt_fim "+ ;
	    			" AND LFsegue  "

	DO UPimpressao    && COORDENA TRABALHO DE IMPRESSAO
	SET RELATION TO

RETURN


*********************************************************************

PROCEDURE ULrelitens			&& Relatorios Itens Cancelados
	
SET STEP ON
	
	*------------------------------------------------------------*
	*  INICIA GERACAO DE ARQUIVO TEMPORARIO
	*------------------------------------------------------------*
	wl_arqtmp = ""
	LNtmp     = 65		&& TABELA ASCII A = 65
	IF !UPabretmp("tmp")
		UNLOCK
		SELE orcament
 		RETURN
	ENDIF
	**************
	LStmp = "&wp_dirtmp"+"&wl_arqtmp"
	**************
	WAIT WINDOW "AGUARDE. Gerando Arq. Temporario....." NOWAIT
	
	SELE orcament
	SET ORDER TO TAG dtregis
	SET NEAR ON
	SEEK m.dt_inicio
	SET NEAR OFF
	IF EOF() OR	orcament.dtregis > m.dt_fim && CANCELADA
 		WAIT WINDOW "Nao Foram OSIs Canceladas. "
 		SELE orcament
		UNLOCK
 		RETURN
 	ENDIF		
	LNregistro1 = RECNO()

	COPY TO &LStmp FOR !(LEFT(orcament.situacao,1) $ "YA") ;
	 			   WHILE orcament.empresa = m.empresa and ;
	    		   orcament.dtregis <= m.dt_fim
    GO LNregistro1
	
	SELE 0
	USE &LStmp
	INDEX ON STR(EMPRESA,3)+LEFT(TIPO,1)+STR(ORCAMENTO,6) TAG CHAV OF &LStmp

*	INICIA VAR P/ TERMOMETRO

*	LNregistro = 0
*	DO RELINIC.PRG
	
	SELE orcament
	
	LFsegue = .t.
	LNregistro = RECNO()
	
    COUNT FOR !(LEFT(orcament.situacao,1) $ "YA")  ;
				WHILE orcament.empresa = m.empresa and ;
	    		orcament.dtregis <= m.dt_fim;
    			TO   LNimpressao

	LNimpressos = 0
	GO LNregistro

*******************
*---->   (COMPLETADO PREPARACAO DO CONTROLE DE STATUS IMPRESSAO)
*******************	
	LF_imp  = .t.   && controla a impressao de transportar
*******************
	SELE usuario
	SET ORDER TO TAG usuario
	
	SELE &wl_arqtmp
	SET ORDER TO TAG CHAV

	SELE orcament
	SET RELATION TO operador INTO usuario	
	SET RELATION TO STR(EMPRESA,3)+LEFT(TIPO,1)+STR(ORCAMENTO,6) ;
							 INTO &wl_arqtmp ADDITIVE
	SET SKIP TO &wl_arqtmp

*   AKI
**************************>>> REGISTRO DE SAIDAS
	
	wp_arqname = ""
    LSrel = "REL234B"      && relatorio padrao p/ impressoras ex: epson

	m.titulo   = " I T E N S   C A N C E L A D A S "
*	LSorienta  = ;
       " FOR !(LEFT(orcament.situacao,1) $ 'YA') " + ;
       "  AND (LEFT(&wl_arqtmp .situacao,1) $ 'Y')   " + ;
	   " WHILE orcament.empresa = m.empresa AND  " + ;
	   "       orcament.dtregis <= m.dt_fim AND LFsegue  "

	LSorienta  = ;
	       " FOR LFsegue  "
	
	DO UPimpressao    && COORDENA TRABALHO DE IMPRESSAO
	SET SKIP TO
	SET RELATION TO

RETURN


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _08U10HZBC           m.empresa WHEN                     º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC234,     Record Number:   43   º
*       º Variable:            m.empresa                          º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Field                              º
*       º Snippet Number:      1                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _08u10hzbc     &&  m.empresa WHEN
#REGION 1
ON KEY LABEL ESCAPE	KEYBOARD "{END}"
IF LASTKEY() = 15 AND !(isediting)
	KEYBOARD "{ESCAPE}"
ENDIF
RETURN(isediting)

*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _08U10HZCG           m.empresa VALID                    º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC234,     Record Number:   43   º
*       º Variable:            m.empresa                          º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Field                              º
*       º Snippet Number:      2                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _08u10hzcg     &&  m.empresa VALID
#REGION 1
SELECT empresa
SET ORDER TO TAG empresa
IF LASTKEY() = 9
   ON KEY LABEL ESCAPE
   DO loc_dlog WITH .F.
   ON KEY LABEL ESCAPE DO BTN_VAL WITH 'DELETE'
   IF LASTKEY() = 27
		SELECT empresa
		RETURN .F.
	ENDIF
ELSE
	IF !SEEK(m.empresa)
		SELECT empresa
		RETURN .F.
	ENDIF
ENDIF
m.empresa   = empresa
m.nome_emp  = empresa.nome
SHOW GET m.empresa
SHOW GET m.nome_emp
SELECT empresa
RETURN .T.


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _08U10HZDY           m.nome_emp WHEN                    º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC234,     Record Number:   44   º
*       º Variable:            m.nome_emp                         º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Field                              º
*       º Snippet Number:      3                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _08u10hzdy     &&  m.nome_emp WHEN
#REGION 1
ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
RETURN(.f.)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _08U10HZEO           m.dt_inicio WHEN                   º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC234,     Record Number:   45   º
*       º Variable:            m.dt_inicio                        º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Field                              º
*       º Snippet Number:      4                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _08u10hzeo     &&  m.dt_inicio WHEN
#REGION 1
IF isediting
	ON KEY LABEL ESCAPE	KEYBOARD "{END}"
ENDIF
RETURN(isediting)

*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _08U10HZFI           m.dt_inicio VALID                  º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC234,     Record Number:   45   º
*       º Variable:            m.dt_inicio                        º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Field                              º
*       º Snippet Number:      5                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _08u10hzfi     &&  m.dt_inicio VALID
#REGION 1
m.dt_fim = m.dt_inicio
SHOW GET m.dt_fim
ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
RETURN (.T.)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _08U10HZG9           m.dt_fim WHEN                      º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC234,     Record Number:   46   º
*       º Variable:            m.dt_fim                           º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Field                              º
*       º Snippet Number:      6                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _08u10hzg9     &&  m.dt_fim WHEN
#REGION 1
ON KEY LABEL ENTER
ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
RETURN(isediting)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _08U10HZH1           M.TPrel WHEN                       º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC234,     Record Number:   47   º
*       º Variable:            M.TPrel                            º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Radio Button                       º
*       º Snippet Number:      7                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _08u10hzh1     &&  M.TPrel WHEN
#REGION 1
ON KEY LABEL ENTER  KEYBOARD "{RIGHTARROW}"
RETURN(isediting)

*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _08U10HZHN           M.TPrel VALID                      º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC234,     Record Number:   47   º
*       º Variable:            M.TPrel                            º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Radio Button                       º
*       º Snippet Number:      8                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _08u10hzhn     &&  M.TPrel VALID
#REGION 1
ON KEY LABEL ENTER
ON KEY LABEL ESCAPE
RETURN(.T.)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _08U10HZIE           m.edit_btn WHEN                    º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC234,     Record Number:   48   º
*       º Variable:            m.edit_btn                         º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      9                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _08u10hzie     &&  m.edit_btn WHEN
#REGION 1
ON KEY LABEL ENTER
ON KEY LABEL ESCAPE
RETURN(.T.)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _08U10HZJ7           m.imp_btn VALID                    º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC234,     Record Number:   49   º
*       º Variable:            m.imp_btn                          º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      10                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*


FUNCTION _08u10hzj7     &&  m.imp_btn VALID
#REGION 1
	DO CASE
		CASE  m.TPrel <= 4
			DO ULrelorcamento		&& Relatorios Relacionados a Orcamentos
		CASE  m.TPrel = 5
			DO ULrelnotas			&& Relatorios Relacionados a NFS
		CASE  m.TPrel = 6
			DO ULrelitens			&& Relatorios Itens Cancelados
	ENDCASE
	SET RELATION TO
	DO RELFIM.PRG          && FIM VAR P/ TERMOMETRO

	SHOW GET m.imp_btn DISABLE
	SHOW WINDOW SCGC234 TOP
RETURN

*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _08U10HZLE           m.canc_btn VALID                   º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC234,     Record Number:   50   º
*       º Variable:            m.canc_btn                         º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      11                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _08u10hzle     &&  m.canc_btn VALID
#REGION 1
CLEAR GETS
CLEAR READ
isediting = .f.
RETURN .T.