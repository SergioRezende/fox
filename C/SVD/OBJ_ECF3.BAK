*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨ 05/31/13            OBJ_ECF3.SPR               14:50:22 ╨
*       ╨                                                         ╨
*       гддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╤
*       ╨                                                         ╨
*       ╨ Author's Name                                           ╨
*       ╨                                                         ╨
*       ╨ Copyright (c) 2013 Company Name                         ╨
*       ╨ Address                                                 ╨
*       ╨ City,     Zip                                           ╨
*       ╨                                                         ╨
*       ╨ Description:                                            ╨
*       ╨ This program was automatically generated by GENSCRN.    ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫

PARAMETERS lschamada

*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨         OBJ_ECF3/MS-DOS Setup Code - SECTION 1          ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*

#REGION 1

	PRIVATE LNecf
	PRIVATE LSstatus
	LSstatus = ""



	LNecf = 0	&& CONTROLADOR REFERENTE A ECF
	=W_DEFPROC("ECF.SPR")
	LSstatus = ECFconecta(wp_TIPOECF)
	IF SUBS(LSstatus,7,1) = "E"    && HOUVE ERRO
		return
	ENDIF

	=W_DEFPROC("ECF.SPR")
	=ECFprgpgt()


#REGION 0
REGIONAL m.currarea, m.talkstat, m.compstat

IF SET("TALK") = "ON"
	SET TALK OFF
	m.talkstat = "ON"
ELSE
	m.talkstat = "OFF"
ENDIF
m.compstat = SET("COMPATIBLE")
SET COMPATIBLE FOXPLUS

*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨                MS-DOS Window definitions                ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*

IF NOT WEXIST("obj_ecf") ;
	OR UPPER(WTITLE("OBJ_ECF")) == "OBJ_ECF.PJX" ;
	OR UPPER(WTITLE("OBJ_ECF")) == "OBJ_ECF.SCX" ;
	OR UPPER(WTITLE("OBJ_ECF")) == "OBJ_ECF.MNX" ;
	OR UPPER(WTITLE("OBJ_ECF")) == "OBJ_ECF.PRG" ;
	OR UPPER(WTITLE("OBJ_ECF")) == "OBJ_ECF.FRX" ;
	OR UPPER(WTITLE("OBJ_ECF")) == "OBJ_ECF.QPR"
	DEFINE WINDOW obj_ecf ;
		FROM 1, 2 ;
		TO 23,77 ;
		TITLE "[ Informacoes Finais Para Faturamento ]" ;
		FOOTER "[OBJ_FATU]" ;
		NOFLOAT ;
		NOCLOSE ;
		NOMINIMIZE ;
		NONE ;
		COLOR SCHEME 1
ENDIF


*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨         OBJ_ECF3/MS-DOS Setup Code - SECTION 2          ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*

#REGION 1
	*---------------------------------------------------------------------*
	* ARQUIVOS UTILIZADOS :                                               *
	* OBJETIVO : GERENCIAR CUPOM FISCAL - ECF
	*---------------------------------------------------------------------*

	PUSH KEY CLEAR		&& desabilita teclas de atalho def. anteriormente
	ON KEY LABEL F1		DO HLP2000.SPR WITH  POPUP(),PROMPT(),PROGRAM(),;
							WONTOP(),VARREAD()
	
	******>>>> INICIO CONTROLE AMBIENTAL

	ON KEY LABEL ESCAPE  WAIT WINDOW "Para sair selecione <Ok>."

	wl_areant = ALLTRIM(ALIAS()) && PERMITE RETORNAR A AREA ANTER. A CHAMADA

	isediting	= .t.

	
	SELE ORCAMENT	
	
	SCATTER MEMVAR MEMO BLANK


*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨              OBJ_ECF3/MS-DOS Screen Layout              ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*

#REGION 1
IF WVISIBLE("obj_ecf")
	ACTIVATE WINDOW obj_ecf SAME
ELSE
	ACTIVATE WINDOW obj_ecf NOSHOW
ENDIF
@ 19,64 TO 21,74 ;
	COLOR SCHEME 24
@ 21,65 TO 21,73 ;
	COLOR SCHEME 23
@ 20,74 SAY "Ё" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 21,74 SAY "ы" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 19,74 SAY "©" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 0,0 TO 22,75 ;
	COLOR SCHEME 23
@ 22,1 TO 22,74 ;
	COLOR SCHEME 24
@ 1,75 TO 20,75 ;
	COLOR SCHEME 24
@ 22,75 SAY "ы" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 0,75 SAY "©" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 19,53 TO 21,63 ;
	COLOR SCHEME 24
@ 21,54 TO 21,62 ;
	COLOR SCHEME 23
@ 20,63 SAY "Ё" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 21,63 SAY "ы" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 19,63 SAY "©" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 0,20 SAY "[ ECF - Emissao de Cupom Fiscal ]" ;
	SIZE 1,33, 0
@ 0,69 SAY "[ECF]" ;
	SIZE 1,5, 0
@ 14,2 SAY "-----------------------------------------------------------------------" ;
	SIZE 1,71, 0
@ 2,4 GET m.fatvend_swe ;
	PICTURE "@*HN \<2-Faturar" ;
	SIZE 1,11,1 ;
	DEFAULT 1 ;
	WHEN _3sq0vt1eo() ;
	VALID _3sq0vt1ep()
@ 4,4 GET m.canc_swe ;
	PICTURE "@*HN \<3-Cancelar Documento Fiscal" ;
	SIZE 1,29,1 ;
	DEFAULT 1 ;
	WHEN _3sq0vt1eq() ;
	VALID _3sq0vt1er()
@ 6,4 GET m.visual_swe ;
	PICTURE "@*HN \<5-Visualizar Docs. Faturados" ;
	SIZE 1,30,1 ;
	DEFAULT 1 ;
	WHEN _3sq0vt1es() ;
	VALID _3sq0vt1et()
@ 8,4 GET m.Emit_Bol ;
	PICTURE "@*HN \<7-Emite Boleto - ORION" ;
	SIZE 1,25,1 ;
	DEFAULT 1 ;
	WHEN _3sq0vt1eu() ;
	VALID _3sq0vt1ev()
@ 13,4 GET m.recupfat_swe ;
	PICTURE "@*HN \<Recuperacao" ;
	SIZE 1,13,1 ;
	DEFAULT 1 ;
	WHEN _3sq0vt1ew() ;
	VALID _3sq0vt1ex()
@ 16,4 GET m.ReenvNFe ;
	PICTURE "@*HN \<8-NFe Reenvia->NF->DOC->XML->NFe" ;
	SIZE 1,34,1 ;
	DEFAULT 1 ;
	WHEN _3sq0vt1ey() ;
	VALID _3sq0vt1ez()
@ 17,4 GET m.ReenvDFis ;
	PICTURE "@*HN \<9-DFis-Reenvia->NF/NFe/NFS/ECF ==> DFis" ;
	SIZE 1,41,1 ;
	DEFAULT 1 ;
	WHEN _3sq0vt1f0() ;
	VALID _3sq0vt1f1()
@ 18,4 GET m.RtrnNFe ;
	PICTURE "@*HN NFe Re\<Torno" ;
	SIZE 1,13,1 ;
	DEFAULT 1 ;
	WHEN _3sq0vt1f2() ;
	VALID _3sq0vt1f3()
@ 19,4 GET m.eminfcp_swe ;
	PICTURE "@*HN Co\<pia Cupom em NF" ;
	SIZE 1,19,1 ;
	DEFAULT 1 ;
	WHEN _3sq0vt1f4() ;
	VALID _3sq0vt1f5()
@ 20,56 GET m.OK_btn ;
	PICTURE "@*HN \<Ok" ;
	SIZE 1,4,1 ;
	DEFAULT 1 ;
	WHEN _3sq0vt1f6() ;
	VALID _3sq0vt1f7() ;
	MESSAGE 'Abre Sistema Vendas'
@ 20,66 GET m.cft_btn ;
	PICTURE "@*HN \<Saida" ;
	SIZE 1,7,1 ;
	DEFAULT 1 ;
	WHEN _3sq0vt1f8() ;
	VALID _3sq0vt1f9() ;
	MESSAGE 'Abre Sistema Vendas'
@ 2,46 GET m.fatvend_swe ;
	PICTURE "@*HN \<6-Faturar direto" ;
	SIZE 1,18,1 ;
	DEFAULT 1 ;
	WHEN _3sq0vt1fa() ;
	VALID _3sq0vt1fb()
@ 8,46 GET m.Reg_Fncr ;
	PICTURE "@*HN \<0-Registro Fncr Novo" ;
	SIZE 1,22,1 ;
	DEFAULT 1 ;
	WHEN _3sq0vt1fc() ;
	VALID _3sq0vt1fd()
@ 10,4 GET m.Emit_Bol ;
	PICTURE "@*HN \<A-Emite Boleto - ANTIGO" ;
	SIZE 1,25,1 ;
	DEFAULT 1 ;
	WHEN _3sq0vt1fe() ;
	VALID _3sq0vt1ff()
@ 15,51 GET m.Gera_dup ;
	PICTURE "@*HN \<G-Gera duplicatas" ;
	SIZE 1,19,1 ;
	DEFAULT 1 ;
	WHEN _3sq0vt1fg() ;
	VALID _3sq0vt1fh()

IF NOT WVISIBLE("obj_ecf")
	ACTIVATE WINDOW obj_ecf
ENDIF

READ CYCLE

RELEASE WINDOW obj_ecf

#REGION 0
IF m.talkstat = "ON"
	SET TALK ON
ENDIF
IF m.compstat = "ON"
	SET COMPATIBLE ON
ENDIF


*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨              OBJ_ECF3/MS-DOS Cleanup Code               ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*

#REGION 1
	SET DEVICE TO SCREEN

	=W_DEFPROC("ECF.SPR")
	=ECFClose()

	IF !EMPTY(wl_areant)
		SELECT &wl_areant
	ENDIF
	POP KEY 			   && reabilita teclas de controle

RETURN

*--------------  ROTINAS DE APOIO  - ECF ---------------*



*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨  OBJ_ECF3/MS-DOS Supporting Procedures and Functions    ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*

#REGION 1
PROCEDURE ULpos_ok
 	_CUROBJ = OBJNUM(ok_btn)
RETURN(.T.)

PROCEDURE ULpos_canc
 	_CUROBJ = OBJNUM(cft_btn)
RETURN(.T.)



****************************************************************************
* FUCTION ECFimpdpl : PROCESSA DADOS REFERENTES AS DUPLICATAS RETORNANDO
*			UMA STRING COM NUMERO E VENCIMENTO DAS DUPLICATAS
****************************************************************************

FUNCTION ECFShowStatus				&& VERIFICA STA

	=W_DEFPROC("ECF.SPR")
	=ECFstatus()			&& PROVOCA ATUALIZA─гO DOS STATUS

	*---------------------------------------------------------*
	=W_DEFPROC("ECF.SPR")
	LSseq 		= ECFGetPropVT("LSSEQ")
	=W_DEFPROC("ECF.SPR")
	LSstat 		= ECFGetPropVT("LSstat")
	=W_DEFPROC("ECF.SPR")
	LStransacao = ECFGetPropVT("LStransacao")
	=W_DEFPROC("ECF.SPR")
	LSescape 	= ECFGetPropVT("LSescape")
	=W_DEFPROC("ECF.SPR")
	LSreducao 	= ECFGetPropVT("LSreducao")
	=W_DEFPROC("ECF.SPR")
	LSliq	 	= ECFGetPropVT("LSliq")
	=W_DEFPROC("ECF.SPR")
	LSbruto 	= ECFGetPropVT("LSbruto")
	=W_DEFPROC("ECF.SPR")
	LSmenserro 	= ECFGetPropVT("LSmenserro")
	=W_DEFPROC("ECF.SPR")
	LSfazx	 	= ECFGetPropVT("LSfazx")
	=W_DEFPROC("ECF.SPR")
	LSpapel	 	= ECFGetPropVT("LSpapel")
	*---------------------------------------------------------*

	SHOW GET LSseq	
	SHOW GET LSstat
	SHOW GET LStransacao
	SHOW GET LSescape
	SHOW GET LSreducao
	SHOW GET LSliq
	SHOW GET LSbruto
	SHOW GET LSerro
	SHOW GET LSmenserro
	SHOW GET LSfazx
	SHOW GET LSpapel
RETURN





*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨ _3SQ0VT1EO           m.fatvend_swe WHEN                 ╨
*       ╨                                                         ╨
*       ╨ Function Origin:                                        ╨
*       ╨                                                         ╨
*       ╨ From Platform:       MS-DOS                             ╨
*       ╨ From Screen:         OBJ_ECF3,     Record Number:   20  ╨
*       ╨ Variable:            m.fatvend_swe                      ╨
*       ╨ Called By:           WHEN Clause                        ╨
*       ╨ Object Type:         Push Button                        ╨
*       ╨ Snippet Number:      1                                  ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*
FUNCTION _3sq0vt1eo     &&  m.fatvend_swe WHEN
#REGION 1
ON KEY LABEL ENTER
RETURN(.t.)

*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨ _3SQ0VT1EP           m.fatvend_swe VALID                ╨
*       ╨                                                         ╨
*       ╨ Function Origin:                                        ╨
*       ╨                                                         ╨
*       ╨ From Platform:       MS-DOS                             ╨
*       ╨ From Screen:         OBJ_ECF3,     Record Number:   20  ╨
*       ╨ Variable:            m.fatvend_swe                      ╨
*       ╨ Called By:           VALID Clause                       ╨
*       ╨ Object Type:         Push Button                        ╨
*       ╨ Snippet Number:      2                                  ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*

FUNCTION _3sq0vt1ep     &&  m.fatvend_swe VALID
#REGION 1
	=W_DEFPROC("ORCAMENT.SPR")


    PRIVATE LSEmite_blto

	IF ORSelParaFat()

		=W_DEFPROC("CLIENC.SPR")
        LSEmite_blto =  CNGetFieldValue(orcament.empresa,;
                            orcament.orcamento,;
                            "EMITE_BLTO")

       IF TYPE("LSEmite_blto") <> "N"  OR LSEmite_blto <> 2
			=W_DEFPROC("NOTA.SPR")
			=NFrot_fat(LSchamada,"EFETIVAR FATURAMENTO","EMITIR BOLETO")
	   ELSE
			*-----------------------------------*
            **  LSEmite_blto = 2 => nao emitir boleto
			*-----------------------------------*
			=W_DEFPROC("NOTA.SPR")
			=NFrot_fat(LSchamada,"EFETIVAR FATURAMENTO","SEM BOLETO")
       ENDIF


	ENDIF

	ACTIVATE WINDOWS OBJ_ECF TOP
	SHOW WINDOW OBJ_ECF TOP

	ACTIVATE WINDOWS OBJ_ECF TOP
	SHOW WINDOW OBJ_ECF TOP

RETURN


*
*
*
*		=W_DEFPROC("NOTA.SPR")
*		wp_flgfecha = !NFrot_fat("IMPORTACAO","EFETIVAR FATURAMENTO")
*

*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨ _3SQ0VT1EQ           m.canc_swe WHEN                    ╨
*       ╨                                                         ╨
*       ╨ Function Origin:                                        ╨
*       ╨                                                         ╨
*       ╨ From Platform:       MS-DOS                             ╨
*       ╨ From Screen:         OBJ_ECF3,     Record Number:   21  ╨
*       ╨ Variable:            m.canc_swe                         ╨
*       ╨ Called By:           WHEN Clause                        ╨
*       ╨ Object Type:         Push Button                        ╨
*       ╨ Snippet Number:      3                                  ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*
FUNCTION _3sq0vt1eq     &&  m.canc_swe WHEN
#REGION 1
ON KEY LABEL ENTER
RETURN(.t.)

*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨ _3SQ0VT1ER           m.canc_swe VALID                   ╨
*       ╨                                                         ╨
*       ╨ Function Origin:                                        ╨
*       ╨                                                         ╨
*       ╨ From Platform:       MS-DOS                             ╨
*       ╨ From Screen:         OBJ_ECF3,     Record Number:   21  ╨
*       ╨ Variable:            m.canc_swe                         ╨
*       ╨ Called By:           VALID Clause                       ╨
*       ╨ Object Type:         Push Button                        ╨
*       ╨ Snippet Number:      4                                  ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*
FUNCTION _3sq0vt1er     &&  m.canc_swe VALID
#REGION 1
	=W_DEFPROC("NOTA.SPR")
	=NFpede_cancelamento()

*	=W_DEFPROC("ECF.SPR")
*	=ECFpede_cancpmant()

	ACTIVATE WINDOWS OBJ_ECF TOP
	SHOW WINDOW OBJ_ECF TOP

	ACTIVATE WINDOWS OBJ_ECF TOP
	SHOW WINDOW OBJ_ECF TOP

RETURN



*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨ _3SQ0VT1ES           m.visual_swe WHEN                  ╨
*       ╨                                                         ╨
*       ╨ Function Origin:                                        ╨
*       ╨                                                         ╨
*       ╨ From Platform:       MS-DOS                             ╨
*       ╨ From Screen:         OBJ_ECF3,     Record Number:   22  ╨
*       ╨ Variable:            m.visual_swe                       ╨
*       ╨ Called By:           WHEN Clause                        ╨
*       ╨ Object Type:         Push Button                        ╨
*       ╨ Snippet Number:      5                                  ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*
FUNCTION _3sq0vt1es     &&  m.visual_swe WHEN
#REGION 1
ON KEY LABEL ENTER
RETURN(.t.)

*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨ _3SQ0VT1ET           m.visual_swe VALID                 ╨
*       ╨                                                         ╨
*       ╨ Function Origin:                                        ╨
*       ╨                                                         ╨
*       ╨ From Platform:       MS-DOS                             ╨
*       ╨ From Screen:         OBJ_ECF3,     Record Number:   22  ╨
*       ╨ Variable:            m.visual_swe                       ╨
*       ╨ Called By:           VALID Clause                       ╨
*       ╨ Object Type:         Push Button                        ╨
*       ╨ Snippet Number:      6                                  ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*
FUNCTION _3sq0vt1et     &&  m.visual_swe VALID
#REGION 1
	=W_DEFPROC("NOTA.SPR")
	=NFView()
RETURN



*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨ _3SQ0VT1EU           m.Emit_Bol WHEN                    ╨
*       ╨                                                         ╨
*       ╨ Function Origin:                                        ╨
*       ╨                                                         ╨
*       ╨ From Platform:       MS-DOS                             ╨
*       ╨ From Screen:         OBJ_ECF3,     Record Number:   23  ╨
*       ╨ Variable:            m.Emit_Bol                         ╨
*       ╨ Called By:           WHEN Clause                        ╨
*       ╨ Object Type:         Push Button                        ╨
*       ╨ Snippet Number:      7                                  ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*
FUNCTION _3sq0vt1eu     &&  m.Emit_Bol WHEN
#REGION 1
ON KEY LABEL ENTER
RETURN(.t.)

*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨ _3SQ0VT1EV           m.Emit_Bol VALID                   ╨
*       ╨                                                         ╨
*       ╨ Function Origin:                                        ╨
*       ╨                                                         ╨
*       ╨ From Platform:       MS-DOS                             ╨
*       ╨ From Screen:         OBJ_ECF3,     Record Number:   23  ╨
*       ╨ Variable:            m.Emit_Bol                         ╨
*       ╨ Called By:           VALID Clause                       ╨
*       ╨ Object Type:         Push Button                        ╨
*       ╨ Snippet Number:      8                                  ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*
FUNCTION _3sq0vt1ev     &&  m.Emit_Bol VALID
#REGION 1
	=W_DEFPROC("NOTA.SPR")
	LNregistro = NFView()
	IF LNregistro > 0
	   sele nota
	   go lnregistro
		*---------------------------------------------------------*
		=W_DEFPROC("DUPLICAT.SPR")
		=CRGeraBoleto(nota.empresa,nota.nota,"ORION")
		*---------------------------------------------------------*
	ENDIF
	ACTIVATE WINDOWS OBJ_ECF TOP
	SHOW WINDOW OBJ_ECF TOP
RETURN





*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨ _3SQ0VT1EW           m.recupfat_swe WHEN                ╨
*       ╨                                                         ╨
*       ╨ Function Origin:                                        ╨
*       ╨                                                         ╨
*       ╨ From Platform:       MS-DOS                             ╨
*       ╨ From Screen:         OBJ_ECF3,     Record Number:   24  ╨
*       ╨ Variable:            m.recupfat_swe                     ╨
*       ╨ Called By:           WHEN Clause                        ╨
*       ╨ Object Type:         Push Button                        ╨
*       ╨ Snippet Number:      9                                  ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*
FUNCTION _3sq0vt1ew     &&  m.recupfat_swe WHEN
#REGION 1
ON KEY LABEL ENTER
RETURN(.t.)

*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨ _3SQ0VT1EX           m.recupfat_swe VALID               ╨
*       ╨                                                         ╨
*       ╨ Function Origin:                                        ╨
*       ╨                                                         ╨
*       ╨ From Platform:       MS-DOS                             ╨
*       ╨ From Screen:         OBJ_ECF3,     Record Number:   24  ╨
*       ╨ Variable:            m.recupfat_swe                     ╨
*       ╨ Called By:           VALID Clause                       ╨
*       ╨ Object Type:         Push Button                        ╨
*       ╨ Snippet Number:      10                                 ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*
	*---------------------------------------------------------*

FUNCTION _3sq0vt1ex     &&  m.recupfat_swe VALID
#REGION 1
	=W_DEFPROC("NOTA.SPR")
	=NFRecuperaFat("RECUPERACAO","EFETIVAR FATURAMENTO")

	*---------------------------------------------------------*
	ACTIVATE WINDOWS OBJ_ECF TOP
	SHOW WINDOW OBJ_ECF TOP
RETURN





*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨ _3SQ0VT1EY           m.ReenvNFe WHEN                    ╨
*       ╨                                                         ╨
*       ╨ Function Origin:                                        ╨
*       ╨                                                         ╨
*       ╨ From Platform:       MS-DOS                             ╨
*       ╨ From Screen:         OBJ_ECF3,     Record Number:   25  ╨
*       ╨ Variable:            m.ReenvNFe                         ╨
*       ╨ Called By:           WHEN Clause                        ╨
*       ╨ Object Type:         Push Button                        ╨
*       ╨ Snippet Number:      11                                 ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*
FUNCTION _3sq0vt1ey     &&  m.ReenvNFe WHEN
#REGION 1
ON KEY LABEL ENTER
RETURN(.t.)

*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨ _3SQ0VT1EZ           m.ReenvNFe VALID                   ╨
*       ╨                                                         ╨
*       ╨ Function Origin:                                        ╨
*       ╨                                                         ╨
*       ╨ From Platform:       MS-DOS                             ╨
*       ╨ From Screen:         OBJ_ECF3,     Record Number:   25  ╨
*       ╨ Variable:            m.ReenvNFe                         ╨
*       ╨ Called By:           VALID Clause                       ╨
*       ╨ Object Type:         Push Button                        ╨
*       ╨ Snippet Number:      12                                 ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*






	*-----------------------------------------------------------*
FUNCTION _3sq0vt1ez     &&  m.ReenvNFe VALID
#REGION 1
	PRIVATE LSemi_CFe
	PRIVATE LSscr_CFe

	*------------------------------------------------------------*


	=W_DEFPROC("EMPRESA.SPR")
	LSemi_CFE = EMGetFieldValue(wp_empresa,"EMITE_CFE")

	*------------------------------------------------------------*



	=W_DEFPROC("EMPRESA.SPR")
	LSscr_cfe = EMGetFieldValue(wp_empresa,"ESCRT_CFE")


	*------------------------------------------------------------*

	DO CASE

        CASE nota.nfe_status = "CANCELADA"
             =W_DEFPROC("nota.spr")
		     =NFCTRLcancFatura((nota.empresa),(nota.nota),"NORMAL")

		CASE LSemi_cfe = "S" OR LSscr_cfe = "S"
	
			=W_DEFPROC("NOTA.SPR")
			=NFReenvNFe("")

		OTHERWISE
		
			=W_DEFPROC("NOTA.SPR")
			=NFReenvNFe(" and (nota < 1000000 or nota > 3000000)")

	ENDCASE


	ACTIVATE WINDOWS OBJ_ECF TOP
	SHOW WINDOW OBJ_ECF TOP

RETURN



*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨ _3SQ0VT1F0           m.ReenvDFis WHEN                   ╨
*       ╨                                                         ╨
*       ╨ Function Origin:                                        ╨
*       ╨                                                         ╨
*       ╨ From Platform:       MS-DOS                             ╨
*       ╨ From Screen:         OBJ_ECF3,     Record Number:   26  ╨
*       ╨ Variable:            m.ReenvDFis                        ╨
*       ╨ Called By:           WHEN Clause                        ╨
*       ╨ Object Type:         Push Button                        ╨
*       ╨ Snippet Number:      13                                 ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*
FUNCTION _3sq0vt1f0     &&  m.ReenvDFis WHEN
#REGION 1
ON KEY LABEL ENTER
RETURN(.t.)

*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨ _3SQ0VT1F1           m.ReenvDFis VALID                  ╨
*       ╨                                                         ╨
*       ╨ Function Origin:                                        ╨
*       ╨                                                         ╨
*       ╨ From Platform:       MS-DOS                             ╨
*       ╨ From Screen:         OBJ_ECF3,     Record Number:   26  ╨
*       ╨ Variable:            m.ReenvDFis                        ╨
*       ╨ Called By:           VALID Clause                       ╨
*       ╨ Object Type:         Push Button                        ╨
*       ╨ Snippet Number:      14                                 ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*

FUNCTION _3sq0vt1f1     &&  m.ReenvDFis VALID
#REGION 1
	=W_DEFPROC("NOTA.SPR")
	=NFReenvNFe()
	ACTIVATE WINDOWS OBJ_ECF TOP
	SHOW WINDOW OBJ_ECF TOP
RETURN



*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨ _3SQ0VT1F2           m.RtrnNFe WHEN                     ╨
*       ╨                                                         ╨
*       ╨ Function Origin:                                        ╨
*       ╨                                                         ╨
*       ╨ From Platform:       MS-DOS                             ╨
*       ╨ From Screen:         OBJ_ECF3,     Record Number:   27  ╨
*       ╨ Variable:            m.RtrnNFe                          ╨
*       ╨ Called By:           WHEN Clause                        ╨
*       ╨ Object Type:         Push Button                        ╨
*       ╨ Snippet Number:      15                                 ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*
FUNCTION _3sq0vt1f2     &&  m.RtrnNFe WHEN
#REGION 1
ON KEY LABEL ENTER
RETURN(.t.)

*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨ _3SQ0VT1F3           m.RtrnNFe VALID                    ╨
*       ╨                                                         ╨
*       ╨ Function Origin:                                        ╨
*       ╨                                                         ╨
*       ╨ From Platform:       MS-DOS                             ╨
*       ╨ From Screen:         OBJ_ECF3,     Record Number:   27  ╨
*       ╨ Variable:            m.RtrnNFe                          ╨
*       ╨ Called By:           VALID Clause                       ╨
*       ╨ Object Type:         Push Button                        ╨
*       ╨ Snippet Number:      16                                 ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*
FUNCTION _3sq0vt1f3     &&  m.RtrnNFe VALID
#REGION 1
	=W_DEFPROC("NOTA.SPR")
	LNregistro = NFView(" and (nota < 1000000 or nota > 3000000)")
	IF LNregistro > 0
	   sele nota
	   go lnregistro
		*---------------------------------------------------------*
		=W_DEFPROC("NOTA.SPR")
		=NFRtrnoNfe_NOTA(nota.empresa,nota.nota,"NAO ESPERA")

		*---------------------------------------------------------*
	ENDIF
	=W_DEFPROC("rotinas.SPR")

	ACTIVATE WINDOWS OBJ_ECF TOP
	SHOW WINDOW OBJ_ECF TOP
RETURN


*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨ _3SQ0VT1F4           m.eminfcp_swe WHEN                 ╨
*       ╨                                                         ╨
*       ╨ Function Origin:                                        ╨
*       ╨                                                         ╨
*       ╨ From Platform:       MS-DOS                             ╨
*       ╨ From Screen:         OBJ_ECF3,     Record Number:   28  ╨
*       ╨ Variable:            m.eminfcp_swe                      ╨
*       ╨ Called By:           WHEN Clause                        ╨
*       ╨ Object Type:         Push Button                        ╨
*       ╨ Snippet Number:      17                                 ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*
FUNCTION _3sq0vt1f4     &&  m.eminfcp_swe WHEN
#REGION 1
ON KEY LABEL ENTER
RETURN(.t.)

*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨ _3SQ0VT1F5           m.eminfcp_swe VALID                ╨
*       ╨                                                         ╨
*       ╨ Function Origin:                                        ╨
*       ╨                                                         ╨
*       ╨ From Platform:       MS-DOS                             ╨
*       ╨ From Screen:         OBJ_ECF3,     Record Number:   28  ╨
*       ╨ Variable:            m.eminfcp_swe                      ╨
*       ╨ Called By:           VALID Clause                       ╨
*       ╨ Object Type:         Push Button                        ╨
*       ╨ Snippet Number:      18                                 ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*
	*--------------------------------------------------------*
FUNCTION _3sq0vt1f5     &&  m.eminfcp_swe VALID
#REGION 1
	=W_DEFPROC("NOTA.SPR")
	if wp_dtoper <= {02.04.2006}
		do NF_01ImpCopia
	ELSE
		do NF_02ImpCopia with "CAIXA"
	ENDIF
	*--------------------------------------------------------*

	SELECT orcament
	UNLOCK ALL
	ACTIVATE WINDOW OBJ_ECF TOP
	SHOW WINDOW OBJ_ECF TOP
RETURN







*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨ _3SQ0VT1F6           m.OK_btn WHEN                      ╨
*       ╨                                                         ╨
*       ╨ Function Origin:                                        ╨
*       ╨                                                         ╨
*       ╨ From Platform:       MS-DOS                             ╨
*       ╨ From Screen:         OBJ_ECF3,     Record Number:   29  ╨
*       ╨ Variable:            m.OK_btn                           ╨
*       ╨ Called By:           WHEN Clause                        ╨
*       ╨ Object Type:         Push Button                        ╨
*       ╨ Snippet Number:      19                                 ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*
FUNCTION _3sq0vt1f6     &&  m.OK_btn WHEN
#REGION 1
ON KEY LABEL ENTER
RETURN(.t.)

*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨ _3SQ0VT1F7           m.OK_btn VALID                     ╨
*       ╨                                                         ╨
*       ╨ Function Origin:                                        ╨
*       ╨                                                         ╨
*       ╨ From Platform:       MS-DOS                             ╨
*       ╨ From Screen:         OBJ_ECF3,     Record Number:   29  ╨
*       ╨ Variable:            m.OK_btn                           ╨
*       ╨ Called By:           VALID Clause                       ╨
*       ╨ Object Type:         Push Button                        ╨
*       ╨ Snippet Number:      20                                 ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*
FUNCTION _3sq0vt1f7     &&  m.OK_btn VALID
#REGION 1
CLEAR GETS
CLEAR READ
isediting = .f.
RETURN .T.

*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨ _3SQ0VT1F8           m.cft_btn WHEN                     ╨
*       ╨                                                         ╨
*       ╨ Function Origin:                                        ╨
*       ╨                                                         ╨
*       ╨ From Platform:       MS-DOS                             ╨
*       ╨ From Screen:         OBJ_ECF3,     Record Number:   30  ╨
*       ╨ Variable:            m.cft_btn                          ╨
*       ╨ Called By:           WHEN Clause                        ╨
*       ╨ Object Type:         Push Button                        ╨
*       ╨ Snippet Number:      21                                 ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*
FUNCTION _3sq0vt1f8     &&  m.cft_btn WHEN
#REGION 1
ON KEY LABEL ENTER
RETURN(.t.)

*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨ _3SQ0VT1F9           m.cft_btn VALID                    ╨
*       ╨                                                         ╨
*       ╨ Function Origin:                                        ╨
*       ╨                                                         ╨
*       ╨ From Platform:       MS-DOS                             ╨
*       ╨ From Screen:         OBJ_ECF3,     Record Number:   30  ╨
*       ╨ Variable:            m.cft_btn                          ╨
*       ╨ Called By:           VALID Clause                       ╨
*       ╨ Object Type:         Push Button                        ╨
*       ╨ Snippet Number:      22                                 ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*
FUNCTION _3sq0vt1f9     &&  m.cft_btn VALID
#REGION 1
  CLEAR GETS
  CLEAR READ
  isediting = .f.
  CLEAR TYPEAHEAD
  CLEAR TYPEAHEAD
  ON KEY
  KEYBOARD CHR(27)
  LFretorno = .f.  && CASO SEJA CANCELADO VOLTA .F.
RETURN .T.

*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨ _3SQ0VT1FA           m.fatvend_swe WHEN                 ╨
*       ╨                                                         ╨
*       ╨ Function Origin:                                        ╨
*       ╨                                                         ╨
*       ╨ From Platform:       MS-DOS                             ╨
*       ╨ From Screen:         OBJ_ECF3,     Record Number:   31  ╨
*       ╨ Variable:            m.fatvend_swe                      ╨
*       ╨ Called By:           WHEN Clause                        ╨
*       ╨ Object Type:         Push Button                        ╨
*       ╨ Snippet Number:      23                                 ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*
FUNCTION _3sq0vt1fa     &&  m.fatvend_swe WHEN
#REGION 1
ON KEY LABEL ENTER
RETURN(.t.)

*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨ _3SQ0VT1FB           m.fatvend_swe VALID                ╨
*       ╨                                                         ╨
*       ╨ Function Origin:                                        ╨
*       ╨                                                         ╨
*       ╨ From Platform:       MS-DOS                             ╨
*       ╨ From Screen:         OBJ_ECF3,     Record Number:   31  ╨
*       ╨ Variable:            m.fatvend_swe                      ╨
*       ╨ Called By:           VALID Clause                       ╨
*       ╨ Object Type:         Push Button                        ╨
*       ╨ Snippet Number:      24                                 ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*

FUNCTION _3sq0vt1fb     &&  m.fatvend_swe VALID
#REGION 1
	=W_DEFPROC("ORCAMENT.SPR")


    PRIVATE LSEmite_blto


	IF ORSelPFatDireto()

		=W_DEFPROC("CLIENC.SPR")
        LSEmite_blto =  CNGetFieldValue(orcament.empresa,;
                            orcament.orcamento,;
                            "EMITE_BLTO")


       IF LSEmite_blto = 2    && nao emitir boleto
		=W_DEFPROC("NOTA.SPR")
		=NFrot_fat("FATURISTA SIMPLES","EFETIVAR FATURAMENTO")

       ELSE
		=W_DEFPROC("NOTA.SPR")
		=NFrot_fat("FATURISTA SIMPLES","EFETIVAR FATURAMENTO",;
		        "EMITIR BOLETO")

       ENDIF


	ENDIF

	ACTIVATE WINDOWS OBJ_ECF TOP
	SHOW WINDOW OBJ_ECF TOP

	ACTIVATE WINDOWS OBJ_ECF TOP
	SHOW WINDOW OBJ_ECF TOP

RETURN




*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨ _3SQ0VT1FC           m.Reg_Fncr WHEN                    ╨
*       ╨                                                         ╨
*       ╨ Function Origin:                                        ╨
*       ╨                                                         ╨
*       ╨ From Platform:       MS-DOS                             ╨
*       ╨ From Screen:         OBJ_ECF3,     Record Number:   32  ╨
*       ╨ Variable:            m.Reg_Fncr                         ╨
*       ╨ Called By:           WHEN Clause                        ╨
*       ╨ Object Type:         Push Button                        ╨
*       ╨ Snippet Number:      25                                 ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*
FUNCTION _3sq0vt1fc     &&  m.Reg_Fncr WHEN
#REGION 1
ON KEY LABEL ENTER
RETURN(.t.)

*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨ _3SQ0VT1FD           m.Reg_Fncr VALID                   ╨
*       ╨                                                         ╨
*       ╨ Function Origin:                                        ╨
*       ╨                                                         ╨
*       ╨ From Platform:       MS-DOS                             ╨
*       ╨ From Screen:         OBJ_ECF3,     Record Number:   32  ╨
*       ╨ Variable:            m.Reg_Fncr                         ╨
*       ╨ Called By:           VALID Clause                       ╨
*       ╨ Object Type:         Push Button                        ╨
*       ╨ Snippet Number:      26                                 ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*
FUNCTION _3sq0vt1fd     &&  m.Reg_Fncr VALID
#REGION 1
	=W_DEFPROC("NOTA.SPR")
	LNregistro = NFView()
	IF LNregistro > 0
	   sele nota
	   go lnregistro
		*---------------------------------------------------------*
		=W_DEFPROC("DUPLICAT.SPR")
		=CRDuplDFisExpDuplicata(nota.empresa,nota.nota)
		
		*---------------------------------------------------------*
	ENDIF
	ACTIVATE WINDOWS OBJ_ECF TOP
	SHOW WINDOW OBJ_ECF TOP
RETURN


*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨ _3SQ0VT1FE           m.Emit_Bol WHEN                    ╨
*       ╨                                                         ╨
*       ╨ Function Origin:                                        ╨
*       ╨                                                         ╨
*       ╨ From Platform:       MS-DOS                             ╨
*       ╨ From Screen:         OBJ_ECF3,     Record Number:   33  ╨
*       ╨ Variable:            m.Emit_Bol                         ╨
*       ╨ Called By:           WHEN Clause                        ╨
*       ╨ Object Type:         Push Button                        ╨
*       ╨ Snippet Number:      27                                 ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*
FUNCTION _3sq0vt1fe     &&  m.Emit_Bol WHEN
#REGION 1
ON KEY LABEL ENTER
RETURN(.t.)

*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨ _3SQ0VT1FF           m.Emit_Bol VALID                   ╨
*       ╨                                                         ╨
*       ╨ Function Origin:                                        ╨
*       ╨                                                         ╨
*       ╨ From Platform:       MS-DOS                             ╨
*       ╨ From Screen:         OBJ_ECF3,     Record Number:   33  ╨
*       ╨ Variable:            m.Emit_Bol                         ╨
*       ╨ Called By:           VALID Clause                       ╨
*       ╨ Object Type:         Push Button                        ╨
*       ╨ Snippet Number:      28                                 ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*
FUNCTION _3sq0vt1ff     &&  m.Emit_Bol VALID
#REGION 1
	=W_DEFPROC("NOTA.SPR")
	LNregistro = NFView()
	IF LNregistro > 0
	   sele nota
	   go lnregistro
		*---------------------------------------------------------*
		=W_DEFPROC("DUPLICAT.SPR")
		=CRGeraBoleto(nota.empresa,nota.nota,"FOX")
		*---------------------------------------------------------*
	ENDIF
	ACTIVATE WINDOWS OBJ_ECF TOP
	SHOW WINDOW OBJ_ECF TOP
RETURN


*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨ _3SQ0VT1FG           m.Gera_dup WHEN                    ╨
*       ╨                                                         ╨
*       ╨ Function Origin:                                        ╨
*       ╨                                                         ╨
*       ╨ From Platform:       MS-DOS                             ╨
*       ╨ From Screen:         OBJ_ECF3,     Record Number:   34  ╨
*       ╨ Variable:            m.Gera_dup                         ╨
*       ╨ Called By:           WHEN Clause                        ╨
*       ╨ Object Type:         Push Button                        ╨
*       ╨ Snippet Number:      29                                 ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*
FUNCTION _3sq0vt1fg     &&  m.Gera_dup WHEN
#REGION 1
ON KEY LABEL ENTER
RETURN(.t.)

*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨ _3SQ0VT1FH           m.Gera_dup VALID                   ╨
*       ╨                                                         ╨
*       ╨ Function Origin:                                        ╨
*       ╨                                                         ╨
*       ╨ From Platform:       MS-DOS                             ╨
*       ╨ From Screen:         OBJ_ECF3,     Record Number:   34  ╨
*       ╨ Variable:            m.Gera_dup                         ╨
*       ╨ Called By:           VALID Clause                       ╨
*       ╨ Object Type:         Push Button                        ╨
*       ╨ Snippet Number:      30                                 ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*

FUNCTION _3sq0vt1fh     &&  m.Gera_dup VALID
#REGION 1
	=W_DEFPROC("EMPRESA.SPR")
	LSemi_Fncr = EMGetFieldValue(wp_empresa,"EMITE_FNCR")


    IF  LSemi_Fncr <> "S"
   		WAIT WINDOW ;
   		   "O parametro <Fncr> Empresa nao esta habilitado para "+;
   		   " gerar reg ORION !!!!"
     	ACTIVATE WINDOWS OBJ_ECF TOP
	    SHOW WINDOW OBJ_ECF TOP

        RETURN
    ENDIF

	=W_DEFPROC("NOTA.SPR")
	LNregistro = NFView()
	IF LNregistro > 0
	   sele nota
	   go lnregistro

       DO LCgeradupl

	   sele nota
	   go lnregistro
	ENDIF





	*----------------------------------------------------*
	*----------------------------------------------------*

	ACTIVATE WINDOWS OBJ_ECF TOP
	SHOW WINDOW OBJ_ECF TOP
RETURN

PROCEDURE LCgeradupl



     PRIVATE PrmTrataBoleto
     PRIVATE LSEmite_blto


	=W_DEFPROC("CLIENC.SPR")
    LSEmite_blto =  CNGetFieldValue(nota.empresa,;
                            nota.orcamento,;
                            "EMITE_BLTO")

    IF LSEmite_blto = 2    && nao emitir boleto
		PrmTrataBoleto = "SEM BOLETO"
    ELSE
		PrmTrataBoleto = "EMITIR BOLETO"

    ENDIF


*-----------------------------------------------------------


 	=W_DEFPROC("DUPLICAT.spr")
	DO CASE

        *------- JUN/2012 ---------------------------------------*
        * CRIADO COM A IMPLEMENTACAO DO EMISSO DO BOLETO VIA DFIS
        *-------------------------------------------------------*
		CASE  nota.empresa <> 10 ;
		    AND TYPE("PrmTrataBoleto") = "C" ;
		    AND (PrmTrataBoleto = "EMITIR BOLETO";
		        OR ;
		        PrmTrataBoleto = "SEM BOLETO"  )
			DO  CRgeraDE01JUL12 WITH ;
				    (nota.empresa),;
				    (nota.orcamento),;
				    PrmTrataBoleto
        *--------------------------------

		CASE  nota.empresa = 10
			IF  nota.dt_fat < {26.03.2008}
				DO  CRidlate26geradupl WITH;
					 (nota.empresa),(nota.orcamento)
			ELSE
			
				DO  CRIDLApos26geradupl WITH ;
				    (nota.empresa),(nota.orcamento)
			ENDIF

        *--------------------------------
        *--------------------------------



		CASE nota.dt_fat >= {12.03.2008}
				DO  CRgeraDE12MAR08 WITH ;
				    (nota.empresa),(nota.orcamento)

		CASE nota.dt_fat >= {10.03.2008} AND ;
			(nota.empresa = 01 or nota.empresa = 02)		
				DO  CRgeraDE12MAR08 WITH ;
				    (nota.empresa),(nota.orcamento)
		otherwise
			DO  CRgeraATE10MAR08 WITH ;
			     (nota.empresa),(nota.orcamento)
	ENDCASE

RETURN


SSS