*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є 07/11/2000            SVD0530.SPR              13:00:33 є
*       є                                                         є
*       ЗДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД¶
*       є                                                         є
*       є Author's Name                                           є
*       є                                                         є
*       є Copyright (c) 2000 Company Name                         є
*       є Address                                                 є
*       є City,     Zip                                           є
*       є                                                         є
*       є Description:                                            є
*       є This program was automatically generated by GENSCRN.    є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ

PARAMETERS lnemp,lnorca

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є          SVD0530/MS-DOS Setup Code - SECTION 1          є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1
	*------------------------------------------------------------*
	* CLASSIFICACAO:  [*****]
	*------------------------------------------------------------*
	* OBJETIVO....: Informa Categoria de Cartao e Prazos para
	*          Operacoes com Cartao
	*------------------------------------------------------------*
	* COMENTARIO..: O vendedor apenas especifica que a operacao
	*          e em cartao sendo que no momento do faturamento esta
	*          rotina e ativada para especificar o tipo e prazo de
	*          cartao
	*------------------------------------------------------------*
	* OBS........ :
	*------------------------------------------------------------*
	*  TABELAS....:
	*------------------------------------------------------------*
	*  PARAMETROS..:
	*		LNemp..........: Empresa Operadora do Sistema
	*		LNorca.........: Orcamento Para Vinculo de Dados
	*------------------------------------------------------------*
	*  RETORNO.....:
	*------------------------------------------------------------*
	* EXEMPLO :
	*------------------------------------------------------------*


#REGION 0
REGIONAL m.currarea, m.talkstat, m.compstat

IF SET("TALK") = "ON"
	SET TALK OFF
	m.talkstat = "ON"
ELSE
	m.talkstat = "OFF"
ENDIF
m.compstat = SET("COMPATIBLE")
SET COMPATIBLE FOXPLUS

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є                MS-DOS Window definitions                є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

IF NOT WEXIST("svd0530") ;
	OR UPPER(WTITLE("SVD0530")) == "SVD0530.PJX" ;
	OR UPPER(WTITLE("SVD0530")) == "SVD0530.SCX" ;
	OR UPPER(WTITLE("SVD0530")) == "SVD0530.MNX" ;
	OR UPPER(WTITLE("SVD0530")) == "SVD0530.PRG" ;
	OR UPPER(WTITLE("SVD0530")) == "SVD0530.FRX" ;
	OR UPPER(WTITLE("SVD0530")) == "SVD0530.QPR"
	DEFINE WINDOW svd0530 ;
		FROM INT((SROW()-8)/2),INT((SCOL()-51)/2) ;
		TO INT((SROW()-8)/2)+7,INT((SCOL()-51)/2)+50 ;
		TITLE "SVD0530" ;
		NOFLOAT ;
		NOCLOSE ;
		NOMINIMIZE ;
		NONE ;
		COLOR SCHEME 1
ENDIF


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є          SVD0530/MS-DOS Setup Code - SECTION 2          є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1

	=W_DEFPROC("rotinas.spr")
	CLEAR TYPEAHEAD
	PUSH KEY CLEAR		&& desabilita teclas de atalho def. anteriormente
	ON KEY LABEL F1		DO HLP2000.SPR WITH  POPUP(),PROMPT(),PROGRAM(),;
							WONTOP(),VARREAD()

	ON KEY LABEL ENTER
	ON KEY LABEL END  DO ULpos_ok

	PRIVATE qtd_parcelas

	PRIVATE LForcament

	PRIVATE opcao

	*-----------------------------  variaveis ----------------------------*
	LSalias		= ALIAS()			&& PERMITE RET A AREA ANTER. A CHAMADA
	isediting 	= .T.   			&& PERMITIR A EDICAO DOS CAMPOS OBJ_PRSO
	*-----------------------------------------------------------*
	*			>>>> INICIO CONTROLE ARQUIVOS<<<<<<<<
	*-----------------------------------------------------------*
	LForcament	= NetArq("orcament")
	IF (LForcament) > 100000
		DO ULfecha
		RETURN(.f.)
	ENDIF

	SELE orcament
	SET ORDER TO TAG GERAL
	SEEK STR(LNemp,3)+STR(LNorca,6)
	IF !FOUND()		
		DO OBJ_MENS.SPR WITH CHR(13)+" Nao Existe Orcamento Numero "+;
				STR(LNorca,6)
		DO ULfecha
		RETURN(.f.)
	ENDIF
	IF !REGLOCK()
		DO OBJ_MENS.SPR WITH CHR(13)+" Registro "+;
		  " Referente ao Orcamento Numero "+STR(LNorca,6)+;
		  " NЖo Esta Disponivel."
			DO ULfecha
			RETURN(.f.)
	ENDIF

	SELE ORCAMENT

	m.opcao	 = 0
	m.qtd_parcelas	=	0

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є              SVD0530/MS-DOS Screen Layout               є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1
IF WVISIBLE("svd0530")
	ACTIVATE WINDOW svd0530 SAME
ELSE
	ACTIVATE WINDOW svd0530 NOSHOW
ENDIF
@ 0,0 TO 7,50
@ 1,50 TO 6,50 ;
	COLOR SCHEME 24
@ 1,16 SAY "Dias" ;
	SIZE 1,4, 0
@ 7,1 TO 7,49 ;
	COLOR SCHEME 24
@ 7,50 SAY "Щ" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 0,50 SAY "ї" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 3,6 GET m.opcao ;
	PICTURE "@*RVN \<1 -     1    - Chq.Eletronico ;\<2 -    31    - Cartao Rotativo;\<3 -    31    - Parc.Pela Administ." ;
	SIZE 1,38,0 ;
	DEFAULT 1 ;
	WHEN _08o0rvta8() ;
	VALID _08o0rvtah()
@ 7,19 GET ok_btn ;
	PICTURE "@*HN \<Ok" ;
	SIZE 1,6,5 ;
	DEFAULT 1 ;
	WHEN _08o0rvtav() ;
	VALID _08o0rvtb4()

IF NOT WVISIBLE("svd0530")
	ACTIVATE WINDOW svd0530
ENDIF

READ CYCLE MODAL

RELEASE WINDOW svd0530

#REGION 0
IF m.talkstat = "ON"
	SET TALK ON
ENDIF
IF m.compstat = "ON"
	SET COMPATIBLE ON
ENDIF


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є               SVD0530/MS-DOS Cleanup Code               є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1
	DO ULfecha
RETURN




*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є   SVD0530/MS-DOS Supporting Procedures and Functions    є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1
PROCEDURE ULfecha
	SELE orcament
	UNLOCK
	=UP_fecha("orcament" ,LForcament)
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
	ON KEY LABEL ESCAPE
	SET FORMAT TO
	************************************
	POP KEY 			&& reabilita teclas de atalho def. anteriormente
RETURN


PROCEDURE ULpos_ok
 	_CUROBJ = OBJNUM(ok_btn)
RETURN(.T.)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _08O0RVTA8           m.opcao WHEN                       є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0530,     Record Number:    8   є
*       є Variable:            m.opcao                            є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Radio Button                       є
*       є Snippet Number:      1                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _08o0rvta8     &&  m.opcao WHEN
#REGION 1
ON KEY LABEL TAB
ON KEY LABEL ENTER  KEYBOARD "{RIGHTARROW}"
RETURN(isediting)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _08O0RVTAH           m.opcao VALID                      є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0530,     Record Number:    8   є
*       є Variable:            m.opcao                            є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Radio Button                       є
*       є Snippet Number:      2                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _08o0rvtah     &&  m.opcao VALID
#REGION 1
IF m.opcao < 4
	KEYBOARD "O"
	KEYBOARD "{ENTER}"
ELSE
	_CUROBJ = OBJNUM(m.qtd_parcelas)
ENDIF
RETURN(.T.)



*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _08O0RVTAV           ok_btn WHEN                        є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0530,     Record Number:    9   є
*       є Variable:            ok_btn                             є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      3                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _08o0rvtav     &&  ok_btn WHEN
#REGION 1
ON KEY LABEL ENTER
ON KEY LABEL TAB
RETURN(m.opcao > 0 AND m.opcao < 5)

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _08O0RVTB4           ok_btn VALID                       є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0530,     Record Number:    9   є
*       є Variable:            ok_btn                             є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      4                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
	*---------------------------------------------------------------*
FUNCTION _08o0rvtb4     &&  ok_btn VALID
#REGION 1
	SELE ORCAMENT
	SET ORDE TO geral
	SEEK STR(LNemp,3)+STR(LNorca,6)
	IF FOUND()		
		=REGLOCK(.T.)
		*---------------------------------------------------------------*
		*    Complementa‡Жo de Dados Derivados
		*---------------------------------------------------------------*
		m.tp_pgto		= 	3	&& VENDA A PRAZO
		DO CASE
			CASE m.opcao = 1
				 m.prazo   =  "001/000/000/000/000/"
				 m.forma_pgto = 05
			CASE m.opcao = 2
				 m.prazo   =  "031/000/000/000/000/"
				 m.forma_pgto = 06
			CASE m.opcao = 3
				 m.prazo   =  "031/000/000/000/000/"
				 m.forma_pgto = 07

			CASE m.opcao = 4 AND m.qtd_parcelas = 1
				 m.prazo   =  "031/000/000/000/000/"
				 m.forma_pgto = 08
			CASE m.opcao = 4 AND m.qtd_parcelas = 2
				 m.prazo   =  "031/061/000/000/000/"
				 m.forma_pgto = 08
			CASE m.opcao = 4 AND m.qtd_parcelas = 3
				 m.prazo   =  "031/061/091/000/000/"
				 m.forma_pgto = 08

		ENDCASE
		STORE 0 TO LNnumpgt, m.prazomedio,m.taxa,m.juromes
		=W_DEFPROC("orcament.spr")
		=ORprzmedio((m.prazo),(m.juromes),LNnumpgt,;
					m.prazomedio,m.taxa)
		***************************
		SET FIELDS TO prazo,prazomedio,taxa,tp_pgto,juromes,forma_pgto
		=edithand('REGRAVA')
		CLEAR FIELDS
		SET FIELDS OFF
		***************************
		PRIVATE LFflg_ant
		LFflg_ant =  orcament.flgtransac
		*----------------------------------------------------------*
		*  Ajustar Classifica‡Жo do Orcamento					   *
		*----------------------------------------------------------*
		=W_DEFPROC("orcament.spr")
		IF !ORnewclas_oper((LNemp),(LNorca))
		   	wp_msg = "Atencao!!! "+CHR(13)+;
	   			"     Nao Foi Possivel Classificar a Operacao."
			=UPbeeps(.f.,wp_msg)
		ENDIF
		*-------------------------------------------------------*
		*  A operacao new_clas marca flgtransac com .f. para
		* forcar o recalculo e neste ponto o sistema forca o retor
		* no ao status anterior pois a nova classificao so alter
		* de avista para a prazo
		*-------------------------------------------------------*
		SELE orcament		
		REPLACE orcament.flgtransac WITH LFflg_ant
	ENDIF
	isediting = .f.
	*----------------------------------------------------------*
	clear read
	clear gets
RETURN
