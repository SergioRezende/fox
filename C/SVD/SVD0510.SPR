*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º 03/19/09             SVD0510.SPR               15:10:07 º
*       º                                                         º
*       ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
*       º                                                         º
*       º Author's Name                                           º
*       º                                                         º
*       º Copyright (c) 2009 Company Name                         º
*       º Address                                                 º
*       º City,     Zip                                           º
*       º                                                         º
*       º Description:                                            º
*       º This program was automatically generated by GENSCRN.    º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½

PARAMETERS lnemp,lnorca

*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º          SVD0510/MS-DOS Setup Code - SECTION 1          º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 1
	*------------------------------------------------------------*
	* CLASSIFICACAO:  [*****]
	*------------------------------------------------------------*
	* OBJETIVO....: Trabalhar Outras Informacoes Associadas
	*			ao Orcamento
	*------------------------------------------------------------*
	* COMENTARIO..:
	*------------------------------------------------------------*
	* OBS........ :
	*------------------------------------------------------------*
	*  TABELAS....:
	*------------------------------------------------------------*
	*  PARAMETROS..:
	*		LNemp..........: Empresa Operadora do Sistema
	*		LNorca.........: Orcamento Para Vinculo de Dados
	*------------------------------------------------------------*
	*  RETORNO.....:
	*------------------------------------------------------------*
	* EXEMPLO :
	*------------------------------------------------------------*

#REGION 0
REGIONAL m.currarea, m.talkstat, m.compstat

IF SET("TALK") = "ON"
	SET TALK OFF
	m.talkstat = "ON"
ELSE
	m.talkstat = "OFF"
ENDIF
m.compstat = SET("COMPATIBLE")
SET COMPATIBLE FOXPLUS

*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º                MS-DOS Window definitions                º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

IF NOT WEXIST("svd0510") ;
	OR UPPER(WTITLE("SVD0510")) == "SVD0510.PJX" ;
	OR UPPER(WTITLE("SVD0510")) == "SVD0510.SCX" ;
	OR UPPER(WTITLE("SVD0510")) == "SVD0510.MNX" ;
	OR UPPER(WTITLE("SVD0510")) == "SVD0510.PRG" ;
	OR UPPER(WTITLE("SVD0510")) == "SVD0510.FRX" ;
	OR UPPER(WTITLE("SVD0510")) == "SVD0510.QPR"
	DEFINE WINDOW svd0510 ;
		FROM 1, 1 ;
		TO 9,78 ;
		TITLE "SVD0510" ;
		NOFLOAT ;
		NOCLOSE ;
		NOMINIMIZE ;
		NONE ;
		COLOR SCHEME 1
ENDIF


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º          SVD0510/MS-DOS Setup Code - SECTION 2          º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 1

	=W_DEFPROC("rotinas.spr")
	CLEAR TYPEAHEAD
	PUSH KEY CLEAR		&& desabilita teclas de atalho def. anteriormente
	ON KEY LABEL F1		DO HLP2000.SPR WITH  POPUP(),PROMPT(),PROGRAM(),;
							WONTOP(),VARREAD()

	ON KEY LABEL ENTER

	ON KEY LABEL HOME     DO ULpos_canc
	ON KEY LABEL PGUP     DO ULpos_canc
	ON KEY LABEL CTRL-END DO ULpos_canc

	ON KEY LABEL END  DO ULpos_ok
	ON KEY LABEL PGDN DO ULpos_ok
	ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"


	PRIVATE LFusuario,LForcament,LFclienc,LFtab001
	PRIVATE LSalias,isediting

	*-----------------------------  variaveis ----------------------------*
	LSalias		= ALIAS()			&& PERMITE RET A AREA ANTER. A CHAMADA
	isediting 	= .T.   			&& PERMITIR A EDICAO DOS CAMPOS OBJ_PRSO
	*-----------------------------------------------------------*
	*			>>>> INICIO CONTROLE ARQUIVOS<<<<<<<<
	*-----------------------------------------------------------*
	LFusuario	= NetArq("usuario")
	LForcament	= NetArq("orcament")
	LFclienc	= NetArq("clienc")
	LFtab001	= NetArq("tab001")
	IF (LFusuario+LForcament+LFclienc+LFtab001) > 100000
		DO ULfecha
		RETURN(.f.)
	ENDIF

	SELE CLIENC
	SET ORDE TO EMPORCA
	SEEK STR(LNEMP,3)+STR(LNORCA,6)
	IF !FOUND()
		DO ULfecha
		DO OBJ_MENS.SPR WITH ;
		  "  Nao foram localizados dados do Cliente para esta"+;
		  " OSI."+CHR(13)+CHR(13)+;
          "   Execute procedimento para informar dados do Cliente e "+;
          "retorne a este Processo. "
		RETURN(.f.)
	ENDIF

	m.empresa	= clienc.empresa
	m.orcamento	= clienc.orcamento
	m.cliente	= clienc.cliente
	m.nome		= clienc.nome

	SELE orcament
	SET ORDER TO TAG GERAL
	SEEK STR(LNemp,3)+STR(LNorca,6)
	IF !FOUND()		
		DO OBJ_MENS.SPR WITH CHR(13)+" Nao Existe Orcamento Numero "+;
				STR(LNorca,6)
		DO ULfecha
		RETURN(.f.)
	ENDIF
	IF !REGLOCK()
		DO OBJ_MENS.SPR WITH CHR(13)+" Registro "+;
		  " Referente ao Orcamento Numero "+STR(LNorca,6)+;
		  " NÆo Esta Disponivel."
			DO ULfecha
			RETURN(.f.)
	ENDIF

	m.operador		=	orcament.operador
	SELE usuario
	SET ORDER TO TAG usuario
	SEEK m.operador
	m.nome_vend 	= usuario.nome


	m.nota			=	orcament.nota
	m.dt_fat		=	orcament.dt_fat
	m.valor			= 	orcament.valor
	m.situacao 		=   orcament.situacao

	SELE TAB001
	SET ORDER TO TAG codigo

	SEEK "ST1"+LEFT(m.situacao,1)
	m.nome_sit = RTRIM(tab001.descricao)
	SEEK "ST2"+RIGHT(m.situacao,1)
	m.nome_sit = m.nome_sit+" "+RTRIM(tab001.descricao)
	SHOW GET m.nome_sit

	**************

	SELE ORCAMENT
	* Nao permitir edicao para orcamento nas situa‡äes abaixo

	IF lMaster = .F. AND (LEFT(orcament.situacao,1) $ "OYZo"))
		isediting = .f.
	ENDIF


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º              SVD0510/MS-DOS Screen Layout               º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 1
IF WVISIBLE("svd0510")
	ACTIVATE WINDOW svd0510 SAME
ELSE
	ACTIVATE WINDOW svd0510 NOSHOW
ENDIF
@ 0,0 TO 8,77
@ 8,1 TO 8,74
@ 1,13 SAY "Cliente" ;
	SIZE 1,7, 0
@ 3,0 TO 3,77
@ 6,0 TO 6,77
@ 3,77 SAY "´" ;
	SIZE 1,1, 0
@ 6,77 SAY "´" ;
	SIZE 1,1, 0
@ 3,0 SAY "Ã" ;
	SIZE 1,1, 0
@ 6,0 SAY "Ã" ;
	SIZE 1,1, 0
@ 1,2 SAY "OSI" ;
	SIZE 1,3, 0
@ 1,6 SAY "Nro" ;
	SIZE 1,3, 0
@ 5,7 SAY "-" ;
	SIZE 1,1, 0
@ 4,30 SAY "Nota" ;
	SIZE 1,4, 0
@ 4,42 SAY "Data Fat." ;
	SIZE 1,9, 0
@ 5,55 SAY "TOTAL===>" ;
	SIZE 1,9, 0
@ 7,3 SAY "Situacao:" ;
	SIZE 1,9, 0
@ 4,3 SAY "Atendente" ;
	SIZE 1,9, 0
@ 2,2 GET LNorca ;
	SIZE 1,7 ;
	DEFAULT " " ;
	PICTURE "@K 999,999" ;
	WHEN .F. ;
	ERROR WP_MSG
@ 2,13 GET m.nome ;
	SIZE 1,40 ;
	DEFAULT " " ;
	PICTURE "@K " ;
	WHEN .f.
@ 5,3 GET m.operador ;
	SIZE 1,4 ;
	DEFAULT 0 ;
	PICTURE "9999" ;
	WHEN isediting and lMaster ;
	VALID _2lx0wifsp() ;
	ERROR "Usuario nao Cadastrado no sistema"
@ 5,8 GET m.nome_vend ;
	SIZE 1,18 ;
	DEFAULT " " ;
	WHEN .F.
@ 5,30 GET m.nota ;
	SIZE 1,7 ;
	DEFAULT " " ;
	PICTURE "@K 9999999" ;
	WHEN isediting and lMaster
@ 5,42 GET m.dt_fat ;
	SIZE 1,10 ;
	DEFAULT " " ;
	PICTURE "@K" ;
	WHEN isediting and lMaster
@ 5,64 GET m.valor ;
	SIZE 1,12 ;
	DEFAULT " " ;
	PICTURE "@K 9,999,999.99" ;
	WHEN .F.
@ 7,12 GET m.situacao ;
	SIZE 1,2 ;
	DEFAULT " " ;
	WHEN isediting and lMaster
@ 7,15 GET m.nome_sit ;
	SIZE 1,36 ;
	DEFAULT " " ;
	WHEN .f.
@ 8,54 GET ok_btn ;
	PICTURE "@*HN \<Ok" ;
	SIZE 1,6,5 ;
	DEFAULT 1 ;
	WHEN _2lx0wifud() ;
	VALID _2lx0wifug()
@ 8,63 GET cft_btn ;
	PICTURE "@*HN \<Cancela" ;
	SIZE 1,11,5 ;
	DEFAULT 1 ;
	WHEN _2lx0wifuj() ;
	VALID _2lx0wifum()

IF NOT WVISIBLE("svd0510")
	ACTIVATE WINDOW svd0510
ENDIF

READ CYCLE ;
	SHOW _2lx0wifup()

RELEASE WINDOW svd0510

#REGION 0
IF m.talkstat = "ON"
	SET TALK ON
ENDIF
IF m.compstat = "ON"
	SET COMPATIBLE ON
ENDIF


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º               SVD0510/MS-DOS Cleanup Code               º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 1
DO ULfecha
RETURN




*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º   SVD0510/MS-DOS Supporting Procedures and Functions    º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 1
PROCEDURE ULfecha
	SELE orcament
	UNLOCK

    =UP_FECHA("usuario"   ,LFusuario)
    =UP_FECHA("orcament"  ,LForcament)
	=UP_fecha("clienc"    ,LFclienc)
	=UP_fecha("tab001"    ,LFtab001)
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
	ON KEY LABEL ESCAPE
	SET FORMAT TO
	************************************
	POP KEY 			&& reabilita teclas de atalho def. anteriormente
RETURN

PROCEDURE ULpos_ok
 	_CUROBJ = OBJNUM(ok_btn)
RETURN(.T.)

PROCEDURE ULpos_canc
 	_CUROBJ = OBJNUM(cft_btn)
RETURN(.T.)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0WIFSP           m.operador VALID                   º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SVD0510,     Record Number:   21   º
*       º Variable:            m.operador                         º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Field                              º
*       º Snippet Number:      1                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0wifsp     &&  m.operador VALID
#REGION 1
SELECT usuario
SET ORDER TO TAG usuario
IF LASTKEY() = 9
   ON KEY LABEL ESCAPE
   DO loc_dlog WITH .T.
   ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
   IF LASTKEY =  27
		SELECT orcament
		RETURN .F.
	ENDIF
ELSE
	IF !SEEK(m.operador)
		SELECT orcament
		RETURN .F.
	ENDIF
ENDIF
SELECT orcament
m.nome_vend = usuario.nome
SHOW GET m.nome_vend
RETURN .T.


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0WIFUD           ok_btn WHEN                        º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SVD0510,     Record Number:   28   º
*       º Variable:            ok_btn                             º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      2                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0wifud     &&  ok_btn WHEN
#REGION 1
ON KEY LABEL ENTER
ON KEY LABEL TAB


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0WIFUG           ok_btn VALID                       º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SVD0510,     Record Number:   28   º
*       º Variable:            ok_btn                             º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      3                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
	*---------------------------------------------------------------*
	*     Complementa‡Æo de Dados Derivados
	*---------------------------------------------------------------*
	*---------------------------------------------------------------*
FUNCTION _2lx0wifug     &&  ok_btn VALID
#REGION 1
	SELE ORCAMENT
	SET ORDER TO TAG GERAL
	SEEK STR(LNemp,3)+STR(LNorca,6)
	IF FOUND()		
		=REGLOCK(.T.)
		***************************
		SET FIELDS TO dtregis, hregis, usrregis,deletado
	    SET FIELDS TO operador,nota,dt_fat,situacao 	
		=edithand('REGRAVA')
		CLEAR FIELDS
		SET FIELDS OFF
		***************************
	ENDIF
	isediting = .f.
	*----------------------------------------------------------*
	clear read
	clear gets
RETURN


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0WIFUJ           cft_btn WHEN                       º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SVD0510,     Record Number:   29   º
*       º Variable:            cft_btn                            º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      4                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0wifuj     &&  cft_btn WHEN
#REGION 1
ON KEY LABEL ENTER
ON KEY LABEL TAB


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0WIFUM           cft_btn VALID                      º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SVD0510,     Record Number:   29   º
*       º Variable:            cft_btn                            º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      5                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0wifum     &&  cft_btn VALID
#REGION 1
clear read
clear gets
RETUR

*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0WIFUP           Read Level Show                    º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SVD0510                            º
*       º Called By:           READ Statement                     º
*       º Snippet Number:      6                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0wifup     && Read Level Show
PRIVATE currwind
STORE WOUTPUT() TO currwind
*
* Show Code from screen: SVD0510
*
#REGION 1
	IF (LEFT(orcament.situacao,1) $ "OZYo") AND !lMaster
		isediting = .f.
		SHOW GET m.ok_btn disable
	ENDIF
IF NOT EMPTY(currwind)
	ACTIVATE WINDOW (currwind) SAME
ENDIF