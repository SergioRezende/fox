*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º 03/19/09            OBJ_ITOR.SPR               15:07:56 º
*       º                                                         º
*       ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
*       º                                                         º
*       º Author's Name                                           º
*       º                                                         º
*       º Copyright (c) 2009 Company Name                         º
*       º Address                                                 º
*       º City,     Zip                                           º
*       º                                                         º
*       º Description:                                            º
*       º This program was automatically generated by GENSCRN.    º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º         OBJ_ITOR/MS-DOS Setup Code - SECTION 1          º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 1


*---------------------------------------------------------------*
* OPERA ARQUIVOS :   (obs: ARQ. PASSADOS ABERTOS
*			ORCATMP
*           TIPOOPER
* OBJETIVO:  PROGRAMA PRINCIPAL PARA EDICAO DE ITENS RELACIONADOS
*			 ORCAMENTO,TRANSFERENCIA, DEVOL, REQUIS, REMESS,...
*---------------------------------------------------------------*
PUSH KEY CLEAR		&& desabilita teclas de atalho def. anteriormente
ON KEY LABEL F1		DO HLP2000.SPR WITH  POPUP(),PROMPT(),PROGRAM(),;
							WONTOP(),VARREAD()

PRIVATE wzalias,wl_areant,LForcfecha,wp_flgfecha,isediting
PRIVATE LFjanela,LNobjeto,LSposcampo,LFpaslin,Flend,LScodant
PRIVATE LNqtdant,LNdscant,LTIPO_SEG
*--
PRIVATE LNnumpgt,LNnumparc,LNentrada,LNparcela,LNaprazo,LNavista
PRIVATE DLNaprazo,DLNavista,LNsomret,LNsomipi



*--------------------------  variaveis -------------------------*

ON KEY LABEL ESCAPE
PRIVATE wzalias
m.wzalias=SELECT()

wl_areant 		= ALLTRIM(ALIAS()) && PERMITE RET A AREA ANTER. A CHAMADA
LForcfecha		= .F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
wp_flgfecha 	= .F. 		&& defaut nao fechamento da secao
isediting 		= .T.   	&& PERMITIR A EDICAO DOS CAMPOS OBJ_PRSO

LFjanela    	= 1 		&& FLAG PARA CONTROLAR AS JANELAS
LNobjeto    	= 1			&& permite voltar em scgc240a no mesmo obj ant
LSposcampo     	= "CODIGO"	&& imdica o campo posicionado
LFpaslin   		= .f.       && .t. indica que houve ped de mudanca de linha
							&& em passalin
m.Flend    		= .f.  		&& coodena o pedido de alteracao de endereco
LScodant   		= ""		&& utilizado para retornar o codigo anterior
							&& quando nao for permitido a alteracao do mesmo
							&& mas a validacao tenha que ser verdadeira	
LNqtdant   		= ""		&& utilizado para retornar o evitar calculo
							&& quando nao for alterada a qtde, para nao
							&& influenciar arrendondament feito por vendedor
LNdscant   		= ""		&& utilizado para retornar o evitar calculo
							&& quando nao for alterado o desconto, para nao
							&& influenciar arrendondament feito por vendedor

LTIPO_SEG		= ORCAMENT.TIPO	&& ACEGURA ENC. DOS ITES CASO TIPO SEJA ALT

*--------------- variaveis da janela obj_vlro ---------------*

LNnumpgt  	= 0	&& variaveis da obj_vlro
LNnumparc 	= 0
LNentrada 	= 0
LNparcela 	= 0
LNaprazo  	= 0
LNavista  	= 0
DLNaprazo  	= 0
DLNavista  	= 0
LNsomret  	= 0
LNsomipi  	= 0

SELE orcament
SCATTER MEMVAR

*--------------------- fim definicao variaveis ----------------------*

CLEAR TYPEAHEAD


SELE usuario
SET ORDER TO TAG usuario
SEEK m.operador
LNnivelusr = usuario.nivel_com		&& permite tratar desconto maximo
***************
SELE clientes
SET ORDER TO TAG cliente
SEEK m.cliente


******>>>> INICIO CONTROLE ARQUIVOS
SELE orcatmp
wl_arqtmp = ""
LNtmp     = 65		&& TABELA ASCII A = 65
IF !UPabretmp("orc")
	wp_flgfecha = .t.
ENDIF
IF wp_flgfecha
	DO ULfecha
	POP KEY 			&& reabilita teclas de atalho def. anteriormente

	RETURN
ENDIF

******>>>> INICIO CONTROLE LOCAL


#REGION 0
REGIONAL m.currarea, m.talkstat, m.compstat

IF SET("TALK") = "ON"
	SET TALK OFF
	m.talkstat = "ON"
ELSE
	m.talkstat = "OFF"
ENDIF
m.compstat = SET("COMPATIBLE")
SET COMPATIBLE FOXPLUS

*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º                MS-DOS Window definitions                º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

IF NOT WEXIST("obj_cad") ;
	OR UPPER(WTITLE("OBJ_CAD")) == "OBJ_CAD.PJX" ;
	OR UPPER(WTITLE("OBJ_CAD")) == "OBJ_CAD.SCX" ;
	OR UPPER(WTITLE("OBJ_CAD")) == "OBJ_CAD.MNX" ;
	OR UPPER(WTITLE("OBJ_CAD")) == "OBJ_CAD.PRG" ;
	OR UPPER(WTITLE("OBJ_CAD")) == "OBJ_CAD.FRX" ;
	OR UPPER(WTITLE("OBJ_CAD")) == "OBJ_CAD.QPR"
	DEFINE WINDOW obj_cad ;
		FROM 1, 1 ;
		TO 9,78 ;
		TITLE "[ ]" ;
		FOOTER "[OBJ_CAD]" ;
		NOFLOAT ;
		NOCLOSE ;
		NOMINIMIZE ;
		NONE ;
		COLOR SCHEME 1
ENDIF

IF NOT WEXIST("obj_prso") ;
	OR UPPER(WTITLE("OBJ_PRSO")) == "OBJ_PRSO.PJX" ;
	OR UPPER(WTITLE("OBJ_PRSO")) == "OBJ_PRSO.SCX" ;
	OR UPPER(WTITLE("OBJ_PRSO")) == "OBJ_PRSO.MNX" ;
	OR UPPER(WTITLE("OBJ_PRSO")) == "OBJ_PRSO.PRG" ;
	OR UPPER(WTITLE("OBJ_PRSO")) == "OBJ_PRSO.FRX" ;
	OR UPPER(WTITLE("OBJ_PRSO")) == "OBJ_PRSO.QPR"
	DEFINE WINDOW obj_prso ;
		FROM 1, 1 ;
		TO 9,78 ;
		TITLE "[ ]" ;
		FOOTER "[OBJ_PRSO]" ;
		NOFLOAT ;
		NOCLOSE ;
		NOMINIMIZE ;
		NONE ;
		COLOR SCHEME 1
ENDIF

IF NOT WEXIST("item") ;
	OR UPPER(WTITLE("ITEM")) == "ITEM.PJX" ;
	OR UPPER(WTITLE("ITEM")) == "ITEM.SCX" ;
	OR UPPER(WTITLE("ITEM")) == "ITEM.MNX" ;
	OR UPPER(WTITLE("ITEM")) == "ITEM.PRG" ;
	OR UPPER(WTITLE("ITEM")) == "ITEM.FRX" ;
	OR UPPER(WTITLE("ITEM")) == "ITEM.QPR"
	DEFINE WINDOW item ;
		FROM 11, 0 ;
		TO 19,79 ;
		TITLE " " ;
		FOOTER "ITEM" ;
		FLOAT ;
		NOCLOSE ;
		NOMINIMIZE ;
		NONE ;
		COLOR SCHEME 1
ENDIF

IF NOT WEXIST("obj_vlro") ;
	OR UPPER(WTITLE("OBJ_VLRO")) == "OBJ_VLRO.PJX" ;
	OR UPPER(WTITLE("OBJ_VLRO")) == "OBJ_VLRO.SCX" ;
	OR UPPER(WTITLE("OBJ_VLRO")) == "OBJ_VLRO.MNX" ;
	OR UPPER(WTITLE("OBJ_VLRO")) == "OBJ_VLRO.PRG" ;
	OR UPPER(WTITLE("OBJ_VLRO")) == "OBJ_VLRO.FRX" ;
	OR UPPER(WTITLE("OBJ_VLRO")) == "OBJ_VLRO.QPR"
	DEFINE WINDOW obj_vlro ;
		FROM 22, 1 ;
		TO 24,78 ;
		TITLE "[ ]" ;
		FOOTER "[OBJ_VLRO]" ;
		NOFLOAT ;
		NOCLOSE ;
		NOMINIMIZE ;
		NONE ;
		COLOR SCHEME 1
ENDIF


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º         OBJ_ITOR/MS-DOS Setup Code - SECTION 2          º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 1

SELECT  orcatmp
SET ORDER TO TAG orcamento
SET NEAR ON
SEEK STR(wp_empresa,3)+LEFT(m.tipo,1)+STR(m.orcamento,6)
SET NEAR OFF
***
SET SAFET OFF
LStmp = "\TMP\"+"&wl_arqtmp"
COPY TO &LStmp WHILE m.orcamento    = orcatmp.orcamento AND ;
					 wp_empresa     = orcatmp.empresa    AND ;
					 LEFT(m.tipo,1) = LEFT(tipo,1)

SELE 0
USE "\TMP\"+"&wl_arqtmp" exclu
INDEX ON orcamento TAG orcamento ADDITIVE
IF EOF() AND BOF()
	m.aliq_icms =   tipooper.aliq_icms
	m.aliq_ipi  =   0
ELSE
	m.aliq_icms =   &wl_arqtmp .aliq_icms
	m.aliq_ipi  =   &wl_arqtmp .aliq_ipi
ENDIF
DO brappend
GO TOP
DO ULdefprz

DO WHILE !EOF()
	=ULsomvalor()
	SKIP
ENDDO
GO TOP


ON KEY LABEL CTRL-I

LFjanela = 2
DO ULvpar
CLEAR TYPEAHEAD

SET SYSMENU ON
PUSH MENU _MSYSMENU
SET SYSMENU TO _MWINDOW, _MWI_ZOOM,_MWI_MOVE, _MEDIT, _MED_FIND, ;
						_MED_FINDA
HIDE MENU _MSYSMENU
*---
ON KEY LABEL F10    KEYBOARD "{CTRL-F10}"


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º              OBJ_ITOR/MS-DOS Screen Layout              º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 1
IF WVISIBLE("obj_cad")
	ACTIVATE WINDOW obj_cad SAME
ELSE
	ACTIVATE WINDOW obj_cad NOSHOW
ENDIF
@ 1,21 SAY "-" ;
	SIZE 1,1, 0
@ 0,0 TO 2,59 ;
	COLOR SCHEME 23
@ 2,1 TO 2,58 ;
	COLOR SCHEME 24
@ 2,59 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,59 SAY "³" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 0,59 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 3,0 TO 5,77 ;
	COLOR SCHEME 23
@ 5,1 TO 5,76 ;
	COLOR SCHEME 24
@ 5,77 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 4,77 SAY "³" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 3,77 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 6,0 TO 8,77 ;
	COLOR SCHEME 23
@ 8,1 TO 8,76 ;
	COLOR SCHEME 24
@ 8,77 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 7,77 SAY "³" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 6,77 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 6,61 SAY "[Nro.Inscricao]" ;
	SIZE 1,15, 0
@ 6,2 SAY "[UF]" ;
	SIZE 1,4, 0
@ 6,10 SAY "[C.E.P]" ;
	SIZE 1,7, 0
@ 3,68 SAY "[Cidade]" ;
	SIZE 1,8, 0
@ 3,32 SAY "[Endereco]" ;
	SIZE 1,10, 0
@ 3,53 SAY "[Setor]" ;
	SIZE 1,7, 0
@ 7,48 SAY "-" ;
	SIZE 1,1, 0
@ 6,23 SAY "[Fone]" ;
	SIZE 1,6, 0
@ 6,48 SAY "[Tp.Inscr]" ;
	SIZE 1,10, 0
@ 0,1 SAY "[CGC/CPF]" ;
	SIZE 1,9, 0
@ 0,22 SAY "[Nome]" ;
	SIZE 1,6, 0
@ 3,2 SAY "[Veiculo]" ;
	SIZE 1,9, 0
@ 3,13 SAY "[Placa]" ;
	SIZE 1,7, 0
@ 3,21 SAY "[Hodom]" ;
	SIZE 1,7, 0
@ 6,36 SAY "[Natureza]" ;
	SIZE 1,10, 0
@ 7,37 SAY "-" ;
	SIZE 1,1, 0
@ 1,1 GET m.cliente ;
	SIZE 1,20 ;
	DEFAULT 0 ;
	PICTURE "@K 99999999999999" ;
	WHEN _2lx0wfmig() ;
	VALID _2lx0wfmii() ;
	ERROR _2lx0wfmin()
@ 1,1 GET m.cgccliente ;
	SIZE 1,20 ;
	DEFAULT " " ;
	PICTURE "@R 99.999.999/9999-99" ;
	WHEN .f.
@ 1,22 GET m.nome ;
	SIZE 1,37 ;
	DEFAULT " " ;
	PICTURE "@K" ;
	WHEN _2lx0wfmip()
@ 0,38 GET m.Flend ;
	PICTURE "@*C Altera Endereco" ;
	SIZE 1,19 ;
	DEFAULT 0 ;
	WHEN _2lx0wfmit() ;
	VALID _2lx0wfmiv()
@ 0,61 GET m.tp_transp ;
	PICTURE "@^ \<Montar;\<Transp.Cliente;\<Transp.Pneulandia;\<Transportadora" ;
	SIZE 3,17 ;
	DEFAULT "Montar" ;
	WHEN _2lx0wfmj0() ;
	COLOR SCHEME 1, 2
@ 4,1 GET m.veiculo ;
	SIZE 1,11 ;
	DEFAULT " " ;
	PICTURE "@K" ;
	WHEN _2lx0wfmj2()
@ 4,13 GET m.placa ;
	SIZE 1,7 ;
	DEFAULT " " ;
	PICTURE "@K" ;
	WHEN isediting AND LFjanela = 1
@ 4,21 GET m.hodom ;
	SIZE 1,6 ;
	DEFAULT 0 ;
	PICTURE "@K" ;
	WHEN isediting AND LFjanela = 1
@ 4,28 GET m.endereco ;
	SIZE 1,20 ;
	DEFAULT " " ;
	PICTURE "@K" ;
	WHEN isediting AND LFjanela = 1 AND (!FOUND("CLIENTES") OR m.cliente = 0)
@ 4,49 GET m.bairro ;
	SIZE 1,17 ;
	DEFAULT " " ;
	PICTURE "@!K" ;
	WHEN isediting AND LFjanela = 1 AND (!FOUND("CLIENTES") OR m.cliente = 0)
@ 4,67 GET m.cidade ;
	SIZE 1,10 ;
	DEFAULT " " ;
	PICTURE "@!K" ;
	WHEN isediting AND LFjanela = 1 AND (!FOUND("CLIENTES") OR m.cliente = 0)
@ 7,3 GET m.estado ;
	SIZE 1,2 ;
	DEFAULT " " ;
	PICTURE "@!K XX" ;
	WHEN isediting AND LFjanela = 1 AND (!FOUND("CLIENTES") OR m.cliente = 0) ;
	VALID m.estado $ wp_estado ;
	ERROR 'Sigla Nao identificada'
@ 7,9 GET m.cep ;
	SIZE 1,9 ;
	DEFAULT " " ;
	PICTURE "@K 99999-999" ;
	WHEN isediting AND LFjanela = 1 AND (!FOUND("CLIENTES") OR m.cliente = 0)
@ 7,20 GET m.fone ;
	SIZE 1,14 ;
	DEFAULT " " ;
	PICTURE "@K (999)-999-9999" ;
	WHEN isediting AND LFjanela = 1
@ 7,36 GET m.natu_cli ;
	SIZE 1,1 ;
	DEFAULT 0 ;
	PICTURE "@K 9" ;
	WHEN _2lx0wfmj3() ;
	VALID _2lx0wfmj9()
@ 7,38 GET m.nome_natu ;
	SIZE 1,8 ;
	DEFAULT " " ;
	WHEN .f.
@ 7,47 GET m.tp_inscr ;
	SIZE 1,1 ;
	DEFAULT 0 ;
	PICTURE "@K 9" ;
	WHEN _2lx0wfmjd() ;
	VALID _2lx0wfmjh()
@ 7,49 GET m.nome_inscr ;
	SIZE 1,10 ;
	DEFAULT " " ;
	WHEN .f.
@ 7,61 GET m.inscricao ;
	SIZE 1,16 ;
	DEFAULT " " ;
	PICTURE "@K XXXXXXXXXXXXXXXXXX" ;
	WHEN isediting AND LFjanela = 1 AND (!FOUND("CLIENTES") OR m.cliente = 0) ;
	VALID _2lx0wfmjk()




*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º              OBJ_PRSO/MS-DOS Screen Layout              º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 2
IF WVISIBLE("obj_prso")
	ACTIVATE WINDOW obj_prso SAME
ELSE
	ACTIVATE WINDOW obj_prso NOSHOW
ENDIF
@ 1,23 SAY "-" ;
	SIZE 1,1, 0
@ 0,1 TO 2,56 ;
	COLOR SCHEME 23
@ 2,2 TO 2,55 ;
	COLOR SCHEME 24
@ 2,56 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,56 SAY "³" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 0,56 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 0,2 SAY "[Cliente]" ;
	SIZE 1,9, 0
@ 3,1 TO 5,76 ;
	COLOR SCHEME 23
@ 5,2 TO 5,75 ;
	COLOR SCHEME 24
@ 5,76 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 4,76 SAY "³" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 3,76 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 3,4 SAY "[Vlr.Fecha]" ;
	SIZE 1,11, 0
@ 6,35 TO 8,74 ;
	COLOR SCHEME 23
@ 8,36 TO 8,73 ;
	COLOR SCHEME 24
@ 8,74 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 7,74 SAY "³" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 6,74 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 4,25 SAY "-" ;
	SIZE 1,1, 0
@ 3,23 SAY "[Tipo Pgto]" ;
	SIZE 1,11, 0
@ 4,49 SAY "-" ;
	SIZE 1,1, 0
@ 3,47 SAY "[Condicao Pg]" ;
	SIZE 1,13, 0
@ 4,73 SAY "%" ;
	SIZE 1,1, 0
@ 3,67 SAY "[Juros]" ;
	SIZE 1,7, 0
@ 0,57 TO 2,66 ;
	COLOR SCHEME 23
@ 2,58 TO 2,65 ;
	COLOR SCHEME 24
@ 2,66 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,66 SAY "³" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 0,66 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 0,58 SAY "[ICMS %]" ;
	SIZE 1,8, 0
@ 0,67 TO 2,76 ;
	COLOR SCHEME 23
@ 2,68 TO 2,75 ;
	COLOR SCHEME 24
@ 2,76 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,76 SAY "³" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 0,76 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 0,68 SAY "[IPI %]" ;
	SIZE 1,7, 0
@ 6,55 SAY "[Frete]" ;
	SIZE 1,7, 0
@ 6,65 SAY "[Seguro]" ;
	SIZE 1,8, 0
@ 6,1 TO 8,34 ;
	COLOR SCHEME 23
@ 8,2 TO 8,33 ;
	COLOR SCHEME 24
@ 8,34 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 7,34 SAY "³" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 6,34 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 6,12 SAY "[Parcelas]" ;
	SIZE 1,10, 0
@ 1,3 GET m.cliente ;
	SIZE 1,20 ;
	DEFAULT 0 ;
	PICTURE "@K 99999999999999" ;
	WHEN .f. ;
	VALID _2lx0wfmjt() ;
	ERROR wp_msg
@ 1,3 GET m.cgccliente ;
	SIZE 1,20 ;
	DEFAULT " " ;
	PICTURE "@R 99.999.999/9999-99" ;
	WHEN .f.
@ 1,24 GET m.nome ;
	SIZE 1,32 ;
	DEFAULT " " ;
	PICTURE "@K " ;
	WHEN .f.
@ 1,59 GET m.aliq_icms ;
	SIZE 1,5 ;
	DEFAULT 0 ;
	PICTURE "@KZ 99.99" ;
	WHEN isediting AND LFjanela = 2 AND (tipooper.info_icms = "S")
@ 1,69 GET m.aliq_ipi ;
	SIZE 1,5 ;
	DEFAULT 0 ;
	PICTURE "@KZ 99.99" ;
	WHEN isediting AND LFjanela = 2 and m.ch_opera = "4"
@ 4,5 GET m.fecha ;
	SIZE 1,10 ;
	DEFAULT " " ;
	PICTURE "@K 999,999.99" ;
	WHEN _2lx0wfmjy()
@ 4,23 GET m.forma_pgto ;
	SIZE 1,2 ;
	DEFAULT 0 ;
	PICTURE "@K 99" ;
	WHEN _2lx0wfmk1() ;
	VALID _2lx0wfmk3() ;
	ERROR WP_MSG
@ 4,26 GET m.nome_forma ;
	SIZE 1,9 ;
	DEFAULT " " ;
	WHEN .f.
@ 4,47 GET m.tp_pgto ;
	SIZE 1,2 ;
	DEFAULT " " ;
	PICTURE "@K" ;
	WHEN _2lx0wfmk8() ;
	VALID _2lx0wfmkc()
@ 4,50 GET tppgto.descricao ;
	SIZE 1,9 ;
	DEFAULT " " ;
	WHEN .F.
@ 4,68 GET m.juromes ;
	SIZE 1,5 ;
	DEFAULT 0 ;
	PICTURE "@KZ 99.99" ;
	WHEN isediting AND LFjanela = 2   AND (m.forma_pgto = 2 OR m.forma_pgto = 3 OR m.forma_pgto = 4) AND WEXIST('SCGC201') ;
	VALID _2lx0wfmkg()
@ 7,2 GET m.dt ;
	SIZE 1,10 ;
	DEFAULT {  /  /  } ;
	PICTURE "@K" ;
	WHEN _2lx0wfmkj() ;
	VALID _2lx0wfmkm() ;
	ERROR wp_msg
@ 7,14 GET LGTD1 ;
	SIZE 1,3 ;
	DEFAULT 0 ;
	PICTURE "@K 999" ;
	WHEN _2lx0wfmkn() ;
	VALID _2lx0wfmks() ;
	ERROR wp_msg
@ 7,18 GET LGTD2 ;
	SIZE 1,3 ;
	DEFAULT 0 ;
	PICTURE "@K 999" ;
	WHEN _2lx0wfmkv() ;
	VALID _2lx0wfmky() ;
	ERROR wp_msg
@ 7,22 GET LGTD3 ;
	SIZE 1,3 ;
	DEFAULT 0 ;
	PICTURE "@K 999" ;
	WHEN _2lx0wfml1() ;
	VALID _2lx0wfml3() ;
	ERROR wp_msg
@ 7,26 GET LGTD4 ;
	SIZE 1,3 ;
	DEFAULT 0 ;
	PICTURE "@K 999" ;
	WHEN _2lx0wfml7() ;
	VALID _2lx0wfml9() ;
	ERROR wp_msg
@ 7,30 GET LGTD5 ;
	SIZE 1,3 ;
	DEFAULT 0 ;
	PICTURE "@K 999" ;
	WHEN _2lx0wfmlc() ;
	VALID _2lx0wfmlf() ;
	ERROR wp_msg
@ 7,37 GET m.vlr_ent ;
	SIZE 1,12 ;
	DEFAULT " " ;
	PICTURE "@K 9,999,999.99" ;
	WHEN _2lx0wfmli() ;
	VALID _2lx0wfmlk()
@ 7,52 GET m.vlrfrete ;
	SIZE 1,10 ;
	DEFAULT 0 ;
	PICTURE "@K 999,999.99" ;
	WHEN isediting AND LFjanela = 2 ;
	VALID _2lx0wfmlo()
@ 7,64 GET m.vlrseguro ;
	SIZE 1,10 ;
	DEFAULT 0 ;
	PICTURE "@K 999,999.99" ;
	WHEN isediting AND LFjanela = 2 ;
	VALID _2lx0wfmlq()
@ 7,14 GET m.prazo ;
	SIZE 1,20 ;
	DEFAULT " " ;
	PICTURE "999/999/999/999/999/" ;
	WHEN _2lx0wfmlt() ;
	VALID _2lx0wfmlw() ;
	ERROR wp_msg
@ 6,37 SAY "[Entrada.R$]" ;
	SIZE 1,12, 0




*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º                ITEM/MS-DOS Screen Layout                º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 3
IF WVISIBLE("item")
	ACTIVATE WINDOW item SAME
ELSE
	ACTIVATE WINDOW item NOSHOW
ENDIF
@ 1,2 GET GET_1ITEM ;
	SIZE 1,1 ;
	DEFAULT " " ;
	WHEN _2lx0wfmm0()




*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º              OBJ_VLRO/MS-DOS Screen Layout              º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 4
IF WVISIBLE("obj_vlro")
	ACTIVATE WINDOW obj_vlro SAME
ELSE
	ACTIVATE WINDOW obj_vlro NOSHOW
ENDIF
@ 0,0 TO 2,11 ;
	COLOR SCHEME 23
@ 2,1 TO 2,10 ;
	COLOR SCHEME 24
@ 2,11 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,11 SAY "³" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 0,11 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,1 GET DLNavista ;
	SIZE 1,10 ;
	DEFAULT " " ;
	PICTURE "@K 999,999.99" ;
	WHEN .f.
@ 0,12 TO 2,23 ;
	COLOR SCHEME 23
@ 2,13 TO 2,22 ;
	COLOR SCHEME 24
@ 2,23 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,23 SAY "³" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 0,23 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,13 GET DLNaprazo ;
	SIZE 1,10 ;
	DEFAULT " " ;
	PICTURE "@K 999,999.99" ;
	WHEN .f.
@ 0,57 TO 2,66 ;
	COLOR SCHEME 23
@ 2,58 TO 2,65 ;
	COLOR SCHEME 24
@ 2,66 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,66 SAY "³" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 0,66 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,59 GET orcament.prazomedio ;
	SIZE 1,3 ;
	DEFAULT " " ;
	PICTURE "@K 999" ;
	WHEN .f.
@ 1,62 SAY "Dias" ;
	SIZE 1,4, 0
@ 0,67 TO 2,77 ;
	COLOR SCHEME 23
@ 2,68 TO 2,76 ;
	COLOR SCHEME 24
@ 2,77 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,77 SAY "³" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 0,77 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,69 GET orcament.taxa ;
	SIZE 1,5 ;
	DEFAULT " " ;
	PICTURE "@K 99.99" ;
	WHEN .f.
@ 1,75 SAY "%" ;
	SIZE 1,1, 0
@ 0,26 TO 2,42 ;
	COLOR SCHEME 23
@ 2,27 TO 2,41 ;
	COLOR SCHEME 24
@ 2,42 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,42 SAY "³" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 0,42 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,32 GET LNparcela ;
	SIZE 1,10 ;
	DEFAULT 0 ;
	PICTURE "999,999.99" ;
	WHEN .f.
@ 0,28 SAY "[ Parcela ]" ;
	SIZE 1,11, 0
@ 1,29 GET LNnumparc ;
	SIZE 1,2 ;
	DEFAULT 0 ;
	PICTURE "99" ;
	WHEN .f.
@ 1,31 SAY "x" ;
	SIZE 1,1, 0
@ 1,28 SAY "+" ;
	SIZE 1,1, 0
@ 1,27 GET LNentrada ;
	SIZE 1,1 ;
	DEFAULT 0 ;
	PICTURE "9" ;
	WHEN .f.
@ 0,13 SAY "[A Prazo]" ;
	SIZE 1,9, 0
@ 0,1 SAY "[A Vista]" ;
	SIZE 1,9, 0
@ 0,58 SAY "[Prz.Md]" ;
	SIZE 1,8, 0
@ 0,68 SAY "[Tx.Real]" ;
	SIZE 1,9, 0
@ 1,45 GET DLNbonusDisponivel ;
	SIZE 1,10 ;
	DEFAULT " " ;
	PICTURE "@K 999,999.99" ;
	WHEN .f.
@ 0,44 TO 2,56 ;
	COLOR SCHEME 23
@ 0,56 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 0,45 SAY "[Bns.Serv]" ;
	SIZE 1,10, 0
@ 1,56 SAY "³" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 2,56 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 2,45 TO 2,55 ;
	COLOR SCHEME 24

IF NOT WVISIBLE("obj_vlro")
	ACTIVATE WINDOW obj_vlro
ENDIF
IF NOT WVISIBLE("item")
	ACTIVATE WINDOW item
ENDIF
IF NOT WVISIBLE("obj_prso")
	ACTIVATE WINDOW obj_prso
ENDIF
IF NOT WVISIBLE("obj_cad")
	ACTIVATE WINDOW obj_cad
ENDIF


READ CYCLE ;
	ACTIVATE LFjanela = 1 ;
	DEACTIVATE !isediting

RELEASE WINDOW item
RELEASE WINDOW obj_cad
RELEASE WINDOW obj_prso
RELEASE WINDOW obj_vlro

#REGION 0
IF m.talkstat = "ON"
	SET TALK ON
ENDIF
IF m.compstat = "ON"
	SET COMPATIBLE ON
ENDIF


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º              OBJ_ITOR/MS-DOS Cleanup Code               º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 1

POP MENU _MSYSMENU
SET SYSMENU OFF
******
isediting = .F.   && INIBIE A EDICAO DOS CAMPOS OBJ_PRSO
******
RELEASE WINDOW ITEM
SET POINT TO ","
SET SEPARATOR  TO "."
SET FORMAT TO
#DEFINE C_ABORTA      'Deseja Gravar as Alteracoes ?.'
IF LEFT(m.situacao,1) $ "OZo") or wp_flgfecha
	DO ULfecha
	POP KEY 			&& reabilita teclas de atalho def. anteriormente
   	RETURN
ENDIF
IF LASTKEY() = 27
	DO ULfecha
	POP KEY 			&& reabilita teclas de atalho def. anteriormente
   	RETURN
ENDIF
LFflgtrans = .t.
LFnovitem   = .f.			&& informara se existe item em aberto
************************************
=UPtransacao("INICIAR")
************************************
SELECT &wl_arqtmp
SET ORDER TO
GO TOP
DO WHILE !EOF()
	IF EMPTY(ALLTRIM(&wl_arqtmp .codigo))  OR !ULsaldgrv()
		SKIP
	ELSE
		EXIT
	ENDIF
ENDDO
wl_oper = " "
IF EOF()
   wl_oper = "D"           && NAO EXISTEM REG. P/ LANCAR -> DELETAR
ELSE
	IF LEFT(&wl_arqtmp .situacao,1) $ "AyEe" && <A>=item novo <y>= item Canc
		LFnovitem = .t.						&& <E>=Reserva Alterada
											&& <e>=Reserva apagada
	ENDIF
	SCATTER MEMVAR MEMO   && SO CARREGA MEMORIA QDO. EXISTE REGISTRO
ENDIF
SELECT orcament
SCATTER MEMVAR FIELDS empresa,tipo,orcamento
SELECT orcatmp
SET ORDER TO TAG orcamento

** CASO DE VOLTA SUBSTITUA  << LTIPO_SEG POR m.tipo >> 06/01/97
SET NEAR ON
SEEK STR(wp_empresa,3)+LEFT(LTIPO_SEG,1)+STR(m.orcamento,6)
SET NEAR OFF
IF wl_oper <> "D"
   IF !EOF() AND wp_empresa 	= orcatmp.empresa;
			 AND LEFT(LTIPO_SEG,1)	= LEFT(orcatmp.tipo,1) ;
   			 AND m.orcamento 	= orcatmp.orcamento
      wl_oper   = "A"      && ALTERAR O REGISTRO
   ELSE
      wl_oper   = "I"      && INCLUIR REGISTROS
   ENDIF
ENDIF
IF !FOUND() AND wl_oper = "D"
   wl_flg = .F.
ELSE
   wl_flg = .T.
ENDIF
wp_record = RECNO()
LNordem  = 0   &&  p/ diferenciar codigo com + de um movimento
DO WHILE wl_flg
   LNordem  = LNordem + 1
   m.ordem  = LNordem
   DO CASE
      CASE wl_oper = "A"
           IF !RLOCK()
              LOOP
           ENDIF
		   =edithand('REGRAVA')
      CASE wl_oper = "D"
           IF !RLOCK()
              LOOP
           ENDIF
		   =edithand('APAGA')
           SKIP
           IF EOF() OR m.orcamento    <> orcatmp.orcamento ;
           			OR wp_empresa     <> orcatmp.empresa ;
           			OR LEFT(LTIPO_SEG,1) <> LEFT(orcatmp.tipo,1)
              EXIT
           ENDIF
           wp_record = RECNO()
		   LOOP
      CASE wl_oper = "I"
			=edithand('SAVE')
           wp_record = RECNO()
   ENDCASE
   SELECT &wl_arqtmp
   IF !EOF()
   		SKIP
		DO WHILE !EOF()
			IF EMPTY(ALLTRIM(&wl_arqtmp .codigo))  OR !ULsaldgrv()
				SKIP
			ELSE
				EXIT
			ENDIF
		ENDDO
   ENDIF
	IF LEFT(&wl_arqtmp .situacao,1) $ "AyEe" && <A>=item novo <y>= item Canc
		LFnovitem = .t.						&& <E>=Reserva Alterada
											&& <e>=Reserva apagada
   ENDIF
   IF EOF()
      wl_oper   = "D"      && DELETAR REG. SEGUINTES DO ORCAMENTO EM ARQTMP
   ELSE
      SCATTER MEMVAR
   ENDIF
   SELECT orcatmp
   GO wp_record
   SKIP
   wp_record = RECNO()
   IF (EOF() OR m.orcamento <> orcatmp.orcamento ;
           			OR wp_empresa     <> orcatmp.empresa ;
           			OR LEFT(LTIPO_SEG,1) <> LEFT(orcatmp.tipo,1));
           			AND wl_oper = "D"
      EXIT
   ENDIF
   IF (EOF() OR m.orcamento <> orcatmp.orcamento ;
         	 OR wp_empresa     <> orcatmp.empresa ;
         	 OR LEFT(LTIPO_SEG,1) <> LEFT(orcatmp.tipo,1));
			 AND wl_oper <> "D"
      wl_oper = "I"
   ENDIF
ENDDO
SELECT &wl_arqtmp
GO TOP
*-----------------------------------------------------------*
m.valor = BRTOTAL(.F.)
*-----------------------------------------------------------*

************************   AJUSTA SITUACAO DO ORCAMENTO  ******************
*
*  Sera considerado se houve inclusao ou cancelamento de um item  e se ja
* houve a impressao da osi => Neste caso o sistema deve notificar o ESTOQUE
*
***************************************************************************

SELE orcament
m.situacao =  orcament.situacao
IF LFnovitem 		&& FOI INCLUIDO NOVO ITEM ou (AINDA NAO VERIF.CANCELADO)
					&& ou ALTERADA UMA RESERVA
	DO CASE
		CASE LEFT(orcament.situacao,1) $ "IG"   && reserva integral
			m.situacao =  "G"+RIGHT(orcament.situacao,1)
	********  SE estive aguard. imp. OSI complementa ou OSI impressa itegral
		CASE LEFT(orcament.situacao,1) $ "FLM"
			m.situacao =  "F"+RIGHT(orcament.situacao,1)
	ENDCASE
	SET FIELDS TO situacao, dtregis, hregis, usrregis, deletado
	=edithand('REGRAVA')
	CLEAR FIELDS
	SET FIELDS OFF
ENDIF
IF m.valor <> orcament.valor
		SET FIELDS TO valor, dtregis, hregis, usrregis, deletado
		=edithand('REGRAVA')
		CLEAR FIELDS
		SET FIELDS OFF
ENDIF
************************************
DO ULfecha
************************************
=UPtransacao("TERMINAR")
************************************
POP KEY 			&& reabilita teclas de atalho def. anteriormente
RETURN

*************************************************************************


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º  OBJ_ITOR/MS-DOS Supporting Procedures and Functions    º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 1
PROCEDURE ULfecha
	=UP_fecha("&wl_arqtmp")
	wp_flgfecha = .F. 		&& defaut nao fechamento da secao
	IF !EMPTY(wl_areant)
		SELECT &wl_areant
	ENDIF
	ON KEY LABEL ESCAPE
	SET FORMAT TO
RETURN

*************************************************************************

FUNCTION ULversaida     && VERIFICA O INTERESSE DE SAIDA
	   CLEAR TYPEAHEAD
	   LCtmp = foxalert2('Confirma edicao e grava itens ?')
	   IF LCtmp = "S"
		   	IF m.vlr_ent > LNaprazo AND m.natu_oper = 1 && VENDAS
   				wp_msg = "Entrada Superior ao Valor Compra. <ENTER>"
				=UPbeeps(.F.,wp_msg)
				RETURN(.F.)
		   	endif
	        IF  ULcritc() && NAO FECHA QDO PELO VENDE
		  		IF EMPTY(ALLTRIM(orcament.nome)) OR ;
		  	 		EMPTY(orcament.tp_transp)
			 		LFjanela = 3
			 		DO ULvpar
			 		_CUROBJ = 1
			 		KEYBOARD CHR(27)
		  	 		RETURN(.T.)
		  		ENDIF
	  			******
	  	  		isediting = .F.   && INIBIE A EDICAO DOS CAMPOS SCGC240A
	  			******
	  	  		ON KEY LABEL ESCAPE
	      		KEYBOARD '{CTRL-W}'
		  		RETURN(.T.)
   	   		ELSE
		  		RETURN(.F.)
	   		ENDIF	   	  	
   		ELSE	
	   		IF LCtmp = "N"   && abandonar
		  		ON KEY LABEL ESCAPE
		  		KEYBOARD CHR(27)
	  	  		******
		  		isediting = .F.   && INIBIE A EDICAO DOS CAMPO OBJ_PRSO
		  		******
		  		RETURN(.T.)
	   		ENDIF
		ENDIF					
RETURN(.F.)

*************************************************************************
** FIM ROTINAS RELACIONADAS AO ENCERRAMENTO DA EDICAO E DO PROGRAMA
*************************************************************************

*************************************************************************
** INICIO ROTINAS RELACIONADAS A GRAVACAO TEMPORARIA/DELECAO...
*************************************************************************
PROCEDURE brappend
  IF LEFT(m.situacao,1) $ "OZo")
     WAIT WINDOW ;
     	" Orcamento esta Fechado. Nao pode ser alterado. <ESC> "
     RETURN
  ENDIF
  GO BOTT
  SELE &wl_arqtmp
  APPEND BLANK
  IF LEFT(m.tipo,1) = "V"
	  GATHER MEMVAR FIELDS EMPRESA, ORCAMENTO, DATA, HORA, SITUACAO,;
                       MOTIVO,TP_PGTO, PRAZOMEDIO, TAXA, ch_opera,;
                       ch_produ, ch_motiv, ch_desti, ch_contr, ch_condi,;
                       tipo, cfo, natu_cli MEMO
  ELSE
	  GATHER MEMVAR FIELDS EMPRESA, ORCAMENTO, DATA, HORA, SITUACAO,;
                       MOTIVO, ch_opera,;
                       ch_produ, ch_motiv, ch_desti, ch_contr, ch_condi,;
                       tipo, cfo, natu_cli MEMO
  ENDIF
  REPLACE FAVORECIDO WITH m.cliente
  REPLACE CODIGO     WITH SPACE(11)
  REPLACE situacao with "A "
RETURN

PROCEDURE brdeleta
  IF !(LEFT(&wl_arqtmp .situacao,1) $ "A")
	  IF (LEFT(&wl_arqtmp .situacao,1) $ "MIE")  && IMPRESSO EM OSI
		   LCtmp = foxalert2('Confirma Cancelamento do Item ?')
		   IF LCtmp = "S"
		   		=ULsubvalor()	&& anular efeito de valores no tatais

			    IF (LEFT(&wl_arqtmp .situacao,1) $ "M") && IMPRESSO EM OSI
					REPLACE &wl_arqtmp .situacao WITH "y" && y= CANCELANDO

				ELSE		&&  "IE" => COM RESERVAS
					REPLACE &wl_arqtmp .situacao WITH "e" && e= ELIMINAR
				ENDIF
				REPLACE &wl_arqtmp .descricao WITH ;
									"CANCELA***"+&wl_arqtmp .descricao
				RETURN
		   ENDIF
		   RETURN
	  ENDIF
	  WAIT WINDOW ;
      " Registro nao  pode ser apagado.  <ESC>"
      RETURN
  ENDIF
****    ANULA O EFEITO DO ITEM NO VALOR
	=ULsubvalor()	&& anular efeito de valores no tatais
   SELE &wl_arqtmp
   DELETE

   SHOW WINDOW ITEM TOP
   SHOW WINDOW ITENS REFRESH TOP
RETURN

PROCEDURE ULatrcampo

	*-------    VARIAVEIS SERAO REDEFINIDAS NESTA ROTINA  ----*
	STORE "" TO  m.codigo,m.descricao,m.classifica,m.unidade

	STORE 0  TO  m.tp_mercad,m.origem,m.iva,m.tp_pgto,m.prazomedio,;
				m.taxa

	STORE 0  TO m.aliq_icms,m.aliq_ipi, m.aliq_iss
	STORE "" TO m.movestq,m.movvalor,m.movcusto,;
 			m.cfo,m.info_icms,m.info_vlr,m.info_base,m.cst
	*---------------------------------------------------------*
	m.codigo    =  grupo.codigo
    IF !(m.tp_mercad = 5 OR m.tp_mercad = 6) ;
       AND LEFT(&wl_arqtmp .situacao,1) = "A"
		m.descricao  =  LTRIM(grupo.descricao)
	ELSE
		m.descricao  =  &wl_arqtmp .descricao
	ENDIF

	m.classifica =  grupo.classifica
	m.origem     =  grupo.origem
	m.unidade    =  grupo.unidade
	m.tp_pgto    =  orcament.tp_pgto
	m.prazomedio =  orcament.prazomedio
	m.taxa       =  orcament.taxa
	m.aliq_icms  =  orcament.aliq_icms	&& GERAL INFORMADA
	m.aliq_ipi   =  orcament.aliq_ipi	&& GERAL INFORMADA
	m.cst		 =  &wl_arqtmp .cst
	*----------------------------------------------------------*
	=W_DEFPROC("ORCAMENT.SPR")
	=ORdef_tribut((m.empresa),(m.codigo),(m.tipo),(orcament.orcamento),;
			m.aliq_icms,;
			m.aliq_ipi,m.aliq_iss,m.movestq,m.movvalor,m.movcusto,;
			m.cfo,m.info_icms,m.info_vlr,m.info_base,m.cst,m.tp_mercad,;
			m.iva)
	*----------------------------------------------------------*
	SELE &wl_arqtmp
	GATHER MEMVAR FIELDS codigo,tp_mercad,descricao,;
				classifica,origem,unidade,iva,tp_pgto,;
				prazomedio,taxa,;
				aliq_icms,aliq_ipi,aliq_iss,movestq,movvalor,movcusto,;
				cfo,info_icms,info_vlr,info_base,cst
	*----------------------------------------------------------*
    IF m.natu_oper = 2 && TRANSFERENCIAS
	   SELECT saldo
	   SET ORDER TO TAG clas_saldo
	   SEEK STR(wp_empresa,3)+&wl_arqtmp .classifica+;
    	    STR(YEAR(wp_dtoper),4)+STR(MONTH(wp_dtoper),2)
	   IF FOUND()
			IF sld_atu = 0
		        REPLACE &wl_arqtmp .preco WITH saldo.vlr_atu / 1
			else
		        REPLACE &wl_arqtmp .preco WITH saldo.vlr_atu / saldo.sld_atu
			ENDIF
			***************************************************************
			*	      TRANSFERENCIA INTERNA DE MERCADORIA COM RETENCAO    *
			*   ENTRA NO CALCULO DE INDICES ESPECIFICOS					  *
			***************************************************************
			IF m.ch_desti = "1"
				DO CASE
					CASE	&wl_arqtmp .tp_mercad = 1
				        REPLACE &wl_arqtmp .preco ;
					        WITH    &wl_arqtmp .preco / ;
			        		((100 -  &wl_arqtmp .aliq_icms) / 100)
					CASE	&wl_arqtmp .tp_mercad = 2
						************************************************
						*    Inicio de tratamento nao parametrizavel
						*	( ESPECIFICO)
						*	Para PNEUS Ind,Caminhao,Tratores,Agric,	
						*	Terrapl > "00448"  e < "00800"	
						************************************************
						IF LEFT(&wl_arqtmp .classifica,5) > "00448" AND ;
						   LEFT(&wl_arqtmp .classifica,5) < "00800"
						        REPLACE &wl_arqtmp .preco ;
							        WITH    &wl_arqtmp .preco * 1.24
						ELSE
						        REPLACE &wl_arqtmp .preco ;
							        WITH    &wl_arqtmp .preco * 1.26
						ENDIF				
					OTHERWISE
						REPLACE &wl_arqtmp .preco WITH &wl_arqtmp .preco
				ENDCASE
			ELSE
		        REPLACE &wl_arqtmp .preco ;
			        WITH    &wl_arqtmp .preco / ;
			        		((100 -  &wl_arqtmp .aliq_icms) / 100)
			ENDIF
			**************************************************************
			*    FIM de tratamento nao parametrizavel ( ESPECIFICO)
			**************************************************************
		    SELECT preco
    		SET ORDER TO TAG tabela
	    	IF SEEK(STR(wp_emptab,3)+STR(wp_tabela,3)+;
	    				wp_serie+&wl_arqtmp .codigo)
		       REPLACE &wl_arqtmp .clas_cms WITH  preco.clas_cms
			ENDIF
	   ENDIF
	ELSE
	    SELECT preco
    	SET ORDER TO TAG tabela
	    IF SEEK(STR(wp_emptab,3)+STR(wp_tabela,3)+;
	    		wp_serie+&wl_arqtmp .codigo)
	       REPLACE &wl_arqtmp .preco    WITH  preco.preco
	       REPLACE &wl_arqtmp .clas_cms WITH  preco.clas_cms
	    ELSE
	        REPLACE &wl_arqtmp .preco WITH  0
	        REPLACE &wl_arqtmp .clas_cms WITH  ""
	    ENDIF
	ENDIF
*-->
RETURN

PROCEDURE ULreg_par
    SELE &wl_arqtmp

	LNregant  = RECNO()

	=UAprzmedio(m.prazo,m.juromes)
		m.prazomedio = wp_retorno(2)
		m.taxa 		 = wp_retorno(3)
	*---------------------------------------------------------*
	*    As condicoes de edicao dos itens permitem que sejam
	*	alterados os dados do CLIENTE e CONDICOES PGTO o que
	*	implica na alteracao da classificacao da operacao
	*----------------------------------------------------------*
	=W_DEFPROC("ORCAMENT.SPR")
	IF !ORclas_oper((ORCAMENT.empresa),(ORCAMENT.natu_oper),;
			(ORCAMENT.motivo),(m.estado),;
		    (m.tp_inscr),(m.natu_cli),(m.tp_pgto),;
		    m.tipo,m.ch_opera,m.ch_produ,m.ch_motiv,m.ch_desti,;
		    	m.ch_contr,m.ch_condi)

	   	wp_msg = "Atencao!!! "+CHR(13)+;
			"     Nao Foi Possivel Classificar a Operacao."
		=UPbeeps(.f.,wp_msg)
	ENDIF
	*---------------------------------------------------------*
	******************
	*	Atualiza a aliquota de icms caso seja alterada a classificacao
	******************
	IF tipooper.info_icms = "N"
			m.aliq_icms =   tipooper.aliq_icms
	ENDIF
	SHOW GET m.aliq_icms

	*----------------------------------------------------------*
	*		Atualizar ORCAMENT com dados alterados e trazido em
	*	AMBIENTE PUBLICO ate este ponto (PRECISO ALTERAR)
	*----------------------------------------------------------*
	IF !(LEFT(orcament.situacao,1) $ "OYZ"))
		SELE orcament
		IF m.cliente <> orcament.cliente && SE ALTERAR CLI. ZERA LIBERACAO
			m.lim_libera =  0
			m.lim_prazo  =  0
			m.lim_forma  =  0
			m.usr_libera =  0
		ENDIF
		=edithand('REGRAVA')
	ENDIF

	*----------------------------------------------------------*
	*		Atualizar ORCATMP com dados alterados
	*----------------------------------------------------------*
    SELE &wl_arqtmp
	GO TOP
	IF !(LEFT(orcament.situacao,1) $ "OZo")) AND !EOF()
		**************	PARA RECALCULAR VALORES ************
		LNaprazo  = 0
		LNavista  = 0
		DLNaprazo  = 0
		DLNavista  = 0
		LNsomret  = 0
		LNsomipi  = 0
		*---------------------------------------------------------------*
		*  Este laco grava nos itens os dados que podem ter sido altera-
		* dos e que podem ter implicado em alteracao da classificaca
		*		ex: CODIGO  NAO E ALTERADO
		*			TIPO    PODE TER SIDO ALTERADO
		*			NATU_CLI .....
		*---------------------------------------------------------------*
		*-------    VARIAVEIS SERAO REDEFINIDAS NESTA ROTINA  ----*
		STORE "" TO  m.codigo,m.descricao,m.classifica,m.unidade

		STORE 0  TO  m.tp_mercad,m.origem,m.iva,m.tp_pgto,m.prazomedio,;
				m.taxa

		STORE 0  TO m.aliq_icms,m.aliq_ipi, m.aliq_iss
		STORE "" TO m.movestq,m.movvalor,m.movcusto,;
		 			m.cfo,m.info_icms,m.info_vlr,m.info_base,m.cst
		*---------------------------------------------------------*
		DO WHILE !EOF()
       	  	GATHER MEMVAR FIELDS EMPRESA, ORCAMENTO, DATA, HORA,;
        	  		 MOTIVO, ch_opera,;
                       ch_produ, ch_motiv, ch_desti, ch_contr, ch_condi,;
                       tipo, cfo, natu_cli MEMO
			REPLACE FAVORECIDO WITH m.cliente
			m.codigo	 =  &wl_arqtmp .codigo
			m.classifica =  &wl_arqtmp .classifica
			m.descricao  =  &wl_arqtmp .descricao
			m.origem     =  &wl_arqtmp .origem
			m.unidade    =  &wl_arqtmp .unidade
			m.tp_pgto    =  orcament.tp_pgto
			m.prazomedio =  orcament.prazomedio
			m.taxa       =  orcament.taxa
			m.aliq_icms  =  orcament.aliq_icms	&& GERAL INFORMADA
			m.aliq_ipi   =  orcament.aliq_ipi	&& GERAL INFORMADA
			m.cst		 =  &wl_arqtmp .cst
			*----------------------------------------------------------*
			=W_DEFPROC("ORCAMENT.SPR")
			=ORdef_tribut((m.empresa),(m.codigo),(m.tipo),;
				(orcament.orcamento),m.aliq_icms,;
				m.aliq_ipi,m.aliq_iss,m.movestq,m.movvalor,m.movcusto,;
				m.cfo,m.info_icms,m.info_vlr,m.info_base,m.cst,m.tp_mercad,;
				m.iva)
			*----------------------------------------------------------*
			SELE &wl_arqtmp
			GATHER MEMVAR FIELDS codigo,tp_mercad,descricao,;
				classifica,origem,unidade,iva,tp_pgto,;
				prazomedio,taxa,;
				aliq_icms,aliq_ipi,aliq_iss,movestq,movvalor,movcusto,;
				cfo,info_icms,info_vlr,info_base,cst
			*----------------------------------------------------------*
			IF LFrecalc  & recalcular valores
			   =ULcalcvlr("DADO PRECO e DESCONTO")
			ENDIF
			=ULsomvalor()
		    SKIP
		ENDDO
		GO BOTT
	ENDIF
    GO  LNregant
RETURN

*************************************************************************
** FIM  ROTINAS RELACIONADAS A GRAVACAO TEMPORARIA/DELECAO...
*************************************************************************

*************************************************************************
** INICIO  ROTINAS RELACIONADAS A MOVIMENTACAO JANELAS
*************************************************************************
FUNCTION ULvpar1	&& recalcula sem mudar de janela ativada nas mudancas
					&& das condicoes na janela de prazo
		LNrant = RECNO()
		GO TOP

		IF EMPTY(&wl_arqtmp .codigo)
		   LFrecalc  = .t.	&& recalcular valores
		ELSE		
			IF m.revendedor <> orcament.revendedor OR ;
			   m.estado   <> orcament.estado OR ;
			   m.tp_inscr   <> orcament.tp_inscr OR ;
			   m.juromes    <> orcament.juromes OR ;
			   m.aliq_ipi   <> &wl_arqtmp .aliq_ipi OR ;
			   m.aliq_icms  <> &wl_arqtmp .aliq_icms OR ;
			   m.prazo      <> orcament.prazo  OR ;
			   m.vlr_ent    <> orcament.vlr_ent
			   LFrecalc  = .t.	&& recalcular valores
		    ELSE
			   LFrecalc  = .F.	&& nao recalcular valores
		    ENDIF
		ENDIF
		GO LNrant
		DO ULreg_par  && grava os valores parametro de calculo
RETURN(.T.)

FUNCTION ULvpar
***  LFjanela = 1      => esta saindo da janela de cadastro  p/ condicoes
***  LFjanela = 2      => esta saindo da janela de condicoes p/ itens
***  LFjanela = 3      => esta saindo da janela de itens     p/ cadastro
set confirm ON
ON KEY LABEL ENTER
ON KEY LABEL TAB

DO CASE
	ON KEY LABEL END    DO ULversaida
	****                           ****
	*<<<<  ATIVANDO JANELA DE ITENS >>>>
	****                           ****
	=INKEY(0.0001)
	CASE (LFjanela = 2)
		LFjanela = 3
		ON KEY LABEL ESCAPE DO ULvoltacampo
		LNobjeto = _CUROBJ
		ACTIVATE WINDOW ITEM TOP
		SHOW WINDOW ITEM TOP
		LNrant = RECNO()
		GO TOP
		IF EMPTY(&wl_arqtmp .codigo)
		   LFrecalc  = .t.	&& recalcular valores
		ELSE		
			IF m.revendedor <> orcament.revendedor OR ;
			   m.estado   <> orcament.estado OR ;
			   m.tp_inscr   <> orcament.tp_inscr OR ;
			   m.juromes    <> orcament.juromes OR ;
			   m.aliq_ipi   <> &wl_arqtmp .aliq_ipi OR ;
			   m.aliq_icms  <> &wl_arqtmp .aliq_icms OR ;
			   m.prazo      <> orcament.prazo
			   LFrecalc  = .t.	&& recalcular valores
	           DO OBJ_MENS.SPR WITH ;
    	          "A T E N C A O !!!!!!"+CHR(13)+CHR(13)+;
        	      "      Os precos serao recalculados."
		    ELSE
			   LFrecalc  = .F.	&& nao recalcular valores
		    ENDIF
		ENDIF
		GO LNrant
		DO ULreg_par  && grava os valores parametro de calculo
	****                           ****
	*<<<<  ATIVANDO JANELA DE GERAIS APARTIR DOS ITENS >>>>
	****                           ****
	CASE (LFjanela = 3 )
*		_CUROBJ = LNobjeto
		_CUROBJ = 1
		LFjanela = 1
		SHOW WINDOW OBJ_CAD TOP
		IF 	!(LEFT(orcament.situacao,1) = "A" ;
			 OR	RIGHT(orcament.situacao,1) = "D")
			_CUROBJ = 4
		ENDIF
	****                           ****
	*<<<<  ATIVANDO JANELA DE GERAIS APARTIR JANELA 1 >>>>
	****                           ****
	CASE (LFjanela = 1 )
		IF !(m.estado $ wp_estado)
			WAIT WINDOWS "Sigla de Estado Nao Reconhecida..<ENTER>"
			_CUROBJ = OBJNUM(m.estado)
			RETURN
		ENDIF
		IF !UPInscricao((m.ESTADO),(m.INSCRICAO),1,0,0,'')
			WAIT WINDOWS "Nro. Inscricao Invalido..<ENTER>"
			_CUROBJ = OBJNUM(m.inscricao)
			RETURN
		ENDIF

		_CUROBJ = 1
		LFjanela = 2
		SHOW WINDOW OBJ_PRSO TOP
		SHOW GET m.prazo
ENDCASE
CLEAR TYPEAHEAD
SHOW GETS
ON KEY LABEL ESCAPE DO ULvoltacampo
RETURN
*************************************************************************
** FIM  ROTINAS RELACIONADAS A MOVIMENTACAO JANELAS
*************************************************************************

*************************************************************************
** INICIO  ROTINAS RELACIONADAS A VALIDACAO DE CAMPOS
*************************************************************************

FUNCTION ULverprod
	LNa= LASTKEY()
	IF 	(LNa <> 9 AND LNa <> 13) OR !isediting
		RETURN .T.
	ENDIF
    IF !(LEFT(&wl_arqtmp .situacao,1) $ "A")
		IF LASTKEY() = 9 		&& TABELA - ESCOLHA EM LISTA BROWSE (2-A)
    	    SET NEAR OFF
			ON KEY LABEL ESCAPE
		   	SELECT grupo
		    SET ORDER TO  TAG codigo
		    SET NEAR ON
		    SEEK ALLTRIM(&wl_arqtmp .codigo)
			SET NEAR OFF
		    SET ORDER TO  TAG ordem
			*-------------------------------------------------------*
			=W_DEFPROC("PRECO.SPR")
			=PRbrow_Tab((wp_empresa),(wp_emptab),(wp_tabela),(wp_serie),;
					(wp_dtoper),"null codigo","null classe")
			*-------------------------------------------------------*
			ON KEY LABEL ESCAPE DO ULvoltacampo
			KEYBOARD "{BACKTAB}"
	        RETURN(.F.)
		ENDIF
		RETURN(.t.)
	ENDIF
	***************************************************************
    IF LEFT(&wl_arqtmp .codigo,4)= "9999"
	   REPLACE &wl_arqtmp .movestq WITH  "N"
	   * REPLACE &wl_arqtmp .cst     WITH  "0"
	   RETURN .T.
    ENDIF
   	SELECT grupo
    SET ORDER TO  TAG codigo
    SET NEAR ON
    SEEK ALLTRIM(&wl_arqtmp .codigo)
	SET NEAR OFF
	=ULsubvalor()	&& SO NESTA ROTINA E COMANDADA DIRETAMENTE (1-A)
**  REPLACE &wl_arqtmp .preco WITH  0
	IF LASTKEY() = 9 		&& TABELA - ESCOLHA EM LISTA BROWSE (2-A)
        SET NEAR OFF
		ON KEY LABEL ESCAPE
	   	SELECT grupo
   		IF !EMPTY(&wl_arqtmp .codigo)  && FORCA POSICIONAMENTO APROXIMADO
 			DO WHILE !EOF() AND grupo.ordem = 0
 				skip
 			ENDDO
 		ENDIF
	    SET ORDER TO  TAG ordem
		*-------------------------------------------------------*
		=W_DEFPROC("PRECO.SPR")
		=PRbrow_Tab((wp_empresa),(wp_emptab),(wp_tabela),(wp_serie),;
					(wp_dtoper),"null codigo","null classe")
		*-------------------------------------------------------*
		ON KEY LABEL ESCAPE DO ULvoltacampo
	    IF LASTKEY() = 27
			=ULsomvalor()	&& SO NESTA ROTINA E COMANDADA DIRETAMENTE (3-A)
	       RETURN .F.
		ENDIF
	    IF !ULtipoprod(grupo.codigo)
		   =ULsomvalor()	&& SO NESTA ROTINA E COMANDADA DIRETAMENTE (4-A)
    	   RETURN .F.
	    ENDIF
		DO ULatrcampo
		=ULsomvalor()	&& SO NESTA ROTINA E COMANDADA DIRETAMENTE (5-A)
		RETURN .T.
    ENDIF
   	SELECT grupo
    SET ORDER TO  TAG codigo
    IF FOUND()
	   IF !ULtipoprod(grupo.codigo)
			=ULsomvalor()	&& SO NESTA ROTINA E COMANDADA DIRETAMENTE (6-A)
			RETURN .F.
	   ENDIF			
       SET NEAR OFF
	   SELECT &wl_arqtmp
	   DO ULatrcampo
	   =ULsomvalor()	&& SO NESTA ROTINA E COMANDADA DIRETAMENTE (7-A)
       RETURN .T.
    ENDIF
    SET NEAR OFF
	IF LASTKEY() = 27
		REPLACE &wl_arqtmp .codigo	WITH  SPACE(11)
	ENDIF
	=ULsomvalor()	&& SO NESTA ROTINA E COMANDADA DIRETAMENTE (8-A)
RETURN .F.


FUNCTION ULtipoprod  && VERIFICA SE O PRODUTO PODE SER INCL. NA OPERACAO
	PARAMETERS LScodigo
	PRIVATE LSalias
	PRIVATE	LNtp_mercad

	LSalias = alias()
	*------------------------------------------------------------*
	SELECT grupo
	SET ORDER TO tag codigo
	SEEK LScodigo
	IF !FOUND()
		IF !EMPTY(LSalias) AND USED(LSalias)
			SELECT &LSalias
		ENDIF
		RETURN(.f.)
	ENDIF
	*------------------------------------------------------------*
	SELE grfiscal
	SET ORDER TO TAG tributacao
	SEEK empresa.estado+LEFT(grupo.classifica,5)
	IF !FOUND()
		IF !EMPTY(LSalias) AND USED(LSalias)
			SELECT &LSalias
		ENDIF
		RETURN(.f.)
	ENDIF
	*------------------------------------------------------------*
	*  Em 01.03.2000 o Estado de Goias adotou regime de substituicao
	* para grupos de PECAS :
	*  Apartir de entao um produto passou a ter duas possibilidades
	* de classificacao fiscal
	*  EX: EM Goias SUBSTITUICAO (NAS FILIAIS DE GOIAS)
	*      FORA DE GO TRIBUTADO
	*   Para resolver o problema foi criado a tabela GRFISCAL
	* que identifica o tipo de tributacao de acordo com o
	* estado da filial e foram previstos P/ GO/DF/TO/MT
	* passando a vigora aprtir desta data
	*------------------------------------------------------------*
	IF orcament.data < {01.03.2000} OR LEFT(grupo.codigo,4) = "9999"
		LNtp_mercad	= 	grupo.tp_mercad
	ELSE
		LNtp_mercad	= 	grfiscal.tp_mercad
	ENDIF

	IF !(CHRTRAN(STR(LNtp_mercad,1)," ","-")  $ tipooper.tipo_produ)
		WAIT WINDOW "Produto nao pode ser incluido nesta operacao."
		IF !EMPTY(LSalias) AND USED(LSalias)
			SELECT &LSalias
		ENDIF
		RETURN(.f.)
	ENDIF
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(.T.)




PROCEDURE ULversald
	*---------------------------------------------------------------*
	*		Esta rotina da suporte a verificacao de saldos durante a
	*	edicao do itens
	*---------------------------------------------------------------*
  	IF &wl_arqtmp .qtde < 1 and ;
		(LASTKEY() = 15 OR LASTKEY() = 27)
		RETURN .T.
   	ENDIF
	*----------------------------------------------------------*
   	PRIVATE LFlockReg
	PRIVATE LFabreAuto
   	LFlockReg	= .F.	&& BLOQUEAR REGISTRO
    LFabreAuto	= .F. 	&& NAO ABRIR CONTROLE AUTOMATICAMENTE
	=W_DEFPROC("ESTOQUE.SPR")
	IF !ESversaldo(&wl_arqtmp .empresa,&wl_arqtmp .codigo ,;
					&wl_arqtmp .classifica , wp_dtoper,;
					&wl_arqtmp .qtde,&wl_arqtmp .qtderes,LFabreAuto,;
					LFlockReg,"SAIDA",orcament.hora_fat,&wl_arqtmp .movestq)
	  	SELECT &wl_arqtmp
		IF LEFT(&wl_arqtmp .descricao,3) <> "** "
			REPLACE &wl_arqtmp .descricao  WITH  "** "+&wl_arqtmp .descricao
		ENDIF
    	RETURN .T.
   	ENDIF
	*----------------------------------------------------------*
	*	 AJUSTA A SITUACAO DE ITEM QUE JA POSSUA RESERVA
	*----------------------------------------------------------*

	SELECT &wl_arqtmp
	IF left(&wl_arqtmp .situacao,1) $ "IE") && RESERVADO OU ALTERADO RESERVS
		IF &wl_arqtmp .qtde <> &wl_arqtmp .qtderes
			REPLACE &wl_arqtmp .situacao WITH  "E "  && RESERV. ALTERADA
		ELSE
			REPLACE &wl_arqtmp .situacao WITH  "I "  && RESERV. NORMAL
		ENDIF
	ENDIF

RETURN .T.

FUNCTION ULsaldgrv  && VERSAO PARA ACEITAR RESPONDER O SALDO PARA PERMITIR
						&& OU NAO A GRAVACAO
	*---------------------------------------------------------------*
	*		Esta rotina da suporte a verificacao de saldos durante a
	*	gravacao dos itens no encerramento da edicao
	*---------------------------------------------------------------*
   	IF !ULextcond()		&& ITEM FECHADO NAO HOVE MUDANCA DE QTDE
   		RETURN(.T.)
   	ENDIF
   	IF &wl_arqtmp .qtde < 1  AND LEFT(&wl_arqtmp .codigo,4) <> "9999"
 		RETURN(.F.)
   	ENDIF
	*----------------------------------------------------------*
   	PRIVATE LFlockReg
	PRIVATE LFabreAuto
   	LFlockReg	= .F.	&& BLOQUEAR REGISTRO
    LFabreAuto	= .F. 	&& NAO ABRIR CONTROLE AUTOMATICAMENTE
	=W_DEFPROC("ESTOQUE.SPR")
	IF !ESversaldo(&wl_arqtmp .empresa,&wl_arqtmp .codigo ,;
					&wl_arqtmp .classifica , wp_dtoper,;
					&wl_arqtmp .qtde,&wl_arqtmp .qtderes,LFabreAuto,;
					LFlockReg,"SAIDA",orcament.hora_fat,&wl_arqtmp .movestq)
	  	SELECT &wl_arqtmp
    	RETURN .F.
   	ENDIF
	*----------------------------------------------------------*
	SELECT &wl_arqtmp
RETURN(.T.)




*******-> ROTINA DE COMPLEMENTO DAS CONDICOES BROWSE

FUNCTION ULextcond		&& criada p/ evitar excesso de linhas no browse
						&& o que provoca erro compilacao
RETURN(left( &wl_arqtmp .situacao,1) $ "A" )
						
****************************************************************
FUNCTION ULcritc
	 SELECT &wl_arqtmp
	 LNregant  = RECNO()
     GO TOP
     m.vlr     = 0
	 m.qtde    = 0        && base para calculo ipi
	*------------------------------------*
     DO WHILE !EOF()
		IF !(LEFT(situacao,1) $ "Yyke")   && NAO ESTAO CANCELADOS
			m.vlr  = m.vlr + precofinal
			m.qtde = m.qtde + qtde
		ENDIF
        skip
     ENDDO
     skip -1
	 m.LNfch  = m.vlr + (m.qtde / 100)
     IF WEXIST('SCGC201') AND !(LEFT(orcament.situacao,1) $ "OZo"))
											&& GRAVA FECHAMENTO AUTOMATICO
		REPLACE orcament.fecha WITH LNfch
		m.fecha	= LNfch
	 ENDIF
     IF m.LNfch <> m.fecha
        DO OBJ_MENS.SPR WITH ;
        "[Valor :"+ALLTRIM(transform(m.vlr,"@RT 999,999.99"))+"]"+CHR(13)+;
        "[Qtde  :"+ALLTRIM(transform(m.qtde,"@RT 999,999"))+"]"+CHR(13)+;
        "[Fechamento Informado :"+;
        		ALLTRIM(transform(m.fecha,"@RT 999,999.99"))+"]"+CHR(13)+;
		" Inconsistente..."
		GO LNregant
		RETURN(.F.)
     ENDIF
	 GO LNregant
RETURN(.T.)

*************************************************************************
** FIM  ROTINAS RELACIONADAS A VALIDACAO DE CAMPOS
*************************************************************************
*************************************************************************
** INICIO  ROTINAS RELACIONADAS A FERRAMENTAS DE AUXILIO AO PROCESSO
*************************************************************************

FUNCTION ULcalcvlr
	PARAMETERS LSid_chamada
	
	DO CASE
		CASE LSid_chamada = "PRECOFINAL"
			 LSid_chamada = ("DADO PRECO FINAL (PRECOFINAL)")
		CASE LSid_chamada = "VLRVENDA"
			 LSid_chamada = ("DADO VALOR FINAL (VLRVENDA)")
		OTHERWISE
			 LSid_chamada = ("DADO PRECO e DESCONTO")
	ENDCASE

	PRIVATE preco, desconto, precofinal,vlrvenda
	*----------------------------------------------------------*
	m.preco		= &wl_arqtmp .PRECO
	m.desconto	= &wl_arqtmp .DESCONTO
	m.precofinal= &wl_arqtmp .PRECOFINAL
	m.vlrvenda  = &wl_arqtmp .VLRVENDA
	*----------------------------------------------------------*
	=W_DEFPROC("ORCAMENT.SPR")
	=ORcalc_vlres(m.preco,(qtde),m.DESCONTO,(taxa),;
					m.precofinal,m.vlrvenda,LSid_chamada)
	SELE &wl_arqtmp
	GATHER MEMVAR FIELDS preco,desconto,precofinal,vlrvenda
	*----------------------------------------------------------*
	STORE 0 TO m.base_iss,m.vlr_iss,m.base_calc,;
				m.vlr_icms,m.base_isent,m.base_sbbrt,m.base_subs,;
				m.icms_subs,m.base_outr,m.base_ipi,m.vlripi,m.base_isipi
	*----------------------------------------------------------*
	=W_DEFPROC("ORCAMENT.SPR")
	=ORcalc_tribu((orcament.empresa),(orcament.tipo),;
				(&wl_arqtmp .cst),(&wl_arqtmp .vlrvenda),;
				(&wl_arqtmp .tp_mercad), (&wl_arqtmp .aliq_iss),;
				(&wl_arqtmp .aliq_icms), (&wl_arqtmp .aliq_ipi),;
				(&wl_arqtmp .iva),(orcament.data),;
				(orcament.estado),(&wl_arqtmp .qtde),;
				(&wl_arqtmp .classifica),m.base_iss,m.vlr_iss,m.base_calc,;
				m.vlr_icms,m.base_isent,m.base_sbbrt,m.base_subs,;
				m.icms_subs,m.base_outr,m.base_ipi,m.vlripi,m.base_isipi)
	*----------------------------------------------------------*
	SELE &wl_arqtmp
	GATHER MEMVAR FIELDS base_iss,vlr_iss,base_calc,;
				vlr_icms,base_isent,base_sbbrt,base_subs,;
				icms_subs,base_outr,base_ipi,vlripi,base_isipi
	*----------------------------------------------------------*
RETURN(.T.)

FUNCTION ULsubvalor		&& SUBTRAI VALOR EM VARIAVEIS DE CONTROLE
	IF LEFT(&wl_arqtmp .situacao,1) $ "Yyke"
		RETURN
	ENDIF
	SELECT &wl_arqtmp
 	IF &wl_arqtmp .PRECO > 0 AND &wl_arqtmp .QTDE > 0
     	LVVLRVENDA = ;
		(&wl_arqtmp .PRECO - ;
		ROUND(&wl_arqtmp .PRECO * ROUND(&wl_arqtmp .DESCONTO/100,4),2)) * ;
     				  &wl_arqtmp .QTDE
     	LVVLRVENDA = LVVLRVENDA
		LNavista = LNavista - LVVLRVENDA
	ENDIF
	LNaprazo 	= LNaprazo  - &wl_arqtmp .vlrvenda
	LNsomret  	= LNsomret 	- &wl_arqtmp .icms_subs
	IF ORCAMENT.CH_OPERA <> "1"
		LNsomipi  	= LNsomipi 	- &wl_arqtmp .vlripi
	ENDIF
	=ULvalores()  && atualiza valores em obj_vlro
RETURN(.t.)

FUNCTION ULsomvalor 	&& SOMA VALOR EM VARIAVEIS DE CONTROLE
	IF LEFT(&wl_arqtmp .situacao,1) $ "Yyke"
		RETURN
	ENDIF
	SELECT &wl_arqtmp
	IF &wl_arqtmp .PRECO > 0 AND &wl_arqtmp .QTDE > 0
     	LVVLRVENDA = ;
		(&wl_arqtmp .PRECO - ;
		ROUND(&wl_arqtmp .PRECO * ROUND(&wl_arqtmp .DESCONTO/100,4),2)) * ;
     				  &wl_arqtmp .QTDE
     	LVVLRVENDA = LVVLRVENDA
		LNavista = LNavista + LVVLRVENDA
	ENDIF
	LNaprazo 	= LNaprazo + &wl_arqtmp .vlrvenda
	LNsomret  	= LNsomret + &wl_arqtmp .icms_subs
	*---------------------------------------------------------------*
	*   No caso de vendas com ipi esta se considerando que o ipi
	* esta  agregado ao valor de venda (DIRETORIA CONSIDEROU NAO SER
	*  VIAVEL COBRAR O IPI APARTE CONFORME SERIA O CORRETO) para nao
	*  inviabilizar as vendas
	*---------------------------------------------------------------*
	IF ORCAMENT.CH_OPERA <> "1"
		LNsomipi  	= LNsomipi + &wl_arqtmp .vlripi
	ENDIF
	=ULvalores()  && atualiza valores em obj_vlro

RETURN(.t.)

FUNCTION ULvalores		&& ATUALIZA VALORES OBJ_VLRO
		PRIVATE LNnumpgt
		=UAprzmedio(m.prazo,m.juromes)
				LNnumpgt = wp_retorno(1)		
		IF LEFT(m.prazo,3) = "000"
			IF LNnumpgt > 1
			    LNentrada = 1
				LNnumparc = (LNnumpgt  - 1)
				IF m.vlr_ent > 0
					LNparcela = ;
						((LNaprazo+m.vlrfrete+m.vlrseguro+;
						LNsomret+LNsomipi)-m.vlr_ent)/(LNnumpgt-1)
				ELSE
					LNparcela = ;
					 (LNaprazo+m.vlrfrete+m.vlrseguro+;
					 	LNsomret+LNsomipi) / (LNnumpgt)
				ENDIF
			ELSE
			    LNentrada = 0
				LNnumparc = 1
				LNparcela = LNaprazo+m.vlrfrete+m.vlrseguro+;
							LNsomret+LNsomipi
			ENDIF
		ELSE
		    LNentrada = 0
			LNnumparc = LNnumpgt
			LNparcela = ;
			 (LNaprazo+m.vlrfrete+m.vlrseguro+LNsomret+LNsomipi)/LNnumpgt
		ENDIF
		DLNavista = LNavista+m.vlrfrete+m.vlrseguro+;
					(LNsomret / (1+(&wl_arqtmp .taxa / 100)))+LNsomipi
		DLNaprazo = LNaprazo+m.vlrfrete+m.vlrseguro+LNsomret+LNsomipi

		SHOW GET LNentrada
		**********
		SHOW GET DLNavista
		SHOW GET DLNaprazo
		SHOW GET LNparcela
		SHOW GET LNnumparc
		SHOW GET orcament.prazomedio
		SHOW GET orcament.taxa
RETURN(.T.)
*************************************************************************
** FIM  ROTINAS RELACIONADAS A FERRAMENTAS DE AUXILIO AO PROCESSO
*************************************************************************
*************************************************************************
** INICIO  ROTINAS RELACIONADAS A TELA
*************************************************************************

PROCEDURE  brtotal
  PARAMETERS wl_ms
	 SELECT &wl_arqtmp
	 LNregant  = RECNO()
     GO TOP
     PRIVATE LNvalor,LNiss,LNicms,LNipi,LNsubs,LNtot
     STORE 0 TO LNvalor,LNiss,LNicms,LNipi,LNsubs,LNtot

	*------------------------------------*
     DO WHILE !EOF()
		IF !EMPTY(ALLTRIM(&wl_arqtmp .codigo)) AND ;
			!left(&wl_arqtmp .situacao,1) $ "Yyke" AND ;
			ULsaldgrv()
			IF ORCAMENT.CH_OPERA = "1"
				LNvalor 	= 	LNvalor + &wl_arqtmp .vlrvenda - ;
										&wl_arqtmp .vlripi
			ELSE
				LNvalor 	= 	LNvalor + &wl_arqtmp .vlrvenda
			ENDIF			
			LNiss   	= 	LNiss   + &wl_arqtmp .vlr_iss
			LNicms		=   LNicms  + &wl_arqtmp .vlr_icms
			LNipi		=   LNipi   + &wl_arqtmp .vlripi
			LNsubs		=   LNsubs  + &wl_arqtmp .icms_subs
		ENDIF
        skip
     ENDDO
     skip -1
	 LNtot  = LNvalor + m.LNsubs + orcament.vlrfrete + ;
	 					orcament.vlrseguro + LNipi

     IF wl_ms
        DO OBJ_MENS.SPR WITH ;
        "   Merc/Sev (+):"+(transform(LNvalor,"@R 999,999.99"));
		+CHR(13)+;
		"   I.S.S.......:"+(transform(LNiss,"@R 999,999.99"));
		+CHR(13)+;
		"   I.C.M.S.....:"+(transform(LNicms,"@R 999,999.99"));
		+CHR(13)+;
		"   I.P.I....(+):"+(transform(LNipi,"@R 999,999.99"));
        +CHR(13)+;
        "   Substit..(+):"+(transform(m.LNsubs,"@R 999,999.99"));
		+CHR(13)+;
		"   Frete....(+):"+(transform(m.vlrfrete,"@R 999,999.99"));
		+CHR(13)+;
		+CHR(13)+;
        "   TOTAL   ==>  "+(transform(LNtot,"@R 999,999.99"))
     ENDIF
	 GO LNregant
RETURN(LNtot)

PROCEDURE ULdefprz

		LGTD1 = VAL(SUBS(m.prazo,1,3))
		SHOW GET LGDT1
		LGTD2 = VAL(SUBS(m.prazo,5,3))
		SHOW GET LGDT2
		LGTD3 = VAL(SUBS(m.prazo,9,3))
		SHOW GET LGDT3
		LGTD4 = VAL(SUBS(m.prazo,13,3))
		SHOW GET LGDT4
		LGTD5 = VAL(SUBS(m.prazo,17,3))
		SHOW GET LGDT5
		SHOW GET m.prazo

RETURN

PROCEDURE ULccads	&& Ativa cadastrio de clientes
*	SAVE SCREEN TO LStela
	HIDE WINDOW ALL
	DO SCGC200.SPR
	ACTIVATE WINDOWS OBJ_CAD
	SHOW WINDOW OBJ_PRSO,ITEM,OBJ_CAD,OBJ_VLRO
	ACTIVATE WINDOWS OBJ_CAD
*	RESTORE SCREEN FROM LStela
	****----------
RETURN

*************************************************************************
** INICIO  ROTINAS RELACIONADAS A MOVIMENTACAO CAMPOS
*************************************************************************

FUNCTION UL1passalin
	CLEAR TYPEAHEAD
	LFpaslin   = .t.    && .t. indica que houve pedido de mudanca de linha
							&& em passalin
RETURN(.T.)    && A CLAUSULA OU IMPEDE EFEITO NA CONDICAO

FUNCTION UL2passalin
	CLEAR TYPEAHEAD
	LFpaslin   = .t.    && .t. indica que houve pedido de mudanca de linha
							&& em passalin
RETURN(.T.)

FUNCTION ULinfcamp	&& mantem variavel com nome do campo em edicao
	PARAMETERS Lcmp,Loper
		PRIVATE AKEY
		LSposcampo = Lcmp
		IF !ISEDITING
			RETURN(.T.)
		ENDIF
		AKEY = LASTKEY()

		IF LFpaslin = .t.  && .t.indica que houve pedido de mudanca de linha
							&& em passalin
			DO CASE
				CASE LCmp = "CODIGO" && AND ULextcond()
						*=ULsubvalor()	&& retirar valores nos tatais
						LFpaslin = .F.
						*KEYBOARD "{F4}"
				    	CLEAR TYPEAHEAD
						KEYBOARD "{DNARROW}"
						=INKEY(0)
						=ULteste()
						RETURN(.T.)
				OTHERWISE
						KEYBOARD "{SHIFT-TAB}"
						******		RETURN(.T.)
			ENDCASE				
		ENDIF
***
		IF LCmp = "CODIGO"
			  IF Loper = "W"
					LScodant   = &wl_arqtmp .codigo && NA ENTRADA "W"
			  ELSE
			 	 IF (AKEY <> 13 AND AKEY <> 23) OR !ULextcond()
					*IF &wl_arqtmp .codigo <> LScodant
					*	SET STEP ON
					*ENDIF
					REPLACE &wl_arqtmp .codigo WITH LScodant  && SAIDA "V"
				 ENDIF
				 LScodant   = &wl_arqtmp .codigo && NA ENTRADA "W"
			  ENDIF
			  RETURN(.T.)
		ENDIF
		IF LCmp = "QTDE"
			  IF Loper = "W"
					LNqtdant   = &wl_arqtmp .qtde && NA ENTRADA "W"
			  ELSE
				=ULcalcvlr("DADO PRECO e DESCONTO")
				 LNqtdant   = &wl_arqtmp .qtde && NA ENTRADA "W"
			  ENDIF
		ENDIF
**
		IF  WEXIST('SCGC201') AND Loper = "V" AND ch_opera = "1" ;
							  AND AKEY = 13
			IF LCmp $ "DESCONTO/PRECOFINAL/VLRVENDA"
				IF LNdscant  <> &wl_arqtmp .desconto
					IF &wl_arqtmp .desconto > &wl_arqtmp .desc_alt  OR ;
						&wl_arqtmp .desconto < -50
						*-----------------------------------------------*
						LNmaxdesc = 0
						=W_DEFPROC("PRECO.SPR")
						=PRdesconto((wp_empresa),(&wl_arqtmp .codigo),;
							(wp_dtoper),(&wl_arqtmp .natu_cli),LNmaxdesc,0)
						*-----------------------------------------------*
						IF &wl_arqtmp .desconto > LNmaxdesc + 1
		   					wp_msg = "Desconto Superior ao Autorizado => "+;
		   						TRANSFORM(LNmaxdesc,'@R 99.99')+"  <ENTER>"
							=UPbeeps(.T.,wp_msg)
							SELE &wl_arqtmp
						ENDIF
					ENDIF
				ENDIF
			ENDIF
		ENDIF
		SELE &wl_arqtmp
		IF LCmp $ "PRECO/DESCONTO/PRECOFINAL/VLRVENDA/"
			IF wp_dtoper > {01.01.1998} ;
				AND Loper = "W"  AND ch_opera = "2" ;
				AND LEFT(codigo,4) <> "9999"
				 RETURN(.F.)
			ENDIF
		ENDIF
		IF LCmp $ "DESCONTO/PRECOFINAL/VLRVENDA"
	
			  IF Loper = "W"
					LNdscant   = &wl_arqtmp .desconto && NA ENTRADA "W"
			  ELSE
				IF LCmp = "DESCONTO"
					=ULcalcvlr("DADO PRECO e DESCONTO")
				ENDIF
	
				LNdscant   = &wl_arqtmp .desconto && NA ENTRADA "W"
			  ENDIF
		ENDIF
**
		SELE &wl_arqtmp
**
		DO CASE
		   CASE Loper = "W"  && QUANDO => ENTRADA NO CAMPO
				=ULsubvalor()	&& retirar valores nos tatais
		   CASE Loper = "V"  && VALIDE => SAIDA DO CAMPO
				=ULsomvalor()	&& acrescentar valores nos tatais
		ENDCASE
RETURN(.T.)

PROCEDURE ULvoltacampo
		CLEAR TYPEAHEAD
		IF UPPER(VARREAD()) = 'CODIGO'
			IF !BOF()
				SKIP -1
			ENDIF
			IF BOF()
			   IF fox_alert('Abandonar Alteracoes nos itens ?')
					ON KEY LABEL ESCAPE
					KEYBOARD CHR(27)
		  			******
					isediting = .F.   && INIBIE A EDICAO DOS CAMPO OBJ_PRSO
					******
				   RETURN .T.
			   ENDIF
			   GO TOP
			ENDIF					
		ELSE
			KEYBOARD "{BACKTAB}"
		ENDIF
RETURN

FUNCTION ULteste
		DO CASE
			CASE LASTKEY() <> 5 AND LASTKEY() <> 27
				IF !EOF()
					SKIP
					IF EOF()
						KEYBOARD "{CTRL-N}"	&& brappend
					ELSE
						KEYBOARD "{DNARROW}"
					ENDIF
					ACTIVATE WINDOWS OBJ_PRSO TOP
					DEACTIVATE WINDOWS ITENS
				    SHOW WINDOW ITEM TOP
					ACTIVATE WINDOWS ITENS TOP
				    SHOW WINDOW ITENS REFRESH TOP
				ENDIF
		ENDCASE
RETURN(.T.)
*************************************************************************
** FIM  ROTINAS RELACIONADAS A MOVIMENTACAO CAMPOS
*************************************************************************


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0WFMIG           m.cliente WHEN                     º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         OBJ_ITOR,     Record Number:   34  º
*       º Variable:            m.cliente                          º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Field                              º
*       º Snippet Number:      1                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

* SE ALTERAR O CLIENTE A CONDICAO DE LIBERACAO VOLTA A ZERO (REG_PAR)
* SO NAO ALTERA O CLIENTE SE ESTIVER FATURADO O CANCELADO


FUNCTION _2lx0wfmig     &&  m.cliente WHEN
#REGION 1
IF isediting AND LFjanela = 1 AND !(LEFT(orcament.situacao,1) $ "OZY")
	m.cgccliente = SPACE(14)
	SHOW GET m.cgccliente
	ON KEY LABEL CTRL-Y
	ON KEY LABEL PGDN	KEYBOARD "{ENTER}"
	ON KEY LABEL END    KEYBOARD "{ENTER}"
	RETURN(.T.)
ELSE
	m.cgccliente = str(m.cliente,14)
	SHOW GET m.cgccliente
	RETURN(.F.)
ENDIF



*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0WFMII           m.cliente VALID                    º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         OBJ_ITOR,     Record Number:   34  º
*       º Variable:            m.cliente                          º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Field                              º
*       º Snippet Number:      2                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0wfmii     &&  m.cliente VALID
#REGION 1
PRIVATE LNkey
	LNkey = LASTKEY()
	=W_DEFPROC("orcament.spr")
	IF !ORValEntClie((wp_empresa),LNkey,m.cliente,(m.ch_opera),(m.tipo),;
			m.natu_cli,m.tp_pessoa, m.cliente, m.nome, ;
			m.fone, m.estado, m.inscricao,;
			m.tp_inscr, m.revendedor, m.endereco,;
			m.bairro, m.cidade, m.cep, m.regiao,;
			m.banco,m.nome_inscr,m.nome_natu)
		RETURN(.F.)
	ENDIF
	CLEAR TYPEAHEAD
	=INKEY(0.01)
	***************************
	ON KEY LABEL CTRL-Y DO brdeleta
	ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
	ON KEY LABEL PGDN	DO ULvpar
	ON KEY LABEL END    DO ULversaida
	***************************
RETURN(.t.)



*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0WFMIN           m.cliente ERROR                    º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         OBJ_ITOR,     Record Number:   34  º
*       º Variable:            m.cliente                          º
*       º Called By:           ERROR Clause                       º
*       º Object Type:         Field                              º
*       º Snippet Number:      3                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0wfmin     &&  m.cliente ERROR
#REGION 1
A=1	


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0WFMIP           m.nome WHEN                        º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         OBJ_ITOR,     Record Number:   36  º
*       º Variable:            m.nome                             º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Field                              º
*       º Snippet Number:      4                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0wfmip     &&  m.nome WHEN
#REGION 1
m.cgccliente = str(m.cliente,14)
SHOW GET m.cgccliente

ON KEY LABEL ENTER
ON KEY LABEL TAB

* SE ALTERAR O CLIENTE A CONDICAO DE LIBERACAO VOLTA A ZERO (REG_PAR)
* SO NAO ALTERA O CLIENTE SE ESTIVER FATURADO O CANCELADO

IF isediting AND LFjanela = 1 AND !(LEFT(orcament.situacao,1) $ "OZY") ;
	AND (!FOUND("CLIENTES") OR m.cliente = 0)
	RETURN(.T.)
ENDIF
RETURN(.F.)



*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0WFMIT           m.Flend WHEN                       º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         OBJ_ITOR,     Record Number:   37  º
*       º Variable:            m.Flend                            º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Check Box                          º
*       º Snippet Number:      5                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0wfmit     &&  m.Flend WHEN
#REGION 1
m.FLend = .f.
IF (isediting AND LFjanela = 1 AND FOUND("CLIENTES"))
	ON KEY LABEL ENTER  KEYBOARD "{RIGHTARROW}"
ENDIF
RETURN(isediting AND LFjanela = 1 AND FOUND("CLIENTES"))

*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0WFMIV           m.Flend VALID                      º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         OBJ_ITOR,     Record Number:   37  º
*       º Variable:            m.Flend                            º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Check Box                          º
*       º Snippet Number:      6                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0wfmiv     &&  m.Flend VALID
#REGION 1
IF m.FLend
	LSdbant = ALIAS()
	sele clientes
	HIDE WINDOW OBJ_CAD
	HIDE WINDOW OBJ_VLRO
	HIDE WINDOW OBJ_PRSO
	HIDE WINDOW ITEM

	DO OBJ_ENDE.SPR WITH m.cliente
	SCATTER MEMVAR FIELDS  nome, fone, estado,;
		 endereco, bairro, cidade, cep  MEMO

	SHOW WINDOW OBJ_CAD
	SHOW WINDOW OBJ_VLRO
	SHOW WINDOW OBJ_PRSO
	SHOW WINDOW ITEM

	SELECT &LSdbant
	SHOW GET m.nome
	SHOW GET m.endereco
	SHOW GET m.bairro
	SHOW GET m.cidade
	SHOW GET m.estado
	SHOW GET m.cep
	SHOW GET m.fone
endif
m.FLend = .f.
SHOW GET m.FLend
RETURN .T.


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0WFMJ0           m.tp_transp WHEN                   º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         OBJ_ITOR,     Record Number:   38  º
*       º Variable:            m.tp_transp                        º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Popup                              º
*       º Snippet Number:      7                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0wfmj0     &&  m.tp_transp WHEN
#REGION 1
m.cgccliente = str(m.cliente,14)
SHOW GET m.cgccliente
IF m.tp_transp = 0
	 m.tp_transp = 1
ENDIF
IF isediting AND LFjanela = 1
	ON KEY LABEL ENTER  KEYBOARD "{RIGHTARROW}"
	ON KEY LABEL TAB    KEYBOARD "{SPACEBAR}"
ENDIF
RETURN(isediting AND LFjanela = 1)

*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0WFMJ2           m.veiculo WHEN                     º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         OBJ_ITOR,     Record Number:   39  º
*       º Variable:            m.veiculo                          º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Field                              º
*       º Snippet Number:      8                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0wfmj2     &&  m.veiculo WHEN
#REGION 1
ON KEY LABEL TAB
ON KEY LABEL ENTER
RETURN(isediting AND LFjanela = 1)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0WFMJ3           m.natu_cli WHEN                    º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         OBJ_ITOR,     Record Number:   48  º
*       º Variable:            m.natu_cli                         º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Field                              º
*       º Snippet Number:      9                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
*if (isediting AND LFjanela = 1 AND (!FOUND("CLIENTES") OR m.cliente = 0))
*	if LASTKEY() <> 27
*		KEYBOARD '{TAB}'
*	ENDIF
*ENDIF
FUNCTION _2lx0wfmj3     &&  m.natu_cli WHEN
#REGION 1
RETURN(isediting AND LFjanela = 1 AND (!FOUND("CLIENTES") OR m.cliente = 0))

*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0WFMJ9           m.natu_cli VALID                   º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         OBJ_ITOR,     Record Number:   48  º
*       º Variable:            m.natu_cli                         º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Field                              º
*       º Snippet Number:      10                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
*IF LASTKEY() = 27
*	RETURN .T.
*ENDIF	

FUNCTION _2lx0wfmj9     &&  m.natu_cli VALID
#REGION 1
LSdbant = ALIAS()
SELECT tab001
SET ORDER TO TAG codigo

IF LASTKEY() = 9
   SEEK 'NTZ'+CHRTRAN(STR(m.natu_cli,1)," ","0")
   ON KEY LABEL ESCAPE
   DO loc_dlog WITH .t.,.F.,"'NTZ'"
   ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
	SELECT &LSdbant
   IF LASTKEY() = 27
	   RETURN .F.
   ENDIF
ELSE
   IF !SEEK('NTZ'+CHRTRAN(STR(m.natu_cli,1)," ","0"))
		SELECT &LSdbant
		RETURN .F.
   ENDIF
ENDIF
SELECT &LSdbant
m.natu_cli  = INT(VAL(tab001.codigo))
m.nome_natu = tab001.descricao

SHOW GET m.natu_cli
SHOW GET m.nome_natu

IF m.natu_cli =  1
	m.revendedor = "S"
ELSE
	m.revendedor = "N"
ENDIF	

RETURN .T.


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0WFMJD           m.tp_inscr WHEN                    º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         OBJ_ITOR,     Record Number:   50  º
*       º Variable:            m.tp_inscr                         º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Field                              º
*       º Snippet Number:      11                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
*if (isediting AND LFjanela = 1 AND (!FOUND("CLIENTES") OR m.cliente = 0))
*	if LASTKEY() <> 27
*		KEYBOARD '{TAB}'
*	ENDIF
*ENDIF
FUNCTION _2lx0wfmjd     &&  m.tp_inscr WHEN
#REGION 1
RETURN(isediting AND LFjanela = 1 AND (!FOUND("CLIENTES") OR m.cliente = 0))


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0WFMJH           m.tp_inscr VALID                   º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         OBJ_ITOR,     Record Number:   50  º
*       º Variable:            m.tp_inscr                         º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Field                              º
*       º Snippet Number:      12                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0wfmjh     &&  m.tp_inscr VALID
#REGION 1
LSdbant = ALIAS()
SELECT tab001
IF LASTKEY() = 9
   ON KEY LABEL ESCAPE
   DO loc_dlog WITH .T., "tab001.tabela = 'INS'"
   ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
   IF LASTKEY() = 27
		SELECT &LSdbant
		RETURN .F.
	ENDIF
ELSE
	IF !SEEK('INS'+STR(m.tp_inscr,1))
		SELECT &LSdbant
		RETURN .F.
	ENDIF
ENDIF
m.tp_inscr   = val(tab001.codigo)
m.nome_inscr = tab001.descricao
IF m.tp_inscr = 2
   m.inscricao = "ISENTO"
   SHOW GET m.inscricao
ENDIF
SHOW GET m.tp_inscr
SHOW GET m.nome_inscr
SELECT &LSdbant
RETURN .T.


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0WFMJK           m.inscricao VALID                  º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         OBJ_ITOR,     Record Number:   52  º
*       º Variable:            m.inscricao                        º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Field                              º
*       º Snippet Number:      13                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0wfmjk     &&  m.inscricao VALID
#REGION 1
DO ULvpar
RETURN(.T.)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0WFMJT           m.cliente VALID                    º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         OBJ_PRSO,     Record Number:   46  º
*       º Variable:            m.cliente                          º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Field                              º
*       º Snippet Number:      14                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0wfmjt     &&  m.cliente VALID
#REGION 2
LSdbant = ALIAS()
SELECT clientes
IF LASTKEY() = 9
   ON KEY LABEL ESCAPE
   SET ORDER TO TAG nome
   DO loc_dlog WITH .T.
   ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
   IF LASTKEY() = 27
		SELECT &LSdbant
		RETURN .F.
	ENDIF
ELSE
	ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
	SET ORDER TO TAG cliente
	SEEK m.cliente
	IF m.cliente = 0 OR !FOUND()
		SELECT &LSdbant
		m.tp_pessoa = 1
		m.estado	= empresa.estado
		m.inscricao = 'ISENTO'
		m.tp_inscr	= 4
		m.nome_inscr ="OUTROS"
		m.revendedor= "N"

		SHOW GET m.estado
		SHOW GET m.inscricao
		SHOW GET m.tp_inscr
		SHOW GET m.nome_inscr
		SHOW GET m.revendedor
		SHOW GET m.tp_pessoa
   		RETURN .T.
	ENDIF
ENDIF
SCATTER MEMVAR FIELDS tp_pessoa, cliente, nome, fone, estado, inscricao,;
		tp_inscr, revendedor, endereco, bairro, cidade, cep, regiao MEMO
*	Determinar o Banco de Cobranca
m.regiao = clientes.regiao	&& sera alterada na funcao UPdefbanco
m.banco  = UPdefbanco(cbcidade, cbestado)	&& define banco de cobranca

IF m.revendedor <> "S"
	m.revendedor = "N"
ENDIF   		
SELE tab001
SEEK 'INS'+str(m.tp_inscr,1)
m.nome_inscr = tab001.descricao
SELECT &LSdbant
SHOW GET m.cliente
SHOW GET m.nome
SHOW GET m.fone
SHOW GET m.estado
SHOW GET m.inscricao
SHOW GET m.tp_inscr
SHOW GET m.nome_inscr
SHOW GET m.revendedor
SHOW GET m.tp_pessoa

RETURN .T.


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0WFMJY           m.fecha WHEN                       º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         OBJ_PRSO,     Record Number:   51  º
*       º Variable:            m.fecha                            º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Field                              º
*       º Snippet Number:      15                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0wfmjy     &&  m.fecha WHEN
#REGION 2
ON KEY LABEL PGDN	DO ULvpar
ON KEY LABEL END    DO ULversaida
RETURN(isediting AND LFjanela = 2)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0WFMK1           m.forma_pgto WHEN                  º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         OBJ_PRSO,     Record Number:   52  º
*       º Variable:            m.forma_pgto                       º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Field                              º
*       º Snippet Number:      16                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
*    Se o cliente tever especificado a forma de pgto o vendedor nao acessa o
* campo, exceto quando um liberador tiver dado parecer (m.usr_libera > 0),
* desta forma o vendedor pode alterar a condicao para a especificada
* pela liberacao especificada na liberacao
*
FUNCTION _2lx0wfmk1     &&  m.forma_pgto WHEN
#REGION 2
IF (isediting AND LFjanela = 2)
	ON KEY LABEL PGDN KEYBOARD "{ENTER}"
	ON KEY LABEL END  KEYBOARD "{ENTER}"
ENDIF
RETURN(isediting AND LFjanela = 2)

*RETURN(isediting AND LFjanela = 2 AND ;
*((!FOUND("CLIENTES") OR m.cliente = 0) OR ;
*(FOUND("CLIENTES") AND ;
*(clientes.forma_pgto = 0 OR (m.usr_libera > 0 AND m.usr_libera <> 9999)))))


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0WFMK3           m.forma_pgto VALID                 º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         OBJ_PRSO,     Record Number:   52  º
*       º Variable:            m.forma_pgto                       º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Field                              º
*       º Snippet Number:      17                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0wfmk3     &&  m.forma_pgto VALID
#REGION 2
LSdbant = ALIAS()
SELECT tab002
IF LASTKEY() = 9
   ON KEY LABEL ESCAPE
   DO loc_dlog WITH .T., "tab002.tabela = 'FPG'"
   ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
   IF LASTKEY() = 27
		SELECT &LSdbant
		RETURN .F.
	ENDIF
	m.forma_pgto   = val(tab002.codigo)
ELSE
	IF !SEEK('FPG'+CHRTRAN(STR(m.forma_pgto,2)," ","0"))
		SELECT &LSdbant
		RETURN .F.
	ENDIF
ENDIF
IF  m.forma_pgto = 0
	SELECT &LSdbant
	RETURN .F.
ENDIF

IF  m.cliente = orcament.cliente AND ;
  	m.forma_pgto > 1 AND ;
	m.lim_forma <> 0 AND m.forma_pgto <> m.lim_forma
	LSstr = STR(m.lim_forma,2)
	WP_MSG =  "Forma Liberada na OSI  : "+LSstr	
	SELECT &LSdbant
	RETURN(.F.)
ENDIF
IF  m.forma_pgto > 1 AND ;
	(m.usr_libera = 0 OR m.cliente <> orcament.cliente)  AND ;
    FOUND("CLIENTES") AND clientes.forma_pgto <> 0 AND ;
    m.forma_pgto <> clientes.forma_pgto
	LSstr = STR(clientes.forma_pgto,2)
	WP_MSG = "Forma Liberada no Registro do Cadastro  : "+LSstr
	SELECT &LSdbant
	RETURN(.F.)
ENDIF

=SEEK('FPG'+CHRTRAN(STR(m.forma_pgto,2)," ","0"),"TAB002")
m.forma_pgto   = val(tab002.codigo)
m.nome_forma   = tab002.descricao

m.forma_pgto   = val(tab002.codigo)
m.nome_forma   = tab002.descricao
SHOW GET m.forma_pgto
SHOW GET m.nome_forma
DO CASE
	CASE m.forma_pgto = 1     && DINHEIRO
		 m.tp_pgto = 1
		 m.prazo   =  "000/000/000/000/000/"
		 m.vlr_ent = 0
		 DO ULdefprz
	CASE m.forma_pgto = 4 && DUPLICATAS
		 m.tp_pgto = 3
ENDCASE
SELECT tppgto
SEEK m.tp_pgto
SHOW GET m.tp_pgto
SHOW GET tppgto.descricao
SHOW GET m.prazo
SHOW GET m.vlr_ent
SELECT &LSdbant

ON KEY LABEL PGDN	DO ULvpar
ON KEY LABEL END    DO ULversaida

RETURN .T.


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0WFMK8           m.tp_pgto WHEN                     º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         OBJ_PRSO,     Record Number:   54  º
*       º Variable:            m.tp_pgto                          º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Field                              º
*       º Snippet Number:      18                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0wfmk8     &&  m.tp_pgto WHEN
#REGION 2
IF isediting AND LFjanela = 2 ;
	AND (m.forma_pgto = 2 OR m.forma_pgto = 3 OR m.forma_pgto = 4)
		ON KEY LABEL PGDN KEYBOARD "{ENTER}"
		ON KEY LABEL END  KEYBOARD "{ENTER}"
		RETURN(.T.)
ENDIF
RETURN(.F.)

*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0WFMKC           m.tp_pgto VALID                    º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         OBJ_PRSO,     Record Number:   54  º
*       º Variable:            m.tp_pgto                          º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Field                              º
*       º Snippet Number:      19                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0wfmkc     &&  m.tp_pgto VALID
#REGION 2
LSdbant = ALIAS()
SELECT tppgto
IF LASTKEY() = 9
   ON KEY LABEL ESCAPE
   DO loc_dlog WITH .T.
   ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
   IF LASTKEY() =  27
		SELECT &LSdbant
		RETURN .F.
	ENDIF
ELSE
	IF !SEEK(m.tp_pgto)
		SELECT &LSdbant
		RETURN .F.
	ENDIF
ENDIF
m.tp_pgto = tppgto.tipo

IF m.forma_pgto = 1 AND m.tp_pgto <> 1
	SELECT &LSdbant
	RETURN .F.
ENDIF
IF m.tp_pgto <> 3
	 m.prazo   =  "000/000/000/000/000/"
	 m.vlr_ent = 0
	 DO ULdefprz
ENDIF
SELECT &LSdbant
SHOW GET m.tp_pgto
SHOW GET m.prazo
SHOW GET m.vlr_ent

SHOW GET tppgto.descricao

ON KEY LABEL PGDN	DO ULvpar
ON KEY LABEL END    DO ULversaida

RETURN .T.


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0WFMKG           m.juromes VALID                    º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         OBJ_PRSO,     Record Number:   56  º
*       º Variable:            m.juromes                          º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Field                              º
*       º Snippet Number:      20                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0wfmkg     &&  m.juromes VALID
#REGION 2
=ULvpar1()		&& REAPRESENTA VALORES
RETURN(.T.)

*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0WFMKJ           m.dt WHEN                          º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         OBJ_PRSO,     Record Number:   57  º
*       º Variable:            m.dt                               º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Field                              º
*       º Snippet Number:      21                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0wfmkj     &&  m.dt WHEN
#REGION 2
IF isediting AND LFjanela = 2
	  set confirm ON
ENDIF
IF m.tp_pgto <> 3	&& 3 = > aprazo
	RETURN(.F.)
ENDIF
m.dt = m.data + VAL(LEFT(m.prazo,3))
SHOW GET m.dt
RETURN(isediting AND LFjanela = 2)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0WFMKM           m.dt VALID                         º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         OBJ_PRSO,     Record Number:   57  º
*       º Variable:            m.dt                               º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Field                              º
*       º Snippet Number:      22                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0wfmkm     &&  m.dt VALID
#REGION 2
LNdia = m.dt - m.data
m.prazo = STRTRAN(STR(LNdia,3)," ","0")+SUBS(m.prazo,4)
SHOW GET m.prazo
DO ULdefprz
RETURN(.t.)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0WFMKN           LGTD1 WHEN                         º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         OBJ_PRSO,     Record Number:   58  º
*       º Variable:            LGTD1                              º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Field                              º
*       º Snippet Number:      23                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0wfmkn     &&  LGTD1 WHEN
#REGION 2
IF m.tp_pgto <> 3	&& 3 = > aprazo
	RETURN(.F.)
ENDIF
LGTD1 = VAL(SUBS(m.prazo,1,3))
SHOW GET LGDT1
IF isediting AND LFjanela = 2
	  set confirm OFF
ENDIF
RETURN(isediting AND LFjanela = 2)

*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0WFMKS           LGTD1 VALID                        º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         OBJ_PRSO,     Record Number:   58  º
*       º Variable:            LGTD1                              º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Field                              º
*       º Snippet Number:      24                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0wfmks     &&  LGTD1 VALID
#REGION 2
IF LGTD1 <> 0
	m.vlr_ent  = 0
	SHOW GET m.vlr_ent
ENDIF
m.prazo = STRTRAN(STR(LGtd1,3)," ","0")+SUBS(m.prazo,4)
SHOW GET m.prazo
m.dt = m.data + LGTD1
SHOW GET m.dt
=ULvpar1()		&& REAPRESENTA VALORES
RETURN(.T.)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0WFMKV           LGTD2 WHEN                         º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         OBJ_PRSO,     Record Number:   59  º
*       º Variable:            LGTD2                              º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Field                              º
*       º Snippet Number:      25                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0wfmkv     &&  LGTD2 WHEN
#REGION 2
IF m.tp_pgto <> 3	&& 3 = > aprazo
	RETURN(.F.)
ENDIF
LGTD2 = VAL(SUBS(m.prazo,5,3))
SHOW GET LGDT2
RETURN(isediting AND LFjanela = 2)

*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0WFMKY           LGTD2 VALID                        º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         OBJ_PRSO,     Record Number:   59  º
*       º Variable:            LGTD2                              º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Field                              º
*       º Snippet Number:      26                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0wfmky     &&  LGTD2 VALID
#REGION 2
m.prazo = LEFT(m.prazo,4)+STRTRAN(STR(LGtd2,3)," ","0")+SUBS(m.prazo,8)
SHOW GET m.prazo
=ULvpar1()		&& REAPRESENTA VALORES
RETURN(.T.)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0WFML1           LGTD3 WHEN                         º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         OBJ_PRSO,     Record Number:   60  º
*       º Variable:            LGTD3                              º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Field                              º
*       º Snippet Number:      27                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0wfml1     &&  LGTD3 WHEN
#REGION 2
IF m.tp_pgto <> 3	&& 3 = > aprazo
	RETURN(.F.)
ENDIF
LGTD3 = VAL(SUBS(m.prazo,9,3))
SHOW GET LGDT3
RETURN(isediting AND LFjanela = 2)

*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0WFML3           LGTD3 VALID                        º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         OBJ_PRSO,     Record Number:   60  º
*       º Variable:            LGTD3                              º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Field                              º
*       º Snippet Number:      28                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0wfml3     &&  LGTD3 VALID
#REGION 2
m.prazo = LEFT(m.prazo,8)+STRTRAN(STR(LGtd3,3)," ","0")+SUBS(m.prazo,12)
SHOW GET m.prazo
=ULvpar1()		&& REAPRESENTA VALORES
RETURN(.T.)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0WFML7           LGTD4 WHEN                         º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         OBJ_PRSO,     Record Number:   61  º
*       º Variable:            LGTD4                              º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Field                              º
*       º Snippet Number:      29                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0wfml7     &&  LGTD4 WHEN
#REGION 2
IF m.tp_pgto <> 3	&& 3 = > aprazo
	RETURN(.F.)
ENDIF
LGTD4 = VAL(SUBS(m.prazo,13,3))
SHOW GET LGDT4
RETURN(isediting AND LFjanela = 2)

*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0WFML9           LGTD4 VALID                        º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         OBJ_PRSO,     Record Number:   61  º
*       º Variable:            LGTD4                              º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Field                              º
*       º Snippet Number:      30                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0wfml9     &&  LGTD4 VALID
#REGION 2
m.prazo = LEFT(m.prazo,12)+STRTRAN(STR(LGtd4,3)," ","0")+SUBS(m.prazo,16)
SHOW GET m.prazo
=ULvpar1()		&& REAPRESENTA VALORES
RETURN(.T.)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0WFMLC           LGTD5 WHEN                         º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         OBJ_PRSO,     Record Number:   62  º
*       º Variable:            LGTD5                              º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Field                              º
*       º Snippet Number:      31                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0wfmlc     &&  LGTD5 WHEN
#REGION 2
IF m.tp_pgto <> 3	&& 3 = > aprazo
	RETURN(.F.)
ENDIF
LGTD5 = VAL(SUBS(m.prazo,17,3))
SHOW GET LGDT5
IF isediting AND LFjanela = 2
	  set confirm OFF
ENDIF
RETURN(isediting AND LFjanela = 2)

*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0WFMLF           LGTD5 VALID                        º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         OBJ_PRSO,     Record Number:   62  º
*       º Variable:            LGTD5                              º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Field                              º
*       º Snippet Number:      32                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0wfmlf     &&  LGTD5 VALID
#REGION 2
m.prazo = LEFT(m.prazo,16)+STRTRAN(STR(LGtd5,3)," ","0")+SUBS(m.prazo,20)
SHOW GET m.prazo
=ULvpar1()		&& REAPRESENTA VALORES
RETURN(.T.)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0WFMLI           m.vlr_ent WHEN                     º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         OBJ_PRSO,     Record Number:   63  º
*       º Variable:            m.vlr_ent                          º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Field                              º
*       º Snippet Number:      33                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0wfmli     &&  m.vlr_ent WHEN
#REGION 2
IF isediting AND LFjanela = 2 AND LGTD1 = 0
	  set confirm ON
ENDIF
RETURN(isediting AND LFjanela = 2 AND LGTD1 = 0)

*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0WFMLK           m.vlr_ent VALID                    º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         OBJ_PRSO,     Record Number:   63  º
*       º Variable:            m.vlr_ent                          º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Field                              º
*       º Snippet Number:      34                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0wfmlk     &&  m.vlr_ent VALID
#REGION 2
=ULvpar1()		&& REAPRESENTA VALORES
return(.t.)

*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0WFMLO           m.vlrfrete VALID                   º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         OBJ_PRSO,     Record Number:   64  º
*       º Variable:            m.vlrfrete                         º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Field                              º
*       º Snippet Number:      35                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0wfmlo     &&  m.vlrfrete VALID
#REGION 2
=ULvpar1()		&& REAPRESENTA VALORES
return(.t.)

*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0WFMLQ           m.vlrseguro VALID                  º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         OBJ_PRSO,     Record Number:   65  º
*       º Variable:            m.vlrseguro                        º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Field                              º
*       º Snippet Number:      36                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0wfmlq     &&  m.vlrseguro VALID
#REGION 2
DO ULvpar
RETURN(.T.)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0WFMLT           m.prazo WHEN                       º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         OBJ_PRSO,     Record Number:   66  º
*       º Variable:            m.prazo                            º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Field                              º
*       º Snippet Number:      37                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0wfmlt     &&  m.prazo WHEN
#REGION 2
RETURN(.F.)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0WFMLW           m.prazo VALID                      º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         OBJ_PRSO,     Record Number:   66  º
*       º Variable:            m.prazo                            º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Field                              º
*       º Snippet Number:      38                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0wfmlw     &&  m.prazo VALID
#REGION 2
LNocorrenc = 1
LNposic    = 0
LNinicio   = 1
LNdiant    = 0
wp_msg = ""
DO WHILE .t.
        LNposic = AT("/",m.prazo, LNocorrenc)
		IF LNposic = 0
			EXIT
		ENDIF
        LNdias     = INT(VAL(SUBS(m.prazo,LNinicio,3)))
		IF LNdias <= LNdiant and LNocorrenc > 1
			LStmp = LEN(m.prazo)
			m.prazo = LEFT(LEFT(m.prazo,LNinicio-1)+	;
					 "000/000/000/000/000/",LStmp)
			SHOW GET m.prazo
			EXIT
        ENDIF
        LNdiant    = LNdias
		LNocorrenc = LNocorrenc + 1
        LNinicio   = LNposic + 1
ENDDO
IF !EMPTY(wp_msg)
	RETURN(.F.)
ENDIF
m.dt = m.data + VAL(LEFT(m.prazo,3))
SHOW GET m.dt
RETURN(.T.)

*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0WFMM0           GET_1ITEM WHEN                     º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         ITEM,     Record Number:    2      º
*       º Variable:            GET_1ITEM                          º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Field                              º
*       º Snippet Number:      39                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0wfmm0     &&  GET_1ITEM WHEN
#REGION 3
ON KEY LABEL END    DO ULversaida
ON KEY LABEL ESCAPE DO ULvoltacampo
ON KEY LABEL UPARROW DO ULvoltacampo
****** ON KEY LABEL DNARROW DO UL1passalin

*ON KEY LABEL F4    DO ULposiclinha
ON KEY LABEL F5     DO ULposiccampo with "CODIGO"
ON KEY LABEL F12    DO OBJ_CALC.SPR

ON KEY LABEL PGDN	DO ULvpar
ON KEY LABEL CTRL-T DO brtotal WITH .T.
ON KEY LABEL CTRL-Y DO brdeleta
ON KEY LABEL CTRL-N DO brappend

SET POINT TO "."
SET SEPARATOR  TO ","
IF LFjanela = 3
	BROWSE  FIELDS 	CODIGO		;
			:H="CODIGO";
			:P=masc_codi;
			:W=ULinfcamp("CODIGO","W");
			:V=ULverprod() AND ULinfcamp("CODIGO"," ");
			:F,;
		QTDE		:H="QTDE";
			:P="@r 9999";
			:W=(ULextcond() OR (left(situacao,1) $ "IE")) AND ;
							   ULinfcamp("QTDE","W");
			:V=ULversald() AND ULinfcamp("QTDE","V");
			:F,;
		UNIDADE 	:H="UN";
			:P="XX";
			:W=LEFT(codigo,4)="9999" AND ULinfcamp("UNIDADE"," "),;
		DESCRICAO	:H="DESCRICAO"  :17;
			:P="@S19";
			:W=(LEFT(codigo,4)="9999" OR tp_mercad = 5 OR tp_mercad = 6);
				 AND ULextcond() AND ULinfcamp("DESCRICAO"," "),;
		PRECO		:H="PRECO";
			:P="@r 99,999.99";
			:W=	(LEFT(codigo,4)="9999" OR INFO_VLR="S" OR PRECO < 0.20);
				AND ULextcond() AND ULinfcamp("PRECO","W");
			:V=ULinfcamp("PRECO","V");
			:F,;
		DESCONTO 	:H="%DESC";
			:W=	ULinfcamp("DESCONTO","W");
			:P="@r 999.99";
			:V=ULinfcamp("DESCONTO","V");
            :F,;
		PRECOFINAL	:H="LIQ.UNI";
			:W= ULinfcamp("PRECOFINAL","W");
			:P="@r 99,999.99";
			:V=ULcalcvlr("PRECOFINAL") AND ULinfcamp("PRECOFINAL","V");
			:F,;
		VLRVENDA	:H="TOTAL";
			:W= ULinfcamp("VLRVENDA","W");
			:P="@r 999,999.99";
			:V=ULcalcvlr("VLRVENDA") AND ULinfcamp("VLRVENDA","V")  ;
			:F,;
		CST			:H="T";
			:P="9"	:W=ULinfcamp("CST"," ") AND LEFT(codigo,4)="9999" ;
			AND ULextcond() :V=!EMPTY(CST) AND ULcalcvlr("VLRVENDA") ;
			:F,;
		VLRIPI		:H="IPI";
			:P="@r 999,999.99";
			:W=ULinfcamp("VLRIPI"," ") AND .F.;
			:V=ULinfcamp("VLRIPI"," ");
			:F,;
		SITUACAO	:H="";
			:W=.f.	OR (UL1passalin() AND !LFpaslin);
    TITLE "ITENS" COLOR SCHEME 10 NODELETE NOAPPEND NOCLEAR NORMAL WIND ITEM
ENDIF

ON KEY LABEL UPARROW
ON KEY LABEL DNARROW

RETURN(.F.)
