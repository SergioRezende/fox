*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є 20/07/2015            SVD0500.SPR              10:11:41 є
*       є                                                         є
*       ЗДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД¶
*       є                                                         є
*       є Author's Name                                           є
*       є                                                         є
*       є Copyright (c) 2015 Company Name                         є
*       є Address                                                 є
*       є City,     Zip                                           є
*       є                                                         є
*       є Description:                                            є
*       є This program was automatically generated by GENSCRN.    є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ

PARAMETERS lsprograma

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є          SVD0500/MS-DOS Setup Code - SECTION 1          є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1



*~ WIZARDSCREEN
#DEFINE C_DBFEMPTY		'Database is empty, add a record?'
#DEFINE C_DELREC		'Apagar Registro Selecionado ?'
#DEFINE C_ENDFILE		'Final do Arquivo.'
#DEFINE C_CANCORCA   	'Confirma o Cancelamento do Orcamento ? '
#DEFINE C_APROORCA   	'Confirma o Aprovacao do Orcamento ?'
*---------------------------------------------------------------------*
* ARQUIVOS UTILIZADOS :                                               *
*              - ORCAMENT
*              - ORCATMP
*              - EMPRESA
*              - TIPOOPER
*              - CLIENTES
*              - TAB_CITA
*              - PARAMETR
*              - NOTA
*              - NF_ANEXO
*              - TPPGTO
*              - TAB_CST
*              - SALDO
*              - ITEMMOV
*              - GRUPO  =>OBJ_ITOR
*              - PRECO  =>OBJ_ITOR
*              - PROD_CMS  =>OBJ_ITOR
*              - TAB001
*              - TAB002
*              - TRANSPRT
*              - BANCO
*              - DUPLICAT
* OBJETIVOS : VENDAS
*---------------------------------------------------------------------*
******>>>> INICIO CONTROLE AMBIENTAL
m.wzalias		=	SELECT()
m.isediting		=	.F.
m.isadding		=	.F.
m.isreading 	=   .F.
m.is2table 		= 	.F.
WP_RECORD 		= 	0
wp_ref_local 	=  .T.     &&  POSSUI CONTROLE DE REFRESH LOCAL
LSjanela		= ""		&&  NOME DA JANELA AUX ATIVA
LSj_var 		= ""		&&  NOME DO BOTAO INVISIVEL DA JANELA ATIVA
LN_prxobj 		= 0	 		&&  ORIENTA A SAIDA DE EDICAO DE TELAS COMPLEM.
wl_vendedor 	=  nUsr   && contem o codigo do vendedor atual
LFpendente		= .F.		&& Acessa somente orc. nao Fat e nao Canc
m.ver           = 1
******************************************************
DIMENSION VTLmotivo[9] && MOTIVOS DAS OPERACOES. ATRIB. CONF OPERACAO
STORE 0 TO VTLmotivo
*******************************************************
********>>>>>> INTERESE LOCAL
PRIVATE   wl_cota, iscancela, LSprgativo
LSprgativo = "SCGC201"

DIMENSION VTLservfx[9] && Serv. comissionados fixos
STORE 0 TO VTLservfx
wl_cota     	= .f.
iscancela   	= .f.
isediprz    	= .t.     && Permite ou nao a edicao dos prasos
******>>>> INICIO CONTROLE ARQUIVOS
IF m.ver = 1					&& ver proprios
	VLleitura = "STR(wp_empresa,3)+STR(wl_vendedor,4)"
			            * repassa chave de leitura p/ btn_val
	VLlerfim  = "STR(wp_empresa,3)+STR(wl_vendedor+1,4)"
           * repassa chave de leitura p/ btn_val (POSICAO FINAL + 1 REG)
	VLcompara = ;
	 "orcament.empresa = wp_empresa AND orcament.operador = wl_vendedor "
                         * repassa chave de comparacao p/ btn_val
	VLchvlimi = "STR(wp_empresa,3)+STR(wl_vendedor,4)"
						 * otimiza browse

ELSE							&& ver todos
	VLleitura = "STR(wp_empresa,3)"
          * repassa chave de leitura p/ btn_val
	VLlerfim  = "STR(wp_empresa+1,3)"
          * repassa chave de leitura p/ btn_val (POSICAO FINAL + 1 REG)
	VLcompara = "orcament.empresa = wp_empresa"
          * repassa chave de comparacao p/ btn_val
	VLchvlimi = "STR(wp_empresa,3)"   && otimiza browse
ENDIF
**

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є          SVD0520/MS-DOS Setup Code - SECTION 1          є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 3
	*------------------------------------------------------------*
	* CLASSIFICACAO:  [*****]
	*------------------------------------------------------------*
	* OBJETIVO....: Trabalhar Ferramentas Relacionadas oa Orcamento
	*				e Faturamento
	*------------------------------------------------------------*
	* COMENTARIO..:
	*------------------------------------------------------------*
	* OBS........ :
	*------------------------------------------------------------*
	*  TABELAS....:
	*------------------------------------------------------------*
	*  PARAMETROS..:
	*		LNemp..........: Empresa Operadora do Sistema
	*		LSchamador.....: Identifica o Motivo da Chamada a Fer-
	*					ramentas permitindo selecionar opcoes
	*------------------------------------------------------------*
	*  RETORNO.....:
	*------------------------------------------------------------*
	* EXEMPLO :
	*------------------------------------------------------------*

#REGION 0
REGIONAL m.currarea, m.talkstat, m.compstat

IF SET("TALK") = "ON"
	SET TALK OFF
	m.talkstat = "ON"
ELSE
	m.talkstat = "OFF"
ENDIF
m.compstat = SET("COMPATIBLE")
SET COMPATIBLE FOXPLUS

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є                MS-DOS Window definitions                є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

IF NOT WEXIST("svd0500") ;
	OR UPPER(WTITLE("SVD0500")) == "SVD0500.PJX" ;
	OR UPPER(WTITLE("SVD0500")) == "SVD0500.SCX" ;
	OR UPPER(WTITLE("SVD0500")) == "SVD0500.MNX" ;
	OR UPPER(WTITLE("SVD0500")) == "SVD0500.PRG" ;
	OR UPPER(WTITLE("SVD0500")) == "SVD0500.FRX" ;
	OR UPPER(WTITLE("SVD0500")) == "SVD0500.QPR"
	DEFINE WINDOW svd0500 ;
		FROM 1, 23 ;
		TO 20,79 ;
		TITLE "SVD0500" ;
		FLOAT ;
		NOCLOSE ;
		MINIMIZE ;
		NONE ;
		COLOR SCHEME 1
ENDIF

IF NOT WEXIST("navega") ;
	OR UPPER(WTITLE("NAVEGA")) == "NAVEGA.PJX" ;
	OR UPPER(WTITLE("NAVEGA")) == "NAVEGA.SCX" ;
	OR UPPER(WTITLE("NAVEGA")) == "NAVEGA.MNX" ;
	OR UPPER(WTITLE("NAVEGA")) == "NAVEGA.PRG" ;
	OR UPPER(WTITLE("NAVEGA")) == "NAVEGA.FRX" ;
	OR UPPER(WTITLE("NAVEGA")) == "NAVEGA.QPR"
	DEFINE WINDOW navega ;
		FROM 22, 0 ;
		TO 24,79 ;
		FLOAT ;
		NOCLOSE ;
		NOMINIMIZE ;
		NONE ;
		COLOR SCHEME 1
ENDIF

IF NOT WEXIST("svd0520") ;
	OR UPPER(WTITLE("SVD0520")) == "SVD0520.PJX" ;
	OR UPPER(WTITLE("SVD0520")) == "SVD0520.SCX" ;
	OR UPPER(WTITLE("SVD0520")) == "SVD0520.MNX" ;
	OR UPPER(WTITLE("SVD0520")) == "SVD0520.PRG" ;
	OR UPPER(WTITLE("SVD0520")) == "SVD0520.FRX" ;
	OR UPPER(WTITLE("SVD0520")) == "SVD0520.QPR"
	DEFINE WINDOW svd0520 ;
		FROM 1, 0 ;
		TO 24,21 ;
		TITLE "SVD0520" ;
		NOFLOAT ;
		NOCLOSE ;
		NOMINIMIZE ;
		NONE ;
		COLOR SCHEME 1
ENDIF

IF NOT WEXIST("svd0500r") ;
	OR UPPER(WTITLE("SVD0500R")) == "SVD0500R.PJX" ;
	OR UPPER(WTITLE("SVD0500R")) == "SVD0500R.SCX" ;
	OR UPPER(WTITLE("SVD0500R")) == "SVD0500R.MNX" ;
	OR UPPER(WTITLE("SVD0500R")) == "SVD0500R.PRG" ;
	OR UPPER(WTITLE("SVD0500R")) == "SVD0500R.FRX" ;
	OR UPPER(WTITLE("SVD0500R")) == "SVD0500R.QPR"
	DEFINE WINDOW svd0500r ;
		FROM INT((SROW()-60)/2),INT((SCOL()-77)/2) ;
		TO INT((SROW()-60)/2)+59,INT((SCOL()-77)/2)+76 ;
		NOFLOAT ;
		NOCLOSE ;
		SHADOW ;
		NOMINIMIZE ;
		NONE ;
		COLOR SCHEME 1
ENDIF


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є          SVD0500/MS-DOS Setup Code - SECTION 2          є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1
******>>>> INICIO CONTROLE LOCAL

DO CASE
	CASE !wp_flgfecha
		SELE empresa
		SET ORDER TO TAG empresa
		SEEK wp_empresa
		SELE orcament
		SET ORDER TO TAG orcamento
		IF m.ver = 1					&& ver proprios
			SET ORDER TO TAG vend_orca
			SET NEAR ON
			SEEK STR(wp_empresa,3)+STR(wl_vendedor,4)
			SET NEAR OFF
		ELSE							&& ver todos
			SET ORDER TO TAG orcamento
			SET NEAR ON
			SEEK STR(wp_empresa,3)
			SET NEAR OFF
		ENDIF

		SCATTER MEMVAR MEMO BLANK
		*-------------------------> criado pelo wizard
		m.wzalias=SELECT()
		m.isreadonly=IIF(ISREAD(),.T.,.F.)
		IF m.isreadonly
			WAIT WINDOW C_READONLY TIMEOUT 1
		ENDIF
		KEYBOARD "{F}"
ENDCASE


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є          SVD0520/MS-DOS Setup Code - SECTION 2          є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 3
	=W_DEFPROC("rotinas.spr")
	CLEAR TYPEAHEAD



*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є              SVD0500/MS-DOS Screen Layout               є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1
IF WVISIBLE("svd0500")
	ACTIVATE WINDOW svd0500 SAME
ELSE
	ACTIVATE WINDOW svd0500 NOSHOW
ENDIF
@ 11,2 SAY "-" ;
	SIZE 1,1, 0
@ 13,42 SAY "-" ;
	SIZE 1,1, 0
@ 15,7 SAY "-" ;
	SIZE 1,1, 0
@ 8,14 SAY "Tel:" ;
	SIZE 1,4, 0
@ 10,10 SAY "No:" ;
	SIZE 1,3, 0
@ 10,1 SAY "Tp.Ins:" ;
	SIZE 1,7, 0
@ 14,1 SAY "Vendedor" ;
	SIZE 1,8, 0
@ 8,1 SAY "UF" ;
	SIZE 1,2, 0
@ 8,4 SAY "CEP" ;
	SIZE 1,3, 0
@ 5,37 SAY "-" ;
	SIZE 1,1, 0
@ 0,0 TO 19,56 DOUBLE ;
	COLOR SCHEME 23
@ 19,1 TO 19,55 DOUBLE ;
	COLOR SCHEME 24
@ 1,56 TO 18,56 DOUBLE ;
	COLOR SCHEME 24
@ 12,26 SAY "Natu" ;
	SIZE 1,4, 0
@ 13,27 SAY "-" ;
	SIZE 1,1, 0
@ 14,18 SAY "Nota" ;
	SIZE 1,4, 0
@ 14,26 SAY "Data Fat." ;
	SIZE 1,9, 0
@ 19,56 SAY "ј" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 0,56 SAY "»" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 6,1 SAY "Endereco" ;
	SIZE 1,8, 0
@ 6,21 SAY "Setor" ;
	SIZE 1,5, 0
@ 6,40 SAY "Cidade" ;
	SIZE 1,6, 0
@ 15,38 SAY "TOTAL=>" ;
	SIZE 1,7, 0
@ 1,47 SAY "/" ;
	SIZE 1,1, 0
@ 12,37 SAY "Tp.Parcelamento" ;
	SIZE 1,15, 0
@ 0,47 SAY "[SVD0500]" ;
	SIZE 1,9, 0
@ 1,40 SAY "Nro:" ;
	SIZE 1,4, 0
@ 3,40 SAY "Vias" ;
	SIZE 1,4, 0
@ 4,34 SAY "Tipo" ;
	SIZE 1,4, 0
@ 4,1 SAY "Cliente" ;
	SIZE 1,7, 0
@ 12,1 SAY "Veiculo" ;
	SIZE 1,7, 0
@ 12,14 SAY "Placa" ;
	SIZE 1,5, 0
@ 0,16 SAY "-" ;
	SIZE 1,1, 0
@ 0,8 SAY "<  Stt" ;
	SIZE 1,6, 0
@ 0,40 SAY "  >" ;
	SIZE 1,3, 0
@ 0,14 GET orcament.situacao ;
	SIZE 1,2 ;
	DEFAULT " " ;
	WHEN .f.
@ 0,17 GET m.nome_sit ;
	SIZE 1,23 ;
	DEFAULT " " ;
	WHEN .f.
@ 1,1 GET orcament.natu_oper ;
	PICTURE "@^ \<Venda;\<Transferencia;\<S. Remessa;\<Devolucao a Forn.;\<Requisicao" ;
	SIZE 3,14 ;
	DEFAULT "Venda" ;
	WHEN .F. ;
	VALID _4ei0lums9() ;
	COLOR SCHEME 1, 2
@ 1,15 GET orcament.motivo ;
	PICTURE "@^" ;
	FROM VTLmotivo ;
	SIZE 3,25 ;
	DEFAULT 1 ;
	WHEN _4ei0lumsg() ;
	COLOR SCHEME 1, 2
@ 1,44 GET orcament.empresa ;
	SIZE 1,3 ;
	DEFAULT 0 ;
	PICTURE "999" ;
	WHEN .f.
@ 1,48 GET m.orcamento ;
	SIZE 1,7 ;
	DEFAULT " " ;
	PICTURE "@K 999,999" ;
	WHEN isreading ;
	VALID _4ei0lumsh() ;
	ERROR WP_MSG
@ 2,40 GET orcament.data ;
	SIZE 1,10 ;
	DEFAULT " " ;
	PICTURE "@K" ;
	WHEN .F.
@ 2,51 GET orcament.hora ;
	SIZE 1,5 ;
	DEFAULT " " ;
	PICTURE "@K XXXXX" ;
	WHEN .f.
@ 3,44 GET orcament.vias_osi ;
	SIZE 1,3 ;
	DEFAULT 0 ;
	PICTURE "999" ;
	WHEN .f.
@ 4,9 GET m.cgccliente ;
	SIZE 1,19 ;
	DEFAULT " " ;
	PICTURE "@R 99.999.999/9999-99" ;
	WHEN _4ei0lumsi()
@ 5,2 GET clienc.nome ;
	SIZE 1,27 ;
	DEFAULT " " ;
	PICTURE "@K" ;
	WHEN .F.
@ 5,34 GET orcament.tipo ;
	SIZE 1,3 ;
	DEFAULT " " ;
	PICTURE "@!" ;
	WHEN .F.
@ 5,38 GET m.natureza ;
	SIZE 1,18 ;
	DEFAULT " " ;
	WHEN .f.
@ 7,2 GET clienc.endereco ;
	SIZE 1,18 ;
	DEFAULT " " ;
	WHEN .F.
@ 7,21 GET clienc.bairro ;
	SIZE 1,17 ;
	DEFAULT " " ;
	PICTURE "@!" ;
	WHEN .F.
@ 7,40 GET clienc.cidade ;
	SIZE 1,12 ;
	DEFAULT " " ;
	PICTURE "@!" ;
	WHEN .F.
@ 9,1 GET clienc.estado ;
	SIZE 1,2 ;
	DEFAULT " " ;
	PICTURE "@! XX" ;
	WHEN .F. ;
	ERROR 'Sigla Nao identificada'
@ 9,4 GET clienc.cep ;
	SIZE 1,9 ;
	DEFAULT " " ;
	PICTURE "99999-999" ;
	WHEN .F.
@ 9,14 GET clienc.fone ;
	SIZE 1,14 ;
	DEFAULT " " ;
	WHEN .F.
@ 11,1 GET clienc.tp_inscr ;
	SIZE 1,1 ;
	DEFAULT 0 ;
	PICTURE "9" ;
	WHEN .F.
@ 11,3 GET m.nome_inscr ;
	SIZE 1,6 ;
	DEFAULT " " ;
	WHEN .f.
@ 11,10 GET clienc.inscricao ;
	SIZE 1,18 ;
	DEFAULT " " ;
	WHEN .F.
@ 13,2 GET orcament.veiculo ;
	SIZE 1,11 ;
	DEFAULT " " ;
	WHEN .F.
@ 13,15 GET orcament.placa ;
	SIZE 1,7 ;
	DEFAULT " " ;
	WHEN .F.
@ 13,26 GET clienc.natu_cli ;
	SIZE 1,1 ;
	DEFAULT 0 ;
	PICTURE "9" ;
	WHEN .F. ;
	ERROR "S => Sim  //  N => Nao "
@ 13,28 GET m.nome_natu ;
	SIZE 1,8 ;
	DEFAULT " " ;
	WHEN .f.
@ 13,40 GET orcament.tp_parcela ;
	SIZE 1,2 ;
	DEFAULT 0 ;
	PICTURE "99" ;
	WHEN .F.
@ 13,43 GET m.nome_parcela ;
	SIZE 1,12 ;
	DEFAULT " " ;
	WHEN .f.
@ 15,3 GET orcament.operador ;
	SIZE 1,4 ;
	DEFAULT 0 ;
	PICTURE "9999" ;
	WHEN .f. ;
	ERROR "Usuario nao Cadastrado no sistema"
@ 15,8 GET m.nome_vend ;
	SIZE 1,9 ;
	DEFAULT " " ;
	WHEN .F.
@ 15,18 GET orcament.nota ;
	SIZE 1,7 ;
	DEFAULT " " ;
	PICTURE "@K 9999999" ;
	WHEN .f.
@ 15,26 GET orcament.dt_fat ;
	SIZE 1,10 ;
	DEFAULT " " ;
	PICTURE "@K" ;
	WHEN .f.
@ 15,45 GET orcament.valor ;
	SIZE 1,10 ;
	DEFAULT " " ;
	PICTURE "@K 999,999.99" ;
	WHEN .F.
@ 19,1 GET m.FR_btn ;
	PICTURE "@*HN Fe\<Rramenas" ;
	SIZE 1,12,1 ;
	DEFAULT 1 ;
	VALID _4ei0lumsj() ;
	MESSAGE 'Processa Reserva de Mercadoria'
@ 19,13 GET m.obs_btn ;
	PICTURE "@*HN \<H-Observacao" ;
	SIZE 1,14,1 ;
	DEFAULT 1 ;
	VALID _4ei0lumsk() ;
	MESSAGE 'Primeiro registro'
@ 16,3 EDIT M.OBS ;
	SIZE 3,52,0 ;
	DEFAULT " " ;
	WHEN .F.
@ 19,27 GET ImpVend_btn ;
	PICTURE "@*HN I\<mp Negociacao" ;
	SIZE 1,16,5 ;
	DEFAULT 1 ;
	WHEN _4ei0lumsl() ;
	VALID _4ei0lumto()
@ 8,29 SAY "IBGE" ;
	SIZE 1,4, 0
@ 9,29 GET clienc.muni_ibge ;
	SIZE 1,11 ;
	DEFAULT 0 ;
	WHEN .f.
@ 19,44 GET ImpBTS_btn ;
	PICTURE "@*HN \<U-Gera Bts" ;
	SIZE 1,12,5 ;
	DEFAULT 1 ;
	WHEN .T. ;
	VALID _4ei0lumtv()




*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є              OBJ_WNAV/MS-DOS Screen Layout              є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 2
IF WVISIBLE("navega")
	ACTIVATE WINDOW navega SAME
ELSE
	ACTIVATE WINDOW navega NOSHOW
ENDIF
@ 1,8 GET m.top_btn ;
	PICTURE "@*HN \<Inicio" ;
	SIZE 1,8,1 ;
	DEFAULT 1 ;
	VALID BTN_VAL1('TOP', VLleitura, Vlcompara) ;
	MESSAGE 'Primeiro registro'
@ 1,16 GET m.prev_btn ;
	PICTURE "@*HN \<Ant" ;
	SIZE 1,5,1 ;
	DEFAULT 1 ;
	VALID btn_val1('PREV', VLleitura, Vlcompara) ;
	MESSAGE 'Posiciona no registro anterior.' 	
@ 1,21 GET m.next_btn ;
	PICTURE "@*HN \<Proximo" ;
	SIZE 1,9,1 ;
	DEFAULT 1 ;
	VALID btn_val1('NEXT', VLleitura, Vlcompara) ;
	MESSAGE 'Avanca para proximo registro'
@ 1,30 GET m.end_btn ;
	PICTURE "@*HN \<Fim" ;
	SIZE 1,5,1 ;
	DEFAULT 1 ;
	VALID btn_val1('END', VLlerfim, Vlcompara) ;
	MESSAGE 'Ultimo registro do arquivo' 																																													
@ 1,35 GET m.loc_btn ;
	PICTURE "@*HN \<Zoom" ;
	SIZE 1,6,1 ;
	DEFAULT 1 ;
	VALID btn_val1('LOCATE', VLleitura, Vlcompara,VLchvlimi)		 ;
	MESSAGE 'Permite consulta visual ampliada a varios registros na tela'
@ 1,41 GET m.add_btn ;
	PICTURE "@*HN \<Lanca" ;
	SIZE 1,7,1 ;
	DEFAULT 1 ;
	VALID btn_val1('ADD') ;
	MESSAGE 'Abre novo registro para lancamento de dados' 
@ 1,55 GET m.edit_btn ;
	PICTURE "@*HN \<Edit" ;
	SIZE 1,6,1 ;
	DEFAULT 1 ;
	VALID btn_val1('EDIT') ;
	MESSAGE 'Permite a alteracao de dados do registro corrente'
@ 1,61 GET m.del_btn ;
	PICTURE "@*HN \<Del" ;
	SIZE 1,5,1 ;
	DEFAULT 1 ;
	VALID btn_val1('DELETE', VLleitura, Vlcompara) ;
	MESSAGE 'Delete current record.'
@ 1,73 GET m.exit_btn ;
	PICTURE "@*HN \<Sair" ;
	SIZE 1,6,1 ;
	DEFAULT 1 ;
	VALID btn_val1('EXIT') ;
	MESSAGE 'Close screen.'
@ 1,48 GET m.cop_btn ;
	PICTURE "@*HN \<Copia" ;
	SIZE 1,7,1 ;
	DEFAULT 1 ;
	VALID btn_val1('COPY') ;
	MESSAGE 'Abre novo registro sel limpar os dados do reg corrente' 
@ 1,1 GET m.busca_btn ;
	PICTURE "@*HN \<Busca" ;
	SIZE 1,7,1 ;
	DEFAULT 1 ;
	VALID BTN_VAL1('BUSCA') ;
	MESSAGE 'Busca dirata pela chave do documento.'
@ 1,66 GET m.imp_btn ;
	PICTURE "@*HN i\<Mpr" ;
	SIZE 1,6,1 ;
	DEFAULT 1 ;
	VALID btn_val1('PRINT') ;
	MESSAGE 'Close screen.'
@ 0,0 TO 2,79 DOUBLE ;
	COLOR SCHEME 24
@ 2,1 TO 2,78 DOUBLE ;
	COLOR SCHEME 23
@ 1,79 SAY "і" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 0,79 SAY "»" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 2,79 SAY "ј" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 1,79 SAY "є" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23




*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є              SVD0520/MS-DOS Screen Layout               є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 3
IF WVISIBLE("svd0520")
	ACTIVATE WINDOW svd0520 SAME
ELSE
	ACTIVATE WINDOW svd0520 NOSHOW
ENDIF
@ 0,0 TO 23,21 ;
	COLOR SCHEME 23
@ 1,21 TO 23,21 ;
	COLOR SCHEME 24
@ 0,21 SAY "ї" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 23,21 SAY "Щ" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 23,1 TO 23,20 ;
	COLOR SCHEME 24
@ 1,1 GET m.VP_btn ;
	PICTURE "@*HN \<1-Abre Orcamento" ;
	SIZE 1,18,1 ;
	DEFAULT 1 ;
	VALID _4ei0lumu6() ;
	MESSAGE 'Processa Reserva de Mercadoria'
@ 2,1 GET m.rm_btn ;
	PICTURE "@*HN \<2-Reserva" ;
	SIZE 1,11,1 ;
	DEFAULT 1 ;
	VALID _4ei0lumu7() ;
	MESSAGE 'Processa Reserva de Mercadoria'
@ 3,1 GET m.osi_btn ;
	PICTURE "@*HN \<3-Imprime OSI" ;
	SIZE 1,15,1 ;
	DEFAULT 1 ;
	VALID _4ei0lumu8() ;
	MESSAGE 'Primeiro registro'
@ 4,1 GET m.fat_btn ;
	PICTURE "@*HN \<4-Envia P/ Fat" ;
	SIZE 1,16,1 ;
	DEFAULT 1 ;
	VALID _4ei0lumu9() ;
	MESSAGE 'Primeiro registro'
@ 5,1 GET m.cnfcha_btn ;
	PICTURE "@*HN \<Y-Canc.Envio Fat." ;
	SIZE 1,19,1 ;
	DEFAULT 1 ;
	VALID _4ei0lumua() ;
	MESSAGE 'Primeiro registro'
@ 6,1 GET m.CNosi_btn ;
	PICTURE "@*VN \<5-Cancela OSI" ;
	SIZE 1,15,1 ;
	DEFAULT 1 ;
	VALID _4ei0lumub() ;
	MESSAGE 'Primeiro registro'
@ 7,1 GET m.cr_btn ;
	PICTURE "@*HN \<6-Canc.Reserva" ;
	SIZE 1,16,1 ;
	DEFAULT 1 ;
	VALID _4ei0lumuc() ;
	MESSAGE 'Primeiro registro'
@ 8,1 GET m.co_btn ;
	PICTURE "@*HN \<7-Canc.Orcamento" ;
	SIZE 1,18,1 ;
	DEFAULT 1 ;
	VALID _4ei0lumvb() ;
	MESSAGE 'Primeiro registro'
@ 9,1 GET m.lib_btn ;
	PICTURE "@*HN \<8-Libera Credito" ;
	SIZE 1,18,1 ;
	DEFAULT 1 ;
	VALID _4ei0lumvh() ;
	MESSAGE 'Primeiro registro'
@ 10,1 GET m.cnlib_btn ;
	PICTURE "@*HN \<9-Lib.CR-Geral" ;
	SIZE 1,16,1 ;
	DEFAULT 1 ;
	VALID _4ei0lumvn() ;
	MESSAGE 'Primeiro registro'
@ 12,1 GET m.item_btn ;
	PICTURE "@*HN Edicao de ite\<Ns" ;
	SIZE 1,17,1 ;
	DEFAULT 1 ;
	VALID _4ei0lumvo()
@ 13,1 GET m.tab_btn ;
	PICTURE "@*HN \<Tab Precos Saldos" ;
	SIZE 1,19,1 ;
	DEFAULT 1 ;
	VALID _4ei0lumvp() ;
	MESSAGE 'Processa Reserva de Mercadoria'
@ 14,1 GET m.prot_btn ;
	PICTURE "@*HN \<J-Protege OSI" ;
	SIZE 1,15,1 ;
	DEFAULT 1 ;
	VALID _4ei0lumvq() ;
	MESSAGE 'Primeiro registro'
@ 15,1 GET m.oper_btn ;
	PICTURE "@*HN Altera \<Operador" ;
	SIZE 1,17,1 ;
	DEFAULT 1 ;
	VALID _4ei0lumvr() ;
	MESSAGE 'Primeiro registro'
@ 16,1 GET m.cad_btn ;
	PICTURE "@*HN \<k-Cadastro Cliente" ;
	SIZE 1,20,1 ;
	DEFAULT 1 ;
	VALID _4ei0lumvs() ;
	MESSAGE 'Processa Reserva de Mercadoria'
@ 17,1 GET m.nro_btn ;
	PICTURE "@*HN \<Q-No.NF" ;
	SIZE 1,9,1 ;
	DEFAULT 1 ;
	VALID _4ei0lumwq() ;
	MESSAGE 'Primeiro registro'
@ 18,1 GET m.stcr_btn ;
	PICTURE "@*HN \<Valida Dados/Sit.Cr" ;
	SIZE 1,21,1 ;
	DEFAULT 1 ;
	VALID _4ei0lumwx()
@ 19,1 GET m.reimp_btn ;
	PICTURE "@*HN \<0-OSI-Reimpr" ;
	SIZE 1,14,1 ;
	DEFAULT 1 ;
	VALID _4ei0lumx3() ;
	MESSAGE 'Primeiro registro'
@ 20,1 GET m.ver ;
	PICTURE "@*RVN \<X-Ver Proprios  ;\<W-Ver Todos;\<G-Visao Geral " ;
	SIZE 1,20,0 ;
	DEFAULT 1 ;
	VALID _4ei0lumx4()
@ 11,1 GET m.cnslt_btn ;
	PICTURE "@*HN \<- -Cons Lib.Cred" ;
	SIZE 1,18,1 ;
	DEFAULT 1 ;
	VALID _4ei0lumx5() ;
	MESSAGE 'Primeiro registro'




*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є              SVD0500R/MS-DOS Screen Layout              є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 4
IF WVISIBLE("svd0500r")
	ACTIVATE WINDOW svd0500r SAME
ELSE
	ACTIVATE WINDOW svd0500r NOSHOW
ENDIF
@ 1,2 GET ULAbreOrcamento ;
	PICTURE "@*HN ULAbreOrcamento" ;
	SIZE 1,17,1 ;
	DEFAULT 1 ;
	WHEN .F. ;
	VALID _4ei0lumx7() ;
	MESSAGE 'Processa Reserva de Mercadoria'
@ 2,2 GET ULReserva ;
	PICTURE "@*HN ULReserva" ;
	SIZE 1,11,1 ;
	DEFAULT 1 ;
	WHEN .F. ;
	VALID _4ei0lumx8() ;
	MESSAGE 'Processa Reserva de Mercadoria'
@ 3,2 GET ULImprimeOSI ;
	PICTURE "@*HN ULImprimeOSI" ;
	SIZE 1,14,1 ;
	DEFAULT 1 ;
	WHEN .F. ;
	VALID _4ei0lumx9() ;
	MESSAGE 'Primeiro registro'
@ 4,2 GET ULEnviaPFat ;
	PICTURE "@*HN ULEnviaPFat" ;
	SIZE 1,13,1 ;
	DEFAULT 1 ;
	WHEN .F. ;
	VALID _4ei0lumy8() ;
	MESSAGE 'Primeiro registro'
@ 5,2 GET ULCancEnvioFat ;
	PICTURE "@*HN ULCancEnvioFat" ;
	SIZE 1,16,1 ;
	DEFAULT 1 ;
	WHEN .F. ;
	VALID _4ei0lumyg() ;
	MESSAGE 'Primeiro registro'
@ 6,2 GET ULCancelaOSI ;
	PICTURE "@*VN ULCancelaOSI" ;
	SIZE 1,14,1 ;
	DEFAULT 1 ;
	WHEN .F. ;
	VALID _4ei0lumyn() ;
	MESSAGE 'Primeiro registro'
@ 7,2 GET ULCancReserva ;
	PICTURE "@*HN ULCancReserva" ;
	SIZE 1,15,1 ;
	DEFAULT 1 ;
	WHEN .F. ;
	VALID _4ei0lumyo() ;
	MESSAGE 'Primeiro registro'
@ 8,2 GET ULCancOrcamento ;
	PICTURE "@*HN ULCancOrcamento" ;
	SIZE 1,17,1 ;
	DEFAULT 1 ;
	WHEN .F. ;
	VALID _4ei0lumyp() ;
	MESSAGE 'Primeiro registro'
@ 15,2 GET ULLiberaCredito ;
	PICTURE "@*HN ULLiberaCredito" ;
	SIZE 1,17,1 ;
	DEFAULT 1 ;
	WHEN .F. ;
	VALID _4ei0lumyq() ;
	MESSAGE 'Primeiro registro'
@ 17,2 GET ULLibCRGeral ;
	PICTURE "@*HN ULLibCRGeral" ;
	SIZE 1,14,1 ;
	DEFAULT 1 ;
	WHEN .F. ;
	VALID _4ei0lumyr() ;
	MESSAGE 'Primeiro registro'
@ 22,2 GET ULEdicaodeItens ;
	PICTURE "@*HN ULEdicaodeItens" ;
	SIZE 1,17,1 ;
	DEFAULT 1 ;
	WHEN .F. ;
	VALID _4ei0lumys()
@ 24,2 GET ULTabPrecosSaldos ;
	PICTURE "@*HN ULTabPrecosSaldos" ;
	SIZE 1,19,1 ;
	DEFAULT 1 ;
	WHEN .F. ;
	VALID _4ei0lumzu() ;
	MESSAGE 'Processa Reserva de Mercadoria'
@ 20,33 GET ULCaixa ;
	PICTURE "@*HN ULCaixa OFF em 03/2/09" ;
	SIZE 1,24,1 ;
	DEFAULT 1 ;
	WHEN .F. ;
	VALID _4ei0lun00() ;
	DISABLE ;
	MESSAGE 'Primeiro registro'
@ 26,2 GET ULProtegeOSI ;
	PICTURE "@*HN ULProtegeOSI" ;
	SIZE 1,15,1 ;
	DEFAULT 1 ;
	WHEN .F. ;
	VALID _4ei0lun06() ;
	MESSAGE 'Primeiro registro'
@ 27,2 GET ULAlteraOperador ;
	PICTURE "@*HN ULAlteraOperador" ;
	SIZE 1,18,1 ;
	DEFAULT 1 ;
	WHEN .F. ;
	VALID _4ei0lun07() ;
	MESSAGE 'Primeiro registro'
@ 28,2 GET ULCadastroCliente ;
	PICTURE "@*HN ULCadastroCliente" ;
	SIZE 1,20,1 ;
	DEFAULT 1 ;
	WHEN .F. ;
	VALID _4ei0lun08() ;
	MESSAGE 'Processa Reserva de Mercadoria'
@ 29,2 GET ULNRoNF ;
	PICTURE "@*HN ULNRoNF" ;
	SIZE 1,9,1 ;
	DEFAULT 1 ;
	WHEN .F. ;
	VALID _4ei0lun09() ;
	MESSAGE 'Primeiro registro'
@ 30,2 GET ULVerSitCredito ;
	PICTURE "@*HN ULVerSitCredito" ;
	SIZE 1,17,1 ;
	DEFAULT 1 ;
	WHEN .F. ;
	VALID _4ei0lun0a()
@ 31,2 GET ULOSIReimpr ;
	PICTURE "@*HN ULOSIReimpr" ;
	SIZE 1,14,1 ;
	DEFAULT 1 ;
	WHEN .F. ;
	VALID _4ei0lun0b() ;
	MESSAGE 'Primeiro registro'
@ 32,2 GET ULFiltroProp ;
	PICTURE "@*HN ULFiltroProp" ;
	SIZE 1,14,1 ;
	DEFAULT 1 ;
	WHEN .F. ;
	VALID _4ei0lun1c() ;
	MESSAGE 'Primeiro registro'
@ 1,40 GET ULimpNegociacao ;
	PICTURE "@*HN ULimpNegociacao" ;
	SIZE 1,17,5 ;
	DEFAULT 1 ;
	WHEN .f. ;
	VALID _4ei0lun1k()
@ 2,44 GET ULPlnhdeFinanciamento ;
	PICTURE "@*HN ULPlnhdeFinanciamento" ;
	SIZE 1,23,5 ;
	DEFAULT 1 ;
	WHEN .f. ;
	VALID _4ei0lun1s()
@ 3,46 GET ULimprimir ;
	PICTURE "@*HN ULimprimir" ;
	SIZE 1,12,5 ;
	DEFAULT 1 ;
	WHEN .f. ;
	VALID _4ei0lun1t()
@ 5,40 GET ULObservacao ;
	PICTURE "@*HN ULObservacao" ;
	SIZE 1,14,1 ;
	DEFAULT 1 ;
	WHEN .F. ;
	VALID _4ei0lun1u() ;
	MESSAGE 'Primeiro registro'
@ 7,30 SAY "*--------------------------------*" ;
	SIZE 1,34, 0
@ 8,31 GET BTN_VAL1 ;
	PICTURE "@*HN BTN_VAL1" ;
	SIZE 1,10,1 ;
	DEFAULT 1 ;
	WHEN .F. ;
	VALID _4ei0lun1v() ;
	MESSAGE 'Primeiro registro'
@ 9,31 GET ULcall_log ;
	PICTURE "@*HN ULcall_log" ;
	SIZE 1,12,1 ;
	DEFAULT 1 ;
	WHEN .F. ;
	VALID _4ei0lun1w() ;
	MESSAGE 'Primeiro registro'
@ 10,31 GET local_refresh ;
	PICTURE "@*HN local_refresh" ;
	SIZE 1,15,1 ;
	DEFAULT 1 ;
	WHEN .F. ;
	VALID _4ei0lun1x() ;
	MESSAGE 'Primeiro registro'
@ 18,8 GET ULativaliberacao ;
	PICTURE "@*HN ULativaliberacao" ;
	SIZE 1,18,1 ;
	DEFAULT 1 ;
	WHEN .F. ;
	VALID _4ei0lun2z() ;
	MESSAGE 'Primeiro registro'
@ 18,31 GET ULsaveScreen ;
	PICTURE "@*HN ULsaveScreen" ;
	SIZE 1,14,1 ;
	DEFAULT 1 ;
	WHEN .F. ;
	VALID _4ei0lun39() ;
	MESSAGE 'Primeiro registro'
@ 19,31 GET ULrestScreen ;
	PICTURE "@*HN ULrestScreen" ;
	SIZE 1,14,1 ;
	DEFAULT 1 ;
	WHEN .F. ;
	VALID _4ei0lun3a() ;
	MESSAGE 'Primeiro registro'
@ 35,2 GET ULGerBTSOSI ;
	PICTURE "@*HN ULGerBTSOSI" ;
	SIZE 1,14,1 ;
	DEFAULT 1 ;
	WHEN .F. ;
	VALID _4ei0lun3b() ;
	MESSAGE 'Primeiro registro'
@ 20,2 GET ULConsultaLiberaCredito ;
	PICTURE "@*HN ULConsultaLiberaCredito" ;
	SIZE 1,25,1 ;
	DEFAULT 1 ;
	WHEN .F. ;
	VALID _4ei0lun3c() ;
	MESSAGE 'Primeiro registro'
@ 9,5 GET ULEftvaCancOrcamento ;
	PICTURE "@*HN ULEftvaCancOrcamento" ;
	SIZE 1,22,1 ;
	DEFAULT 1 ;
	WHEN .F. ;
	VALID _4ei0lun3d() ;
	MESSAGE 'Primeiro registro'

IF NOT WVISIBLE("svd0500r")
	ACTIVATE WINDOW svd0500r
ENDIF
IF NOT WVISIBLE("svd0520")
	ACTIVATE WINDOW svd0520
ENDIF
IF NOT WVISIBLE("navega")
	ACTIVATE WINDOW navega
ENDIF
IF NOT WVISIBLE("svd0500")
	ACTIVATE WINDOW svd0500
ENDIF



*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є     MS-DOSREAD contains clauses from SCREEN svd0500     є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

READ CYCLE MODAL ;
	VALID READVALID() ;
	WHEN _4ei0lumu4() ;
	ACTIVATE READACT() ;
	DEACTIVATE READDEAC() &wp_timeout ;
	SHOW _4ei0lun3e() ;
	NOLOCK

RELEASE WINDOW navega
RELEASE WINDOW svd0500
RELEASE WINDOW svd0500r
RELEASE WINDOW svd0520

#REGION 0
IF m.talkstat = "ON"
	SET TALK ON
ENDIF
IF m.compstat = "ON"
	SET COMPATIBLE ON
ENDIF


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є               SVD0500/MS-DOS Cleanup Code               є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1
	ON KEY LABEL ESCAPE
	ON KEY LABEL CTRL-I
	RELEASE WINDOW lista

RETURN








*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUMS9           orcament.natu_oper VALID           є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0500,     Record Number:   39   є
*       є Variable:            orcament.natu_oper                 є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Popup                              є
*       є Snippet Number:      1                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4ei0lums9     &&  orcament.natu_oper VALID
#REGION 1
ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
RETURN .T.


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUMSG           orcament.motivo WHEN               є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0500,     Record Number:   40   є
*       є Variable:            orcament.motivo                    є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Popup                              є
*       є Snippet Number:      2                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4ei0lumsg     &&  orcament.motivo WHEN
#REGION 1
ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
RETURN(.F.)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUMSH           m.orcamento VALID                  є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0500,     Record Number:   42   є
*       є Variable:            m.orcamento                        є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Field                              є
*       є Snippet Number:      3                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4ei0lumsh     &&  m.orcamento VALID
#REGION 1
PRIVATE LNregretorno

SELE orcament
LNregretorno = RECNO()

SET ORDER TO TAG geral
IF LASTKEY() = 9
    ON KEY LABEL ESCAPE
	DO loc_dlog WITH .T.
    ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
	IF LASTKEY() <> 27
		m.orcamento = orcament.orcamento
	ENDIF	
ENDIF	

********* OPCAO BUSCA MANTENDO VISUALISACO P/ m.ver =3 *****

wp_msg = ''
SEEK STR(wp_empresa,3)+STR(m.orcamento,6)
IF FOUND() AND isreading
	DO CASE
		CASE (LEFT(orcament.SITUACAO,1)$"OZY") AND m.ver <> 3
			wp_msg = "OSI Solicitada Esta Disponivel so na Opcao "+;
					 "<G-Visao Geral>"
			GO LNregretorno
		CASE orcament.operador <> wl_vendedor AND m.ver = 1
			wp_msg = "OSI Solicitada Esta Disponivel nas Opcoes "+;
					 "<W-Ver Todos> ou <G-Visao Geral>"
			GO LNregretorno
	ENDCASE
ELSE
	SET ORDER TO TAG orcamento
ENDIF
IF !EMPTY(wp_msg)
	=UPbeeps(.F.,wp_msg,0,600)
	CLEAR TYPEAHEAD
	ON KEY LABEL ESCAPE	KEYBOARD "{END}"
  	KEYBOARD "{END}"
	RETURN(.T.)
ENDIF
SHOW GET m.ver
RETURN(UPtratachv())



*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUMSI           m.cgccliente WHEN                  є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0500,     Record Number:   46   є
*       є Variable:            m.cgccliente                       є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Field                              є
*       є Snippet Number:      4                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4ei0lumsi     &&  m.cgccliente WHEN
#REGION 1
m.cgccliente = STR(clienc.cliente,14)
RETURN(.F.)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUMSJ           m.FR_btn VALID                     є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0500,     Record Number:   70   є
*       є Variable:            m.FR_btn                           є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      5                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
*--------------------------------------------
FUNCTION _4ei0lumsj     &&  m.FR_btn VALID
#REGION 1
IF WVISIBLE('SVD0520')
	HIDE WINDOW SVD0520
ELSE
	SHOW WINDOWS SVD0520 TOP
ENDIF
_CUROBJ = OBJNUM(FR_btn)
*--------------------------------------------



*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUMSK           m.obs_btn VALID                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0500,     Record Number:   71   є
*       є Variable:            m.obs_btn                          є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      6                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4ei0lumsk     &&  m.obs_btn VALID
#REGION 1
	DO ULObservacao

RETURN


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUMSL           ImpVend_btn WHEN                   є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0500,     Record Number:   73   є
*       є Variable:            ImpVend_btn                        є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      7                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4ei0lumsl     &&  ImpVend_btn WHEN
#REGION 1
	ON KEY LABEL TAB
	ON KEY LABEL ENTER
RETURN(m.tp_parcela = 6)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUMTO           ImpVend_btn VALID                  є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0500,     Record Number:   73   є
*       є Variable:            ImpVend_btn                        є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      8                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4ei0lumto     &&  ImpVend_btn VALID
#REGION 1
	DO ULimpNegociacao
	SHOW WINDOWS SVD0520 TOP
	SHOW WINDOWS SVD0500 TOP
	SHOW WINDOWS NAVEGA TOP

RETURN



*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUMTV           ImpBTS_btn VALID                   є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0500,     Record Number:   76   є
*       є Variable:            ImpBTS_btn                         є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      9                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4ei0lumtv     &&  ImpBTS_btn VALID
#REGION 1
	PARAMETERS  LNemp,LNorca

	=W_DEFPROC("ORCAMENT.SPR")
	=OREditaBTS(M.Empresa,m.orcamento)


*	DO ULGerBTSOSI
	SHOW WINDOWS SVD0520 TOP
	SHOW WINDOWS SVD0500 TOP
	SHOW WINDOWS NAVEGA TOP

RETURN



*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUMU6           m.VP_btn VALID                     є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0520,     Record Number:    7   є
*       є Variable:            m.VP_btn                           є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      10                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4ei0lumu6     &&  m.VP_btn VALID
#REGION 3
	DO ULAbreOrcamento
RETURN




*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUMU7           m.rm_btn VALID                     є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0520,     Record Number:    8   є
*       є Variable:            m.rm_btn                           є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      11                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4ei0lumu7     &&  m.rm_btn VALID
#REGION 3
	DO  ULReserva
	=BTN_VAL1('ATUALIZAR', VLleitura, Vlcompara)

RETURN(.T.)

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUMU8           m.osi_btn VALID                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0520,     Record Number:    9   є
*       є Variable:            m.osi_btn                          є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      12                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4ei0lumu8     &&  m.osi_btn VALID
#REGION 3
	DO ULImprimeOSI
	*------------------------------------------*
	=BTN_VAL1('ATUALIZAR', VLleitura, Vlcompara)
RETURN

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUMU9           m.fat_btn VALID                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0520,     Record Number:   10   є
*       є Variable:            m.fat_btn                          є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      13                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4ei0lumu9     &&  m.fat_btn VALID
#REGION 3
	DO ULEnviaPFat
	=BTN_VAL1('ATUALIZAR', VLleitura, Vlcompara)
RETURN


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUMUA           m.cnfcha_btn VALID                 є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0520,     Record Number:   11   є
*       є Variable:            m.cnfcha_btn                       є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      14                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4ei0lumua     &&  m.cnfcha_btn VALID
#REGION 3
	DO ULCancEnvioFat

	=BTN_VAL1('ATUALIZAR', VLleitura, Vlcompara)

RETURN


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUMUB           m.CNosi_btn VALID                  є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0520,     Record Number:   12   є
*       є Variable:            m.CNosi_btn                        є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      15                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4ei0lumub     &&  m.CNosi_btn VALID
#REGION 3
	DO ULCancelaOSI

	=BTN_VAL1('ATUALIZAR', VLleitura, Vlcompara)
RETURN



*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUMUC           m.cr_btn VALID                     є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0520,     Record Number:   13   є
*       є Variable:            m.cr_btn                           є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      16                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4ei0lumuc     &&  m.cr_btn VALID
#REGION 3
	DO ULCancReserva
	SELE orcament
	=BTN_VAL1('ATUALIZAR', VLleitura, Vlcompara)
RETURN


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUMVB           m.co_btn VALID                     є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0520,     Record Number:   14   є
*       є Variable:            m.co_btn                           є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      17                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4ei0lumvb     &&  m.co_btn VALID
#REGION 3
	DO ULCancOrcamento
	=BTN_VAL1('ATUALIZAR', VLleitura, Vlcompara)
RETURN


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUMVH           m.lib_btn VALID                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0520,     Record Number:   15   є
*       є Variable:            m.lib_btn                          є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      18                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4ei0lumvh     &&  m.lib_btn VALID
#REGION 3
	DO ULLiberaCredito
	=BTN_VAL1('ATUALIZAR', VLleitura, Vlcompara)
RETURN






*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUMVN           m.cnlib_btn VALID                  є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0520,     Record Number:   16   є
*       є Variable:            m.cnlib_btn                        є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      19                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*


FUNCTION _4ei0lumvn     &&  m.cnlib_btn VALID
#REGION 3
	DO ULLibCRGeral
	=BTN_VAL1('ATUALIZAR', VLleitura, Vlcompara)

RETURN


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUMVO           m.item_btn VALID                   є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0520,     Record Number:   17   є
*       є Variable:            m.item_btn                         є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      20                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4ei0lumvo     &&  m.item_btn VALID
#REGION 3
	DO ULEdicaodeItens
	=BTN_VAL1('ATUALIZAR', VLleitura, Vlcompara)
RETURN


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUMVP           m.tab_btn VALID                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0520,     Record Number:   18   є
*       є Variable:            m.tab_btn                          є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      21                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*


FUNCTION _4ei0lumvp     &&  m.tab_btn VALID
#REGION 3
	DO ULTabPrecosSaldos
RETURN



*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUMVQ           m.prot_btn VALID                   є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0520,     Record Number:   19   є
*       є Variable:            m.prot_btn                         є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      22                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4ei0lumvq     &&  m.prot_btn VALID
#REGION 3
	DO ULProtegeOSI
RETURN




*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUMVR           m.oper_btn VALID                   є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0520,     Record Number:   20   є
*       є Variable:            m.oper_btn                         є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      23                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4ei0lumvr     &&  m.oper_btn VALID
#REGION 3
	DO  ULAlteraOperador
	=BTN_VAL1('ATUALIZAR', VLleitura, Vlcompara)
RETURN


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUMVS           m.cad_btn VALID                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0520,     Record Number:   21   є
*       є Variable:            m.cad_btn                          є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      24                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

	
FUNCTION _4ei0lumvs     &&  m.cad_btn VALID
#REGION 3
	DO ULCadastroCliente

	=BTN_VAL1('ATUALIZAR', VLleitura, Vlcompara)
RETURN



*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUMWQ           m.nro_btn VALID                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0520,     Record Number:   22   є
*       є Variable:            m.nro_btn                          є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      25                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
*****************************************************************
FUNCTION _4ei0lumwq     &&  m.nro_btn VALID
#REGION 3
SELECT empresa
SELE empresa
SET ORDER TO TAG empresa
SEEK m.empresa				&& EMPRESA OPERADORA DO SISTEMA
m.LNproxima     = nota + 1
wp_msg = "Proxima Nota Fiscal de Saida => "+STR(m.LNproxima,6)
DO OBJ_ALER.SPR WITH wp_msg
SELE orcament



*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUMWX           m.stcr_btn VALID                   є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0520,     Record Number:   23   є
*       є Variable:            m.stcr_btn                         є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      26                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4ei0lumwx     &&  m.stcr_btn VALID
#REGION 3
	DO ULVerSitCredito
RETURN	


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUMX3           m.reimp_btn VALID                  є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0520,     Record Number:   24   є
*       є Variable:            m.reimp_btn                        є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      27                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4ei0lumx3     &&  m.reimp_btn VALID
#REGION 3
	DO ULOSIReimpr
RETURN





*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUMX4           m.ver VALID                        є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0520,     Record Number:   25   є
*       є Variable:            m.ver                              є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Radio Button                       є
*       є Snippet Number:      28                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4ei0lumx4     &&  m.ver VALID
#REGION 3
	DO ULFiltroProp

	SCATTER MEMVAR MEMO
	=BTN_VAL1('ATUALIZAR', VLleitura, Vlcompara)
RETURN(.T.)

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUMX5           m.cnslt_btn VALID                  є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0520,     Record Number:   26   є
*       є Variable:            m.cnslt_btn                        є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      29                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4ei0lumx5     &&  m.cnslt_btn VALID
#REGION 3
	DO ULConsultaLiberaCredito
	=BTN_VAL1('ATUALIZAR', VLleitura, Vlcompara)
RETURN






*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUMX7           ULAbreOrcamento VALID              є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0500R,     Record Number:    2  є
*       є Variable:            ULAbreOrcamento                    є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      30                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4ei0lumx7     &&  ULAbreOrcamento VALID
#REGION 4
RETURN

PROCEDURE ULAbreOrcamento
	PRIVATE LNemp,LNorcamento
	LNemp		= 	wp_empresa
	LNorcamento	=	0
	*--------------------------------------------
	=W_DEFPROC("ORCAMENT.SPR")
	IF ORadorcament((LNemp),LNorcamento)
		SELE orcament
		SET ORDER TO TAG geral
		SEEK STR(LNemp,3)+STR(LNorcamento,6)
		IF FOUND()
			DO ULsaveScreen
			DO SVD0400.SPR WITH (LNemp),(LNorcamento),(LSprograma)
			DO ULrestScreen
		ENDIF
	ENDIF
	UNLOCK ALL
	UNLOCK ALL
	UNLOCK ALL


	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	

	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	
	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	
	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	

	*--------------------------------------------
	=BTN_VAL1('ATUALIZAR', VLleitura, Vlcompara)
RETURN




*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUMX8           ULReserva VALID                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0500R,     Record Number:    3  є
*       є Variable:            ULReserva                          є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      31                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4ei0lumx8     &&  ULReserva VALID
#REGION 4
RETURN

PROCEDURE ULReserva
	*------------------------------------------*
	=W_DEFPROC("ORCAMENT.SPR")
	do ORSelreserva
	*------------------------------------------*

	UNLOCK ALL
	UNLOCK ALL
	UNLOCK ALL


	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	

	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	
	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	
	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	

RETURN

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUMX9           ULImprimeOSI VALID                 є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0500R,     Record Number:    4  є
*       є Variable:            ULImprimeOSI                       є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      32                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4ei0lumx9     &&  ULImprimeOSI VALID
#REGION 4
RETURN

PROCEDURE ULImprimeOSI
	*------------------------------------------*
	=W_DEFPROC("ORCAMENT.SPR")
	do ORSelimp_osi


	UNLOCK ALL
	UNLOCK ALL
	UNLOCK ALL


	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	

	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	
	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	
	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	
	*------------------------------------------*
RETURN

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUMY8           ULEnviaPFat VALID                  є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0500R,     Record Number:    5  є
*       є Variable:            ULEnviaPFat                        є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      33                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4ei0lumy8     &&  ULEnviaPFat VALID
#REGION 4
RETURN

PROCEDURE ULEnviaPFat

	*-----------------------------------------------------------------*
	*		As chamdas sao definidas com o modo de operacao que o prog.
	*  SVD2.PRG foi ativado e que por sua vez ativou o prog SVD0500
	*  passando este modo no parametro LSprograma e permitinto o trata-
	*  mento diferenciado caso a caso
	*-----------------------------------------------------------------*
	DO ULsaveScreen
	DO CASE

		CASE LSprograma = "BALCAO"
			=W_DEFPROC("NOTA.SPR")
			=NFEnvioParaFat()

		CASE LSprograma = "FAT. SEM RESERVA"
			DO OBJ_ECF2.spr WITH "FATURISTA SIMPLES"
			SELE orcament
		CASE LSprograma = "FAT. COM RESERVA"
			DO OBJ_ECF2.spr WITH "FATURISTA RESERVA"
			SELE orcament


	ENDCASE	
	DO ULrestScreen
	isediting = .f.


	UNLOCK ALL
	UNLOCK ALL
	UNLOCK ALL


	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	

	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	
	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	
	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	
RETURN

*-----------------------------------------------------------------*


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUMYG           ULCancEnvioFat VALID               є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0500R,     Record Number:    6  є
*       є Variable:            ULCancEnvioFat                     є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      34                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4ei0lumyg     &&  ULCancEnvioFat VALID
#REGION 4
RETURN

PROCEDURE ULCancEnvioFat

	*****************************************************************
	* 				Inicio Verificacao de Requisitos				*
	*****************************************************************
	*------------------------------------------------------------*
	=W_DEFPROC("ORCAMENT.SPR")
	DO ORloc_orc WITH "o"
	*------------------------------------------------------------*

	IF LASTKEY() = 27
		RETURN
	ENDIF

	CLEAR TYPEAHEAD
	LNregvolta = RECNO()
	LSl = LEFT(orcament.situacao,1)
	LSr = RIGHT(orcament.situacao,1)

	*================>>>> FICA BLOQUEADO ATE FTURAMENTO COMPLETAR .
	SELE orcament

	IF !REGLOCK()
	    WAIT WINDOW "Orcamento em uso em outro ponto. Tente novamente."
		RETURN
	ENDIF

	IF !(LEFT(orcament.situacao,1) $ "o")
		WAIT WINDOW "OSI Nao esta em Situacao de fechamento. "
		POP KEY 			&& reabilita teclas de atalho def. anteriormente
		UNLOCK ALL
		RETURN
	ENDIF

	*****************************************************************
	* 				Fim Verificacao de Requisitos				*
	*****************************************************************
	*****************************************************************
	* 				Inicio Informacoes Complementares
	*****************************************************************
	************************************
	=UPtransacao("INICIAR")
	************************************
	LFflgtrans = .t.
	SELECT  orcatmp
	SET ORDER TO TAG orcamento
	SET NEAR ON
	SEEK STR(orcament.empresa,3)+STR(orcament.orcamento,6)
	SET NEAR OFF
	DO WHILE !EOF() AND orcament.orcamento = orcatmp.orcamento ;
				AND orcament.empresa   = orcatmp.empresa

		IF !LEFT(orcatmp.situacao,1) $ "oMYZ"
			LFflgtrans = .F.
		ENDIF

		***** SO SERA PROCESSADO QDO TODOS OS ITENS SE ENCONTRAREM EM
		***** SITUACAO DE CANCELAMENTO OU PRONTOS P/ FATURAR
	
		IF (LEFT(orcatmp.situacao,1) $ "o") && Enviado para Faturamento
	   		SELECT orcatmp
			IF REGLOCK()
			   REPLACE situacao WITH "M"+RIGHT(situacao,1)
			ELSE
				LFflgtrans = .F.
			ENDIF
		ENDIF
		SELE orcatmp
		SKIP
	ENDDO
	IF !LFflgtrans
		SELECT orcament
		RETURN
	ENDIF			

	SELECT orcament
	REPLACE situacao WITH "M"+RIGHT(situacao,1)
	UNLOCK ALL

RETURN


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUMYN           ULCancelaOSI VALID                 є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0500R,     Record Number:    7  є
*       є Variable:            ULCancelaOSI                       є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      35                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4ei0lumyn     &&  ULCancelaOSI VALID
#REGION 4
RETURN

PROCEDURE ULCancelaOSI
	PUSH KEY CLEAR		&& desabilita teclas de atalho def. anteriormente
	ON KEY LABEL F1		DO HLP2000.SPR WITH  POPUP(),PROMPT(),PROGRAM(),;
							WONTOP(),VARREAD()

	PRIVATE LFalt_sit
	LFind_cop   = .F.  && INDICA QUE A OSI E UMA COPIA
	LFalt_sit	= .f.  && INDICA A ULreg_osi se a sit ja pode ser alterada
	LFind_imp 	= .f.  && INDICA se houve impr.de itens p/ que atualiza ;
					   && 		no vias
	LFind_can 	= .f.  && INDICA que a osi esta sendo cancelada

	*------------------------------------------------------------*
	=W_DEFPROC("ORCAMENT.SPR")
	DO ORloc_orc WITH "M" && SITUACOES EM ORDEM
												&& CRESCENTE
	*------------------------------------------------------------*
	IF LASTKEY() = 27 OR EOF()
		POP KEY 			&& reabilita teclas de atalho def. anteriormente
		UNLOCK ALL
		RETURN
	ENDIF
	CLEAR TYPEAHEAD

	SELE orcament
	IF !lMaster AND m.operador <> wl_vendedor
	   WAIT WINDOW "OSI Nao Pode Ser Cancelada Por outro Vendedor."
	   POP KEY 			&& reabilita teclas de atalho def. anteriormente
	   UNLOCK ALL
	   RETURN
	ENDIF
	IF !REGLOCK()
	   WAIT WINDOW "Orcamento em uso em outro ponto. Tente novamente."
		POP KEY 			&& reabilita teclas de atalho def. anteriormente
		UNLOCK ALL
	    RETURN
	ENDIF

	LNregcanc = RECNO()

	*------------------------------------------------------------*
	SELECT tipooper
	SET ORDER TO TAG tipo
	SEEK 'S'+orcament.tipo
	IF !FOUND()
		SEEK 's'+orcament.tipo  	
	ENDIF
	IF !FOUND()
		DO FCHdef_tribut
		RETURN(.f.)
	ENDIF
	*------------------------------------------------------------*


	*******************************************************************
	*        1o  - CANCELAMENTO DAS RESERVAS DA OSI 					*
	*******************************************************************
	SELECT  orcatmp
	SET ORDER TO TAG orcamento
	LFflgtrans = .t.
	LFflgreser = .t.
	LFflgretod = .t.	&& IGNORA CONFIRMACOES POR ITEM
	LFflgretod = .T.
	LNordemmenos = 0    && reordena os itens que ficam abaixo de item
						&& ELIMINADO
	SET NEAR ON
	SEEK STR(orcament.empresa,3)+STR(orcament.orcamento,6)
	SET NEAR OFF
	DO WHILE !eof() AND orcament.orcamento = orcatmp.orcamento ;
				AND orcament.empresa   = orcatmp.empresa
	   WAIT WINDOW "ITEM => "+STR(orcatmp.ordem,2) NOWAIT

	   IF tipooper.movestq = "S"
			*----------------------------------------------------------*
			* 	Quando se aceita a opera‡Жo de cancelameno de OSI
			* entende-se que seus itens ou estao para ser cancelados(M)
			* ou ja estЖo cancelados (Y). Caso nЖo se verifique esta
			* condi‡Жo ha indЎcio de falha em outro processo de mudan‡a
			* de status como por exemplo o retorno do faturamento.
			*----------------------------------------------------------*
	   		IF !(LEFT(orcatmp.situacao,1) $ 'MY')
				LFflgtrans = .F.
				EXIT
			ENDIF
			*----------------------------------------------------------*
		   	PRIVATE LFlockReg
			PRIVATE LFabreAuto
	   		LFlockReg	= .T.	&& BLOQUEAR REGISTRO
	    	LFabreAuto	= .F. 	&& NAO ABRIR CONTROLE AUTOMATICAMENTE
			=W_DEFPROC("ESTOQUE.SPR")
			IF ESversaldo(orcatmp.empresa,orcatmp.codigo ,;
				wp_dtoper,orcatmp.qtde,orcatmp.qtderes,LFabreAuto,;
				LFlockReg,"RESERVA",orcament.hora_fat,tipooper.movestq)
				*----------------------------------------------------------*
    	     	SELECT orcatmp
        	 	IF REGLOCK()
					*------------------------------------------*
					=W_DEFPROC("ORCAMENT.SPR")
					IF !ORprocreserva_item(orcatmp.empresa,;
						orcament.tipo,orcatmp.orcamento,;
						orcatmp.codigo,orcatmp.ordem, "ANULA")

						LFflgtrans = .F.
						EXIT
					ENDIF
					IF !("CANCELA***" $ orcatmp.descricao)
						REPLACE orcatmp.descricao WITH ;
									"CANCELA***"+orcatmp.descricao
					ENDIF

					*------------------------------------------*
	         	ELSE
					LFflgtrans = .F.
					EXIT
	 		 	ENDIF
      		ELSE
				LFflgtrans = .F.
				EXIT
      		ENDIF
  		ELSE
      		IF tipooper.movestq = "N"
	   	  		IF REGLOCK()
					IF LEFT(orcatmp.situacao,1) <> "Y"
						REPLACE orcatmp.descricao WITH ;
									"CANCELA***"+orcatmp.descricao
					ENDIF

					IF !("CANCELA***" $ orcatmp.descricao)
						REPLACE orcatmp.descricao WITH ;
									"CANCELA***"+orcatmp.descricao
					ENDIF
					
	            	REPLACE situacao WITH "Y"   && CANC.DIRETO POR NAO
	            								&& ENVOL. OSI
	         	ELSE
					LFflgtrans = .F.
					EXIT
				ENDIF
	  		ENDIF
   		ENDIF
   		SELE orcatmp
		SET ORDER TO TAG orcamento
   		SKIP
	ENDDO

	IF !LFflgtrans
 	 	 WAIT WINDOW "Houve Impedimento Para Cancelar Reservas."+;
    					" Tente Novamente. <ENTER> "
	   	SELE orcament
		POP KEY 			&& reabilita teclas de atalho def. anteriormente
		UNLOCK ALL
   		RETURN
	ENDIF

	*******************************************************************
	*        2o  - IMPRIME OSI INFORMANDO O CANCELAMENTO				*
	*******************************************************************

	=W_DEFPROC("ORCAMENT.SPR")
	=ORimp_osi((orcament.empresa),(orcament.orcamento),"CANCELAMENTO OSI")

	*******************************************************************
	POP KEY 			&& reabilita teclas de atalho def. anteriormente
RETURN



*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUMYO           ULCancReserva VALID                є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0500R,     Record Number:    8  є
*       є Variable:            ULCancReserva                      є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      36                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4ei0lumyo     &&  ULCancReserva VALID
#REGION 4
RETURN

PROCEDURE ULCancReserva
	*------------------------------------------*
	=W_DEFPROC("ORCAMENT.SPR")
	do ORSelcancr
	*------------------------------------------*

	UNLOCK ALL
	UNLOCK ALL
	UNLOCK ALL


	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	

	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	
	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	
	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	


RETURN


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUMYP           ULCancOrcamento VALID              є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0500R,     Record Number:    9  є
*       є Variable:            ULCancOrcamento                    є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      37                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4ei0lumyp     &&  ULCancOrcamento VALID
#REGION 4
RETURN

PROCEDURE ULCancOrcamento
	*------------------------------------------------------------*
	=W_DEFPROC("ORCAMENT.SPR")
	DO ORloc_orc WITH "A"
	*------------------------------------------------------------*
	IF LASTKEY() = 27
		RETURN
	ENDIF
	CLEAR TYPEAHEAD
	IF !fox_alert(C_CANCORCA)
	   RETURN
	ENDIF
	IF !lMaster AND orcament.operador <> wl_vendedor
	   WAIT WINDOW "OSI Nao Pode Ser Cancelada Por outro Vendedor."
	   RETURN
	ENDIF


	=W_DEFPROC("SVD0500.SPR")
    =ULEftvaCancOrcamento()



	UNLOCK ALL
	UNLOCK ALL
	UNLOCK ALL


	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	

	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	
	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	
	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	


RETURN


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUMYQ           ULLiberaCredito VALID              є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0500R,     Record Number:   10  є
*       є Variable:            ULLiberaCredito                    є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      38                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4ei0lumyq     &&  ULLiberaCredito VALID
#REGION 4
RETURN

PROCEDURE ULLiberaCredito
	PRIVATE LScdgSitCred
	LScdgSitCred = 0
	*------------------------------------------------------------*
	=W_DEFPROC("ORCAMENT.SPR")
	DO ORloc_orc WITH "FGILM", "DH","LIBERAR"
	=BTN_VAL1('ATUALIZAR', VLleitura, Vlcompara)
	*------------------------------------------------------------*
	SELE orcament
	LNregorc = RECNO()
	*---------------------------------------------------------------*
	=W_DEFPROC("orcament.spr")



	LScdgSitCred = ORVer_credito(clienc.cliente,;
			orcament.valor - orcament.vlr_ent,0,0,clienc.inscricao)







  	*---------------------------------------------------------------*
	SELE orcament
	SET ORDER TO tag orcamento
	GO LNregorc
	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	
	if LScdgSitCred = 7 	&& 7=> Atualizar Cadastro
		=inkey(0.1)
		WAIT WINDOW "Atualize cadastro para processar a liberacao. <ENTER>"		
	ELSE
		DO ULativaliberacao
	ENDIF
	UNLOCK ALL


	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	

	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	
	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	
	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	

RETURN






*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUMYR           ULLibCRGeral VALID                 є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0500R,     Record Number:   11  є
*       є Variable:            ULLibCRGeral                       є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      39                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4ei0lumyr     &&  ULLibCRGeral VALID
#REGION 4
RETURN


PROCEDURE ULLibCRGeral

	PRIVATE LScdgSitCred
	LScdgSitCred = 0
	*------------------------------------------------------------*
	=W_DEFPROC("ORCAMENT.SPR")
	DO ORloc_orc WITH "FGILM", "EFH","LIBERAR"
	=BTN_VAL1('ATUALIZAR', VLleitura, Vlcompara)
	*------------------------------------------------------------*
	SELE orcament
	LNregorc = RECNO()
	*---------------------------------------------------------------*
	=W_DEFPROC("orcament.spr")


	LScdgSitCred = ORVer_credito(clienc.cliente,;
			orcament.valor - orcament.vlr_ent,0,0,clienc.inscricao)




	*---------------------------------------------------------------*
	SELE orcament
	SET ORDER TO tag orcamento
	GO LNregorc
	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	
	if LScdgSitCred = 7 	&& 7=> Atualizar Cadastro
		WAIT WINDOW "Atualize cadastro para processar a liberacao. <ENTER>"		
	ELSE
		DO ULativaliberacao
	ENDIF
	UNLOCK ALL
	UNLOCK ALL
	UNLOCK ALL


	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	

	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	
	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	
	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	

RETURN


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUMYS           ULEdicaodeItens VALID              є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0500R,     Record Number:   12  є
*       є Variable:            ULEdicaodeItens                    є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      40                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4ei0lumys     &&  ULEdicaodeItens VALID
#REGION 4
RETURN

PROCEDURE ULEdicaodeItens

	IF !lMaster AND orcament.protegido ;
				AND orcament.operador <> wl_vendedor
				
		wp_msg = "Orcamento Protegido ......    <ENTER>"
		=UPbeeps(.F.,wp_msg)
		return
	ENDIF
	DO ULsaveScreen
	DO SVD0400.SPR WITH orcament.empresa,orcament.orcamento,LSprograma
	DO ULrestScreen
	UNLOCK ALL
	UNLOCK ALL
	UNLOCK ALL


	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	

	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	
	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	
	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	

	=BTN_VAL1('ATUALIZAR', VLleitura, Vlcompara)
RETURN


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUMZU           ULTabPrecosSaldos VALID            є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0500R,     Record Number:   13  є
*       є Variable:            ULTabPrecosSaldos                  є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      41                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4ei0lumzu     &&  ULTabPrecosSaldos VALID
#REGION 4
RETURN

PROCEDURE ULTabPrecosSaldos

	=W_DEFPROC("PRECO.SPR")
	=PRbrow_Tab((wp_empresa),(wp_emptab),;
		(wp_tabela),(wp_serie),(wp_dtoper),;
		"null codigo","null classe")




	UNLOCK ALL
	UNLOCK ALL
	UNLOCK ALL


	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	

	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	
	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	
	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	

RETURN



*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUN00           ULCaixa VALID                      є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0500R,     Record Number:   14  є
*       є Variable:            ULCaixa                            є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      42                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4ei0lun00     &&  ULCaixa VALID
#REGION 4
RETURN

PROCEDURE offULCaixa	
	DO ULsaveScreen
	DO OBJ_ECF2.spr WITH "CAIXA"
	SELE orcament
	DO ULrestScreen
RETURN


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUN06           ULProtegeOSI VALID                 є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0500R,     Record Number:   15  є
*       є Variable:            ULProtegeOSI                       є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      43                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4ei0lun06     &&  ULProtegeOSI VALID
#REGION 4
RETURN

PROCEDURE 	ULProtegeOSI
	***********************************************************************
	* PROTEGE OU DESPROTEGE O ORCAMENTO DO ACESSO DE OUTRO OPERADOR
	* PARA TODAS OPERACOES EXCETO LIBERACAO DE CREDITO)
	**********************************************************************
	SELE orcament
	IF !REGLOCK()
	   WAIT WINDOW "Orcamento em uso em outro ponto. Tente novamente."
	   UNLOCK ALL
	   RETURN
	ENDIF
	******** VERIFICA SE USUARIO SOLICITANTE E DONO DA OSI ***********

	wp_msg = 'Usuario Que Abriu OSI : '+STR(orcament.operador,6)
	BTMP   =  'usuario.usuario = orcament.operador '
	LNusr_ret = 0
	DO obj_prmt.SPR WITH   wp_msg , Btmp

	IF LNusr_ret > 0
		IF !orcament.protegido 		&& NAO ESTA PROTEGIDA
			REPLACE orcament.protegido with .t.	&& PROTEGE OSI
		ELSE
			REPLACE orcament.protegido with .F.	&& DESPROTEGE OSI
		ENDIF
	ENDIF



	UNLOCK ALL
	UNLOCK ALL
	UNLOCK ALL


	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	

	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	
	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	
	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	


RETURN




*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUN07           ULAlteraOperador VALID             є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0500R,     Record Number:   16  є
*       є Variable:            ULAlteraOperador                   є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      44                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4ei0lun07     &&  ULAlteraOperador VALID
#REGION 4
RETURN

PROCEDURE ULAlteraOperador
	WP_REDMENU = .F. 	&& NAO REDEFINIR MENU DO SYSTEMA
	DO OBJ_SENH.SPR
	WP_REDMENU = .T. 	&& NAO REDEFINIR MENU DO SYSTEMA
	wl_vendedor 	=  nUsr   && contem o codigo do vendedor atual
	m.operador      =  nUsr
	SELE orcament
	SET ORDER TO TAG orcamento
	IF m.ver = 1					&& ver proprios
		SET ORDER TO TAG vend_orca
		SET NEAR ON
		SEEK STR(wp_empresa,3)+STR(wl_vendedor,4)
		SET NEAR OFF
	ELSE							&& ver todos
		SET ORDER TO TAG orcamento
		SET NEAR ON
		SEEK STR(wp_empresa,3)
		SET NEAR OFF
	ENDIF
	SCATTER MEMVAR MEMO

    do local_refresh

RETURN


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUN08           ULCadastroCliente VALID            є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0500R,     Record Number:   17  є
*       є Variable:            ULCadastroCliente                  є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      45                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4ei0lun08     &&  ULCadastroCliente VALID
#REGION 4
RETURN

PROCEDURE ULCadastroCliente
	PRIVATE  LNcadregant


	DO ULsaveScreen

	**********************************************************************
	WPprgativo  = "SCGC200"		&& PERMITE O CONTROLE DE ACESSO DO CADASTRO
							&& SEM INTERFERENCIA DO ACESSO DESTE PROG.
	SELE orcament
	IF !EOF()
		LNcadregant = RECNO()  	&& PONTO DE RETORNO
	ELSE
		LNcadregant = 0
	ENDIF
	SELE clienc
	SET ORDER TO TAG emporca
	SEEK STR(orcament.EMPRESA,3)+STR(orcament.ORCAMENTO,6)
	
	DO SCGC200.SPR WITH clienc.cliente

	SELE orcament
	
	IF LNcadregant = 0
		SCATTER MEMVAR MEMO BLANK
	ELSE
		GO LNcadregant
		SCATTER MEMVAR MEMO
	ENDIF

	WPprgativo  = "SCGC201"	&& RETORNA O CONTROLE DE ACESSO AO PROGRAMADO
	*---------------------------------------------------------*
	DO ULrestScreen
	*---------------------------------------------------------*
	IF !(LEFT(m.situacao,1) $ "OZ"))	&& ORCAMENTO ESTA EM ABERTO
		=W_DEFPROC("ORCAMENT.SPR")
		=ORAtlz_Clie(orcament.empresa,orcament.orcamento)
	ENDIF
RETURN



*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUN09           ULNRoNF VALID                      є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0500R,     Record Number:   18  є
*       є Variable:            ULNRoNF                            є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      46                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4ei0lun09     &&  ULNRoNF VALID
#REGION 4
RETURN

PROCEDURE ULNRoNF
	*****************************************************************
	SELECT empresa
	SELE empresa
	SET ORDER TO TAG empresa
	SEEK m.empresa				&& EMPRESA OPERADORA DO SISTEMA
	m.LNproxima     = nota + 1
	wp_msg = "Proxima Nota Fiscal de Saida => "+STR(m.LNproxima,6)
	DO OBJ_ALER.SPR WITH wp_msg
	SELE orcament
RETURN




*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUN0A           ULVerSitCredito VALID              є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0500R,     Record Number:   19  є
*       є Variable:            ULVerSitCredito                    є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      47                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4ei0lun0a     &&  ULVerSitCredito VALID
#REGION 4
RETURN

PROCEDURE ULVerSitCredito
	SELE orcament
	LNregorc = RECNO()
	*---------------------------------------------------------------*

	=W_DEFPROC("orcament.spr")
	LStmp = ORVer_credito(clienc.cliente,;
			orcament.valor - orcament.vlr_ent,0,0,clienc.inscricao)




	=W_DEFPROC("nota.spr")
	=NFchq_Final(orcament.empresa,;
	             orcament.orcamento,;
	             "VENDEDOR",;
	             .T.,;
	             .T.)



	*---------------------------------------------------------------*
	=UPmsg_cr(LStmp)
	SELE orcament
	SET ORDER TO tag orcamento
	GO LNregorc
RETURN	


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUN0B           ULOSIReimpr VALID                  є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0500R,     Record Number:   20  є
*       є Variable:            ULOSIReimpr                        є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      48                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4ei0lun0b     &&  ULOSIReimpr VALID
#REGION 4
RETURN
PROCEDURE ULOSIReimpr
	***********************************************************************
	* EM CASO DE PERA DA IMPRESSAO NA IMPRESSORA ESTA OPCAO REEMITE OSI
	**********************************************************************

	wp_msg = 'Usuario com Permissao Para Impressao de Copia de OSI...'
	BTMP   =  'usuario.master'
	LNusr_ret = 0


	PUSH KEY CLEAR		&& desabilita teclas de atalho def. anteriormente
	ON KEY LABEL F1		DO HLP2000.SPR WITH  POPUP(),PROMPT(),PROGRAM(),;
							WONTOP(),VARREAD()
	
	PRIVATE LFalt_sit
	LFind_cop   = .T.  && INDICA QUE A OSI E UMA COPIA
	LFalt_sit	= .f.  && INDICA A ULreg_osi se a sit ja pode ser alterada
	LFind_imp 	= .f.  && INDICA se houve impr.de itens p/ que atualiza no
					   && vias
	LFind_can 	= .f.  && INDICA que a osi esta sendo cancelada
	*--------------------------------------------------------------------*
	*------------------------------------------------------------*
	=W_DEFPROC("ORCAMENT.SPR")

	IF 	(nUsr = 1)
		DO ORloc_orc WITH "MO","COPIA TOTAL"
	ELSE
		DO ORloc_orc WITH "M"
	ENDIF

	*------------------------------------------------------------*


	IF LASTKEY() = 27 OR EOF()
		POP KEY 			&& reabilita teclas de atalho def. anteriormente
		UNLOCK ALL
		RETURN
	ENDIF
	CLEAR TYPEAHEAD
	IF LEFT(orcament.situacao,1) = "O" ;
	   AND 	!(nUsr = 1)

		WAIT WINDOW "Somente usr 1  pode imprimir osi faturada."
			POP KEY
					&& reabilita teclas de atalho def. 	anteriormente
			UNLOCK ALL
			RETURN

    ELSE
		IF LEFT(orcament.situacao,1) <> "O"

			IF RIGHT(orcament.situacao,1) = "F"
				WAIT WINDOW "Orc.com cred. bloq..Nao aceita esta operacao."
				POP KEY
						&& reabilita teclas de atalho def. 	anteriormente
				UNLOCK ALL
				RETURN
			ENDIF

			IF RIGHT(orcament.situacao,1) = "D"
				WAIT WINDOW "OSI. Aguardando Liberacao de Credito. "
				POP KEY
				&& reabilita teclas de atalho def. 	anteriormente
				UNLOCK ALL
				RETURN
			ENDIF

			IF RIGHT(orcament.situacao,1) = "H"
				WAIT WINDOW ;
				"Liberacao em outras Condicoes de Credito. Ver <8-Lib.CR>"
				POP KEY
					&& reabilita teclas de atalho def. anteriormente
				UNLOCK ALL
				RETURN
			ENDIF
	
		ENDIF
	ENDIF


	*================>>>> FICA BLOQUEADO ATE FTURAMENTO COMPLETAR .
	SELE clienc
	SET ORDER TO TAG emporca
	SEEK STR(orcament.empresa,3)+STR(orcament.orcamento,6)

	SELE clientes
	SET ORDER TO TAG cliente
	SEEK clienc.cliente
	IF orcament.tp_parcela = 3 ;
		AND (clienc.cliente = 0 OR !FOUND("CLIENTES"))
		WAIT WINDOW "Cliente deve ser Cadastrado . Execute <Cadastro> "
		SELE orcament
		POP KEY 			&& reabilita teclas de atalho def. anteriormente
		UNLOCK ALL
		RETURN
	ENDIF


	SELE orcament

	IF LEFT(orcament.situacao,1) <> "O"

		IF (orcament.tp_parcela = 2 OR orcament.tp_parcela = 3);
		    AND (INT(orcament.prazomedio) > orcament.lim_prazo ;
	          OR  orcament.valor  > orcament.lim_libera ;
		      OR (orcament.lmt_parcel = "S" AND  orcament.tp_parcela = 3))
			WAIT WINDOW ;
				"Liberacao em outras Condicoes de Credito. Ver <8-Lib.CR>"
			POP KEY 	&& reabilita teclas de atalho def. anteriormente
			UNLOCK ALL
			RETURN
		ENDIF
	endif
	

	IF !REGLOCK()
	   WAIT WINDOW "Orcamento em uso em outro ponto. Tente novamente."
	   UNLOCK ALL
	   POP KEY 			&& reabilita teclas de atalho def. anteriormente
	   UNLOCK ALL
	   RETURN
	ENDIF
	*******************************************************************
	*        2o  - IMPRIME OSI INFORMANDO O CANCELAMENTO				*
	*******************************************************************


	=W_DEFPROC("ORCAMENT.SPR")

	IF 	(nUsr = 1)
		=ORimp_osi((orcament.empresa),(orcament.orcamento),"COPIA TOTAL")
	ELSE
		=ORimp_osi((orcament.empresa),(orcament.orcamento),"COPIA OSI")
	ENDIF
	*******************************************************************
	UNLOCK ALL
	=BTN_VAL1('ATUALIZAR', VLleitura, Vlcompara)
	POP KEY 			&& reabilita teclas de atalho def. anteriormente
	UNLOCK ALL
RETURN





*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUN1C           ULFiltroProp VALID                 є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0500R,     Record Number:   21  є
*       є Variable:            ULFiltroProp                       є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      49                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4ei0lun1c     &&  ULFiltroProp VALID
#REGION 4
RETURN

PROCEDURE ULFiltroProp

SELE orcament

DO CASE
  CASE m.ver = 1					&& ver proprios
	VLleitura = "STR(wp_empresa,3)+STR(wl_vendedor,4)"
			            * repassa chave de leitura p/ btn_val
	VLlerfim  = "STR(wp_empresa,3)+STR(wl_vendedor+1,4)"
           * repassa chave de leitura p/ btn_val (POSICAO FINAL + 1 REG)
	VLcompara = ;
	 "orcament.empresa = wp_empresa AND orcament.operador = wl_vendedor "
                         * repassa chave de comparacao p/ btn_val
	VLchvlimi = "STR(wp_empresa,3)+STR(wl_vendedor,4)"
						 * otimiza browse
	SET ORDER TO TAG vend_orca
	SET NEAR ON
	SEEK STR(wp_empresa,3)+STR(wl_vendedor,4)
	SET NEAR OFF

  CASE m.ver = 2					&& ver todos abertos
	VLleitura = "STR(wp_empresa,3)"
          * repassa chave de leitura p/ btn_val
	VLlerfim  = "STR(wp_empresa+1,3)"
          * repassa chave de leitura p/ btn_val (POSICAO FINAL + 1 REG)
	VLcompara = "orcament.empresa = wp_empresa"
          * repassa chave de comparacao p/ btn_val
	VLchvlimi = "STR(wp_empresa,3)"   && otimiza browse
	SET ORDER TO TAG orcamento
	SET NEAR ON
	SEEK STR(wp_empresa,3)
	SET NEAR OFF

  CASE m.ver = 3					&& ver geral independente de status
	VLleitura = "STR(wp_empresa,3)"
          * repassa chave de leitura p/ btn_val
	VLlerfim  = "STR(wp_empresa+1,3)"
          * repassa chave de leitura p/ btn_val (POSICAO FINAL + 1 REG)
	VLcompara = "orcament.empresa = wp_empresa"
          * repassa chave de comparacao p/ btn_val
	VLchvlimi = "STR(wp_empresa,3)"   && otimiza browse
	SET ORDER TO TAG geral
	SET NEAR ON
	SEEK STR(wp_empresa,3)
	SET NEAR OFF

ENDCASE




	UNLOCK ALL
	UNLOCK ALL
	UNLOCK ALL


	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	

	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	
	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	
	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	

RETURN





*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUN1K           ULimpNegociacao VALID              є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0500R,     Record Number:   22  є
*       є Variable:            ULimpNegociacao                    є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      50                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4ei0lun1k     &&  ULimpNegociacao VALID
#REGION 4
RETURN



PROCEDURE ULimpNegociacao

	ON KEY LABEL ENTER
	ON KEY LABEL TAB
	

	PrmIof_fin		=	1
	RtnTvlr_encarg	=	0
   	RtnTvlr_ioffnc	=	0
	RtnTvlr_doc		=	0

	m.vlrAprazo =0
	m.vlrVendor = 0
	

    =W_DEFPROC("DUPLICAT.spr")
	tmpsimld=CRConfigParcelas(wp_empresa,;
		m.tp_parcela,;
		m.Orcamento,;
		wp_dtOper,;
		m.Prazo,;
		m.Vlr_Ent,;
		m.valor,;
		PrmIof_fin,;
		clienc.Tp_Pessoa,;
		RtnTvlr_encarg, ;
    	RtnTvlr_ioffnc,;
		m.vlrVendor)
		
	IF m.tp_parcela <> 6		
	    m.vlrVendor = 0
	ENDIF

	
   	LSopcao = foxalert2('Confirma Impressao ?')
   	IF LSopcao = "S"

		do  ULPlnhdeFinanciamento with wp_empresa,m.orcamento


	ENDIF

	ON KEY LABEL ENTER

    =up_fecha("&tmpsimld")
RETURN





PROCEDURE ULPlnhdeFinanciamento
PARAMETER PrmEmpresa,PrmOrca

	PRIVATE PrmNroPlanilha
	PRIVATE RtnQtdeTitulos

	*------------------------------------------------------------*

	PrmNroPlanilha = 0
	RtnQtdeTitulos = 0

	*------------------------------------------------------------*


		SELECT ;
		   "TIPO-REG=1"  AS TP_REG,;
		   cl.empresa,;
		   1 AS CGC,;
    	   emp.nome as Nome_emp,;
	       cl.nome,;
    	   cl.cliente as favorecido,;
	       cl.endereco,;
    	   cl.bairro,;
	       cl.cidade,;
	       cl.estado as uf,;
    	   cl.CEP,;
		   IIF(dp.tp_parcela=6,dp.TOTVLVENDR,dp.vlr_doc) AS vlr_doc,;
		   (DTOC(dp.dt_emi);
			+space(5)+;
		   IIF(dp.tp_parcela=6,;
			    TRANSF(dp.TOTVLVENDR,"@Z *,***,**9.99"),;
			    TRANSF(dp.vlr_doc,"@Z *,***,**9.99"));
		    +space(4)+;
		   STR(dp.duplicata,9);
		    +space(4)+;
		   DTOC(dp.dt_venc)+space(20))   AS STRLINHA;
    	 FROM   EMPRESA emp, ;
     		CLIENC cl ,;
     		TMPVD dp ;
	     WHERE ;
			   cl.empresa   = PrmEmpresa AND emp.empresa = PrmEmpresa;
	       AND cl.orcamento = PrmOrca ;
    	   AND dp.empresa = cl.empresa ;
	       AND dp.orcamento = cl.orcamento ;
    	GROUP BY dp.empresa,dp.duplicata;
	    INTO CURSOR ULPlan1


		SELECT ;
		   "TIPO-REG=2"  AS TP_REG,;
		   cl.empresa,;
		   1 AS CGC,;
    	   emp.nome as Nome_emp,;
	       cl.nome,;
    	   cl.cliente as favorecido,;
	       cl.endereco,;
    	   cl.bairro,;
	       cl.cidade,;
	       cl.estado as uf,;
    	   cl.CEP,;
		   0000000.00 AS vlr_doc,;
		   ( "Qtde:"+STR(it.qtde,6);
		    +" -Produto: "+left(it.descricao,32);
		    +"-Codigo: "+it.codigo)  AS STRLINHA;
    	 FROM   EMPRESA emp, ;
     		CLIENC cl ,;
     		ORCATMP it ;
	     WHERE ;
			   cl.empresa   = PrmEmpresa ;
		   AND emp.empresa  = PrmEmpresa;
	       AND cl.orcamento = PrmOrca ;
    	   AND it.empresa   = cl.empresa ;
	       AND it.orcamento = cl.orcamento ;
	    INTO CURSOR ULPlan2

	select * from ulplan1 ;
	union ;
	select * from ulplan2 ;
	    INTO CURSOR ULPlan


	COUNT TO LNCtrTit
	RtnQtdeTitulos = RtnQtdeTitulos + LNCtrTit


	DO  ULimprimir WITH "rel538A"


    =up_fecha("ULplan1")
    =up_fecha("ULplan2")
    =up_fecha("ULplan")


RETURN

PROCEDURE ULimprimir
PARAMETERS LSrel
	GO TOP
	


	***************  IMPRESSAO relatorio  **********************
	IF !(EMPTY(ALLTRIM(wp_imprel)))
		RUN &wp_imprel > \TMP\SAIDA.TXT
	ENDIF
	SET PRINTER TO &wp_prtrel

	*----------------------------------------------------*
	*******************
	*---->   (INICIALIZACAO DO CONTROLE DE STATUS IMPRESSAO)
	*******************	
	DO RELINIC.PRG          && INICIA VAR P/ TERMOMETRO
	LFsegue = .t.
	LNregistro = RECNO()
    COUNT  TO LNimpressao
	LNimpressos = 0
	GO LNregistro
	*******************
	*---->   (COMPLETADO PREPARACAO DO CONTROLE DE STATUS IMPRESSAO)
	*******************	

	LFsegue  = .T.

	LSorienta = "WHILE  LFsegue  "

	***********
	DO UPimpressao
	LFcontinua = LFsegue

	***********
	DO RELFIM.PRG          && FIM VAR P/ TERMOMETRO


	SHOW WINDOWS SVD0520 TOP
	SHOW WINDOWS SVD0500 TOP
	SHOW WINDOWS NAVEGA TOP
	
	
RETURN



*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUN1S           ULPlnhdeFinanciamento VALID        є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0500R,     Record Number:   23  є
*       є Variable:            ULPlnhdeFinanciamento              є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      51                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4ei0lun1s     &&  ULPlnhdeFinanciamento VALID
#REGION 4
RETURN

PROCEDURE ULPlnhdeFinanciamento
PARAMETER PrmEmpresa,PrmOrca

	PRIVATE PrmNroPlanilha
	PRIVATE RtnQtdeTitulos

	*------------------------------------------------------------*

	PrmNroPlanilha = 0
	RtnQtdeTitulos = 0

	*------------------------------------------------------------*


		SELECT ;
		   "TIPO-REG=1"  AS TP_REG,;
		   cl.empresa,;
		   1 AS CGC,;
    	   emp.nome as Nome_emp,;
	       cl.nome,;
    	   cl.cliente as favorecido,;
	       cl.endereco,;
    	   cl.bairro,;
	       cl.cidade,;
	       cl.estado as uf,;
    	   cl.CEP,;
		   IIF(dp.tp_parcela=6,dp.TOTVLVENDR,dp.vlr_doc) AS vlr_doc,;
		   (DTOC(dp.dt_emi);
			+space(5)+;
		   IIF(dp.tp_parcela=6,;
			    TRANSF(dp.TOTVLVENDR,"@Z *,***,**9.99"),;
			    TRANSF(dp.vlr_doc,"@Z *,***,**9.99"));
		    +space(4)+;
		   STR(dp.duplicata,9);
		    +space(4)+;
		   DTOC(dp.dt_venc)+space(20))   AS STRLINHA;
    	 FROM   EMPRESA emp, ;
     		CLIENC cl ,;
     		TMPVD dp ;
	     WHERE ;
			   cl.empresa   = PrmEmpresa AND emp.empresa = PrmEmpresa;
	       AND cl.orcamento = PrmOrca ;
    	   AND dp.empresa = cl.empresa ;
	       AND dp.orcamento = cl.orcamento ;
    	GROUP BY dp.empresa,dp.duplicata;
	    INTO CURSOR ULPlan1


		SELECT ;
		   "TIPO-REG=2"  AS TP_REG,;
		   cl.empresa,;
		   1 AS CGC,;
    	   emp.nome as Nome_emp,;
	       cl.nome,;
    	   cl.cliente as favorecido,;
	       cl.endereco,;
    	   cl.bairro,;
	       cl.cidade,;
	       cl.estado as uf,;
    	   cl.CEP,;
		   0000000.00 AS vlr_doc,;
		   ( "Qtde:"+STR(it.qtde,6);
		    +" -Produto: "+left(it.descricao,32);
		    +"-Codigo: "+it.codigo)  AS STRLINHA;
    	 FROM   EMPRESA emp, ;
     		CLIENC cl ,;
     		ORCATMP it ;
	     WHERE ;
			   cl.empresa   = PrmEmpresa ;
		   AND emp.empresa  = PrmEmpresa;
	       AND cl.orcamento = PrmOrca ;
    	   AND it.empresa   = cl.empresa ;
	       AND it.orcamento = cl.orcamento ;
	    INTO CURSOR ULPlan2

	select * from ulplan1 ;
	union ;
	select * from ulplan2 ;
	    INTO CURSOR ULPlan


	COUNT TO LNCtrTit
	RtnQtdeTitulos = RtnQtdeTitulos + LNCtrTit


	DO  ULimprimir WITH "rel538A"


    =up_fecha("ULplan1")
    =up_fecha("ULplan2")
    =up_fecha("ULplan")


RETURN



*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUN1T           ULimprimir VALID                   є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0500R,     Record Number:   24  є
*       є Variable:            ULimprimir                         є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      52                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4ei0lun1t     &&  ULimprimir VALID
#REGION 4
RETURN


PROCEDURE ULimprimir
PARAMETERS LSrel
	GO TOP
	


	***************  IMPRESSAO relatorio  **********************
	IF !(EMPTY(ALLTRIM(wp_imprel)))
		RUN &wp_imprel > \TMP\SAIDA.TXT
	ENDIF
	SET PRINTER TO &wp_prtrel

	*----------------------------------------------------*
	*******************
	*---->   (INICIALIZACAO DO CONTROLE DE STATUS IMPRESSAO)
	*******************	
	DO RELINIC.PRG          && INICIA VAR P/ TERMOMETRO
	LFsegue = .t.
	LNregistro = RECNO()
    COUNT  TO LNimpressao
	LNimpressos = 0
	GO LNregistro
	*******************
	*---->   (COMPLETADO PREPARACAO DO CONTROLE DE STATUS IMPRESSAO)
	*******************	

	LFsegue  = .T.

	LSorienta = "WHILE  LFsegue  "

	***********
	DO UPimpressao
	LFcontinua = LFsegue

	***********
	DO RELFIM.PRG          && FIM VAR P/ TERMOMETRO


RETURN



*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUN1U           ULObservacao VALID                 є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0500R,     Record Number:   25  є
*       є Variable:            ULObservacao                       є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      53                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4ei0lun1u     &&  ULObservacao VALID
#REGION 4
RETURN
PROCEDURE ULObservacao
	
	DO ULsaveScreen
	DO SVD0560.spr WITH m.empresa,m.orcamento
	SELE orcament
	DO ULrestScreen
	=BTN_VAL1('ATUALIZAR', VLleitura, Vlcompara)
	
	IF WVISIBLE('SVD0520')
		HIDE WINDOW SVD0520
	ELSE
		SHOW WINDOWS SVD0520 TOP
	ENDIF
	_CUROBJ = OBJNUM(FR_btn)

RETURN


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUN1V           BTN_VAL1 VALID                     є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0500R,     Record Number:   27  є
*       є Variable:            BTN_VAL1                           є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      54                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4ei0lun1v     &&  BTN_VAL1 VALID
#REGION 4
RETURN

PROCEDURE BTN_VAL1
	PARAMETER Ltecla, Lchv_ler, Lchv_compara, Lchv_brow

	if !lMaster	   && Usuario de Manutencao (SISTEMA)
	    IF Ltecla = 'EDIT' AND "o" $ orcament.situacao
    	    wait WINDOWS ;
	          " OSI  Enviada para Faturamento nao pode ser editada <ENTER>"
    	   return
	    ENDIF
	ENDIF

	=btn_val2(Ltecla, Lchv_ler, Lchv_compara, Lchv_brow)		
	show GET m.imp_btn DISABLE
	SHOW WINDOWS SVD0520 TOP
	
RETURN


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUN1W           ULcall_log VALID                   є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0500R,     Record Number:   28  є
*       є Variable:            ULcall_log                         є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      55                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4ei0lun1w     &&  ULcall_log VALID
#REGION 4
RETURN

PROCEDURE ULcall_log
	=W_DEFPROC("ORCAMENT.SPR")
	=ORlog(orcament.empresa,orcament.Orcamento)
RETURN



*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUN1X           local_refresh VALID                є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0500R,     Record Number:   29  є
*       є Variable:            local_refresh                      є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      56                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4ei0lun1x     &&  local_refresh VALID
#REGION 4
RETURN

PROCEDURE local_refresh
PARAMETERS wl_branco


*****>>>>>>>>>>>  abilita os acessos permitidos
	LNindice = 0
	LSaces = "   "
	IF !lMaster
		LNindice = ASCAN(vAcessos,WPprgativo)
		IF LNindice > 0
				LNindice = ASUBSCRIPT(VACESSOS,LNindice,1)
				LSaces = vAcessos(LNindice,2)
		ENDIF
	ENDIF
******	
IF m.protegido
	SHOW GET prot_btn,1 PROMPT "\<R-Desprot"
ELSE
	SHOW GET prot_btn,1 PROMPT "\<R-Protege"
ENDIF

IF "LOG" $ LSaces OR lMaster			&& ACESSO AO LOG
	ON KEY LABEL CTRL-G		DO ULcall_log
ELSE
	ON KEY LABEL CTRL-G
ENDIF

DO CASE

   CASE isediting OR isreading
      SHOW GET rc_btn   DISABLE
	  SHOW GET co_btn   DISABLE
	  SHOW GET ap_btn   DISABLE
      SHOW GET rm_btn   DISABLE
	  SHOW GET cr_btn   DISABLE
	  SHOW GET lib_btn  DISABLE
      SHOW GET cnslt_btn DISABLE
	  SHOW GET cnlib_btn  DISABLE
	  SHOW GET osi_btn  DISABLE
	  SHOW GET Tosi_btn  DISABLE
	  SHOW GET fat_btn  DISABLE
	  SHOW GET cnfcha_btn DISABLE
	  SHOW GET cm_btn   DISABLE
	  SHOW GET cad_btn  DISABLE
	  SHOW GET atdm_btn DISABLE
	  SHOW GET atdr_btn DISABLE
	  SHOW GET atva_btn DISABLE
	  SHOW GET com_btn DISABLE
	  SHOW GET fin_btn DISABLE
	  SHOW GET tab_btn DISABLE
	  SHOW GET vp_btn DISABLE
	  SHOW GET oper_btn DISABLE
	  SHOW GET rodiz_btn DISABLE
	  SHOW GET item_btn DISABLE
	  SHOW GET nro_btn DISABLE
	  SHOW GET stcr_btn DISABLE
	  SHOW GET reimp_btn DISABLE
	  SHOW GET prot_btn DISABLE
	  SHOW GET CNosi_btn DISABLE
	  SHOW GET ver DISABLE
	  SHOW GET ECF_BTN DISABLE
	  IF LSjanela <> "SCGC201"
		  SHOW GET prov_btn   DISABLE
		  SHOW GET financ_btn DISABLE
		  SHOW GET inform_btn DISABLE
	  ENDIF
	  SHOW GET ImpBTS_btn DISABLE
   CASE  wl_branco
      SHOW GET rc_btn   DISABLE
	  SHOW GET co_btn   DISABLE
	  SHOW GET ap_btn   DISABLE
      SHOW GET rm_btn   DISABLE
	  SHOW GET cr_btn   DISABLE
	  SHOW GET lib_btn  DISABLE
	  SHOW GET cnlib_btn  DISABLE
      SHOW GET cnslt_btn DISABLE

	  SHOW GET osi_btn  DISABLE
	  SHOW GET Tosi_btn  DISABLE
	  SHOW GET cnosi_btn  DISABLE
	  SHOW GET fat_btn  DISABLE
	  SHOW GET cnfcha_btn DISABLE
	  SHOW GET cm_btn   DISABLE
	  SHOW GET atdm_btn DISABLE
	  SHOW GET atdr_btn DISABLE
	  SHOW GET atva_btn DISABLE
	  SHOW GET com_btn DISABLE
	  SHOW GET fin_btn DISABLE
	  SHOW GET rodiz_btn DISABLE
	  SHOW GET prov_btn   DISABLE
	  SHOW GET financ_btn DISABLE
	  SHOW GET inform_btn DISABLE
	  SHOW GET item_btn DISABLE
	  SHOW GET stcr_btn DISABLE
	  SHOW GET reimp_btn DISABLE
	  SHOW GET prot_btn DISABLE
	  SHOW GET CNosi_btn DISABLE
	  SHOW GET ECF_BTN DISABLE
	  SHOW GET ImpBTS_btn DISABLE
	OTHERWISE
	  LSl = LEFT(m.situacao,1)
	  LSr = RIGHT(m.situacao,1)

	  ************  DESABILITACAO POR LIMITACAO DO USR  ************

	  IF "0" $ LSaces			&& Impressao de Copia de Osi
		 	 SHOW GET reimp_btn DISABLE
	  ENDIF

	  IF "1" $ LSaces			&& VENDA PADRAO
			SHOW GET vp_btn   DISABLE
	  ENDIF
	  IF "2" $ LSaces			&& RESERVA
			SHOW GET rm_btn   DISABLE
	  ENDIF
	  IF "3" $ LSaces			&& OSI
			SHOW GET osi_btn   DISABLE
			SHOW GET Tosi_btn   DISABLE
	  ENDIF
	  IF "4" $ LSaces			&& FATURAMENTO
		  SHOW GET fat_btn   DISABLE
		  SHOW GET cnfcha_btn DISABLE
	  ENDIF
	
	  IF "5" $ LSaces			&& CANCELA OSI
			SHOW GET cnosi_btn   DISABLE
	  ENDIF

	  IF "6" $ LSaces			&& CANC. RESERVA
			SHOW GET cr_btn   DISABLE
	  ENDIF
	  IF "7" $ LSaces			&& CANC. ORCA.
			SHOW GET co_btn   DISABLE
	  ENDIF
	  IF "8" $ LSaces			&& LIBERA
			SHOW GET lib_btn   DISABLE
	  ENDIF
	  IF "9" $ LSaces			&& LIBERA
		  SHOW GET cnlib_btn  DISABLE
	  endif
	  IF LSl <> "A" AND !lMaster
			SHOW GET del_btn   DISABLE
	  ENDIF
***
	  IF "K" $ LSaces			&& Cadastro
			SHOW GET cad_btn   DISABLE
	  ENDIF
	  IF "N" $ LSaces			&& Cadastro
			SHOW GET item_btn   DISABLE
	  ENDIF
	  IF "O" $ LSaces			&& Cadastro
			SHOW GET oper_btn   DISABLE
	  ENDIF
	  IF "Q" $ LSaces			&& numero proxima nota
		 	 SHOW GET nro_btn DISABLE
	  ENDIF
	  IF "R" $ LSaces			&& Cadastro
			SHOW GET prot_btn DISABLE
	  ENDIF

	  IF "T" $ LSaces			&& Cadastro
			SHOW GET tab_btn   DISABLE
	  ENDIF
	  IF "V" $ LSaces			&& Ver sit. de credito
		 	 SHOW GET stcr_btn DISABLE
	  ENDIF

ENDCASE

RETURN


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUN2Z           ULativaliberacao VALID             є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0500R,     Record Number:   30  є
*       є Variable:            ULativaliberacao                   є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      57                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4ei0lun2z     &&  ULativaliberacao VALID
#REGION 4
RETURN

PROCEDURE ULativaliberacao
	*----------------------------------------------------------------*
	* 		Rotina para centralizar a chaada da liberacao 			
	*	Chamada em dois pontos
	*		<8-Lib.Credito> = Liberacao normal da osis q estao aguardando
	*		<9-Lib.Credito Geral> = Liberacao visualizan inclusive
	*		osis ja liberadas normal da osis q estao aguardando
	*----------------------------------------------------------------*

	IF LASTKEY() = 27
		RETURN
	ENDIF
	CLEAR TYPEAHEAD
	IF orcament.valor = 0
		WAIT WINDOW "Orcamento com VALOR = 0. - Lance os Itens"
		RETURN
	ENDIF
	*----------------------------------------------------------------*
	DO ULsaveScreen




*	LSmsg  = "Usar liberacao Antiga? "
*	IF fox_alert(LSmsg)
*
*
* 	   DO OBJ_LIBE.spr WITH orcament.empresa,;
*  	                        orcament.orcamento,;
*  	                        wl_vendedor
*    ELSE
*
*
*
*	   =W_DEFPROC("ORCAMENT.SPR")
*      =ORTenta_Liberar(orcament.empresa,;
*  	                        orcament.orcamento)
*
*
*   ENDIF





  	   DO OBJ_LIBE.spr WITH orcament.empresa,;
  	                        orcament.orcamento,;
  	                        wl_vendedor


	DO ULrestScreen

	SELE orcament
	*----------------------------------------------------------------*

	SELE ORCAMENT
	UNLOCK ALL
	=BTN_VAL1('ATUALIZAR', VLleitura, Vlcompara)
	WP_RECORD = RECNO()
					
	UNLOCK ALL
RETURN



*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUN39           ULsaveScreen VALID                 є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0500R,     Record Number:   31  є
*       є Variable:            ULsaveScreen                       є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      58                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4ei0lun39     &&  ULsaveScreen VALID
#REGION 4
RETURN

**
PROCEDURE ULsaveScreen
	
	PUBLIC VLtela500,VLtela520,VLtelanv
	
	ACTIVATE WINDOW SVD0500
	SAVE SCREEN TO VLtela500

	ACTIVATE WINDOW SVD0520
	SAVE SCREEN TO VLtela520

	ACTIVATE WINDOW NAVEGA
	SAVE SCREEN TO VLtelanv
**
	DEACTIVATE WINDOW NAVEGA
	DEACTIVATE WINDOW SVD0500
	DEACTIVATE WINDOW SVD0520

	HIDE WINDOW NAVEGA
	HIDE WINDOW SVD0500
	HIDE WINDOW SVD0520
RETURN



*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUN3A           ULrestScreen VALID                 є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0500R,     Record Number:   32  є
*       є Variable:            ULrestScreen                       є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      59                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4ei0lun3a     &&  ULrestScreen VALID
#REGION 4
RETURN

PROCEDURE ULrestScreen

	ACTIVATE WINDOW NAVEGA
	RESTORE SCREEN FROM VLtelanv

	ACTIVATE WINDOW SVD0520
	SHOW WINDOW SVD0520
	RESTORE SCREEN FROM VLtela520
	HIDE WINDOW SVD0520

	ACTIVATE WINDOW SVD0500
	SHOW WINDOW SVD0500
	RESTORE SCREEN FROM VLtela500
	SELE ORCAMENT
	RELEASE  VLtela500,VLtela520,VLtelanv

RETURN



*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUN3B           ULGerBTSOSI VALID                  є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0500R,     Record Number:   33  є
*       є Variable:            ULGerBTSOSI                        є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      60                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4ei0lun3b     &&  ULGerBTSOSI VALID
#REGION 4
RETURN

PROCEDURE ULGerBTSOSI
	*------------------------------------------*
	=W_DEFPROC("ORCAMENT.SPR")
	=ORGerBTS2(orcament.empresa,orcament.orcamento)
	*------------------------------------------*
RETURN

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUN3C           ULConsultaLiberaCredito VALID      є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0500R,     Record Number:   34  є
*       є Variable:            ULConsultaLiberaCredito            є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      61                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4ei0lun3c     &&  ULConsultaLiberaCredito VALID
#REGION 4
RETURN

PROCEDURE ULConsultaLiberaCredito
	PRIVATE LScdgSitCred
	LScdgSitCred = 0
	*------------------------------------------------------------*
	=W_DEFPROC("ORCAMENT.SPR")
	DO ORloc_orc WITH "FGILM", "DH","LIBERAR"
	=BTN_VAL1('ATUALIZAR', VLleitura, Vlcompara)
	*------------------------------------------------------------*
	SELE orcament
	LNregorc = RECNO()
	*---------------------------------------------------------------*
	=W_DEFPROC("orcament.spr")



    PRIVATE LNemp,LNosi
    LNemp = orcament.empresa
    LNosi = orcament.orcamento

    =ORTenta_Liberar(orcament.empresa, orcament.orcamento)





  	*---------------------------------------------------------------*
	SELE orcament
	SET ORDER TO tag orcamento
	GO LNregorc
	UNLOCK ALL
	UNLOCK ALL
	UNLOCK ALL


	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	

	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	
	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	
	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
    CLEAR TYPEAHEAD	
RETURN






*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUN3D           ULEftvaCancOrcamento VALID         є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SVD0500R,     Record Number:   35  є
*       є Variable:            ULEftvaCancOrcamento               є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      62                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4ei0lun3d     &&  ULEftvaCancOrcamento VALID
#REGION 4
RETURN

FUNCTION ULEftvaCancOrcamento
	*------------------------------------------------------------*
	=W_DEFPROC("ORCAMENT.SPR")

	IF !REGLOCK()
	   WAIT WINDOW "Orcamento em uso em outro ponto. Tente novamente."
		RETURN
	ENDIF


	SELECT  orcatmp
	SET ORDER TO TAG orcamento
	SET NEAR ON
	SEEK STR(orcament.empresa,3)+STR(orcament.orcamento,6)
	SET NEAR OFF
	
*--------------------*
    PRIVATE PrmEmpresa,PrmOrcamento

    PrmEmpresa    = orcament.empresa
    PrmOrcamento  = orcament.orcamento

*--------------------*
	
	DO WHILE !EOF() AND orcament.orcamento 	= orcatmp.orcamento ;
					AND orcament.empresa 	= orcatmp.empresa
	   =REGLOCK(.T.)
	   REPLACE situacao WITH "Z"+RIGHT(orcatmp.situacao,1)
	   SKIP
	ENDDO

	SELECT orcament
	REPLACE situacao WITH "Z"+RIGHT(orcament.situacao,1)
	REPLACE dt_fat   WITH wp_dtoper					&& = DT. CANCELAMENTO
	REPLACE	hora_fat WITH time()




	*---------------------------------------------------------------*
	* 	ENCERRA SOLICITACAO DE CREDITO
	*---------------------------------------------------------------*

	private LSCnsltCrdt

	=W_DEFPROC("EMPRESA.SPR")
	LSCnsltCrdt = EMGetFieldValue(wp_empresa,"CNSLT_CRDT")
RETURN


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUMU4           Read Level When                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         Multiple Screens                   є
*       є Called By:           READ Statement                     є
*       є Snippet Number:      63                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4ei0lumu4     && Read Level When
*
* When Code from screen: SVD0500
*
#REGION 1
=btn_val1('ATUALIZA', VLlerfim, Vlcompara)
RETURN(READWHEN())

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4EI0LUN3E           Read Level Show                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         Multiple Screens                   є
*       є Called By:           READ Statement                     є
*       є Snippet Number:      64                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4ei0lun3e     && Read Level Show
PRIVATE currwind
STORE WOUTPUT() TO currwind
*
* Show Code from screen: SVD0520
*
#REGION 3


DO CASE
	CASE LSprograma = "FAT. SEM RESERVA"
		SHOW GET m.rm_btn disable
		SHOW GET m.osi_btn disable
		SHOW GET m.CNosi_btn disable
		SHOW GET m.cr_btn disable
		SHOW GET m.lib_btn disable
		SHOW GET m.cnlib_btn disable
		SHOW GET m.ecf_btn disable
		SHOW GET m.prot_btn disable
		SHOW GET m.stcr_btn disable
		SHOW GET m.reimp_btn disable
		SHOW GET m.cnfcha_btn disable
	CASE LSprograma = "FAT. COM RESERVA"
		SHOW GET m.osi_btn disable
		SHOW GET m.CNosi_btn disable
		SHOW GET m.lib_btn disable
		SHOW GET m.cnlib_btn disable
		SHOW GET m.ecf_btn disable
		SHOW GET m.prot_btn disable
		SHOW GET m.stcr_btn disable
		SHOW GET m.reimp_btn disable
		SHOW GET m.cnfcha_btn disable
ENDCASE	
SHOW GET m.nro_btn disable

*
* Show Code from screen: SVD0500R
*
#REGION 4
HIDE WINDOW SVD0500R
RETURN
IF NOT EMPTY(currwind)
	ACTIVATE WINDOW (currwind) SAME
ENDIF