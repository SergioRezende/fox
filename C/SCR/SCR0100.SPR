*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є 19/03/2009            SCR0100.SPR              11:46:05 є
*       є                                                         є
*       ЗДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД¶
*       є                                                         є
*       є Author's Name                                           є
*       є                                                         є
*       є Copyright (c) 2009 Company Name                         є
*       є Address                                                 є
*       є City,     Zip                                           є
*       є                                                         є
*       є Description:                                            є
*       є This program was automatically generated by GENSCRN.    є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є          SCR0100/MS-DOS Setup Code - SECTION 1          є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1
    = W_DEFPROC("rotinas.spr")
	ON KEY LABEL ESCAPE
	PRIVATE LFitemmov,LFsldressa
	PRIVATE LSalias
	PRIVATE wp_ref_local
	PRIVATE isediting
	wp_ref_local =  .f.     && NAO POSSUI CONTROLE DE REFRESH LOCAL
	m.isediting	 =	.F.
	LSalias	     = ALIAS()
    LFempresa    	= NetArq("empresa")
    LFduplicat   	= NetArq("duplicat")
    LFbanco		 	= NetArq("banco")
    IF (LFempresa+LFduplicat+LFbanco) > 100000
		DO ulfecha
    	RETURN(.F.)
    ENDIF

#REGION 0
REGIONAL m.currarea, m.talkstat, m.compstat

IF SET("TALK") = "ON"
	SET TALK OFF
	m.talkstat = "ON"
ELSE
	m.talkstat = "OFF"
ENDIF
m.compstat = SET("COMPATIBLE")
SET COMPATIBLE FOXPLUS

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є                MS-DOS Window definitions                є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

IF NOT WEXIST("scr0100") ;
	OR UPPER(WTITLE("SCR0100")) == "SCR0100.PJX" ;
	OR UPPER(WTITLE("SCR0100")) == "SCR0100.SCX" ;
	OR UPPER(WTITLE("SCR0100")) == "SCR0100.MNX" ;
	OR UPPER(WTITLE("SCR0100")) == "SCR0100.PRG" ;
	OR UPPER(WTITLE("SCR0100")) == "SCR0100.FRX" ;
	OR UPPER(WTITLE("SCR0100")) == "SCR0100.QPR"
	DEFINE WINDOW scr0100 ;
		FROM INT((SROW()-7)/2),INT((SCOL()-76)/2) ;
		TO INT((SROW()-7)/2)+6,INT((SCOL()-76)/2)+75 ;
		TITLE "[ Saldos Por Protador]" ;
		FOOTER "[SCR0100]" ;
		NOFLOAT ;
		NOCLOSE ;
		SHADOW ;
		NOMINIMIZE ;
		NONE ;
		COLOR SCHEME 1
ENDIF


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є          SCR0100/MS-DOS Setup Code - SECTION 2          є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є              SCR0100/MS-DOS Screen Layout               є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1
IF WVISIBLE("scr0100")
	ACTIVATE WINDOW scr0100 SAME
ELSE
	ACTIVATE WINDOW scr0100 NOSHOW
ENDIF
@ 0,0 TO 6,75 ;
	COLOR SCHEME 23
@ 6,1 TO 6,74 ;
	COLOR SCHEME 24
@ 6,75 SAY "Щ" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,75 TO 5,75 ;
	COLOR SCHEME 24
@ 0,75 SAY "ї" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 2,8 TO 4,24 ;
	COLOR SCHEME 24
@ 4,9 TO 4,23 ;
	COLOR SCHEME 23
@ 3,24 SAY "і" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 4,24 SAY "Щ" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 2,24 SAY "ї" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 2,52 TO 4,68 ;
	COLOR SCHEME 24
@ 4,53 TO 4,67 ;
	COLOR SCHEME 23
@ 3,68 SAY "і" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 4,68 SAY "Щ" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 2,68 SAY "ї" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 3,12 GET m.imp_btn ;
	PICTURE "@*HN \<Imprime" ;
	SIZE 1,9,1 ;
	DEFAULT 1 ;
	VALID _2lx0p816z()
@ 3,57 GET exit_btn ;
	PICTURE "@*HN \<Saida" ;
	SIZE 1,7,1 ;
	DEFAULT 1 ;
	VALID _2lx0p8179()
@ 0,65 SAY "[SCR0100]" ;
	SIZE 1,9, 0
@ 0,13 SAY "[ Relatorio de Saldos Cobranca Por Portador ]" ;
	SIZE 1,45, 0

IF NOT WVISIBLE("scr0100")
	ACTIVATE WINDOW scr0100
ENDIF

READ CYCLE

RELEASE WINDOW scr0100

#REGION 0
IF m.talkstat = "ON"
	SET TALK ON
ENDIF
IF m.compstat = "ON"
	SET COMPATIBLE ON
ENDIF


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є               SCR0100/MS-DOS Cleanup Code               є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1
	DO ULfecha
RETURN



*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є   SCR0100/MS-DOS Supporting Procedures and Functions    є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1
PROC ulfecha
	=UP_fecha("empresa"  ,LFempresa)
	=UP_fecha("duplicat" ,LFduplicat)
	=UP_fecha("banco"	 ,LFbanco)
RETURN







*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _2LX0P816Z           m.imp_btn VALID                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCR0100,     Record Number:   17   є
*       є Variable:            m.imp_btn                          є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      1                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _2lx0p816z     &&  m.imp_btn VALID
#REGION 1
	DO ULimprime
	*-----------------------------
	SHOW WINDOW SCR0100 TOP
	SELE DUPLICAT
	
RETURN

PROCEDURE ULimprime

	PRIVATE LSpath, LSarqtmp

	*====================================================*

	SAVE SCREEN TO VLwin535
	SET TALK ON

	SELECT ;
		   DP.EMPRESA,;
		   LEFT(EMP.SIGLA+SPACE(25),25) AS SIGLA,;	
		   DP.PORTADOR,;
		   BCO.NOME,;
	   	   COUNT(*) AS QTD_TIT, ;
	   	   SUM(DP.VLR_DOC - DP.PARC_PGTO) AS VALOR ;
	FROM  ;
		   EMPRESA EMP,;
		   BANCO BCO,;
	   	   DUPLICAT DP;
	WHERE     EMPTY(DP.DT_PGTO) ;
		  AND EMP.EMPRESA = DP.EMPRESA ;
		  AND BCO.BANCO   = DP.PORTADOR ;
	GROUP BY DP.EMPRESA, DP.PORTADOR ;
	INTO CURSOR S_PORTADOR

	*=====> Totaliza Cobranca Por Empresa <=======*
	SELECT EMPRESA,;
		   SUM(VALOR) AS TOTAL_EMP ;
	FROM   S_PORTADOR;
	GROUP BY EMPRESA ;
	INTO CURSOR TOT_EMPRES
	*=============================================*

	*=====> Totaliza Cobranca Geral <======*
	SELECT 1 AS CHAVE ,;
		   SUM(VALOR) AS TOTAL ;
	FROM   S_PORTADOR;
	INTO CURSOR TOT_GERAL

	*=============================================*

	*====> Percentualizando o Portador em Relacao ao Total da LOJA <======*

	SELECT ;
		   	PRT.EMPRESA,;
		   	PRT.SIGLA,;	
		   	PRT.PORTADOR,;
		   	PRT.NOME,;
		  	PRT.VALOR, ;
			((PRT.VALOR*100)/EMP.TOTAL_EMP ) AS PRC_EMPR,;
			EMP.TOTAL_EMP,;
		    0000000000000.00  AS  CRB_PORT, ;
		    000000000000000000000000000000.00    AS  PRC_PORT,  ;
		    TOT.TOTAL, ;
			(00001*PRT.QTD_TIT) AS QTD_TIT;
	FROM TOT_EMPRES EMP , S_PORTADOR PRT,TOT_GERAL TOT ;
	    WHERE EMP.EMPRESA = PRT.EMPRESA ;
	          AND TOT.CHAVE = 1 ;
	ORDER BY PRT.EMPRESA, PRT.PORTADOR ;
	INTO CURSOR SEMP_PORT
	*===================================================================*

	*====> Resumindo Valores Por Portador independente da  LOJA <======*
	SELECT 999    AS EMPRESA,;
		   LEFT("RESUMO POR PORTADOR"+SPACE(25),25)   AS SIGLA,;	
	   		PORTADOR,;
		   NOME,;
		   0000000000000.00  AS  VALOR ,;	
		   000000000000000000000000000000.00   AS  PRC_EMPR ,;
		   0000000000000.00  AS  TOTAL_EMP,;	
		   SUM(VALOR)     AS CRB_PORT, ;
	   	   SUM(QTD_TIT)   AS QTD_TIT ;
	FROM SEMP_PORT;
	GROUP BY  PORTADOR ;
	INTO CURSOR TMP_PORT
	*====================================================================*
	*=====> Percentualizando o Portador em Relacao ao Total Geral <======*

	SELECT  ;
		   	TMP.EMPRESA,;
		   	TMP.SIGLA,;	
		   	TMP.PORTADOR,;
		   	TMP.NOME,;
		  	TMP.VALOR, ;
			TMP.PRC_EMPR,;
			TMP.TOTAL_EMP,;
		    TMP.CRB_PORT, ;
		   (CRB_PORT*100)/TOT.TOTAL AS PRC_PORT,;
			TOT.TOTAL, ;
			TMP.QTD_TIT;
	FROM TMP_PORT TMP, TOT_GERAL TOT ;
	WHERE TOT.CHAVE = 1 ;
	INTO CURSOR TMP_PORT
	*=================================================*


	*==> UNINDO DETALHAMENTO DO PORTADOR POR EMPRESA AO RESUMO POR PORTADOR
	SELECT * FROM SEMP_PORT;
		UNION ;
	SELECT * FROM TMP_PORT ;
	INTO CURSOR RESUMO
	

	SELECT * FROM RESUMO ;
	ORDER BY EMPRESA, PRC_EMPR, PRC_PORT;
    INTO CURSOR RESUMO
	

	*=================================================================*


	*====================================================*

	SET TALK OFF
	RESTORE SCREEN FROM VLwin535
			
	GO TOP
		***
	IF EOF() OR BOF()
		=UP_fecha("S_PORTADOR")
		=UP_fecha("TOT_EMPRES")
		=UP_fecha("TOT_GERAL")
		=UP_fecha("SEMP_PORT")
		=UP_fecha("TMP_PORT")
		=UP_fecha("RESUMO")
 		WAIT WINDOW "Nao Foram encotrados dados para impessao."
 		SELE duplicat
 		RETURN
 	ENDIF		


	M.TITULO  = "COMADOS P/ COBRANCA"

*******************
*---->   (INICIALIZACAO DO CONTROLE DE STATUS IMPRESSAO)
*******************	
	DO RELINIC.PRG          && INICIA VAR P/ TERMOMETRO
	LFsegue = .t.
	LNregistro = RECNO()
	LNimpressao = 0
    COUNT    TO LNimpressao
	LNimpressos = 0
	GO LNregistro
*******************
*---->   (COMPLETADO PREPARACAO DO CONTROLE DE STATUS IMPRESSAO)
*******************	

*---------------------------------------------------------------------*
	LF_fim  = .f.
    LSrel = "RCR0100"      && relatorio padrao
    LSorienta = "WHILE LFsegue "
	DO UPimpressao    && COORDENA TRABALHO DE IMPRESSAO
************
	LNpagina = _PAGENO   && DAR SEQUENCIA AO N. PAGINA
	DO RELFIM.PRG          && FIM VAR P/ TERMOMETRO
**************************>>> RESUMO POR CFO
*-----------------------------
	=UP_fecha("S_PORTADOR")
	=UP_fecha("TOT_EMPRES")
	=UP_fecha("TOT_GERAL")
	=UP_fecha("SEMP_PORT")
	=UP_fecha("TMP_PORT")
	=UP_fecha("RESUMO")


	SELE DUPLICAT
	
	SHOW WINDOW SCR0100  TOP
	SHOW GETS
	
RETURN




*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _2LX0P8179           exit_btn VALID                     є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCR0100,     Record Number:   18   є
*       є Variable:            exit_btn                           є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      2                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _2lx0p8179     &&  exit_btn VALID
#REGION 1
CLEAR READ
CLEAR GETS
