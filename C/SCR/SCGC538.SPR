*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º 19/03/2009            SCGC538.SPR              11:45:46 º
*       º                                                         º
*       ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
*       º                                                         º
*       º Author's Name                                           º
*       º                                                         º
*       º Copyright (c) 2009 Company Name                         º
*       º Address                                                 º
*       º City,     Zip                                           º
*       º                                                         º
*       º Description:                                            º
*       º This program was automatically generated by GENSCRN.    º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½


#REGION 0
REGIONAL m.currarea, m.talkstat, m.compstat

IF SET("TALK") = "ON"
	SET TALK OFF
	m.talkstat = "ON"
ELSE
	m.talkstat = "OFF"
ENDIF
m.compstat = SET("COMPATIBLE")
SET COMPATIBLE FOXPLUS

*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º                MS-DOS Window definitions                º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

IF NOT WEXIST("scgc538") ;
	OR UPPER(WTITLE("SCGC538")) == "SCGC538.PJX" ;
	OR UPPER(WTITLE("SCGC538")) == "SCGC538.SCX" ;
	OR UPPER(WTITLE("SCGC538")) == "SCGC538.MNX" ;
	OR UPPER(WTITLE("SCGC538")) == "SCGC538.PRG" ;
	OR UPPER(WTITLE("SCGC538")) == "SCGC538.FRX" ;
	OR UPPER(WTITLE("SCGC538")) == "SCGC538.QPR"
	DEFINE WINDOW scgc538 ;
		FROM INT((SROW()-7)/2),INT((SCOL()-72)/2) ;
		TO INT((SROW()-7)/2)+6,INT((SCOL()-72)/2)+71 ;
		FLOAT ;
		NOCLOSE ;
		SHADOW ;
		NOMINIMIZE ;
		NONE ;
		COLOR SCHEME 1
ENDIF


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º          SCGC538/MS-DOS Setup Code - SECTION 2          º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 1

	*---------------------------------------------------------------------*

	CLEAR TYPEAHEAD
	PUSH KEY CLEAR		&& desabilita teclas de atalho def. anteriormente
	ON KEY LABEL F1		DO HLP2000.SPR WITH  POPUP(),PROMPT(),PROGRAM(),;
							WONTOP(),VARREAD()

	******************************************************************
	*		VARIAVEIS - PADRAO
	******************************************************************

	PRIVATE LSalias, isediting
	PRIVATE LFempresa


	******************************************************************
	*		VARIAVEIS - ESPECIFICAS
	******************************************************************

	******************************************************************
	ON KEY LABEL ESCAPE	KEYBOARD "{BACKTAB}"
	LSalias  	= ALIAS()
	m.isediting	=	.t.

	LFempresa		= NetArq("empresa")

	*--------------------------------------------------------

    IF (LFempresa) > 100000

    	=up_fecha("Empresa")
		IF !EMPTY(LSalias) AND USED(LSalias)
			SELECT &LSalias
		ENDIF
		POP KEY 			&& reabilita teclas de atalho def. anteriormente
		RETURN(.f.)

	ENDIF

	*--------------------------------------------------------








*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º              SCGC538/MS-DOS Screen Layout               º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 1
IF WVISIBLE("scgc538")
	ACTIVATE WINDOW scgc538 SAME
ELSE
	ACTIVATE WINDOW scgc538 NOSHOW
ENDIF
@ 0,0 TO 6,70 ;
	COLOR SCHEME 23
@ 6,1 TO 6,69 ;
	COLOR SCHEME 24
@ 6,70 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,70 TO 5,70 ;
	COLOR SCHEME 24
@ 0,70 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 3,9 SAY "-" ;
	SIZE 1,1, 0
@ 2,3 TO 4,31 ;
	COLOR SCHEME 23
@ 4,4 TO 4,30 ;
	COLOR SCHEME 24
@ 4,31 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 3,31 SAY "³" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 2,31 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 2,4 SAY "[Filial]" ;
	SIZE 1,8, 0
@ 2,35 TO 4,49 ;
	COLOR SCHEME 23
@ 4,36 TO 4,48 ;
	COLOR SCHEME 24
@ 4,49 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 3,49 SAY "³" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 2,49 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 3,6 GET m.empresa ;
	SIZE 1,3 ;
	DEFAULT 0 ;
	PICTURE "999" ;
	WHEN isediting ;
	VALID _2lx0p7n5m()
@ 3,10 GET m.nome_emp ;
	SIZE 1,20 ;
	DEFAULT " " ;
	PICTURE "@!K" ;
	WHEN _2lx0p7n5y()
@ 3,37 GET m.dt_inicio ;
	SIZE 1,10 ;
	DEFAULT {  /  /  } ;
	WHEN isediting ;
	VALID _2lx0p7n62()
@ 0,17 SAY "[ Planilhas Fechamento Vendor ]" ;
	SIZE 1,31, 0
@ 0,59 SAY "[SCGC538]" ;
	SIZE 1,9, 0
@ 2,36 SAY "[ Data ]" ;
	SIZE 1,8, 0

IF NOT WVISIBLE("scgc538")
	ACTIVATE WINDOW scgc538
ENDIF


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º     MS-DOSREAD contains clauses from SCREEN scgc538     º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

READ CYCLE ;
	ACTIVATE READACT() ;
	DEACTIVATE READDEAC()

RELEASE WINDOW scgc538

#REGION 0
IF m.talkstat = "ON"
	SET TALK ON
ENDIF
IF m.compstat = "ON"
	SET COMPATIBLE ON
ENDIF


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º               SCGC538/MS-DOS Cleanup Code               º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 1
	POP KEY 			&& reabilita teclas de atalho def. anteriormente
RETURN




*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º   SCGC538/MS-DOS Supporting Procedures and Functions    º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 1
PROCEDURE ULVendorRltFechamento
PARAMETER PrmEmpresa,PrmData

	PRIVATE ARQ_Duplicat,ALS_Duplicat
	PRIVATE ARQ_Nota,ALS_Nota
	PRIVATE ARQ_Cobranca,ALS_Cobranca
	PRIVATE LSAlias


    LSAlias      = Alias()

    ARQ_Duplicat     = NetArqAgain("Duplicat")
    ALS_Duplicat     = Alias()


    ARQ_Nota     	 = NetArqAgain("Nota")
    ALS_Nota         = Alias()


    ARQ_Cobranca   	 = NetArqAgain("Cobranca")
    ALS_Cobranca     = Alias()


	DO ULRsmoVendor WITH PrmEmpresa,PrmData


    =up_fecha("&ALS_Duplicat")
    =up_fecha("&ALS_Nota")
    =up_fecha("&ALS_Cobranca")
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF

RETURN

PROCEDURE ULPlnhdeFinanciamento
PARAMETER PrmEmpresa,PrmNota,;
	      PrmNroPlanilha,;
		  RtnQtdeTitulos

	*------------------------------------------------------------*

	SELECT ;
	   nf.empresa,;
	   cb.num_inscr AS CGC,;
       cb.Nome_emp,;
       cb.agencia,;
       cb.agencia_dg,;
       cb.conta,;
       cb.conta_dg,;
       cb.convenio,;
       cb.dt_vigor,;
       nf.data,;
       nf.nome,;
       nf.favorecido,;
       nf.endereco,;
       nf.bairro,;
       nf.cidade,;
       nf.uf,;
       nf.CEP,;
       "Pre-Fixado" as Tp_encargos,;
       IIF(dp.iof_fin=1," ","Nao")+" Financiado" as tp_iof,;
       dp.vlr_compra,;
       dp.vlr_doc,;
       dp.duplicata,;
       dp.dt_venc,;
       dp.tx_jurosvd,;
       dp.tx_juroscp;
     FROM   &ALS_COBRANCA cb, ;
     		&ALS_nota nf ,;
     		&ALS_Duplicat dp ;
     WHERE ;
		   nf.empresa = PrmEmpresa ;
       AND nf.nota = PrmNota ;
	   AND nf.tp_parcela = 6 ;
	   AND nf.status <> 2 ;
       AND dp.empresa = nf.empresa ;
       AND dp.nota = nf.nota ;
       AND cb.loja =dp.empresa ;
       AND cb.banco   = dp.banco;
    GROUP BY dp.empresa,dp.duplicata;
    INTO CURSOR ULPlan


	COUNT TO LNCtrTit
	RtnQtdeTitulos = RtnQtdeTitulos + LNCtrTit


	DO  ULimprimir WITH "rel538"

RETURN


PROCEDURE ULRsmoVendor
PARAMETER PrmEmpresa,PrmData


	SELECT ;
	   nf.empresa,;
	   cb.num_inscr AS CGC,;
       cb.Nome_emp,;
       cb.agencia,;
       cb.agencia_dg,;
       cb.conta,;
       cb.conta_dg,;
       cb.convenio,;
       cb.dt_vigor,;
       dp.nota,;
       nf.data,;
       nf.nome,;
       nf.favorecido,;
       nf.endereco,;
       nf.bairro,;
       nf.cidade,;
       nf.uf,;
       nf.CEP,;
       "Pre-Fixado" as Tp_encargos,;
       IIF(dp.iof_fin=1," ","Nao")+" Financiado" as tp_iof,;
       dp.vlr_compra,;
       dp.vlr_doc,;
       dp.duplicata,;
       dp.dt_venc,;
       dp.tx_jurosvd,;
       dp.tx_juroscp,;
	   COUNT(1) AS QtdeTitulos;
     FROM   &ALS_COBRANCA cb, ;
     		&ALS_nota nf ,;
     		&ALS_Duplicat dp ;
     WHERE ;
		   nf.empresa = PrmEmpresa ;
       AND nf.data  = PrmData ;
	   AND nf.tp_parcela = 6 ;
	   AND nf.status <> 2 ;
       AND dp.empresa = nf.empresa ;
       AND dp.nota = nf.nota ;
       AND cb.loja =dp.empresa ;
       AND cb.banco   = dp.banco;
    GROUP BY dp.empresa,dp.nota ;
    INTO CURSOR RESUMO


    SELE RESUMO
	GO TOP
	COUNT TO LNqtdePlnilhas

	IF LNqtdePlnilhas > 0
	    GO TOP
		LNNroPlanilha = 0
		LNqtdeTitulos = 0
	    DO WHILE !EOF()
			LNNroPlanilha = LNNroPlanilha + 1
    		DO ULPlnhdeFinanciamento ;
	    		WITH resumo.empresa,;
    				 resumo.nota,;
				     LNNroPlanilha,;
				     LNqtdeTitulos
		    SELE RESUMO
		    skip
		ENDDO

		SUM vlr_compra to LNvlr_operacao
		GO TOP
		COUNT TO LNqtdePlnilhas
		GO TOP	
		DO  ULimprimir WITH "rel539"
	ELSE
		WAIT WINDOW "Nao foram encontradas Operacoes de Vendor. <ENTER>"
	ENDIF

RETURN


PROCEDURE ULimprimir
PARAMETERS LSrel
	GO TOP
	
	*----------------------------------------------------*
	*******************
	*---->   (INICIALIZACAO DO CONTROLE DE STATUS IMPRESSAO)
	*******************	
	DO RELINIC.PRG          && INICIA VAR P/ TERMOMETRO
	LFsegue = .t.
	LNregistro = RECNO()
    COUNT  TO LNimpressao
	LNimpressos = 0
	GO LNregistro
	*******************
	*---->   (COMPLETADO PREPARACAO DO CONTROLE DE STATUS IMPRESSAO)
	*******************	

	LFsegue  = .T.

	LSorienta = "WHILE  LFsegue  "

	***********
	DO UPimpressao
	LFcontinua = LFsegue

	***********
	DO RELFIM.PRG          && FIM VAR P/ TERMOMETRO
RETURN


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0P7N5M           m.empresa VALID                    º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC538,     Record Number:   19   º
*       º Variable:            m.empresa                          º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Field                              º
*       º Snippet Number:      1                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0p7n5m     &&  m.empresa VALID
#REGION 1
	IF 	m.empresa   = 0
		m.empresa   = 0
		m.nome_emp  = "TODAS"
		SHOW GET m.empresa
		SHOW GET m.nome_emp
		SELECT empresa
		RETURN .T.

	ENDIF
	SELECT empresa
	SET ORDER TO TAG empresa
	IF LASTKEY() = 15
		IF fox_alert("Confirma Saida ?")
			CLEAR GETS
			CLEAR READ
			isediting = .f.
			RETURN .T.
		ENDIF
		RETURN .F.
	ENDIF

	IF LASTKEY() = 9
	   ON KEY LABEL ESCAPE
	   DO loc_dlog WITH .F.
	   ON KEY LABEL ESCAPE DO BTN_VAL WITH 'DELETE'
	   IF LASTKEY() = 27
			SELECT empresa
			RETURN .F.
		ENDIF
	ELSE
		IF !SEEK(m.empresa)
			SELECT empresa
			RETURN .F.
		ENDIF
	ENDIF
	m.empresa   = empresa
	m.nome_emp  = empresa.nome
	SHOW GET m.empresa
	SHOW GET m.nome_emp
	SELECT empresa
RETURN .T.


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0P7N5Y           m.nome_emp WHEN                    º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC538,     Record Number:   20   º
*       º Variable:            m.nome_emp                         º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Field                              º
*       º Snippet Number:      2                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0p7n5y     &&  m.nome_emp WHEN
#REGION 1
ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
RETURN(.f.)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0P7N62           m.dt_inicio VALID                  º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC538,     Record Number:   21   º
*       º Variable:            m.dt_inicio                        º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Field                              º
*       º Snippet Number:      3                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _2lx0p7n62     &&  m.dt_inicio VALID
#REGION 1
	IF fox_alert("Confirma Impressao  ?")
		DO ULVendorRltFechamento WITH m.empresa, m.dt_inicio
		m.isediting	=	.f.
	ENDIF
	_CUROBJ = 1
RETURN .T.
