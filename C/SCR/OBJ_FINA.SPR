*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є 01/22/16            OBJ_FINA.SPR               10:10:07 є
*       є                                                         є
*       ЗДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД¶
*       є                                                         є
*       є Author's Name                                           є
*       є                                                         є
*       є Copyright (c) 2016 Company Name                         є
*       є Address                                                 є
*       є City,     Zip                                           є
*       є                                                         є
*       є Description:                                            є
*       є This program was automatically generated by GENSCRN.    є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ

PARAMETERS lncli, lnnf

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є         OBJ_FINA/MS-DOS Setup Code - SECTION 1          є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1

	*---------------------------------------------------------------*
	* OPERA ARQUIVOS :
	*			CLIENTES (LOJA/CENTRAL)
	*			DUPLICAT (LOJA/CENTRAL)
	*
	* OBJETIVO: PESQUISA DUPLICATAS DE CLIENTES
	*---------------------------------------------------------------*
	PUSH KEY CLEAR		&& desabilita teclas de atalho def. anteriormente
	ON KEY LABEL F1		DO HLP2000.SPR WITH  POPUP(),PROMPT(),PROGRAM(),;
							WONTOP(),VARREAD()
	HIDE WINDOW ALL
	******>>>> INICIO CONTROLE AMBIENTAL
	PRIVATE wl_areant, isediting, isadding,isreading,wp_record,wp_flgfecha
	PRIVATE LFjanela, wp_ref_local
	PRIVATE VLleitura, VLlerfim, VLcompara, VLchvlimi
	PRIVATE LFdup,LFcli,LFdup_alt,LFcli_alt
	PRIVATE LSdupalt_alias,LSclialt_alias
	

	*****************************************************************
	PRIVATE tp_cons, LStmp, debito,credito,ctr,vencido,ctrvcd,vencer,ctrvcr
	PRIVATE noano,ctrano,pasano,ctrpasano,dt_1a, vlr_1a,dt_ultima
	PRIVATE vlr_ultima, maiorcompra,dtmaiorcom, ctrdpatrz,atrazo
	PRIVATE maioratrz, acmatrz,medatrz,nome,cliente
	PRIVATE LNobjeto, base_cons
	******************************************************************

	ON KEY LABEL ESCAPE
	wl_areant = ALLTRIM(ALIAS()) && PERMITE RETORNAR A AREA ANTER. A CHAMADA

	LS_areant   = ALLTRIM(ALIAS()) && PERMITE RETORNAR A AREA ANTER.
	wp_flgfecha = .F. 		&& defaut nao fechamento da secao
	LFEmp 		= .F.		&& .F. =>  DEVE SER FECHADA NA SAIDA

	LSdupalt_alias = ""	 && ALIAS DE ARQ.DUPLICATA ALTERNATIVO(LOJA/CENTRAL)
	LSclialt_alias = ""  && ALIAS DE ARQ.CLIENTES ALTERNATIVO(LOJA/CENTRAL)

	LSarqclialt	=""
	LSarqdupalt =""
	******>>>> FIM CONTROLE AMBIENTAL

	******>>>> INICIO CONTROLE ARQUIVOS
	IF !USED("empresa")
		LFemp	= .T.
		IF ! NetUse("empresa")
			wp_flgfecha = .t.  && implica no fechamento da secao
		ENDIF
	ENDIF


	*--------------------------------------------------------------------*
	
	wl_arqtmp = ""
	LNtmp     = 65		&& TABELA ASCII A = 65
	IF !UPabretmp("fin")
		wp_flgfecha = .t.
	ENDIF
	IF wp_flgfecha
		SHOW WINDOW ALL
		DO ULfecha
		POP KEY 			&& reabilita teclas de atalho def. anteriormente
		RETURN
	ENDIF
	LNobjeto = 1




#REGION 0
REGIONAL m.currarea, m.talkstat, m.compstat

IF SET("TALK") = "ON"
	SET TALK OFF
	m.talkstat = "ON"
ELSE
	m.talkstat = "OFF"
ENDIF
m.compstat = SET("COMPATIBLE")
SET COMPATIBLE FOXPLUS

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є                MS-DOS Window definitions                є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

IF NOT WEXIST("obj_fina") ;
	OR UPPER(WTITLE("OBJ_FINA")) == "OBJ_FINA.PJX" ;
	OR UPPER(WTITLE("OBJ_FINA")) == "OBJ_FINA.SCX" ;
	OR UPPER(WTITLE("OBJ_FINA")) == "OBJ_FINA.MNX" ;
	OR UPPER(WTITLE("OBJ_FINA")) == "OBJ_FINA.PRG" ;
	OR UPPER(WTITLE("OBJ_FINA")) == "OBJ_FINA.FRX" ;
	OR UPPER(WTITLE("OBJ_FINA")) == "OBJ_FINA.QPR"
	DEFINE WINDOW obj_fina ;
		FROM 1, 1 ;
		TO 11,78 ;
		TITLE "[ ]" ;
		FOOTER "[OBJ_FINA]" ;
		NOFLOAT ;
		NOCLOSE ;
		NOMINIMIZE ;
		NONE ;
		COLOR SCHEME 1
ENDIF

IF NOT WEXIST("item") ;
	OR UPPER(WTITLE("ITEM")) == "ITEM.PJX" ;
	OR UPPER(WTITLE("ITEM")) == "ITEM.SCX" ;
	OR UPPER(WTITLE("ITEM")) == "ITEM.MNX" ;
	OR UPPER(WTITLE("ITEM")) == "ITEM.PRG" ;
	OR UPPER(WTITLE("ITEM")) == "ITEM.FRX" ;
	OR UPPER(WTITLE("ITEM")) == "ITEM.QPR"
	DEFINE WINDOW item ;
		FROM 12, 0 ;
		TO 25,79 ;
		TITLE " " ;
		FOOTER "ITEM" ;
		FLOAT ;
		NOCLOSE ;
		NOMINIMIZE ;
		NONE ;
		COLOR SCHEME 1
ENDIF


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є         OBJ_FINA/MS-DOS Setup Code - SECTION 2          є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1

	IF TYPE("LNnf") <> "N"
		LNnf = 0
	ENDIF
		
	IF LNnf > 0
		m.nronota = LNnf
		_CUROBJ = OBJNUM(m.nronota)
	ENDIF	

	m.base_cons = 3			&& CONSULTAR BASE CORRENTE


	DO ULOpenTabelas WITH m.base_cons



	******>>>> INICIO CONTROLE LOCAL
	IF TYPE("LNnf") <> "N"
		LNnf = 0
	ENDIF
	IF TYPE("LNcli") <> "N"
		LNcli = 0
	ENDIF
	*******************
	IF !wp_flgfecha
		KEYBOARD "ESCAPE"
	ENDIF
	********************
	isediting   = .T.
	tp_cons    = 1
	LNobjeto = 1

	m.nome       = " "
	m.debito     = 0
	m.credito    = 0
	m.ctr		 = 0	
	m.vencido    = 0
	m.ctrvcd  	 = 0	
	m.vencer     = 0
	m.ctrvcr	 = 0	
	m.noano      = 0
	m.ctrano	 = 0	
	m.pasano     = 0
	m.ctrpasano	 = 0	
	****
	m.dt_1a      = CTOD("  .  .  .")	&& DATA 1a COMPRA
	m.vlr_1a     = 0					&& VLR DA 1a COMPRA
	m.dt_ultima  = CTOD("  .  .  .")    && DATA ultima COMPRA
	m.vlr_ultima = 0					&& VLR DA ultima COMPRA
	m.maiorcompra = 0					&& VLR DA maior compra
	m.dtmaiorcom = CTOD("  .  .  .")    && DATA da maior COMPRA

	****
	m.ctrdpatrz  = 0					&& conta dup em atrazo ou pagas
	m.atrazo     = 0					&& adiant e atrazos acm
	m.maioratrz  = 0					&& maior atrazo
	m.acmatrz	  = 0					&& acm trazo p/ calc media atrz
	m.medatrz	  = 0					&& media atrazo por duplcata


	m.cliente    = LNcli

	SELE &LSarqclialt
	SET ORDER TO TAG cliente
	SEEK m.cliente
	IF FOUND()
		m.cliente = &LSarqclialt .cliente
		m.nome    = &LSarqclialt .nome
		m.credito = &LSarqclialt .credito
		SHOW GET m.nome
		SHOW GET m.cliente
		SHOW GET m.credito
	ENDIF

	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
	=INKEY(0.1)

	LFjanela = 1


	ON KEY LABEL "END"  DO ULSaiPrograma


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є              OBJ_FINA/MS-DOS Screen Layout              є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1
IF WVISIBLE("obj_fina")
	ACTIVATE WINDOW obj_fina SAME
ELSE
	ACTIVATE WINDOW obj_fina NOSHOW
ENDIF
@ 8,2 SAY "Saldo Devedor : " ;
	SIZE 1,16, 0
@ 8,32 SAY "ДД" ;
	SIZE 1,2, 0
@ 8,34 SAY "" ;
	SIZE 1,1, 0
@ 8,29 SAY "ДВД" ;
	SIZE 1,3, 0
@ 9,30 SAY "А" ;
	SIZE 1,1, 0
@ 9,34 SAY "" ;
	SIZE 1,1, 0
@ 9,31 SAY "ДДД" ;
	SIZE 1,3, 0
@ 0,0 TO 10,77 ;
	COLOR SCHEME 23
@ 10,1 TO 10,76 ;
	COLOR SCHEME 24
@ 10,77 SAY "Щ" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,77 TO 9,77 ;
	COLOR SCHEME 24
@ 0,77 SAY "ї" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 9,2 SAY "Limite Credito:" ;
	SIZE 1,15, 0
@ 1,38 SAY "Nome:" ;
	SIZE 1,5, 0
@ 1,17 SAY "C.G.C:" ;
	SIZE 1,6, 0
@ 8,35 SAY "Vencido:" ;
	SIZE 1,8, 0
@ 9,35 SAY "Vencer :" ;
	SIZE 1,8, 0
@ 8,57 SAY "Maior Atrazo:" ;
	SIZE 1,13, 0
@ 5,18 SAY "1¦ Compra:" ;
	SIZE 1,10, 0
@ 5,40 SAY "Ultima:" ;
	SIZE 1,7, 0
@ 5,59 SAY "Maior:" ;
	SIZE 1,6, 0
@ 0,75 SAY "]" ;
	SIZE 1,1, 0
@ 10,24 SAY "<PGDN>" ;
	SIZE 1,6, 0 ;
	COLOR SCHEME 24
@ 10,10 SAY "<ESC>" ;
	SIZE 1,5, 0 ;
	COLOR SCHEME 24
@ 10,17 SAY "<PGUP>" ;
	SIZE 1,6, 0 ;
	COLOR SCHEME 24
@ 9,57 SAY "Atrazo Medio:" ;
	SIZE 1,13, 0
@ 5,1 TO 5,13 ;
	COLOR SCHEME 24
@ 5,14 SAY "Щ" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,14 SAY "ї" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 2,14 TO 4,14 ;
	COLOR SCHEME 24
@ 1,1 SAY "[ Consulta ]" ;
	SIZE 1,12, 0
@ 10,3 SAY "<END>" ;
	SIZE 1,5, 0 ;
	COLOR SCHEME 24
@ 10,37 SAY "<P>->Imprime Extrato Qdo.Lista Visivel" ;
	SIZE 1,38, 0 ;
	COLOR SCHEME 24
@ 1,23 SAY "{TAB}" ;
	SIZE 1,5, 0 ;
	COLOR SCHEME 24
@ 3,17 SAY "Dupl. da NF:" ;
	SIZE 1,12, 0
@ 0,0 GET tp_cons ;
	PICTURE "@*RHN Todas;Abertas;Vencidas ;A vencer;Pagas;Perdas" ;
	SIZE 1,13,0 ;
	DEFAULT 1 ;
	WHEN _4jq0lsmkn() ;
	VALID _4jq0lsmlj()
@ 2,1 GET base_cons ;
	PICTURE "@*RVN LOJA;CENTRAL;CORRENTE" ;
	SIZE 1,12,0 ;
	DEFAULT 1 ;
	WHEN _4jq0lsmmb() ;
	VALID _4jq0lsmmz()
@ 2,17 GET m.cliente ;
	SIZE 1,20 ;
	DEFAULT 0 ;
	PICTURE "@K 99999999999999" ;
	WHEN _4jq0lsmnl() ;
	VALID _4jq0lsmog() ;
	ERROR wp_msg
@ 2,38 GET m.nome ;
	SIZE 1,36 ;
	DEFAULT " " ;
	PICTURE "@!K" ;
	WHEN _4jq0lsmp9() ;
	VALID _4jq0lsmpa()
@ 3,29 GET m.nronota ;
	SIZE 1,7 ;
	DEFAULT 0 ;
	PICTURE "@K 9999999" ;
	WHEN _4jq0lsmqi() ;
	VALID _4jq0lsmqj() ;
	ERROR wp_msg
@ 5,29 GET m.dt_1a ;
	SIZE 1,10 ;
	DEFAULT {  /  /  } ;
	WHEN .f.
@ 5,48 GET m.dt_ultima ;
	SIZE 1,10 ;
	DEFAULT {  /  /  } ;
	WHEN .f.
@ 5,66 GET m.dtmaiorcom ;
	SIZE 1,10 ;
	DEFAULT {  /  /  } ;
	WHEN .f.
@ 6,27 GET m.vlr_1a ;
	SIZE 1,12 ;
	DEFAULT " " ;
	PICTURE "@K 9,999,999.99" ;
	WHEN .f.
@ 6,46 GET m.vlr_ultima ;
	SIZE 1,12 ;
	DEFAULT " " ;
	PICTURE "@K 9,999,999.99" ;
	WHEN .f.
@ 6,64 GET m.maiorcompra ;
	SIZE 1,12 ;
	DEFAULT " " ;
	PICTURE "@K 9,999,999.99" ;
	WHEN .f.
@ 8,17 GET m.debito ;
	SIZE 1,12 ;
	DEFAULT " " ;
	PICTURE "@K 9,999,999.99" ;
	WHEN .f.
@ 8,43 GET m.vencido ;
	SIZE 1,12 ;
	DEFAULT " " ;
	PICTURE "@K 9,999,999.99" ;
	WHEN .f.
@ 8,71 GET m.maioratrz ;
	SIZE 1,5 ;
	DEFAULT " " ;
	PICTURE "@K 9,999" ;
	WHEN .f.
@ 9,17 GET m.credito ;
	SIZE 1,12 ;
	DEFAULT " " ;
	PICTURE "@K 9,999,999.99" ;
	WHEN .f.
@ 9,43 GET m.vencer ;
	SIZE 1,12 ;
	DEFAULT " " ;
	PICTURE "@K 9,999,999.99" ;
	WHEN .f.
@ 9,71 GET m.medatrz ;
	SIZE 1,5 ;
	DEFAULT " " ;
	PICTURE "@K 9,999" ;
	WHEN .f.




*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є              OBJ_FINB/MS-DOS Screen Layout              є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 2
IF WVISIBLE("item")
	ACTIVATE WINDOW item SAME
ELSE
	ACTIVATE WINDOW item NOSHOW
ENDIF
@ 1,2 GET GET_1ITEM ;
	SIZE 1,1 ;
	DEFAULT " " ;
	WHEN _4jq0lsmrw()
@ 2,2 GET ULbrowse ;
	PICTURE "@*HN ULbrowse - exibe extrato do clientes" ;
	SIZE 1,38,1 ;
	DEFAULT 1 ;
	WHEN .F. ;
	VALID _4jq0lsmrx()
@ 6,2 GET ATRZ ;
	PICTURE "@*HN ATRZ - atraso em dias" ;
	SIZE 1,23,1 ;
	DEFAULT 1 ;
	WHEN .F. ;
	VALID _4jq0lsmta()
@ 7,2 GET BrTotal ;
	PICTURE "@*HN BrTotal - Resume Totais" ;
	SIZE 1,25,1 ;
	DEFAULT 1 ;
	WHEN .F. ;
	VALID _4jq0lsmtb()
@ 12,1 GET OFFULmontarq ;
	PICTURE "@*HN OFFULmontarq - Monta arq tmp do extrato" ;
	SIZE 1,41,1 ;
	DEFAULT 1 ;
	WHEN .F. ;
	VALID _4jq0lsmur() ;
	DISABLE
@ 8,2 GET ULimpextr ;
	PICTURE "@*HN ULimpextr - Impressao do extrato" ;
	SIZE 1,34,1 ;
	DEFAULT 1 ;
	WHEN .F. ;
	VALID _4jq0lsmus()
@ 9,2 GET ULfecha ;
	PICTURE "@*HN ULfecha - " ;
	SIZE 1,12,1 ;
	DEFAULT 1 ;
	WHEN .F. ;
	VALID _4jq0lsmw8()
@ 3,2 GET ULmontarq ;
	PICTURE "@*HN ULmontarq - Monta arq tmp do extrato" ;
	SIZE 1,38,1 ;
	DEFAULT 1 ;
	WHEN .F. ;
	VALID _4jq0lsmwu()
@ 4,5 GET ULOpenTabelas ;
	PICTURE "@*HN ULOpenTabelas - Abre tab nas Conforme area de Pesquisa" ;
	SIZE 1,56,1 ;
	DEFAULT 1 ;
	WHEN .F. ;
	VALID _4jq0lsmxk()
@ 5,5 GET ULCloseTabelas ;
	PICTURE "@*HN ULCloseTabelas - Fecha tab nas Conforme area de Pesquisa" ;
	SIZE 1,58,1 ;
	DEFAULT 1 ;
	WHEN .F. ;
	VALID _4jq0lsmy8()
@ 10,2 GET ULSaiPrograma ;
	PICTURE "@*HN ULSaiPrograma" ;
	SIZE 1,15,1 ;
	DEFAULT 1 ;
	WHEN .F. ;
	VALID _4jq0lsmy9()

IF NOT WVISIBLE("item")
	ACTIVATE WINDOW item
ENDIF
IF NOT WVISIBLE("obj_fina")
	ACTIVATE WINDOW obj_fina
ENDIF


READ CYCLE ;
	ACTIVATE _4jq0lsmru() ;
	DEACTIVATE (!ISEDITING) &wp_timeout ;
	SHOW _4jq0lsmrv()

RELEASE WINDOW item
RELEASE WINDOW obj_fina

#REGION 0
IF m.talkstat = "ON"
	SET TALK ON
ENDIF
IF m.compstat = "ON"
	SET COMPATIBLE ON
ENDIF


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є              OBJ_FINA/MS-DOS Cleanup Code               є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1


RETURN

********************************************










*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4JQ0LSMKN           tp_cons WHEN                       є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         OBJ_FINA,     Record Number:   37  є
*       є Variable:            tp_cons                            є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Radio Button                       є
*       є Snippet Number:      1                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4jq0lsmkn     &&  tp_cons WHEN
#REGION 1
	HIDE WINDOW ITEM
	SHOW WINDOW OBJ_FINA TOP
	ON KEY LABEL ENTER  KEYBOARD "{RIGHTARROW}"
	ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
	ON KEY LABEL "PGDN" LFjanela = 2
	IF LFjanela = 1
		LNobjeto = _CUROBJ
	ENDIF
RETURN(isediting)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4JQ0LSMLJ           tp_cons VALID                      є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         OBJ_FINA,     Record Number:   37  є
*       є Variable:            tp_cons                            є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Radio Button                       є
*       є Snippet Number:      2                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4jq0lsmlj     &&  tp_cons VALID
#REGION 1
	ON KEY LABEL ENTER
	ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
	_curobj = _curobj +1
RETURN .T.

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4JQ0LSMMB           base_cons WHEN                     є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         OBJ_FINA,     Record Number:   38  є
*       є Variable:            base_cons                          є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Radio Button                       є
*       є Snippet Number:      3                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4jq0lsmmb     &&  base_cons WHEN
#REGION 1
	IF LFjanela = 1
		LNobjeto = _CUROBJ
	ENDIF
	HIDE WINDOW ITEM
	ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
	ON KEY LABEL "PGDN" LFjanela = 2
	ON KEY LABEL ENTER  KEYBOARD "{RIGHTARROW}"
RETURN(isediting)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4JQ0LSMMZ           base_cons VALID                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         OBJ_FINA,     Record Number:   38  є
*       є Variable:            base_cons                          є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Radio Button                       є
*       є Snippet Number:      4                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*



FUNCTION _4jq0lsmmz     &&  base_cons VALID
#REGION 1
	DO ULCloseTabelas

	DO ULOpenTabelas WITH m.base_cons
	
	ON KEY LABEL ENTER
	ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
RETURN .T.

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4JQ0LSMNL           m.cliente WHEN                     є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         OBJ_FINA,     Record Number:   39  є
*       є Variable:            m.cliente                          є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Field                              є
*       є Snippet Number:      5                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4jq0lsmnl     &&  m.cliente WHEN
#REGION 1
	IF LFjanela = 1
		LNobjeto = _CUROBJ
	ENDIF
	HIDE WINDOW ITEM
	ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
	ON KEY LABEL "PGDN" LFjanela = 2
	ON KEY LABEL ENTER
RETURN(isediting)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4JQ0LSMOG           m.cliente VALID                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         OBJ_FINA,     Record Number:   39  є
*       є Variable:            m.cliente                          є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Field                              є
*       є Snippet Number:      6                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4jq0lsmog     &&  m.cliente VALID
#REGION 1
	=UPdescanso()
	IF LASTKEY() = 27 OR LASTKEY() = 15
		RETURN(.T.)
	ENDIF

	ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
	SELECT  &LSarqclialt
	SET ORDER TO TAG cliente
	A=LASTKEY()

	IF A = 9 OR EMPTY(m.cliente)
	   ON KEY LABEL ESCAPE
	   SET ORDER TO TAG nome
	   DO loc_dlog WITH  .T.,.F.,.F.,.F.,.F.,.T.,"CLIENTES"
	   ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
	   IF LASTKEY() = 27
		   RETURN .F.
	   ENDIF
	   m.cliente = &LSarqclialt .cliente
	ENDIF

	SELE &LSarqclialt
	SET ORDER TO TAG cliente
	SEEK m.cliente
	IF !FOUND()
		m.nome    = "CLIENTE NAO CADASTRADO....."
		m.credito = 0
	ELSE
		m.cliente = &LSarqclialt .cliente
		m.nome    = &LSarqclialt .nome
		m.credito = &LSarqclialt .credito
	ENDIF
	SHOW GET m.nome
	SHOW GET m.cliente
	SHOW GET m.credito

RETURN(.T.)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4JQ0LSMP9           m.nome WHEN                        є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         OBJ_FINA,     Record Number:   40  є
*       є Variable:            m.nome                             є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Field                              є
*       є Snippet Number:      7                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4jq0lsmp9     &&  m.nome WHEN
#REGION 1
RETURN(.F.)
	


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4JQ0LSMPA           m.nome VALID                       є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         OBJ_FINA,     Record Number:   40  є
*       є Variable:            m.nome                             є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Field                              є
*       є Snippet Number:      8                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4jq0lsmpa     &&  m.nome VALID
#REGION 1
	=UPdescanso()

	IF LASTKEY() = 27 OR LASTKEY() = 15
		RETURN(.T.)
	ENDIF

	ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
	SELE &LSarqclialt
	SET ORDER TO TAG cliente
	IF LASTKEY() = 9
	   ON KEY LABEL ESCAPE
	   SET ORDER TO TAG nome
	   KEYBOARD "{CTRL-F10}"
	   DO loc_dlog WITH  .T.,.F.,.F.,.F.,.F.,.T.,"CLIENTES"
	   ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
	   IF LASTKEY() = 27
		   RETURN .F.
	   ENDIF
	   m.cliente = &LSarqclialt .cliente
	   m.nome    = &LSarqclialt .nome
	ENDIF

	SELE clientes
	IF EMPTY(ALLTRIM(m.nome))
		RETURN(.T.)
	ENDIF
	m.nome = ALLTRIM(m.nome)

	SET ORDER TO TAG nome
	SET NEAR ON
	SEEK SUBSTR(m.nome,1,45)
	SET NEAR OFF
	*******
	m.cliente = &LSarqclialt .cliente
	m.nome    = &LSarqclialt .nome
	SHOW GET m.nome
	SHOW GET m.cliente
	*********
	LFjanela = 2
	***SHOW WINDOW ITEM TOP
	SHOW GETS
RETURN(.T.)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4JQ0LSMQI           m.nronota WHEN                     є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         OBJ_FINA,     Record Number:   41  є
*       є Variable:            m.nronota                          є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Field                              є
*       є Snippet Number:      9                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4jq0lsmqi     &&  m.nronota WHEN
#REGION 1
	IF LFjanela = 1
		LNobjeto = _CUROBJ
	ENDIF
	HIDE WINDOW ITEM
	ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
	ON KEY LABEL "PGDN" LFjanela = 2
	ON KEY LABEL ENTER
RETURN(isediting)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4JQ0LSMQJ           m.nronota VALID                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         OBJ_FINA,     Record Number:   41  є
*       є Variable:            m.nronota                          є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Field                              є
*       є Snippet Number:      10                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4jq0lsmqj     &&  m.nronota VALID
#REGION 1
	=UPdescanso()
	IF LASTKEY() = 27 OR LASTKEY() = 15
		RETURN(.T.)
	ENDIF

	ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"

	DO ULbrowse with m.cliente,m.nronota, m.base_cons

RETURN(.T.)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4JQ0LSMRW           GET_1ITEM WHEN                     є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         OBJ_FINB,     Record Number:    2  є
*       є Variable:            GET_1ITEM                          є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Field                              є
*       є Snippet Number:      11                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*


FUNCTION _4jq0lsmrw     &&  GET_1ITEM WHEN
#REGION 2
RETURN(.F.)	


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4JQ0LSMRX           ULbrowse VALID                     є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         OBJ_FINB,     Record Number:    3  є
*       є Variable:            ULbrowse                           є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      12                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4jq0lsmrx     &&  ULbrowse VALID
#REGION 2
return

*---------------------------------------------------------------*

PROCEDURE  ULbrowse
PARAMETERS cliente,LNnf, PrmBaseDados




		DO ULmontarq WITH m.cliente,LNnf,PrmBaseDados


		
		DO brtotal WITH .F.
		
		ON KEY LABEL "PGDN"
		ON KEY LABEL ESCAPE
	    ON KEY LABEL P      DO ULimpextr
*		SELE &wl_arqtmp
		SELE CONSULTA

**		DUP=STR(DUPLICATA,9)  :H="DOC" :P="@R 9999999-99" :R,;


	    ON KEY LABEL  "END"   KEYBOARD "{ESCAPE}"


		BROWSE  FIELDS ;
				DUP=ALLTRIM(STR(DUPLICATA,9))+;
				    "-"+;
				    ALLTRIM(CODPARCELA)  :H="DOC" :R,;
				LOJA=SIGLA  :H="LOJA" :R,;
		        DT_EMI   	:H="Emissao" :R,;
		        DT_VENC  	:H="Venc" :R,;
		        DT_PGTO  	:H="Pgto" :R,;
				PRAZO= IIF(EMPTY(DT_PGTO),dt_venc - wp_dtsys, ;
                              dt_venc - dt_pgto) :H="Prz"	;
                              :P="9999";
                              :R,;
		        VLR_DOC		:H="VLR.DUP." :P="999,999.99"  :R,;
		        VLR_PGTO	:H="PAGO" :P="999,999.99"  :R,;
		        VLR_DB    =W_DEFPROC("DUPLICAT.SPR")+;
					CRsld_dup((EMPRESA),(DUPLICATA),;
			       		(WP_DTOPER),(dt_emi),(dt_baixa),(vlr_doc)) ;
		        		:H="VLR.DB." :P="999,999.99"  :R,;
 		        PORTADOR	:H="Bco" :R,;
 				TP_COBRANC	:H="Cob"  :R ;
				TITLE " [ HISTORICO FINANCEIRO ] ";
				COLOR SCHEME 10 ;
				  NODELETE NOAPPEND NORMAL WINDOW ITEM
	LNnf = 0
	LFjanela = 1
	SHOW WINDOW OBJ_FINA TOP
	SELE CONSULTA
	USE
	ON KEY LABEL P

    ON KEY LABEL "END"  DO ULSaiPrograma



RETURN






*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4JQ0LSMTA           ATRZ VALID                         є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         OBJ_FINB,     Record Number:    4  є
*       є Variable:            ATRZ                               є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      13                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4jq0lsmta     &&  ATRZ VALID
#REGION 2
return

*---------------------------------------------------------------*

FUNCTION ATRZ
RETURN(WP_DTOPER - DT_VENC)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4JQ0LSMTB           BrTotal VALID                      є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         OBJ_FINB,     Record Number:    5  є
*       є Variable:            BrTotal                            є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      14                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4jq0lsmtb     &&  BrTotal VALID
#REGION 2
return

*---------------------------------------------------------------*

PROCEDURE  brtotal
  PARAMETERS wl_ms
     SELE LStmp
	 SET ORDER TO TAG dt_emi
     GO TOP

     m.debito     = 0
	 m.ctr		  = 0	
     m.vencido    = 0
	 m.ctrvcd  	  = 0	
     m.vencer     = 0
	 m.ctrvcr	  = 0	
     m.dt_1a      = DT_EMI				&& DATA 1a COMPRA
	 m.vlr_1a     = 0					&& VLR DA 1a COMPRA
     m.dt_ultima  = CTOD("  .  .  .")   && DATA ultima COMPRA
	 m.vlr_ultima = 0					&& VLR DA ultima COMPRA
	 m.ctrdpatrz  = 0					&& conta dup em atrazo ou pagas
	 m.atrazo     = 0					&& adiant e atrazos acm
	 m.maioratrz  = 0					&& maior atrazo
	 m.acmatrz	  = 0					&& acm trazo p/ calc media atrz
	 m.medatrz	  = 0					&& media atrazo por duplcata
	 m.dtcompra   = DT_EMI				&& permite agrupar a compra
	 m.vlrcompra  = 0					&& valor da compra
	 m.maiorcompra = 0					
	 m.dtmaiorcom = DT_EMI
****
	*------------------------------------*
     DO WHILE !EOF()
****-------------------------------determina a maior compra
		IF EMPTY(duplicata)
			SKIP
			LOOP
		ENDIF	
		IF dt_emi = dtcompra
			m.vlrcompra = m.vlrcompra + vlr_doc
		ELSE
			IF m.vlrcompra > m.maiorcompra
			   m.maiorcompra =  m.vlrcompra
			   m.dtmaiorcom  =  m.dtcompra
			ENDIF
			m.dtcompra   = DT_EMI	
			m.vlrcompra  = 0		
			LOOP
		ENDIF
****------------------------------- fim determina a maior compra
		IF dt_emi = m.dt_1a
			m.vlr_1a = m.vlr_1a + vlr_doc
		ENDIF			
		IF EMPTY(dt_pgto)
		   IF  dt_venc < wp_dtoper
			   m.atrazo    = wp_dtoper - dt_venc
			   m.ctrdpatrz = m.ctrdpatrz + 1
		       m.acmatrz   =  m.acmatrz + m.atrazo
		   ENDIF
		   m.debito = m.debito + (vlr_doc - vlr_pgto)
		   m.ctr = m.ctr  + 1	
		   IF dt_venc < wp_dtsys
			   m.vencido= m.vencido + (vlr_doc - vlr_pgto)
			   m.ctrvcd = m.ctrvcd  + 1	
			ELSE
			   m.vencer = m.vencer  + (vlr_doc - vlr_pgto)
			   m.ctrvcr = m.ctrvcr  + 1	
			ENDIF			
		ELSE
		    m.atrazo    = dt_pgto - dt_venc
			m.ctrdpatrz = m.ctrdpatrz + 1
		    m.acmatrz   =  m.acmatrz + m.atrazo
		ENDIF
		IF m.atrazo > m.maioratrz
			m.maioratrz = m.atrazo
		ENDIF
        skip
     ENDDO

	IF m.vlrcompra > m.maiorcompra
	   m.maiorcompra =  m.vlrcompra
	   m.dtmaiorcom  =  m.dtcompra
	ENDIF

     GO BOTT


	 IF ctrdpatrz > 0
	 	m.medatrz = m.acmatrz / m.ctrdpatrz
	    IF m.medatrz < 0
		    m.medatrz = 0
		ENDIF
	 ENDIF

     m.dt_ultima  = DT_EMI  		   && DATA ultima COMPRA
	 m.vlr_ultima = 0				   && VLR DA ultima COMPRA
****
	*------------------------------------*
     DO WHILE !BOF()
		IF dt_emi = m.dt_ultima
			m.vlr_ultima = m.vlr_ultima + vlr_doc
		ENDIF			
		SKIP -1
	ENDDO
	SET ORDER TO TAG dt_emi
    GO TOP

	SHOW WINDOW OBJ_FINA TOP
	SHOW GETS

RETURN


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4JQ0LSMUR           OFFULmontarq VALID                 є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         OBJ_FINB,     Record Number:    6  є
*       є Variable:            OFFULmontarq                       є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      15                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4jq0lsmur     &&  OFFULmontarq VALID
#REGION 2
return

*---------------------------------------------------------------*


PROCEDURE OFFULmontarq		&& MONTA DADOS
PARAMETERS LNcliente, LNnota

	SELECT  &LSarqclialt
	SET ORDER TO TAG cliente
	SEEK LNcliente
	m.cliente = 0
	m.nome = " "
	m.credito = 0
	IF FOUND()
		m.cliente = &LSarqclialt .cliente
		m.nome    = &LSarqclialt .nome
		m.credito = &LSarqclialt .credito
	ENDIF
	SHOW GET m.nome
	SHOW GET m.cliente
	SHOW GET m.credito

	SELECT  &LSarqdupalt
	
	DO CASE
		CASE LNnota > 0
			SET ORDER TO TAG doc
			*------------------------------------------------------------*
			* O numero da duplicata e composto do numero da nota acrescido
			* de dois digitos para identicar a filiar e a ordem da duplicata
			* => (* 100) cria um numero imediatamento iferior a 1a duplicata
			*------------------------------------------------------------*
			LNdup	= LNnota * 100		
			SET NEAR ON
			SEEK STR(wp_empresa,3)+STR(LNdup,9)
			SET NEAR OFF
		OTHERWISE
			SET ORDER TO TAG doc_clie
			SET NEAR ON
			SEEK STR(LNcliente,14)
			SET NEAR OFF
	ENDCASE
***************
	LStmp = wp_dirtmp+"&wl_arqtmp"

	IF USED("LStmp")
	   SELE LStmp
	   USE
	ENDIF
	IF USED(wl_arqtmp)
	   SELE &wl_arqtmp
	   USE
	ENDIF

	SELE &LSarqdupalt
	IF LNnota > 0        && especificas da nota informada
		DO CASE
			CASE tp_cons = 1		&& TODAS
				COPY TO &LStmp ;
				  FOR ;
				  LNnota = INT(VAL(LEFT( STR(duplicat.duplicata,9) ,7))) ;
					WHILE LNcliente = cliente


			CASE tp_cons = 2		&& ABERTAS
				COPY TO &LStmp;
				 FOR ;
				  LNnota = INT(VAL(LEFT( STR(duplicat.duplicata,9) ,7))) ;
				          AND EMPTY(dt_pgto)  ;
									WHILE LNcliente = cliente
			CASE tp_cons = 3		&& VENCIDAS
				COPY TO &LStmp ;
				 FOR ;
				  LNnota = INT(VAL(LEFT( STR(duplicat.duplicata,9) ,7))) ;
					 AND EMPTY(dt_pgto) AND ;
						dt_venc <= wp_dtoper	WHILE LNcliente = cliente
			CASE tp_cons = 4		&& A VENCER
				COPY TO &LStmp ;
				 FOR ;
				  LNnota = INT(VAL(LEFT( STR(duplicat.duplicata,9) ,7))) ;
					 AND EMPTY(dt_pgto) AND ;
						dt_venc > wp_dtoper	WHILE LNcliente = cliente
			CASE tp_cons = 5		&& PAGAS
				COPY TO &LStmp ;
				 FOR ;
				  LNnota = INT(VAL(LEFT( STR(duplicat.duplicata,9) ,7))) ;
					AND !EMPTY(dt_pgto) ;
						WHILE LNcliente = cliente
		ENDCASE
	ELSE
		DO CASE
			CASE tp_cons = 1		&& TODAS
				COPY TO &LStmp  WHILE LNcliente = cliente
			CASE tp_cons = 2		&& ABERTAS
				COPY TO &LStmp FOR  EMPTY(dt_pgto) ;
							   WHILE LNcliente = cliente  && ABERTAS
			CASE tp_cons = 3		&& VENCIDAS
				COPY TO &LStmp FOR  EMPTY(dt_pgto) AND ;
						dt_venc <= wp_dtoper	WHILE LNcliente = cliente
			CASE tp_cons = 4		&& A VENCER
				COPY TO &LStmp FOR  EMPTY(dt_pgto) AND ;
						dt_venc > wp_dtoper	WHILE LNcliente = cliente
			CASE tp_cons = 5		&& PAGAS
				COPY TO &LStmp FOR  !EMPTY(dt_pgto) ;
						WHILE LNcliente = cliente
		ENDCASE
	ENDIF
    SELE 0

    USE &LStmp exclu ALIAS LStmp
    INDEX ON DTOS(DT_EMI)+STR(DUPLICATA,9)  TAG dt_emi ADDITIVE
	SET ORDER TO TAG dt_emi

	SELECT EMP.SIGLA,DUP.* FROM  EMPRESA EMP, LStmp DUP ;
	  WHERE EMP.EMPRESA = DUP.EMPRESA ;
	ORDER BY DT_EMI,DUPLICATA ;
    INTO CURSOR CONSULTA
	
	GO TOP
	*IF EOF()
	*	APPEND BLANK
	*ENDIF
RETURN



*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4JQ0LSMUS           ULimpextr VALID                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         OBJ_FINB,     Record Number:    7  є
*       є Variable:            ULimpextr                          є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      16                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4jq0lsmus     &&  ULimpextr VALID
#REGION 2
return

*---------------------------------------------------------------*



PROCEDURE ULimpextr
************************>
	SELE clientes
	SET ORDER TO TAG cliente
	SEEK m.cliente
**********************
*   SELE &wl_arqtmp

	SELE CONSULTA
	GO TOP
*******************
*---->   (INICIALIZACAO DO CONTROLE DE STATUS IMPRESSAO)
*******************	
	DO RELINIC.PRG          && INICIA VAR P/ TERMOMETRO
	LFsegue = .t.
	LNregistro = RECNO()
	LNimpressao = 0
    COUNT  TO LNimpressao
	LNimpressos = 0
	GO LNregistro
***************************
*	SELECT &wl_arqtmp
	SELE CONSULTA

*******************
*---->   (COMPLETADO PREPARACAO DO CONTROLE DE STATUS IMPRESSAO)
*******************	
	LF_fim  = .f.
    LSrel = "REL500"      && relatorio padrao
    LSorienta = " FOR LFsegue "
	m.titulo = "Extrato de Cliente"
	m.dt_inicio = wp_dtoper
	DO UPimpressao    && COORDENA TRABALHO DE IMPRESSAO
************
	LNpagina = _PAGENO   && DAR SEQUENCIA AO N. PAGINA
	DO RELFIM.PRG          && FIM VAR P/ TERMOMETRO
**************************>>> RESUMO POR CFO
*-----------------------------
*	SELECT &wl_arqtmp
	SELE CONSULTA
	ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"

	LFjanela = 1
	SHOW WINDOW OBJ_FINA TOP
	SHOW WINDOW ITEM TOP
	

RETURN


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4JQ0LSMW8           ULfecha VALID                      є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         OBJ_FINB,     Record Number:    8  є
*       є Variable:            ULfecha                            є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      17                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4jq0lsmw8     &&  ULfecha VALID
#REGION 2
return

*---------------------------------------------------------------*


PROCEDURE ULfecha

	DO  ULCloseTabelas

	IF LFemp		&& .t. => TERMINAL DEVE SER FECHADA NA SAIDA
		=UP_fecha("empresa")
	ENDIF




	=UP_fecha("&wl_arqtmp")
	LF_flgFINA = .F. 		&& defaut nao fechamento da secao
	IF !EMPTY(LS_areant)
		SELECT &LS_areant
	ENDIF
	ON KEY LABEL ESCAPE
	SET FORMAT TO
RETURN


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4JQ0LSMWU           ULmontarq VALID                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         OBJ_FINB,     Record Number:    9  є
*       є Variable:            ULmontarq                          є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      18                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4jq0lsmwu     &&  ULmontarq VALID
#REGION 2
return

*---------------------------------------------------------------*


PROCEDURE ULmontarq		&& MONTA DADOS
PARAMETERS LNcliente, LNnota,PrmBaseDados


	DO ULCloseTabelas

	DO ULOpenTabelas WITH PrmBaseDados



	SELECT  &LSarqclialt
	SET ORDER TO TAG cliente
	SEEK LNcliente
	m.cliente = 0
	m.nome = " "
	m.credito = 0
	IF FOUND()
		m.cliente = &LSarqclialt .cliente
		m.nome    = &LSarqclialt .nome
		m.credito = &LSarqclialt .credito
	ENDIF
	SHOW GET m.nome
	SHOW GET m.cliente
	SHOW GET m.credito

	SELECT  &LSarqdupalt
	
	DO CASE
		CASE LNnota > 0

			SET ORDER TO TAG doc
			*------------------------------------------------------------*
			* O numero da duplicata e composto do numero da nota acrescido
			* de dois digitos para identicar a filiar e a ordem da duplicata
			* => (* 100) cria um numero imediatamento iferior a 1a duplicata
			*------------------------------------------------------------*
			LNdup	= LNnota * 100		

			SET NEAR ON
			SEEK STR(wp_empresa,3)+STR(LNdup,9)
			SET NEAR OFF

		OTHERWISE

			SET ORDER TO TAG doc_clie

			SET NEAR ON
			SEEK STR(LNcliente,14)
			SET NEAR OFF
	ENDCASE
***************
	LStmp = wp_dirtmp+"&wl_arqtmp"

	IF USED("LStmp")
	   SELE LStmp
	   USE
	ENDIF
	IF USED(wl_arqtmp)
	   SELE &wl_arqtmp
	   USE
	ENDIF

	SELE &LSarqdupalt
	IF LNnota > 0        && especificas da nota informada
		DO CASE
			CASE tp_cons = 1		&& TODAS
				COPY TO &LStmp ;
				  FOR ;
				  LNnota = ;
				  INT(VAL(LEFT( STR( &LSarqdupalt .duplicata,9) ,7))) ;
					WHILE LNcliente = cliente


			CASE tp_cons = 2		&& ABERTAS
				COPY TO &LStmp;
				 FOR ;
				  LNnota = ;
				  INT(VAL(LEFT( STR( &LSarqdupalt .duplicata,9) ,7))) ;
				          AND EMPTY(dt_pgto)  ;
									WHILE LNcliente = cliente
			CASE tp_cons = 3		&& VENCIDAS
				COPY TO &LStmp ;
				 FOR ;
				  LNnota = ;
				  	INT(VAL(LEFT( STR( &LSarqdupalt .duplicata,9) ,7))) ;
					 AND EMPTY(dt_pgto) AND ;
						dt_venc <= wp_dtoper	WHILE LNcliente = cliente
			CASE tp_cons = 4		&& A VENCER
				COPY TO &LStmp ;
				 FOR ;
				  LNnota = ;
				  INT(VAL(LEFT( STR( &LSarqdupalt .duplicata,9) ,7))) ;
					 AND EMPTY(dt_pgto) AND ;
						dt_venc > wp_dtoper	WHILE LNcliente = cliente
			CASE tp_cons = 5		&& PAGAS
				COPY TO &LStmp ;
				 FOR ;
				  LNnota = ;
				  INT(VAL(LEFT( STR( &LSarqdupalt .duplicata,9) ,7))) ;
					AND !EMPTY(dt_pgto) ;
						WHILE LNcliente = cliente
			CASE tp_cons = 6		&& Perdas
				COPY TO &LStmp ;
				 FOR ;
				  LNnota = ;
				  INT(VAL(LEFT( STR( &LSarqdupalt .duplicata,9) ,7))) ;
					AND !EMPTY(dt_pgto) and VLR_PGTO = 0 ;
						WHILE LNcliente = cliente

		ENDCASE
	ELSE
		DO CASE
			CASE tp_cons = 1		&& TODAS
				COPY TO &LStmp  WHILE LNcliente = cliente
			CASE tp_cons = 2		&& ABERTAS
				COPY TO &LStmp FOR  EMPTY(dt_pgto) ;
							   WHILE LNcliente = cliente  && ABERTAS
			CASE tp_cons = 3		&& VENCIDAS
				COPY TO &LStmp FOR  EMPTY(dt_pgto) AND ;
						dt_venc <= wp_dtoper	WHILE LNcliente = cliente
			CASE tp_cons = 4		&& A VENCER
				COPY TO &LStmp FOR  EMPTY(dt_pgto) AND ;
						dt_venc > wp_dtoper	WHILE LNcliente = cliente
			CASE tp_cons = 5		&& PAGAS
				COPY TO &LStmp FOR  !EMPTY(dt_pgto) ;
						WHILE LNcliente = cliente
			CASE tp_cons = 6		&& PERDAS
				COPY TO &LStmp FOR  !EMPTY(dt_pgto) and VLR_PGTO = 0  ;
						WHILE LNcliente = cliente
		ENDCASE
	ENDIF
    SELE 0

    USE &LStmp exclu ALIAS LStmp
    INDEX ON DTOS(DT_VENC)   TAG dt_venc ADDITIVE
    INDEX ON DTOS(DT_EMI)    TAG dt_emi ADDITIVE
	SET ORDER TO TAG dt_emi


	IF wp_empresa = 16  && SPE

		SELECT EMP.SIGLA,DUP.* FROM  EMPRESA EMP, LStmp DUP ;
		  WHERE EMP.EMPRESA = DUP.EMPRESA ;
		ORDER BY DT_VENC,DUPLICATA ;
    	INTO CURSOR CONSULTA

	ELSE

		SELECT EMP.SIGLA,DUP.* FROM  EMPRESA EMP, LStmp DUP ;
		  WHERE EMP.EMPRESA = DUP.EMPRESA ;
		ORDER BY DT_EMI,DUPLICATA ;
    	INTO CURSOR CONSULTA

	ENDIF	
	GO TOP
	*IF EOF()
	*	APPEND BLANK
	*ENDIF
	

	*-------------------------------------------------*	
	
RETURN



*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4JQ0LSMXK           ULOpenTabelas VALID                є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         OBJ_FINB,     Record Number:   10  є
*       є Variable:            ULOpenTabelas                      є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      19                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4jq0lsmxk     &&  ULOpenTabelas VALID
#REGION 2
return

*---------------------------------------------------------------*


PROCEDURE ULOpenTabelas
PARAMETERS PrmBaseDados

    PRIVATE ARQ_Cliente,ALS_Cliente
    PRIVATE ARQ_Duplicat,ALS_Duplicat
	PRIVATE LSalias

	PRIVATE LSwp_dirAnterior
	

	LSwp_dirAnterior = wp_dirdat
	DO CASE
		CASE PrmBaseDados = 1   && LOJA
			wp_dirdat	= wp_dirloja
		

		CASE PrmBaseDados = 2   && CENTRAL
			wp_dirdat	= wp_dircentral
			
		OTHERWISE				&& CORRENTE
			wp_dirdat	= wp_dirdat


	ENDCASE
	

    LSAlias      = Alias()

	*--------------------------------------------------------

	DO  ULCloseTabelas

    ARQ_Clientes  = NetArqAgain("CLIENTES")
    ALS_Clientes  = ALIAS()
	LSarqclialt   = ALIAS()


    ARQ_Duplicat  = NetArqAgain("DUPLICAT")
    ALS_Duplicat  = ALIAS()
	LSarqdupalt   = ALIAS()


	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF

RETURN



*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4JQ0LSMY8           ULCloseTabelas VALID               є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         OBJ_FINB,     Record Number:   11  є
*       є Variable:            ULCloseTabelas                     є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      20                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4jq0lsmy8     &&  ULCloseTabelas VALID
#REGION 2
return

*---------------------------------------------------------------*


PROCEDURE ULCloseTabelas


	=UP_fecha(LSclialt_alias)	&& => clientes alternativo
	=UP_fecha(LSdupalt_alias)	&& => duplicat alternativo

RETURN



*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4JQ0LSMY9           ULSaiPrograma VALID                є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         OBJ_FINB,     Record Number:   12  є
*       є Variable:            ULSaiPrograma                      є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      21                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4jq0lsmy9     &&  ULSaiPrograma VALID
#REGION 2
return

*---------------------------------------------------------------*


FUNCTION ULSaiPrograma

	isediting = .f.
	CLEAR GETS
	RELEASE WINDOW ITEM
	RELEASE WINDOW OBJ_FINA
	DO ULfecha
	POP KEY 			&& reabilita teclas de atalho def. anteriormente

	LF_flgFINA = .F. 		&& defaut nao fechamento da secao
	IF !EMPTY(LS_areant)
		SELECT &LS_areant
	ENDIF
	ON KEY LABEL ESCAPE
	SET FORMAT TO
RETURN


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4JQ0LSMRU           Read Level Activate                є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         Multiple Screens                   є
*       є Called By:           READ Statement                     є
*       є Snippet Number:      22                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4jq0lsmru     && Read Level Activate
*
* Activate Code from screen: OBJ_FINA
*
#REGION 1
SHOW GET m.cliente
SHOW GET m.nome


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4JQ0LSMRV           Read Level Show                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         Multiple Screens                   є
*       є Called By:           READ Statement                     є
*       є Snippet Number:      23                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4jq0lsmrv     && Read Level Show
PRIVATE currwind
STORE WOUTPUT() TO currwind
*
* Show Code from screen: OBJ_FINA
*
#REGION 1
_CUROBJ = LNobjeto

IF NOT EMPTY(currwind)
	ACTIVATE WINDOW (currwind) SAME
ENDIF