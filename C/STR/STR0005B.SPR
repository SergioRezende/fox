*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є 12/01/2007           STR0005B.SPR              17:49:33 є
*       є                                                         є
*       ЗДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД¶
*       є                                                         є
*       є Author's Name                                           є
*       є                                                         є
*       є Copyright (c) 2007 Company Name                         є
*       є Address                                                 є
*       є City,     Zip                                           є
*       є                                                         є
*       є Description:                                            є
*       є This program was automatically generated by GENSCRN.    є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ


#REGION 0
REGIONAL m.currarea, m.talkstat, m.compstat

IF SET("TALK") = "ON"
	SET TALK OFF
	m.talkstat = "ON"
ELSE
	m.talkstat = "OFF"
ENDIF
m.compstat = SET("COMPATIBLE")
SET COMPATIBLE FOXPLUS

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є                MS-DOS Window definitions                є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

IF NOT WEXIST("_1zp127gbq")
	DEFINE WINDOW _1zp127gbq ;
		FROM INT((SROW()-25)/2),INT((SCOL()-77)/2) ;
		TO INT((SROW()-25)/2)+24,INT((SCOL()-77)/2)+76 ;
		NOFLOAT ;
		NOCLOSE ;
		SHADOW ;
		NOMINIMIZE ;
		NONE ;
		COLOR SCHEME 1
ENDIF


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є         STR0005B/MS-DOS Setup Code - SECTION 2          є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1

	LctrNivelSelecao = 1

	CODOPER = 0
	CFOP =""
	SHOWCODOPER = ""
	SHOWCFOP =""
	NEWCODOPER = 0
	Flg_Operacao = .F.
	Flg_Classificacao = .F.
	Flg_FiltroNivel = .t.
	
	isediting = .t.


		LSeguimento=1
		LObjtv_Cmrc=1
		LNtzContr=1
		LNtzFiscal =1
		LNtz_Prod =1
		LDestino =1
		Lmotivo2 = 1
		Lmotivo1 = 1
		Lntzoper = 1


	
	DIMENSION VTOper[3,2]
	VTOper(1) = space(60)

	DIMENSION VTNtz_Oper[20,2]
	VTNtz_Oper(1) = space(60)

	DIMENSION VTMotivo1[40,2]
	VTmotivo1(1) = space(60)

	DIMENSION VTMotivo2[60,2]
	VTmotivo2(1) = space(60)

	DIMENSION VTDestino[3,2]
	VTDestino(1) = space(15)


	DIMENSION VTNtz_Produt[15,2]
	VTNtz_Produt(1) = space(15)

	DIMENSION VTNtzFiscal[4,2]
	VTNtzFiscal(1) = space(15)

	DIMENSION VTNtz_Contri[4,2]
	VTNtz_Contri(1) = space(15)


	DIMENSION VTObjtv_Cmrc[4,2]
	VTObjtv_Cmrc(1) = space(15)

	DIMENSION VTSeguimento[5,2]
	VTSeguimento(1) = space(15)
	

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є              STR0005B/MS-DOS Screen Layout              є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1
IF WVISIBLE("_1zp127gbq")
	ACTIVATE WINDOW _1zp127gbq SAME
ELSE
	ACTIVATE WINDOW _1zp127gbq NOSHOW
ENDIF
@ 0,0 TO 24,76 ;
	COLOR SCHEME 23
@ 24,1 TO 24,75 ;
	COLOR SCHEME 24
@ 24,76 SAY "Щ" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 0,76 SAY "ї" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,76 TO 23,76 ;
	COLOR SCHEME 24
@ 2,4 GET Flg_FiltroNivel ;
	PICTURE "@*C Nao Aplicar Filtro em SubNivel" ;
	SIZE 1,34 ;
	DEFAULT 0 ;
	WHEN _1zp127gdr()
@ 4,5 GET Loper ;
	PICTURE "@^" ;
	FROM VToper ;
	SIZE 3,21 ;
	DEFAULT 1 ;
	WHEN _1zp127ge0() ;
	VALID _1zp127ge1() ;
	COLOR SCHEME 1, 2
@ 7,5 GET Lntzoper ;
	PICTURE "@^" ;
	FROM VTNtz_Oper ;
	SIZE 3,21 ;
	DEFAULT 1 ;
	WHEN _1zp127ge2() ;
	VALID _1zp127geg() ;
	DISABLE ;
	COLOR SCHEME 1, 2
@ 10,5 GET Lmotivo1 ;
	PICTURE "@^" ;
	FROM VTMotivo1 ;
	SIZE 3,21 ;
	DEFAULT 1 ;
	WHEN _1zp127gej() ;
	VALID _1zp127gen() ;
	DISABLE ;
	COLOR SCHEME 1, 2
@ 13,5 GET Lmotivo2 ;
	PICTURE "@^" ;
	FROM VTMotivo2 ;
	SIZE 3,21 ;
	DEFAULT 1 ;
	WHEN _1zp127geq() ;
	VALID _1zp127geu() ;
	DISABLE ;
	COLOR SCHEME 1, 2
@ 16,5 GET Flg_Operacao ;
	SIZE 1,2 ;
	DEFAULT .F. ;
	WHEN .F.
@ 16,10 GET SHOWCODOPER ;
	SIZE 1,10 ;
	DEFAULT 0 ;
	WHEN .F.
@ 16,21 GET CODOPER ;
	SIZE 1,10 ;
	DEFAULT 0 ;
	WHEN .F.
@ 4,41 GET LDestino ;
	PICTURE "@^" ;
	FROM VTDestino ;
	SIZE 3,27 ;
	DEFAULT 1 ;
	WHEN _1zp127gez() ;
	VALID _1zp127gf2() ;
	DISABLE ;
	COLOR SCHEME 1, 2
@ 7,41 GET LNtz_Prod ;
	PICTURE "@^" ;
	FROM VTNtz_Prod ;
	SIZE 3,27 ;
	DEFAULT 1 ;
	WHEN _1zp127ggp() ;
	VALID _1zp127ggs() ;
	DISABLE ;
	COLOR SCHEME 1, 2
@ 10,41 GET LNtzFiscal ;
	PICTURE "@^" ;
	FROM VTNtzFisca ;
	SIZE 3,27 ;
	DEFAULT 1 ;
	WHEN _1zp127ggw() ;
	VALID _1zp127gh0() ;
	DISABLE ;
	COLOR SCHEME 1, 2
@ 13,41 GET LNtzContr ;
	PICTURE "@^" ;
	FROM VTNtz_Cont ;
	SIZE 3,27 ;
	DEFAULT 1 ;
	WHEN _1zp127gh3() ;
	VALID _1zp127gh4() ;
	DISABLE ;
	COLOR SCHEME 1, 2
@ 16,41 GET LObjtv_Cmrc ;
	PICTURE "@^" ;
	FROM VTObjtv_Cm ;
	SIZE 3,27 ;
	DEFAULT 1 ;
	WHEN _1zp127gh5() ;
	VALID _1zp127gh6() ;
	DISABLE ;
	COLOR SCHEME 1, 2
@ 19,41 GET LSeguimento ;
	PICTURE "@^" ;
	FROM VTSeguimen ;
	SIZE 3,27 ;
	DEFAULT 1 ;
	WHEN _1zp127ghi() ;
	VALID _1zp127ghl() ;
	DISABLE ;
	COLOR SCHEME 1, 2
@ 22,41 GET Flg_Classificacao ;
	SIZE 1,2 ;
	DEFAULT .F. ;
	WHEN .F.
@ 22,44 GET SHOWCFOP ;
	SIZE 1,9 ;
	DEFAULT " " ;
	WHEN .F.
@ 22,56 GET CFOP ;
	SIZE 1,5 ;
	DEFAULT " " ;
	PICTURE "9.999" ;
	WHEN (Flg_Classificacao = .F. or Flg_FiltroNivel = .t.)
@ 22,64 GET CST ;
	SIZE 1,4 ;
	DEFAULT " " ;
	PICTURE "99" ;
	WHEN (Flg_Classificacao = .F. or Flg_FiltroNivel = .t.) OR EMPTY(CST)
@ 24,30 GET A ;
	PICTURE "@*HN Codifica operacoes" ;
	SIZE 1,20,1 ;
	DEFAULT 1 ;
	VALID _1zp127ghu()
@ 19,10 GET NEWCODOPER ;
	SIZE 1,10 ;
	DEFAULT 0 ;
	WHEN .F.

IF NOT WVISIBLE("_1zp127gbq")
	ACTIVATE WINDOW _1zp127gbq
ENDIF

READ CYCLE MODAL

RELEASE WINDOW _1zp127gbq

#REGION 0
IF m.talkstat = "ON"
	SET TALK ON
ENDIF
IF m.compstat = "ON"
	SET COMPATIBLE ON
ENDIF


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є              STR0005B/MS-DOS Cleanup Code               є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1

RETURN





*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є  STR0005B/MS-DOS Supporting Procedures and Functions    є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1
FUNCTION ULwhen
PARAMETERS PrmChamador
	PRIVATE LCODOPER

	PrmChamador= UPPER(PrmChamador)


	IF Flg_FiltroNivel = .f.  && APLICAR FILTRO
		DO CASE
			CASE  PrmChamador = "LOPER"
				=W_DEFPROC("OPERCMRC.SPR")
				=OPfl_Operacao(VToper)
				 LnivelFiltro = 0

			CASE  PrmChamador = "LNTZOPER"
				=W_DEFPROC("OPERCMRC.SPR")
				=OPfl_NtzOperacao(VTNtz_Oper,VToper(loper,1))
				 LnivelFiltro = 1

			CASE  PrmChamador = "LMOTIVO1"
				=W_DEFPROC("OPERCMRC.SPR")
				=OPfl_mtv1(VTmotivo1,VToper(loper,1),VTNtz_Oper(Lntzoper,1))
				 LnivelFiltro = 2

			CASE  PrmChamador = "LMOTIVO2"
				=W_DEFPROC("OPERCMRC.SPR")
				=OPfl_mtv2(VTmotivo2,VToper(loper,1),;
				VTNtz_Oper(lntzoper,1),VTmotivo1(lmotivo1,1))
				 LnivelFiltro = 3

			CASE  PrmChamador = "LDESTINO"
				=W_DEFPROC("CLASFISC.SPR")
				=CFfl_Destino(VTDestino,CODOPER)
				 LnivelFiltro = 4
	
			CASE  PrmChamador = "LNTZ_PROD"
				=W_DEFPROC("CLASFISC.SPR")
				=CFfl_NtzEconom(VTNtz_Prod,CODOPER,VTDestino(ldestino,1))
				 LnivelFiltro = 5

			CASE  PrmChamador = "LNTZFISCAL"
				=W_DEFPROC("CLASFISC.SPR")
				=CFfl_NtzFiscal(VTNtzFiscal,CODOPER,VTDestino(ldestino,1),;
	                  VTNtz_Prod(LNtz_Prod,1))
				 LnivelFiltro = 6

			CASE  PrmChamador = "LNTZCONTR"
				=W_DEFPROC("CLASFISC.SPR")
				=CFfl_NtzContri(VTNtz_Contri,CODOPER,VTDestino(ldestino,1),;
	        	          VTNtz_Prod(LNtz_Prod,1),VTNtzFiscal(LNtzFiscal,1))
				 LnivelFiltro = 7

			CASE  PrmChamador = "LOBJTV_CMRC"
				=W_DEFPROC("CLASFISC.SPR")
				=CFfl_ObjtvComercial(VTObjtv_Cmrc,CODOPER,;
						VTDestino(ldestino,1),;
	                  VTNtz_Prod(LNtz_Prod,1),VTNtzFiscal(LNtzFiscal,1),;
	                  VTNtz_Contri(LNtzContr,1))
				 LnivelFiltro = 8

			CASE  PrmChamador = "LSEGUIMENTO"
				=W_DEFPROC("CLASFISC.SPR")
				=CFfl_Seguimento(VTSeguimento,CODOPER,;
				VTDestino(ldestino,1),;
                  VTNtz_Prod(LNtz_Prod,1),VTNtzFiscal(LNtzFiscal,1),;
                  VTNtz_Contri(LNtzContr,1),VTObjtv_Cmrc(LObjtv_Cmrc,1))
				 LnivelFiltro = 9
			OTHERWISE
				 LnivelFiltro = 9
		ENDCASE

	ELSE

		DO CASE
			CASE  PrmChamador = "LOPER"
				=W_DEFPROC("OPERCMRC.SPR")
				=OPTb_Operacao(VToper)
				 LnivelFiltro = 0

			CASE  PrmChamador = "LNTZOPER"
				=W_DEFPROC("OPERCMRC.SPR")
				=OPTb_NtzOperacao(VTNtz_Oper)
				 LnivelFiltro = 1

			CASE  PrmChamador = "LMOTIVO1"
				=W_DEFPROC("OPERCMRC.SPR")
				=OPTb_mtv1(VTmotivo1)
				 LnivelFiltro = 2

			CASE  PrmChamador = "LMOTIVO2"
				=W_DEFPROC("OPERCMRC.SPR")
				=OPTb_mtv2(VTmotivo2)
				 LnivelFiltro = 3

			CASE  PrmChamador = "LDESTINO"
				=W_DEFPROC("CLASFISC.SPR")
				=CFtb_Destino(VTDestino)
				 LnivelFiltro = 4
	
			CASE  PrmChamador = "LNTZ_PROD"
				=W_DEFPROC("CLASFISC.SPR")
				=CFtb_NtzEconom(VTNtz_Prod)
				 LnivelFiltro = 5

			CASE  PrmChamador = "LNTZFISCAL"
				=W_DEFPROC("CLASFISC.SPR")
				=CFtb_NtzFiscal(VTNtzFiscal)
				 LnivelFiltro = 6

			CASE  PrmChamador = "LNTZCONTR"
				=W_DEFPROC("CLASFISC.SPR")
				=CFtb_NtzContri(VTNtz_Contri)
				 LnivelFiltro = 7

			CASE  PrmChamador = "LOBJTV_CMRC"
				=W_DEFPROC("CLASFISC.SPR")
				=CFtb_ObjtvComercial(VTObjtv_Cmrc)
				 LnivelFiltro = 8

			CASE  PrmChamador = "LSEGUIMENTO"
				=W_DEFPROC("CLASFISC.SPR")
				=CFtb_Seguimento(VTSeguimento)
				 LnivelFiltro = 9
			OTHERWISE
				 LnivelFiltro = 9
		ENDCASE

	
	ENDIF



	IF LnivelFiltro <= 3
		CODOPER = 0
		SHOWCODOPER = ""
		Flg_Operacao = .F.
	ENDIF

	CFOP =""
	SHOWCFOP =""
	Flg_Classificacao = .F.

	*------------------------------------------------------*
	* CONTROLE DAS OPCOES RELACIONADAS A CLASSIFICACAO FISCAL
	*------------------------------------------------------*

	IF LnivelFiltro < 10
		SHOW GET LSeguimento ENABLE
	ENDIF

	IF LnivelFiltro < 9
		SHOW GET LSeguimento DISABLE
		SHOW GET LObjtv_Cmrc ENABLE
		DIMENSION VTSeguimento[5,2]
		VTSeguimento(1) = space(15)
		LSeguimento=1
	ENDIF

	IF LnivelFiltro < 8
		SHOW GET LObjtv_Cmrc DISABLE
		SHOW GET LNtzContr ENABLE
		DIMENSION VTObjtv_Cmrc[4,2]
		VTObjtv_Cmrc(1) = space(15)
		LObjtv_Cmrc=1
	ENDIF

	IF LnivelFiltro < 7
		SHOW GET LNtzContr DISABLE
		SHOW GET LNtzFiscal ENABLE
		DIMENSION VTNtz_Contri[4,2]
		VTNtz_Contri(1) = space(15)
		LNtzContr=1
	ENDIF

	IF LnivelFiltro < 6
		SHOW GET LNtzFiscal DISABLE
		SHOW GET LNtz_Prod ENABLE
		DIMENSION VTNtzFiscal[4,2]
		VTNtzFiscal(1) = space(15)
		LNtzFiscal =1
	ENDIF

	IF LnivelFiltro < 5
		SHOW GET LNtz_Prod DISABLE
		SHOW GET LDestino ENABLE
		DIMENSION VTNtz_Produt[15,2]
		VTNtz_Produt(1) = space(15)
		LNtz_Prod =1
	ENDIF
	IF LnivelFiltro < 4
		SHOW GET LDestino DISABLE
		DIMENSION VTDestino[3,2]
		VTDestino(1) = space(15)
		LDestino =1
		SHOW GET Lmotivo2 ENABLE
	ENDIF

	*------------------------------------------------------*
	* CONTROLE DAS OPCOES RELACIONADAS A OPERACAO COMERCIAL
	*------------------------------------------------------*


	IF LnivelFiltro < 3
		SHOW GET Lmotivo2 DISABLE
		DIMENSION VTMotivo2[60,2]
		VTmotivo2(1) = space(60)
		Lmotivo2 = 1
		SHOW GET Lmotivo1 ENABLE
	ENDIF

	IF LnivelFiltro < 2
		SHOW GET Lmotivo1 DISABLE
		DIMENSION VTMotivo1[40,2]
		VTmotivo1(1) = space(60)
		Lmotivo1 = 1
		SHOW GET Lntzoper ENABLE
	ENDIF

	IF LnivelFiltro < 1
		SHOW GET Lntzoper DISABLE
		DIMENSION VTNtz_Oper[20,2]
		VTNtz_Oper(1) = space(60)
		Lntzoper = 1
	ENDIF


RETURN(.T.)




FUNCTION ULVldOperacao
PARAMETERS PrmChamador
	PRIVATE LCODOPER
	PRIVATE LnivelFiltro


	PrmChamador = UPPER(PrmChamador)
	DO CASE
		CASE  PrmChamador = "LOPER"
			 LnivelFiltro = 0
		CASE  PrmChamador = "LNTZOPER"
			 LnivelFiltro = 1
		CASE  PrmChamador = "LMOTIVO1"
			 LnivelFiltro = 2
		OTHERWISE
			 LnivelFiltro = 3
	ENDCASE


	=W_DEFPROC("OPERCMRC.SPR")
	LCODOPER=OPGetCODOPER(LnivelFiltro,;
				VToper(loper,1),VTNtz_Oper(lntzoper,1),;
                  VTmotivo1(lmotivo1,1),VTmotivo2(lmotivo2,1))


	*------------------------------------------------------*
	* CONTROLE DAS OPCOES RELACIONADAS A OPERACAO COMERCIAL
	*------------------------------------------------------*

	SHOWCODOPER = LCODOPER
	SHOW GET SHOWCODOPER
	IF !(LCODOPER $ "VARIOS/NENHUM")
		Flg_Operacao = .T.
		SHOW GET Flg_Operacao

	    CODOPER = INT(VAL(LCODOPER))
		SHOW GET CODOPER

	ENDIF



	DO CASE
		CASE  PrmChamador = "LOPER"
			=ULwhen("Lntzoper")
		CASE  PrmChamador = "LNTZOPER"
			=ULwhen("Lmotivo1")
		CASE  PrmChamador = "LMOTIVO1"
			=ULwhen("Lmotivo2")
		
	ENDCASE

	
	*------------------------------------------------------*
	* CONTROLE DAS OPCOES RELACIONADAS A CLASSIFICACAO FISCAL
	*------------------------------------------------------*
	
	SHOW GET Ldestino DISABLE
	SHOW GET LNtz_Prod DISABLE
	SHOW GET LNtzFiscal DISABLE
	SHOW GET LNtzContr DISABLE
	SHOW GET LObjtv_Cmrc DISABLE
	SHOW GET LSeguimento DISABLE


	IF PrmChamador = "LMOTIVO2" ;
      IF Flg_FiltroNivel = .T
         IF SHOWCODOPER $ "NENHUM"
	  	    NEWCODOPER = OPDefCODOPER(;
	   			  VToper(loper,2),;
	   			  VTNtz_Oper(lntzoper,2),;
                  VTmotivo1(lmotivo1,2),;
                  VTmotivo2(lmotivo2,2))
    	  ELSE
	    	NEWCODOPER = 0
	  	 ENDIF
	  ENDIF
	ENDIF	

    SHOW GET NEWCODOPER
	IF Flg_FiltroNivel = .T.  && NAO APLICAR FILTRO
		SHOW GET Ldestino ENABLE
	ELSE
		IF SHOWCODOPER $ "VARIOS/NENHUM"
		    CODOPER = 0
		ELSE
			SHOW GET Ldestino ENABLE
		ENDIF
	ENDIF

RETURN(LCODOPER)








FUNCTION ULVldclassificacao
PARAMETERS PrmChamador
	PRIVATE LCFOP
	PRIVATE LnivelFiltro

	PrmChamador = UPPER(PrmChamador)

	DO CASE
		CASE  PrmChamador = "LDESTINO"
			 LnivelFiltro = 0
		CASE  PrmChamador = "LNTZ_PROD"
			 LnivelFiltro = 1
		CASE  PrmChamador = "LNTZFISCAL"
			 LnivelFiltro = 2
		CASE  PrmChamador = "LNTZCONTR"
			 LnivelFiltro = 3
		CASE  PrmChamador = "LOBJTV_CMRC"
			 LnivelFiltro = 4
		CASE  PrmChamador = "LSEGUIMENTO"
			 LnivelFiltro = 5
		OTHERWISE
			 LnivelFiltro = 5
	ENDCASE


	=W_DEFPROC("OPERCMRC.SPR")


	=W_DEFPROC("CLASFISC.SPR")
	LCFOP= CFGetCFOP(LnivelFiltro,;
			CODOPER,VTDestino(ldestino,1),;
            VTNtz_Prod(LNtz_Prod,1),VTNtzFiscal(LNtzFiscal,1),;
            VTNtz_Contri(LNtzContr,1),VTObjtv_Cmrc(LObjtv_Cmrc,1),;
            VTSeguimento(LSeguimento,1))

	*------------------------------------------------------*
	* CONTROLE DAS OPCOES RELACIONADAS A OPERACAO COMERCIAL
	*------------------------------------------------------*
	SHOWCFOP = LCFOP
	SHOW GET SHOWCFOP
	IF !(LCFOP $ "VARIOS/NENHUM")
		Flg_Classificacao = .T.
		SHOW GET Flg_classificacao

	    CFOP = LCFOP
		SHOW GET CFOP

	ENDIF

	DO CASE
		CASE  PrmChamador = "LDESTINO"
			=ULwhen("LNTZ_PROD")
		CASE  PrmChamador = "LNTZ_PROD"
			=ULwhen("LNTZFISCAL")
		CASE  PrmChamador = "LNTZFISCAL"
			=ULwhen("LNTZCONTR")
		CASE  PrmChamador = "LNTZCONTR"
			=ULwhen("LOBJTV_CMRC")
		CASE  PrmChamador = "LOBJTV_CMRC"
			=ULwhen("LSEGUIMENTO")
		CASE  PrmChamador = "LSEGUIMENTO"
			=ULwhen("LSEGUIMENTO")
			
	ENDCASE





RETURN(LCFOP)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _1ZP127GDR           Flg_FiltroNivel WHEN               є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         STR0005B,     Record Number:    7  є
*       є Variable:            Flg_FiltroNivel                    є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Check Box                          є
*       є Snippet Number:      1                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _1zp127gdr     &&  Flg_FiltroNivel WHEN
#REGION 1
	ON KEY LABEL ESCAPE


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _1ZP127GE0           Loper WHEN                         є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         STR0005B,     Record Number:    8  є
*       є Variable:            Loper                              є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Popup                              є
*       є Snippet Number:      2                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _1zp127ge0     &&  Loper WHEN
#REGION 1
	=ULwhen("Loper")
	ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"

RETURN(isediting)



*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _1ZP127GE1           Loper VALID                        є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         STR0005B,     Record Number:    8  є
*       є Variable:            Loper                              є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Popup                              є
*       є Snippet Number:      3                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _1zp127ge1     &&  Loper VALID
#REGION 1
	IF LASTKEY() = 27
		=ULwhen("Loper")
		isediting = .f.
		CLEAR GETS
		RETURN(.T.)
	ENDIF
	=ULVldoperacao("Loper")
RETURN(.T.)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _1ZP127GE2           Lntzoper WHEN                      є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         STR0005B,     Record Number:    9  є
*       є Variable:            Lntzoper                           є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Popup                              є
*       є Snippet Number:      4                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _1zp127ge2     &&  Lntzoper WHEN
#REGION 1
	=ULwhen("Lntzoper")
RETURN(Flg_Operacao = .F.)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _1ZP127GEG           Lntzoper VALID                     є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         STR0005B,     Record Number:    9  є
*       є Variable:            Lntzoper                           є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Popup                              є
*       є Snippet Number:      5                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _1zp127geg     &&  Lntzoper VALID
#REGION 1
	=ULVldoperacao("Lntzoper")
RETURN(.T.)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _1ZP127GEJ           Lmotivo1 WHEN                      є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         STR0005B,     Record Number:   10  є
*       є Variable:            Lmotivo1                           є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Popup                              є
*       є Snippet Number:      6                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _1zp127gej     &&  Lmotivo1 WHEN
#REGION 1
	=ULWhen("Lmotivo1")
RETURN(Flg_Operacao = .F.)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _1ZP127GEN           Lmotivo1 VALID                     є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         STR0005B,     Record Number:   10  є
*       є Variable:            Lmotivo1                           є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Popup                              є
*       є Snippet Number:      7                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _1zp127gen     &&  Lmotivo1 VALID
#REGION 1
	=ULVldoperacao("Lmotivo1")

RETURN(.T.)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _1ZP127GEQ           Lmotivo2 WHEN                      є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         STR0005B,     Record Number:   11  є
*       є Variable:            Lmotivo2                           є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Popup                              є
*       є Snippet Number:      8                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _1zp127geq     &&  Lmotivo2 WHEN
#REGION 1
	=ULWhen("Lmotivo2")
RETURN(Flg_Operacao = .F.)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _1ZP127GEU           Lmotivo2 VALID                     є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         STR0005B,     Record Number:   11  є
*       є Variable:            Lmotivo2                           є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Popup                              є
*       є Snippet Number:      9                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _1zp127geu     &&  Lmotivo2 VALID
#REGION 1
	=ULVldOperacao("Lmotivo2")


RETURN




*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _1ZP127GEZ           LDestino WHEN                      є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         STR0005B,     Record Number:   15  є
*       є Variable:            LDestino                           є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Popup                              є
*       є Snippet Number:      10                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _1zp127gez     &&  LDestino WHEN
#REGION 1
	=ULwhen("LDestino")
RETURN(Flg_Operacao = .T. or Flg_FiltroNivel = .t.)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _1ZP127GF2           LDestino VALID                     є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         STR0005B,     Record Number:   15  є
*       є Variable:            LDestino                           є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Popup                              є
*       є Snippet Number:      11                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _1zp127gf2     &&  LDestino VALID
#REGION 1
	=ULVldClassificacao("LDestino")
	
RETURN(.T.)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _1ZP127GGP           LNtz_Prod WHEN                     є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         STR0005B,     Record Number:   16  є
*       є Variable:            LNtz_Prod                          є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Popup                              є
*       є Snippet Number:      12                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _1zp127ggp     &&  LNtz_Prod WHEN
#REGION 1
	=ULwhen("LNtz_Prod")
RETURN(Flg_Classificacao = .F. or Flg_FiltroNivel = .t.)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _1ZP127GGS           LNtz_Prod VALID                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         STR0005B,     Record Number:   16  є
*       є Variable:            LNtz_Prod                          є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Popup                              є
*       є Snippet Number:      13                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _1zp127ggs     &&  LNtz_Prod VALID
#REGION 1
	=ULVldClassificacao("LNTZ_PROD")
RETURN(.T.)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _1ZP127GGW           LNtzFiscal WHEN                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         STR0005B,     Record Number:   17  є
*       є Variable:            LNtzFiscal                         є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Popup                              є
*       є Snippet Number:      14                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _1zp127ggw     &&  LNtzFiscal WHEN
#REGION 1
	=ULwhen("LNtzfISCAL")
RETURN(Flg_Classificacao = .F. or Flg_FiltroNivel = .t.)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _1ZP127GH0           LNtzFiscal VALID                   є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         STR0005B,     Record Number:   17  є
*       є Variable:            LNtzFiscal                         є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Popup                              є
*       є Snippet Number:      15                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _1zp127gh0     &&  LNtzFiscal VALID
#REGION 1
	=ULVldClassificacao("LNTZFISCAL")

RETURN(.T.)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _1ZP127GH3           LNtzContr WHEN                     є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         STR0005B,     Record Number:   18  є
*       є Variable:            LNtzContr                          є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Popup                              є
*       є Snippet Number:      16                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _1zp127gh3     &&  LNtzContr WHEN
#REGION 1
	=ULwhen("LNtzContr")
RETURN(Flg_Classificacao = .F. or Flg_FiltroNivel = .t.)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _1ZP127GH4           LNtzContr VALID                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         STR0005B,     Record Number:   18  є
*       є Variable:            LNtzContr                          є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Popup                              є
*       є Snippet Number:      17                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _1zp127gh4     &&  LNtzContr VALID
#REGION 1
	=ULVldClassificacao("LNTZCONTR")

RETURN(.T.)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _1ZP127GH5           LObjtv_Cmrc WHEN                   є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         STR0005B,     Record Number:   19  є
*       є Variable:            LObjtv_Cmrc                        є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Popup                              є
*       є Snippet Number:      18                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _1zp127gh5     &&  LObjtv_Cmrc WHEN
#REGION 1
	=ULwhen("LObjtv_Cmrc")
RETURN(Flg_Classificacao = .F. or Flg_FiltroNivel = .t.)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _1ZP127GH6           LObjtv_Cmrc VALID                  є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         STR0005B,     Record Number:   19  є
*       є Variable:            LObjtv_Cmrc                        є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Popup                              є
*       є Snippet Number:      19                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _1zp127gh6     &&  LObjtv_Cmrc VALID
#REGION 1
	=ULVldClassificacao("LOBJTV_CMRC")

RETURN(.T.)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _1ZP127GHI           LSeguimento WHEN                   є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         STR0005B,     Record Number:   20  є
*       є Variable:            LSeguimento                        є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Popup                              є
*       є Snippet Number:      20                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _1zp127ghi     &&  LSeguimento WHEN
#REGION 1
	=ULwhen("LSeguimento")
RETURN(Flg_Classificacao = .F. or Flg_FiltroNivel = .t.)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _1ZP127GHL           LSeguimento VALID                  є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         STR0005B,     Record Number:   20  є
*       є Variable:            LSeguimento                        є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Popup                              є
*       є Snippet Number:      21                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _1zp127ghl     &&  LSeguimento VALID
#REGION 1
	=ULvldClassificacao("LSeguimento")
RETURN







FUNCTION ULVldclassificacao
PARAMETERS PrmChamador
	PRIVATE LCFOP
	PRIVATE LnivelFiltro

	PrmChamador = UPPER(PrmChamador)

	DO CASE
		CASE  PrmChamador = "LDESTINO"
			 LnivelFiltro = 0
		CASE  PrmChamador = "LNTZ_PROD"
			 LnivelFiltro = 1
		CASE  PrmChamador = "LNTZFISCAL"
			 LnivelFiltro = 2
		CASE  PrmChamador = "LNTZCONTR"
			 LnivelFiltro = 3
		CASE  PrmChamador = "LOBJTV_CMRC"
			 LnivelFiltro = 4
		CASE  PrmChamador = "LSEGUIMENTO"
			 LnivelFiltro = 5
		OTHERWISE
			 LnivelFiltro = 5
	ENDCASE


	=W_DEFPROC("OPERCMRC.SPR")


	=W_DEFPROC("CLASFISC.SPR")
	LCFOP= CFGetCFOP(LnivelFiltro,;
			CODOPER,VTDestino(ldestino,1),;
            VTNtz_Prod(LNtz_Prod,1),VTNtzFiscal(LNtzFiscal,1),;
            VTNtz_Contri(LNtzContr,1),VTObjtv_Cmrc(LObjtv_Cmrc,1),;
            VTSeguimento(LSeguimento,1))

	*------------------------------------------------------*
	* CONTROLE DAS OPCOES RELACIONADAS A OPERACAO COMERCIAL
	*------------------------------------------------------*
	SHOWCFOP = LCFOP
	SHOW GET SHOWCFOP
	IF !(LCFOP $ "VARIOS/NENHUM")
		Flg_Classificacao = .T.
		SHOW GET Flg_classificacao

	    CFOP = LCFOP
		SHOW GET CFOP

	ENDIF

	DO CASE
		CASE  PrmChamador = "LDESTINO"
			=ULwhen("LNTZ_PROD")
		CASE  PrmChamador = "LNTZ_PROD"
			=ULwhen("LNTZFISCAL")
		CASE  PrmChamador = "LNTZFISCAL"
			=ULwhen("LNTZCONTR")
		CASE  PrmChamador = "LNTZCONTR"
			=ULwhen("LOBJTV_CMRC")
		CASE  PrmChamador = "LOBJTV_CMRC"
			=ULwhen("LSEGUIMENTO")
		CASE  PrmChamador = "LSEGUIMENTO"
			=ULwhen("LSEGUIMENTO")
			
	ENDCASE





RETURN(LCFOP)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _1ZP127GHU           A VALID                            є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         STR0005B,     Record Number:   25  є
*       є Variable:            A                                  є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      22                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _1zp127ghu     &&  A VALID
#REGION 1
	=W_DEFPROC("CLASFISC.SPR")
	=CFVincTipo()
RETURN
