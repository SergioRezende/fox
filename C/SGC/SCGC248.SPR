*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º 03/19/09             SCGC248.SPR               14:50:31 º
*       º                                                         º
*       ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
*       º                                                         º
*       º Author's Name                                           º
*       º                                                         º
*       º Copyright (c) 2009 Company Name                         º
*       º Address                                                 º
*       º City,     Zip                                           º
*       º                                                         º
*       º Description:                                            º
*       º This program was automatically generated by GENSCRN.    º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º          SCGC248/MS-DOS Setup Code - SECTION 1          º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 1
*~ WIZARDSCREEN
*---------------------------------------------------------------------*
* ARQUIVOS UTILIZADOS :                                               *
*              - EMPRESA
*              - USUARIO
*              - GRUPO
*			   - NOTA
*			   - ORCAMENT
*			   - ORCATMP
* OBJETIVOS : DEMONSTRATIVO MOVIMENTO DE PATIO
*---------------------------------------------------------------------*
******>>>> INICIO CONTROLE AMBIENTAL

CLEAR TYPEAHEAD
PUSH KEY CLEAR		&& desabilita teclas de atalho def. anteriormente
ON KEY LABEL F1		DO HLP2000.SPR WITH  POPUP(),PROMPT(),PROGRAM(),;
							WONTOP(),VARREAD()

******************************************************************
*		VARIAVEIS - PADRAO
******************************************************************
PRIVATE wl_areant, isediting,isadding,isreading,wp_record,wp_flgfecha
PRIVATE LFjanela, wp_ref_local
PRIVATE VLleitura, VLlerfim, VLcompara, VLchvlimi
PRIVATE LFemp, LFusr, LFgrp, LFnfs,LForc,LFtmp
PRIVATE RLresumo,RLosi,m.dias_trab
******************************************************************
*		VARIAVEIS - ESPECIFICAS
******************************************************************


******************************************************************
ON KEY LABEL ESCAPE
wl_areant 	= 	ALLTRIM(ALIAS()) && PERMITE RETORNAR A AREA ANTER. A CHAMADA
m.isediting	=	.F.
m.isadding	=	.F.
m.isreading =   .F.
wp_flgfecha = 	.F. 		&& defaut nao fechamento da secao
WP_RECORD 	= 	0

LFemp		=	.F.
LFusr		=	.F.
LFgrp		=	.F.
LFnfs		=	.F.
LForc		=	.F.
LFtmp		=	.F.


wp_ref_local=  .f.     		&& NAO POSSUI CONTROLE DE REFRESH LOCAL


STORE .F. TO  RLresumo,RLosi

m.dias_trab= 0

*****************>>>> INICIO CONTROLE ARQUIVOS<<<<<<<<
**************>> parametros repassados a btn_val <<

VLleitura = ""   && repassa chave de leitura p/ btn_val
VLlerfim  = ""   && p/ leitura do ultimo reg + 1
VLcompara = ""   && repassa chave de comparacao p/ btn_val
VLchvlimi = ""   && otimiza browse
**************************************************************

IF !USED("empresa")
	LFemp	= .T.
	IF ! NetUse("empresa")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("usuario")
	LFusr	= .T.
	IF ! NetUse("usuario")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF

IF !USED("grupo")
	LFgrp	= .T.
	IF ! NetUse("grupo")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF

IF !USED("nota")
	LFnfs	= .T.
	IF ! NetUse("nota")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF

IF !USED("orcament")
	LForc	= .T.
	IF ! NetUse("orcament")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF

IF !USED("TIPOOPER")
	LFtmp	= .T.
	IF ! NetUse("tipooper")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF

IF !USED("orcatmp")
	LFtmp	= .T.
	IF ! NetUse("orcatmp")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF

IF wp_flgfecha
	do ULfecha
	RETURN
ENDIF

#REGION 0
REGIONAL m.currarea, m.talkstat, m.compstat

IF SET("TALK") = "ON"
	SET TALK OFF
	m.talkstat = "ON"
ELSE
	m.talkstat = "OFF"
ENDIF
m.compstat = SET("COMPATIBLE")
SET COMPATIBLE FOXPLUS

*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º                MS-DOS Window definitions                º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

IF NOT WEXIST("scgc248") ;
	OR UPPER(WTITLE("SCGC248")) == "SCGC248.PJX" ;
	OR UPPER(WTITLE("SCGC248")) == "SCGC248.SCX" ;
	OR UPPER(WTITLE("SCGC248")) == "SCGC248.MNX" ;
	OR UPPER(WTITLE("SCGC248")) == "SCGC248.PRG" ;
	OR UPPER(WTITLE("SCGC248")) == "SCGC248.FRX" ;
	OR UPPER(WTITLE("SCGC248")) == "SCGC248.QPR"
	DEFINE WINDOW scgc248 ;
		FROM INT((SROW()-11)/2),INT((SCOL()-72)/2) ;
		TO INT((SROW()-11)/2)+10,INT((SCOL()-72)/2)+71 ;
		TITLE "[ Demonstrativo Movimento de Patio ]" ;
		FOOTER "[ 248 ]" ;
		FLOAT ;
		NOCLOSE ;
		SHADOW ;
		NOMINIMIZE ;
		NONE ;
		COLOR SCHEME 1
ENDIF


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º          SCGC248/MS-DOS Setup Code - SECTION 2          º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 1


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º              SCGC248/MS-DOS Screen Layout               º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 1
IF WVISIBLE("scgc248")
	ACTIVATE WINDOW scgc248 SAME
ELSE
	ACTIVATE WINDOW scgc248 NOSHOW
ENDIF
@ 3,50 SAY "a" ;
	SIZE 1,1, 0
@ 7,1 TO 9,17 ;
	COLOR SCHEME 24
@ 9,2 TO 9,16 ;
	COLOR SCHEME 23
@ 8,17 SAY "³" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 9,17 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 7,17 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 7,52 TO 9,68 ;
	COLOR SCHEME 24
@ 9,53 TO 9,67 ;
	COLOR SCHEME 23
@ 8,68 SAY "³" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 9,68 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 7,68 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 0,0 TO 10,70 ;
	COLOR SCHEME 23
@ 10,1 TO 10,69 ;
	COLOR SCHEME 24
@ 10,70 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,70 TO 9,70 ;
	COLOR SCHEME 24
@ 0,70 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 3,9 SAY "-" ;
	SIZE 1,1, 0
@ 2,3 TO 4,31 ;
	COLOR SCHEME 23
@ 4,4 TO 4,30 ;
	COLOR SCHEME 24
@ 4,31 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 3,31 SAY "³" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 2,31 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 2,4 SAY "[Filial]" ;
	SIZE 1,8, 0
@ 2,37 TO 4,65 ;
	COLOR SCHEME 23
@ 4,38 TO 4,64 ;
	COLOR SCHEME 24
@ 4,65 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 3,65 SAY "³" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 2,65 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 2,38 SAY "[ Periodo ]" ;
	SIZE 1,11, 0
@ 0,64 SAY "[248]" ;
	SIZE 1,5, 0
@ 0,14 SAY "[ Demonstrativo Movimento de Patio ]" ;
	SIZE 1,36, 0
@ 6,40 SAY "Dias Trabalhados" ;
	SIZE 1,16, 0
@ 3,6 GET m.empresa ;
	SIZE 1,3 ;
	DEFAULT " " ;
	PICTURE "999" ;
	WHEN _2lx0vt7rq() ;
	VALID _2lx0vt7rr()
@ 3,10 GET m.nome_emp ;
	SIZE 1,20 ;
	DEFAULT " " ;
	PICTURE "@!K" ;
	WHEN _2lx0vt7rs()
@ 3,41 GET m.dt_inicio ;
	SIZE 1,8 ;
	DEFAULT {  /  /  } ;
	WHEN isediting ;
	VALID _2lx0vt7rt()
@ 3,53 GET m.dt_fim ;
	SIZE 1,8 ;
	DEFAULT {  /  /  } ;
	WHEN _2lx0vt7ru() ;
	VALID dt_inicio <= dt_fim ;
	ERROR "Data final deve ser MAIOR ou IGUAL a data inicial."
@ 5,4 GET m.rlOSI ;
	PICTURE "@*C Relacao de OSIs Faturadas no Periodo Detalhando Grupos" ;
	SIZE 1,58 ;
	DEFAULT 0 ;
	WHEN _2lx0vt7rv()
@ 6,4 GET m.rlresumo ;
	PICTURE "@*C Resumo do Periodo Mov. Patio" ;
	SIZE 1,32 ;
	DEFAULT 0 ;
	WHEN _2lx0vt7rw()
@ 6,57 GET m.dias_trab ;
	SIZE 1,2 ;
	DEFAULT 0 ;
	PICTURE "99" ;
	WHEN _2lx0vt7rx()
@ 8,5 GET m.edit_btn ;
	PICTURE "@*HN \<Edita" ;
	SIZE 1,9,1 ;
	DEFAULT 1 ;
	WHEN _2lx0vt7ry() ;
	VALID btn_val1('EDIT') ;
	MESSAGE 'Permite a alteracao de dados do registro corrente'
@ 10,59 GET m.AAimp_btn ;
	PICTURE "@*HN \<Imprime" ;
	SIZE 1,9,1 ;
	DEFAULT 1 ;
	VALID _2lx0vt7rz() ;
	DISABLE
@ 8,57 GET m.canc_btn ;
	PICTURE "@*HT \<Saida" ;
	SIZE 1,7,1 ;
	DEFAULT 1 ;
	VALID _2lx0vt7s0()
@ 7,26 TO 9,42 ;
	COLOR SCHEME 24
@ 9,27 TO 9,41 ;
	COLOR SCHEME 23
@ 8,42 SAY "³" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 9,42 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 7,42 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 8,30 GET m.imp_btn ;
	PICTURE "@*HN \<Imprime" ;
	SIZE 1,9,1 ;
	DEFAULT 1 ;
	VALID _2lx0vt7t8()

IF NOT WVISIBLE("scgc248")
	ACTIVATE WINDOW scgc248
ENDIF


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º     MS-DOSREAD contains clauses from SCREEN scgc248     º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

READ CYCLE ;
	ACTIVATE READACT() ;
	DEACTIVATE READDEAC() ;
	NOLOCK

RELEASE WINDOW scgc248

#REGION 0
IF m.talkstat = "ON"
	SET TALK ON
ENDIF
IF m.compstat = "ON"
	SET COMPATIBLE ON
ENDIF


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º               SCGC248/MS-DOS Cleanup Code               º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 1
DO ULfecha 		&& FECHA ARQUIVOS ABERTOS
RETURN



*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º   SCGC248/MS-DOS Supporting Procedures and Functions    º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 1
PROCEDURE ULfecha
	IF LFemp		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("empresa")
	ENDIF
	IF LFusr		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("usuario")
	ENDIF
	IF LFgrp		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("grupo")
	ENDIF
	IF LFnfs		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("nota")
	ENDIF
	IF LForc		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("orcament")
	ENDIF
	IF LFtmp		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("orcatmp")
	ENDIF

	wp_flgfecha = .F. 		&& defaut nao fechamento da secao
	IF !EMPTY(wl_areant) AND USED(wl_areant)
		SELECT &wl_areant
	ENDIF
	ON KEY LABEL ESCAPE
	SET FORMAT TO
	************************************
	POP KEY 			&& reabilita teclas de atalho def. anteriormente
RETURN

*-------------->

PROCEDURE BTN_VAL1
	PARAMETER tecla, m.chv_ler, m.chv_compara, m.chv_brow
	LN_prxobj = _CUROBJ
    DO CASE
		CASE tecla = "EDIT" AND !isediting   && INICIA EDICAO
			SHOW GET edit_btn,1 PROMPT "\<Ok"
			SHOW GET m.imp_btn DISABLE
			isediting = .t.
			_CUROBJ = 1	
		    ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
			ON KEY LABEL END DO BTN_VAL1 WITH 'DELETE'
		CASE tecla = "EDIT" AND isediting     && CONFIRMA EDICAO
			SHOW GET edit_btn,1 PROMPT "\<Edita"
			isediting = .f.
			_CUROBJ = 1	
			SHOW GET m.imp_btn ENABLE
		    ON KEY LABEL ESCAPE
			ON KEY LABEL END
		CASE tecla = "DELETE" AND isediting     && CANCELA EDICAO
			SHOW GET edit_btn,1 PROMPT "\<Edita"
			isediting = .f.
			_CUROBJ = 1	
			SHOW GET m.imp_btn DISABLE
		    ON KEY LABEL ESCAPE
			ON KEY LABEL END
	ENDCASE
RETURN

FUNCTION ULrelacao
	SELECT * ;
	   FROM CURSOR_TMP ;
	   INTO CURSOR CRS_ORCA

	*******************
	*---->   (INICIALIZACAO DO CONTROLE DE STATUS IMPRESSAO)
	*******************	
	*******************	
	DO RELINIC.PRG          && INICIA VAR P/ TERMOMETRO
	LFsegue = .t.
	LNregistro = RECNO()
    COUNT  TO LNimpressao
	LNimpressos = 0
	GO LNregistro
	*******************
	*---->   (COMPLETADO PREPARACAO DO CONTROLE DE STATUS IMPRESSAO)
	*******************	

	LFsegue  = .T.
    LSrel = "REL248"
	LSorienta = ;
			"WHILE  LFsegue  "
	***********
	DO UPimpressao WITH 	LFLdireciona, LFLagrega, LFLfimagrega
	LFcontinua = LFsegue

	***********
	DO RELFIM.PRG          && FIM VAR P/ TERMOMETRO
	=UP_fecha("CRS_ORCA")
RETURN


FUNCTION ULresumo

	*==============================================================*
	*  Descartando itens cancelados
	*==============================================================*
	SELECT * ;
	   FROM CURSOR_TMP ;
	   WHERE LEFT(SITUACAO,1) = "O" ;
	   INTO CURSOR CRS_ORCA
	
	*==============================================================*
	* PASSEIO ALINHADOS
	*==============================================================*

	select empresa,orcamento, ;
	    sum(qtde) AS PASSEIO, ;
    	sum(qtde) AS ALNH_PASSEIO,;
	    0000000000000000       AS CARGA,;
    	0000000000000000       AS ALNH_CARGA;
	FROM CRS_ORCA ;
		WHERE left(codigo,3) = "919" ;
	  	  AND !(ALLTRIM(codigo) $ ;
	  	      "91900409/91901308/91901405/91901103/91901200") ;
		ORDER BY empresa,orcamento ;
		GROUP BY empresa,orcamento ;
		INTO CURSOR PAS_TMP

	*==============================================================*
	* PASSEIO  ATENDIDOS E NAO ALINHADOS
	*==============================================================*

	select * from PAS_TMP ;
	UNION ;
	select empresa,orcamento, ;
		0000000000000001       AS PASSEIO,;
		0000000000000000       AS ALNH_PASSEIO,;
	    0000000000000000       AS CARGA,;
	   	0000000000000000       AS ALNH_CARGA;
	FROM OR_ORCA ;
		where     TP_VEICULO <> 2 ;
	      AND ORCAMENTO NOT IN (SELECT ORCAMENTO FROM PAS_TMP) ;
		GROUP BY orcamento  ;
		INTO CURSOR PASSEIO

	*------------------------------------------*
	* CARGA  ALINHADOS
	*------------------------------------------*
	
	select empresa,orcamento, ;
    	0000000000000000        AS PASSEIO, ;
	    0000000000000000        AS ALNH_PASSEIO,;
    	sum(qtde)  AS CARGA,;
	    sum(qtde)  AS ALNH_CARGA;
	FROM CRS_ORCA ;
		WHERE left(codigo,3) = "919" ;
	  	  AND (ALLTRIM(codigo) $ ;
	  	      "91900409/91901308/91901405/91901103/91901200") ;
		ORDER BY empresa,orcamento ;
		GROUP BY empresa,orcamento ;
		INTO CURSOR CRG_TMP

	*------------------------------------------*
	* CARGA ATENDIDOS E NAO ALINHADOS
	*------------------------------------------*

	select * from CRG_TMP ;
	UNION ;
	select empresa,orcamento, ;
		0000000000000000  AS PASSEIO, ;
		0000000000000000  AS ALNH_PASSEIO,;
	    0000000000000001  AS CARGA,;
	    0000000000000000  AS ALNH_CARGA;
	FROM OR_ORCA ;
		where     TP_VEICULO = 2 ;
		      AND ORCAMENTO NOT IN (SELECT ORCAMENTO FROM CRG_TMP) ;
		GROUP BY orcamento  ;
		INTO CURSOR CARGA

	SELECT * FROM PASSEIO  ;
	UNION ;
	SELECT * FROM CARGA;
	INTO CURSOR MVPTIO


	SELECT EMPRESA, ;
	    SUM(PASSEIO)    AS PASSEIO,;
     	SUM(CARGA)      AS CARGA,;
     	SUM(ALNH_PASSE) AS ALNH_PASSE, ;
     	SUM(ALNH_CARGA) AS ALNH_CARGA ;
	 FROM MVPTIO ;
	 GROUP BY EMPRESA;
	 INTO CURSOR PTIO_1



	*******************
	*---->   (INICIALIZACAO DO CONTROLE DE STATUS IMPRESSAO)
	*******************	
	*******************	
	DO RELINIC.PRG          && INICIA VAR P/ TERMOMETRO
	LFsegue = .t.
	LNregistro = RECNO()
    COUNT  TO LNimpressao
	LNimpressos = 0
	GO LNregistro
	*******************
	*---->   (COMPLETADO PREPARACAO DO CONTROLE DE STATUS IMPRESSAO)
	*******************	
	*********************>>> REGISTRO DE SAIDAS <<<<***********
	LFsegue  = .T.
    LSrel = "REL248A"
	LSorienta = ;
			"WHILE  LFsegue  "
	***********
	DO UPimpressao WITH 	LFLdireciona, LFLagrega, LFLfimagrega
	LFcontinua = LFsegue
	***********
	DO RELFIM.PRG          && FIM VAR P/ TERMOMETRO



	=UP_fecha("CRS_ORCA")
	=UP_fecha("PAS_TMP")
	=UP_fecha("PASSEIO")
	=UP_fecha("CRG_TMP")
	=UP_fecha("CARGA")
	=UP_fecha("MVPTIO")
	=UP_fecha("PTIO_1")

RETURN



*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0VT7RQ           m.empresa WHEN                     º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC248,     Record Number:   34   º
*       º Variable:            m.empresa                          º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Field                              º
*       º Snippet Number:      1                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0vt7rq     &&  m.empresa WHEN
#REGION 1
ON KEY LABEL ESCAPE	KEYBOARD "{END}"
IF LASTKEY() = 15 AND !(isediting)
	KEYBOARD "{ESCAPE}"
ENDIF
RETURN(isediting)

*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0VT7RR           m.empresa VALID                    º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC248,     Record Number:   34   º
*       º Variable:            m.empresa                          º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Field                              º
*       º Snippet Number:      2                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0vt7rr     &&  m.empresa VALID
#REGION 1
SELECT empresa
SET ORDER TO TAG empresa
IF LASTKEY() = 9
   ON KEY LABEL ESCAPE
   DO loc_dlog WITH .F.
   ON KEY LABEL ESCAPE DO BTN_VAL WITH 'DELETE'
   IF LASTKEY() = 27
		SELECT empresa
		RETURN .F.
	ENDIF
ELSE
	IF !SEEK(m.empresa)
		SELECT empresa
		RETURN .F.
	ENDIF
ENDIF
m.empresa   = empresa
m.nome_emp  = empresa.nome
SHOW GET m.empresa
SHOW GET m.nome_emp
SELECT empresa
RETURN .T.


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0VT7RS           m.nome_emp WHEN                    º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC248,     Record Number:   35   º
*       º Variable:            m.nome_emp                         º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Field                              º
*       º Snippet Number:      3                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0vt7rs     &&  m.nome_emp WHEN
#REGION 1
ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
RETURN(.f.)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0VT7RT           m.dt_inicio VALID                  º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC248,     Record Number:   36   º
*       º Variable:            m.dt_inicio                        º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Field                              º
*       º Snippet Number:      4                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0vt7rt     &&  m.dt_inicio VALID
#REGION 1
m.dt_fim = m.dt_inicio
SHOW GET m.dt_fim
RETURN (.T.)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0VT7RU           m.dt_fim WHEN                      º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC248,     Record Number:   37   º
*       º Variable:            m.dt_fim                           º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Field                              º
*       º Snippet Number:      5                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0vt7ru     &&  m.dt_fim WHEN
#REGION 1
ON KEY LABEL ENTER
RETURN(isediting)

*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0VT7RV           m.rlOSI WHEN                       º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC248,     Record Number:   38   º
*       º Variable:            m.rlOSI                            º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Check Box                          º
*       º Snippet Number:      6                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0vt7rv     &&  m.rlOSI WHEN
#REGION 1
ON KEY LABEL ENTER  KEYBOARD "{RIGHTARROW}"
RETURN(isediting)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0VT7RW           m.rlresumo WHEN                    º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC248,     Record Number:   39   º
*       º Variable:            m.rlresumo                         º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Check Box                          º
*       º Snippet Number:      7                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0vt7rw     &&  m.rlresumo WHEN
#REGION 1
ON KEY LABEL ENTER  KEYBOARD "{RIGHTARROW}"
RETURN(isediting)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0VT7RX           m.dias_trab WHEN                   º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC248,     Record Number:   40   º
*       º Variable:            m.dias_trab                        º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Field                              º
*       º Snippet Number:      8                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0vt7rx     &&  m.dias_trab WHEN
#REGION 1
ON KEY LABEL ENTER
RETURN(isediting)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0VT7RY           m.edit_btn WHEN                    º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC248,     Record Number:   41   º
*       º Variable:            m.edit_btn                         º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      9                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0vt7ry     &&  m.edit_btn WHEN
#REGION 1
ON KEY LABEL ENTER
RETURN(.t.)

*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0VT7RZ           m.AAimp_btn VALID                  º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC248,     Record Number:   42   º
*       º Variable:            m.AAimp_btn                        º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      10                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
    ********************************************************

FUNCTION _2lx0vt7rz     &&  m.AAimp_btn VALID
#REGION 1
    SELE TIPOOPER
    SET ORDE TO TIPO

	SELE orcament
	SET ORDER TO TAG data_fat
	SET RELATION TO "S"+orcament.tipo INTO tipooper

	SET NEAR ON
	SEEK STR(m.empresa,3)+DTOS(m.dt_inicio)+STR(1,7)
	SET NEAR OFF
	IF EOF() OR orcament.dt_fat > m.dt_fim	
		WAIT WINDOW "Nao Existem Dados Com Parametros Informados. <ENTER> "
		RETURN
	ENDIF

	********************>  GERANDO ARQTMP CAPA_ORC **********************

	wl_arqtmp = ""
	LNtmp     = 65		&& TABELA ASCII A = 65
	IF !UPabretmp("iie")
		wp_flgfecha = .t.
	ENDIF
	IF wp_flgfecha
		UNLOCK
 		RETURN
 	ENDIF		
	************************************************************
	LStmp = "&wp_dirtmp"+"&wl_arqtmp"

	WAIT WINDOW "AGUARDE. Gerando Arq. Temporario." NOWAIT

	SELE orcament
	
    COPY TO &LStmp  ;
    	FOR 	tipooper.ch_opera = "1" ;
    		AND orcament.tp_transp = 1  ;
			AND LEFT(orcament.situacao,1) = "O" ;
		WHILE m.empresa = orcament.empresa ;
			AND orcament.dt_fat <= m.dt_fim WITH CDX
	
	*----- O alias  ARQTMP serve para referencia fixa no relatorio *-----
	*----- a atribuicao a wl_arqtmp e para manter o padrao
	
	SELE 0
	USE &LStmp  alias capa_orc exclu
	INDEX ON orcamento TAG capa_orc ADDITIVE
	SET ORDER TO TAG capa_orc
	
	********************>  GERANDO ARQTMP ITENS_ORC **********************
	wl_arqtmp = ""
	LNtmp     = 65		&& TABELA ASCII A = 65
	IF !UPabretmp("iie")
		wp_flgfecha = .t.
	ENDIF
	IF wp_flgfecha
		UNLOCK
 		RETURN
 	ENDIF		
	************************************************************
	
	LStmp = "&wp_dirtmp"+"&wl_arqtmp"
	WAIT WINDOW "AGUARDE. Gerando Arq. Temporario." NOWAIT
	
*	SELE orcatmp
*	SET ORDER TO TAG data_fat
*	SET NEAR ON
*	SEEK STR(m.empresa,3)+DTOS(m.dt_inicio)
*	SET NEAR OFF
*	IF EOF() OR m.empresa <> orcatmp.empresa  OR orcatmp.dtfat > m.dt_fim	
*		WAIT WINDOW "Nao Existem Dados Com Parametros Informados. <ENTER> "
*		SELE capa_orc
*		USE
*		SELE itens_orc
*		USE
*		RETURN
*	ENDIF
******** INICIO

	
	SELE GRUPO
	SET ORDE TO codigo
	
	SELE ORCATMP
	SET ORDE TO chv_emporc
	SET RELATION TO codigo							INTO grupo   ADDIT
	
	SELE orcament
	SET ORDER TO TAG data_fat
	SET RELATION TO str(empresa,3)+str(orcamento,6) INTO orcatmp ADDIT
	SET SKIP TO orcatmp
	
	SELE orcament
	SET NEAR ON
	SEEK STR(m.empresa,3)+DTOS(m.dt_inicio)+STR(1,7)
	SET NEAR OFF
	
********** FIM
on error
	
    COPY TO &LStmp  ;
    	FIELD orcatmp.EMPRESA,orcatmp.ORCAMENTO,orcatmp.IMP_VIA,;
		      orcatmp.SITUACAO,orcatmp.DESCONTO,orcatmp.DESC_ALT,;
		      orcatmp.USR_DALT,orcatmp.ORDEM,orcatmp.CODIGO,;
		      orcatmp.UNIDADE,orcatmp.DESCRICAO,orcatmp.TP_MERCAD,;
		      orcatmp.PESO,orcatmp.IVA,orcatmp.CLAS_CMS,orcatmp.CFO,;
		      orcatmp.ORIGEM,orcatmp.CST,orcatmp.BASE_ISS,orcatmp.ALIQ_ISS,;
		      orcatmp.VLR_ISS,orcatmp.BASE_CALC,orcatmp.ALIQ_ICMS,;
		      orcatmp.VLR_ICMS,orcatmp.BASE_SBBRT,orcatmp.BASE_SUBS,;
		      orcatmp.ICMS_SUBS,orcatmp.BASE_ISENT,orcatmp.BASE_OUTR,;
		      orcatmp.BASE_ISIPI,orcatmp.BASE_IPI,orcatmp.ALIQ_IPI,;
		      orcatmp.VLRIPI,orcatmp.PRECO,orcatmp.DESC_ADICI,;
		      orcatmp.PRECOFINAL,orcatmp.QTDE,orcatmp.VLRVENDA,;
		      orcatmp.QTDERES,orcatmp.DTREGIS,orcatmp.HREGIS,;
		      orcatmp.USRREGIS,orcatmp.DELETADO,tipooper.ch_opera,;
		      grupo.classifica ;
    	FOR tipooper.ch_opera = "1" ;
    		AND orcament.empresa=m.empresa ;
		WHILE ;
		    orcament.empresa  = m.empresa  ;
			AND orcament.dt_fat <= m.dt_fim

	*----- a atribuicao a wl_arqtmp e para manter o padrao
	
	SELE 0
	USE &LStmp  alias itens_orc exclu
    INDEX ON orcamento TAG itens_orc ADDITIVE
	SET ORDER TO TAG itens_orc
	
	*******************
	*---->   (INICIALIZACAO DO CONTROLE DE STATUS IMPRESSAO)
	*******************	
	SELE capa_orc
	GO TOP
	IF EOF()
		WAIT WINDOW "Nao Existem Prod. Com Parametros Informados. <ENTER> "
		USE
        SELE itens_orc
        USE
		RETURN
	ENDIF
	*******************	

	***************************
	LFLdireciona  = .F. && Ativa PRTSETUP para direcionar impressao DEF(.T.)
	LFLagrega 	  = .T. && Agrega o ??.REL em ??.AGR			    DEF(.F.)
	LFLfimagrega  = .F. && Qdo. Estiver agregando => encerra        DEF(.F.)
	**********************************************************************
	LFcontinua = .t.  			&& CAPTURA O VALOR DE LFsegue
	**************************>>> RELATORIO GERAL <<<*********************
	LNpagina = 1

	LNpagina = LNpagina - 1   && DESCONTA O VLR. INICIAL DE _PAGENO

	DO CASE
		CASE m.rlOSI AND m.rlresumo
			DO ULrelacao		
			LNpagina = LNpagina + _PAGENO - 1 && DAR SEQUENCIA AO N. PAGINA
			LFLfimagrega  = .T. && ENCERRA AGREGACAO DE RELATORIOS
			LFLdireciona  = .T.
			DO ULresumo	
		CASE m.rlOSI or m.rlresumo
			LFLfimagrega  = .T. && Qdo. Estiver agregando => encerra EF(.F.)
			IF m.rlOSI
				DO ULrelacao		
			ELSE
				DO ULresumo	
			ENDIF		
	ENDCASE
	*****
	
	*-----------------------------
	SELE capa_orc
	USE
	SELE itens_orc
	USE
	SELE orcament
	*-----------------------------
    SET PRINTER TO SET('PRINTER',1)
	SET RELATION TO
	SET POINT TO
	SET SEPARATOR  TO

	SHOW WINDOW SCGC248 TOP
	SHOW GET m.imp_btn DISABLE
RETURN


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0VT7S0           m.canc_btn VALID                   º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC248,     Record Number:   43   º
*       º Variable:            m.canc_btn                         º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      11                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _2lx0vt7s0     &&  m.canc_btn VALID
#REGION 1
CLEAR GETS
CLEAR READ
isediting = .f.
RETURN .T.

*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _2LX0VT7T8           m.imp_btn VALID                    º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC248,     Record Number:   49   º
*       º Variable:            m.imp_btn                          º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      12                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
    ********************************************************
FUNCTION _2lx0vt7t8     &&  m.imp_btn VALID
#REGION 1
    ArqTipooper = UPobterPath("TIPOOPER",.F.)+"TIPOOPER.DBF"
    ArqOrcament = wp_dirdat+"ORCAMENT.DBF"
    ArqOrTmp    = wp_dirdat+"ORCATMP.DBF"
    ArqGrupo    = UPobterPath("GRUPO",.F.)+"GRUPO.DBF"
	SELE orcament
	
	************************************************************
	
	WAIT WINDOW "AGUARDE. Gerando Arq. Temporario." NOWAIT

	*==============================================================*
	*  Selecionando todas capas de orcamento que atendam condicoes *
	* iniciais                                                     *
	*==============================================================*

    SELECT    ;
    		  OR.EMPRESA,OR.ORCAMENTO,;
              OR.DATA,OR.dt_fat,OR.hora,OR.hora_fat,;
			  OR.VEICULO,OR.TP_VEICULO,TP.ch_opera,OR.situacao;
        FROM ;
             &ArqTipooper  TP, ;
	       	 &ArqOrcament  OR ;
		WHERE ;
    		    OR.tp_transp = 1  ;
			AND LEFT(OR.situacao,1) = "O" ;
	        AND OR.empresa   = m.empresa  ;
		    AND OR.dt_fat   >= m.dt_inicio  ;
		    AND OR.dt_fat   <= m.dt_fim   ;
	        AND TP.processo  = "S" ;
	        AND TP.ch_opera  = "1" ;
	        AND TP.tipo      = OR.tipo   ;
    GROUP BY OR.ORCAMENTO;
    ORDER BY OR.ORCAMENTO;
    INTO CURSOR  OR_ORCA


	*==============================================================*
	*    Motando registro de todo movimento que atenda   condicoes *
	* iniciais. Inclusive os itens cancelados que serao descartados*
	* no resumo de movimento de patio                              *
	*==============================================================*

    SELECT    ;
    		  OR.EMPRESA,OR.ORCAMENTO,;
              OR.DATA,OR.dt_fat,OR.hora,OR.hora_fat,;
			  OR.VEICULO,OR.TP_VEICULO,or.ch_opera,;
			  TM.situacao,;
		      TM.CODIGO,;
		      TM.QTDE,;
		      GR.classifica ;
        FROM ;
	       	 OR_ORCA        OR, ;
	       	 &ArqOrTmp     TM, ;
             &ArqGrupo     GR  ;
		WHERE ;
			    OR.empresa   = TM.empresa  ;
			AND OR.orcamento = TM.orcamento;
            AND TM.codigo    = GR.codigo   ;
            AND (;
                 (LEFT(TM.situacao,1) $ "O")  ;
                  OR;
                 (LEFT(TM.situacao,1) $ "Y" ;
                    AND LEFT(GR.CLASSIFICA,5) = "09091");
                );
    ORDER BY OR.ORCAMENTO;
    INTO CURSOR  CURSOR_TMP

	*==============================================================*


	*******************
	*---->   (INICIALIZACAO DO CONTROLE DE STATUS IMPRESSAO)
	*******************	
	SELE CURSOR_TMP
	GO TOP
	IF EOF()
		=UP_fecha("OR_ORCA")
		=UP_fecha("CURSOR_TMP")
		WAIT WINDOW "Nao Existem Prod. Com Parametros Informados. <ENTER> "
		USE
		RETURN
	ENDIF
	*******************	

	***************************
	LFLdireciona  = .F. && Ativa PRTSETUP para direcionar impressao DEF(.T.)
	LFLagrega 	  = .T. && Agrega o ??.REL em ??.AGR			    DEF(.F.)
	LFLfimagrega  = .F. && Qdo. Estiver agregando => encerra        DEF(.F.)
	**********************************************************************
	LFcontinua = .t.  			&& CAPTURA O VALOR DE LFsegue
	**************************>>> RELATORIO GERAL <<<*********************
	LNpagina = 1

	LNpagina = LNpagina - 1   && DESCONTA O VLR. INICIAL DE _PAGENO

	DO CASE
		CASE m.rlOSI AND m.rlresumo
			DO ULrelacao		
			LNpagina = LNpagina + _PAGENO - 1 && DAR SEQUENCIA AO N. PAGINA
			LFLfimagrega  = .T. && ENCERRA AGREGACAO DE RELATORIOS
			LFLdireciona  = .T.
			DO ULresumo	
		CASE m.rlOSI or m.rlresumo
			LFLfimagrega  = .T. && Qdo. Estiver agregando => encerra EF(.F.)
			IF m.rlOSI
				DO ULrelacao		
			ELSE
				DO ULresumo	
			ENDIF		
	ENDCASE
	*****
	
	*-----------------------------
	=UP_fecha("OR_ORCA")
	=UP_fecha("CURSOR_TMP")

	SELE orcament
	*-----------------------------
    SET PRINTER TO SET('PRINTER',1)
	SET RELATION TO
	SET POINT TO
	SET SEPARATOR  TO

	SHOW WINDOW SCGC248 TOP
	SHOW GET m.imp_btn DISABLE
RETURN
