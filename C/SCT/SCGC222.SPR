*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º 06/08/15             SCGC222.SPR               16:24:33 º
*       º                                                         º
*       ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
*       º                                                         º
*       º Author's Name                                           º
*       º                                                         º
*       º Copyright (c) 2015 Company Name                         º
*       º Address                                                 º
*       º City,     Zip                                           º
*       º                                                         º
*       º Description:                                            º
*       º This program was automatically generated by GENSCRN.    º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º          SCGC222/MS-DOS Setup Code - SECTION 1          º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 1
*---------------------------------------------------------------*
* OPERA ARQUIVOS :
*			NOTAENT
*		    EMPRESA
*           NOTA
*           APURAICM
* OBJETIVO:	IMPRIMIR LIVRO REGISTRO DE SAIDAS COMERCIAIS
*	
*---------------------------------------------------------------*

******>>>> INICIO CONTROLE AMBIENTAL

ON KEY LABEL ESCAPE

PRIVATE dbf_APURA, als_apura

PRIVATE isediting,isadding,isreading
PRIVATE wp_record
PRIVATE isreadonly,is2table,wzalias
PRIVATE LS222areant
LS222areant = ALLTRIM(ALIAS()) && PERMITE RETORNAR A AREA ANTER. A CHAMADA


DBF_APURA = ""
ALS_APURA = ""

m.wzalias	=	SELECT()
m.isediting	=	.F.
m.isadding	=	.F.
m.isreading=	.F.
m.is2table 	= 	.F.
wp_flgfecha = 	.F. 		&& defaut nao fechamento da secao
WP_RECORD 	= 	0
wp_ref_local =  .f.     && NAO POSSUI CONTROLE DE REFRESH LOCAL

resumo		= .f.       && AUTORIZA OU NAO EMISSAO DE RESUMO
livro		= .f.       && AUTORIZA OU NAO EMI. DO LIVRO DE APURACAO

LFnot222	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFemp222	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFapu222	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFent222	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
********  VARIAVEIS UTILIZADAS PARA RESUMO APURACAO
wl_arqtmp  = ""


PRIVATE linha_1a,linha_1b,linha_1c,linha_1d
PRIVATE linha_2a,linha_2b,linha_2c
PRIVATE linha_3a,linha_3b,linha_3c,linha_3d,linha_3e

STORE "" TO linha_1a,linha_1b,linha_1c,linha_1d
STORE "" TO linha_2a,linha_2b,linha_2c
STORE "" TO linha_3a,linha_3b,linha_3c,linha_3d,linha_3e

PRIVATE linha_4,linha_5a,linha_5b,linha_6

STORE ""  TO linha_4,linha_5a,linha_5b,linha_6

PRIVATE soma_1,soma_2,soma_3,soma_4,soma_5,soma_6,soma_7,soma_8, ;
		soma_9,soma_10

STORE 0  TO soma_1,soma_2,soma_3,soma_4,soma_5,soma_6,soma_7,soma_8, ;
		soma_9,soma_10

PRIVATE aux_1,aux_2,aux_3,aux_4,aux_5,aux_6,aux_7,aux_8, ;
		aux_9,aux_10,aux_11,aux_12,aux_12A,aux_13,aux_14

STORE 0  TO aux_1,aux_2,aux_3,aux_4,aux_5,aux_6,aux_7,aux_8, ;
		aux_9,aux_10,aux_11,aux_12,aux_12a,aux_13,aux_14
PRIVATE dt_1,dt_2,dt_3,dt_4,dt_5,dt_6
STORE CTOD("  .  .  ")   TO dt_1,dt_2,dt_3,dt_4,dt_5,dt_6
PRIVATE vlr_1,vlr_2,vlr_3,vlr_4,vlr_5,vlr_6
STORE 0  TO vlr_1,vlr_2,vlr_3,vlr_4,vlr_5,vlr_6
PRIVATE tot_1,tot_2,tot_3,tot_4
STORE 0  TO tot_1,tot_2,tot_3,tot_4
******>>>> INICIO CONTROLE ARQUIVOS
IF !USED("empresa")
	LFemp222	= .T.
	IF ! NetUse("empresa")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("apuraicm")
	LFapu222	= .T.
	IF ! NetUse("apuraicm")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF wp_flgfecha
	DO ULfecha
	RETURN
ENDIF





#REGION 0
REGIONAL m.currarea, m.talkstat, m.compstat

IF SET("TALK") = "ON"
	SET TALK OFF
	m.talkstat = "ON"
ELSE
	m.talkstat = "OFF"
ENDIF
m.compstat = SET("COMPATIBLE")
SET COMPATIBLE FOXPLUS

*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º                MS-DOS Window definitions                º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

IF NOT WEXIST("scgc222") ;
	OR UPPER(WTITLE("SCGC222")) == "SCGC222.PJX" ;
	OR UPPER(WTITLE("SCGC222")) == "SCGC222.SCX" ;
	OR UPPER(WTITLE("SCGC222")) == "SCGC222.MNX" ;
	OR UPPER(WTITLE("SCGC222")) == "SCGC222.PRG" ;
	OR UPPER(WTITLE("SCGC222")) == "SCGC222.FRX" ;
	OR UPPER(WTITLE("SCGC222")) == "SCGC222.QPR"
	DEFINE WINDOW scgc222 ;
		FROM INT((SROW()-15)/2),INT((SCOL()-75)/2) ;
		TO INT((SROW()-15)/2)+14,INT((SCOL()-75)/2)+74 ;
		TITLE "[ Livro Registro de Apuracao do ICMS ]" ;
		FOOTER "[ 222 ]" ;
		FLOAT ;
		NOCLOSE ;
		SHADOW ;
		NOMINIMIZE ;
		NONE ;
		COLOR SCHEME 1
ENDIF


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º          SCGC222/MS-DOS Setup Code - SECTION 2          º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 1

******>>>> INICIO CONTROLE LOCAL

DO CASE
	CASE !wp_flgfecha
		SELECT empresa
		SET ORDER TO TAG empresa
		SEEK wp_empresa
		m.nome_emp = empresa.nome
***
		m.empresa   = empresa.empresa
		m.nome_emp  = empresa.nome
		m.inscricao = empresa.inscricao
		SHOW GET m.empresa
		SHOW GET m.nome_emp

***
		*-------------------------> criado pelo wizard
		m.wzalias=SELECT()
		m.isreadonly=IIF(ISREAD(),.T.,.F.)
ENDCASE



*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º              SCGC222/MS-DOS Screen Layout               º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 1
IF WVISIBLE("scgc222")
	ACTIVATE WINDOW scgc222 SAME
ELSE
	ACTIVATE WINDOW scgc222 NOSHOW
ENDIF
@ 0,0 TO 14,74 ;
	COLOR SCHEME 23
@ 0,23 SAY "[ Livro de Apuracao de I.C.M.S ]" ;
	SIZE 1,32, 0
@ 0,68 SAY "[222]" ;
	SIZE 1,5, 0
@ 1,2 TO 3,35 ;
	COLOR SCHEME 23
@ 3,3 TO 3,34 ;
	COLOR SCHEME 24
@ 3,35 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 2,35 SAY "³" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,35 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,3 SAY "[Filial]" ;
	SIZE 1,8, 0
@ 2,51 SAY "a" ;
	SIZE 1,1, 0
@ 1,38 TO 3,64 ;
	COLOR SCHEME 23
@ 3,39 TO 3,63 ;
	COLOR SCHEME 24
@ 3,64 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 2,64 SAY "³" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,64 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,39 SAY "[ N.F. Periodo ]" ;
	SIZE 1,16, 0
@ 5,2 TO 7,18 ;
	COLOR SCHEME 24
@ 7,3 TO 7,17 ;
	COLOR SCHEME 23
@ 6,18 SAY "³" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 7,18 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 5,18 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 5,20 TO 7,36 ;
	COLOR SCHEME 24
@ 7,21 TO 7,35 ;
	COLOR SCHEME 23
@ 6,36 SAY "³" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 7,36 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 5,36 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 5,38 TO 7,54 ;
	COLOR SCHEME 24
@ 7,39 TO 7,53 ;
	COLOR SCHEME 23
@ 6,54 SAY "³" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 7,54 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 5,54 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 5,56 TO 7,72 ;
	COLOR SCHEME 24
@ 7,57 TO 7,71 ;
	COLOR SCHEME 23
@ 6,72 SAY "³" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 7,72 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 5,72 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 11,47 TO 13,57 ;
	COLOR SCHEME 24
@ 13,48 TO 13,56 ;
	COLOR SCHEME 23
@ 12,57 SAY "³" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 13,57 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 11,57 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 11,64 TO 13,72 ;
	COLOR SCHEME 24
@ 13,65 TO 13,71 ;
	COLOR SCHEME 23
@ 12,72 SAY "³" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 13,72 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 11,72 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 8,3 TO 10,14 ;
	COLOR SCHEME 23
@ 10,4 TO 10,13 ;
	COLOR SCHEME 24
@ 10,14 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 9,14 SAY "³" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 8,14 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 8,4 SAY "[Pag.Ini]" ;
	SIZE 1,9, 0
@ 8,16 TO 10,73 ;
	COLOR SCHEME 23
@ 10,17 TO 10,72 ;
	COLOR SCHEME 24
@ 10,73 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 9,73 SAY "³" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 8,73 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 8,33 SAY "[Titulo de Relatorio]" ;
	SIZE 1,21, 0
@ 14,1 TO 14,73 ;
	COLOR SCHEME 24
@ 14,74 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,74 TO 13,74 ;
	COLOR SCHEME 24
@ 0,74 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 2,6 SAY "-" ;
	SIZE 1,1, 0
@ 11,2 TO 13,10 ;
	COLOR SCHEME 24
@ 13,3 TO 13,9 ;
	COLOR SCHEME 23
@ 12,10 SAY "³" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 13,10 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 11,10 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 11,17 TO 13,31 ;
	COLOR SCHEME 24
@ 13,18 TO 13,30 ;
	COLOR SCHEME 23
@ 12,31 SAY "³" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 13,31 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 11,31 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 11,32 TO 13,46 ;
	COLOR SCHEME 24
@ 13,33 TO 13,45 ;
	COLOR SCHEME 23
@ 12,46 SAY "³" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 13,46 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 11,46 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 2,3 GET m.empresa ;
	SIZE 1,3 ;
	DEFAULT 0 ;
	PICTURE "999" ;
	WHEN _4dc0z658t() ;
	VALID _4dc0z659h()
@ 2,7 GET m.nome_emp ;
	SIZE 1,27 ;
	DEFAULT " " ;
	WHEN _4dc0z659r()
@ 2,40 GET m.dt_inicio ;
	SIZE 1,10 ;
	DEFAULT {  /  /  } ;
	WHEN _4dc0z659x() ;
	VALID _4dc0z65a4()
@ 2,53 GET m.dt_fim ;
	SIZE 1,10 ;
	DEFAULT {  /  /  } ;
	WHEN _4dc0z65ab() ;
	VALID m.dt_fim >= m.dt_inicio ;
	MESSAGE "Data Final deve ser maior ou igual a Inicial"
@ 6,6 GET m.db_btn ;
	PICTURE "@*HN \<Debit." ;
	SIZE 1,8,1 ;
	DEFAULT 1 ;
	WHEN _4dc0z65ah() ;
	VALID _4dc0z65ai() ;
	MESSAGE 'Permite a alteracao de dados do registro corrente'
@ 6,25 GET m.cr_btn ;
	PICTURE "@*HN \<Cred." ;
	SIZE 1,7,1 ;
	DEFAULT 1 ;
	VALID _4dc0z65aj() ;
	MESSAGE 'Permite a alteracao de dados do registro corrente'
@ 6,42 GET m.sld_btn ;
	PICTURE "@*HN Sa\<ldos" ;
	SIZE 1,8,1 ;
	DEFAULT 1 ;
	VALID _4dc0z65b4() ;
	MESSAGE 'Permite a alteracao de dados do registro corrente'
@ 6,58 GET m.inf_btn ;
	PICTURE "@*HN Com\<plemento" ;
	SIZE 1,13,1 ;
	DEFAULT 1 ;
	VALID _4dc0z65ba() ;
	MESSAGE 'Permite a alteracao de dados do registro corrente'
@ 9,6 GET LNpagina ;
	SIZE 1,4 ;
	DEFAULT 0 ;
	PICTURE "9999" ;
	WHEN _4dc0z65bg() ;
	VALID LNpagina > 0
@ 9,18 GET m.titulo ;
	SIZE 1,54 ;
	DEFAULT " " ;
	WHEN _4dc0z65bm()
@ 12,3 GET m.edit_btn ;
	PICTURE "@*HN \<Edita" ;
	SIZE 1,7,1 ;
	DEFAULT 1 ;
	VALID btn_val1('EDIT') ;
	MESSAGE 'Permite a alteracao de dados do registro corrente'
@ 12,18 GET m.grv ;
	PICTURE "@*VN \<Grv.Valores" ;
	SIZE 1,13,1 ;
	DEFAULT 1 ;
	WHEN _4dc0z65bt() ;
	VALID _4dc0z65bz() ;
	DISABLE
@ 12,33 GET m.rec ;
	PICTURE "@*VN \<Rec.Valores" ;
	SIZE 1,13,1 ;
	DEFAULT 1 ;
	WHEN _4dc0z65c0() ;
	VALID _4dc0z65c1() ;
	DISABLE
@ 12,48 GET m.imp_btn ;
	PICTURE "@*HN \<Imprime" ;
	SIZE 1,9,1 ;
	DEFAULT 1 ;
	VALID _4dc0z65ch() ;
	DISABLE
@ 12,65 GET m.canc_btn ;
	PICTURE "@*HN \<Saida" ;
	SIZE 1,7,1 ;
	DEFAULT 1 ;
	VALID _4dc0z65cp()

IF NOT WVISIBLE("scgc222")
	ACTIVATE WINDOW scgc222
ENDIF

READ CYCLE ;
	ACTIVATE READACT() ;
	DEACTIVATE READDEAC()

RELEASE WINDOW scgc222

#REGION 0
IF m.talkstat = "ON"
	SET TALK ON
ENDIF
IF m.compstat = "ON"
	SET COMPATIBLE ON
ENDIF


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º               SCGC222/MS-DOS Cleanup Code               º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 1
DO ULfecha
RETURN
**********************



*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º   SCGC222/MS-DOS Supporting Procedures and Functions    º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 1
PROCEDURE ULfecha
	IF LFapu222  		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("apuraicm")
	ENDIF
	IF LFemp222  		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("empresa")
	ENDIF
	wp_flgfecha = .F. 		&& defaut nao fechamento da secao
	IF !EMPTY(LS222areant)
		SELECT &LS222areant
	ENDIF
	ON KEY LABEL ESCAPE
	SET FORMAT TO
RETURN

*****>>>>>>>>>>--------------------------
PROCEDURE BTN_VAL1
	PARAMETER tecla, m.chv_ler, m.chv_compara, m.chv_brow
	ON KEY LABEL ENTER
	LN_prxobj = _CUROBJ
    DO CASE
		CASE tecla = "EDIT" AND !isediting   && INICIA EDICAO
			SHOW GET edit_btn,1 PROMPT "\<Ok"
			SHOW GET m.imp_btn DISABLE
			SHOW GET m.rec DISABLE
			SHOW GET m.grv DISABLE
			isediting = .t.
			_CUROBJ = 1	
		    ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
			ON KEY LABEL END DO BTN_VAL1 WITH 'DELETE'
		CASE tecla = "EDIT" AND isediting     && CONFIRMA EDICAO
			SHOW GET edit_btn,1 PROMPT "\<Edita"
			isediting = .f.
			_CUROBJ = 1	
			SHOW GET m.imp_btn ENABLE
			SHOW GET m.rec ENABLE
			SHOW GET m.grv ENABLE
		    ON KEY LABEL ESCAPE
			ON KEY LABEL END
****************
			wl_arqtmp = ""
			DO ULapura
			IF wp_flgfecha
				SHOW GET m.imp_btn DISABLE
			ELSE
				m.soma_2 = aux_1 + aux_2 + aux_3 + aux_4 + aux_5
				m.soma_3 = aux_6 + aux_7 + aux_8
				m.tot_1  = soma_1 + soma_2 + soma_3
			*
				m.soma_5 = aux_9 + aux_10 + aux_11 + aux_12 +aux_12a
				m.soma_7  = soma_4 + soma_5 + soma_6
				m.tot_2  = soma_7 + soma_8

			*
				m.soma_9  = tot_1 - tot_2
				IF m.soma_9 > 0
					m.soma_10  = aux_13 + aux_14
					m.tot_3  = soma_9 - soma_10
					m.tot_4  = ABS(tot_1 - tot_2 - tot_3)
				ELSE	
					m.soma_10  = 0
					m.tot_3  = 0
					m.soma_9 = 0
					m.tot_4  = ABS(tot_1 - tot_2 - tot_3)
				ENDIF					
			ENDIF
*****************
		CASE tecla = "DELETE" AND isediting     && CANCELA EDICAO
			SHOW GET edit_btn,1 PROMPT "\<Edita"
			isediting = .f.
			_CUROBJ = 1	
			SHOW GET m.imp_btn DISABLE
			SHOW GET m.rec DISABLE
			SHOW GET m.grv DISABLE
		    ON KEY LABEL ESCAPE
			ON KEY LABEL END
	ENDCASE
RETURN


PROCEDURE ULapura


	PRIVATE dbf_NFSTMP, als_NFSTMP, dbf_NFS
	PRIVATE dbf_ITMTMP, als_ITMTMP, dbf_ITM
 	PRIVATE dbf_TIPTMP, als_TIPTMP, dbf_TIP

	dbf_NFS         = wp_dirdat + 'NOTA.DBF'
	dbf_ITM  		= wp_dirdat + "ITEMMOV.DBF"

	dbf_NFE         = wp_dirdat + 'NOTAENT.DBF'
    dbf_ITENT       = wp_dirdat + "NOTAITE.DBF"



    IF M.dt_fim < {01.01.2003}
		dbf_TIP  		= "L:\TMP\CFO\TIPOOPER.DBF"
	ELSE
		dbf_TIP         =  UPobterPath("TIPOOPER",.F.)+"TIPOOPER.DBF"
	ENDIF


    *--------------------------------------------------------*
	
	LSarqtmp 	= "" 			&& EX: C:\TMP\TMP0001
	LSaliastmp 	= "APR" 		&&     TMP001
	LSarqtmp = UPopentmp(wp_dirtmp,LSarqtmp,LSaliastmp,1)
	IF EMPTY(LSaliastmp)
		WAIT WINDOW 'NÆo Foi Possivel Definir Arquivo Temporario'
		RETURN
	ENDIF
	dbf_APURA    = wp_dirtmp+LSaliastmp+".DBF"
	als_APURA    = LSaliastmp


    *--------------------------------------------------------*
	
	LSarqtmp 	= "" 			&& EX: C:\TMP\TMP0001
	LSaliastmp 	= "NFS" 		&&     TMP001
	LSarqtmp = UPopentmp(wp_dirtmp,LSarqtmp,LSaliastmp,1)
	IF EMPTY(LSaliastmp)
		WAIT WINDOW 'NÆo Foi Possivel Definir Arquivo Temporario'
		RETURN
	ENDIF
	dbf_NFSTMP    = wp_dirtmp+LSaliastmp+".DBF"
	als_NFSTMP    = LSaliastmp

	*----------------------------------------------------------*

	LSarqtmp 	= "" 			&& EX: C:\TMP\TMP0001
	LSaliastmp 	= "ITM" 		&&     TMP001
	LSarqtmp = UPopentmp(wp_dirtmp,LSarqtmp,LSaliastmp,1)
	IF EMPTY(LSaliastmp)
		WAIT WINDOW 'NÆo Foi Possivel Definir Arquivo Temporario'
		RETURN
	ENDIF
	dbf_ITMTMP    = wp_dirtmp+LSaliastmp+".DBF"
	als_ITMTMP    = LSaliastmp

	*----------------------------------------------------------*

	LSarqtmp 	= "" 			&& EX: C:\TMP\TMP0001
	LSaliastmp 	= "TIP" 		&&     TMP001
	LSarqtmp = UPopentmp(wp_dirtmp,LSarqtmp,LSaliastmp,1)
	IF EMPTY(LSaliastmp)
		WAIT WINDOW 'NÆo Foi Possivel Definir Arquivo Temporario'
		RETURN
	ENDIF
	dbf_TIPTMP    = wp_dirtmp+LSaliastmp+".DBF"
	als_TIPTMP    = LSaliastmp


  	SAVE SCREEN TO VLwinDOW


	SET TALK ON

	*----------------------------------------------------------*
	*    GERAR ARQ. RESUMO CONTENDO SO AS NOTAS DO PERIODO E DA
	* EMPRESA SELECIONADA PARA ACELERAR OS OUTROS SELECTs
	*----------------------------------------------------------*

		SELECT ;
		      CH_OPERA+CH_PRODU+CH_MOTIV+;
              CH_DESTI+CH_CONTR+CH_CONDI+TIPO AS KEY_TIPO,;
   	        EMPRESA, NOTA , SERIE, DATA, HORA, UF, CFO, ;
	        STATUS, OPERACAO, CUPOM, TIPO , FAVORECIDO, ;
			TOTSERVICO, BASE_ISS,  ALIQ_ISS, VLR_ISS, ;
			BASE_ICMS,	ALIQ_ICMS, VLR_ICMS, ;
			BASE_SBBRT, BASE_SUBS, ICMS_SUBS, ;
			BASE_ISENT, BASE_OUTR, BASE_ISIPI, BASE_IPI,  VLR_IPI, ;
			TOTPRODUTO, VLRFRETE, VLRSEGURO, VLRDESPES, ;
			TOTAL_NOTA ;	
		FROM &dbf_NFS ;
		WHERE   	empresa = M.EMPRESA;
			AND data >= M.dt_inicio AND  data <= M.dt_fim ;
			AND ch_opera <> "5" ;
	    INTO TABLE &dbf_NFSTMP

	*----------------------------------------------------------*
	*  SELECIONANDO ITENS DO MOVIMENTO  E ITENS DA NF DE SAIDA
	*----------------------------------------------------------*

	SELECT ;
         CH_OPERA+CH_PRODU+CH_MOTIV+;
              CH_DESTI+CH_CONTR+CH_CONDI+TIPO AS KEY_TIPO,;
	       EMPRESA, NOTA , SERIE, DATA, CODIGO,TP_MERCAD, VLRVENDA,QTDE,;
            CFO, OPERACAO, FAVORECIDO,;
			TIPO,BASE_ISS,  ALIQ_ISS,  VLR_ISS, ;
			BASE_CALC,	ALIQ_ICMS, VLR_ICMS, ;
			BASE_SBBRT, BASE_SUBS, ICMS_SUBS, ;
			BASE_ISENT, BASE_OUTR, BASE_ISIPI, BASE_IPI,  VLRIPI ;
		FROM &dbf_ITM ;
		WHERE  	!(ch_opera $"56") ;
			AND empresa = m.empresa ;
			AND data >= dt_inicio ;
			AND data <= dt_fim ;		
	    INTO TABLE &dbf_ITMTMP

	*---------------------------------------------------------------*

     SELECT CH_OPERA+CH_PRODU+CH_MOTIV+;
              CH_DESTI+CH_CONTR+CH_CONDI+TIPO AS KEY_TIPO,;
            * FROM &dbf_TIP ;
        WHERE PROCESSO $ "Ss" ;
	    INTO TABLE &dbf_TIPTMP

	*---------------------------------------------------------------*

	*******************************************************************



   SELECT NF.EMPRESA, NF.NOTA, NF.SERIE, NF.FAVORECIDO, NF.TIPO,;
		  ULdefCfo(NF.empresa,NF.tipo,it.tp_mercad,"SAIDA") as SET_CFO,;
		  SUM(IT.vlrvenda+IT.icms_subs+IT.vlripi) AS TOTAL_NOTA,;
	  	  SUM(IT.base_calc) AS BASE_ICMS,;
	  	  SUM(IT.Base_calc*IT.aliq_icms/100) AS VLR_ICMS,;
	 	  SUM(IT.base_isent+IT.vlripi) AS BASE_ISENT ,;
		  SUM(IT.base_outr+IT.base_iss) AS BASE_OUTR, ;
	  	  SUM(IT.icms_subs) AS ICMS_SUBS;
   	FROM  &DBF_NFStmp      NF,;
   	      &DBF_TIPtmp       TP,;
   	      &DBF_ITMtmp       IT ;
    WHERE ;
            NF.DATA >= m.dt_inicio ;
        AND NF.DATA <= m.dt_fim ;
        AND NF.EMPRESA = m.empresa;
        AND NF.status           = 1 ;
        AND NF.operacao         = "S" ;
   		AND !(NF.TIPO $ "CPM/ETI/ETE");
 	    AND TP.KEY_TIPO = NF.KEY_TIPO;
 	    AND IT.KEY_TIPO = NF.KEY_TIPO;
   		AND IT.EMPRESA          = NF.EMPRESA    ;
   		AND IT.NOTA             = NF.NOTA         ;
   		AND IT.FAVORECIDO       = NF.FAVORECIDO ;
   ORDER BY NF.EMPRESA, NF.NOTA, NF.SERIE, NF.FAVORECIDO, NF.TIPO, SET_CFO;
   GROUP BY NF.EMPRESA, NF.NOTA, NF.SERIE, NF.FAVORECIDO, NF.TIPO, SET_CFO ;
   INTO CURSOR LIV_2



	SELECT 	"SAIDA  "            AS OPERACAO,;
		SET_CFO AS CFO,;
        SUM(NF.TOTAL_NOTA)        AS TOT_NF,;
	  	SUM(NF.base_icms)         AS BS_ICMS,;
	  	SUM(NF.VLR_ICMS)          AS VLR_ICMS,;
		SUM(NF.base_isent)        AS BS_ISEN ,;
		SUM(NF.base_outr)         AS BS_OUTR, ;
	  	SUM(NF.icms_subs)         AS ICMS_SUBS;
   	FROM  LIV_2        NF;
    ORDER BY CFO;
    GROUP BY CFO;
    INTO CURSOR LIVROSAI

    SELE LIV_2
    USE


	*------------------------------------------------------------*
	* APURACAO ICM ENTRADA
	*------------------------------------------------------------*
	SELECT  NF.EMPRESA, NF.NOTA, NF.SERIE, NF.FAVORECIDO, NF.TIPO,;
 	    ULdefCfo(NF.empresa,NF.tipo,it.tp_mercad,"ENTRADA") as SET_CFO,;
        NF.TOTAL_NOTA,;
	  	IIF(NF.BASE_SUBS = 0,NF.base_icms,NF.base_icms*0)     AS BASE_ICMS,;
	  	IIF(NF.BASE_SUBS = 0,NF.VLR_ICMS,NF.VLR_ICMS*0)      AS VLR_ICMS,;
		NF.base_isent,;
		NF.base_outr, ;
	  	NF.icms_subs;
   	FROM  &dbf_NFE      NF,;
   	      &DBF_TIP       TP,;
   	      &dbf_ITENT       IT ;
    WHERE ;
            NF.DATA >= m.dt_inicio ;
        AND NF.DATA <= m.dt_fim ;
        AND NF.EMPRESA = m.empresa;
        AND LEFT(NF.situacao,1) = "C" ;
        AND NF.CH_OPERA         <> "5" ;
   		AND NF.TIPO             = TP.TIPO ;
   	    AND TP.PROCESSO         $ "Ee" ;
   		AND IT.TIPO             = NF.TIPO ;
   		AND IT.EMPRESA          = NF.EMPRESA    ;
   		AND IT.NOTA             = NF.NOTA         ;
   		AND IT.SERIE            = NF.SERIE        ;
   		AND IT.FAVORECIDO       = NF.FAVORECIDO ;
    ORDER BY NF.EMPRESA, NF.NOTA, NF.SERIE, NF.FAVORECIDO, NF.TIPO ;
    GROUP BY NF.EMPRESA, NF.NOTA, NF.SERIE, NF.FAVORECIDO, NF.TIPO ;
    INTO CURSOR LIV_2


	SELECT 	"ENTRADA"            AS OPERACAO,;
		NF.SET_CFO AS CFO,;
        SUM(NF.TOTAL_NOTA)        AS TOT_NF,;
	  	SUM(NF.base_icms)         AS BS_ICMS,;
	  	SUM(NF.VLR_ICMS)          AS VLR_ICMS,;
		SUM(NF.base_isent)        AS BS_ISEN ,;
		SUM(NF.base_outr)         AS BS_OUTR, ;
	  	SUM(NF.icms_subs)         AS ICMS_SUBS;
   	FROM  LIV_2        NF;
    ORDER BY CFO;
    GROUP BY CFO;
    INTO CURSOR LIVROENT

    SELE LIV_2
    USE


	SELECT * FROM LIVROSAI ;
	    UNION ;
    SELECT * FROM LIVROENT into  table &DBF_APURA

	SELECT SUM(vlr_icms) AS VLR_ICMS FROM LIVROSAI INTO CURSOR TMP1
	m.soma_1  = TMP1.vlr_icms
	SELECT SUM(vlr_icms) AS VLR_ICMS FROM LIVROENT  INTO CURSOR TMP1
	m.soma_4  = TMP1.vlr_icms
	SET TALK OFF
	RESTORE SCREEN FROM VLwinDOW


*******************************************************************

RETURN


**********IMPRESSAO

PROCEDURE ULimprel	&& IMPRIME LIVRO DE APURACAO
*******************
*---->   (INICIALIZACAO DO CONTROLE DE STATUS IMPRESSAO)
*******************	
	DO RELINIC.PRG          && INICIA VAR P/ TERMOMETRO
	LFsegue = .t.
	LNregistro = RECNO()
    LNimpressao = RECCOUNT()
	LNimpressos = 0
	GO LNregistro
*******************************************************************
    LSrel = "REL222"      && relatorio padrao p/ impressoras ex: epson
*******************************************************************
	LSorienta  = " WHILE  LFsegue "

	LSopera  = "ENTRADAS"       && PARA TESTE QUEBRA EM ULtestcfo
	DO UPimpressao WITH 	LFLdireciona, LFLagrega, LFLfimagrega
	LFcontinua = LFsegue
***********
	DO RELFIM.PRG          && FIM VAR P/ TERMOMETRO
*-----------------------------
RETURN



PROCEDURE ULimpres	&& IMPRIME RESUMO DE APURACAO
	******************************************************************
	*---->   (INICIALIZACAO DO CONTROLE DE STATUS IMPRESSAO)
	******************************************************************	
	DO RELINIC.PRG          && INICIA VAR P/ TERMOMETRO
	SELE &ALS_APURA
	ZAP
	PACK
	APPEND BLANK
	GO TOP
	LNregistro = RECNO()
    LNimpressao= 0
	LNimpressos= 0
	*******************************************************************
    LSrel 	   = "REL222A"  && relatorio padrao p/ impressoras ex: epson
	*******************************************************************
	LSorienta  = ""
	GO BOTT

	DO UPimpressao WITH 	LFLdireciona, LFLagrega, LFLfimagrega

	LFcontinua = LFsegue
***********
	DO RELFIM.PRG          && FIM VAR P/ TERMOMETRO

RETURN



FUNCTION ULdefCfo
PARAMETERS PrmEmpresa, PrmTipo, PrmTp_mercad,PrmOperacao
PRIVATE LScfo
	=W_DEFPROC("TRIBUTAR.SPR")
	LScfo = TRCFO(PrmEmpresa, PrmTipo, PrmTp_mercad, PrmOperacao)
RETURN(LScfo)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4DC0Z658T           m.empresa WHEN                     º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC222,     Record Number:   80   º
*       º Variable:            m.empresa                          º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Field                              º
*       º Snippet Number:      1                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4dc0z658t     &&  m.empresa WHEN
#REGION 1
ON KEY LABEL ENTER
ON KEY LABEL ESCAPE	KEYBOARD "{END}"
IF LASTKEY() = 15 AND !(isediting)
	KEYBOARD "{ESCAPE}"
ENDIF
RETURN(isediting)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4DC0Z659H           m.empresa VALID                    º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC222,     Record Number:   80   º
*       º Variable:            m.empresa                          º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Field                              º
*       º Snippet Number:      2                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4dc0z659h     &&  m.empresa VALID
#REGION 1
SELECT empresa
SET ORDER TO TAG empresa
IF LASTKEY() = 9
   ON KEY LABEL ESCAPE
   DO loc_dlog WITH .F.
	ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
   IF LASTKEY() = 27
		SELECT empresa
		RETURN .F.
	ENDIF
ELSE
	IF !SEEK(m.empresa)
		SELECT empresa
		RETURN .F.
	ENDIF
ENDIF
m.empresa   = empresa
m.nome_emp  = empresa.nome
m.inscricao = empresa.inscricao
SHOW GET m.empresa
SHOW GET m.nome_emp
SELECT empresa
RETURN .T.


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4DC0Z659R           m.nome_emp WHEN                    º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC222,     Record Number:   81   º
*       º Variable:            m.nome_emp                         º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Field                              º
*       º Snippet Number:      3                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4dc0z659r     &&  m.nome_emp WHEN
#REGION 1
ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
RETURN(.f.)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4DC0Z659X           m.dt_inicio WHEN                   º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC222,     Record Number:   82   º
*       º Variable:            m.dt_inicio                        º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Field                              º
*       º Snippet Number:      4                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4dc0z659x     &&  m.dt_inicio WHEN
#REGION 1
IF isediting
	ON KEY LABEL ESCAPE	KEYBOARD "{END}"
ENDIF
RETURN(isediting)

*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4DC0Z65A4           m.dt_inicio VALID                  º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC222,     Record Number:   82   º
*       º Variable:            m.dt_inicio                        º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Field                              º
*       º Snippet Number:      5                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4dc0z65a4     &&  m.dt_inicio VALID
#REGION 1
m.dt_fim = m.dt_inicio
SHOW GET m.dt_fim
ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
RETURN (.T.)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4DC0Z65AB           m.dt_fim WHEN                      º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC222,     Record Number:   83   º
*       º Variable:            m.dt_fim                           º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Field                              º
*       º Snippet Number:      6                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4dc0z65ab     &&  m.dt_fim WHEN
#REGION 1
ON KEY LABEL ENTER
RETURN(isediting)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4DC0Z65AH           m.db_btn WHEN                      º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC222,     Record Number:   84   º
*       º Variable:            m.db_btn                           º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      7                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4dc0z65ah     &&  m.db_btn WHEN
#REGION 1
ON KEY LABEL ENTER
RETURN(.T.)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4DC0Z65AI           m.db_btn VALID                     º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC222,     Record Number:   84   º
*       º Variable:            m.db_btn                           º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      8                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4dc0z65ai     &&  m.db_btn VALID
#REGION 1
IF LASTKEY() <> 13
	DO SCGC222A.SPR
ENDIF
RETURN .T.


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4DC0Z65AJ           m.cr_btn VALID                     º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC222,     Record Number:   85   º
*       º Variable:            m.cr_btn                           º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      9                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4dc0z65aj     &&  m.cr_btn VALID
#REGION 1
IF LASTKEY() <> 13
	DO SCGC222B.SPR
ENDIF
RETURN .T.


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4DC0Z65B4           m.sld_btn VALID                    º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC222,     Record Number:   86   º
*       º Variable:            m.sld_btn                          º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      10                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4dc0z65b4     &&  m.sld_btn VALID
#REGION 1
IF LASTKEY() <> 13
	DO SCGC222C.SPR
ENDIF
RETURN .T.


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4DC0Z65BA           m.inf_btn VALID                    º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC222,     Record Number:   87   º
*       º Variable:            m.inf_btn                          º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      11                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4dc0z65ba     &&  m.inf_btn VALID
#REGION 1
IF LASTKEY() <> 13
	DO SCGC222D.SPR
ENDIF
RETURN .T.


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4DC0Z65BG           LNpagina WHEN                      º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC222,     Record Number:   88   º
*       º Variable:            LNpagina                           º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Field                              º
*       º Snippet Number:      12                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4dc0z65bg     &&  LNpagina WHEN
#REGION 1
ON KEY LABEL ENTER
RETURN(isediting)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4DC0Z65BM           m.titulo WHEN                      º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC222,     Record Number:   89   º
*       º Variable:            m.titulo                           º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Field                              º
*       º Snippet Number:      13                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4dc0z65bm     &&  m.titulo WHEN
#REGION 1
IF !isediting
	RETURN .F.
ENDIF
m.titulo = "MES/ANO "+;
			 wp_meses(month(m.dt_inicio))+"/"+STR(YEAR(m.dt_fim),4)+;
			 " de "+DTOC(m.dt_inicio)+" a "+DTOC(m.dt_fim)
RETURN .T.

*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4DC0Z65BT           m.grv WHEN                         º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC222,     Record Number:   91   º
*       º Variable:            m.grv                              º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      14                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4dc0z65bt     &&  m.grv WHEN
#REGION 1
ON KEY LABEL SPACEBAR  KEYBOARD "{ENTER}"
RETURN(.T.)

*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4DC0Z65BZ           m.grv VALID                        º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC222,     Record Number:   91   º
*       º Variable:            m.grv                              º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      15                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
		*************** SALVA COMO PARAMETROS PARA PROXIMO RELATO *****

FUNCTION _4dc0z65bz     &&  m.grv VALID
#REGION 1
			LSmes = CHRTRAN(STR(MONTH(m.dt_inicio),2)," ","0")
			LSano = SUBS(STR(YEAR(m.dt_inicio),4),3,2)
			
			LSarq = wp_dirdat+"ICM"+LSano+LSmes+"A"
			SAVE TO &LSarq ALL LIKE linha*

			LSarq = wp_dirdat+"ICM"+LSano+LSmes+"B"
			SAVE TO &LSarq ALL LIKE soma*
			
			LSarq = wp_dirdat+"ICM"+LSano+LSmes+"C"
			SAVE TO &LSarq ALL LIKE aux*

			LSarq = wp_dirdat+"ICM"+LSano+LSmes+"D"
			SAVE TO &LSarq ALL LIKE tot*

			LSarq = wp_dirdat+"ICM"+LSano+LSmes+"E"
			SAVE TO &LSarq ALL LIKE dt*
			
			LSarq = wp_dirdat+"ICM"+LSano+LSmes+"F"
			SAVE TO &LSarq ALL LIKE vlr*
			

		****************************************************************


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4DC0Z65C0           m.rec WHEN                         º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC222,     Record Number:   92   º
*       º Variable:            m.rec                              º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      16                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4dc0z65c0     &&  m.rec WHEN
#REGION 1
ON KEY LABEL SPACEBAR  KEYBOARD "{ENTER}"
RETURN(.T.)

*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4DC0Z65C1           m.rec VALID                        º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC222,     Record Number:   92   º
*       º Variable:            m.rec                              º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      17                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
		*************** BUSCA PARAMETROS PARA PROXIMO RELATO *****
FUNCTION _4dc0z65c1     &&  m.rec VALID
#REGION 1
			ON ERROR TMP=""   && EVITA MENS. DE ERRO QDO ARQ.NAO EXISTIR

			LSmes = CHRTRAN(STR(MONTH(m.dt_inicio),2)," ","0")
			LSano = SUBS(STR(YEAR(m.dt_inicio),4),3,2)
			
			LSarq = wp_dirdat+"ICM"+LSano+LSmes+"A"
			RESTORE FROM  &LSarq ADDITIVE

			LSarq = wp_dirdat+"ICM"+LSano+LSmes+"B"
			RESTORE FROM  &LSarq ADDITIVE
			
			LSarq = wp_dirdat+"ICM"+LSano+LSmes+"C"
			RESTORE FROM  &LSarq ADDITIVE

			LSarq = wp_dirdat+"ICM"+LSano+LSmes+"D"
			RESTORE FROM  &LSarq ADDITIVE

			LSarq = wp_dirdat+"ICM"+LSano+LSmes+"E"
			RESTORE FROM  &LSarq ADDITIVE
			
			LSarq = wp_dirdat+"ICM"+LSano+LSmes+"F"
			RESTORE FROM  &LSarq ADDITIVE
			
			ON ERROR
		****************************************************************
			SHOW GETS


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4DC0Z65CH           m.imp_btn VALID                    º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC222,     Record Number:   93   º
*       º Variable:            m.imp_btn                          º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      18                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4dc0z65ch     &&  m.imp_btn VALID
#REGION 1
	SELE  &ALS_APURA
	GO TOP
***************************
	LFLdireciona  = .F. && Ativa PRTSETUP para direcionar impressao DEF(.T.)
	LFLagrega 	  = .T. && Agrega o ??.REL em ??.AGR			    DEF(.F.)
	LFLfimagrega  = .F. && Qdo. Estiver agregando => encerra        DEF(.F.)
**********************************************************************
	LFcontinua = .t.  			&& CAPTURA O VALOR DE LFsegue
**************************>>> RELATORIO GERAL <<<*********************

	LNpagina = LNpagina - 1   && DESCONTA O VLR. INICIAL DE _PAGENO


	DO ULimprel		&& REL222  LIVRO DE APURACAO
	
	LNpagina = LNpagina + _PAGENO - 1 	&& DAR SEQUENCIA AO N. PAGINA

	LFLfimagrega  = .T. && ENCERRA AGREGACAO DE RELATORIOS
	LFLdireciona  = .T.

	DO ULimpres		&& REL222A  RESUMO POR CFO

*****
	SELE  &ALS_APURA
	USE
	SHOW WINDOW SCGC222 TOP
	SHOW GET m.imp_btn DISABLE
	SHOW GET m.rec DISABLE
	SHOW GET m.grv DISABLE

RETURN



*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4DC0Z65CP           m.canc_btn VALID                   º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC222,     Record Number:   94   º
*       º Variable:            m.canc_btn                         º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      19                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4dc0z65cp     &&  m.canc_btn VALID
#REGION 1
CLEAR GETS
CLEAR READ
isediting = .f.
RETURN .T.