*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º 27/04/2015           CLIENTES.SPR              10:39:44 º
*       º                                                         º
*       ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
*       º                                                         º
*       º Author's Name                                           º
*       º                                                         º
*       º Copyright (c) 2015 Company Name                         º
*       º Address                                                 º
*       º City,     Zip                                           º
*       º                                                         º
*       º Description:                                            º
*       º This program was automatically generated by GENSCRN.    º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½


#REGION 0
REGIONAL m.currarea, m.talkstat, m.compstat

IF SET("TALK") = "ON"
	SET TALK OFF
	m.talkstat = "ON"
ELSE
	m.talkstat = "OFF"
ENDIF
m.compstat = SET("COMPATIBLE")
SET COMPATIBLE FOXPLUS

*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º                MS-DOS Window definitions                º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º         CLIENTES/MS-DOS Setup Code - SECTION 2          º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 1
RETURN

*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º          CLIEN_R/MS-DOS Setup Code - SECTION 2          º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 2
RETURN

*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º              CLIENTES/MS-DOS Screen Layout              º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 1
@ 6,5 GET CLVerifyInst ;
	PICTURE "@*HN CLVerifyInst - Verifica Instancia" ;
	SIZE 1,35,1 ;
	DEFAULT 1 ;
	VALID _4c60mupml()
@ 7,8 GET CLCreate ;
	PICTURE "@*HN CLCreate - Instancia" ;
	SIZE 1,22,1 ;
	DEFAULT 1 ;
	VALID _4c60mupof()
@ 16,8 GET CLDestroi ;
	PICTURE "@*HN CLDestroi - Desinstancia" ;
	SIZE 1,26,1 ;
	DEFAULT 1 ;
	VALID _4c60mupog()
@ 8,10 GET CLReadProp ;
	PICTURE "@*HN CLReadProp - Carga do Vetor com Base na Tabela" ;
	SIZE 1,48,1 ;
	DEFAULT 1 ;
	VALID _4c60mupoh()
@ 9,10 GET CLSetDerivadas ;
	PICTURE "@*HN CLSetDerivadas - Carga de Propriedades Derivadas" ;
	SIZE 1,51,1 ;
	DEFAULT 1 ;
	VALID _4c60mupoi()
@ 12,10 GET CLSetPropVT ;
	PICTURE "@*HN CLSetPropVT - Set o Valor de uma Propriedade do Vetor" ;
	SIZE 1,55,1 ;
	DEFAULT 1 ;
	VALID _4c60mupoj()
@ 13,10 GET CLGetPropVT ;
	PICTURE "@*HN CLGetPropVT - Get o Valor de uma Propriedade do Vetor" ;
	SIZE 1,55,1 ;
	DEFAULT 1 ;
	VALID _4c60mupok()
@ 3,2 GET CLChk_Identidade ;
	PICTURE "@*HN CLChk_Identidade - Checagem de Identidade do Objeto" ;
	SIZE 1,53,1 ;
	DEFAULT 1 ;
	VALID _4c60mupol()
@ 2,2 GET CLFind ;
	PICTURE "@*HN CLFind - Localiza Registro Com Base nas Propriedades" ;
	SIZE 1,54,1 ;
	DEFAULT 1 ;
	VALID _4c60mupom()
@ 19,2 GET CLGetFieldValue ;
	PICTURE "@*HN CLGetFieldValue - Retorna o valor do Campo informado" ;
	SIZE 1,54,1 ;
	DEFAULT 1 ;
	VALID _4c60muppy()
@ 18,2 GET CL_Refresh ;
	PICTURE "@*HN CL_Refresh - Forca Atualiza‡ao Objeto" ;
	SIZE 1,39,1 ;
	DEFAULT 1 ;
	VALID _4c60muppz()
@ 23,2 SAY "*-------------------------------------------------------------------*" ;
	SIZE 1,69, 0
@ 25,2 GET CLLerRegistro ;
	PICTURE "@*HN CLLerRegistro - Le Registro e Carrega OBJ" ;
	SIZE 1,43,1 ;
	DEFAULT 1 ;
	VALID _4c60mupq0()
@ 15,10 GET CLWriteProp ;
	PICTURE "@*HN CLWriteProp - Grava do Vetor para Base na Tabela" ;
	SIZE 1,50,1 ;
	DEFAULT 1 ;
	VALID _4c60mupq1()
@ 26,2 GET CLSalvarRegistro ;
	PICTURE "@*HN CLSalvarRegistro - Salva Registro" ;
	SIZE 1,35,1 ;
	DEFAULT 1 ;
	VALID _4c60mupq2()
@ 24,2 GET CLExiste ;
	PICTURE "@*HN CLExiste - Le Registro nao carrega o OBJ e Retorna se existe" ;
	SIZE 1,62,1 ;
	DEFAULT 1 ;
	VALID _4c60mupq3()
@ 30,2 SAY "*-------------------------------------------------------------------*" ;
	SIZE 1,69, 0
@ 20,2 GET CLGetAlias ;
	PICTURE "@*HN CLGetAlias - Retorna Alias da area em que foi abertaa tabela" ;
	SIZE 1,62,1 ;
	DEFAULT 1 ;
	VALID _4c60mupq4()
@ 10,10 GET CLSetConfig ;
	PICTURE "@*HN CLSetConfig - Carga Propriedades de Configuracao/Parametros" ;
	SIZE 1,61,1 ;
	DEFAULT 1 ;
	VALID _4c60mupq5()
@ 27,2 GET CLBtnVal ;
	PICTURE "@*HN CLBtnVal - Trata Comandos de navegacao" ;
	SIZE 1,40,1 ;
	DEFAULT 1 ;
	VALID _4c60mupq6()
@ 4,5 GET CLTrtChvCPFCNPJINS ;
	PICTURE "@*HN CLTrtChvCPFCNPJINS - Trata Acesso por Chave por CPF/CNPJ e INSCRICAO" ;
	SIZE 1,70,1 ;
	DEFAULT 1 ;
	VALID _4c60mupqd()
@ 31,2 GET CLBuscaNOMEAprox ;
	PICTURE "@*HN CLBuscaNOMEAprox - Busca aproximada por nome" ;
	SIZE 1,46,1 ;
	DEFAULT 1 ;
	VALID _4c60mupql()
@ 17,2 SAY "*-------------------------------------------------------------------*" ;
	SIZE 1,69, 0
@ 32,2 SAY "*-------------------------------------------------------------------*" ;
	SIZE 1,69, 0
@ 22,2 GET CLScatter ;
	PICTURE "@*HN CLScatter - Carrega Var de Memoria" ;
	SIZE 1,36,1 ;
	DEFAULT 1 ;
	VALID _4c60mupqr()
@ 28,2 GET CLView ;
	PICTURE "@*HN CLView - Visualisa BROWSE" ;
	SIZE 1,28,1 ;
	DEFAULT 1 ;
	VALID _4c60mupqy()
@ 29,4 GET CLLOCATE ;
	PICTURE "@*HN CLLOCATE - Apoio a CLView - Visualisa BROWSE" ;
	SIZE 1,46,1 ;
	DEFAULT 1 ;
	VALID _4c60mupr4()
@ 0,1 SAY "CLAS:V-1.0 => IMPLEMENTA NAVEGACAO E MANUTENCAO COMPLETA (BASE=CLIENTES)" ;
	SIZE 1,72, 0
@ 1,1 SAY "*---------------------------------------------------------------------*" ;
	SIZE 1,71, 0
@ 33,2 GET CLAtribuiIBGE ;
	PICTURE "@*HN CLAtribuiIBGE - Atribui Codigo Ibge as clientes Ja Cadastrados" ;
	SIZE 1,64,1 ;
	DEFAULT 1 ;
	VALID _4c60mupra()
@ 21,2 GET CLGSetAreaAlias ;
	PICTURE "@*HN CLGSetAreaAlias - Seleciona area da tabela " ;
	SIZE 1,45,1 ;
	DEFAULT 1 ;
	VALID _4c60mupt0()
@ 34,2 SAY "*-------------------------------------------------------------------*" ;
	SIZE 1,69, 0




*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º              CLIEN_R/MS-DOS Screen Layout               º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 2
@ 3,2 GET CLGetUFOrigem ;
	PICTURE "@*HN CLGetUFOrigem - Retorna UFs (Origem da NFE)" ;
	SIZE 1,45,1 ;
	DEFAULT 1 ;
	VALID _4c60mupt1()
@ 5,2 GET CLLocCli ;
	PICTURE "@*HN CLLocCli-Localiza Cliente" ;
	SIZE 1,27,1 ;
	DEFAULT 1 ;
	VALID _4c60mupt2()
@ 9,2 GET CLSetControleCredito ;
	PICTURE "@*HN CLSetControleCredito - Registrar Aleracao Limite de Credito" ;
	SIZE 1,61,1 ;
	DEFAULT 1 ;
	VALID _4c60mupt3()
@ 10,2 GET CLObterVlrAlteradoCredito ;
	PICTURE "@*HN CLObterVlrAlteradoCredito - Retorna o Valor (+) ou (-) alterado no Credito" ;
	SIZE 1,76,1 ;
	DEFAULT 1 ;
	VALID _4c60mupt4()
@ 11,2 GET CLSetUltAtendimento ;
	PICTURE "@*HN CLSetUltAtendimento - Registra data do ultimo atendimento" ;
	SIZE 1,59,1 ;
	DEFAULT 1 ;
	VALID _4c60mupt5()
@ 12,2 GET CLSQLSemFidelizacao ;
	PICTURE "@*HN CLSQLSemFidelizacao - SQL Clientes Novos e Fidelizados Semanal" ;
	SIZE 1,64,1 ;
	DEFAULT 1 ;
	VALID _4c60mupt6()
@ 13,2 GET CLSQLMesFidelizacao ;
	PICTURE "@*HN CLSQLMesFidelizacao - SQL Clientes Novos e Fidelizados Mensal" ;
	SIZE 1,63,1 ;
	DEFAULT 1 ;
	VALID _4c60mupt7()
@ 15,6 GET CLCalc_Cgc ;
	PICTURE "@*HN CLCalc_Cgc    - Teste CGC" ;
	SIZE 1,27,1 ;
	DEFAULT 1 ;
	VALID _4c60mupun()
@ 17,2 GET CLInscricao ;
	PICTURE "@*HN CLInscricao" ;
	SIZE 1,13,1 ;
	DEFAULT 1 ;
	VALID _4c60mupuo()
@ 17,16 GET CLRO_Inscr ;
	PICTURE "@*HN CLRO_Inscr" ;
	SIZE 1,12,1 ;
	DEFAULT 1 ;
	VALID _4c60mupup()
@ 17,28 GET CLMG_Inscr ;
	PICTURE "@*HN CLMG_Inscr" ;
	SIZE 1,12,1 ;
	DEFAULT 1 ;
	VALID _4c60mupuq()
@ 17,40 GET CLBA_Inscr ;
	PICTURE "@*HN CLBA_Inscr" ;
	SIZE 1,12,1 ;
	DEFAULT 1 ;
	VALID _4c60mupur()
@ 17,52 GET CLPR_Inscr ;
	PICTURE "@*HN CLPR_Inscr" ;
	SIZE 1,12,1 ;
	DEFAULT 1 ;
	VALID _4c60mupus()
@ 17,64 GET CLRR_Inscr ;
	PICTURE "@*HN CLRR_Inscr" ;
	SIZE 1,12,1 ;
	DEFAULT 1 ;
	VALID _4c60mupw5()
@ 18,16 GET CLSP_Inscr ;
	PICTURE "@*HN CLSP_Inscr" ;
	SIZE 1,12,1 ;
	DEFAULT 1 ;
	VALID _4c60mupw6()
@ 18,28 GET CLDF_Inscr ;
	PICTURE "@*HN CLDF_Inscr" ;
	SIZE 1,12,1 ;
	DEFAULT 1 ;
	VALID _4c60mupw7()
@ 18,40 GET CLTO_AntigaInscr ;
	PICTURE "@*HN CLTO_AntigaInscr" ;
	SIZE 1,18,1 ;
	DEFAULT 1 ;
	VALID _4c60mupw8()
@ 18,58 GET CLTO_NovaInscr ;
	PICTURE "@*HN CLTO_NovaInscr" ;
	SIZE 1,16,1 ;
	DEFAULT 1 ;
	VALID _4c60mupw9()
@ 4,2 GET CLItensAdq ;
	PICTURE "@*HN CLItensAdq - Cosulta itens adiquiridos pelo Cliente (Param PLACA)" ;
	SIZE 1,67,1 ;
	DEFAULT 1 ;
	VALID _4c60mupwa()
@ 6,2 GET CLVldCli ;
	PICTURE "@*HN CLVldCli-Valida  Cliente" ;
	SIZE 1,27,1 ;
	DEFAULT 1 ;
	VALID _4c60mupwb()
@ 7,2 GET CLimpARCA ;
	PICTURE "@*HN CLimpARCA - Importa registro do ARCA" ;
	SIZE 1,38,1 ;
	DEFAULT 1 ;
	VALID _4c60mupxo()
@ 14,2 GET CLVld_CPF_CNPJ ;
	PICTURE "@*HN CLVld_CPF_CNPJ - Valida CPF ou CNPJ" ;
	SIZE 1,37,1 ;
	DEFAULT 1 ;
	VALID _4c60mupxp()
@ 16,2 GET CLDef_TipoPessoa ;
	PICTURE "@*HN CLDef_TipoPessoa - Define se Pessoa Fisica ou Juridica" ;
	SIZE 1,56,1 ;
	DEFAULT 1 ;
	VALID _4c60mupxq()
@ 2,2 SAY "*-------------------------------------------------------------------*" ;
	SIZE 1,69, 0
@ 23,5 GET CLEsperaRspCad ;
	PICTURE "@*HN CLEsperaRspCad - Executa CLBuscaRspCad Enquanto nao houver resposta" ;
	SIZE 1,69,1 ;
	DEFAULT 1 ;
	VALID _4c60mupxr()
@ 24,8 GET CLBuscaRspCad ;
	PICTURE "@*HN CLBuscaRspCad-Busca Arq e Lˆ conteudo Resposta Cad" ;
	SIZE 1,52,1 ;
	DEFAULT 1 ;
	VALID _4c60mupxs()
@ 22,2 GET CLImportaCad ;
	PICTURE "@*HN CLImportaCad - Importa Cadastro ORION" ;
	SIZE 1,39,1 ;
	DEFAULT 1 ;
	VALID _4c60mupxt()
@ 21,2 SAY "--Importar Dados Orion Cadastro --------" ;
	SIZE 1,40, 0
@ 25,11 GET CLImpCadOrion ;
	PICTURE "@*HN CLImpCadOrion - Exec. import arq EXPCLIEN.TXT p/ CLIENTES.DBF" ;
	SIZE 1,63,1 ;
	DEFAULT 1 ;
	VALID _4c60mupz5()



READ


#REGION 0
IF m.talkstat = "ON"
	SET TALK ON
ENDIF
IF m.compstat = "ON"
	SET COMPATIBLE ON
ENDIF


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º              CLIENTES/MS-DOS Cleanup Code               º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 1

RETURN








********************************------------***************************
* ROTINAS COPIADAS DA BIBLIOTECA ROTESTOQ
*----------------------------------------------------------------------*
*****************************************************************

********************************************************************
*	UEvendas => Rotina para Verificacao das vendas de um produto
*				solicitado em um periodo
*
*	CHAMADO por SCGC800 : Verificacao de Previsao X Venda Real
*				OBJ_ROL1: Apuracao de Venda real no Periodo
*
********************************************************************

*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º               CLIEN_R/MS-DOS Cleanup Code               º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 2

RETURN








********************************------------***************************
* ROTINAS COPIADAS DA BIBLIOTECA ROTESTOQ
*----------------------------------------------------------------------*
*****************************************************************

********************************************************************
*	UEvendas => Rotina para Verificacao das vendas de um produto
*				solicitado em um periodo
*
*	CHAMADO por SCGC800 : Verificacao de Previsao X Venda Real
*				OBJ_ROL1: Apuracao de Venda real no Periodo
*
********************************************************************


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º  CLIENTES/MS-DOS Supporting Procedures and Functions    º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 1
FUNCTION UEvendas
	PARAMETERS LNempresa,LSclas,LScodigo,LDdtini,LDdtfim,LNemdias,;
				LNqtvenda,LNqtentra,LNvlrvenda
	
	=W_DEFPROC("rotinas.prg")
	*********************************************************************
	PRIVATE ALL
	LSalias 	= ALIAS()

	LNqtvenda   = 0
	LNqtentra	= 0
	LNvlrvenda  = 0

	LNacmqtvenda   	= 0		&& ACUMULAR VLR DO PROD. PRINCIPAL E DO ANEXO
	LNacmqtentra	= 0		&& ACUMULAR VLR DO PROD. PRINCIPAL E DO ANEXO
	LNacmvlrvenda  	= 0		&& ACUMULAR VLR DO PROD. PRINCIPAL E DO ANEXO

	*********************>>> REGISTRO DE SAIDAS <<<*********************
	*
	*   O saldo formado no so e considerado ate a 2/3 do
	* do periodo devido a pouca influencia nas vendas do periodo
	* das entradas do 1/3 restante
	*
	********************************************************************
	LDdtfimsld = LDdtini 		 		&& data para referenciar saldo apuradao
	LNdiassld  = INT(LNemdias / 3)* 2  && para apurar o saldo formado
							 			&& ate metade do periodo
	LNctrdias = 0
	DO WHILE LNctrdias <= LNdiassld
		IF DOW(LDdtfimsld) <> 1
			LNctrdias = LNctrdias +1
		ENDIF
		LDdtfimsld = LDdtfimsld + 1
	ENDDO
	*******************************************************************
	DO UEvervendas WITH LDdtini,LDdtfim, LNempresa, LScodigo,;
			LDdtfimsld,LNqtvenda,LNqtentra,LNvlrvenda

	LNacmqtvenda   	= LNqtvenda
	LNacmqtentra	= LNqtentra
	LNacmvlrvenda  	= LNvlrvenda

	*******************************************************************
	SELE grupoanx
	SET ORDER TO TAG classifica
	SEEK LSclas
	IF FOUND()
		*******************************************************************
		DO UEvervendas WITH LDdtini,LDdtfim, LNempresa,;
				grupoanx.codanx,;
				LDdtfimsld,LNqtvenda,LNqtentra,LNvlrvenda
		LNacmqtvenda   	= LNacmqtvenda  + LNqtvenda
		LNacmqtentra	= LNacmqtentra  + LNqtentra
		LNacmvlrvenda  	= LNacmvlrvenda + LNvlrvenda
		*******************************************************************
	ENDIF	
	LNqtvenda 	=	LNacmqtvenda
	LNqtentra	=	LNacmqtentra
	LNvlrvenda	=	LNacmvlrvenda

	IF !EMPTY(LSalias)
		SELECT &LSalias
	ENDIF
RETURN

********************************************************************

PROCEDURE UEvervendas
	PARAMETERS  LDdtini,LDdtfim, LNempresa, LScodigo,LDdtfimsld,;
				LNqtvenda,LNqtentra,LNvlrvenda,LFdevolucao
	******************************************************************
	*	LFdevolucao	= .F. => Processa as devolucoes abatendo nas vendas
	*	              .T. => Nao abate devolucoes nas vendas
	*
	*	LNempresa 	= 999 => FAZ COM QUE A ROTINA LEVANDE  DADOS DE TODAS
	*						EMPRESAS REGISTRADAS NO ARQ. EMPRESA
	*******************************************************************
	=W_DEFPROC("rotinas.prg")
	PRIVATE ALL
	LSalias 	= ALIAS()
	LNqtvenda   = 0
	LNqtentra	= 0
	LNvlrvenda  = 0

	SELE empresa
	SET ORDER TO TAG empresa
	IF LNempresa = 999
		GO TOP
	ELSE
		SEEK LNempresa
	ENDIF
	DO WHILE !EOF() AND (LNempresa = 999 OR LNempresa = empresa.empresa)
		SELE itemmov
		SET ORDER TO TAG movimento
		SET NEAR ON
		SEEK STR(empresa.empresa,3)+LScodigo+DTOS(LDdtini)
		SET NEAR OFF
		DO WHILE itemmov.data <= LDdtfim AND ;
				 itemmov.empresa = empresa.empresa AND ;
				 itemmov.codigo  = LScodigo
			IF LEFT(itemmov.operacao,1) = 'S' AND itemmov.ch_opera = "1" 	
			 	LNvlrvenda = LNvlrvenda + itemmov.vlrvenda
				IF itemmov.movestq = "S"
				 	LNqtvenda  = LNqtvenda  + itemmov.qtde
				ENDIF
			ENDIF
			IF !LFdevolucao  && ABATER DEVOLUCOES
				IF LEFT(itemmov.operacao,1) = 'E' AND itemmov.ch_opera = "4" AND ;
				    itemmov.movestq = "S"
				 	LNvlrvenda = LNvlrvenda - itemmov.vlrvenda
					IF (LNqtvenda  - itemmov.qtde) >=  0
				 		LNqtvenda  = LNqtvenda  - itemmov.qtde
					ENDIF
				ENDIF
			ENDIF
		IF itemmov.data <= LDdtfimsld AND LEFT(itemmov.operacao,1) = 'E' ;
				AND itemmov.ch_opera <> "4" AND itemmov.movestq = "S"
				 	LNqtentra  = LNqtentra  + itemmov.qtde
		ENDIF
			***********************************************************
			*  CASO A MERCADORIA SAI POR TRANSFERENCIA OU POR MOV. QUE NAO
			* SEJA VENDA ELA E DESCONSIDERADA
			* DAS ENTRADAS POIS NAO ESTA DESTINADA AO ESTOQUE DE VENDA
			***********************************************************
			IF LEFT(itemmov.operacao,1) = 'S' AND ;
					itemmov.ch_opera <> "1"	&& SAIDAS DEVERSAS DA VENDA
				 IF itemmov.movestq = "S"
					 	LNqtentra  = LNqtentra  - itemmov.qtde
				 ENDIF
				 IF LNqtentra < 0
				 	LNqtentra = 0
				 ENDIF
			ENDIF
			SKIP
		ENDDO	
		IF LNempresa <> 999		&& PESQUISA SO NA EMPRESA INFORMADA
			EXIT
		ENDIF
		SELE empresa
		SKIP
	ENDDO
	IF !EMPTY(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(0)




**********************************************************************
* FUNCTION UEleanexado : Retorna o Codigo ou Codigo Anexado ao Codigo
*						Passado em Parametro
*		LSclas		=>	Codigo a Ser Verificado
*		LSresposta	=>  Indica qual a resposta desejad
*					"ANEXO" = Responder se o Produto Possui algum item
*							Anexado a ele
*					"ANEXADO" = Responder se o Produto esta ANEXADO a
*							outro
*					"QUALQUER"= Responder se existe vinculo em qualqer
*							sentido
***********************************************************************

FUNCTION UEleanexado
PARAMETERS LSclas,LSpergunta
	PRIVATE LSalias, LSresposta

	=W_DEFPROC("rotinas.prg")

	PRIVATE LFerro
	LSalias = ALIAS()

	LSresposta = ""
    SELE grupoanx
	DO CASE
		CASE LSpergunta = "ANEXO"
			SET ORDER TO TAG classifica
			SEEK LSclas
			IF FOUND()
				LSresposta = grupoanx.codanx	&& E ANEXO DO CODIGO INFORMADO
			ENDIF
		CASE LSpergunta = "ANEXADO"
			SET ORDER TO TAG clasanx
			SEEK LSclas
			IF FOUND()
				LSresposta = grupoanx.codanx	&& E ANEXO DO CODIGO INFORMADO
			ENDIF
		CASE LSpergunta = "QUALQUER"
			LSresposta = UEleanexado(LSclas,"ANEXO")
			IF EMPTY(LSresposta)
				LSresposta = UEleanexado(LSclas,"ANEXADO")
			ENDIF
	ENDCASE
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(LSresposta)



*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º   CLIEN_R/MS-DOS Supporting Procedures and Functions    º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 2
FUNCTION UEvendas
	PARAMETERS LNempresa,LSclas,LScodigo,LDdtini,LDdtfim,LNemdias,;
				LNqtvenda,LNqtentra,LNvlrvenda
	
	=W_DEFPROC("rotinas.prg")
	*********************************************************************
	PRIVATE ALL
	LSalias 	= ALIAS()

	LNqtvenda   = 0
	LNqtentra	= 0
	LNvlrvenda  = 0

	LNacmqtvenda   	= 0		&& ACUMULAR VLR DO PROD. PRINCIPAL E DO ANEXO
	LNacmqtentra	= 0		&& ACUMULAR VLR DO PROD. PRINCIPAL E DO ANEXO
	LNacmvlrvenda  	= 0		&& ACUMULAR VLR DO PROD. PRINCIPAL E DO ANEXO

	*********************>>> REGISTRO DE SAIDAS <<<*********************
	*
	*   O saldo formado no so e considerado ate a 2/3 do
	* do periodo devido a pouca influencia nas vendas do periodo
	* das entradas do 1/3 restante
	*
	********************************************************************
	LDdtfimsld = LDdtini 		 		&& data para referenciar saldo apuradao
	LNdiassld  = INT(LNemdias / 3)* 2  && para apurar o saldo formado
							 			&& ate metade do periodo
	LNctrdias = 0
	DO WHILE LNctrdias <= LNdiassld
		IF DOW(LDdtfimsld) <> 1
			LNctrdias = LNctrdias +1
		ENDIF
		LDdtfimsld = LDdtfimsld + 1
	ENDDO
	*******************************************************************
	DO UEvervendas WITH LDdtini,LDdtfim, LNempresa, LScodigo,;
			LDdtfimsld,LNqtvenda,LNqtentra,LNvlrvenda

	LNacmqtvenda   	= LNqtvenda
	LNacmqtentra	= LNqtentra
	LNacmvlrvenda  	= LNvlrvenda

	*******************************************************************
	SELE grupoanx
	SET ORDER TO TAG classifica
	SEEK LSclas
	IF FOUND()
		*******************************************************************
		DO UEvervendas WITH LDdtini,LDdtfim, LNempresa,;
				grupoanx.codanx,;
				LDdtfimsld,LNqtvenda,LNqtentra,LNvlrvenda
		LNacmqtvenda   	= LNacmqtvenda  + LNqtvenda
		LNacmqtentra	= LNacmqtentra  + LNqtentra
		LNacmvlrvenda  	= LNacmvlrvenda + LNvlrvenda
		*******************************************************************
	ENDIF	
	LNqtvenda 	=	LNacmqtvenda
	LNqtentra	=	LNacmqtentra
	LNvlrvenda	=	LNacmvlrvenda

	IF !EMPTY(LSalias)
		SELECT &LSalias
	ENDIF
RETURN

********************************************************************

PROCEDURE UEvervendas
	PARAMETERS  LDdtini,LDdtfim, LNempresa, LScodigo,LDdtfimsld,;
				LNqtvenda,LNqtentra,LNvlrvenda,LFdevolucao
	******************************************************************
	*	LFdevolucao	= .F. => Processa as devolucoes abatendo nas vendas
	*	              .T. => Nao abate devolucoes nas vendas
	*
	*	LNempresa 	= 999 => FAZ COM QUE A ROTINA LEVANDE  DADOS DE TODAS
	*						EMPRESAS REGISTRADAS NO ARQ. EMPRESA
	*******************************************************************
	=W_DEFPROC("rotinas.prg")
	PRIVATE ALL
	LSalias 	= ALIAS()
	LNqtvenda   = 0
	LNqtentra	= 0
	LNvlrvenda  = 0

	SELE empresa
	SET ORDER TO TAG empresa
	IF LNempresa = 999
		GO TOP
	ELSE
		SEEK LNempresa
	ENDIF
	DO WHILE !EOF() AND (LNempresa = 999 OR LNempresa = empresa.empresa)
		SELE itemmov
		SET ORDER TO TAG movimento
		SET NEAR ON
		SEEK STR(empresa.empresa,3)+LScodigo+DTOS(LDdtini)
		SET NEAR OFF
		DO WHILE itemmov.data <= LDdtfim AND ;
				 itemmov.empresa = empresa.empresa AND ;
				 itemmov.codigo  = LScodigo
			IF LEFT(itemmov.operacao,1) = 'S' AND itemmov.ch_opera = "1" 	
			 	LNvlrvenda = LNvlrvenda + itemmov.vlrvenda
				IF itemmov.movestq = "S"
				 	LNqtvenda  = LNqtvenda  + itemmov.qtde
				ENDIF
			ENDIF
			IF !LFdevolucao  && ABATER DEVOLUCOES
				IF LEFT(itemmov.operacao,1) = 'E' AND itemmov.ch_opera = "4" AND ;
				    itemmov.movestq = "S"
				 	LNvlrvenda = LNvlrvenda - itemmov.vlrvenda
					IF (LNqtvenda  - itemmov.qtde) >=  0
				 		LNqtvenda  = LNqtvenda  - itemmov.qtde
					ENDIF
				ENDIF
			ENDIF
		IF itemmov.data <= LDdtfimsld AND LEFT(itemmov.operacao,1) = 'E' ;
				AND itemmov.ch_opera <> "4" AND itemmov.movestq = "S"
				 	LNqtentra  = LNqtentra  + itemmov.qtde
		ENDIF
			***********************************************************
			*  CASO A MERCADORIA SAI POR TRANSFERENCIA OU POR MOV. QUE NAO
			* SEJA VENDA ELA E DESCONSIDERADA
			* DAS ENTRADAS POIS NAO ESTA DESTINADA AO ESTOQUE DE VENDA
			***********************************************************
			IF LEFT(itemmov.operacao,1) = 'S' AND ;
					itemmov.ch_opera <> "1"	&& SAIDAS DEVERSAS DA VENDA
				 IF itemmov.movestq = "S"
					 	LNqtentra  = LNqtentra  - itemmov.qtde
				 ENDIF
				 IF LNqtentra < 0
				 	LNqtentra = 0
				 ENDIF
			ENDIF
			SKIP
		ENDDO	
		IF LNempresa <> 999		&& PESQUISA SO NA EMPRESA INFORMADA
			EXIT
		ENDIF
		SELE empresa
		SKIP
	ENDDO
	IF !EMPTY(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(0)




**********************************************************************
* FUNCTION UEleanexado : Retorna o Codigo ou Codigo Anexado ao Codigo
*						Passado em Parametro
*		LSclas		=>	Codigo a Ser Verificado
*		LSresposta	=>  Indica qual a resposta desejad
*					"ANEXO" = Responder se o Produto Possui algum item
*							Anexado a ele
*					"ANEXADO" = Responder se o Produto esta ANEXADO a
*							outro
*					"QUALQUER"= Responder se existe vinculo em qualqer
*							sentido
***********************************************************************

FUNCTION UEleanexado
PARAMETERS LSclas,LSpergunta
	PRIVATE LSalias, LSresposta

	=W_DEFPROC("rotinas.prg")

	PRIVATE LFerro
	LSalias = ALIAS()

	LSresposta = ""
    SELE grupoanx
	DO CASE
		CASE LSpergunta = "ANEXO"
			SET ORDER TO TAG classifica
			SEEK LSclas
			IF FOUND()
				LSresposta = grupoanx.codanx	&& E ANEXO DO CODIGO INFORMADO
			ENDIF
		CASE LSpergunta = "ANEXADO"
			SET ORDER TO TAG clasanx
			SEEK LSclas
			IF FOUND()
				LSresposta = grupoanx.codanx	&& E ANEXO DO CODIGO INFORMADO
			ENDIF
		CASE LSpergunta = "QUALQUER"
			LSresposta = UEleanexado(LSclas,"ANEXO")
			IF EMPTY(LSresposta)
				LSresposta = UEleanexado(LSclas,"ANEXADO")
			ENDIF
	ENDCASE
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(LSresposta)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPML           CLVerifyInst VALID                 º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIENTES,     Record Number:    2  º
*       º Variable:            CLVerifyInst                       º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      1                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4c60mupml     &&  CLVerifyInst VALID
#REGION 1
return
*---------------------------------------------------------------*



FUNCTION CLVerifyInst
	
PRIVATE LSpath
	=W_DEFPROC("rotinas.spr")
	LSpath = UPobterPath("Clientes")


	DO CASE

		CASE TYPE("PBClientesAlias") = "U" ;
		   		OR EMPTY(PBClientesAlias) ;
		   		OR !USED(PBClientesAlias)
			=CLCreate()					

		CASE !("CLIENTES.DBF" $ DBF(PBClientesAlias))
				* APOS UM CLOSE DATABASE UM OUTRO DBF FOI
				* ABERTO NA AREA ANTES OCUPADA PELO DBF AVALIADO AKI
				RELEASE PBClientesAlias
			=CLCreate()					


		CASE  !(LSPath $ DBF(PBClientesAlias))
			 	* HOUVE MUDANCA DE DIR BASE
			 	* ELIMINA INSTACIA DE OUTRA BASE
		     	* CRIA INSTANCIA NA NOVA BASE
			=CLDestroi()				
			=CLCreate()					
	ENDCASE

	
RETURN(.t.)



*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPOF           CLCreate VALID                     º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIENTES,     Record Number:    3  º
*       º Variable:            CLCreate                           º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      2                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4c60mupof     &&  CLCreate VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION CLCreate
	=W_DEFPROC("rotinas.spr")
	PRIVATE LSalias
	PRIVATE LSAlsTmp
    PRIVATE LMaxDim
	LSalias		= 	ALIAS()
	
	IF TYPE("PBClientesAlias") <> "U" ;
	   		AND !EMPTY(PBClientesAlias) ;
	   		AND USED(PBClientesAlias)
			RETURN(.T.)
	ENDIF


	PUBLIC PBClientesAlias

	IF USED("Clientes")
	     =NetArqAgain("Clientes")
	     PBClientesAlias     = Alias()
	ELSE
	     =NetArqAgain("Clientes")
	     LSAlsTmp     = Alias()
	     =NetArqAgain("Clientes")
	     PBClientesAlias     = Alias()
		 IF !EMPTY(LSAlsTmp) AND USED(LSAlsTmp)
			SELECT &LSAlsTmp
			USE
		 ENDIF
	ENDIF	

    SELE &PBClientesAlias
	LMaxDim = Fcount()
    PUBLIC DIMENSION VTClientes[LMaxDim]&& VETOR PARA CAMPOS DA TABELA
    PUBLIC DIMENSION VDClientes[2,3]	&& VETOR PARA CAMPOS DERIVADAS
    PUBLIC DIMENSION VFClientes[1]      && VETOR CABECALHO DOS CAMPOS
    PUBLIC DIMENSION VCClientes[8,3]	&& VETOR PARA CONFIGURACOES


	=AFIELDS(VFClientes)



	*-----------------------------------------------------------*
	=CLReadProperty()
	=CLSetDerivadas()
	=CLSetConfig()
	*--------------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN



*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPOG           CLDestroi VALID                    º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIENTES,     Record Number:    4  º
*       º Variable:            CLDestroi                          º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      3                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4c60mupog     &&  CLDestroi VALID
#REGION 1
return
*---------------------------------------------------------------*


FUNCTION CLDestroi

	=W_DEFPROC("rotinas.spr")

	IF TYPE("PBClientesAlias") = "U"
		RETURN
	ENDIF

    *--------------------------------------------------------------------*
	*-> QUANDO O SISTEMA APLICA UM CLOSE DATABASE :
	*   EX: EM UPAltDir (Geral.spr)
	*  1- Fecha inclusive a referencia do PBClientesAlias
	*  2- Novas tabelas abertas podem ocupar a area referenciada
	*     por PBClientesAlias
	*  3- Se aplicar um FECHAMENTO a PBClientesAlias estara fechando
	*     outra tabela
	*  4- Entao Verifica-se a coerencia do dbf esperado em PBClientesAlias
	*-------------------------------------------------------------------*
	IF !(USED(PBClientesAlias)) OR ;
	   !("CLIENTES.DBF" $ DBF(PBClientesAlias))

		RELEASE PBClientesAlias
    	RELEASE VTClientes
	    RELEASE VDClientes
		RELEASE VFClientes
		RELEASE VCClientes
		return(.T.)			
	ENDIF
	PRIVATE LSalias
	LSalias  = Alias()
	IF !EMPTY(PBClientesAlias) AND USED(PBClientesAlias)
		SELECT &PBClientesAlias
		USE
	ENDIF	
	RELEASE PBClientesAlias
    RELEASE VTClientes
    RELEASE VDClientes
	RELEASE VFClientes
	RELEASE VCClientes

	*-----------------------------------------------------------*
	*--------------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(.T.)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPOH           CLReadProp VALID                   º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIENTES,     Record Number:    5  º
*       º Variable:            CLReadProp                         º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      4                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4c60mupoh     &&  CLReadProp VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION CLReadProp
	PRIVATE LSalias
	LSalias		= 	ALIAS()


	SELE &PBClientesAlias
	SCATTER TO VTClientes
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(.T.)



*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPOI           CLSetDerivadas VALID               º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIENTES,     Record Number:    6  º
*       º Variable:            CLSetDerivadas                     º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      5                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4c60mupoi     &&  CLSetDerivadas VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION CLSetDerivadas
	PRIVATE LSalias
	PRIVATE LEmpresa
	LSalias		= 	ALIAS()

	*--------------------------------------------------------------*
    VDClientes(1,1) = "NAOINFORMADO"	&& TITULO	
   	VDClientes(1,2) = 0					&& VALOR
   	VDClientes(1,3) = .F.				&& FLAG .T. => FOI CARREGADO
	*--------------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(.T.)



*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPOJ           CLSetPropVT VALID                  º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIENTES,     Record Number:    7  º
*       º Variable:            CLSetPropVT                        º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      6                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4c60mupoj     &&  CLSetPropVT VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION CLSetPropVT
PARAMETER  PrmField, PrmValue
	PRIVATE Lvalue

	=W_DEFPROC("ROTINAS.SPR")
	Lvalue = RTsetValueObj(PrmField,;
							PrmValue,;
						    PBClientesAlias,;
						    VTClientes,;
						    VDClientes,;
						    VFClientes,;
						    VCClientes)

RETURN(Lvalue)



*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPOK           CLGetPropVT VALID                  º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIENTES,     Record Number:    8  º
*       º Variable:            CLGetPropVT                        º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      7                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4c60mupok     &&  CLGetPropVT VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION CLGetPropVT
PARAMETER  PrmField

	PRIVATE Lvalue

	=W_DEFPROC("ROTINAS.SPR")
	Lvalue = RTgetValueObj(PrmField,;
	            PBClientesAlias,;
	            VTClientes,;
	            VDClientes,;
			    VFClientes,;
			    VCClientes)

RETURN(Lvalue)





*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPOL           CLChk_Identidade VALID             º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIENTES,     Record Number:    9  º
*       º Variable:            CLChk_Identidade                   º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      8                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4c60mupol     &&  CLChk_Identidade VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION CLChk_Identidade

PARAMETERS PrmCliente,PrmInscricao
	PRIVATE LFretorno
	LFretorno = .t.

	=CLVerifyInst()



    =CLSetPropVT("CLIENTE",PrmCliente)
	IF TYPE("PrmInscricao") $ "U/L" OR EMPTY(PrmInscricao)
	    =CLSetPropVT("INSCRICAO",.F.)
	    =CLSetPropVT("CHAVE DE LEITURA","CLIENTE")
	ELSE
	    =CLSetPropVT("INSCRICAO",PrmInscricao)
	    =CLSetPropVT("CHAVE DE LEITURA","CLIE_INSCR")
	ENDIF

	LFretorno=CLFind()
RETURN(LFretorno)




*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPOM           CLFind VALID                       º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIENTES,     Record Number:   10  º
*       º Variable:            CLFind                             º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      9                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4c60mupom     &&  CLFind VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION CLFind
	PRIVATE LCliente
	PRIVATE LInscricao
	PRIVATE LNome
	PRIVATE LFreturn
	PRIVATE LSchaveAcesso
	

	PRIVATE LSalias
	LSalias		= 	ALIAS()

	=CLVerifyInst()




	SELE &PBClientesAlias
	LSchaveAcesso  =CLGetPropVT("CHAVE DE LEITURA")


	DO CASE
		CASE UPPER(LSchaveAcesso) = "CLIENTE"
			LCliente    = CLGetPropVT("Cliente")
			SET ORDER TO TAG CLIENTE
			SEEK LCliente

		CASE UPPER(LSchaveAcesso) = "CLIE_INSCR"
			LCliente    = CLGetPropVT("Cliente")
			LInscricao  = CLGetPropVT("Inscricao")
			SET ORDER TO TAG CLIE_Inscr
			SEEK STR(Lcliente,14)+Linscricao

		CASE UPPER(LSchaveAcesso) = "NOME"
			LNome  = CLGetPropVT("NOME")
			SET ORDER TO TAG NOME
			SET NEAR ON
			SEEK RTRIM(LNome)
			SET NEAR OFF
			LNome = LEFT( &PBClientesAlias .nome ,45)
			SEEK LNome
		OTHERWISE
			SET ORDER TO TAG CLIENTE
			SEEK LCliente

	ENDCASE
	IF FOUND()
		=CLReadProperty()
		=CLSetDerivadas()
	    LFreturn = .T.
	ELSE
	    LFreturn = .f.
	ENDIF
	*--------------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF

RETURN(LFreturn)



*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPPY           CLGetFieldValue VALID              º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIENTES,     Record Number:   11  º
*       º Variable:            CLGetFieldValue                    º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      10                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4c60muppy     &&  CLGetFieldValue VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION CLGetFieldValue
PARAMETERS  PrmCliente,;
			PrmInscricao,;
			PrmField

	=CLChk_Identidade(PrmCliente,PrmInscricao)

RETURN(CLGetPropVT(PrmField))


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPPZ           CL_Refresh VALID                   º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIENTES,     Record Number:   12  º
*       º Variable:            CL_Refresh                         º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      11                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4c60muppz     &&  CL_Refresh VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION CL_Refresh
PARAMETERS PrmCliente,PrmInscricao

	PRIVATE LFretorno
	LFretorno = .t.

	=CLVerifyInst()

    =CLSetPropVT("CLIENTE",PrmCliente)

	IF TYPE("PrmInscricao") $ "U/L" OR EMPTY(PrmInscricao)
	    =CLSetPropVT("INSCRICAO",.F.)
	    =CLSetPropVT("CHAVE DE LEITURA","CLIENTE")
	ELSE
	    =CLSetPropVT("INSCRICAO",PrmInscricao)
	    =CLSetPropVT("CHAVE DE LEITURA","CLIE_INSCR")
	ENDIF



	LFretorno=CLFind()
RETURN(LFretorno)






*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPQ0           CLLerRegistro VALID                º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIENTES,     Record Number:   14  º
*       º Variable:            CLLerRegistro                      º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      12                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4c60mupq0     &&  CLLerRegistro VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION CLLerRegistro
PARAMETERS PrmCliente,PrmInscricao



	PRIVATE LFretorno
	LFretorno = .t.

	LFretorno = CLChk_Identidade(PrmCliente,PrmInscricao)
RETURN(LFretorno)




*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPQ1           CLWriteProp VALID                  º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIENTES,     Record Number:   15  º
*       º Variable:            CLWriteProp                        º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      13                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4c60mupq1     &&  CLWriteProp VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION CLWriteProp
	PRIVATE LSalias
	LSalias		= 	ALIAS()


	SELE &PBClientesAlias
	=RLOCK()
	GATHER FROM  VTClientes
	UNLOCK

	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF

RETURN(.T.)



*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPQ2           CLSalvarRegistro VALID             º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIENTES,     Record Number:   16  º
*       º Variable:            CLSalvarRegistro                   º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      14                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4c60mupq2     &&  CLSalvarRegistro VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION CLSalvarRegistro

	=CLVerifyInst()

	PRIVATE LFretorno
	LFretorno = .t.

	IF !CLExiste()
		SELE &PBClientesAlias
		APPEND BLANK
		LFretorno=CLWriteProp()
	ELSE
		SELE &PBClientesAlias
		LFretorno=CLWriteProp()
	ENDIF

RETURN(LFretorno)




*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPQ3           CLExiste VALID                     º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIENTES,     Record Number:   17  º
*       º Variable:            CLExiste                           º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      15                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4c60mupq3     &&  CLExiste VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION CLExiste


	PRIVATE LCliente, LInscricao
	PRIVATE LFreturn

	PRIVATE LSalias
	LSalias		= 	ALIAS()

	=CLVerifyInst()


	LCliente    = CLGetPropVT("Cliente")
	LInscricao  = CLGetPropVT("Inscricao")


	SELE &PBClientesAlias

	IF TYPE("LInscricao") $ "U/L" OR EMPTY(LInscricao)
		SET ORDER TO TAG CLIENTE
		SEEK LCliente
	ELSE
		SET ORDER TO TAG CLIE_Inscr
		SEEK STR(Lcliente,14)+Linscricao
	ENDIF
	IF FOUND()
	    LFreturn = .T.
	ELSE
	    LFreturn = .f.
	ENDIF
	*--------------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF

RETURN(LFreturn)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPQ4           CLGetAlias VALID                   º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIENTES,     Record Number:   19  º
*       º Variable:            CLGetAlias                         º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      16                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4c60mupq4     &&  CLGetAlias VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION CLGetAlias

	=CLVerifyInst()

RETURN(PBClientesAlias)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPQ5           CLSetConfig VALID                  º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIENTES,     Record Number:   20  º
*       º Variable:            CLSetConfig                        º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      17                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4c60mupq5     &&  CLSetConfig VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION CLSetConfig

	*--------------------------------------------------------------*
    VCClientes(1,1) = "REG_STATE" && INSERT/EDICAO/BROWSER/
   	VCClientes(1,2) = ""
   	VCClientes(1,3) = .T.
	*--------------------------------------------------------------*
    VCClientes(2,1) = "CHV_LER" && p/ leitura do ultimo reg + 1
   	VCClientes(2,2) = ""
   	VCClientes(2,3) = .T.
	*--------------------------------------------------------------*
    VCClientes(3,1) = "CHV_COMPARA" && p/ leitura do ultimo reg + 1
   	VCClientes(3,2) = ""
   	VCClientes(3,3) = .T.
	*--------------------------------------------------------------*
    VCClientes(4,1) = "CHV_BROW" && p/ leitura do ultimo reg + 1
   	VCClientes(4,2) = ""
   	VCClientes(4,3) = .T.
	*--------------------------------------------------------------*
    VCClientes(5,1) = "ISEDITING" && p/ leitura do ultimo reg + 1
   	VCClientes(5,2) = .F.
   	VCClientes(5,3) = .T.
	*--------------------------------------------------------------*
    VCClientes(6,1) = "ISADDING" && p/ leitura do ultimo reg + 1
   	VCClientes(6,2) = .F.
   	VCClientes(6,3) = .T.
	*--------------------------------------------------------------*
    VCClientes(7,1) = "ISREADING" && p/ leitura do ultimo reg + 1
   	VCClientes(7,2) = .F.
   	VCClientes(7,3) = .T.
	*--------------------------------------------------------------*
    VCClientes(8,1) = "CHAVE DE LEITURA" && TAG DO CHAVE USADA EM FIND
   	VCClientes(8,2) = "CLIENTE"
   	VCClientes(8,3) = .T.
	*--------------------------------------------------------------*
	
RETURN(.T.)



*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPQ6           CLBtnVal VALID                     º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIENTES,     Record Number:   21  º
*       º Variable:            CLBtnVal                           º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      18                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4c60mupq6     &&  CLBtnVal VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION CLBtnVal
PARAMETERS PrmTecla

PRIVATE Lchv_Ler
PRIVATE Lchv_Compara
PRIVATE Lchv_Brow
PRIVATE LCliente


	=CLVerifyInst()

	Lchv_ler    = CLGetPropVT("CHV_LER")
	Lchv_compara= CLGetPropVT("CHV_COMPARA")
	Lchv_brow    = CLGetPropVT("CHV_BROW")

	
	SELE &PBClientesAlias
	SET ORDER TO TAG NOME
	DO CASE
	
		CASE PrmTecla = "LOCATE"

			LCliente     = CLGetPropVT("CLIENTE")

			=CLView(LCliente)
			SELE &PBClientesAlias
			SCATTER MEMVAR MEMO

			
		OTHERWISE

		    DO btn_val with PrmTecla,;
	   			       Lchv_ler,;
	   			       Lchv_compara,;
	   			       Lchv_brow,;
	   			       .T.,;
	   			       .T.
	   			
	ENDCASE
	   			
	=CLSetPropVT("ISEDITING",ISEDITING)
	=CLSetPropVT("ISADDING",ISADDING)
	=CLSetPropVT("ISREADING",ISREADING)
	   			
RETURN(.t.)




*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPQD           CLTrtChvCPFCNPJINS VALID           º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIENTES,     Record Number:   22  º
*       º Variable:            CLTrtChvCPFCNPJINS                 º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      19                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4c60mupqd     &&  CLTrtChvCPFCNPJINS VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION CLTrtChvCPFCNPJINS
PARAMETERS PrmCliente,PrmInscricao

	PRIVATE LFretorno
	LFretorno = .t.

	=CLVerifyInst()

    =CLSetPropVT("CLIENTE",PrmCliente)
	IF TYPE("PrmInscricao") $ "U/L" OR EMPT(PrmInscricao)
	    =CLSetPropVT("INSCRICAO",.F.)
	    =CLSetPropVT("CHAVE DE LEITURA","CLIENTE")
	ELSE
	    =CLSetPropVT("INSCRICAO",PrmInscricao)
	    =CLSetPropVT("CHAVE DE LEITURA","CLIE_INSCR")
	ENDIF
	*--------------------------------------------------------------*

	LFretorno=CLFind()
	IF isadding
		IF LFretorno
			IF !fox_alert("Cliente Ja Cadastrado. DUPLICAR ?")
				RETURN(.F.)
			ENDIF
			wp_msg = 'Informe Seu Codigo e sua Senha p/ DUPLICAR..'
			LNusuario = nUsr
			BTMP   =  'usuario.usuario = LNusuario '
			LNusr_ret = 0
			DO obj_prmt.SPR WITH   wp_msg , Btmp
			IF LNusr_ret <>  0
			   RETURN(.T.)
			ENDIF
		ENDIF
	ENDIF

	SELE &PBClientesAlias
RETURN(UPtratachv())





*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPQL           CLBuscaNOMEAprox VALID             º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIENTES,     Record Number:   23  º
*       º Variable:            CLBuscaNOMEAprox                   º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      20                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4c60mupql     &&  CLBuscaNOMEAprox VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION CLBuscaNOMEAprox
PARAMETERS PrmNOME



	PRIVATE LFretorno
	LFretorno = .t.

	=CLVerifyInst()

    =CLSetPropVT("NOME",PrmNOME)
    =CLSetPropVT("CHAVE DE LEITURA","NOME")
	*--------------------------------------------------------------*

	LFretorno=CLFind()

	SELE &PBClientesAlias
RETURN(UPtratachv())





*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPQR           CLScatter VALID                    º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIENTES,     Record Number:   26  º
*       º Variable:            CLScatter                          º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      21                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4c60mupqr     &&  CLScatter VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION CLScatter

	PRIVATE LFretorno
	LFretorno = .t.

	=CLVerifyInst()
	SELE &PBClientesAlias
	SCATTER MEMVAR MEMO
RETURN(.T.)






*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPQY           CLView VALID                       º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIENTES,     Record Number:   27  º
*       º Variable:            CLView                             º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      22                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4c60mupqy     &&  CLView VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION CLView
PARAMETER PrmCliente,PrmOrdem

	PRIVATE LerNome
	LerNnome =""
	PRIVATE LerCPF_CNPJ
	LerCPF_CNPJ =""

	PRIVATE PrmVlrLocate && VARIAVEL USADA PARA LOCATE
	                     && E PRESERVADA PARA USO NO CONTINUE
	                     && ELA E PUBLICA PARA:
	                     && MNView, MNLOCATE e MNContinue

	PrmVlrLocate = ""


	=W_DEFPROC("rotinas.spr")
	PRIVATE Lretorno
	=CLVerifyInst()
	*--------------------------------------------------------------*
	IF TYPE("PrmCliente") <> "N"
		PrmCliente = 0
	ENDIF
	
	IF TYPE("PrmOrdem") <> "C" OR EMPTY(PrmOrdem)
		PrmOrdem = "NOME"
	ENDIF

	SELE  &PBClientesAlias


	DO CASE
		CASE PrmOrdem = "NOME"
			SET ORDER TO TAG NOME
		OTHERWISE
			SET ORDER TO TAG CLIENTE
	ENDCASE




	=UPLocDefWindow()

	ON KEY LABEL L DO CLLOCATE WITH "NOME", LerNnome
	ON KEY LABEL l DO CLLOCATE WITH "NOME", LerNnome
	ON KEY LABEL N DO CLLOCATE WITH "NOME", LerNnome
	ON KEY LABEL n DO CLLOCATE WITH "NOME", LerNnome
	ON KEY LABEL C DO CLLOCATE WITH "CLIENTE", LerCPF_CNPJ
	ON KEY LABEL c DO CLLOCATE WITH "CLIENTE", LerCPF_CNPJ

	ON KEY LABEL CTRL-G DO CLCONTINUE


	BROWSE  FIELDS;
			CLIENTE;
			:H="CPF_CNPJ - (C)",;
			NOME;
			:H="NOME - (N)";
			REST ;
		WINDOW wzlocate ;
    		NOAPPEND NODELETE NOEDIT  ;
    			COLOR SCHEME 10



	=UPLocRelWindow()


	ON KEY LABEL CTRL-G
	ON KEY LABEL L
	ON KEY LABEL l
	ON KEY LABEL N
	ON KEY LABEL n
	ON KEY LABEL C
	ON KEY LABEL c



	Lretorno = &PBClientesAlias .CLIENTE


	=CL_Refresh(Lretorno)
		
	*--------------------------------------------------------------*
RETURN(Lretorno)


PROCEDURE  CLCONTINUE

	CONTINUE
	IF EOF()
		GO TOP
		CONTINUE
	ENDIF

RETURN


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPR4           CLLOCATE VALID                     º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIENTES,     Record Number:   28  º
*       º Variable:            CLLOCATE                           º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      23                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4c60mupr4     &&  CLLOCATE VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*


FUNCTION CLLOCATE
PARAMETERS PrmFields,PrmUltimaPesquisa


	DO LOC_BROW.SPR with PrmFields,PrmUltimaPesquisa



	PrmVlrLocate = PrmUltimaPesquisa
	
	PrmVlrLocate = ALLTRIM(PrmVlrLocate)
	PrmVlrLocate = UPPER(PrmVlrLocate)
	
	DO CASE
		CASE  PrmFields = "NOME"
			LOCATE FOR NOME >= PrmVlrLocate

		CASE  PrmFields = "CLIENTE"
			LOCATE FOR ALLTRIM(PrmVlrLocate) $ ALLTRIM(STR(CLIENTE,14))
	ENDCASE
RETURN


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPRA           CLAtribuiIBGE VALID                º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIENTES,     Record Number:   31  º
*       º Variable:            CLAtribuiIBGE                      º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      24                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4c60mupra     &&  CLAtribuiIBGE VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION CLAtribuiIBGE



	PPNOME = POPUP()

	DEACTIVATE POPUP &PPNOME
	PUSH KEY CLEAR		&& desabilita teclas de atalho def. anteriormente
	*--------------------------------------------------------------*


	PrmVlrLocate = ""


	=W_DEFPROC("rotinas.spr")
	PRIVATE Lretorno
	=CLVerifyInst()
	*--------------------------------------------------------------*

	SELE  &PBClientesAlias

	=CLBtnVal('TOP')

	=UPCriatermo()
	=UPIniciatermo()


	* =CLBtnVal('TOP')

	SELE  &PBClientesAlias
	GO TOP
	
	LFsegue = .t.

	CLEAR TYPEAHEAD
	=INKEY(0.1)
	DO WHILE !EOF() AND	LFsegue

		=UPtermo() && DEMONSTRA PROGRESSAO E  VERIFICA PEDIDO DE
				   && INTERRUPCAO E SET EM LFsegue = .F.

		
		=W_DEFPROC("MUNICPIO.SPR")
		m.muni_ibge = MNGet_MUNI_IBGE( &PBClientesAlias .Estado,;
		                               &PBClientesAlias .cidade)
		IF m.muni_ibge > 0
			SELE  &PBClientesAlias
			=rlock()
			REPLACE MUNI_IBGE WITH M.MUNI_IBGE
		ENDIF

		SELE  &PBClientesAlias
		SKIP
		
	ENDDO
	=UPEncerratermo()

	=CL_Refresh(  &PBClientesAlias .CLIENTE)
		
	*--------------------------------------------------------------*
	POP KEY 			&& reabilita teclas de atalho def. anteriormente
	ACTIVATE POPUP &PPNOME

RETURN(" ")




*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPT0           CLGSetAreaAlias VALID              º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIENTES,     Record Number:   32  º
*       º Variable:            CLGSetAreaAlias                    º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      25                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4c60mupt0     &&  CLGSetAreaAlias VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION CLGSetAreaAlias

	=CLVerifyInst()
	SELE &PBClientesAlias

RETURN(PBClientesAlias)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPT1           CLGetUFOrigem VALID                º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIEN_R,     Record Number:    2   º
*       º Variable:            CLGetUFOrigem                      º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      26                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4c60mupt1     &&  CLGetUFOrigem VALID
#REGION 2
return
*---------------------------------------------------------------*

FUNCTION CLGetUFOrigem
PARAMETERS PrmCliente,PrmInscricao

	=CLChk_Identidade(PrmCliente,PrmInscricao)

RETURN(CLGetPropVT("ESTADO"))


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPT2           CLLocCli VALID                     º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIEN_R,     Record Number:    3   º
*       º Variable:            CLLocCli                           º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      27                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4c60mupt2     &&  CLLocCli VALID
#REGION 2
return

*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION CLLocCli

PARAMETERS LNemp,LNkey,LNcliente,LSinscricao

	*------------------------------------------------------------*
	* CLASSIFICACAO:  [*****]
	*------------------------------------------------------------*
	* OBJETIVO....: Localizar um cliente
	*------------------------------------------------------------*
	* COMENTARIO..: A funcao permite localizar um cliente ou
	*------------------------------------------------------------*
	* OBS........ :
	*------------------------------------------------------------*
	*  TABELAS....:
	*------------------------------------------------------------*
	*  PARAMETROS..:
	*		LNemp..........: Empresa em operacao
	*		LNkey..........: Codigo da Tecla de Saida do Campo
	*                        e Ultima tecla retornada desta funcao
	*                        para uso na rotina chamadora ex:
	*                        o operador tecla ESC para desistir de
	*                        qualquer escolha no browse do clientes
	*		LNcliente......: Codigo do Cliente
	*		LSinscricao....: Campo para diferenciar clientes com
	*						duas inscricoes (Ocorre com fazendas)
	*						dois cadastros com mesmo CPF e inscricao
	*						e enderecos diferentes
	*						
	*------------------------------------------------------------*
	*  RETORNO.....:- REGISTRO DO CLIENTE  POSICIONADO para
	*					ser tratado na rotina
	*				- .F. Para codigo nao localizado ou nao aceito
	*				- .T. Para codigo Localizado
	*------------------------------------------------------------*
	* EXEMPLO : CHAMADA DO PROGRAMA SCGC201.SCR
	*------------------------------------------------------------*
	=W_DEFPROC("rotinas.spr")

	PRIVATE LSalias
	PRIVATE LFretorno
	PRIVATE LSmsg
	*-----------------------------------------------------------*
	PRIVATE LSalias
	PRIVATE ARQ_Clientes, ALS_Clientes
	*-----------------------------------------------------------*
	LSalias	= ALIAS()
	*------------------------------------------------------------*
	IF !USED("CLIENTES")
	    ARQ_Clientes    = NetArq("CLIENTES")
	    ALS_Clientes   	= Alias()
	ENDIF
	*-----------------------------------------------------------*
	SELECT clientes
	SET ORDER TO TAG cliente
	IF LNkey = 9
	   	ON KEY LABEL ESCAPE
	   	DO loc_dlog WITH .T.
	   	ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
	   	IF LASTKEY() <> 27
		   	LNcliente	= 	clientes.cliente
			LSinscricao	=	clientes.inscricao
		ENDIF	
		LNkey 	= LASTKEY()   && PERMITIR TRATAMENTO DA DESISTENCIA
							  && NA ROTINA CHAMADORA
	ENDIF
	*-----------------------------------------------------------*
   	IF LASTKEY() <> 27
		SET NEAR ON
		SEEK LNcliente
		SET NEAR OFF
	    IF FOUND() AND !EMPTY(LSinscricao)
			DO WHILE !EOF() AND LNcliente = clientes.cliente
				IF LSinscricao = clientes.inscricao
					EXIT
				ENDIF
			    SKIP	&& VERIFICA SE E DUPLICADO E CHECA A INSCRICAO
			ENDDO
			IF EOF() OR LNcliente <> clientes.cliente OR ;
		  			LSinscricao <> clientes.inscricao
					SKIP -1			  && PEGAR DADOS DO REG. LOCALIZADP
			ENDIF				  && PRIMEIRO
		ENDIF
		IF LNcliente	= 	clientes.cliente
			LSinscricao	=	clientes.inscricao
		ENDIF
	ENDIF
	*-----------------------------------------------------------*
	*	Critica a tecla
	*-----------------------------------------------------------*
	IF LASTKEY() = 27
		IF !EMPTY(LSalias) AND USED(LSalias)
			SELECT &LSalias
		ENDIF
		RETURN(.F.)
	ENDIF
	*-----------------------------------------------------------*
	*	Critica a localizacao do registro
	*-----------------------------------------------------------*
	IF (LNcliente = 0 OR !FOUND() )
		IF (LNcliente <> 0 AND !FOUND() )
			LSmsg = "Cliente nao cadastrado. Informe "+;
						"dados ou Solicite cadastro. <ENTER>"
			=UPbeeps(.F.,LSmsg)
		ENDIF
		IF !EMPTY(LSalias) AND USED(LSalias)
			SELECT &LSalias
		ENDIF
		RETURN(.F.)
	ENDIF
RETURN(.T.)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPT3           CLSetControleCredito VALID         º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIEN_R,     Record Number:    4   º
*       º Variable:            CLSetControleCredito               º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      28                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4c60mupt3     &&  CLSetControleCredito VALID
#REGION 2
return

*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION CLGrvControleCredito

PARAMETERS CLIENTE_ID, CR_ANTIGO, CR_NOVO, RESPONSAVE

	*------------------------------------------------------------*
	* CLASSIFICACAO:  [*****]
	*------------------------------------------------------------*
	* OBJETIVO....: Gravar Registro de Controle de Alteracoes de
	*           Credito
	*------------------------------------------------------------*
	* COMENTARIO..:
	*------------------------------------------------------------*
	* OBS........ :
	*------------------------------------------------------------*
	*  TABELAS....:
	*------------------------------------------------------------*
	*  PARAMETROS..:
	*						
	*------------------------------------------------------------*
	*  RETORNO.....:
	*------------------------------------------------------------*
	* EXEMPLO : CHAMADA DO PROGRAMA SCGC201.SCR
	*------------------------------------------------------------*

	=W_DEFPROC("rotinas.spr")
	IF m.cr_antigo = m.cr_novo	&& So Registrar Qdo houver Alteracao
		RETURN(.T.)
	ENDIF
	
	*-----------------------------------------------------------*
	PRIVATE LSalias
	PRIVATE ARQ_CtrlCred, ALS_CtrlCred
	*-----------------------------------------------------------*
	LSalias	= ALIAS()
    ARQ_CtrlCred    = NetArqAgain("CTRLCRED")
    ALS_CtrlCred   	= Alias()
	*------------------------------------------------------------*
	m.DT_REGISTR	= date()

   	SELE &ALS_CtrlCred
  	SET ORDER TO TAG key_unica
    SEEK STR(m.CLIENTE_ID,14)+DTOS(m.DT_REGISTR)
    IF FOUND()
		m.CR_ANTIGO	= &ALS_CtrlCred .CR_ANTIGO
		=edithand('REGRAVA')
	ELSE
		=edithand('SAVE')
   	ENDIF	

    =up_fecha("&ALS_CtrlCred")

	*------------------------------------------------------------------*

	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(.T.)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPT4           CLObterVlrAlteradoCredito VALID    º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIEN_R,     Record Number:    5   º
*       º Variable:            CLObterVlrAlteradoCredito          º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      29                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4c60mupt4     &&  CLObterVlrAlteradoCredito VALID
#REGION 2
return

*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION CLObterVlrAlteradoCredito

PARAMETERS PRcliente, PRdata

	*------------------------------------------------------------*
	* CLASSIFICACAO:  [*****]
	*------------------------------------------------------------*
	* OBJETIVO....: Obter o Valor de Ajuste de Credito na
	*  			data especificada
	*------------------------------------------------------------*
	* COMENTARIO..:
	*------------------------------------------------------------*
	* OBS........ :
	*------------------------------------------------------------*
	*  TABELAS....:
	*------------------------------------------------------------*
	*  PARAMETROS..:
	*						
	*------------------------------------------------------------*
	*  RETORNO.....:
	*------------------------------------------------------------*
	* EXEMPLO  :
	*------------------------------------------------------------*

	=W_DEFPROC("rotinas.spr")
	
	*-----------------------------------------------------------*
	PRIVATE LSalias
	PRIVATE ARQ_CtrlCred, ALS_CtrlCred
	PRIVATE LNvalor
	*-----------------------------------------------------------*
	LSalias	= ALIAS()
    ARQ_CtrlCred    = NetArqAgain("CTRLCRED")
    ALS_CtrlCred   	= Alias()
	*------------------------------------------------------------*

   	SELE &ALS_CtrlCred
  	SET ORDER TO TAG key_unica
    SEEK STR(PRcliente,14) + DTOS(PRdata)
    IF FOUND()
		LNvalor =  &ALS_CtrlCred .CR_NOVO - &ALS_CtrlCred .CR_ANTIGO
	ELSE
		LNvalor =  0
   	ENDIF	

    =up_fecha("&ALS_CtrlCred")

	*------------------------------------------------------------------*

	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(LNvalor)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPT5           CLSetUltAtendimento VALID          º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIEN_R,     Record Number:    6   º
*       º Variable:            CLSetUltAtendimento                º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      30                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4c60mupt5     &&  CLSetUltAtendimento VALID
#REGION 2
return

*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION CLSetUltAtendimento

PARAMETERS PrmpCliente,PrmInscricao, PrmData

	*------------------------------------------------------------*
	* CLASSIFICACAO:  [*****]
	*------------------------------------------------------------*
	* OBJETIVO....: Atualiza data do ultimo atendimento do Cliente
	*------------------------------------------------------------*
	* COMENTARIO..:
	*------------------------------------------------------------*
	* OBS........ :
	*------------------------------------------------------------*
	*  TABELAS....:
	*------------------------------------------------------------*
	*  PARAMETROS..:
	*						
	*------------------------------------------------------------*
	*  RETORNO.....:
	*------------------------------------------------------------*
	* EXEMPLO  :
	*------------------------------------------------------------*

	=W_DEFPROC("rotinas.spr")
	
	*-----------------------------------------------------------*
	PRIVATE LSalias
	PRIVATE ARQ_Clientes, ALS_Clientes
	*-----------------------------------------------------------*
	LSalias	= ALIAS()
    ARQ_Clientes    = NetArqAgain("CLIENTES")
    ALS_Clientes   	= Alias()
	*------------------------------------------------------------*

    SELE &ALS_Clientes
    SET ORDE TO clie_inscr
    SEEK STR(PrmpCliente,14)+PrmInscricao
	IF !FOUND()
	    SET ORDE TO cliente
	    SEEK STR(PrmpCliente,14)
	ENDIF

	IF FOUND()
		=REGLOCK()
		REPLACE ULT_ATEND WITH PrmData
	ENDIF


    =up_fecha("&ALS_Clientes")

	*------------------------------------------------------------------*

	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(.t.)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPT6           CLSQLSemFidelizacao VALID          º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIEN_R,     Record Number:    7   º
*       º Variable:            CLSQLSemFidelizacao                º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      31                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4c60mupt6     &&  CLSQLSemFidelizacao VALID
#REGION 2
return

*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION CLSQLSemFidelizacao

PARAMETERS PrmpCliente,PrmInscricao, PrmData

	*------------------------------------------------------------*
	* CLASSIFICACAO:  [*****]
	*------------------------------------------------------------*
	* OBJETIVO....: Atualiza data do ultimo atendimento do Cliente
	*------------------------------------------------------------*
	* COMENTARIO..:
	*------------------------------------------------------------*
	* OBS........ :
	*------------------------------------------------------------*
	*  TABELAS....:
	*------------------------------------------------------------*
	*  PARAMETROS..:
	*						
	*------------------------------------------------------------*
	*  RETORNO.....:
	*------------------------------------------------------------*
	* EXEMPLO  :
	*------------------------------------------------------------*

	=W_DEFPROC("rotinas.spr")
	
	*-----------------------------------------------------------*
	PRIVATE LSalias
	*-----------------------------------------------------------*
	LSalias	= ALIAS()
	*------------------------------------------------------------*
	SELECT MAX(DT.DATA) AS SEMANA, ;
	 		0000000000 	AS NOVOS,;
	 		0000000000 	AS CAD_SIMPLES,;
	 		COUNT(*) 	AS CLIENTES,;
			0000000000 	AS NAO_CAD ;
	   FROM Q:\SCGC\COMUM\DATAS   DT, ;
	   		Q:\SCGC\LOJA\CLIENTES CL,;
	   		Q:\SCGC\LOJA\NOTA NFS;
	   WHERE     DT.DATA        = NFS.DATA ;
			 AND NFS.CH_OPERA   = "1" ;
			 AND NFS.STATUS   <> 2 ;
	         AND NFS.FAVORECIDO = CL.CLIENTE ;
	         AND NFS.DATA-30    > CL.DTCAD ;
   	 GROUP BY DT.ANO, DT.SEMANA_DO_  ;
    UNION ;
	SELECT MAX(DT.DATA) AS SEMANA, ;
	 		COUNT(*) 	AS NOVOS,;
	 		0000000000 	AS CAD_SIMPLES,;
	 		0000000000 	AS CLIENTES,;
			0000000000 	AS NAO_CAD ;
	   FROM Q:\SCGC\COMUM\DATAS   DT, ;
	   		Q:\SCGC\LOJA\CLIENTES CL,;
	   		Q:\SCGC\LOJA\NOTA NFS;
	   WHERE     DT.DATA        = NFS.DATA ;
			 AND NFS.CH_OPERA   = "1" ;
			 AND NFS.STATUS   <> 2 ;
	         AND NFS.FAVORECIDO = CL.CLIENTE ;
	         AND NFS.DATA       <= CL.DTCAD+30 ;
   	 GROUP BY DT.ANO, DT.SEMANA_DO_ INTO CURSOR TMP

    SELECT * FROM TMP  UNION ;
	SELECT MAX(DT.DATA) AS SEMANA, ;
	 		0000000000 	AS NOVOS,;
	 		0000000000 	AS CAD_SIMPLES,;
	 		0000000000 	AS CLIENTES,;
			COUNT(*) 	AS NAO_CAD ;
	   FROM Q:\SCGC\COMUM\DATAS   DT, ;
	   		Q:\SCGC\LOJA\NOTA NFS;
	   WHERE     DT.DATA        = NFS.DATA ;
			 AND NFS.CH_OPERA   = "1" ;
			 AND NFS.STATUS   <> 2 ;
	         AND NFS.FAVORECIDO = 0  ;
   	 GROUP BY DT.ANO, DT.SEMANA_DO_ INTO CURSOR TMP1


	SELECT  NFS.FAVORECIDO , ;
			MIN(NFS.DATA)   AS DATA ;
	   FROM Q:\SCGC\LOJA\NOTA NFS;
	   WHERE ;
			     NFS.CH_OPERA   = "1" ;
			 AND NFS.STATUS   <> 2 ;
	         AND NFS.FAVORECIDO > 0  ;
	         AND NFS.FAVORECIDO NOT IN  ;
	                    (SELECT CLIENTE FROM Q:\SCGC\LOJA\CLIENTES)  ;
   	 GROUP BY NFS.FAVORECIDO INTO CURSOR CADSIMPL




    SELECT * FROM TMP1  UNION ;
	SELECT MAX(DT.DATA) AS SEMANA, ;
	 		0000000000 	AS NOVOS,;
	 		COUNT(*) 	AS CAD_SIMPLES,;
	 		0000000000 	AS CLIENTES,;
			0000000000	AS NAO_CAD ;
	   FROM Q:\SCGC\COMUM\DATAS   DT, ;
	   		CADSIMPL  NFS;
	   WHERE     DT.DATA        = NFS.DATA ;
   	 GROUP BY DT.ANO, DT.SEMANA_DO_ INTO CURSOR CLIE_CTR



	SELECT SEMANA, ;
			SUM(NOVOS)       AS NOVOS, ;
			SUM(CLIENTES)    AS CLIENTES, ;
	 		SUM(CAD_SIMPLES) AS CAD_SIMPLES,;
			SUM(NAO_CAD)     AS NAO_CAD ;
	FROM CLIE_CTR GROUP BY SEMANA ;
	INTO TABLE  Q:\SCGC\CONSULTAS\FIDELIZA
    *------------------------------------------------------------------*

	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(.t.)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPT7           CLSQLMesFidelizacao VALID          º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIEN_R,     Record Number:    8   º
*       º Variable:            CLSQLMesFidelizacao                º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      32                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4c60mupt7     &&  CLSQLMesFidelizacao VALID
#REGION 2
return

*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION CLSQLMesFidelizacao

	*------------------------------------------------------------*
	* CLASSIFICACAO:  [*****]
	*------------------------------------------------------------*
	* OBJETIVO....: Atualiza data do ultimo atendimento do Cliente
	*------------------------------------------------------------*
	* COMENTARIO..:
	*------------------------------------------------------------*
	* OBS........ :
	*------------------------------------------------------------*
	*  TABELAS....:
	*------------------------------------------------------------*
	*  PARAMETROS..:
	*						
	*------------------------------------------------------------*
	*  RETORNO.....:
	*------------------------------------------------------------*
	* EXEMPLO  :
	*------------------------------------------------------------*
	=W_DEFPROC("rotinas.spr")

	PRIVATE LSalias
	PRIVATE ARQ_datas  , ALS_datas
	PRIVATE ARQ_clientes  , ALS_clientes
	PRIVATE ARQ_nota   , ALS_nota

	LSalias			= ALIAS()

    ARQ_datas  	= NetArqAgain("datas")
    ALS_datas  	= Alias()

    ARQ_Nota  	= NetArqAgain("Nota")
    ALS_Nota  	= Alias()

    ARQ_Clientes  	= NetArqAgain("Clientes")
    ALS_Clientes  	= Alias()
	
	*-----------------------------------------------------------*
	PRIVATE LSalias
	*-----------------------------------------------------------*
	LSalias	= ALIAS()
	*------------------------------------------------------------*
	SET TALK ON
	SELECT * FROM &ALS_DATAS GROUP BY ANO,MES INTO CURSOR CRSDATA



	SELECT MAX(DT.DATA) AS SEMANA, ;
	 		0000000000 	AS NOVOS,;
	 		0000000000 	AS CAD_SIMPLES,;
	 		COUNT(*) 	AS CLIENTES,;
			0000000000 	AS NAO_CAD ;
	   FROM CRSDATA   DT, ;
	   		&ALS_CLIENTES CL,;
	   		&ALS_NOTA NFS;
	   WHERE ;
			 	 DT.ANO  = YEAR(NFS.DATA) ;
			 AND DT.MES  = MONTH(NFS.DATA) ;
			 AND NFS.CH_OPERA   = "1" ;
			 AND NFS.STATUS   <> 2 ;
	         AND NFS.FAVORECIDO = CL.CLIENTE ;
	         AND NFS.DATA-30    > CL.DTCAD ;
   	 GROUP BY DT.ANO, DT.MES  ;
    UNION ;
	SELECT MAX(DT.DATA) AS SEMANA, ;
	 		COUNT(*) 	AS NOVOS,;
	 		0000000000 	AS CAD_SIMPLES,;
	 		0000000000 	AS CLIENTES,;
			0000000000 	AS NAO_CAD ;
	   FROM CRSDATA   DT, ;
	   		&ALS_CLIENTES CL,;
	   		&ALS_NOTA NFS;
	   WHERE ;
			 	 DT.ANO  = YEAR(NFS.DATA) ;
			 AND DT.MES  = MONTH(NFS.DATA) ;
			 AND NFS.CH_OPERA   = "1" ;
			 AND NFS.STATUS   <> 2 ;
	         AND NFS.FAVORECIDO = CL.CLIENTE ;
	         AND NFS.DATA       <= CL.DTCAD+30 ;
   	 GROUP BY DT.ANO, DT.MES INTO CURSOR TMP


    SELECT * FROM TMP  UNION ;
	SELECT MAX(DT.DATA) AS SEMANA, ;
	 		0000000000 	AS NOVOS,;
	 		0000000000 	AS CAD_SIMPLES,;
	 		0000000000 	AS CLIENTES,;
			COUNT(*) 	AS NAO_CAD ;
	   FROM CRSDATA   DT, ;
	   		&ALS_NOTA NFS;
	   WHERE ;
			 	 DT.ANO  = YEAR(NFS.DATA) ;
			 AND DT.MES  = MONTH(NFS.DATA) ;
			 AND NFS.CH_OPERA   = "1" ;
			 AND NFS.STATUS   <> 2 ;
	         AND NFS.FAVORECIDO = 0  ;
   	 GROUP BY DT.ANO, DT.MES INTO CURSOR TMP1


	SELECT  NFS.FAVORECIDO , ;
			MIN(NFS.DATA)   AS DATA ;
	   FROM	&ALS_NOTA NFS;
	   WHERE ;
			     NFS.CH_OPERA   = "1" ;
			 AND NFS.STATUS   <> 2 ;
	         AND NFS.FAVORECIDO > 0  ;
	         AND NFS.FAVORECIDO NOT IN  ;
                    (SELECT CLIENTE FROM &ALS_CLIENTES)  ;
   	 GROUP BY NFS.FAVORECIDO INTO CURSOR CADSIMPL


    SELECT * FROM TMP1  UNION ;
	SELECT MAX(DT.DATA) AS SEMANA, ;
	 		0000000000 	AS NOVOS,;
	 		COUNT(*) 	AS CAD_SIMPLES,;
	 		0000000000 	AS CLIENTES,;
			0000000000	AS NAO_CAD ;
	   FROM CRSDATA   DT, ;
	   		CADSIMPL  NFS;
	   WHERE ;
			 	 DT.ANO  = YEAR(NFS.DATA) ;
			 AND DT.MES  = MONTH(NFS.DATA) ;
   	 GROUP BY DT.ANO, DT.MES INTO CURSOR CLIE_CTR


	if "CENTRAL" $ UPPER(wp_dirdat)
		SELECT SEMANA AS MES, ;
			SUM(NOVOS)       AS NOVOS, ;
			SUM(CLIENTES)    AS CLIENTES, ;
	 		SUM(CAD_SIMPLES) AS CAD_SIMPLES,;
			SUM(NAO_CAD)     AS NAO_CAD ;
		FROM CLIE_CTR GROUP BY SEMANA ;
		INTO TABLE  Q:\SCGC\CONSULTAS\FDLZMESC
	ELSE
		SELECT SEMANA AS MES, ;
			SUM(NOVOS)       AS NOVOS, ;
			SUM(CLIENTES)    AS CLIENTES, ;
	 		SUM(CAD_SIMPLES) AS CAD_SIMPLES,;
			SUM(NAO_CAD)     AS NAO_CAD ;
		FROM CLIE_CTR GROUP BY SEMANA ;
		INTO TABLE  Q:\SCGC\CONSULTAS\FDLZMESL
	ENDIF
	

    *------------------------------------------------------------------*
	SET TALK OFF

   	=up_fecha("&ALS_datas")
   	=up_fecha("&ALS_clientes")
   	=up_fecha("&ALS_nota")

	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(.t.)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPUN           CLCalc_Cgc VALID                   º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIEN_R,     Record Number:    9   º
*       º Variable:            CLCalc_Cgc                         º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      33                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4c60mupun     &&  CLCalc_Cgc VALID
#REGION 2
RETURN


*--------------------------------------------------------------------*
* objetivo : consiste CGC ou CPF                                     *
*--------------------------------------------------------------------*
FUNCTION CLCalc_Cgc
   parameter p_cgc
   PRIVATE TMPcgccpf
   PRIVATE LNcpfcnpj


   TMPcgccpf= alltrim(str(p_cgc,14))

   cgc_aux  = strtran(str(p_cgc,14)," ","0")



   *------------------------------------------------*
    PRIVATE ARQ_CPF_CNPJ,ALS_CPF_CNPJ

    ARQ_CPF_CNPJ = NetArqAgain("CPF_CNPJ")
    ALS_CPF_CNPJ = Alias()


	LNcpfcnpj = INT(VAL( cgc_aux ))

    SELE &ALS_CPF_CNPJ
  	SET ORDER TO TAG CPF_CNPJ
    SEEK  cgc_aux
    IF FOUND()
	   Lreturn =  &ALS_CPF_CNPJ .tp_pessoa
	   	=up_fecha("&ALS_CPF_CNPJ")
	    return(Lreturn)
    ENDIF


   	=up_fecha("&ALS_CPF_CNPJ")

   *------------------------------------------------*



   if p_cgc = 0
     return "3"			&& INVALIDO
   endif

*   IF "1111111" $ cgc_aux
*     return "3"			&& INVALIDO
*   endif

*   IF "2222222" $ cgc_aux
*     return "3"			&& INVALIDO
*   endif

*   IF "3333333" $ cgc_aux
*     return "3"			&& INVALIDO
*   endif

*   IF "4444444" $ cgc_aux
*     return "3"			&& INVALIDO
*   endif

*   IF "5555555" $ cgc_aux
*     return "3"			&& INVALIDO
*   endif

*   IF "6666666" $ cgc_aux
*     return "3"			&& INVALIDO
*   endif
*   IF "7777777" $ cgc_aux
*     return "3"			&& INVALIDO
*   endif
*   IF "8888888" $ cgc_aux
*     return "3"			&& INVALIDO
*   endif
*   IF "9999999" $ cgc_aux
*     return "3"			&& INVALIDO
*   endif
   IF "0000000" $ cgc_aux
     return "3"			&& INVALIDO
   endif

   *---------------------------------------------------------*
*  if CLcgc1(cgc_aux)
*     return "2"			&& CGC OK
*  endif
   *---------------------------------------------------------*
   if LEN(TMPcgccpf) > 11
   	  IF CLcgc1(cgc_aux)
	      return "2"			&& CGC OK
	  ELSE
	      return "3"			&& CGC NAO OK
	  ENDIF
   endif
   *---------------------------------------------------------*
	
   acumulo  = 0
   resto    = 0
   digito_1 = 0
   digito_2 = 0
   cont     = 0
   for cont = 1 to 9
       acumulo = acumulo + val(subs(cgc_aux,cont+3,1))*cont
   next
   resto = mod(acumulo,11)
   if resto = 10
      digito_1 = 0
   else
      digito_1 = val(right(str(resto,3),1))
   endif
   acumulo = digito_1 * 9

   for cont = 1 to 8
       acumulo = acumulo + val(subs(cgc_aux,cont+4,1))*cont
   next
   resto = mod(acumulo,11)
   if resto = 10
      digito_2 = 0
   else
      digito_2 = val(right(str(resto,3),1))
   endif

*   A = str(digito_1,1) + str(digito_2,1)
*   wait window "Digitos : "+ a

   if subst(cgc_aux,13,2) # str(digito_1,1) + str(digito_2,1)

	   if CLcgc1(cgc_aux)
    	  return "2"			&& CGC OK
	   endif

      return "3"			&& CODIGO INVALIDO
   else
      return "1"			&& CPF OK
   endif
return

*--------------------------------------------------------------------*
* objetivo : funcao auxiliar a funcao Calc_Cgc                       *
*--------------------------------------------------------------------*
function CLCgc1
    parameter p_cgc1
    acumulo1    = 0
    digito_11   = 0
    digito_21   = 0
    resto1      = 0
    cont1       = 0
    cont2       = 12
    for cont1 = 2 to 9
        acumulo1 = acumulo1 + val(subst(p_cgc1,cont2,1))*cont1
        cont2    = cont2 - 1
    next
    cont2 = 4
    for cont1 = 2 to 5
        acumulo1 = acumulo1 + val(subst(p_cgc1,cont2,1))*cont1
        cont2    = cont2 - 1
    next
    resto1 = mod(acumulo1,11)
    if resto1 = 0 or resto1 = 1
       digito_11 = 0
    else
       digito_11 = 11 - resto1
       digito_11 = val(right(str(digito_11,3),1))
    endif
    acumulo1 = digito_11 * 2
    cont2 = 12
    for cont1 = 3 to 9
        acumulo1 = acumulo1 + val(subst(p_cgc1,cont2,1))*cont1
        cont2    = cont2 - 1
    next
    cont2 = 5
    for cont1 = 2 to 6
        acumulo1 = acumulo1 + val(subst(p_cgc1,cont2,1))*cont1
        cont2    = cont2 - 1
    next
    resto1 = mod(acumulo1,11)
    if resto1 = 0 or resto1 = 1
       digito_21 = 0
    else
       digito_21 = 11 - resto1
       digito_21 = val(right(str(digito_21,3),1))
    endif
* 	 a = str(digito_11,1) + str(digito_21,1)
*     wait window "Digitos : "+ a

    if subst(p_cgc1,13,2) # str(digito_11,1) + str(digito_21,1)
       return (.f.)
    endif
return


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPUO           CLInscricao VALID                  º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIEN_R,     Record Number:   10   º
*       º Variable:            CLInscricao                        º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      34                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4c60mupuo     &&  CLInscricao VALID
#REGION 2
RETURN

*** ?UPInscricao("AL","240000048",1,0,0,Mens)
*** ?UPInscricao("GO","109876547",1,0,0,Mens)
*** ?UPInscricao("TO","29010227836",1,0,0,Mens)

FUNCTION CLInscricao
	*------------------------------------------------------------*
	* CLASSIFICACAO:  [*****]
	*------------------------------------------------------------*
	* OBJETIVO....: Criticar Inscricoes Estaduais
	*------------------------------------------------------------*
	* COMENTARIO..: A funcao e recursiva para calcular a soma dos
	*		digitos
	*------------------------------------------------------------*
	* OBS........ :
	*------------------------------------------------------------*
	*  TABELAS....:
	*------------------------------------------------------------*
	*  PARAMETROS..:
	*		LSUf...........: Estados ao qual pertence Inscricao
	*		LSinscricao....: Numero da Inscricao
	*       LNPosicao......: Para uso na Recursividade indica qual
	*						 digito sera testado
	*						 A primeira chamada no prog Principal
	*						 deve passar o valor 1
	*		LNpeso.........: Peso atribuido a posicao do digito a
	*						ser testado ex
	*								INSC : 01.40.7420-0
	*								PESO : 98 76 5432
	*		LNnro_dgt......: Numero de Digito que devem ter seus
	*						produtos somados na inscricao do item
	*						anterior serao os 8 primeiros
	*       LSMens.........: Menssagem de Retorno
	*
	*------------------------------------------------------------*
	*  RETORNO.....:    Na recursao retorna NUMERICO PARA SOMA
	*					No encerramento da rotina retorna LOGICO
	*		LFretorno......: Flag de Retorno .f. ou .t.
	*------------------------------------------------------------*
PARAMETERS LSuf,LSinscricao,LNPosicao,LNpeso,LNnro_dgt,LSMens
	PRIVATE LNsoma,LNdigito,LFretorno, LNmult,LNresto

	IF LNposicao = 1
		IF "ISENTO" $ UPPER(LSinscricao)
			RETURN(.T.)
		ENDIF

		*--------------------------------------------------*
		DO UPlimpStrg WITH LSinscricao  && RETORNA strg SEM CARAc DE MASCARA
		*--------------------------------------------------*

		*--------------------------------------------------*
		* ROTINAS COM CALCULO DIFERENCIADAS
		*--------------------------------------------------*
		
		DO CASE


			CASE LSuf = "AC"
				RETURN(.T.)

			CASE LSuf = "RJ"
				RETURN(.T.)

			CASE LSuf = "PE"
				RETURN(.T.)

			CASE LSuf = "BA"
				RETURN(.T.)

			CASE LSuf = "TO"
				IF (CLTO_AntigaInscr((LSinscricao),LSMens))
					RETURN(.T.)
				ENDIF
				RETURN(CLTO_NovaInscr((LSinscricao),LSMens))
			CASE LSuf = "MG"
				RETURN(CLMG_Inscr((LSuf),(LSinscricao),1,0,0,LSMens))

			CASE LSuf = "BA"
				RETURN(CLBA_Inscr((LSuf),(LSinscricao),1,0,0,LSMens))

			CASE LSuf = "PR"
				RETURN(CLPR_Inscr((LSuf),(LSinscricao),1,0,0,LSMens))

			CASE LSuf = "RO"
				RETURN(CLRO_Inscr((LSuf),(LSinscricao),LSMens))

			CASE LSuf = "RR"
				RETURN(CLRR_Inscr((LSuf),(LSinscricao),1,0,0,LSMens))

			CASE LSuf = "SP"
				RETURN(CLSP_Inscr((LSuf),(LSinscricao),1,0,0,LSMens))

			CASE LSuf = "DF"
				RETURN(CLDF_Inscr((LSuf),(LSinscricao),1,0,0,LSMens))

		ENDCASE
		*--------------------------------------------------*
		* INICIALIZACAO DO PESO
		*--------------------------------------------------*
		DO CASE
			CASE LSuf = "TO"
				LNpeso 		= 9
				LNnro_dgt	= 10
			CASE LSuf = "MT"
				LNpeso 		= 3
				LNnro_dgt	= 10
			CASE LSuf = "PE"
				LNpeso 		= 5
				LNnro_dgt	= 13
			CASE LSuf = "RS"
				LNpeso 		= 2
				LNnro_dgt	= 9
			OTHERWISE
				LNpeso		= 9
				LNnro_dgt	= 8
		ENDCASE
		IF LEN(LSinscricao) < LNnro_dgt + 1
				LSmens 		= "Inscricao com Tamanho Invalido"
				RETURN(.f.)
		ENDIF
		*--------------------------------------------------*
		*   VERIFICANDO CODIGO DA UF
		*--------------------------------------------------*
		LFretorno = .t.
		DO CASE

			CASE LSuf = "AC" AND "0100447400157" $ LSinscricao
				LFretorno 	= .T.

			CASE LSuf = "AC" AND LEFT(LSinscricao,2) <> "01"
				LSmens 		= "Codigo Invalido p/ UF=ACRE"
				LFretorno 	= .f.
			CASE LSuf = "AL" AND LEFT(LSinscricao,2) <> "24"
				LSmens 		= "Codigo Invalido p/ UF=ALAGOAS"
				LFretorno 	= .f.
			CASE LSuf = "AP" AND LEFT(LSinscricao,2) <> "03"
				LSmens 		= "Codigo Invalido p/ UF=AMAPA"
				LFretorno 	= .f.
			*CASE LSuf = "GO" AND LEFT(LSinscricao,2) <> "10"
			*	LSmens 		= "Codigo Invalido p/ UF=GO"
			*	LFretorno 	= .f.
			CASE LSuf = "MA" AND LEFT(LSinscricao,2) <> "12"
				LSmens 		= "Codigo Invalido p/ UF=MA"
				LFretorno 	= .f.
			*CASE LSuf = "MT" AND LEFT(LSinscricao,2) <> "13"
			*	LSmens 		= "Codigo Invalido p/ UF=MT"
			*	LFretorno 	= .f.
			CASE LSuf = "MS" AND LEFT(LSinscricao,2) <> "28"
				LSmens 		= "Codigo Invalido p/ UF=MS"
				LFretorno 	= .f.
			CASE LSuf = "PA" AND LEFT(LSinscricao,2) <> "15"
				LSmens 		= "Codigo Invalido p/ UF=PA"
				LFretorno 	= .f.
			CASE LSuf = "TO" AND (LEFT(LSinscricao,2) <> "29" ;
					OR LEN(LSinscricao) < 11)
				LSmens 		= "Codigo Invalido p/ UF=TO"
				LFretorno 	= .f.
			CASE LSuf = "DF" AND LEFT(LSinscricao,2) <> "07"
				LSmens 		= "Codigo Invalido p/ UF=TO"
				LFretorno 	= .f.
		ENDCASE
		IF LFretorno = .f.
			RETURN(.f.)
		ENDIF
	ENDIF

	*----------------------------------------------------------*
	*  			 1a PARTE - DETERMINANDO A SOMA
	* Esta parte e envolvida na recursao da rotina
	*----------------------------------------------------------*
	DO CASE
		CASE LSuf = "PE"
		IF LNpeso = 0		&& QUANDO CHEGAR A 0 VOLTA A 9
			LNpeso = 9
		ENDIF
	OTHERWISE
		IF LNpeso = 1		&& QUANDO CHEGAR A 0 VOLTA A 9
			LNpeso = 9
		ENDIF
	ENDCASE

	*--------------------------------------------------*
	DO CASE
		CASE UPPER(LSuf) $ ;
			"AC/AL/AP/AM/GO/MT/MS/MA/PA/PB/PE/PI/RN/RS/RO/SC/SE/CE/ES"

			LNdigito = 	INT(VAL(SUBS(LSinscricao,LNposicao,1)))
			LNmult	 =  LNpeso

			*--------------------------------------------------*
			*  USO DA RECURSAO PARA APURAR A SOMA DOS DIGITOS
			*--------------------------------------------------*
			IF LNposicao <> LNnro_dgt
			   LNsoma   = (LNdigito*LNmult)+;
			   CLInscricao(LSuf,LSinscricao,(LNPosicao+1),LNpeso-1,;
			   		LNnro_dgt,LSMens)
			ELSE
				LNsoma   = (LNdigito*LNmult)&& A ultima rcursao devolve so
											&& o digito da posicao
			ENDIF
			IF LNposicao <> 1
				RETURN(LNsoma)
			ENDIF		
		CASE UPPER(LSuf) $ "TO"
			IF LNposicao = 3 OR LNposicao = 4
			   *-----------------------------------------------*
			   *  3a E 4a nao entram no calc => nao decrementa peso
			   *  e nao soma
			   *-----------------------------------------------*
			   LNsoma   = ;
			   CLInscricao(LSuf,LSinscricao,(LNPosicao+1),LNpeso,;
			   		LNnro_dgt,LSMens)
			  RETURN(LNsoma)	
			ENDIF

			LNdigito = 	INT(VAL(SUBS(LSinscricao,LNposicao,1)))
			LNmult	 =  LNpeso

			*--------------------------------------------------*
			*  USO DA RECURSAO PARA APURAR A SOMA DOS DIGITOS
			*--------------------------------------------------*
			IF LNposicao <> LNnro_dgt
			   LNsoma   = (LNdigito*LNmult)+;
			   CLInscricao(LSuf,LSinscricao,(LNPosicao+1),LNpeso-1,;
			   		LNnro_dgt,LSMens)
			ELSE
				LNsoma   = (LNdigito*LNmult)&& A ultima rcursao devolve so
											&& o digito da posicao
			ENDIF
			IF LNposicao <> 1
				RETURN(LNsoma)
			ENDIF		

		OTHERWISE
			LSmens 		= "Verificaao Nao disponivel para UF"
			LFretorno 	= .f.
			RETURN(.F.)
	ENDCASE


	*----------------------------------------------------------*
	*	   2a PARTE - CALCULANDO E COMPARANDO O DIGITO
	* 			Esta parte nao interfere na recursao
	*----------------------------------------------------------*

	DO CASE
		*--------------------------------------------------*
		CASE UPPER(LSuf) $ ;
				"AC/AL/AM/MT/MS/TO/MA/PA/PB/PI/RN/RS/RO/SC/SE/CE/ES"
			LNresto = LNsoma % 11					
			IF LNresto < 2
				LSdg_Found = 0
			ELSE
				LSdg_Found = 11-LNresto
			ENDIF			
			LSdg_Found 	 = CHRTRAN(STR(LSdg_Found ,1)," ","0")
			*------------------------------------------------------*
			LFretorno = .t.
			DO CASE
				CASE UPPER(LSuf) $ "AL"	 AND LNresto =  10 ;
					AND !(SUBS(LSinscricao,LNnro_dgt+1,1) $ "0")
						LSmens 		= "Digito Invalido para Inscricao"
						LFretorno 	= .f.
				CASE LSdg_Found <> SUBS(LSinscricao,LNnro_dgt+1,1)			
					LSmens 		= "Digito Invalido para Inscricao"
					LFretorno 	= .f.
			ENDCASE			
			*------------------------------------------------------*
		CASE UPPER(LSuf) $ "PE"
			LNresto = LNsoma % 11					
			IF LNresto < 2
				LSdg_Found = 11 - LNresto - 10
			ELSE
				LSdg_Found = 11-LNresto
			ENDIF			
			LSdg_Found 	 = CHRTRAN(STR(LSdg_Found ,1)," ","0")
			*------------------------------------------------------*
			LFretorno = .t.
			DO CASE
				CASE LSdg_Found <> SUBS(LSinscricao,LNnro_dgt+1,1)			
					LSmens 		= "Digito Invalido para Inscricao"
					LFretorno 	= .f.
			ENDCASE			
			*------------------------------------------------------*
		CASE UPPER(LSuf) $ "GO"	
			LNresto = (LNsoma*10)%11

			IF LNresto = 10
				LSdg_Found = 0
			ELSE
				LSdg_Found = LNresto
			ENDIF			
			LSdg_Found 	 = CHRTRAN(STR(LSdg_Found ,1)," ","0")
			*------------------------------------------------------*
			LFretorno = .t.
			DO CASE
				CASE LSdg_Found <> SUBS(LSinscricao,LNnro_dgt+1,1)			
						LSmens 		= "Digito Invalido para Inscricao"
						LFretorno 	= .f.
			ENDCASE			
			IF LFretorno = .f.  AND LNresto = 10
				LFretorno = .t.
				LSdg_Found = 1
				LSdg_Found 	 = CHRTRAN(STR(LSdg_Found ,1)," ","0")
				IF LSdg_Found <> SUBS(LSinscricao,LNnro_dgt+1,1)			
					LFretorno 	= .f.
				ENDIF
			ENDIF		



		CASE UPPER(LSuf) = "AP"	&& TRATAMENTO - AMAPA
			*------------------------------------------------------*
			PRIVATE LNnro_insc, LS_dig_P, LS_dig_D
			LNnro_insc	=	INT(VAL(LEFT(LSinscricao,8)))
			DO CASE
				CASE LNnro_insc <= 03017000
					LS_dig_P	=	"5"
					LS_dig_D	=	"0"
				CASE LNnro_insc <= 03019022
					LS_dig_P	=	"9"
					LS_dig_D	=	"1"
				OTHERWISE
					LS_dig_P	=	"0"
					LS_dig_D	=	"1"
			ENDCASE
			LNsoma	= LNsoma + 	INT(VAL(LS_dig_P))

			LNresto = LNsoma % 11					
			IF LNresto < 2
				IF LNresto = 1
					LSdg_Found = 0
				ELSE
					LSdg_Found = INT(VAL(LS_dig_D))
				ENDIF				
			ELSE
				LSdg_Found = 11-LNresto
			ENDIF			
			LSdg_Found 	 = CHRTRAN(STR(LSdg_Found ,1)," ","0")
			*--------------------------------------------------*
			LFretorno = .t.
			DO CASE
				CASE LSdg_Found <> SUBS(LSinscricao,LNnro_dgt+1,1)			
					LSmens 		= "Digito Invalido para Inscricao"
					LFretorno 	= .f.
			ENDCASE			
		OTHERWISE
			LFretorno 	= .f.
	ENDCASE
	
RETURN(LFretorno)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPUP           CLRO_Inscr VALID                   º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIEN_R,     Record Number:   11   º
*       º Variable:            CLRO_Inscr                         º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      35                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4c60mupup     &&  CLRO_Inscr VALID
#REGION 2
RETURN

*** ?UPRO_Inscr("RO","00000000625213")
*** ?UPRO_Inscr("RO","00000000988006")

FUNCTION CLRO_Inscr
	*------------------------------------------------------------*
	* CLASSIFICACAO:  [*****]
	*------------------------------------------------------------*
	* OBJETIVO....: Criticar Inscricoes Estado Rondonia
	*------------------------------------------------------------*
	* COMENTARIO..: Rotina diferenciada das demais
	*------------------------------------------------------------*
	* OBS........ :
	*------------------------------------------------------------*
	*  TABELAS....:
	*------------------------------------------------------------*
	*  PARAMETROS..:
	*		LSUf...........: Estados ao qual pertence Inscricao
	*		LSinscricao....: Numero da Inscricao
	*       LSMens.........: Menssagem de Retorno
	*
	*------------------------------------------------------------*
	*  RETORNO.....:    Na recursao retorna NUMERICO PARA SOMA
	*					No encerramento da rotina retorna LOGICO
	*		LFretorno......: Flag de Retorno .f. ou .t.
	*------------------------------------------------------------*
PARAMETERS LSuf,LSinscricao,LSMens

	PRIVATE LNsoma,LNdigito, LNpeso
	PRIVATE LSBKPinscricao


	LSBKPinscricao = LSinscricao


	*------------------------------------------------------------*
	*  CALCULO NA FORMULA ATE 01/08/2000
	*------------------------------------------------------------*

*    IF LSinscricao = "00000000988006"
*    	RETURN(.T.)
*    ENDIF

	LSinscricao= "0000" + "000"+RIGHT(LSinscricao,6) && ANULAR 3 CASAS DO
										    && CODG MUNICIPIO


	IF LEN(LSinscricao) < 9
			LSmens 		= "Inscricao com Tamanho Invalido"
			RETURN(.f.)
	ENDIF

	*------------------------------------------------------------*
	*  CALCULO DO DIGITO
	*------------------------------------------------------------*


	LNsoma		= 0
	LNpeso      = 6

	FOR LNPosicao = 1 TO 12
		LNdigito = 	INT(VAL(SUBS(LSinscricao,LNposicao,1)))

		LSproduto	= (LNdigito*LNpeso)
	    LNsoma   	= LNsoma+ LSproduto

		LNpeso   	= LNpeso - 1

		IF LNpeso < 2
		   LNpeso = 9
		ENDIF

	NEXT
	

	LSdg_Found = 11 - (LNsoma % 11)


	IF LSdg_found > 9
		LSdg_found	= LSdg_found - 10
	ENDIF
	LSdg_Found 	 = CHRTRAN(STR(LSdg_Found ,1)," ","0")

	*--------------------------------------------------*

	LFretorno = .t.

	IF  LSdg_Found = RIGHT(LSinscricao,1)			
		LSmens 		= ""
		RETURN(.T.)
	ENDIF
	*------------------------------------------------------------*





	*------------------------------------------------------------*
	*  CALCULO NA FORMULA POSTERIOR 01/08/2000
	*------------------------------------------------------------*


	*    A DIFERENCA E QUE NO PROXIMO CALCULO SE A INSCRICAO FOI
	*   INFORMADA COM 14 DIGITOS NENHUM SERA SUBSTITUIDO POR "0"


	*------------------------------------------------------------*

	LSinscricao	= LSBKPinscricao




	LSinscricao= RIGHT("00000000000"+LSinscricao,14)
									 && AS NOVAS INSCRICOES JA
									 && POSSUES 14 DIGITOS
									

	IF LEN(LSinscricao) < 10
			LSmens 		= "Inscricao com Tamanho Invalido"
			RETURN(.f.)
	ENDIF

	*------------------------------------------------------------*
	*  CALCULO DO DIGITO
	*------------------------------------------------------------*


	LNsoma		= 0
	LNpeso      = 6

	FOR LNPosicao = 1 TO 13
		LNdigito = 	INT(VAL(SUBS(LSinscricao,LNposicao,1)))

		LSproduto	= (LNdigito*LNpeso)
	    LNsoma   	= LNsoma+ LSproduto

		LNpeso   	= LNpeso - 1

		IF LNpeso < 2
		   LNpeso = 9
		ENDIF

	NEXT
	

	LSdg_Found = 11 - (LNsoma % 11)


	IF LSdg_found > 9
		LSdg_found	= LSdg_found - 10
	ENDIF
	LSdg_Found 	 = CHRTRAN(STR(LSdg_Found ,1)," ","0")


	*--------------------------------------------------*

	LFretorno = .t.

	*------------------------------------------------------------*
	IF  LSdg_Found <> RIGHT(LSinscricao,1)			
		LSmens 		= "Digito Invalido para Inscricao"
		RETURN(.F.)
	ENDIF


RETURN(LFretorno)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPUQ           CLMG_Inscr VALID                   º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIEN_R,     Record Number:   12   º
*       º Variable:            CLMG_Inscr                         º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      36                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4c60mupuq     &&  CLMG_Inscr VALID
#REGION 2
RETURN

*** ?UPInscricao("AL","240000048",1,0,0,Mens)
*** ?UPInscricao("GO","109876547",1,0,0,Mens)
*** ?UPInscricao("TO","29010227836",1,0,0,Mens)

FUNCTION CLMG_Inscr
	*------------------------------------------------------------*
	* CLASSIFICACAO:  [*****]
	*------------------------------------------------------------*
	* OBJETIVO....: Criticar Inscricoes Estado Minas Gerais
	*------------------------------------------------------------*
	* COMENTARIO..: Rotina diferenciada das demais
	*------------------------------------------------------------*
	* OBS........ :
	*------------------------------------------------------------*
	*  TABELAS....:
	*------------------------------------------------------------*
	*  PARAMETROS..:
	*		LSUf...........: Estados ao qual pertence Inscricao
	*		LSinscricao....: Numero da Inscricao
	*       LNPosicao......: Para uso na Recursividade indica qual
	*						 digito sera testado
	*						 A primeira chamada no prog Principal
	*						 deve passar o valor 1
	*		LNpeso.........: Peso atribuido a posicao do digito a
	*						ser testado ex
	*								INSC : 01.40.7420-0
	*								PESO : 98 76 5432
	*		LNnro_dgt......: Numero de Digito que devem ter seus
	*						produtos somado na inscricao do item
	*						anterior serao os 8 primeiros
	*       LSMens.........: Menssagem de Retorno
	*
	*------------------------------------------------------------*
	*  RETORNO.....:    Na recursao retorna NUMERICO PARA SOMA
	*					No encerramento da rotina retorna LOGICO
	*		LFretorno......: Flag de Retorno .f. ou .t.
	*------------------------------------------------------------*
PARAMETERS LSuf,LSinscricao,LNPosicao,LNpeso,LNnro_dgt,LSMens
	PRIVATE LNsoma,LNdigito,LFretorno, LNmult ,LNdezena,LNresto
	PRIVATE LSproduto


	IF LEFT(LSinscricao,2) = "PR"
		RETURN(.T.)
	ENDIF

	IF "4813973" $ LSinscricao
		RETURN(.T.)
	ENDIF

	IF "9326640" $ LSinscricao
		RETURN(.T.)
	ENDIF

	IF "7049153" $ LSinscricao
		RETURN(.T.)
	ENDIF

	IF "7681267" $ LSinscricao
		RETURN(.T.)
	ENDIF

	IF "7100986" $ LSinscricao
		RETURN(.T.)
	ENDIF

	IF "3635720" $ LSinscricao
		RETURN(.T.)
	ENDIF


	IF LEN(LSinscricao) < 13
			LSmens 		= "Inscricao com Tamanho Invalido"
			RETURN(.f.)
	ENDIF

	*------------------------------------------------------------*
	*  CALCULO DO 1o DIGITO
	*------------------------------------------------------------*
	LSinscricao = LEFT(LSinscricao,3)+"0"+SUBS(LSinscricao,4)
	LNsoma		= 0
	FOR LNPosicao = 1 TO 12
		LNdigito = 	INT(VAL(SUBS(LSinscricao,LNposicao,1)))

		IF LNposicao % 2 = 1
			LNmult	 =  1
		ELSE
			LNmult	 =  2
		ENDIF		
		LSproduto	= (LNdigito*LNmult)
		LSproduto	= CHRTRAN(STR(LNdigito*LNmult,2)," ","0")
	    LNsoma   = LNsoma+ VAL(LEFT(LSproduto,1))  ;
	    				 + VAL(RIGHT(LSproduto,1))
	NEXT
	
	LNdezena = (INT(LNsoma/10)*10)+10	&& 1a DEZENA SUPERIOR A SOMA
	LSdg_Found = LNdezena-LNsoma
	IF LSdg_found > 9
		LSdg_found	= 0
	ENDIF
	LSdg_Found 	 = CHRTRAN(STR(LSdg_Found ,1)," ","0")
	*--------------------------------------------------*
	LFretorno = .t.
	IF  LSdg_Found <> SUBS(LSinscricao,13,1)			
		LSmens 		= "Digito Invalido para Inscricao"
		RETURN(.F.)
	ENDIF
	*------------------------------------------------------------*

	*------------------------------------------------------------*
	*  CALCULO DO 2o DIGITO
	*------------------------------------------------------------*
	* RETIRAR O ZERO INSERIDO NA 4a POSICAO
	*------------------------------------------------------------*

	LSinscricao = LEFT(LSinscricao,3)+SUBS(LSinscricao,5)
	LNmult	 =  3
	LNsoma		= 0
	FOR LNPosicao = 1 TO 12
		LNdigito = 	INT(VAL(SUBS(LSinscricao,LNposicao,1)))

		IF LNmult = 1
			LNmult	 =  11
		ENDIF		
	    LNsoma   = LNsoma+ (LNdigito*LNmult)
		LNmult	 =  LNmult - 1
	NEXT
	*-------------------------------------------------------------*
	LNresto	   = LNsoma % 11
	IF LNresto < 2
		LSdg_Found	=	0
	ELSE
		LSdg_Found = 11-LNresto
	ENDIF
	LSdg_Found 	 = CHRTRAN(STR(LSdg_Found ,1)," ","0")
	*--------------------------------------------------*
	LFretorno = .t.
	IF  LSdg_Found <> SUBS(LSinscricao,13,1)			
		LSmens 		= "Digito Invalido para Inscricao"
		LFretorno 	= .f.
	ENDIF			
RETURN(LFretorno)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPUR           CLBA_Inscr VALID                   º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIEN_R,     Record Number:   13   º
*       º Variable:            CLBA_Inscr                         º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      37                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4c60mupur     &&  CLBA_Inscr VALID
#REGION 2
RETURN

*** ?UPInscricao("AL","240000048",1,0,0,Mens)
*** ?UPInscricao("GO","109876547",1,0,0,Mens)
*** ?UPInscricao("TO","29010227836",1,0,0,Mens)

FUNCTION CLBA_Inscr
	*------------------------------------------------------------*
	* CLASSIFICACAO:  [*****]
	*------------------------------------------------------------*
	* OBJETIVO....: Criticar Inscricoes Estado BAHIA
	*------------------------------------------------------------*
	* COMENTARIO..: Rotina diferenciada das demais
	*------------------------------------------------------------*
	* OBS........ :
	*------------------------------------------------------------*
	*  TABELAS....:
	*------------------------------------------------------------*
	*  PARAMETROS..:
	*		LSUf...........: Estados ao qual pertence Inscricao
	*		LSinscricao....: Numero da Inscricao
	*       LNPosicao......: Para uso na Recursividade indica qual
	*						 digito sera testado
	*						 A primeira chamada no prog Principal
	*						 deve passar o valor 1
	*		LNpeso.........: Peso atribuido a posicao do digito a
	*						ser testado ex
	*								INSC : 01.40.7420-0
	*								PESO : 98 76 5432
	*		LNnro_dgt......: Numero de Digito que devem ter seus
	*						produtos somado na inscricao do item
	*						anterior serao os 8 primeiros
	*       LSMens.........: Menssagem de Retorno
	*
	*------------------------------------------------------------*
	*  RETORNO.....:    Na recursao retorna NUMERICO PARA SOMA
	*					No encerramento da rotina retorna LOGICO
	*		LFretorno......: Flag de Retorno .f. ou .t.
	*------------------------------------------------------------*
PARAMETERS LSuf,LSinscricao,LNPosicao,LNpeso,LNnro_dgt,LSMens
	PRIVATE LNsoma,LNdigito,LFretorno, LNmult ,LNdezena,LNresto
	PRIVATE LS1o_Digt,LS2o_Digt

	IF LEN(LSinscricao) < 8
			LSmens 		= "Inscricao com Tamanho Invalido"
			RETURN(.f.)
	ENDIF

	*------------------------------------------------------------*
	*  CALCULO DO 2o DIGITO
	*------------------------------------------------------------*
	LNsoma		= 0
	LNpeso		= 7
	FOR LNPosicao = 1 TO 6
		LNdigito = 	INT(VAL(SUBS(LSinscricao,LNposicao,1)))
		LNmult	 =  LNpeso
	    LNsoma   = LNsoma+ (LNdigito*LNmult)
		LNpeso	 = LNpeso - 1
	NEXT
	*-------------------------------------------------------------*
	DO CASE
		CASE LEFT(LSinscricao,1) $ "0123458" && USAR MODULO 10
			LNresto	   = LNsoma % 10
			IF LNresto = 0
				LSdg_Found	=	0
			ELSE
				LSdg_Found = 10-LNresto
			ENDIF
		CASE LEFT(LSinscricao,1) $ "679" && USAR MODULO 10
			LNresto	   = LNsoma % 11
			IF LNresto < 2
				LSdg_Found	=	0
			ELSE
				LSdg_Found = 11-LNresto
			ENDIF
		OTHERWISE
			LSdg_Found	=	0
			RETURN(.F.)			
	ENDCASE
	LSdg_Found 	 = CHRTRAN(STR(LSdg_Found ,1)," ","0")
	LS2o_Digt	 = LSdg_Found
	*--------------------------------------------------*
	LFretorno = .t.
	IF  LSdg_Found <> SUBS(LSinscricao,8,1)			
		LSmens 		= "Digito Invalido para Inscricao"
		RETURN(.f.)
	ENDIF			
	*------------------------------------------------------------*

	*------------------------------------------------------------*
	*  CALCULO DO 1o DIGITO
	*------------------------------------------------------------*
	*  INSERIDO 2o DIGITO
	*------------------------------------------------------------*
	*------------------------------------------------------------*
	*  CALCULO DO 2o DIGITO
	*------------------------------------------------------------*
	LNsoma		= 0
	LNpeso		= 8
	FOR LNPosicao = 1 TO 6
		LNdigito = 	INT(VAL(SUBS(LSinscricao,LNposicao,1)))
		LNmult	 =  LNpeso
	    LNsoma   = LNsoma+ (LNdigito*LNmult)
		LNpeso	 = LNpeso - 1
	NEXT
	LNdigito = 	INT(VAL(LS2o_Digt))		&& AGREGANDO 2o DIGITO AO CALCULO
	LNmult	 =  LNpeso
    LNsoma   = LNsoma+ (LNdigito*LNmult)
	LNpeso	 = LNpeso - 1

	*-------------------------------------------------------------*
	DO CASE
		CASE LEFT(LSinscricao,1) $ "0123458" && USAR MODULO 10
			LNresto	   = LNsoma % 10
			IF LNresto = 0
				LSdg_Found	=	0
			ELSE
				LSdg_Found = 10-LNresto
			ENDIF
		CASE LEFT(LSinscricao,1) $ "679" && USAR MODULO 10
			LNresto	   = LNsoma % 11
			IF LNresto < 2
				LSdg_Found	=	0
			ELSE
				LSdg_Found = 11-LNresto
			ENDIF
	ENDCASE
	LSdg_Found 	 = CHRTRAN(STR(LSdg_Found ,1)," ","0")
	LS1o_Digt	 = LSdg_Found
	*--------------------------------------------------*
	LFretorno = .t.
	IF  LSdg_Found <> SUBS(LSinscricao,7,1)			
		LSmens 		= "Digito Invalido para Inscricao"
		LFretorno 	= .f.
	ENDIF			
	*------------------------------------------------------------*
RETURN(LFretorno)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPUS           CLPR_Inscr VALID                   º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIEN_R,     Record Number:   14   º
*       º Variable:            CLPR_Inscr                         º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      38                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4c60mupus     &&  CLPR_Inscr VALID
#REGION 2
RETURN

*** ?UPInscricao("AL","240000048",1,0,0,Mens)
*** ?UPInscricao("GO","109876547",1,0,0,Mens)
*** ?UPInscricao("TO","29010227836",1,0,0,Mens)

FUNCTION CLPR_Inscr
	*------------------------------------------------------------*
	* CLASSIFICACAO:  [*****]
	*------------------------------------------------------------*
	* OBJETIVO....: Criticar Inscricoes Estado PARANA
	*------------------------------------------------------------*
	* COMENTARIO..: Rotina diferenciada das demais
	*------------------------------------------------------------*
	* OBS........ :
	*------------------------------------------------------------*
	*  TABELAS....:
	*------------------------------------------------------------*
	*  PARAMETROS..:
	*		LSUf...........: Estados ao qual pertence Inscricao
	*		LSinscricao....: Numero da Inscricao
	*       LNPosicao......: Para uso na Recursividade indica qual
	*						 digito sera testado
	*						 A primeira chamada no prog Principal
	*						 deve passar o valor 1
	*		LNpeso.........: Peso atribuido a posicao do digito a
	*						ser testado ex
	*								INSC : 01.40.7420-0
	*								PESO : 98 76 5432
	*		LNnro_dgt......: Numero de Digito que devem ter seus
	*						produtos somado na inscricao do item
	*						anterior serao os 8 primeiros
	*       LSMens.........: Menssagem de Retorno
	*
	*------------------------------------------------------------*
	*  RETORNO.....:    Na recursao retorna NUMERICO PARA SOMA
	*					No encerramento da rotina retorna LOGICO
	*		LFretorno......: Flag de Retorno .f. ou .t.
	*------------------------------------------------------------*
PARAMETERS LSuf,LSinscricao,LNPosicao,LNpeso,LNnro_dgt,LSMens
	PRIVATE LNsoma,LNdigito,LFretorno, LNmult ,LNdezena,LNresto
	PRIVATE LS1o_Digt,LS2o_Digt

	IF LEN(LSinscricao) < 10
			LSmens 		= "Inscricao com Tamanho Invalido"
			RETURN(.f.)
	ENDIF

	*------------------------------------------------------------*
	*  CALCULO DO 1o DIGITO
	*------------------------------------------------------------*
	LNsoma		= 0
	LNpeso		= 3
	FOR LNPosicao = 1 TO 8
		LNdigito = 	INT(VAL(SUBS(LSinscricao,LNposicao,1)))
		LNmult	 =  LNpeso
	    LNsoma   = LNsoma+ (LNdigito*LNmult)
		LNpeso	 = LNpeso - 1
		IF LNpeso = 1
			LNpeso = 7
		ENDIF
	NEXT
	*-------------------------------------------------------------*
	LNresto	   = LNsoma % 11
	IF LNresto < 2
		LSdg_Found	=	0
	ELSE
		LSdg_Found = 11-LNresto
	ENDIF

	LSdg_Found 	 = CHRTRAN(STR(LSdg_Found ,1)," ","0")
	*--------------------------------------------------*
	LFretorno = .t.
	IF  LSdg_Found <> SUBS(LSinscricao,9,1)			
		LSmens 		= "Digito Invalido para Inscricao"
		RETURN(.f.)
	ENDIF			
	*------------------------------------------------------------*

	*------------------------------------------------------------*
	*  CALCULO DO 2o DIGITO
	*------------------------------------------------------------*
	*  INSERIDO 2o DIGITO
	*------------------------------------------------------------*
	*------------------------------------------------------------*
	*  CALCULO DO 2o DIGITO
	*------------------------------------------------------------*
	LNsoma		= 0
	LNpeso		= 4
	FOR LNPosicao = 1 TO 9
		LNdigito = 	INT(VAL(SUBS(LSinscricao,LNposicao,1)))
		LNmult	 =  LNpeso
	    LNsoma   = LNsoma+ (LNdigito*LNmult)
		LNpeso	 = LNpeso - 1
		IF LNpeso = 1
			LNpeso = 7
		ENDIF
	NEXT
	*-------------------------------------------------------------*
	LNresto	   = LNsoma % 11
	IF LNresto < 2
		LSdg_Found	=	0
	ELSE
		LSdg_Found = 11-LNresto
	ENDIF
	LSdg_Found 	 = CHRTRAN(STR(LSdg_Found ,1)," ","0")
	*--------------------------------------------------*
	LFretorno = .t.
	IF  LSdg_Found <> SUBS(LSinscricao,10,1)			
		LSmens 		= "Digito Invalido para Inscricao"
		LFretorno 	= .f.
	ENDIF			
	*------------------------------------------------------------*
RETURN(LFretorno)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPW5           CLRR_Inscr VALID                   º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIEN_R,     Record Number:   15   º
*       º Variable:            CLRR_Inscr                         º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      39                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4c60mupw5     &&  CLRR_Inscr VALID
#REGION 2
RETURN

*** ?UPInscricao("AL","240000048",1,0,0,Mens)
*** ?UPInscricao("GO","109876547",1,0,0,Mens)
*** ?UPInscricao("TO","29010227836",1,0,0,Mens)

FUNCTION CLRR_Inscr
	*------------------------------------------------------------*
	* CLASSIFICACAO:  [*****]
	*------------------------------------------------------------*
	* OBJETIVO....: Criticar Inscricoes Estado RORAIMA
	*------------------------------------------------------------*
	* COMENTARIO..: Rotina diferenciada das demais
	*------------------------------------------------------------*
	* OBS........ :
	*------------------------------------------------------------*
	*  TABELAS....:
	*------------------------------------------------------------*
	*  PARAMETROS..:
	*		LSUf...........: Estados ao qual pertence Inscricao
	*		LSinscricao....: Numero da Inscricao
	*       LNPosicao......: Para uso na Recursividade indica qual
	*						 digito sera testado
	*						 A primeira chamada no prog Principal
	*						 deve passar o valor 1
	*		LNpeso.........: Peso atribuido a posicao do digito a
	*						ser testado ex
	*								INSC : 01.40.7420-0
	*								PESO : 98 76 5432
	*		LNnro_dgt......: Numero de Digito que devem ter seus
	*						produtos somado na inscricao do item
	*						anterior serao os 8 primeiros
	*       LSMens.........: Menssagem de Retorno
	*
	*------------------------------------------------------------*
	*  RETORNO.....:    Na recursao retorna NUMERICO PARA SOMA
	*					No encerramento da rotina retorna LOGICO
	*		LFretorno......: Flag de Retorno .f. ou .t.
	*------------------------------------------------------------*
PARAMETERS LSuf,LSinscricao,LNPosicao,LNpeso,LNnro_dgt,LSMens
	PRIVATE LNsoma,LNdigito,LFretorno, LNmult ,LNdezena,LNresto
	PRIVATE LS1o_Digt,LS2o_Digt

	IF LEN(LSinscricao) < 9
		LSmens 		= "Inscricao com Tamanho Invalido"
		RETURN(.f.)
	ENDIF
	IF LEFT(LSinscricao,2) <> "24"
		LSmens 		= "Codigo Invalido p/ UF=RR"
		RETURN(.f.)
	ENDIF

	*------------------------------------------------------------*
	*  CALCULO DO 1o DIGITO
	*------------------------------------------------------------*
	LNsoma		= 0
	FOR LNPosicao = 1 TO 8
		LNdigito = 	INT(VAL(SUBS(LSinscricao,LNposicao,1)))
	    LNsoma   =  LNsoma+ (LNdigito*LNposicao)
	NEXT
	*-------------------------------------------------------------*
	LNresto	   = LNsoma % 9
	LSdg_Found = LNresto

	LSdg_Found 	 = CHRTRAN(STR(LSdg_Found ,1)," ","0")
	*--------------------------------------------------*
	LFretorno = .t.
	IF  LSdg_Found <> SUBS(LSinscricao,9,1)			
		LSmens 		= "Digito Invalido para Inscricao"
		RETURN(.f.)
	ENDIF			
	*------------------------------------------------------------*
RETURN(LFretorno)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPW6           CLSP_Inscr VALID                   º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIEN_R,     Record Number:   16   º
*       º Variable:            CLSP_Inscr                         º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      40                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4c60mupw6     &&  CLSP_Inscr VALID
#REGION 2
RETURN

*** ?UPInscricao("AL","240000048",1,0,0,Mens)
*** ?UPInscricao("GO","109876547",1,0,0,Mens)
*** ?UPInscricao("TO","29010227836",1,0,0,Mens)

FUNCTION CLSP_Inscr
	*------------------------------------------------------------*
	* CLASSIFICACAO:  [*****]
	*------------------------------------------------------------*
	* OBJETIVO....: Criticar Inscricoes Estado SAO PAULO
	*------------------------------------------------------------*
	* COMENTARIO..: Rotina diferenciada das demais
	*				Sao tratadas duas situacoes diferentes
	*					1- PRODUTORES RURAIS
	*					2- INDUSTRIA E COMERCIO
	*------------------------------------------------------------*
	* OBS........ :
	*------------------------------------------------------------*
	*  TABELAS....:
	*------------------------------------------------------------*
	*  PARAMETROS..:
	*		LSUf...........: Estados ao qual pertence Inscricao
	*		LSinscricao....: Numero da Inscricao
	*       LNPosicao......: Para uso na Recursividade indica qual
	*						 digito sera testado
	*						 A primeira chamada no prog Principal
	*						 deve passar o valor 1
	*		LNpeso.........: Peso atribuido a posicao do digito a
	*						ser testado ex
	*								INSC : 01.40.7420-0
	*								PESO : 98 76 5432
	*		LNnro_dgt......: Numero de Digito que devem ter seus
	*						produtos somado na inscricao do item
	*						anterior serao os 8 primeiros
	*       LSMens.........: Menssagem de Retorno
	*
	*------------------------------------------------------------*
	*  RETORNO.....:    Na recursao retorna NUMERICO PARA SOMA
	*					No encerramento da rotina retorna LOGICO
	*		LFretorno......: Flag de Retorno .f. ou .t.
	*------------------------------------------------------------*
PARAMETERS LSuf,LSinscricao,LNPosicao,LNpeso,LNnro_dgt,LSMens
	PRIVATE LNsoma,LNdigito,LFretorno, LNmult ,LNdezena,LNresto

	DO CASE
		CASE LEFT(LSinscricao,1) = "P" 		&& PRODUTOR RURAL
			IF LEN(LSinscricao) < 13
				LSmens 		= "Inscricao com Tamanho Invalido"
				RETURN(.f.)
			ENDIF
			*------------------------------------------------------------*
			*  CALCULO DO 1o DIGITO
			*------------------------------------------------------------*
			LNsoma		= 0
			LNpeso		= 1
			FOR LNPosicao = 2 TO 9
				LNdigito = 	INT(VAL(SUBS(LSinscricao,LNposicao,1)))
				LNmult	 =  LNpeso
			    LNsoma   = LNsoma+ (LNdigito*LNmult)
				IF LNpeso = 1 OR LNpeso = 8
					LNpeso	 = LNpeso + 2
				ELSE
					LNpeso	 = LNpeso + 1
				ENDIF
			NEXT
			*-------------------------------------------------------------*
			LNresto	   = LNsoma % 11
			LSdg_Found = LNresto

			* DIGITO SERA O DIGITO MAIS A DIREITA DO RESTO DA DIVISAO *

			LSdg_Found 	 = CHRTRAN(STR(LSdg_Found ,2)," ","0")
			LSdg_Found 	 = RIGHT(LSdg_Found ,1)

			*--------------------------------------------------*
			LFretorno = .t.
			IF  LSdg_Found <> SUBS(LSinscricao,10,1)			
				LSmens 		= "Digito Invalido para Inscricao"
				RETURN(.f.)
			ENDIF			
			*------------------------------------------------------------*
			RETURN(LFretorno)
		OTHERWISE
			IF LEN(LSinscricao) < 12
				LSmens 		= "Inscricao com Tamanho Invalido"
				RETURN(.f.)
			ENDIF
			*------------------------------------------------------------*
			*  CALCULO DO 1o DIGITO
			*------------------------------------------------------------*
			LNsoma		= 0
			LNpeso		= 1
			FOR LNPosicao = 1 TO 8
				LNdigito = 	INT(VAL(SUBS(LSinscricao,LNposicao,1)))
				LNmult	 =  LNpeso
			    LNsoma   = LNsoma+ (LNdigito*LNmult)
				IF LNpeso = 1 OR LNpeso = 8
					LNpeso	 = LNpeso + 2
				ELSE
					LNpeso	 = LNpeso + 1
				ENDIF
			NEXT
			*-------------------------------------------------------------*
			LNresto	   = LNsoma % 11
			LSdg_Found = LNresto

			* DIGITO SERA O DIGITO MAIS A DIREITA DO RESTO DA DIVISAO *

			LSdg_Found 	 = CHRTRAN(STR(LSdg_Found ,2)," ","0")
			LSdg_Found 	 = RIGHT(LSdg_Found ,1)

			*--------------------------------------------------*
			LFretorno = .t.
			IF  LSdg_Found <> SUBS(LSinscricao,9,1)			
				LSmens 		= "Digito Invalido para Inscricao"
				RETURN(.f.)
			ENDIF			

			*------------------------------------------------------------*
			*  CALCULO DO 2o DIGITO
			*------------------------------------------------------------*
			LNsoma		= 0
			LNpeso		= 3
			FOR LNPosicao = 1 TO 11
				LNdigito = 	INT(VAL(SUBS(LSinscricao,LNposicao,1)))
				LNmult	 =  LNpeso
			    LNsoma   = LNsoma+ (LNdigito*LNmult)
				LNpeso	 = LNpeso - 1
				IF LNpeso = 1
					LNpeso = 10
				ENDIF
			NEXT
			*-------------------------------------------------------------*
			*-------------------------------------------------------------*
			LNresto	   = LNsoma % 11
			LSdg_Found = LNresto

			* DIGITO SERA O DIGITO MAIS A DIREITA DO RESTO DA DIVISAO *

			LSdg_Found 	 = CHRTRAN(STR(LSdg_Found ,2)," ","0")
			LSdg_Found 	 = RIGHT(LSdg_Found ,1)

			*--------------------------------------------------*
			LFretorno = .t.
			IF  LSdg_Found <> SUBS(LSinscricao,12,1)			
				LSmens 		= "Digito Invalido para Inscricao"
				LFretorno = .F.
			ENDIF			
	ENDCASE
RETURN(LFretorno)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPW7           CLDF_Inscr VALID                   º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIEN_R,     Record Number:   17   º
*       º Variable:            CLDF_Inscr                         º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      41                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4c60mupw7     &&  CLDF_Inscr VALID
#REGION 2
RETURN

*** ?UPInscricao("AL","240000048",1,0,0,Mens)
*** ?UPInscricao("GO","109876547",1,0,0,Mens)
*** ?UPInscricao("TO","29010227836",1,0,0,Mens)

FUNCTION CLDF_Inscr
	*------------------------------------------------------------*
	* CLASSIFICACAO:  [*****]
	*------------------------------------------------------------*
	* OBJETIVO....: Criticar Inscricoes EstadoDF
	*------------------------------------------------------------*
	* COMENTARIO..: Rotina diferenciada das demais
	*------------------------------------------------------------*
	* OBS........ :
	*------------------------------------------------------------*
	*  TABELAS....:
	*------------------------------------------------------------*
	*  PARAMETROS..:
	*		LSUf...........: Estados ao qual pertence Inscricao
	*		LSinscricao....: Numero da Inscricao
	*       LNPosicao......: Para uso na Recursividade indica qual
	*						 digito sera testado
	*						 A primeira chamada no prog Principal
	*						 deve passar o valor 1
	*		LNpeso.........: Peso atribuido a posicao do digito a
	*						ser testado ex
	*								INSC : 01.40.7420-0
	*								PESO : 98 76 5432
	*		LNnro_dgt......: Numero de Digito que devem ter seus
	*						produtos somado na inscricao do item
	*						anterior serao os 8 primeiros
	*       LSMens.........: Menssagem de Retorno
	*
	*------------------------------------------------------------*
	*  RETORNO.....:    Na recursao retorna NUMERICO PARA SOMA
	*					No encerramento da rotina retorna LOGICO
	*		LFretorno......: Flag de Retorno .f. ou .t.
	*------------------------------------------------------------*
PARAMETERS LSuf,LSinscricao,LNPosicao,LNpeso,LNnro_dgt,LSMens
	PRIVATE LNsoma,LNdigito,LFretorno, LNmult ,LNdezena,LNresto
	PRIVATE LS1o_Digt,LS2o_Digt

	IF LEN(LSinscricao) < 13
			LSmens 		= "Inscricao com Tamanho Invalido"
			RETURN(.f.)
	ENDIF

	*------------------------------------------------------------*
	*  CALCULO DO 1o DIGITO
	*------------------------------------------------------------*
	LNsoma		= 0
	LNpeso		= 4
	FOR LNPosicao = 1 TO 11
		LNdigito = 	INT(VAL(SUBS(LSinscricao,LNposicao,1)))
		LNmult	 =  LNpeso
	    LNsoma   = LNsoma+ (LNdigito*LNmult)
		LNpeso	 = LNpeso - 1
		IF LNpeso = 1
			LNpeso = 9
		ENDIF
	NEXT
	*-------------------------------------------------------------*
	LNresto	   = LNsoma % 11
	IF LNresto < 2
		LSdg_Found	=	0
	ELSE
		LSdg_Found = 11-LNresto
	ENDIF

	LSdg_Found 	 = CHRTRAN(STR(LSdg_Found ,1)," ","0")
	*--------------------------------------------------*
	LFretorno = .t.
	IF  LSdg_Found <> SUBS(LSinscricao,12,1)			
		LSmens 		= "Digito Invalido para Inscricao"
		RETURN(.f.)
	ENDIF			
	*------------------------------------------------------------*

	*------------------------------------------------------------*
	*  CALCULO DO 2o DIGITO
	*------------------------------------------------------------*
	*  INSERIDO 2o DIGITO
	*------------------------------------------------------------*
	*------------------------------------------------------------*
	*  CALCULO DO 2o DIGITO
	*------------------------------------------------------------*
	LNsoma		= 0
	LNpeso		= 5
	FOR LNPosicao = 1 TO 12
		LNdigito = 	INT(VAL(SUBS(LSinscricao,LNposicao,1)))
		LNmult	 =  LNpeso
	    LNsoma   = LNsoma+ (LNdigito*LNmult)
		LNpeso	 = LNpeso - 1
		IF LNpeso = 1
			LNpeso = 9
		ENDIF
	NEXT
	*-------------------------------------------------------------*
	LNresto	   = LNsoma % 11
	IF LNresto < 2
		LSdg_Found	=	0
	ELSE
		LSdg_Found = 11-LNresto
	ENDIF
	LSdg_Found 	 = CHRTRAN(STR(LSdg_Found ,1)," ","0")
	*--------------------------------------------------*
	LFretorno = .t.
	IF  LSdg_Found <> SUBS(LSinscricao,13,1)			
		LSmens 		= "Digito Invalido para Inscricao"
		LFretorno 	= .f.
	ENDIF			
	*------------------------------------------------------------*
RETURN(LFretorno)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPW8           CLTO_AntigaInscr VALID             º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIEN_R,     Record Number:   18   º
*       º Variable:            CLTO_AntigaInscr                   º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      42                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4c60mupw8     &&  CLTO_AntigaInscr VALID
#REGION 2
RETURN


	*------------------------------------------------------------*
	* CLASSIFICACAO:  [*****]
	*------------------------------------------------------------*
	* OBJETIVO....: Criticar Inscricoes Antigas
	*               Valida ate dezembro 2003
	*               Estado Tocantins
	*------------------------------------------------------------*
	*------------------------------------------------------------*
	*  PARAMETROS..:
	*		LSinscricao....: Numero da Inscricao
	*       LSMens.........: Menssagem de Retorno
	*
	*------------------------------------------------------------*
	*  RETORNO.....:
	*		LFretorno......: Flag de Retorno .f. ou .t.
	*------------------------------------------------------------*
FUNCTION CLTO_AntigaInscr
PARAMETERS LSinscricao,LSMens
	PRIVATE LNPosicao
	PRIVATE LNsoma
	PRIVATE LNdigito
	PRIVATE LFretorno
	PRIVATE LNmult
	PRIVATE LNdezena
	PRIVATE LNresto
	PRIVATE LSproduto

	IF LEN(LSinscricao) < 11
			LSmens 		= "Inscricao com Tamanho Invalido"
			RETURN(.f.)
	ENDIF

	*------------------------------------------------------------*
	*  CALCULO DO 1o DIGITO
	*------------------------------------------------------------*
	LNsoma		=  0
	LNmult	    =  9

	FOR LNPosicao = 1 TO 10

		IF LNPosicao <> 3 and  LNPosicao <> 4
			LNdigito    = INT(VAL(SUBS(LSinscricao,LNposicao,1)))
			LSproduto	= (LNdigito*LNmult)
			LSproduto	= CHRTRAN(STR(LNdigito*LNmult,2)," ","0")
		    LNsoma   	= LNsoma+ VAL(LSproduto)
	    	LNmult 		= LNmult - 1
	   	ENDIF
	NEXT
	
	LNdezena = (LNsoma % 11)	&& Divisao Modal =>  Resto

	IF LNdezena >= 2
		LSdg_Found = 11-LNdezena
	else
		LSdg_Found = 0
	ENDIF
	
	LSdg_Found 	 = CHRTRAN(STR(LSdg_Found ,1)," ","0")
	*--------------------------------------------------*
	LFretorno = .t.
	IF  LSdg_Found <> SUBS(LSinscricao,11,1)			
		LSmens 		= "Digito Invalido para Inscricao"
		RETURN(.F.)
	ENDIF
	*------------------------------------------------------------*
RETURN(LFretorno)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPW9           CLTO_NovaInscr VALID               º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIEN_R,     Record Number:   19   º
*       º Variable:            CLTO_NovaInscr                     º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      43                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4c60mupw9     &&  CLTO_NovaInscr VALID
#REGION 2
RETURN


	*------------------------------------------------------------*
	* CLASSIFICACAO:  [*****]
	*------------------------------------------------------------*
	* OBJETIVO....: Criticar Inscricoes Nova
	*               Valida a partir de janeiro 2003
	*               Estado Tocantins
	*------------------------------------------------------------*
	*------------------------------------------------------------*
	*  PARAMETROS..:
	*		LSinscricao....: Numero da Inscricao
	*       LSMens.........: Menssagem de Retorno
	*
	*------------------------------------------------------------*
	*  RETORNO.....:
	*		LFretorno......: Flag de Retorno .f. ou .t.
	*------------------------------------------------------------*
FUNCTION CLTO_NovaInscr
PARAMETERS LSinscricao,LSMens
	PRIVATE LNPosicao
	PRIVATE LNsoma
	PRIVATE LNdigito
	PRIVATE LFretorno
	PRIVATE LNmult
	PRIVATE LNdezena
	PRIVATE LNresto
	PRIVATE LSproduto

	IF LEN(ALLTRIM(LSinscricao)) <> 9
			LSmens 		= "Inscricao com Tamanho Invalido"
			RETURN(.f.)
	ENDIF

	*------------------------------------------------------------*
	*  CALCULO DO 1o DIGITO
	*------------------------------------------------------------*
	LNsoma		=  0
	LNmult	    =  9

	FOR LNPosicao = 1 TO 8

		LNdigito    = INT(VAL(SUBS(LSinscricao,LNposicao,1)))
		LSproduto	= (LNdigito*LNmult)
		LSproduto	= CHRTRAN(STR(LNdigito*LNmult,2)," ","0")
	    LNsoma   	= LNsoma+ VAL(LSproduto)
    	LNmult 		= LNmult - 1
	NEXT
	
	LNdezena = (LNsoma % 11)	&& Divisao Modal =>  Resto

	IF LNdezena >= 2
		LSdg_Found = 11-LNdezena
	else
		LSdg_Found = 0
	ENDIF
	
	LSdg_Found 	 = CHRTRAN(STR(LSdg_Found ,1)," ","0")
	*--------------------------------------------------*
	LFretorno = .t.
	IF  LSdg_Found <> SUBS(LSinscricao,9,1)			
		LSmens 		= "Digito Invalido para Inscricao"
		RETURN(.F.)
	ENDIF
	*------------------------------------------------------------*
RETURN(LFretorno)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPWA           CLItensAdq VALID                   º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIEN_R,     Record Number:   20   º
*       º Variable:            CLItensAdq                         º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      44                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4c60mupwa     &&  CLItensAdq VALID
#REGION 2
return

*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION CLItensAdq

PARAMETERS PRcliente, PRdata

	*------------------------------------------------------------*
	* CLASSIFICACAO:  [*****]
	*------------------------------------------------------------*
	* OBJETIVO....: Obter o Valor de Ajuste de Credito na
	*  			data especificada
	*------------------------------------------------------------*
	* COMENTARIO..:
	*------------------------------------------------------------*
	* OBS........ :
	*------------------------------------------------------------*
	*  TABELAS....:
	*------------------------------------------------------------*
	*  PARAMETROS..:
	*						
	*------------------------------------------------------------*
	*  RETORNO.....:
	*------------------------------------------------------------*
	* EXEMPLO  :
	*------------------------------------------------------------*

	=W_DEFPROC("rotinas.spr")
	
	*-----------------------------------------------------------*
	PRIVATE LSalias
	PRIVATE ARQ_CtrlCred, ALS_CtrlCred
	PRIVATE LNvalor
	*-----------------------------------------------------------*
	LSalias	= ALIAS()
    ARQ_CtrlCred    = NetArqAgain("CTRLCRED")
    ALS_CtrlCred   	= Alias()
	*------------------------------------------------------------*

   	SELE &ALS_CtrlCred
  	SET ORDER TO TAG key_unica
    SEEK STR(PRcliente,14) + DTOS(PRdata)
    IF FOUND()
		LNvalor =  &ALS_CtrlCred .CR_NOVO - &ALS_CtrlCred .CR_ANTIGO
	ELSE
		LNvalor =  0
   	ENDIF	

    =up_fecha("&ALS_CtrlCred")

	*------------------------------------------------------------------*

	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(LNvalor)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPWB           CLVldCli VALID                     º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIEN_R,     Record Number:   21   º
*       º Variable:            CLVldCli                           º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      45                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4c60mupwb     &&  CLVldCli VALID
#REGION 2
return

*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION CLVldCli
PARAMETERS LNcliente,LSinscricao

	*------------------------------------------------------------*
	* CLASSIFICACAO:  [*****]
	*------------------------------------------------------------*
	*------------------------------------------------------------*
	=W_DEFPROC("rotinas.spr")

	PRIVATE LSalias
	PRIVATE LFretorno
	PRIVATE LSmsg
	*-----------------------------------------------------------*
	LSalias	= ALIAS()
	IF !USED("CLIENTES")
		IF !EMPTY(LSalias) AND USED(LSalias)
			SELECT &LSalias
		ENDIF
		RETURN(.f.)
	ENDIF
	*-----------------------------------------------------------*
	SELECT clientes
	SET ORDER TO TAG cliente
	*-----------------------------------------------------------*
   	IF LASTKEY() <> 27
		SET NEAR ON
		SEEK LNcliente
		SET NEAR OFF
	    IF FOUND() AND !EMPTY(LSinscricao)
			DO WHILE !EOF() AND LNcliente = clientes.cliente
				IF LSinscricao = clientes.inscricao
					EXIT
				ENDIF
			    SKIP	&& VERIFICA SE E DUPLICADO E CHECA A INSCRICAO
			ENDDO
			IF EOF() OR LNcliente <> clientes.cliente OR ;
		  			LSinscricao <> clientes.inscricao
					SKIP -1			  && PEGAR DADOS DO REG. LOCALIZADP
			ENDIF				  && PRIMEIRO
		ENDIF
		IF LNcliente	= 	clientes.cliente
			LSinscricao	=	clientes.inscricao
		ENDIF
	ENDIF
	*-----------------------------------------------------------*
	*-----------------------------------------------------------*
	*	Critica a localizacao do registro
	*-----------------------------------------------------------*
	IF (LNcliente = 0 OR !FOUND() )
		IF (LNcliente <> 0 AND !FOUND() )
			LSmsg = "Cliente nao cadastrado. Informe "+;
						"dados ou Solicite cadastro. <ENTER>"
			=UPbeeps(.F.,LSmsg)
		ENDIF
		IF !EMPTY(LSalias) AND USED(LSalias)
			SELECT &LSalias
		ENDIF
		RETURN(.F.)
	ENDIF
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(.T.)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPXO           CLimpARCA VALID                    º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIEN_R,     Record Number:   22   º
*       º Variable:            CLimpARCA                          º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      46                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4c60mupxo     &&  CLimpARCA VALID
#REGION 2
return

*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

PROCEDURE CLimpARCA

    SET DATE GERMAN
    SET CENTU ON

	LsDados =chr(34) && char '"'   aspas seguida de espaco


	=UPTrataArq("C:\TMP\CLIENTES.XML","C:\TMP\CLI_REC.XML")
	DO ULcadClie



	=UPTrataArq("C:\TMP\LIMITE.XML","C:\TMP\LMT_REC.XML")
	*DO ULcadLimite

RETURN
*******************************************************************
* TRATAMENTO DE ARQUIVOS TEXTOS
*     Trata dados de um arquivo origem DANIFICADO
*   para um arquivo destino TRATADO
*
* DIRETORIOS FIXOS
*					 \SCGC\RECUPERA\  (ESTRUTURAS VAZIAS)		
*					 \TMP\			  (DIRETORIO TEMPORARIO)
*******************************************************************
FUNCTION UPTrataArq
PARAMETERS PrmArqOrigem,PrmArqDestino

   PRIVATE lErro
   PRIVATE LSfiledanificado, LNdanif,LNtamdanif
   PRIVATE LSfilerecuperado, LNrecup
   PRIVATE LSchar,Lstring
   PRIVATE LSorigfie,LSdestfie
   CLOSE ALL

   LSfilerecuperado=PrmArqDestino
   LNrecup 			=fcreate(LSfilerecuperado)
   if LNrecup<0
      =fclose(LNrecup)
      wait 'ERRO cria‡Æo arquivo tempor rio <Enter>' window
      return
   endif



   LSfiledanificado=PrmArqOrigem
   LNdanif    =fopen(LSfiledanificado,0)
   LNtamdanif =fseek(LNdanif,0,2)
   if LNdanif<0 or LNtamdanif<=0
      =fclose(LNdanif)
      wait 'ERRO abertura arquivo <Enter>' window
      return
   endif


	LSchar = ""
	LString = ""
	

	DO  GRVCabecalho
*	DO  FORACAB
	do while !feof(LNdanif)
		DO  IMPODADOS
	ENDDO


		
	
	if lastkey()=27
   		wait 'Processamento interrompido pelo usu rio <Enter>' window
	    =fclose(LNdanif)
	    =fclose(LNrecup)
	endif
   =fclose(LNdanif)
   =fclose(LNrecup)
   *************************************************************



return

PROCEDURE GRVCabecalho
   *************************************************************
    =fseek(LNdanif,0,0) && move ponteiro p/bof
	LSchar = ""
	LString = ""
	LsDados =chr(34) && char '" '   aspas seguida de espaco

	do while !feof(LNdanif)
      		wait 'Reconstruindo Registros...'+left(LSchar,30)+' <Esc> Pausa' window nowait
      		if inkey()=27
         		wait '<Enter> Continua  <Esc> Pausa' window nowait
         		if inkey(0)=27

            		exit
         		endif
      		endif

      		LSchar = FGETS(LNdanif,1)
      		LString = LString+LSchar

			IF LSchar = ">"
	       		=fPuts(LNrecup,LString,LEN(LString))
	      		LString = ""
			ENDIF

			IF "<ROW " $ LString
	       		=fPuts(LNrecup,LString,LEN(LString))
	      		LString = ""
				EXIT
			ENDIF
	enddo
RETURN

PROCEDURE FORACAB
   *************************************************************
    =fseek(LNdanif,0,0) && move ponteiro p/bof
	LSchar = ""
	LString = ""
	LsDados =chr(34) && char '" '   aspas seguida de espaco

	
	do while !feof(LNdanif)
      		wait 'Reconstruindo Registros...'+left(LSchar,30)+' <Esc> Pausa' window nowait
      		if inkey()=27
         		wait '<Enter> Continua  <Esc> Pausa' window nowait
         		if inkey(0)=27

            		exit
         		endif
      		endif

      		LSchar = FGETS(LNdanif,1)
      		LString = LString+LSchar

			IF LSchar = ">"
	      		LString = ""
			ENDIF

			IF "<ROW " $ LString
	      		LString = ""
				EXIT
			ENDIF

*			IF "<ROWDATA>" $ LString
*	      		LString = ""
*				EXIT
*			ENDIF
	enddo

RETURN

PROCEDURE impodados

	do while !feof(LNdanif)
      		wait 'Reconstruindo Registros...'+left(LSchar,30)+' <Esc> Pausa' window nowait
      		if inkey()=27
         		wait '<Enter> Continua  <Esc> Pausa' window nowait
         		if inkey(0)=27

            		exit
         		endif
      		endif


      		LSchar = LERCHAR()

*			IF LSchar = "/"  OR LSchar = LsDados
*				SET STEP ON
*			ENDIF

			DO CASE
			   CASE LSchar = "/"
	       		    LSNextChar = LERCHAR()
					IF LSNextChar = ">"
						=fPuts(LNrecup,LString,LEN(LString))
*	      				LString = "/>"
					ENDIF
   			  		LString = LString+LSchar+LSNextChar
			   CASE  LSchar = LsDados   && ASPAS
   			  		LString = LString+LSchar
   			  		LSchar = ""
   			  		

	       		    LSNextChar = LERCHAR()
					IF  LSNextChar = LsDados    && COUTRA ASPAS CAMPO VAZIO
    			  		LString = LString+LSNextChar
		       		    LSNextChar = LERCHAR()
					ENDIF
					
					DO CASE
						CASE LSNextChar $ " "
	    			  		LString = LString+LSNextChar
				       		=fPuts(LNrecup,LString,LEN(LString))
			    	  		LString = ""
						CASE LSNextChar $ "/"
				       		=fPuts(LNrecup,LString,LEN(LString))
			    	  		LString = ""
		      				LString = "/"
							EXIT
						OTHERWISE
		   			  		LString = LString+LSNextChar
					ENDCASE
					
				OTHERWISE
   			  		LString = LString+LSchar
			ENDCASE
			IF "<ROW " $ LString
	       		=fPuts(LNrecup,LString,LEN(LString))
	      		LString = ""
				EXIT
			ENDIF
			
	enddo

	if LEN(LString) > 0
		=fPuts(LNrecup,LString,LEN(LString))
	ENDIF

RETURN

FUNCTION LERCHAR
	PRIVATE Lchar
	Lchar = FGETS(LNdanif,1)
RETURN(Lchar)

PROCEDURE ULcadClie
	SELE 0
	USE X:\SCGC\LOJA\CLIENTES

	SELE 0
	USE LINHA EXCL
	ZAP
	PACK
	APPEND FROM C:\TMP\CLI_REC.XML TYPE SDF
	GO TOP

    LSano	  = ""
	LSmes	  = ""
	LSdia	  = ""
	LSTipoEnd = ""


	m.CBendereco 	= ""
	m.CBcep 		= ""
	m.CBbairro 		= ""
	m.CBcidade 		= ""
    m.CBestado 		= ""

	m.endereco 	= ""
	m.cep 		= ""
	m.bairro 	= ""
	m.muni_ibge = 0
	m.cidade 	= ""
    m.estado 	= ""


	m.empresa = 1   && wp_empresa

	DO WHILE !EOF()
		

		IF "/>" $ LINHA    && FINAL DE UM REGISTRO
			SET STEP ON
			DO CASE
				CASE left(LSTipoEnd,3) $ "Fat/Res/End"
					m.endereco 	= Lendereco
					m.cep 		= Lcep
					m.bairro 	= Lbairro
					m.muni_ibge = Lmuni_ibge
					m.cidade 	= Lcidade
				    m.estado 	= Lestado
				CASE LEFT(LSTipoEnd,3) $ "Cob"
					m.CBendereco = Lendereco
					m.CBcep 	 = Lcep
					m.CBbairro 	 = Lbairro
					m.muni_ibge  = Lmuni_ibge
					m.CBcidade 	 = Lcidade
				    m.CBestado 	 = Lestado
			ENDCASE
			LTipoEnd 	= ""
			Lendereco 	= ""
			Lcep 		= ""
			Lbairro 	= ""
			Lmuni_ibge 	= 0
			Lcidade 	= ""
		    Lestado 	= ""
		ENDIF	




		DO CASE
			CASE LEFT(LINHA,23) = "CLNT_CLNT_DATA_CADASTRO"
			   LSano= SUBS(LINHA,26,4)
			   LSmes= SUBS(LINHA,30,2)
			   LSdia= SUBS(LINHA,32,2)
		       m.dtcad = ctod(LSdia+"/"+LSmes+"/"+LSano)

			CASE LEFT(LINHA,12) = "PESS_PESS_ID"
			   m.empresa = INT(VAL(SUBS(LINHA,23,4)))

			CASE LEFT(LINHA,22) = "PESS_PESS_RAZAO_SOCIAL"
			   m.nome= SUBS(LINHA,25)
			   m.nome= RTRIM(STRTRAN(m.nome,LsDados,""))
			   m.CBnome= m.nome

			CASE LEFT(LINHA,14) =    "PESS_PESS_NOME"
			   m.fantasia= SUBS(LINHA,17)
			   m.fantasia= RTRIM(STRTRAN(m.fantasia,LsDados,""))

			CASE LEFT(LINHA,17) =    "PESS_PESS_CPFCNPJ"
			   m.cliente= INT(VAL(SUBS(LINHA,20)))


			CASE LEFT(LINHA,25) =    "PESS_PESS_FISICO_JURIDICO"

			   IF "Jur" $ subs(LINHA,28)
			     m.tp_pessoa = 2   && JURIDICA
			   ELSE
			     m.tp_pessoa = 1   && FISICA
			   ENDIF

			CASE LEFT(LINHA,28) =    "CLNT_CLNT_OBJETIVO_COMERCIAL"

			   IF "Consumo" $ subs(LINHA,31)
			     m.revendedor = "N"
			   ELSE
			     m.revendedor = "S"
			   ENDIF

			CASE LEFT(LINHA,16) =    "DOCS_DOCS_NUMERO"
			   m.inscricao = SUBS(LINHA,19)
			   IF "ISENTO" $ m.inscricao
			      m.tp_inscr = 2
			   ELSE
			      m.tp_inscr = 1
			   ENDIF
			   m.inscricao= RTRIM(STRTRAN(m.inscricao,LsDados,""))

			CASE LEFT(LINHA,14) =    "TPEN_TPEN_NOME"
			   LSTipoEnd 	= SUBS(LINHA,17)
			   LSTipoEnd= RTRIM(STRTRAN(LSTipoEnd,LsDados,""))

			CASE LEFT(LINHA,25) =    "ENDE_ENDE_TIPO_LOGRADOURO"
			   Lendereco 	= SUBS(LINHA,28)
			   Lendereco= RTRIM(STRTRAN(Lendereco,LsDados,""))

			CASE LEFT(LINHA,16) =    "ENDE_ENDE_NUMERO"
			   Lendereco 	= Lendereco+" "+SUBS(LINHA,19)
			   Lendereco= RTRIM(STRTRAN(Lendereco,LsDados,""))

			CASE LEFT(LINHA,20) =    "ENDE_ENDE_LOGRADOURO"
			   Lendereco 	= Lendereco+" "+SUBS(LINHA,23)
			   Lendereco= RTRIM(STRTRAN(Lendereco,LsDados,""))

			CASE LEFT(LINHA,21) =    "ENDE_ENDE_COMPLEMENTO"
			   Lendereco 	= Lendereco+" "+SUBS(LINHA,24)
			   Lendereco= RTRIM(STRTRAN(Lendereco,LsDados,""))

			CASE LEFT(LINHA,13) =    "ENDE_ENDE_CEP"
			   Lcep = SUBS(LINHA,16)
			   Lcep = RTRIM(STRTRAN(Lcep,LsDados,""))

			CASE LEFT(LINHA,14) =    "BAIR_BAIR_NOME"
			   Lbairro 	= SUBS(LINHA,17)
			   Lbairro  = RTRIM(STRTRAN(Lbairro,LsDados,""))

			CASE LEFT(LINHA,14) =    "MUNI_MUNI_IBGE"
			   Lmuni_ibge 	= INT(VAL(SUBS(LINHA,17)))

			CASE LEFT(LINHA,14) =    "MUNI_MUNI_NOME"
			   Lcidade 	= SUBS(LINHA,17)
			   Lcidade  = RTRIM(STRTRAN(Lcidade,LsDados,""))

			CASE LEFT(LINHA,12) =    "ESTA_ESTA_UF"
			   Lestado 	= SUBS(LINHA,15)
			   Lestado= RTRIM(STRTRAN(Lestado,LsDados,""))

			CASE LEFT(LINHA,16) =    "TELE_TELE_NUMERO"
			   m.fone = SUBS(LINHA,19)
			   m.fone= RTRIM(STRTRAN(m.fone,LsDados,""))

			CASE LEFT(LINHA,23) =    "LMCR_LMCR_LIMITE_MENSAL"
			   m.credito= INT(VAL(SUBS(LINHA,26)))


		ENDCASE
		SELE LINHA
		SKIP
	ENDDO
	
	IF EMPTY(m.CBendereco)
		m.CBendereco 	= m.endereco
		m.CBcep 		= m.cep
		m.CBbairro 		= m.bairro
		m.CBcidade 		= m.cidade
	    m.CBestado 		= m.estado
	ENDIF




	SELE CLIENTES
	SET ORDER TO TAG CLIENTE
	SEEK M.CLIENTE
	IF !FOUND()
		APPEND BLANK
	ENDIF
	=RLOCK()
	GATHER MEMVAR
	

RETURN



*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPXP           CLVld_CPF_CNPJ VALID               º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIEN_R,     Record Number:   23   º
*       º Variable:            CLVld_CPF_CNPJ                     º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      47                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4c60mupxp     &&  CLVld_CPF_CNPJ VALID
#REGION 2
RETURN


*--------------------------------------------------------------------*
* objetivo : consiste CGC ou CPF                                     *
*--------------------------------------------------------------------*

FUNCTION CLVld_CPF_CNPJ
   parameter PrmCPF_Cnpj

   PRIVATE LNTMP

   IF EMPTY(PrmCPF_Cnpj)
   	  return(.f.)
   ENDIF
	

   LNtmp = CLCalc_cgc(PrmCPF_Cnpj)

*   IF  isadding AND LNtmp = "3"
*		RETURN(.F.)
*   ENDIF

   IF LNtmp = "3"
		RETURN(.F.)
   ENDIF


RETURN(.T.)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPXQ           CLDef_TipoPessoa VALID             º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIEN_R,     Record Number:   24   º
*       º Variable:            CLDef_TipoPessoa                   º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      48                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4c60mupxq     &&  CLDef_TipoPessoa VALID
#REGION 2
RETURN


*--------------------------------------------------------------------*

FUNCTION CLDef_TipoPessoa
   parameter PrmCPF_Cnpj



   PRIVATE LNTMP
   PRIVATE LNtp_pessoa

   LNtmp = CLCalc_cgc(PrmCPF_Cnpj)

   DO CASE
	
		CASE LNtmp = "1"
			LNtp_pessoa = 1
		CASE LNtmp = "2"
			LNtp_pessoa = 2
		OTHERWISE
			LNtp_pessoa = 0
   ENDCASE
RETURN(LNtp_pessoa)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPXR           CLEsperaRspCad VALID               º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIEN_R,     Record Number:   26   º
*       º Variable:            CLEsperaRspCad                     º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      49                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4c60mupxr     &&  CLEsperaRspCad VALID
#REGION 2
return
*---------------------------------------------------------------*

FUNCTION CLEsperaRspCad
PARAMETERS PrmEmpresa


	*-------------------------------------------------------*
	PRIVATE LSstatus
	PRIVATE CtrAguarda

	LSstatus = ""

    CtrAguarda = 0
	LFlgEspera = .t.

	DO WHILE LFlgEspera


		LSstatus=CLBuscaArqRspCad(PrmEmpresa)

		DO CASE
 		 	CASE "ERRO ! Espera interrompida por usr" $ LSstatus
				LFlgEspera = .F.
		
			otherwise
				LFlgEspera = .F.

		ENDCASE
	ENDDO
    LSmsg = "Concluido leitura XML............ "
	WAIT WINDOW LSmsg NOWAIT

RETURN(LSstatus)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPXS           CLBuscaRspCad VALID                º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIEN_R,     Record Number:   27   º
*       º Variable:            CLBuscaRspCad                      º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      50                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4c60mupxs     &&  CLBuscaRspCad VALID
#REGION 2
return
*---------------------------------------------------------------*

FUNCTION CLBuscaRspCad
PARAMETERS PrmEmpresa

	*-------------------------------------------------------*

	PRIVATE LSnroDoc
	PRIVATE LNfile
	PRIVATE LSstatus,LSFile,LNctr,TECLA




	*-------------------------------------------------------*
	*  obter o MOD_DOC
	*-------------------------------------------------------*



	*----------------------------------------------------------*

	LSstatus = ""
	LNfile = 0



	*--------------------------------------------------*

	=W_DEFPROC("PARAMETR.SPR")

	LSPathDestino   = PMGetFieldValue(PrmEmpresa,"DIR_DFIS")



    IF TYPE("LSPathDestino") <> "C" or EMPTY(LSPathDestino)
         LSPathDestino = "C:\NFE\"
	else
         LSPathDestino = ALLTRIM(LSPathDestino)
    ENDIF


	*--------------------------------------------------*



	LSFile    = LSPathDestino+"EXPCLIEN.TXT"


	LNctr = 0

	CLEAR TYPEAHEAD


	DO WHILE !(FILE(LSFile))

   	   LSmsg = STR(LNctr,3)+"-Aguarda Cadastro - <ESC>=Sai "+LSFile

		WAIT WINDOW LSmsg NOWAIT
		TECLA=INKEY(3)
		LNctr = LNctr + 1
		IF  LNctr > 1   && > 60
			EXIT
		ENDIF
		IF TECLA = 27 OR LASTKEY() = 27
			IF fox_alert("Interrompe Espera Cadastro ? ")
				LSstatus = "ERRO ! Espera interrompida por usr"
				EXIT
			ENDIF
		ENDIF

	ENDDO

	DO CASE
		CASE LSstatus = "ERRO ! Espera interrompida por usr"
 		 	LSstatus = "ERRO ! Espera interrompida por usr"

		CASE !FILE(LSFile)
			LSstatus = "ERRO ! Nao houve retorno do comando"

		OTHERWISE		
			TECLA=INKEY(3)

            =CLImpCadOrion(LSFile)
			LSstatus=""

			IF FILE(LSFile)
		   		delete file &LSFile
			ENDIF


	ENDCASE

	*---------------------------------------------------*
	* as barrar fornecem uma orientacao para se tratar
	* o retorno quando nao sao informados todos os
	* parametros de retorno.
	* A rotina (DFRespostaNFe ) que trata o staus identifique o
	* os parametro nao retornados com
	*---------------------------------------------------*
	LSstatus = LSstatus + "||||||||||||||||||||||||||||||"


RETURN(LSstatus)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPXT           CLImportaCad VALID                 º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIEN_R,     Record Number:   28   º
*       º Variable:            CLImportaCad                       º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      51                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4c60mupxt     &&  CLImportaCad VALID
#REGION 2
return
*---------------------------------------------------------------*
*		   PrmEsperaResposta,;
*		       && "ESPERA" ou "NAO ESPERA"
*
*---------------------------------------------------------------*

FUNCTION CLImportaCad

PARAMETER  PrmEmpresa,;
           PrmEsperaResposta,;
		   RtnStatus
		
	*-------------------------------------------------------*

	PRIVATE LSalias
	PRIVATE PrmAlsCL

	LSalias = ALIAS()
	PrmAlsCL = CLGetAlias()

	SELE &PrmAlsCL

	GO BOTT
	GO TOP

		
		
		
		
	*-------------------------------------------------------*
	PRIVATE LSstatus,LSstatus2
	LSstatus = ""
    LSstatus2 = ""

	IF PrmEsperaResposta = "ESPERA"
		LSstatus=CLEsperaRspCad(PrmEmpresa)
	ELSE
		LSstatus=CLBuscaRspCad(PrmEmpresa)
	ENDIF


	*-------------------------------------------------------*


	DO CASE

		CASE LSstatus = "ERRO ! Nao houve retorno do comando"
				RtnStatus = LSstatus
	
		ENDCASE


 	   IF !EMPTY(LSalias) AND USED(LSalias)
		  SELECT &LSalias
	   ENDIF


RETURN(LSstatus+LSstatus2)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4C60MUPZ5           CLImpCadOrion VALID                º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         CLIEN_R,     Record Number:   30   º
*       º Variable:            CLImpCadOrion                      º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      52                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4c60mupz5     &&  CLImpCadOrion VALID
#REGION 2
RETURN

FUNCTION CLImpCadOrion
PARAMETER PrmLSFile


*			PrmLSFile = "X:\TMP\CLIENTE.TXT"	

			PRIVATE LNFile
			PRIVATE LSCampo
			PRIVATE LSConteudo


            SET DATE GERMAN
            SET CENTU ON


* -----------------------------



			LNfile=FOPEN(PrmLSFile)	

			IF LNfile > 0
				LSstatus=""

				DO WHILE !FEOF(LNfile)
                    * preencher cadastro com base no txt

					LScampo    = RTRIM(UPPER(fgets(LNfile,255)))
	                IF FEOF(LNfile)
	                   EXIT
	                ENDIF
					LSconteudo = RTRIM(UPPER(fgets(LNfile,255)))


                    DO CASE
                       CASE  UPPER(LScampo) = "EMPRESA"
                             m.empresa = INT(VAL(LSconteudo))
                       CASE  UPPER(LScampo) = "TP_PESSOA"
                            if "SICA" $ UPPER(LSconteudo) && O sinal agudo nao e reconhecido
                                     m.tp_pessoa = 1
                            else
                                     m.tp_pessoa = 1
                            endif
                       CASE  UPPER(LScampo) = "CLIENTE"
                             m.cliente = INT(VAL(LSconteudo))

                       CASE  UPPER(LScampo) = "NOME"
                             m.NOME      = LSconteudo

                       CASE  UPPER(LScampo) = "TP_INSCR"
                             m.tp_inscr = INT(VAL(LSconteudo))

                       CASE  UPPER(LScampo) = "INSCRICAO"
                            if "ISENT" $ UPPER(LSconteudo) && ISENT vai pertencer tanto a ISENTO como a ISENTA
                                     m.inscricao = "ISENTO"
                            else
                                     m.inscricao = LSconteudo
                            endif

                       CASE  UPPER(LScampo) = "INSSUBSISS"
                             m.inssubsiss = INT(VAL(LSconteudo))

                       CASE  UPPER(LScampo) = "IM_TOMADOR"
                             m.IM_TOMADOR = LSconteudo

                       CASE  UPPER(LScampo) = "REVENDEDOR"
                             m.REVENDEDOR = LSconteudo

                       CASE  UPPER(LScampo) = "REVENDEDOR"
                             m.REVENDEDOR = LSconteudo

*------------>


                       CASE  UPPER(LScampo) = "FANTASIA"
                             m.FANTASIA = LSconteudo


                       CASE  UPPER(LScampo) = "TP_LOGRADOURO"
                             m.TmpTP_LOGR = LSconteudo

                       CASE  UPPER(LScampo) = "ENDERECO"
                             m.TmpENDERECO = LSconteudo

                       CASE  UPPER(LScampo) = "NRO_LOGR"
                             m.TmpNRO_LOGR = LSconteudo

                       CASE  UPPER(LScampo) = "COMPLEMENTO"
                             m.TmpComplemento = LSconteudo

*------------->

                       CASE  UPPER(LScampo) = "BAIRRO"
                             m.BAIRRO = LSconteudo

                       CASE  UPPER(LScampo) = "CIDADE"
                             m.CIDADE = LSconteudo

                       CASE  UPPER(LScampo) = "ESTADO"
                             m.ESTADO = LSconteudo

                       CASE  UPPER(LScampo) = "CEP"
                             m.CEP = INT(VAL(LSconteudo))

                       CASE  UPPER(LScampo) = "MUNI_IBGE"
                             m.MUNI_IBGE = INT(VAL(LSconteudo))

                       CASE  UPPER(LScampo) = "FONE"
                             m.FONE  = LSconteudo

                       CASE  UPPER(LScampo) = "FONE"
                             m.FONE  = LSconteudo

*------------>

                       CASE  UPPER(LScampo) = "CBNOME"
                             m.CBNOME = LSconteudo


                       CASE  UPPER(LScampo) = "CBTP_LOGRADOURO"
                             m.TmpCBTP_LOGR = LSconteudo

                       CASE  UPPER(LScampo) = "CBENDERECO"
                             m.TmpCBENDERECO = LSconteudo

                       CASE  UPPER(LScampo) = "CBNRO_LOGR"
                             m.TmpCBNRO_LOGR = LSconteudo

                       CASE  UPPER(LScampo) = "CBCOMPLEMENTO"
                             m.TmpCBComplemento = LSconteudo






                       CASE  UPPER(LScampo) = "CBBAIRRO"
                             m.CBBAIRRO = LSconteudo

                       CASE  UPPER(LScampo) = "CBCIDADE"
                             m.CBCIDADE = LSconteudo

                       CASE  UPPER(LScampo) = "CBESTADO"
                             m.CBESTADO = LSconteudo

                       CASE  UPPER(LScampo) = "CBCEP"
                             m.CBCEP = INT(VAL(LSconteudo))

                       CASE  UPPER(LScampo) = "CBMUNI_IBGE"
                             m.CBMUNI_IBGE = INT(VAL(LSconteudo))

                       CASE  UPPER(LScampo) = "CBFONE"
                             m.CBFONE  = LSconteudo

                       CASE  UPPER(LScampo) = "CBFONE"
                             m.CBFONE  = LSconteudo

*------------>

                       CASE  UPPER(LScampo) = "CREDITO"
                             m.CREDITO  = VAL(LSconteudo)


                       CASE  UPPER(LScampo) = "DTCAD"
                             m.DTCAD  = CTOD(LSconteudo)

                       CASE  UPPER(LScampo) = "ULTSERVICO"
                             m.ULTSERVICO  = CTOD(LSconteudo)


                       CASE  UPPER(LScampo) = "ULTATEND" or UPPER(LScampo) = "ULT_ATEND"
                             m.ULT_ATEND  = CTOD(LSconteudo)

                       CASE  UPPER(LScampo) = "REGIAO"
                             m.REGIAO  = INT(VAL(LSconteudo))

                       CASE  UPPER(LScampo) = "STATUS"
                             m.STATUS  = INT(VAL(LSconteudo))

                       CASE  UPPER(LScampo) = "NATUREZA"
                             m.NATUREZA  = INT(VAL(LSconteudo))

                       CASE  UPPER(LScampo) = "NATUREZA"
                             m.NATUREZA  = INT(VAL(LSconteudo))

                       CASE  UPPER(LScampo) = "VENDEDOR"
                             m.VENDEDOR  = INT(VAL(LSconteudo))

                       CASE  UPPER(LScampo) = "USRVINCVND"
                             m.USRVINCVND  = INT(VAL(LSconteudo))

                       CASE  UPPER(LScampo) = "SEXO"
                             m.SEXO  = LSconteudo

                       CASE  UPPER(LScampo) = "DT_NASC"
                             m.DT_NASC  = CTOD(LSconteudo)

                       CASE  UPPER(LScampo) = "DT_ALTER"
                             m.DT_ALTER  = CTOD(LSconteudo)

                       CASE  UPPER(LScampo) = "LMT_PARCEL"
                             m.LMT_PARCEL  = LSconteudo

                       CASE  UPPER(LScampo) = "VENDEDOR2"
                             m.VENDEDOR2  = INT(VAL(LSconteudo))

                       CASE  UPPER(LScampo) = "USR_REGIS"
                             m.USR_REGIS  = INT(VAL(LSconteudo))

                       CASE  UPPER(LScampo) = "DT_ALTCR"
                             m.DT_ALTCR  = CTOD(LSconteudo)


                       CASE  UPPER(LScampo) = "USR_ALTCR"
                             m.USR_ALTCR  = INT(VAL(LSconteudo))

                       CASE  UPPER(LScampo) = "DTLIBERACD"
                             m.DTLIBERACD  = CTOD(LSconteudo)

                       CASE  UPPER(LScampo) = "USLIBERACD"
                              m.USLIBERACD  = INT(VAL(LSconteudo))

                       CASE  UPPER(LScampo) = "DTREGIS"
                             m.DTREGIS  = CTOD(LSconteudo)

                       CASE  UPPER(LScampo) = "HREGIS"
                             m.HREGIS  = LSconteudo

                       CASE  UPPER(LScampo) = "USRREGIS"
                              m.USRREGIS  = INT(VAL(LSconteudo))

                       CASE  UPPER(LScampo) = "E_MAIL"
                             m.E_MAIL  = LSconteudo

                       CASE  UPPER(LScampo) = "E_MAIL_NFE"
                             m.E_MAIL_NFE  = LSconteudo

                       CASE  UPPER(LScampo) = "SEGUIMENTO"
                              m.SEGUIMENTO  = INT(VAL(LSconteudo))


                       CASE  UPPER(LScampo) = "OBS"
                              m.OBS  = LSconteudo

                       CASE  UPPER(LScampo) = "SUBST_ISS"
                              m.SUBST_ISS  = INT(VAL(LSconteudo))

                       CASE  UPPER(LScampo) = "EMITE_BLTO"
                              m.EMITE_BLTO  = LSconteudo

                    ENDCASE


				ENDDO

				=FCLOSE(LNfile)

                do  SETMEMVET

           	    =W_DEFPROC("CLIENTES.SPR")
                =CLSalvarRegistro()

			ENDIF
			
 			
RETURN

PROCEDURE SETMEMVET

	=W_DEFPROC("rotinas.spr")


    =W_DEFPROC("CLIENTES.SPR")
	=CLVerifyInst()


    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("EMPRESA", M.EMPRESA)


	=W_DEFPROC("rotinas.spr")
    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("TP_PESSOA", M.TP_PESSOA)
	
    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("CLIENTE", M.CLIENTE)

    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("NOME", M.NOME)
	
    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("TP_INSCR", M.TP_INSCR)
	
    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("INSCRICAO", M.INSCRICAO)
	
    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("INSSUBSISS", M.INSSUBSISS)
	
    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("IM_TOMADOR", M.IM_TOMADOR)
	
    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("REVENDEDOR", M.REVENDEDOR)
	
    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("FANTASIA", M.FANTASIA)



*---------------------------------
    M.ENDERECO =    RTRIM(m.TmpTP_LOGR) + " " +;
                    RTRIM(m.TmpENDERECO) + " " +;
                    "nro. " +;
                    RTRIM(m.TmpNRO_LOGR) + " " +;
                    RTRIM(m.TmpComplemento)




    M.CBENDERECO =    RTRIM(m.TmpCBTP_LOGR) + " " +;
                    RTRIM(m.TmpCBENDERECO) + " " +;
                    "nro. " +;
                    RTRIM(m.TmpCBNRO_LOGR) + " " +;
                    RTRIM(m.TmpCBComplemento)






*------------------------------------


    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("ENDERECO", M.ENDERECO)

    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("NRO_LOGR", M.TmpNRO_LOGR)

    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("BAIRRO", M.BAIRRO)

    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("CIDADE", M.CIDADE)

    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("ESTADO", M.ESTADO)

    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("CEP", M.CEP)

    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("MUNI_IBGE", M.MUNI_IBGE)

    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("FONE", M.FONE)

    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("CBNOME", M.CBNOME)

    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("CBENDERECO", M.CBENDERECO)

    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("CBNRO_LOGR", M.TmpCBNRO_LOGR)


    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("CBBAIRRO", M.CBBAIRRO)

    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("CBCIDADE", M.CBCIDADE)

    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("CBESTADO", M.CBESTADO)

    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("CBCEP", M.CBCEP)

    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("CBCEP", M.CBCEP)

    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("CBFONE", M.CBFONE)

    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("CREDITO", M.CREDITO)

    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("DTCAD", M.DTCAD)


    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("ULTSERVICO", M.ULTSERVICO)

    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("ULT_ATEND", M.ULT_ATEND)


    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("REGIAO", M.REGIAO)

    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("STATUS", M.STATUS)


    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("NATUREZA", M.NATUREZA)

    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("VENDEDOR", M.VENDEDOR)

	
    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("USRVINCVND", M.USRVINCVND)


    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("SEXO", M.SEXO)

    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("DT_NASC", M.DT_NASC)

    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("DT_ALTER", M.DT_ALTER)

    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("LMT_PARCEL", M.LMT_PARCEL)

    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("VENDEDOR2", M.VENDEDOR2)

    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("USR_REGIS", M.USR_REGIS)


    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("DT_ALTCR", M.DT_ALTCR)

    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("USR_ALTCR", M.USR_ALTCR)

    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("DTLIBERACD", M.DTLIBERACD)


    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("USLIBERACD", M.USLIBERACD)

    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("DTREGIS", M.DTREGIS)


    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("HREGIS", M.HREGIS)



    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("USRREGIS", M.USRREGIS)

    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("E_MAIL", M.E_MAIL)

    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("E_MAIL_NFE", M.E_MAIL_NFE)

    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("SEGUIMENTO", M.SEGUIMENTO)

    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("OBS", M.OBS)

    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("SUBST_ISS", M.SUBST_ISS)

    =W_DEFPROC("CLIENTES.SPR")
	=CLSetPropVT("EMITE_BLTO", M.EMITE_BLTO)




RETURN