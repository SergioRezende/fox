*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        03/27/10            DOCFISIT.SPR               11:44:31 
*                                                                
*       픔컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        Author's Name                                           
*                                                                
*        Copyright (c) 2010 Company Name                         
*        Address                                                 
*        City,     Zip                                           
*                                                                
*        Description:                                            
*        This program was automatically generated by GENSCRN.    
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴


#REGION 0
REGIONAL m.currarea, m.talkstat, m.compstat

IF SET("TALK") = "ON"
	SET TALK OFF
	m.talkstat = "ON"
ELSE
	m.talkstat = "OFF"
ENDIF
m.compstat = SET("COMPATIBLE")
SET COMPATIBLE FOXPLUS

*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                       MS-DOS Window definitions                
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                     DOCFISIT/MS-DOS Screen Layout              
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 1
@ 6,6 GET DIVerifyInst ;
	PICTURE "@*HN DIVerifyInst - Verifica Instancia" ;
	SIZE 1,35,1 ;
	DEFAULT 1 ;
	VALID _2wc0p612d()
@ 7,9 GET DICreate ;
	PICTURE "@*HN DICreate - Instancia" ;
	SIZE 1,22,1 ;
	DEFAULT 1 ;
	VALID _2wc0p612i()
@ 15,9 GET DIDestroi ;
	PICTURE "@*HN DIDestroi - Desinstancia" ;
	SIZE 1,26,1 ;
	DEFAULT 1 ;
	VALID _2wc0p612m()
@ 8,12 GET DIReadProp ;
	PICTURE "@*HN DIReadProp - Carga do Vetor com Base na Tabela" ;
	SIZE 1,48,1 ;
	DEFAULT 1 ;
	VALID _2wc0p612q()
@ 12,15 GET DISetDerivadas ;
	PICTURE "@*HN DISetDerivadas - Carga de Propriedades Derivadas" ;
	SIZE 1,50,1 ;
	DEFAULT 1 ;
	VALID _2wc0p612u()
@ 9,12 GET DISetPropVT ;
	PICTURE "@*HN DISetPropVT - Set o Valor de uma Propriedade do Vetor" ;
	SIZE 1,55,1 ;
	DEFAULT 1 ;
	VALID _2wc0p614f()
@ 11,15 GET DIGetPropVT ;
	PICTURE "@*HN DIGetPropVT - Get o Valor de uma Propriedade do Vetor" ;
	SIZE 1,55,1 ;
	DEFAULT 1 ;
	VALID _2wc0p614j()
@ 5,1 GET DIChk_Identidade ;
	PICTURE "@*HN DIChk_Identidade - Checagem de Identidade do Objeto" ;
	SIZE 1,53,1 ;
	DEFAULT 1 ;
	VALID _2wc0p614m()
@ 4,1 GET DIFind ;
	PICTURE "@*HN DIFind - Localiza Registro Com Base nas Propriedades" ;
	SIZE 1,54,1 ;
	DEFAULT 1 ;
	VALID _2wc0p614q()
@ 17,2 GET DIGetFieldValue ;
	PICTURE "@*HN DIGetFieldValue -Rtrn vlr Campo p/ reg.existente-(erro se chave n existir)" ;
	SIZE 1,76,1 ;
	DEFAULT 1 ;
	VALID _2wc0p614u()
@ 16,2 GET DI_Refresh ;
	PICTURE "@*HN DI_Refresh - Forca Atualiza놹o Objeto" ;
	SIZE 1,39,1 ;
	DEFAULT 1 ;
	VALID _2wc0p614v()
@ 19,2 SAY "*-------------------------------------------------------------------*" ;
	SIZE 1,69, 0
@ 21,2 GET DILerRegistro ;
	PICTURE "@*HN DILerRegistro - Le Registro e Carrega OBJ" ;
	SIZE 1,43,1 ;
	DEFAULT 1 ;
	VALID _2wc0p614w()
@ 13,12 GET DIWriteProp ;
	PICTURE "@*HN DIWriteProp - Grava do Vetor para Base na Tabela" ;
	SIZE 1,50,1 ;
	DEFAULT 1 ;
	VALID _2wc0p614x()
@ 22,2 GET DISalvarRegistro ;
	PICTURE "@*HN DISalvarRegistro - Salva Registro" ;
	SIZE 1,35,1 ;
	DEFAULT 1 ;
	VALID _2wc0p614y()
@ 20,2 GET DIExiste ;
	PICTURE "@*HN DIExiste - Le Registro nao carrega o OBJ e Retorna se existe" ;
	SIZE 1,62,1 ;
	DEFAULT 1 ;
	VALID _2wc0p614z()
@ 23,2 SAY "*-------------------------------------------------------------------*" ;
	SIZE 1,69, 0
@ 2,1 SAY "====> DOCFISIT => Itens do Documento Fiscal DOCFISA.DBF" ;
	SIZE 1,55, 0
@ 38,8 GET DIV10GravaXMLItensDocFiscal ;
	PICTURE "@*HN DIV10GravaXMLItensDocFiscal - Converte Itens Doc Fiscal em XML" ;
	SIZE 1,64,1 ;
	DEFAULT 1 ;
	VALID _2wc0p6150()
@ 18,2 GET DIGetAlias ;
	PICTURE "@*HN DIGetAlias - Retorna Alias da area em que foi abertaa tabela" ;
	SIZE 1,62,1 ;
	DEFAULT 1 ;
	VALID _2wc0p615e()
@ 46,3 GET DICFOPS ;
	PICTURE "@*HN DICFOPS  - CFOP Servico" ;
	SIZE 1,25,1 ;
	DEFAULT 1 ;
	WHEN .f. ;
	VALID _2wc0p615g()
@ 48,3 GET DICST_IPI ;
	PICTURE "@*HN DICST_IPI" ;
	SIZE 1,11,1 ;
	DEFAULT 1 ;
	WHEN .f. ;
	VALID _2wc0p615k()
@ 49,3 GET DICST_ISS ;
	PICTURE "@*HN DICST_ISS" ;
	SIZE 1,11,1 ;
	DEFAULT 1 ;
	WHEN .f. ;
	VALID _2wc0p615m()
@ 50,3 GET DIGenero ;
	PICTURE "@*HN DIGenero" ;
	SIZE 1,10,1 ;
	DEFAULT 1 ;
	WHEN .f. ;
	VALID _2wc0p615p()
@ 51,3 GET DICST_Entrada ;
	PICTURE "@*HN DICST_Entrada" ;
	SIZE 1,15,1 ;
	DEFAULT 1 ;
	WHEN .f. ;
	VALID _2wc0p615s()
@ 47,3 GET DICST_ICMS ;
	PICTURE "@*HN DICST_ICMS" ;
	SIZE 1,12,1 ;
	DEFAULT 1 ;
	WHEN .f. ;
	VALID _2wc0p617e()
@ 52,3 GET DICST_PIS ;
	PICTURE "@*HN DICST_PIS - Desenvolver" ;
	SIZE 1,25,1 ;
	DEFAULT 1 ;
	WHEN .f. ;
	VALID _2wc0p617h() ;
	DISABLE
@ 53,5 GET DICST_COFINS ;
	PICTURE "@*HN DICST_COFINS - Desenvolver" ;
	SIZE 1,28,1 ;
	DEFAULT 1 ;
	WHEN .f. ;
	VALID _2wc0p617k() ;
	DISABLE
@ 54,3 GET DICST_IR ;
	PICTURE "@*HN DICST_IR - Desenvolver" ;
	SIZE 1,24,1 ;
	DEFAULT 1 ;
	WHEN .f. ;
	VALID _2wc0p617n() ;
	DISABLE
@ 45,2 SAY "*-------------------------------------------------------------------*" ;
	SIZE 1,69, 0
@ 34,2 GET DIGerXMLPeriodoDocFiscal ;
	PICTURE "@*HN DIGerXMLPeriodoDocFiscal-Gera XML ITEM DocFiscal Por Empresa/Periodo" ;
	SIZE 1,70,1 ;
	DEFAULT 1 ;
	VALID _2wc0p617q()
@ 43,11 GET DIModeloRefXML ;
	PICTURE "@*HN DIModeloRefXML-MODELO P/MONTAR REF XML Itens Doc Fiscal-xmlDIFIS" ;
	SIZE 1,66,1 ;
	DEFAULT 1 ;
	WHEN .f. ;
	VALID _2wc0p617x()
@ 42,9 GET DIInicioXML ;
	PICTURE "@*HN DIInicioXML-Monta Cabecalho XML com base no modelo-xmlDCFIS" ;
	SIZE 1,61,1 ;
	DEFAULT 1 ;
	WHEN .f. ;
	VALID _2wc0p6181()
@ 44,9 GET DIFinalXML ;
	PICTURE "@*HN DIFinalXML-Monta Cabecalho XML com base no modelo-xmlDCFIS" ;
	SIZE 1,60,1 ;
	DEFAULT 1 ;
	WHEN .f. ;
	VALID _2wc0p6182()
@ 24,2 SAY "*-------------------------------------------------------------------*" ;
	SIZE 1,69, 0
@ 26,3 GET DIConvrtNFDocFiscal ;
	PICTURE "@*HN DIConvrtNFDocFiscal - Converte um item de NOTA em item de DOCFISCA" ;
	SIZE 1,68,1 ;
	DEFAULT 1 ;
	VALID _2wc0p6183()
@ 33,0 SAY "XML=>" ;
	SIZE 1,5, 0
@ 25,1 SAY "NOTA => DOCFISCA" ;
	SIZE 1,16, 0
@ 28,1 SAY "NOTAENT => DOCFISCA" ;
	SIZE 1,19, 0
@ 35,2 GET DIGerXMLDocFiscal ;
	PICTURE "@*HN DIGerXMLDocFiscal-Gera XML ITEM DocFiscal Por Doc Fiscal" ;
	SIZE 1,58,1 ;
	DEFAULT 1 ;
	VALID _2wc0p6193()
@ 1,1 GET DIFind ;
	PICTURE "@*HN DIsqls - Biblioteca de consultas sql temporarias" ;
	SIZE 1,54,1 ;
	DEFAULT 1 ;
	VALID _2wc0p619a()
@ 55,2 SAY "*-------------------------------------------------------------------*" ;
	SIZE 1,69, 0
@ 56,3 GET DIApuraICMS ;
	PICTURE "@*HN DIApuraICMS-SQL-consulta Apluracao ICMS com base no item Doc Fiscal" ;
	SIZE 1,69,1 ;
	DEFAULT 1 ;
	WHEN .f. ;
	VALID _2wc0p619e()
@ 29,3 GET DIConvrtNEDocFiscal ;
	PICTURE "@*HN DIConvrtNEDocFiscal - Converte um item de NOTA Ent. em item de DOCFISCA" ;
	SIZE 1,73,1 ;
	DEFAULT 1 ;
	VALID _2wc0p619l()
@ 36,5 GET DINmFileXMLDocFiscal ;
	PICTURE "@*HN DINmFileXMLDocFiscal-Define Path+File do XML ITEM DOC FISCAL" ;
	SIZE 1,62,1 ;
	DEFAULT 1 ;
	VALID _2wc0p61b4()
@ 32,8 GET DIDelItensDocFiscal ;
	PICTURE "@*HN DIDelItensDocFiscal- Deleta Itens do Doc fisc(EX:Antes Reimportar)" ;
	SIZE 1,68,1 ;
	DEFAULT 1 ;
	VALID _2wc0p61b5()
@ 31,6 SAY "EXCLUI ITENS DOC FISACAL" ;
	SIZE 1,24, 0
@ 39,8 GET DIV01GravaXMLItensDocFiscal ;
	PICTURE "@*HN DIV01GravaXMLItensDocFiscal - Converte Itens Doc Fiscal em XML" ;
	SIZE 1,64,1 ;
	DEFAULT 1 ;
	VALID _2wc0p61b6()
@ 37,6 GET DIGravaXMLItensDocFiscal ;
	PICTURE "@*HN DIGravaXMLItensDocFiscal - Converte Itens Doc Fiscal em XML" ;
	SIZE 1,61,1 ;
	DEFAULT 1 ;
	VALID _2wc0p61cl()
@ 40,10 GET DIERV01GravaXMLItensDocFiscal ;
	PICTURE "@*HN DIVER01GravaXMLItensDocFiscal - Converte Itens Doc Fiscal em XML" ;
	SIZE 1,66,1 ;
	DEFAULT 1 ;
	VALID _2wc0p61cm() ;
	DISABLE



READ


#REGION 0
IF m.talkstat = "ON"
	SET TALK ON
ENDIF
IF m.compstat = "ON"
	SET COMPATIBLE ON
ENDIF


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2WC0P612D           DIVerifyInst VALID                 
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         DOCFISIT,     Record Number:    2  
*        Variable:            DIVerifyInst                       
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      1                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2wc0p612d     &&  DIVerifyInst VALID
#REGION 1
return
*---------------------------------------------------------------*



FUNCTION DIVerifyInst
	
PRIVATE LSpath
	=W_DEFPROC("rotinas.spr")
	LSpath = UPobterPath("DocFisIt")


	DO CASE

		CASE TYPE("PBDocFisItAlias") = "U" ;
		   		OR EMPTY(PBDocFisItAlias) ;
		   		OR !USED(PBDocFisItAlias)
			=DICreate()					

		CASE !("DOCFISIT.DBF" $ DBF(PBDocFisItAlias))
				* APOS UM CLOSE DATABASE UM OUTRO DBF FOI
				* ABERTO NA AREA ANTES OCUPADA PELO DBF AVALIADO AKI
				RELEASE PBDocFisItAlias
			=DICreate()					


		CASE  !(LSPath $ DBF(PBDocFisItAlias))
			 	* HOUVE MUDANCA DE DIR BASE
			 	* ELIMINA INSTACIA DE OUTRA BASE
		     	* CRIA INSTANCIA NA NOVA BASE
			=DIDestroi()				
			=DICreate()					
	ENDCASE

	
RETURN(.t.)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2WC0P612I           DICreate VALID                     
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         DOCFISIT,     Record Number:    3  
*        Variable:            DICreate                           
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      2                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2wc0p612i     &&  DICreate VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION DICreate
	=W_DEFPROC("rotinas.spr")
	PRIVATE LSalias
	PRIVATE LSAlsTmp
    PRIVATE LMaxDim
	LSalias		= 	ALIAS()
	
	IF TYPE("PBDocFisItAlias") <> "U" ;
	   		AND !EMPTY(PBDocFisItAlias) ;
	   		AND USED(PBDocFisItAlias)
			RETURN(.T.)
	ENDIF


	PUBLIC PBDocFisItAlias

	IF USED("DocFisIt")
	     =NetArqAgain("DocFisIt")
	     PBDocFisItAlias     = Alias()
	ELSE
	     =NetArqAgain("DocFisIt")
	     LSAlsTmp     = Alias()
	     =NetArqAgain("DocFisIt")
	     PBDocFisItAlias     = Alias()
		 IF !EMPTY(LSAlsTmp) AND USED(LSAlsTmp)
			SELECT &LSAlsTmp
			USE
		 ENDIF
	ENDIF	

    SELE &PBDocFisItAlias
	LMaxDim = Fcount()
    PUBLIC DIMENSION VTDocFisIt[LMaxDim]
    PUBLIC DIMENSION VDDocFisIt[2,3]			&& VETOR PARA PROPRIEDADES
    PUBLIC DIMENSION VFDocFisIt[1]      && VETOR CABECALHO DOS CAMPOS
	=AFIELDS(VFDocFisIt)

	*-----------------------------------------------------------*
	=DIReadProperty()
	=DISetDerivadas()
	*--------------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2WC0P612M           DIDestroi VALID                    
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         DOCFISIT,     Record Number:    4  
*        Variable:            DIDestroi                          
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      3                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2wc0p612m     &&  DIDestroi VALID
#REGION 1
return
*---------------------------------------------------------------*


FUNCTION DIDestroi

	=W_DEFPROC("rotinas.spr")

	IF TYPE("PBDocFisItAlias") = "U"
		RETURN
	ENDIF

    *--------------------------------------------------------------------*
	*-> QUANDO O SISTEMA APLICA UM CLOSE DATABASE :
	*   EX: EM UPAltDir (Geral.spr)
	*  1- Fecha inclusive a referencia do PBDocFiscaAlias
	*  2- Novas tabelas abertas podem ocupar a area referenciada
	*     por PBDocFiscaAlias
	*  3- Se aplicar um FECHAMENTO a PBDocFiscaAlias estara fechando
	*     outra tabela
	*  4- Entao Verifica-se a coerencia do dbf esperado em PBDocFiscaAlias
	*-------------------------------------------------------------------*
	IF !(USED(PBDocFisItAlias)) OR ;
	   !("DOCFISIT.DBF" $ DBF(PBDocFisItAlias))

		RELEASE PBDocFisItAlias
    	RELEASE VTDocFisIt
	    RELEASE VDDocFisIt
	    RELEASE VFDocFisIt
		return(.T.)			
	ENDIF
	PRIVATE LSalias
	LSalias  = Alias()
	IF !EMPTY(PBDocFisItAlias) AND USED(PBDocFisItAlias)
		SELECT &PBDocFisItAlias
		USE
	ENDIF	
	RELEASE PBDocFisItAlias
    RELEASE VTDocFisIt
    RELEASE VDDocFisIt
    RELEASE VFDocFisIt

	*-----------------------------------------------------------*
	*--------------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(.T.)


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2WC0P612Q           DIReadProp VALID                   
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         DOCFISIT,     Record Number:    5  
*        Variable:            DIReadProp                         
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      4                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2wc0p612q     &&  DIReadProp VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION DIReadProp
	PRIVATE LSalias
	LSalias		= 	ALIAS()

**	=DIVerifyInst()

	SELE &PBDocFisItAlias
	SCATTER TO VTDocFisIt
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(.T.)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2WC0P612U           DISetDerivadas VALID               
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         DOCFISIT,     Record Number:    6  
*        Variable:            DISetDerivadas                     
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      5                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2wc0p612u     &&  DISetDerivadas VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION DISetDerivadas
	PRIVATE LSalias
	PRIVATE LEmpresa
	LSalias		= 	ALIAS()

**	=DIVerifyInst()
	*--------------------------------------------------------------*
    VDDocFisIt(1,1) = "NAOINFORMADO"
   	VDDocFisIt(1,2) = 0
   	VDDocFisIt(1,3) = .F.
	*--------------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(.T.)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2WC0P614F           DISetPropVT VALID                  
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         DOCFISIT,     Record Number:    7  
*        Variable:            DISetPropVT                        
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      6                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2wc0p614f     &&  DISetPropVT VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION DISetPropVT
PARAMETER  PrmField, PrmValue
	PRIVATE Lvalue

	=W_DEFPROC("ROTINAS.SPR")
	Lvalue = RTsetValueObj(PrmField,;
							PrmValue,;
						    PBDocFisItAlias,;
						    VTDocFisIt,;
							VDDocFisIt,;
							VFDocFisIt)

RETURN(Lvalue)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2WC0P614J           DIGetPropVT VALID                  
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         DOCFISIT,     Record Number:    8  
*        Variable:            DIGetPropVT                        
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      7                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2wc0p614j     &&  DIGetPropVT VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION DIGetPropVT
PARAMETER  PrmField

	PRIVATE Lvalue

**	=DIVerifyInst()
	=W_DEFPROC("ROTINAS.SPR")
	Lvalue = RTgetValueObj(PrmField,;
					PBDocFisItAlias,;
					VTDocFisIt,;
					VDDocFisIt,;
					VFDocFisIt)

RETURN(Lvalue)





*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2WC0P614M           DIChk_Identidade VALID             
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         DOCFISIT,     Record Number:    9  
*        Variable:            DIChk_Identidade                   
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      8                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2wc0p614m     &&  DIChk_Identidade VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION DIChk_Identidade
PARAMETERS  PrmEmp,;
			PrmMod_doc,;
			PrmCod_IDForn,;
			PrmNro_Doc,;
			PrmSerie_Doc,;
			PrmNro_Item
			


	PRIVATE LFretorno
	LFretorno = .t.



	=DIVerifyInst()
    =DISetPropVT("EMPRESA",PrmEmp)
    =DISetPropVT("MOD_DOC",PrmMod_doc)
    =DISetPropVT("COD_IDFORN",PrmCod_IDForn)
    =DISetPropVT("SERIE_DOC",PrmSerie_Doc)
    =DISetPropVT("NRO_DOC",PrmNro_Doc)
    =DISetPropVT("NRO_ITEM",PrmNro_Item)


	LFretorno=DIFind()
RETURN(LFretorno)




*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2WC0P614Q           DIFind VALID                       
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         DOCFISIT,     Record Number:   10  
*        Variable:            DIFind                             
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      9                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2wc0p614q     &&  DIFind VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION DIFind

	PRIVATE LEmpresa,;
			LMod_doc,;
			LCod_IDForn,;
			LNro_Doc,;
			LSerie_Doc,;
			LNro_Item
			
	
	


	PRIVATE LFreturn

	PRIVATE LSalias
	LSalias		= 	ALIAS()

	=DIVerifyInst()


	LEmpresa    = DIGetPropVT("Empresa")
	LMod_Doc    = DIGetPropVT("Mod_Doc")
	LCod_IdForn = DIGetPropVT("Cod_IdForn")
	LNro_Doc    = DIGetPropVT("Nro_Doc")
	LSerie_Doc  = DIGetPropVT("Serie_Doc")
	LNro_Item  = DIGetPropVT("Nro_Item")


	SELE &PBDocFisItAlias
	SET ORDER TO TAG item
	SEEK STR(Lempresa,3)+Lmod_Doc+LCod_IdForn+STR(LNro_Doc,7);
				+LSerie_Doc+STR(LNro_Item,5)

	IF FOUND()
		=DIReadProperty()
		=DISetDerivadas()
	    LFreturn = .T.
	ELSE
	    LFreturn = .f.
	ENDIF
	*--------------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(LFreturn)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2WC0P614U           DIGetFieldValue VALID              
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         DOCFISIT,     Record Number:   11  
*        Variable:            DIGetFieldValue                    
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      10                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2wc0p614u     &&  DIGetFieldValue VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION DIGetFieldValue
PARAMETERS  PrmEmp,;
			PrmMod_doc,;
			PrmCod_IDForn,;
			PrmSerie_Doc,;
			PrmNro_Doc,;
			PrmNro_Item,;
			PrmField


	IF !DIChk_Identidade(PrmEmp,;
					  PrmMod_doc,;
					  PrmCod_IDForn,;
					  PrmNro_Doc,;
					  PrmSerie_Doc,;
					  PrmNro_Item)
				
					
		DO WHILE .T.
			=UPerrosys("Chamada GetFieldValue para Reg. Inexistente!")
		ENDDO
	ENDIF				


RETURN(DIGetPropVT(PrmField))


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2WC0P614V           DI_Refresh VALID                   
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         DOCFISIT,     Record Number:   12  
*        Variable:            DI_Refresh                         
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      11                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2wc0p614v     &&  DI_Refresh VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION DI_Refresh
PARAMETERS  PrmEmpresa,;
			PrmMod_doc,;
			PrmCod_IDForn,;
			PrmSerie_Doc,;
			PrmNro_Doc,;
			PrmNro_Item
			

	PRIVATE LFreturn

	=DIVerifyInst()


	= DISetPropVT("Empresa"   ,PrmEmpresa)
	= DISetPropVT("Mod_Doc"   ,PrmMod_doc)
	= DISetPropVT("Cod_IdForn",PrmCod_IDForn)
	= DISetPropVT("Nro_Doc"   ,PrmNro_Doc)
	= DIFSetPropVT("Serie_Doc" ,PrmSerie_Doc)
	= DISetPropVT("Nro_Item"   ,PrmNro_Item)

	*----------------------------------------------------------------*


	=DIFind()
	
RETURN(.t.)




*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2WC0P614W           DILerRegistro VALID                
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         DOCFISIT,     Record Number:   14  
*        Variable:            DILerRegistro                      
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      12                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2wc0p614w     &&  DILerRegistro VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION DILerRegistro
PARAMETERS  PrmEmp,;
			PrmMod_doc,;
			PrmCod_IDForn,;
			PrmNro_Doc,;
			PrmSerie_Doc,;
			PrmNro_Item


	PRIVATE LFretorno
	LFretorno = .t.

	LFretorno = DIChk_Identidade(PrmEmp,;
			PrmMod_doc,;
			PrmCod_IDForn,;
			PrmNro_Doc,;
			PrmSerie_Doc,;
			PrmNro_Item)

			
RETURN(LFretorno)




*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2WC0P614X           DIWriteProp VALID                  
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         DOCFISIT,     Record Number:   15  
*        Variable:            DIWriteProp                        
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      13                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2wc0p614x     &&  DIWriteProp VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION DIWriteProp
	PRIVATE LSalias
	LSalias		= 	ALIAS()


	SELE &PBDocFisItAlias
	=RLOCK()
	GATHER FROM  VTDocFisIt
	UNLOCK

	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF

RETURN(.T.)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2WC0P614Y           DISalvarRegistro VALID             
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         DOCFISIT,     Record Number:   16  
*        Variable:            DISalvarRegistro                   
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      14                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2wc0p614y     &&  DISalvarRegistro VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION DISalvarRegistro


	PRIVATE LFretorno
	LFretorno = .t.

	IF !DIExiste()
		SELE &PBDocFisItAlias
		APPEND BLANK
		LFretorno=DIWriteProp()
	ELSE
		SELE &PBDocFisItAlias
		LFretorno=DIWriteProp()
	ENDIF

RETURN(LFretorno)




*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2WC0P614Z           DIExiste VALID                     
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         DOCFISIT,     Record Number:   17  
*        Variable:            DIExiste                           
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      15                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2wc0p614z     &&  DIExiste VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION DIExiste

	PRIVATE LEmpresa,;
			LMod_doc,;
			LCod_IDForn,;
			LNro_Doc,;
			LSerie_Doc,;
			LNro_Item
			
	


	PRIVATE LFreturn

	PRIVATE LSalias
	LSalias		= 	ALIAS()


	LEmpresa    = DIGetPropVT("Empresa")
	LMod_Doc    = DIGetPropVT("Mod_Doc")
	LCod_IdForn = DIGetPropVT("Cod_IdForn")
	LNro_Doc    = DIGetPropVT("Nro_Doc")
	LSerie_Doc  = DIGetPropVT("Serie_Doc")
	LNro_Item   = DIGetPropVT("Nro_Item")


	SELE &PBDocFisItAlias
	SET ORDER TO TAG ITEM
	SEEK STR(Lempresa,3)+Lmod_Doc+LCod_IdForn+;
	     STR(LNro_Doc,7)+LSerie_Doc+STR(LNro_Item,5)
	
	IF FOUND()
	    LFreturn = .T.
	ELSE
	    LFreturn = .f.
	ENDIF
	*--------------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(LFreturn)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2WC0P6150           DIV10GravaXMLItensDocFiscal VALID  
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         DOCFISIT,     Record Number:   20  
*        Variable:            DIV10GravaXMLItensDocFiscal        
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      16                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2wc0p6150     &&  DIV10GravaXMLItensDocFiscal VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION DIV10GravaXMLItensDocFiscal
PARAMETERS  PrmEmp,;
			PrmMod_doc,;
			PrmCod_IDForn,;
			PrmNro_Doc,;
			PrmSerie_Doc,;
			PrmNro_Item,;
			PrmFileXML,;
			PrmNroIDfileXML

	*---------------------------------------------------*

	IF !DILerRegistro(PrmEmp,;
			PrmMod_doc,;
			PrmCod_IDForn,;
			PrmNro_Doc,;
			PrmSerie_Doc,;
			PrmNro_Item)
	      wait "Nao foi localizado Item DOC.FISCL :"+;
		      "FILIAL: "+STR(PrmEMPRESA,3)+;
		      "MODELO: "+MOD_DOC+;
		      "FORN. : "+PrmCOD_IDFORN+;
		      "NRO.  : "+STR(PrmNRO_DOC,7)+;
		      "SERIE : "+PrmSERIE_DOC+;
		      "ITEM  : "+STR(PrmNro_Item,4)
    	  return(.F.)
	ENDIF


	IF DIGetPropVT("QTDE") = 0
    	  return(.t.)
	ENDIF		




	=W_DEFPROC("DOCFISCA.SPR")
	IF !DFLerRegistro(PrmEmp,;
			PrmMod_doc,;
			PrmCod_IDForn,;
			PrmNro_Doc,;
			PrmSerie_Doc)
	      wait "Nao foi localizado Capa DOC.FISCL :"+;
		      "FILIAL: "+STR(PrmEMPRESA,3)+;
		      "MODELO: "+MOD_DOC+;
		      "FORN. : "+PrmCOD_IDFORN+;
		      "NRO.  : "+STR(PrmNRO_DOC,7)+;
		      "SERIE : "+PrmSERIE_DOC
    	  return(.F.)
	ENDIF
	

	*-------------------------------------------------------*

   	PRIVATE lErro
   	PRIVATE LSLinhaXML

	SET POINT TO ","
	SET SEPARATOR  TO "."


	*-------------------------------------------------------*


		=W_DEFPROC("EMPRESA.SPR")
		=EMLerRegistro(PrmEmp)

		=W_DEFPROC("EMPRESA.SPR")
		LFieldTmp    =  EMGetPropVT("CGC")
	    UNEM_CNPJ    =  STR(LFieldTmp,14)
		UNEM_CNPJ    =  chrtran(UNEM_CNPJ, " ","0")


		LSLinhaXML = '<ROW UNEM_CNPJ="'+UNEM_CNPJ+'"'
					=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	


		*==========================================================*
		*  CAMPOS IDENTIFICADORES
		*==========================================================*
	

		=W_DEFPROC("EMPRESA.SPR")
		LFieldTmp    =  EMGetPropVT("EMITE_NFE")

		IF LFieldTmp $ "H"   && H=HOMOLOGACAO

			=W_DEFPROC("DOCFISCA.SPR")
			LSLinhaXML = 'DFIS_MOD_DOCUMENTO="'+;
	    	         "55" +;
	        	     '"'
					=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		ELSE
			=W_DEFPROC("DOCFISCA.SPR")
			LSLinhaXML = 'DFIS_MOD_DOCUMENTO="'+;
	    	         DFGetPropVT("MOD_DOC") +;
	        	     '"'
					=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
		ENDIF



		=W_DEFPROC("DOCFISCA.SPR")
		LSLinhaXML = 'DFIS_CLFS_SIGLA="'+;
	             DFGetPropVT("TIPO") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))



		=W_DEFPROC("DOCFISCA.SPR")
		LSLinhaXML = 'DFIS_IND_OPERACAO="'+;
	             DFGetPropVT("IND_OPER") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		=W_DEFPROC("DOCFISCA.SPR")
		LSLinhaXML = 'DFIS_TP_MOVIMENTO="'+;
	             DFGetPropVT("TP_MOV") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))



		*----------------------------------------------------------*
		=W_DEFPROC("DOCFISCA.SPR")
		LNNro_Doc  = DFGetPropVT("NRO_DOC")
		IF LNNro_Doc > 3000000
			LNNro_Doc = LNNro_Doc - 3000000
		ENDIF

		LSLinhaXML = ULtratalinha('DFIS_NRO_DOCUMENTO="'+;
	             STR(LNNro_Doc,7) +;
	             '"')
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
		*----------------------------------------------------------*



		=W_DEFPROC("DOCFISCA.SPR")
		LSLinhaXML = 'DFIS_CPF="'+;
	             DFGetPropVT("CPF") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		=W_DEFPROC("DOCFISCA.SPR")
		LSLinhaXML = 'DFIS_IE="'+;
	             DFGetPropVT("IE") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))



		*----------------------------------------------------*
		* SERIE UNICA => "0"
		*----------------------------------------------------*
	

		=W_DEFPROC("DOCFISCA.SPR")
		LSLinhaXML = DFGetPropVT("SERIE_DOC")
		IF "U" $ LSLinhaXML
			LSLinhaXML = "0"
		ENDIF
		LSLinhaXML = 'DFIS_SERIE="'+;
	             LSLinhaXML +;
	             '"'
		=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		*----------------------------------------------------*

		LSLinhaXML = 'ITDF_NRO_ITEM="'+;
	             STR(DIGetPropVT("NRO_ITEM"),5) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		*-------------------------------------------------------*

		LSLinhaXML = 'ITDF_PROD_CODIGO="'+;
	             DIGetPropVT("PRODCODIGO") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_PROD_DESCRICAO="'+;
	             DIGetPropVT("PRODDESCR") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_PROD_DESCR_COMPL="'+;
	             DIGetPropVT("PRODCOMPLE") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))



		LSLinhaXML = 'ITDF_PROD_INFO_ADICIONAIS="'+;
	             DIGetPropVT("INFO_COMPL") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		LSLinhaXML = 'ITDF_UNIDADE="'+;
	             DIGetPropVT("UNIDADE") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))



		LSLinhaXML = 'ITDF_PRECO_TABELA="'+;
	             STR(DIGetPropVT("PRECO_TAB"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		LSLinhaXML = 'ITDF_PRECO_MAX_TABELADO="'+;
	             STR(DIGetPropVT("PRECOMAXTB"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		LSLinhaXML = 'ITDF_PRECO_MIN_TABELADO="'+;
	             STR(DIGetPropVT("PRECOMINTB"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

	

		LSLinhaXML = 'ITDF_QTDE="'+;
	             STR(DIGetPropVT("QTDE"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_DESCONTO="'+;
	             STR(DIGetPropVT("VLR_DESCTO"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))



		LSLinhaXML = 'ITDF_VLR_DESP_FINANCEIRA="'+;
	             STR(DIGetPropVT("VLRDESPFIN"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_OUTRAS_DESP_ACES="'+;
	             STR(DIGetPropVT("VLRDESPOUT"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_FRETE="'+;
	             STR(DIGetPropVT("VLR_FRETE"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_SEGURO="'+;
	             STR(DIGetPropVT("VLR_SEGURO"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_FINAL="'+;
	             STR(DIGetPropVT("VLR_FINAL"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		LSLinhaXML = 'ITDF_MENSAGEM="'+;
	             SPACE(5) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		LSLinhaXML = 'ITDF_IND_MOVIMENTO_ESTQ="'+;
	             DIGetPropVT("IND_MOVEST") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_LOTE_QTDE_ITENS="'+;
	             STR(DIGetPropVT("LT_QTITENS"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	
		LSLinhaXML = 'ITDF_LOTE_NRO="'+;
	             DIGetPropVT("LT_NRO") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_LOTE_FABRICACAO="'+;
	             DTOC(DIGetPropVT("LT_DT_FABR")) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_LOTE_VALIDADE="'+;
	             DTOC(DIGetPropVT("LT_VALIDAD")) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_CUSTO_MEDIO_ATUAL="'+;
	             STR(DIGetPropVT("CUSTOMEDAT"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	
		LSLinhaXML = 'ITDF_SALDO_ANTERIOR="'+;
	             STR(DIGetPropVT("SALDO_ANT"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_CUSTO_MEDIO_ANT="'+;
	             STR(DIGetPropVT("CUSTOMEDAN"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_CUSTO_NA_OPERACAO="'+;
	             STR(DIGetPropVT("CUSTONAOPE"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_A_TRIBUTAR="'+;
	             STR(DIGetPropVT("VLRATRIBUT"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_SALDO_ATUAL="'+;
	             STR(DIGetPropVT("SALDO_ATU"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_CUSTO_CONTABIL="'+;
	             STR(DIGetPropVT("CUSTOCONTB"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_CFOP="'+;
	             DIGetPropVT("CFOP") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))



		LSLinhaXML = 'ITDF_CST_ICMS="'+;
	             DIGetPropVT("CST_ICMS") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_CST_IPI="'+;
	             DIGetPropVT("CST_IPI") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_CST_ISS="'+;
	             DIGetPropVT("CST_ISS") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_CST_PIS="'+;
	             DIGetPropVT("CST_PIS") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_CST_COFINS="'+;
	             DIGetPropVT("CST_COFINS") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_CST_IR="'+;
	             DIGetPropVT("CST_IR") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_BC_BRUTA_ICMS="'+;
	             STR(DIGetPropVT("BCBRUTAICM"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_IND_REDUCAO="'+;
	             STR(DIGetPropVT("IND_REDUCA"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_BC_ICMS="'+;
	             STR(DIGetPropVT("BC_ICMS"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_ALIQ_ICMS_ORIGEM="'+;
	             STR(DIGetPropVT("ALQICMORIG"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_ALIQ_ICMS_DESTINO="'+;
	             STR(DIGetPropVT("ALQICMDEST"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_DIF_ALIQUOTA="'+;
	             STR(DIGetPropVT("DIF_ALIQ"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_ALIQ_ICMS="'+;
	             STR(DIGetPropVT("ALIQ_ICMS"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_ICMS="'+;
	             STR(DIGetPropVT("VLR_ICMS"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_REG_FISCAL_TRIB_ORIGEM="'+;
	             DIGetPropVT("RGTRIBORIG") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_REG_FISCAL_TRIB_DESTINO="'+;
	             DIGetPropVT("RGTRIBDEST") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_BC_ISENTA_ICMS="'+;
	             STR(DIGetPropVT("BASE_ISENT"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_BC_OUTR_ICMS="'+;
	             STR(DIGetPropVT("BASE_OUTR"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_BC_BRUTA_ICMS_RTD="'+;
	             STR(DIGetPropVT("BCBRTRTD_S"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_IVA="'+;
	             STR(DIGetPropVT("IVA"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_BC_ICMS_RTD="'+;
	             STR(DIGetPropVT("BC_RTD_S"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		LSLinhaXML = 'ITDF_ALIQ_ICMS_RTD="'+;
	             STR(DIGetPropVT("ALQICMRTDS"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_ICMS_RTD="'+;
	             STR(DIGetPropVT("ICM_RTD_S"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		LSLinhaXML = 'ITDF_VLR_BC_BRUTA_RTD_ENTRADA="'+;
	             STR(DIGetPropVT("BCBRTRTD_E"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		LSLinhaXML = 'ITDF_VLR_BC_RTD_ENTRADA="'+;
	             STR(DIGetPropVT("BC_RTD_E"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		LSLinhaXML = 'ITDF_VLR_ICMS_RTD_ENTRADA="'+;
	             STR(DIGetPropVT("ICM_RTD_E"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_IND_APURACAO_IPI="'+;
	             DIGetPropVT("INDAPURIPI") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_BC_IPI="'+;
	             STR(DIGetPropVT("BC_IPI"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_ALIQ_IPI="'+;
	             STR(DIGetPropVT("ALIQ_IPI"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_IPI="'+;
	             STR(DIGetPropVT("VLR_IPI"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_BC_ISS="'+;
	             STR(DIGetPropVT("BC_ISS"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_ALIQ_ISS="'+;
	             STR(DIGetPropVT("ALIQ_ISS"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_ISS="'+;
	             STR(DIGetPropVT("VLR_ISS"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_BC_ISS_RTD="'+;
	             STR(DIGetPropVT("BC_ISS_RTD"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_ALIQ_ISS_RTD="'+;
	             STR(DIGetPropVT("ALIQ_ISSRT"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_ISS_RTD="'+;
	             STR(DIGetPropVT("VLR_ISSRTD"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_BC_PIS="'+;
	             STR(DIGetPropVT("BC_PIS"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_ALIQ_PIS="'+;
	             STR(DIGetPropVT("ALIQ_PIS"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_QTDE_BC_PIS="'+;
	             STR(DIGetPropVT("QTDBASEPIS"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_PIS="'+;
	             STR(DIGetPropVT("VLR_PIS"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_PIS_RTD="'+;
	             STR(DIGetPropVT("PIS_RTD"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_BC_COFINS="'+;
	             STR(DIGetPropVT("BC_COFINS"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_ALIQ_COFINS="'+;
	             STR(DIGetPropVT("ALIQCOFINS"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_QTDE_BC_COFINS="'+;
	             STR(DIGetPropVT("QTDBASECOF"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_COFINS="'+;
	             STR(DIGetPropVT("VLR_COFINS"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_COFINS_RTD="'+;
	             STR(DIGetPropVT("COFINS_RTD"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_BC_IR="'+;
	             STR(DIGetPropVT("BC_IR"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_ALIQ_IR="'+;
	             STR(DIGetPropVT("ALIQ_IR"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_IR="'+;
	             STR(DIGetPropVT("VLR_IR"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_IR_RTD="'+;
	             STR(DIGetPropVT("IR_RTD"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_BC_CSLL="'+;
	             STR(DIGetPropVT("BC_CSLL"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_ALIQ_CSLL="'+;
	             STR(DIGetPropVT("ALIQ_CSLL"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_CSLL="'+;
	             STR(DIGetPropVT("VLR_CSLL"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_ADIANTAMENTO_CSLL="'+;
	             STR(DIGetPropVT("ADNTA_CSLL"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_LANC_AUTOMATICO="'+;
	             DIGetPropVT("LANC_AUTO") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_CLAS_CONS_SERV_TELECOM="'+;
	             DIGetPropVT("CLSCOMNC") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_CLAS_CONS_GAS="'+;
	             DIGetPropVT("CLSGAS") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_CLAS_CONS_AGUA="'+;
	             DIGetPropVT("CLSAGUA") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_CLAS_CONS_ENERGIA_ELETR="'+;
	             DIGetPropVT("CLSENRG") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_ALIQ_ICMS_SO="'+;
	             STR(DIGetPropVT("ALIQICMSSO"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_IND_MOD_BC_ICMS="'+;
	             DIGetPropVT("MOD_BCICMS") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_PERCENTUAL_ACRESCIMO="'+;
	             STR(DIGetPropVT("PRC_ACRESC"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_PERCENTUAL_DESCONTO="'+;
	             STR(DIGetPropVT("PRC_DESCON"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_VENDA_UNITARIO="'+;
	             STR(DIGetPropVT("PRECOVENDA"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		LSLinhaXML = 'ITDF_VLR_ABATE_NT="'+;
	             STR(DIGetPropVT("VLRABATENT"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_ACRESCIMO="'+;
	             STR(DIGetPropVT("VLRACRESC"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_BC_BRUTA_ICMS_SO="'+;
	             STR(DIGetPropVT("BCBRICMSSO"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_BC_ICMS_SO="'+;
	             STR(DIGetPropVT("BCICMSSO"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_BC_ISENTA_IPI="'+;
	             STR(DIGetPropVT("BCISENTIPI"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		LSLinhaXML = 'ITDF_VLR_COFINS_IMPORTACAO="'+;
	             STR(DIGetPropVT("VLRCOFIMPO"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_DESPESAS="'+;
	             STR(DIGetPropVT("VLR_DESPES"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		LSLinhaXML = 'ITDF_VLR_ICMS_SO="'+;
	             STR(DIGetPropVT("VLR_ICMSSO"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_PIS_IMPORTACAO="'+;
	             STR(DIGetPropVT("VLRPISIMPO"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_PRODUTOS="'+;
	             STR(DIGetPropVT("VLRPRODUTO"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_SERVICO_NT="'+;
	             STR(DIGetPropVT("VLRSRVC_NT"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_SERVICOS="'+;
	             STR(DIGetPropVT("VLRSERVICO"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_TRIBUTOS="'+;
	             STR(DIGetPropVT("VLRTRIBUTO"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_ORIGEM_MERCADORIA="'+;
	             DIGetPropVT("ORIGEMMRCD") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_O_ITEM_E_SERVICO="'+;
	             DIGetPropVT("ITEMSERVIC") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_PRODUTOS_SERVICOS="'+;
	             STR(DIGetPropVT("TTPRODSRVC"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_GTIM="'+;
	             DIGetPropVT("GTIMCODIGO") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_NCM="'+;
	             DIGetPropVT("NCMCODIGO") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_EX_TIPI="'+;
	             DIGetPropVT("EXTIPI") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		LSLinhaXML = 'ITDF_GENERO="'+;
	             DIGetPropVT("GENEROPROD") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_GTIM_UNIDADE_TRIBUTAVEL="'+;
	             DIGetPropVT("GTIMUNTRIB") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_UNIDADE_TRIBUTAVEL="'+;
	             DIGetPropVT("UNIDTRIBUT") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_UNIDADE_TRIBUTAVEL="'+;
	             STR(DIGetPropVT("VLRUNTRIBU"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_QTDE_UNIDADE_TRIBUTAVEL="'+;
	             STR(DIGetPropVT("QTDTRIBUT"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_CLS_CODIGO_LISTA_SERVICO="'+;
	             DIGetPropVT("CDGLSTSRVC") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_IND_MOD_BC_ICMS_RTD="'+;
	             DIGetPropVT("MODBCICMRT") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_QTDE_BC_COFINS_RTD="'+;
	             STR(DIGetPropVT("QTDBCCOFRT"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		LSLinhaXML = 'ITDF_VLR_ALIQ_COFINS_RTD="'+;
	             STR(DIGetPropVT("VLRALQCFRT"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		LSLinhaXML = 'ITDF_IND_MED_BC_ICMS_RTD="'+;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))






		=W_DEFPROC("DOCFISCA.SPR")
		LSLinhaXML = 'DFIS_CNPJ="'+;
	             DFGetPropVT("CNPJ") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		*-------------------------------------------------------*
		LSLinhaXML = '/>'
					=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


	
		SET POINT TO
		SET SEPARATOR to

RETURN(.t.)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2WC0P615E           DIGetAlias VALID                   
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         DOCFISIT,     Record Number:   21  
*        Variable:            DIGetAlias                         
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      17                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2wc0p615e     &&  DIGetAlias VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION DIGetAlias

	=DIVerifyInst()

RETURN(PBDocFisItAlias)


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2WC0P615G           DICFOPS VALID                      
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         DOCFISIT,     Record Number:   22  
*        Variable:            DICFOPS                            
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      18                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2wc0p615g     &&  DICFOPS VALID
#REGION 1
RETURN

*-------------------------------------------------------*
*-----> DEFINECFOP PARA SERVICO
*-------------------------------------------------------*

FUNCTION DICFOPS
PARAMETERS PrmUFOrgn, PrmMuniOrgn,PrmUFDstn, PrmMuniDstn,PrmTp_mercad,;
           PrmOperacao

	PRIVATE LScfps


	=W_DEFPROC("TRIBUTAR.SPR")
    LScfps = TRCFOPServico(PrmUFOrgn, PrmMuniOrgn,PrmUFDstn,;
    					   PrmMuniDstn,PrmTp_mercad,PrmOperacao)
RETURN(LScfps)




*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2WC0P615K           DICST_IPI VALID                    
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         DOCFISIT,     Record Number:   23  
*        Variable:            DICST_IPI                          
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      19                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2wc0p615k     &&  DICST_IPI VALID
#REGION 1
RETURN

FUNCTION DICST_IPI
PARAMETERS PrmVlrIPI,PrmOperacao
	PRIVATE LScstIPI



	=W_DEFPROC("TRIBUTAR.SPR")
    LScstIPI = TRCST_IPI(PrmVlrIPI,PrmOperacao)

RETURN(LScstIPI)


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2WC0P615M           DICST_ISS VALID                    
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         DOCFISIT,     Record Number:   24  
*        Variable:            DICST_ISS                          
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      20                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2wc0p615m     &&  DICST_ISS VALID
#REGION 1
RETURN

FUNCTION DICST_ISS
PARAMETERS PrmVlrISS,PrmOperacao
	PRIVATE LScstISS


	=W_DEFPROC("TRIBUTAR.SPR")
    LScstISS = TRCST_ISS(PrmVlrISS,PrmOperacao)
RETURN(LScstISS)


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2WC0P615P           DIGenero VALID                     
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         DOCFISIT,     Record Number:   25  
*        Variable:            DIGenero                           
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      21                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2wc0p615p     &&  DIGenero VALID
#REGION 1
RETURN

FUNCTION DIGenero
PARAMETERS PrmTp_mercad,PrmClassifica,PrmOperacao
	PRIVATE LSgenero

	=W_DEFPROC("TRIBUTAR.SPR")
    LSgenero = TRGenero(PrmTp_mercad,PrmClassifica,PrmOperacao)

RETURN(LSgenero)


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2WC0P615S           DICST_Entrada VALID                
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         DOCFISIT,     Record Number:   26  
*        Variable:            DICST_Entrada                      
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      22                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*



FUNCTION _2wc0p615s     &&  DICST_Entrada VALID
#REGION 1
RETURN


FUNCTION DICST_Entrada
PARAMETERS PrmCstInfo,PrmOrigem,PrmTp_Mercad,Prmbase_calc,PrmVlrvenda,;
		Prmicms_subs, PrmCodigo


	PRIVATE LScst

	=W_DEFPROC("TRIBUTAR.SPR")
	LScst = TRCST_Entrada(PrmCstInfo, PrmOrigem, ;
						  PrmTp_Mercad, Prmbase_calc, PrmVlrvenda,;
					  	  Prmicms_subs, PrmCodigo)
RETURN(LScst)


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2WC0P617E           DICST_ICMS VALID                   
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         DOCFISIT,     Record Number:   27  
*        Variable:            DICST_ICMS                         
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      23                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2wc0p617e     &&  DICST_ICMS VALID
#REGION 1
RETURN

FUNCTION DICST_ICMS
PARAMETERS Prmtab_cst,PrmTipo,Prmtp_mercad,PrmProduto

	PRIVATE LScstICMS

	=W_DEFPROC("TRIBUTAR.SPR")
    LScstICMS = TRCST_ICMS(Prmtab_cst,PrmTipo,Prmtp_mercad,PrmProduto)

RETURN(LScstICMS)


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2WC0P617H           DICST_PIS VALID                    
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         DOCFISIT,     Record Number:   28  
*        Variable:            DICST_PIS                          
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      24                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2wc0p617h     &&  DICST_PIS VALID
#REGION 1
RETURN

FUNCTION DICST_PIS
PARAMETERS PrmVlr,PrmOperacao
PRIVATE LScst

	=W_DEFPROC("TRIBUTAR.SPR")
    LScst = TRCST_PIS(PrmVlr,PrmOperacao)
RETURN(LScst)


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2WC0P617K           DICST_COFINS VALID                 
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         DOCFISIT,     Record Number:   29  
*        Variable:            DICST_COFINS                       
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      25                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2wc0p617k     &&  DICST_COFINS VALID
#REGION 1
RETURN

FUNCTION DICST_COFINS
PARAMETERS PrmVlr,PrmOperacao
PRIVATE LScst

	=W_DEFPROC("TRIBUTAR.SPR")
    LScst = TRCST_COFINS(PrmVlr,PrmOperacao)
RETURN(LScst)


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2WC0P617N           DICST_IR VALID                     
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         DOCFISIT,     Record Number:   30  
*        Variable:            DICST_IR                           
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      26                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2wc0p617n     &&  DICST_IR VALID
#REGION 1
RETURN

FUNCTION DICST_IR
PARAMETERS PrmVlr,PrmOperacao
PRIVATE LScst

	=W_DEFPROC("TRIBUTAR.SPR")
    LScst = TRCST_IR(PrmVlr,PrmOperacao)
RETURN(LScst)


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2WC0P617Q           DIGerXMLPeriodoDocFiscal VALID     
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         DOCFISIT,     Record Number:   32  
*        Variable:            DIGerXMLPeriodoDocFiscal           
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      27                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2wc0p617q     &&  DIGerXMLPeriodoDocFiscal VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION DIGerXMLPeriodoDocFiscal
PARAMETER PrmEmpresa,PrmDtIni,PrmDtFim




	PRIVATE LSalias
	
	PRIVATE PrmAlsDI

	PRIVATE LNItDocFiscaCtrRegistro	



	=DIVerifyInst()
	

	LSalias = ALIAS()
	PrmAlsDI = DIGetAlias()




	*-------------------------------------------------------*




   	PRIVATE LSfileXML,LNroIDfileXML, LSnomeArqXml

	LSnomeArqXml = STR(PrmEmpresa,2)+;
				   "IT"+;
				   STR(MONTH(PrmDtFim),2)+;
				   STR(DAY(PrmDtFim),2)

	LSnomeArqXml = CHRTRAN(LSnomeArqXml," ","0")

   	LSfileXML	= "\SCGC\EFD\"+LSnomeArqXml+".XML"






  	LNroIDfileXML 		=fcreate(LSfileXML)
   	if LNroIDfileXML<0
      =fclose(LNroIDfileXML)
      wait 'ERRO cria눯o arquivo tempor쟲io '+LSfileXML+'- <ENTER> ' window
      return
   	endif

	*---------------------------------------------------*

	SELE &PrmAlsDI
	SET ORDER TO TAG DATA_DOC
	SET NEAR ON
	SEEK STR(PrmEmpresa,3)+DTOS(PrmDtIni)
	SET NEAR OFF

	*----------------------------------------------------*
	DO RELINIC.PRG          && INICIA VAR P/ TERMOMETRO

	LFsegue = .t.

	LNItDocFiscaCtrRegistro = RECNO()

	COUNT  WHILE !EOF() ;
	        AND PrmEmpresa =  &PrmAlsDI .empresa;
	        AND PrmDtIni   <= &PrmAlsDI .DT_ENTSAI ;
	        AND PrmDtFim   >= &PrmAlsDI .DT_ENTSAI ;
         TO LNimpressao
	GO LNItDocFiscaCtrRegistro
	LNimpressos = 0
	*----------------------------------------------------*

	=DIInicioXML(LSfileXML,LNroIDfileXML)

	SELE &PrmAlsDI

	DO WHILE !EOF() ;
			AND	LFsegue = .t. ;
	        AND PrmEmpresa =  &PrmAlsDI .empresa;
	        AND PrmDtIni   <= &PrmAlsDI .DT_ENTSAI ;
	        AND PrmDtFim   >= &PrmAlsDI .DT_ENTSAI

		=UPtermo()


		=DIGravaXMLItensDocFiscal(;
				&PrmAlsDI .Empresa,;
				&PrmAlsDI .Mod_doc,;
				&PrmAlsDI .Cod_IDForn,;
				&PrmAlsDI .Nro_Doc,;
				&PrmAlsDI .Serie_Doc,;
				&PrmAlsDI .Nro_Item,;
				LSfileXML,;
				LNroIDfileXML)

		SELE &PrmAlsDI
		SET ORDER TO TAG DATA_DOC


		SET ORDER TO TAG DATA_DOC
		*-----------------------*
		GO LNItDocFiscaCtrRegistro
	
		SKIP
	
		LNItDocFiscaCtrRegistro = RECNO()
	ENDDO
	=DIFinalXML(LSfileXML,LNroIDfileXML)

	DO RELFIM.PRG          && FIM VAR P/ TERMOMETRO
	*-----------------------------------------------*
    =fclose(LNroIDfileXML)
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF

	
RETURN(.T.)

*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2WC0P617X           DIModeloRefXML VALID               
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         DOCFISIT,     Record Number:   33  
*        Variable:            DIModeloRefXML                     
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      28                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2wc0p617x     &&  DIModeloRefXML VALID
#REGION 1
RETURN

FUNCTION DIModeloRefXML


	PRIVATE LSFDocXML
	
	LSFDocXML = "\scgc\loja\automatc\DOCFISIT.XML"
	IF !FILE(LSFDocXML)
		RETURN(.T.)
	ENDIF


	SELE 0
	USE  \scgc\comum\xmlDIFIS EXCL
	ZAP
	PACK

	*------------------------------------------------------------*
	* ESTE COMANDO SERVA PARA ELIMINAR CARACTERES INDESEJADOS
	* DO CABECALHO XML
	*-----------------------------------------------------------*
	SELE xmlDIFIS


	APPEND FROM &LSFDocXML TYPE SDF


	
	REPLACE ALL XML_LINHA WITH chrtran(XML_LINHA,chr(9),chr(32))
	REPLACE ALL XML_ORDEM WITH RECNO()
	GO BOTT
	SKIP -1
	REPLACE XML_ORDEM WITH 9999999999901
	SKIP	
	REPLACE XML_ORDEM WITH 9999999999902
	USE

	IF FILE(LSFDocXML)
		DELETE FILE &LSFDocXML
	ENDIF
		

RETURN


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2WC0P6181           DIInicioXML VALID                  
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         DOCFISIT,     Record Number:   34  
*        Variable:            DIInicioXML                        
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      29                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2wc0p6181     &&  DIInicioXML VALID
#REGION 1
RETURN

FUNCTION DIInicioXML
PARAMETERS 	PrmFileXML,;
			PrmNroIDfileXML



	=DIModeloRefXML()

	*-------------------------------------------------------*

   	PRIVATE lErro
   	PRIVATE LSLinhaXML

	*-------------------------------------------------------*

	SELE 0
	USE  \scgc\comum\xmlDIFIS EXCL
	SET ORDER TO TAG XML_ORDEM
	GO TOP
	
	DO WHILE !EOF() AND xmlDIFIS.XML_ORDEM < 9999999999901
	
		LSLinhaXML = xmlDIFIS.XML_LINHA
		=fPuts(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
		SKIP
	ENDDO
	SELE xmlDIFIS
	USE
		

RETURN


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2WC0P6182           DIFinalXML VALID                   
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         DOCFISIT,     Record Number:   35  
*        Variable:            DIFinalXML                         
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      30                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2wc0p6182     &&  DIFinalXML VALID
#REGION 1
RETURN

FUNCTION DIFinalXML
PARAMETERS 	PrmFileXML,;
			PrmNroIDfileXML


	*-------------------------------------------------------*

   	PRIVATE lErro
   	PRIVATE LSLinhaXML

	*-------------------------------------------------------*

	SELE 0
	USE  \scgc\comum\xmlDIFIS EXCL
	SET ORDER TO TAG XML_ORDEM
	GO TOP
	
	DO WHILE !EOF()
	    IF xmlDIFIS.XML_ORDEM > 9999999999900
			LSLinhaXML = xmlDIFIS.XML_LINHA
			=fPuts(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
		ENDIF
		SKIP
	ENDDO
	SELE xmlDIFIS
	USE
		

RETURN


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2WC0P6183           DIConvrtNFDocFiscal VALID          
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         DOCFISIT,     Record Number:   37  
*        Variable:            DIConvrtNFDocFiscal                
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      31                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2wc0p6183     &&  DIConvrtNFDocFiscal VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION DIConvrtNFDocFiscal
PARAMETERS PrmEmpresa,PrmNota

	PRIVATE PrmAlsNF,PrmAlsIT
	PRIVATE LFLAG_COPIA
	PRIVATE LFLAG_DEVOLUCAO
	PRIVATE LNNroDacComItens
	PRIVATE LNNroWhileNF


	*--------------------------------------------------*
	PRIVATE LNCod_Mod_Rf,LaliqOrg
	
	PRIVATE LOperacao

	PRIVATE LUFDstn

	PRIVATE LMunDstn

	PRIVATE LUFOrig
	PRIVATE LMunOrig
	PRIVATE LTab_Cst

	PRIVATE LNAliq_icms

	*--------------------------------------------------*

	PRIVATE  ;
     PrmSerie,;
	 PrmTipo,;
     RtnNro_Doc,;
	 RtnMod_Doc,;
	 RtnCOD_IDFORN,;
	 RtnSerie_Doc


	*--------------------------------------------------*
	

	=W_DEFPROC("NOTA.SPR")
	PrmAlsNF = NFGetAlias()


	=W_DEFPROC("ITEMMOV.SPR")
	PrmAlsIT = IMGetAlias()


	=W_DEFPROC("NOTA.SPR")
	IF !NFLerRegistro(PrmEmpresa,PrmNota)
		WAIT WINDOW "NFs nao localizada  <ENTER> " NOWAIT
		RETURN(.F.)
	ENDIF




	=W_DEFPROC("EMPRESA.SPR")
	LTab_Cst  	= EMGet_TabCst(  &PrmAlsNF .EMPRESA )




	*---------------------------------------------------*

	LFLAG_COPIA = "NAO"
	LNNroDacComItens = 0

	IF &PrmAlsNF .referencia <> &PrmAlsNF .orcamento ;
	  AND ( &PrmAlsNF .referencia > 1000000 AND ;
	        &PrmAlsNF .referencia < 2000000)

								* ==> TRATA-SE DE UMA NOTA COPIA DE CUPOM

		LFLAG_COPIA    = "SIM"
		LNNroDacComItens =  &PrmAlsNF .referencia  && LER ITENS DO CUPOM
		                                           && ORIGEM DA COPIA

	ELSE
		LNNroDacComItens =  PrmNota				   && LER ITENS DA PROPRIA
		                                           && NOTA
	
	ENDIF
	


	*---------------------------------------------------*
	LFLAG_DEVOLUCAO = "NAO"
	IF &PrmAlsNF .TIPO = "ENT"
		LFLAG_DEVOLUCAO = "SIM"
	ENDIF

	*---------------------------------------------------*


	SET NEAR ON

	SELE &PrmAlsIT

	SET ORDER TO TAG NOTA

	IF LFLAG_DEVOLUCAO = "SIM"
		SEEK STR(PrmEmpresa,3)+"E"+STR(LNNroDacComItens,7)
	ELSE
		SEEK STR(PrmEmpresa,3)+"S"+STR(LNNroDacComItens,7)
	ENDIF

	*---------------------------------------------------*

	IF  PrmEmpresa           <> &PrmAlsIT .empresa ;
		OR  LNNroDacComItens <> &PrmAlsIT .nota

		WAIT WINDOW ;
		   "Nao foi possivel exportar itens-REENVIE <ENTER> " NOWAIT
		RETURN(.F.)
	ENDIF


	IF LEFT(  &PrmAlsIT .operacao,1 ) = "S"
		LOperacao = "SAIDA"
	ELSE
		LOperacao = "ENTRADA"
	ENDIF	


	IF LEFT(  &PrmAlsIT .operacao,1 ) = "S"

		=W_DEFPROC("EMPRESA.SPR")
		LUFOrig   = EMGet_UF(  &PrmAlsNF .EMPRESA )

		=W_DEFPROC("EMPRESA.SPR")
		LMunOrig  = EMGet_Municipio(  &PrmAlsNF .EMPRESA )

		LUFDstn   = &PrmAlsNF .UF
		LMunDstn  = &PrmAlsNF .CIDADE
	ELSE
		=W_DEFPROC("EMPRESA.SPR")
		LUFDstn   = EMGet_UF(  &PrmAlsNF .EMPRESA )

		=W_DEFPROC("EMPRESA.SPR")
		LMunDstn  = EMGet_Municipio(  &PrmAlsNF .EMPRESA )

		LUFOrig  = &PrmAlsNF .UF
		LMunOrig = &PrmAlsNF .CIDADE
	ENDIF	

	=W_DEFPROC("TRIBUTAR.SPR")
	LaliqOrg = TRAlqIcmOuUF(LUFOrig)  && ALIQ. EXTERNA DA UF ORIGEM

	=W_DEFPROC("TRIBUTAR.SPR")
	LaliqDst = TRAlqIcmInUF(LUFDstn)  && ALIQ. Interna DA UF DESTINO

	SET NEAR OFF


	*---------------------------------------------------*




	PrmSerie   		= &PrmAlsNF .Serie
	PrmTipo    		= &PrmAlsNF .tipo
	RtnNro_Doc 		= 0
 	RtnMod_Doc		= ""
	RtnCOD_IDFORN	= ""
	RtnSerie_Doc	= ""
	

	=W_DEFPROC("DOCFISCA.SPR")
	=DFDefIDNFDocFiscal(PrmEmpresa,PrmNota,PrmSerie,PrmTipo,;
					    RtnNro_Doc,RtnMod_Doc,RtnCOD_IDFORN,;
						 RtnSerie_Doc)


    m.EMPRESA    =   PrmEmpresa
    m.TIPO    	 =   PrmTipo
    m.MOD_DOC    =   RtnMod_Doc
    m.COD_IDFORN =   RtnCOD_IDFORN
    m.NRO_DOC    =   RtnNro_Doc
    m.SERIE_DOC  =   RtnSerie_Doc



	*---------------------------------------------------*

	=DIDelItensDocFiscal(;
			PrmEmpresa,;
		 	RtnMod_Doc,;
		  	RtnCOD_IDFORN,;
		  	PrmNota,;
		  	RtnSerie_Doc)

	*---------------------------------------------------*


	DO WHILE !EOF() ;
		   AND PrmEmpresa        = &PrmAlsIT .empresa ;
		   AND LNNroDacComItens  = &PrmAlsIT .nota
	



		IF LFLAG_DEVOLUCAO = "NAO"	 ;
		   AND LEFT( &PrmAlsIT .OPERACAO ,1) <> "S"
		   EXIT

		ENDIF


		IF     LFLAG_DEVOLUCAO = "SIM"	 ;
		   AND LEFT( &PrmAlsIT .OPERACAO ,1) <> "E"
		   EXIT

		ENDIF


		DO CASE

			CASE LFLAG_COPIA    = "SIM"
				DO CASE

					*--------------------------*
					*----> COPIA EM NOTA DE SERVICO
					*--------------------------*
					CASE ( &PrmAlsNF .referencia >= 2000000 AND ;
					       &PrmAlsNF .referencia < 3000000)

				    	IF &PrmAlsIT .tp_mercad <> 7   && SERVICO
							SKIP
							LOOP
						ENDIF


					*--------------------------*
					*----> COPIA EM NOTA DE SERIE UNICA CGB
					*--------------------------*
					CASE ;
						  &PrmAlsNF .empresa = 6 AND ;
						( &PrmAlsNF .referencia >= 1000000 AND ;
					       &PrmAlsNF .referencia < 2000000)

				    	IF &PrmAlsIT .tp_mercad = 7   && SERVICO
							SKIP
							LOOP
						ENDIF
				ENDCASE
				


		ENDCASE




	    m.DT_DOC    	= &PrmAlsNF .data
    	m.DT_ENTSAI    	= &PrmAlsNF .data




		*----------------------------------------------------*
		*  DADOS GERAIS DO ITEM NO REGISTRO
		*----------------------------------------------------*


	    m.NRO_ITEM   = &PrmAlsIT .Ordem
    	m.PRODCODIGO = &PrmAlsIT .Codigo

		=W_DEFPROC("GRUPO.SPR")
		M.PRODDESCR = GRGetFieldValue( &PrmAlsIT .CODIGO,"DESCRICAO")

	    M.PRODDESCR = DFLimpaString(M.PRODDESCR)

	    M.PRODCOMPLE= DFLimpaString( &PrmAlsIT .DescrCompl )

	    M.INFO_COMPL= DFLimpaString( &PrmAlsIT .Info_compl )

		=W_DEFPROC("GRUPO.SPR")
		M.UNIDADE = GRGetFieldValue( &PrmAlsIT .CODIGO,"UNIDADE")
		m.UNIDTRIBUT = M.UNIDADE

		IF EMPTY(M.UNIDADE)
			M.UNIDADE = "UN"
			m.UNIDTRIBUT = "UN"
		ENDIF

    	m.PRECO_TAB  = &PrmAlsIT .Preco
    	m.PRECOMAXTB    =    0
	    m.PRECOMINTB    =    0

		IF &PrmAlsIT .Qtde > 0
		    m.PRECOVENDA    =    &PrmAlsIT .VLRVENDA /  &PrmAlsIT .Qtde
		    m.VLR_UNIDAD    =    &PrmAlsIT .VLRVENDA /  &PrmAlsIT .Qtde
			m.VLRUNTRIBU    =    &PrmAlsIT .VLRVENDA /  &PrmAlsIT .Qtde
		ELSE
			m.PRECOVENDA    =    0
		    m.VLR_UNIDAD    =    0
			m.VLRUNTRIBU    =    0

		ENDIF

	    m.QTDE    		=    &PrmAlsIT .Qtde

		M.QTDTRIBUT	    =    &PrmAlsIT .Qtde
	    m.VLR_DESCTO    =    0
	    m.PRC_DESCTO    =    0
    	m.VLRDESPFIN    =    0
	    m.VLRDESPOUT    =    0
    	m.VLR_FRETE     =    0
	    m.VLR_SEGURO    =    0
    	M.VLR_FINAL    =    &PrmAlsIT .VlrVenda +;
					    	&PrmAlsIT .vlripi+;
					    	&PrmAlsIT .ICMS_SUBS





		IF &PrmAlsIT .MovEstq = "N"  OR LFLAG_COPIA = "SIM"
		    m.IND_MOVEST    =     "NAO"
		ELSE
		    m.IND_MOVEST    =     "SIM"
		ENDIF


    	m.LT_QTITENS    =    0
	    m.LT_NRO   		=    ""
    	m.LT_DT_FABR    =    {}
	    m.LT_VALIDAD    =    {}
	    m.CLSCOMNC    	=    "00"
    	m.CLSGAS    	=    "00"
	    m.CLSAGUA    	=    "00"
    	m.CLSENRG    	=    "00"


		*----------------------------------------------------*
		*  DADOS TRIBUTARIOS DO REGISTRO
		*----------------------------------------------------*
		
	    m.VLRATRIBUT    =     &PrmAlsIT .VlrVenda
    	m.CUSTONAOPE    =     0
	    m.CUSTOMEDAN    =     0

    	IF  &PrmAlsIT .MovEstq = "S"
		    IF  LEFT( &PrmAlsIT .Operacao,1) = "S"
			    m.SALDO_ANT  =  ;
		               &PrmAlsIT .Sld_estq +  &PrmAlsIT .Qtde
			ELSE
			    m.SALDO_ANT  =  ;
	               &PrmAlsIT .Sld_estq -  &PrmAlsIT .Qtde

			ENDIF
		ELSE
		    m.SALDO_ANT   =  &PrmAlsIT .Sld_estq
    	ENDIF



	    IF  &PrmAlsIT .Sld_estq > 0
		    m.CUSTOMEDAT  = ;
	               &PrmAlsIT .Vlr_estq  /  &PrmAlsIT .Sld_estq

		ELSE
		    m.CUSTOMEDAT  =  &PrmAlsIT .Vlr_estq
	    ENDIF

	    m.SALDO_ATU     =  &PrmAlsIT .Sld_estq
	

	    m.CUSTOCONTB =  0



		LTp_mercad = &PrmAlsIT .tp_mercad
    	IF &PrmAlsIT .tp_mercad = 7   && SERVICO

			LScfop =DICFOPS(LUFOrig, ;
					          LMunOrig,;
					          LUFDstn,;
					          LMunDstn,;
					          LTp_mercad,;
					          LOperacao)
		    m.CFOP = LScfop
		ELSE
		    m.CFOP = &PrmAlsIT .CFO
		ENDIF

	    m.CFOP = ALLTRIM(CHRTRAN(m.CFOP,".",""))

		*-----------------------------------------*

		IF	LFLAG_COPIA    = "SIM"
			* m.CFOP	= LEFT(m.CFOP,1)+"929"  && 5929 ou 6929 COPIA CUPOM
			m.CFOP	= "5929"  && 5929    ==> 6929 nao e aceito efd

		ENDIF



		IF	RtnMod_Doc    =   "2D"   && cupom
			m.CFOP	= "5"+SUBS(m.CFOP,2)

		ENDIF

		IF  m.CFOP	= "5404"
			 m.CFOP	= "5403"
		ENDIF

		IF 	m.CFOP	= "5108"
			 m.CFOP	= "5102"
		ENDIF		

		*-----------------------------------------*


		m.origemmrcd = chrtran(str( &PrmAlsIT .origem ,1)," ","0")


		LTipo       = &PrmAlsIT .Tipo
		LProduto 	= &PrmAlsIT .codigo
		LTp_mercad  = &PrmAlsIT .tp_mercad


		LSCst 		= DICST_ICMS(LTab_cst,LTipo,Ltp_mercad,LProduto)
   		m.CST_ICMS  = LSCst


		LSCst 		= DICST_IPI(  &PrmAlsIT .VlrIPI, LOperacao)
    	m.CST_IPI   = LSCst

	    IF &PrmAlsIT .tp_mercad = 7   && SERVICO
			LSCst 	= DICST_ISS(  &PrmAlsIT .VlrVenda, LOperacao)
		ELSE
			LSCst 	= DICST_ISS(  0, LOperacao)
		ENDIF
    	m.CST_ISS	= LSCst

		LSCst		= DICST_PIS(  0, LOperacao)
    	m.CST_PIS   =    LSCst


		LSCst = DICST_IR(  0, LOperacao)
    	m.CST_IR    = LSCst



		=W_DEFPROC("TRIBUTAR.SPR")
		LRgmTrb = TRDef_RgTrbMercad(LUFOrig, ;
						 &PrmAlsIT .Codigo,;
						 'RETORNAR STRING' )
	    m.RGTRIBORIG    =   LRgmTrb



		=W_DEFPROC("TRIBUTAR.SPR")
		LRgmTrb = TRDef_RgTrbMercad(LUFDstn,;
		                          &PrmAlsIT .Codigo,;
						 'RETORNAR STRING' )
	    m.RGTRIBDEST    =   LRgmTrb



	    m.ALQICMORIG    =   LaliqOrg
	    m.ALQICMDEST    =   LaliqDst

	    m.BASE_ISENT    =   &PrmAlsIT .Base_Isent
    	m.BASE_OUTR    	=   &PrmAlsIT .Base_Outr



	    m.BCBRTRTD_S    =   &PrmAlsIT .Base_sbbrt
    	m.IVA    		=   &PrmAlsIT .Iva
	    m.BC_RTD_S    	=   &PrmAlsIT .Base_subs
	    m.ALQICMRTDS    =   m.ALQICMDEST - m.ALQICMORIG

	    IF m.ALQICMRTDS < 0
		    m.ALQICMRTDS = 0
		ENDIF




	    m.BCBRUTAICM =   &PrmAlsIT .BsBr_Icms
    	m.IND_REDUCA =   &PrmAlsIT .aliq_rdu
	    m.BC_ICMS    =   &PrmAlsIT .base_calc
		Laliq  = ABS(LaliqOrg - LaliqDst)

    	m.DIF_ALIQ     =   Laliq
		IF m.BC_ICMS =  0
	    	m.VLR_ICMS     =   0
		ELSE
	    	m.VLR_ICMS     =   &PrmAlsIT .Vlr_Icms
		ENDIF


    	m.ICM_RTD_S    	=   &PrmAlsIT .ICMS_Subs


		DO CASE

			CASE LFLAG_COPIA    = "SIM"
				m.CST_ICMS = m.origemmrcd+"90"

	    	CASE &PrmAlsIT .tp_mercad = 7   && SERVICO
				m.CST_ICMS = m.origemmrcd+"90"
	

			*-------------------------------------------*
			* FOI ALTERADO PARA NAO AFETAR O CST NFe
			*-------------------------------------------*
			*CASE m.BC_ICMS =  0 and m.ICM_RTD_S = 0
			*	m.CST_ICMS = m.origemmrcd+"40"

		ENDCASE




	    m.ALIQ_ICMS    =   &PrmAlsIT .Aliq_Icms

		IF SUBS(m.CST_ICMS,2,2) $ "00/10/20/70"
		    m.ALIQ_ICMS    =   &PrmAlsIT .Aliq_Icms
		endif	


		IF SUBS(m.CST_ICMS,2,2) $ "30/40/41/50/60"
		    m.ALIQ_ICMS    =   0
		endif	

		IF SUBS(m.CST_ICMS,2,2) $ "90"
	    	IF &PrmAlsIT .tp_mercad = 7   && SERVICO
			    m.ALIQ_ICMS    =   0
			ENDIF
		endif	




	    m.BCBRTRTD_E    =   0
    	m.BC_RTD_E    	=   0
	    m.ICM_RTD_E    	=   0

	    m.INDAPURIPI    =   "1"

	    m.BC_IPI    	=   &PrmAlsIT .base_ipi
    	m.ALIQ_IPI    	=   &PrmAlsIT .aliq_ipi
	    m.VLR_IPI    	=   &PrmAlsIT .vlripi


	    m.BC_ISS    	=   &PrmAlsIT .base_iss
	    m.ALIQ_ISS    	=   &PrmAlsIT .aliq_iss
    	m.VLR_ISS    	=   &PrmAlsIT .vlr_iss



	    IF &PrmAlsIT .vlr_issrtd > 0
	    	m.BC_ISS_RTD    =   &PrmAlsIT .base_iss
		    m.ALIQ_ISSRT    =   &PrmAlsIT .aliq_iss
		    m.VLR_ISSRTD    =   &PrmAlsIT .vlr_issrtd


		ELSE
	    	m.BC_ISS_RTD    =   0
		    m.ALIQ_ISSRT    =   0
		    m.VLR_ISSRTD    =   0
		ENDIF

	    m.BC_PIS    	=   &PrmAlsIT .base_iss
    	m.ALIQ_PIS    	=   1.65
	    m.QTDBASEPIS    =   &PrmAlsIT .qtde
    	m.VLR_PIS    	=   ROUND( &PrmAlsIT .base_iss *  1.65 /100,2)


	    m.PIS_RTD    	=   0

    	m.BC_COFINS    	=   &PrmAlsIT .base_iss
	    m.ALIQCOFINS    =   7.6
    	m.QTDBASECOF    =   &PrmAlsIT .qtde
	    m.VLR_COFINS    =   ROUND( &PrmAlsIT .base_iss *  7.6 /100 ,2)


		LSCst = DICST_COFINS(  m.VLR_COFINS, LOperacao)
    	m.CST_COFINS=    LSCst






    	m.COFINS_RTD    =   0

	    m.BC_IR    		=   0
	    m.ALIQ_IR    	=   0
	    m.VLR_IR    	=   0
    	m.IR_RTD    	=   0
	    m.BC_CSLL    	=   0
    	m.ALIQ_CSLL    	=   0
	    m.VLR_CSLL    	=   0
    	m.ADNTA_CSLL    =   0
	    m.LANC_AUTO    	=   "SIM"



	    m.VLRCOFIMPO  	=   0
	    m.VLR_DESPES  	=   0
	    m.VLR_ICMSSO  	=   0
	    m.VLRpisimpo  	=   0

	    m.VLRSRVC_NT   	=   &PrmAlsIT .base_iss

    	M.VLRSERVICO = 0
   	    M.VLRPRODUTO = 0
   	
    	IF &PrmAlsIT .tp_mercad = 7   && SERVICO
    	   M.VLRSERVICO = &PrmAlsIT .VLRVENDA
    	ELSE
    	   M.VLRPRODUTO = &PrmAlsIT .VLRVENDA
    	ENDIF

		M.TTPRODSRVC = M.VLRSERVICO + M.VLRPRODUTO



		M.MODBCICMRT = "0"
		M.MOD_BCICMS = "3"




		=W_DEFPROC("GRUPO.SPR")
		M.GTIMCODIGO = GRGetFieldValue( &PrmAlsIT .CODIGO,"COD_GTIM")
		

		=W_DEFPROC("GRUPO.SPR")
		M.NCMCODIGO = ;
		   ALLTRIM(GRGetFieldValue( &PrmAlsIT .CODIGO,"COD_NCM"))
		M.NCMCODIGO = CHRTRAN(M.NCMCODIGO,".","")

		=W_DEFPROC("GRUPO.SPR")
		M.EXTIPI = ;
		   ALLTRIM(GRGetFieldValue( &PrmAlsIT .CODIGO,"EX_TIPI"))


		=W_DEFPROC("GRUPO.SPR")
		M.GENEROPROD = ;
		   ALLTRIM(GRGetFieldValue( &PrmAlsIT .CODIGO,"COD_GENERO"))



    	IF &PrmAlsIT .tp_mercad = 7   && SERVICO
    	   M.ITEMSERVIC = "S"
    	ELSE
    	   M.ITEMSERVIC = "N"
    	ENDIF



		=W_DEFPROC("GRUPO.SPR")
		M.CDGLSTSRVC = ;
		   ALLTRIM(GRGetFieldValue( &PrmAlsIT .CODIGO,"COD_LSTSRV"))


		LEmpresa    = m.Empresa
		LMod_Doc    = m.Mod_Doc
		LCod_IdForn = m.Cod_IdForn
		LNro_Doc    = m.Nro_Doc
		LSerie_Doc  = m.Serie_Doc
		LNro_Item   = m.Nro_Item


		SELE &PBDocFisItAlias
		SET ORDER TO TAG ITEM
		SEEK STR(Lempresa,3)+Lmod_Doc+LCod_IdForn+;
	      STR(LNro_Doc,7)+LSerie_Doc+STR(LNro_Item,5)



	
		IF !found()
			APPEND BLANK
		ENDIF
		=RLOCK()
		GATHER MEMVAR
		UNLOCK


		SELE &PrmAlsIT
		SKIP
	ENDDO
	*---------------------------------------------------*
RETURN(.t.)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2WC0P6193           DIGerXMLDocFiscal VALID            
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         DOCFISIT,     Record Number:   41  
*        Variable:            DIGerXMLDocFiscal                  
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      32                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2wc0p6193     &&  DIGerXMLDocFiscal VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION DIGerXMLDocFiscal
PARAMETER PrmEmpresa,;
		  PrmMod_Doc,;
		  PrmCOD_IDFORN,;
		  PrmNro_Doc,;
		  PrmSerie_Doc





	PRIVATE LSalias
	
	PRIVATE PrmAlsDI
	=DIVerifyInst()
	

	LSalias = ALIAS()
	PrmAlsDI = DIGetAlias()




	*-------------------------------------------------------*

   	PRIVATE LSfileXML,LNroIDfileXML
   	
   	LSfileXML	= DINmFileXMLDocFiscal(PrmEmpresa,PrmMod_doc,PrmNro_Doc)
   	LSfileXML	= "\SCGC\EFD\"+LSfileXML



  	LNroIDfileXML 		=fcreate(LSfileXML)
   	if LNroIDfileXML<0
      =fclose(LNroIDfileXML)
      wait 'ERRO cria눯o arquivo tempor쟲io '+LSfileXML+'- <ENTER> ' window
      return(.F.)
   	endif

	*---------------------------------------------------*

	SELE &PrmAlsDI
	SET ORDER TO TAG ITEM
	SET NEAR ON
	SEEK STR(PrmEmpresa,3)+PrmMOD_DOC+;
	     PrmCOD_IDFORN+STR(PrmNro_Doc,7)+PrmSERIE_DOC
	SET NEAR OFF

	*----------------------------------------------------*
	DO RELINIC.PRG          && INICIA VAR P/ TERMOMETRO

	LFsegue = .t.

	LNregistro = RECNO()
	*LNimpressao = RECCOUNT()

	COUNT  WHILE !EOF() ;
	        AND PrmEmpresa    = &PrmAlsDI .empresa;
	        AND PrmMod_Doc    = &PrmAlsDI .MOD_DOC ;
	        AND PrmCOD_IDFORN = &PrmAlsDI .COD_IDFORN ;
	        AND PrmNro_Doc       = &PrmAlsDI .NRO_DOC ;
	        AND PrmSERIE_DOC  = &PrmAlsDI .SERIE_DOC ;
         TO LNimpressao
	GO LNregistro
	LNimpressos = 0
	*----------------------------------------------------*

	=DIInicioXML(LSfileXML,LNroIDfileXML)

	SET POINT TO ','

	SELE &PrmAlsDI

	DO WHILE !EOF() ;
			AND	LFsegue = .t. ;
	        AND PrmEmpresa    = &PrmAlsDI .empresa;
	        AND PrmMod_Doc    = &PrmAlsDI .MOD_DOC ;
	        AND PrmCOD_IDFORN = &PrmAlsDI .COD_IDFORN ;
	        AND PrmNro_Doc    = &PrmAlsDI .NRO_DOC ;
	        AND PrmSERIE_DOC  = &PrmAlsDI .SERIE_DOC

		=UPtermo()



		=DIGravaXMLItensDocFiscal(;
				&PrmAlsDI .Empresa,;
				&PrmAlsDI .Mod_doc,;
				&PrmAlsDI .Cod_IDForn,;
				&PrmAlsDI .Nro_Doc,;
				&PrmAlsDI .Serie_Doc,;
				&PrmAlsDI .Nro_Item,;
				LSfileXML,;
				LNroIDfileXML)

		SELE &PrmAlsDI
		SET ORDER TO TAG ITEM
		SKIP
	ENDDO
	=DIFinalXML(LSfileXML,LNroIDfileXML)

	SET POINT TO

	DO RELFIM.PRG          && FIM VAR P/ TERMOMETRO
	*-----------------------------------------------*
    =fclose(LNroIDfileXML)
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF

	
RETURN(.T.)

*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2WC0P619A           DIFind VALID                       
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         DOCFISIT,     Record Number:   42  
*        Variable:            DIFind                             
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      33                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2wc0p619a     &&  DIFind VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION DISQLS

	USE X:\SCGC\CENTRAL\DOCFISIT
	SELECT CFOP, ;
	       SUM(VLR_FINAL) AS TOTAL ;
	FROM DOCFISIT ;
	GROUP BY CFOP


RETURN(LFreturn)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2WC0P619E           DIApuraICMS VALID                  
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         DOCFISIT,     Record Number:   44  
*        Variable:            DIApuraICMS                        
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      34                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _2wc0p619e     &&  DIApuraICMS VALID
#REGION 1
  SET STEP ON	
  SET DATE GERMAN
  SET CENTU ON	
  DO DIApuraIcms WITH 4, {01.01.2009},{31.01.2009}

return

PROCEDURE DIApuraICMS
PARAMETERS ;
		PrmEmpresa,;
		PrmDtInicio,;
		PrmDtFinal

	PRIVATE LSAlias

	=DIVerifyInst()


	LSAlias = 	DIGetAlias()
	
	*--------------------------------------*
	* SELECAO GERAL DO ITENS CONFORME CRITERIO
	* DE EMPRESA E DATAS
	* ---> NAO CONTABILIZA COPIA DE CUPOM
	*--------------------------------------*

	SELECT ;
		   CFOP, ;
	       VLR_FINAL, ;
		   bc_icms,;
		   vlr_icms,;
		   base_isent,;
		   base_outr,;
		   bc_iss,;
		   vlr_ipi,;	
		   icm_rtd_s;
	FROM &LSAlias ;
	WHERE ;
		     &LSAlias .empresa = PrmEmpresa ;
		 AND &LSAlias .dt_EntSai  >= PrmDtInicio ;
		 AND &LSAlias .dt_EntSai  <= PrmDtFinal ;
		 AND !(ALLTRIM( &LSAlias .CFOP )	$ "5929/6929") ;
    into cursor SEL_itens

	*--------------------------------------*

	SELECT ;
		   "RG001"         AS TP_REG,;	
		   CFOP            AS CFOP_AP, ;
	       SUM(VLR_FINAL)  AS VLR_CONTB, ;
		   SUM(bc_icms)    AS BASE_ICMS,;
		   SUM(vlr_icms)   AS VLR_ICMS,;
		   SUM(base_isent) AS VLR_ISENT,;
		   SUM(base_outr+bc_iss+VLR_IPI)  AS OUTRAS,;
		   SUM(icm_rtd_s)  AS ICMS_RTD;
	FROM SEL_itens ;
	GROUP BY CFOP_AP ;
	UNION ;
	SELECT ;
		   "RG002"  AS TP_REG,;	
		   (LEFT(CFOP,1)+"--->") AS CFOP_AP, ;
	       SUM(VLR_FINAL) AS VLR_CONTB,  ;
		   SUM(bc_icms)    AS BASE_ICMS,;
		   SUM(vlr_icms)   AS VLR_ICMS,;
		   SUM(base_isent) AS VLR_ISENT,;
		   SUM(base_outr+bc_iss+VLR_IPI)  AS OUTRAS,;
		   SUM(icm_rtd_s)  AS ICMS_RTD;
	FROM SEL_itens ;
	GROUP BY CFOP_AP;
	UNION ;
	SELECT ;
		   "RG003"         AS TP_REG,;	
		  "TEnt="          AS CFOP_AP, ;
	       SUM(VLR_FINAL)  AS VLR_CONTB,  ;
		   SUM(bc_icms)    AS BASE_ICMS,;
		   SUM(vlr_icms)   AS VLR_ICMS,;
		   SUM(base_isent) AS VLR_ISENT,;
		   SUM(base_outr+bc_iss+VLR_IPI)  AS OUTRAS,;
		   SUM(icm_rtd_s)  AS ICMS_RTD;
	FROM SEL_itens ;
	WHERE CFOP < "5000" ;
	GROUP BY CFOP_AP;
	UNION ;
	SELECT ;
		   "RG003"         AS TP_REG,;	
		  "TSai="          AS CFOP_AP, ;
	       SUM(VLR_FINAL)  AS VLR_CONTB,  ;
		   SUM(bc_icms)    AS BASE_ICMS,;
		   SUM(vlr_icms)   AS VLR_ICMS,;
		   SUM(base_isent) AS VLR_ISENT,;
		   SUM(base_outr+bc_iss+VLR_IPI)  AS OUTRAS,;
		   SUM(icm_rtd_s)  AS ICMS_RTD;
	FROM SEL_itens;
	WHERE CFOP >= "5000" ;
	GROUP BY CFOP_AP;
	order by TP_REG,CFOP_AP;
	into cursor APUracao

	SELECT ;
		  CFOP_AP AS CFOP, ;
	      VLR_CONTB,  ;
		  BASE_ICMS,;
		  VLR_ICMS,;
		  VLR_ISENT,;
		  OUTRAS,;
		  ICMS_RTD;
	FROM APUracao ;
	into cursor APUFinal
	


	=W_DEFPROC("rotinas.spr")
	DO loc_dlog WITH  .t.,.F.,.F.,.F.,.F.,.t.

	SELE APURACAO
	USE
	SELE SEL_itens
	use
	
	SELE APUFinal
	use

	

RETURN	

*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2WC0P619L           DIConvrtNEDocFiscal VALID          
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         DOCFISIT,     Record Number:   45  
*        Variable:            DIConvrtNEDocFiscal                
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      35                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2wc0p619l     &&  DIConvrtNEDocFiscal VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION DIConvrtNEDocFiscal
PARAMETERS PrmEmpresa,PrmNota,PrmFornCod,PrmVT_Acm

	PRIVATE PrmAlsNE,PrmAlsIT

	*--------------------------------------------------*
	PRIVATE LNCod_Mod_Rf,LaliqOrg
	
	PRIVATE LOperacao

	PRIVATE LUFDstn

	PRIVATE LMunDstn


	PRIVATE LNTotalNE
	
	
	PRIVATE LAcmTotItem,;
	        LAcmVicmsItem

	PRIVATE LUFOrig
	PRIVATE LMunOrig
	PRIVATE LTab_Cst

	*--------------------------------------------------*

	PRIVATE ;
    	 PrmSerie,;
		 PrmTipo,;
    	 RtnNro_Doc,;
		 RtnMod_Doc,;
		 RtnCOD_IDFORN,;
		 RtnSerie_Doc

	*--------------------------------------------------*


	=W_DEFPROC("NOTAENT.SPR")
	PrmAlsNE = NEGetAlias()


	=W_DEFPROC("NOTAITE.SPR")
	PrmAlsIT = IEGetAlias()



	=W_DEFPROC("NOTAENT.SPR")
	IF !NELerRegistro(PrmEmpresa,PrmNota,PrmFornCod)
		WAIT WINDOW "NFs nao localizada  <ENTER> " NOWAIT
		RETURN(.F.)
	ENDIF



	
	=W_DEFPROC("notaent.spr")
	LNTotalNE = ;
		 NEGetFieldValue(PrmEmpresa,PrmNota,PrmFornCod,"TOTAL_NOTA")

	LAcmTotItem = 0



	=W_DEFPROC("TIPOOPER.SPR")
	LNCod_Mod_Rf  	= TPGetFieldValue("E",  &PrmAlsNE .tipo ,"Cod_Mod_Rf")



	LOperacao = "ENTRADA"

	=W_DEFPROC("EMPRESA.SPR")
	LTab_Cst  = EMGet_TabCst(  &PrmAlsNE .EMPRESA )

	=W_DEFPROC("EMPRESA.SPR")
	LUFDstn   = EMGet_UF(  &PrmAlsNE .EMPRESA )

	=W_DEFPROC("EMPRESA.SPR")
	LMunDstn  = EMGet_Municipio(  &PrmAlsNE .EMPRESA )

	LUFOrig  = &PrmAlsNE .UF
	LMunOrig = &PrmAlsNE .CIDADE


	=W_DEFPROC("TRIBUTAR.SPR")
	LaliqOrg = TRAlqIcmOuUF(LUFOrig)  && ALIQ. EXTERNA DA UF ORIGEM


	=W_DEFPROC("TRIBUTAR.SPR")
	LaliqDst = TRAlqIcmInUF(LUFDstn)  && ALIQ. Interna DA UF DESTINO

	*---------------------------------------------------*

	SELE &PrmAlsIT
	SET ORDER TO TAG ITEMNOTA
	SET NEAR ON
	SEEK STR( &PrmAlsNE .Empresa,3)+;
		LEFT( &PrmAlsNE .TIPO ,1)+;
		STR(  &PrmAlsNE .CODFORN ,5)+;
		STR(  &PrmAlsNE .NOTA ,6)
	SET NEAR OFF


	PrmVT_Acm[1] = 0
	PrmVT_Acm[2] = 0
	PrmVT_Acm[3] = 0

	*--------------------------------------------------*

	STORE 0 TO  ;
    	 PrmSerie,;
		 PrmTipo,;
    	 RtnNro_Doc,;
		 RtnMod_Doc,;
		 RtnCOD_IDFORN,;
		 RtnSerie_Doc



	PrmSerie = &PrmAlsNE .serie
	PrmTipo  = &PrmAlsNE .tipo

	=W_DEFPROC("NOTAENT.SPR")
	=NEDefIDNFDocFiscal(PrmEmpresa,PrmNota,PrmFornCod,;
						PrmSerie,PrmTipo,;
					    RtnNro_Doc,RtnMod_Doc,RtnCOD_IDFORN,;
						RtnSerie_Doc)





    M.COD_IDFORN   	=  RtnCOD_IDFORN

    M.EMPRESA   	=  PrmEmpresa
    M.TIPO   		=  PrmTipo
    M.NRO_DOC   	=  RtnNro_Doc
    M.SERIE_DOC 	=  RtnSerie_Doc
    m.MOD_DOC   =   RtnMod_Doc


	*---------------------------------------------------*

	=DIDelItensDocFiscal(;
			PrmEmpresa,;
		 	RtnMod_Doc,;
		  	RtnCOD_IDFORN,;
		  	PrmNota,;
		  	RtnSerie_Doc)

	*---------------------------------------------------*



	DO WHILE !EOF() ;
	        AND PrmEmpresa     = &PrmAlsIT .empresa;
	        AND &PrmAlsNE .favorecido = &PrmAlsIT .Favorecido;
	        AND PrmNota    	   = &PrmAlsIT .nota

	    IF  &PrmAlsNE .TIPO <> &PrmAlsIT .tipo
			SKIP
			LOOP
		
		ENDIF


		IF  LEFT( &PrmAlsIT .SITUACAO,1) <> "C"
			SKIP
			LOOP
		
		ENDIF


		IF  &PrmAlsIT .qtde = 0
			SKIP
			LOOP
		
		ENDIF



		set decimals to 2
		


	
		=W_DEFPROC("NOTAENT.SPR")
		LNVlrICMS =  NEClcICMS( PrmEmpresa,PrmNota,PrmFornCod,;
		        &PrmAlsIT .codigo , &PrmAlsIT .vlrvenda)


	
		=W_DEFPROC("NOTAENT.SPR")
		LNBCIcmsOper =  NEBCIcmsOper( PrmEmpresa,PrmNota,PrmFornCod,;
		        &PrmAlsIT .codigo , &PrmAlsIT .vlrvenda)




		=W_DEFPROC("NOTAENT.SPR")
		LNVlrICMSSO =  NEIcmsOper( PrmEmpresa,PrmNota,PrmFornCod,;
		        &PrmAlsIT .codigo , &PrmAlsIT .vlrvenda)



		
		=W_DEFPROC("NOTAENT.SPR")
		LNBsBrRetido =  NEBsBrRetido( ;
		        PrmEmpresa,;
		        PrmNota,;
		        PrmFornCod, ;
		        &PrmAlsIT .codigo , ;
		        &PrmAlsIT .vlrvenda ,;
   		        &PrmAlsIT .vlripi )



		=W_DEFPROC("NOTAENT.SPR")
		LNBsRetido =  NEBsRetido( ;
		        PrmEmpresa,;
		        PrmNota,;
		        PrmFornCod, ;
		        &PrmAlsIT .codigo , ;
   		        LNBsBrRetido )





		=W_DEFPROC("NOTAENT.SPR")
		LNRetido =  NEClcRetido(;
		        PrmEmpresa, ;
		        PrmNota,;
		        PrmFornCod,;
		        &PrmAlsIT .codigo , ;
		        LNVlrICMS , ;
   		        LNBsRetido,;
   		        LNVlrICMSSO)


		*----------------------------------------------------*


		


	    M.DT_DOC   	=  &PrmAlsNE .data_EMI
    	M.DT_ENTSAI =  &PrmAlsNE .Data

		*----------------------------------------------------*
		*  DADOS GERAIS DO ITEM NO REGISTRO
		*----------------------------------------------------*





	    M.NRO_ITEM 	= &PrmAlsIT .Ordem
    	M.PRODCODIGO= &PrmAlsIT .Codigo

		=W_DEFPROC("GRUPO.SPR")
		M.PRODDESCR = GRGetFieldValue( &PrmAlsIT .CODIGO,"DESCRICAO")

		M.PRODDESCR   = DFLimpaString( M.PRODDESCR)

	    M.PRODCOMPLE  = DFLimpaString( &PrmAlsIT .DESCRCOMPL )

	    M.INFO_COMPL  = DFLimpaString( &PrmAlsIT .INFO_COMPL )




		=W_DEFPROC("GRUPO.SPR")
		M.UNIDADE = GRGetFieldValue( &PrmAlsIT .CODIGO,"UNIDADE")
		m.UNIDTRIBUT = M.UNIDADE



		IF EMPTY(M.UNIDADE)
			M.UNIDADE = "UN"
			m.UNIDTRIBUT = "UN"
		ENDIF

    	M.PRECO_TAB    =    &PrmAlsIT .Preco
    	M.PRECOMAXTB   =    0
	    M.PRECOMINTB   =    0


		IF &PrmAlsIT .Qtde > 0
		    m.PRECOVENDA    =    &PrmAlsIT .VLRVENDA /  &PrmAlsIT .Qtde
		    m.VLR_UNIDAD    =    &PrmAlsIT .VLRVENDA /  &PrmAlsIT .Qtde
			m.VLRUNTRIBU    =    &PrmAlsIT .VLRVENDA /  &PrmAlsIT .Qtde
		ELSE
			m.PRECOVENDA    =    0
		    m.VLR_UNIDAD    =    0
			m.VLRUNTRIBU    =    0

		ENDIF


	    M.PRECO_UNIT   =    &PrmAlsIT .Preco
	    M.QTDE   	   =    &PrmAlsIT .Qtde

		M.QTDTRIBUT	    =    &PrmAlsIT .Qtde

	    M.VLR_DESCTO   =    0
	    M.PRC_DESCTO   =    0
    	M.VLRDESPFIN   =    0
	    M.VLRDESPOUT   =    0
    	M.VLR_FRETE    =    0
	    M.VLR_SEGURO   =    0
	
    	M.VLR_FINAL    =    &PrmAlsIT .VlrVenda +;
					    	&PrmAlsIT .vlripi+;
					    	LNRetido
    	
    	*M.VLR_FINAL    =    (INT(M.VLR_FINAL*100)/100)


		LAcmTotItem    =    LAcmTotItem + M.VLR_FINAL






    	
    	
		IF &PrmAlsIT .MovEstq = "S"
		    M.IND_MOVEST   =     "SIM"
		ELSE
		    M.IND_MOVEST   =     "NAO"
		ENDIF
    	M.LT_QTITENS   =    0
	    M.LT_NRO   	   =    ""
    	M.LT_DT_FABR   =    {}
	    M.LT_VALIDAD   =    {}
	    M.CLSCOMNC     =    "00"
    	M.CLSGAS       =    "00"
	    M.CLSAGUA      =    "00"
    	M.CLSENRG      =    "00"


		*----------------------------------------------------*
		*  DADOS TRIBUTARIOS DO REGISTRO
		*----------------------------------------------------*
		
	    M.VLRATRIBUT   =     &PrmAlsIT .VlrVenda
    	M.CUSTONAOPE   =     0
	    M.CUSTOMEDAN   =     0


	*--------
	    M.SALDO_ATU   =    0
	    M.CUSTOMEDAT   =    0

	*----------
	    M.SALDO_ANT    =   0
	    M.CUSTOCONTB   =   0




		LTipo       = &PrmAlsIT .Tipo
		LProduto    = &PrmAlsIT .codigo
		LTp_mercad  = &PrmAlsIT .tp_mercad



*---------

		=W_DEFPROC("TRIBUTAR.SPR")
		M.CFOP = TRCFO(&PrmAlsIT .Empresa, ;
		              &PrmAlsIT .Tipo,;
		              &PrmAlsIT .tp_mercad,;
		              "ENTRADA")

*--------


	    m.CFOP = ALLTRIM(CHRTRAN(m.CFOP,".",""))


		m.origemmrcd = chrtran(str( &PrmAlsIT .origem ,1)," ","0")



		LSCst = DICST_IPI(  &PrmAlsIT .VlrIPI, LOperacao)
    	M.CST_IPI   =   LSCst

	    IF &PrmAlsIT .tp_mercad = 7   && SERVICO
			LSCst = DICST_ISS(  &PrmAlsIT .VlrVenda, LOperacao)
		ELSE
			LSCst = DICST_ISS(  0, LOperacao)
		ENDIF
    	M.CST_ISS   =   LSCst

		LSCst = DICST_PIS(  0, LOperacao)
    	M.CST_PIS   =   LSCst

		LSCst = DICST_COFINS(  0, LOperacao)
    	M.CST_COFINS   =   LSCst

		LSCst = DICST_IR(  0, LOperacao)
    	M.CST_IR   =   LSCst



	    M.ALQICMORIG   =   LaliqOrg
	    M.ALQICMDEST   =   LaliqDst



IF 1=1
		=W_DEFPROC("TRIBUTAR.SPR")
		M.CST_ICMS  =  TRCST_Entrada(;
				 &PrmAlsIT .cst,;
				 &PrmAlsIT .origem, ;
				 &PrmAlsIT .tp_mercad,;
				 &PrmAlsIT .base_calc,;
		  		 &PrmAlsIT .vlrvenda,;
		  		 &PrmAlsIT .icms_subs, ;
		  		 &PrmAlsIT .codigo, ;
		  		 &PrmAlsNE .tipo)

		*-------------   ICMS ----------------


   		M.BC_ICMS         =   &PrmAlsIT .base_calc

	    IF &PrmAlsIT .BsBr_Icms >= &PrmAlsIT .base_calc  	
		      M.BCBRUTAICM   =   &PrmAlsIT .BsBr_Icms
	    ELSE
	    	  M.BCBRUTAICM   =   &PrmAlsIT .base_calc
   		ENDIF
   		M.VLR_ICMS   =   &PrmAlsIT .Vlr_Icms


	    M.BCBRTRTD_S   =   LNBsBrRetido
	    M.BC_RTD_S     =   LNBsRetido
	   	M.ALQICMRTDS   =   &PrmAlsIT .Aliq_Icms
	   	M.ICM_RTD_S    =   LNRetido

		M.IND_REDUCA   =   &PrmAlsIT .Aliq_rdu










ELSE

		DO CASE
			CASE;
			 &PrmAlsNE .tipo $ ;
 			 "CLG/CLH/CFG/CFH/CFM/CID/CLC/CLD/CFC/CFD/CIB/CLE/CLF/CFS/CFE/";
 			 OR ;
			 &PrmAlsNE .tipo $ ;
 			 "CFF/CIC/CLJ/CFL/ASC/CEE/ASI/CFJ/CFK/TAB/TBB/TAC/TBC/TAD/TBD/";
 			 OR ;
			 &PrmAlsNE .tipo $ ;
 			 "RBV/RBU/RBF/RBH/RBJ/RBM/RBN/RBG/RBI/RBL/RBO/RAC/RBC/RIB/RAA/";
 			 OR ;
			 &PrmAlsNE .tipo $ ;
 			 "RBR/RAE/RBE/RID/RBP/RBQ/RCA/RDA/DAF/DBF/DAC/DBC/DBD/DAE/DBE/";
 			 OR ;
			 &PrmAlsNE .tipo $ ;
 			 "DAG/DBG/"
	   		    M.CST_ICMS     =   m.origemmrcd+"90"

		   		M.BC_ICMS         = &PrmAlsIT .base_calc
			    IF &PrmAlsIT .BsBr_Icms >= &PrmAlsIT .base_calc  	
  			      M.BCBRUTAICM    =   &PrmAlsIT .BsBr_Icms
			    ELSE
  		    	  M.BCBRUTAICM    =   &PrmAlsIT .base_calc
		   		ENDIF
      	   		M.VLR_ICMS   	  =   &PrmAlsIT .Vlr_Icms

			    M.BCBRTRTD_S   =   0
			    M.BC_RTD_S     =   0
		    	M.ALQICMRTDS   =   0
		    	M.ICM_RTD_S    =    0




			CASE    LNBsRetido = 0 ;
				AND &PrmAlsIT .vlr_icms = 0 ;
				AND &PrmAlsIT .tp_mercad = 2


	   		    M.CST_ICMS     =   m.origemmrcd+"60"
			    M.BCBRUTAICM   =   0
    			M.IND_REDUCA   =   0
		    	M.BC_ICMS      =   0
    	  		M.VLR_ICMS     =   0

			    M.BCBRTRTD_S   =   LNBsBrRetido
			    M.BC_RTD_S     =   LNBsRetido
		    	M.ALQICMRTDS   =   &PrmAlsIT .Aliq_Icms
		    	M.ICM_RTD_S    =   LNRetido


			
			CASE    LNBsRetido > 0 AND LNVlrICMSSO > 0

				*--------------------------------
				*--> atende nota entrada 257849 bgs
				*--------------------------------

				M.BC_ICMS    =   0
      	 		M.VLR_ICMS   =   0
	   		    M.CST_ICMS   =   m.origemmrcd+"10"
			    M.BCBRUTAICM =   0

				*------------------------------------*

			    M.BCBRTRTD_S   =   LNBsBrRetido
			    M.BC_RTD_S     =   LNBsRetido
		    	M.ALQICMRTDS   =   &PrmAlsIT .Aliq_Icms
		    	M.ICM_RTD_S    =   LNRetido

			CASE    LNBsRetido > 0  ;
				     AND  &PrmAlsIT .vlr_icms > 0

				*--------------------------------
				*--> atende nota entrada 2135/.36/.37/.38 bgs
				*--------------------------------



				M.BC_ICMS    =   0
      	 		M.VLR_ICMS   =   0
	   		    M.CST_ICMS   =   m.origemmrcd+"10"
			    M.BCBRUTAICM =   0



			    M.BCBRTRTD_S   =   LNBsBrRetido
			    M.BC_RTD_S     =   LNBsRetido
		    	M.ALQICMRTDS   =   &PrmAlsIT .Aliq_Icms
		    	M.ICM_RTD_S    =   LNRetido


    	  	OTHERWISE
	  		    M.CST_ICMS        = m.origemmrcd+ &PrmAlsIT .cst + "0"
		   		M.BC_ICMS         =   &PrmAlsIT .base_calc

			    IF &PrmAlsIT .BsBr_Icms >= &PrmAlsIT .base_calc  	
  			      M.BCBRUTAICM   =   &PrmAlsIT .BsBr_Icms
			    ELSE
  		    	  M.BCBRUTAICM   =   &PrmAlsIT .base_calc
		   		ENDIF
      	   		M.VLR_ICMS   =   &PrmAlsIT .Vlr_Icms

			    M.BCBRTRTD_S   =   0
			    M.BC_RTD_S     =   0
		    	M.ALQICMRTDS   =   0
		    	M.ICM_RTD_S   =    0

      	ENDCASE

ENDIF
		=W_DEFPROC("TRIBUTAR.spr")
		M.IVA= TRGet_IVA( LUFOrig, ;
		                  &PrmAlsIT .codigo ,;
		                  LUFDstn,;
		                  M.DT_DOC )



		****** M.IVA          =   &PrmAlsIT .Iva
		

		IF 	M.VLR_ICMS  =  0
	    	M.BC_ICMS      =   0
   	  		M.VLR_ICMS     =   0
		ENDIF




		IF LUFDstn = LUFOrig
		    M.ALIQ_ICMS  =   LaliqDst
		ELSE
		    M.ALIQ_ICMS  =   LaliqOrg  && ---> &PrmAlsIT .Aliq_Icms
		ENDIF



		IF SUBS(M.CST_ICMS,2,2) $ "30/40/41/50/60"

			M.BCBRICMSSO   = M.BC_ICMS
			M.BCICMSSO     = M.BC_ICMS
			M.ALIQICMSSO   = M.ALIQ_ICMS
			M.VLR_ICMSSO   = M.VLR_ICMS
			
			
	    	M.BC_ICMS      =   0
		    M.ALIQ_ICMS    =   0
   	  		M.VLR_ICMS     =   0

		ENDIF

		IF SUBS(M.CST_ICMS,2,2) $ "90"
		    M.BCBRTRTD_S   =   0
		    M.BC_RTD_S     =   0
	    	M.ALQICMRTDS   =   0
	    	M.ICM_RTD_S    =    0
		ENDIF






		Laliq  = ABS(LaliqOrg - LaliqDst)
    	M.DIF_ALIQ   =   Laliq



		=W_DEFPROC("TRIBUTAR.SPR")
		LRgmTrb = TRDef_RgTrbMercad(LUFOrig,;
		                           &PrmAlsIT .Codigo,;
						 'RETORNAR STRING' )

	    M.RGTRIBORIG   =   LRgmTrb

		=W_DEFPROC("TRIBUTAR.SPR")
		LRgmTrb = TRDef_RgTrbMercad(LUFDstn,;
					  &PrmAlsIT .Codigo,;
						 'RETORNAR STRING' )

	    m.RGTRIBDEST   =   LRgmTrb

	  	IF &PrmAlsNE .BASE_ISENT = 0
		    M.BASE_ISENT   =   0
		ELSE
		    M.BASE_ISENT   =   ;
		    				M.VLR_FINAL ;
						    - ( &PrmAlsIT .vlripi;
					    	+   LNRetido)
		ENDIF
		
		
		




	    M.BCBRTRTD_E   =   0
    	M.BC_RTD_E   =   0
	    M.ICM_RTD_E   =   0

	    M.INDAPURIPI   =   "1"


	    M.BC_IPI    =   &PrmAlsIT .vlrvenda
    	M.ALIQ_IPI  =   &PrmAlsIT .aliq_ipi
	    M.VLR_IPI   =   &PrmAlsIT .vlripi


	    M.BC_ISS   =   &PrmAlsIT .base_iss
	    M.ALIQ_ISS   =   &PrmAlsIT .aliq_iss
    	M.VLR_ISS   =   &PrmAlsIT .vlr_iss



	    M.BASE_OUTR   =   M.VLR_FINAL;
	                     - M.BASE_ISENT ;
	                     - ( &PrmAlsIT .vlripi;
					    	+ LNRetido)


		*--------  AJUSTES FINAIS


    	M.VLRSERVICO = 0
   	    M.VLRPRODUTO = 0
   	
    	IF &PrmAlsIT .tp_mercad = 7   && SERVICO
    	   M.VLRSERVICO = &PrmAlsIT .VLRVENDA
    	ELSE
    	   M.VLRPRODUTO = &PrmAlsIT .VLRVENDA
    	ENDIF

		M.TTPRODSRVC = M.VLRSERVICO + M.VLRPRODUTO


		M.MODBCICMRT = "0"
		M.MOD_BCICMS = "3"




		=W_DEFPROC("GRUPO.SPR")
		M.GTIMCODIGO = GRGetFieldValue( &PrmAlsIT .CODIGO,"COD_GTIM")


		=W_DEFPROC("GRUPO.SPR")
		M.NCMCODIGO = ;
		   ALLTRIM(GRGetFieldValue( &PrmAlsIT .CODIGO,"COD_NCM"))
		M.NCMCODIGO = CHRTRAN(M.NCMCODIGO,".","")


		=W_DEFPROC("GRUPO.SPR")
		M.EXTIPI = ;
		   ALLTRIM(GRGetFieldValue( &PrmAlsIT .CODIGO,"EX_TIPI"))


		=W_DEFPROC("GRUPO.SPR")
		M.GENEROPROD = ;
		   ALLTRIM(GRGetFieldValue( &PrmAlsIT .CODIGO,"COD_GENERO"))



    	IF &PrmAlsIT .tp_mercad = 7   && SERVICO
    	   M.ITEMSERVIC = "S"
    	ELSE
    	   M.ITEMSERVIC = "N"
    	ENDIF


		=W_DEFPROC("GRUPO.SPR")
		M.CDGLSTSRVC = ;
		   ALLTRIM(GRGetFieldValue( &PrmAlsIT .CODIGO,"COD_LSTSRV"))

		*-----------------------------------------*
		* AS ENTRADA ESTAO GERANDO SALDO CREDOR INDEVIDO
		* SENDO ASSIM PASSAMOS O CST = 060 PARA 030
		* E ZERAMOS CAMPOS DE SUBSTITUICAO
		*-----------------------------------------*

		IF LNRetido > 0
   		    M.CST_ICMS     =   m.origemmrcd+"30"

	    	M.BC_ICMS      =   0
		    M.ALIQ_ICMS    =   0
   	  		M.VLR_ICMS     =   0



	   		** M.ALQICMRTDS   =   0


		    M.BCBRTRTD_E   =   M.BCBRTRTD_S
	    	M.BC_RTD_E     =   M.BC_RTD_S
	    	M.ICM_RTD_E    =   M.ICM_RTD_S


		    M.BCBRTRTD_S   =   0
		    M.BC_RTD_S     =   0
		   	M.ICM_RTD_S    =   0
		ENDIF





    	M.BC_ISS_RTD   =   0
	    M.ALIQ_ISSRT   =   0
	    M.VLR_ISSRTD   =   0

	    M.BC_PIS   	 =   0
    	M.ALIQ_PIS   =   0
	    M.QTDBASEPIS =   0
    	M.VLR_PIS    =   0
	    M.PIS_RTD    =   0
    	M.BC_COFINS  =   0
	    M.ALIQCOFINS =   0
    	M.QTDBASECOF =   0
	    M.VLR_COFINS =   0
    	M.COFINS_RTD =   0
    	M.VLRALQCFRT =   0
	    M.BC_IR   	 =   0
	    M.ALIQ_IR    =   0
	    M.VLR_IR     =   0
    	M.IR_RTD     =   0
	    M.BC_CSLL    =   0
    	M.ALIQ_CSLL  =   0
	    M.VLR_CSLL   =   0
    	M.ADNTA_CSLL =   0
	    M.LANC_AUTO  =   "SIM"


*------------------------------------------------
		PrmVT_Acm[1] = PrmVT_Acm[1] + M.VLR_ICMS
		PrmVT_Acm[2] = PrmVT_Acm[2] + M.BC_ICMS
		PrmVT_Acm[3] = PrmVT_Acm[3] + M.VLR_IPI


*------------------------------------------------



***		=DISalvarRegistro()


		LEmpresa    = m.Empresa
		LMod_Doc    = RtnMod_Doc
		LCod_IdForn = RtnCOD_IDFORN
		LNro_Doc    = RtnNro_Doc
		LSerie_Doc  = RtnSerie_Doc
		LNro_Item   = m.Nro_Item


		SELE &PBDocFisItAlias
		SET ORDER TO TAG ITEM
		SEEK STR(Lempresa,3)+Lmod_Doc+LCod_IdForn+;
	      STR(LNro_Doc,7)+LSerie_Doc+STR(LNro_Item,5)
	
		IF !found()
			APPEND BLANK
		ENDIF
		=RLOCK()
		GATHER MEMVAR
		UNLOCK

		SELE &PrmAlsIT
		SKIP
	ENDDO


*	IF PRMNOTA = 1892
*      SET STEP ON
*	ENDIF

	LNdifTotal = LNTotalNE - LAcmTotItem

	PrmVT_Acm[4] = LAcmTotItem






*	IF ABS(LNdifTotal) > 0
*		=DIAjustaVlr()
*	ENDIF


	*---------------------------------------------------*
RETURN(.t.)

FUNCTION DIAjustaVlr

	PRIVATE  LNICM_RTD_S
	PRIVATE  LNVLR_FINAL

	SET NEAR ON

	SELE &PBDocFisItAlias
	SET ORDER TO TAG ITEM
	SEEK STR(Lempresa,3)+Lmod_Doc+LCod_IdForn+;
	      STR(LNro_Doc,7)+LSerie_Doc+STR(0,5)
	
	SET NEAR OFF
	
	DO WHILE !EOF() ;
	   AND  &PBDocFisItAlias .EMPRESA = Lempresa ;
	   AND  &PBDocFisItAlias .MOD_DOC = Lmod_Doc ;
	   AND  &PBDocFisItAlias .COD_IDFORN = LCod_IdForn ;
	   AND  &PBDocFisItAlias .NRO_DOC    = LNro_Doc ;
	   AND  &PBDocFisItAlias .SERIE_DOC  = LSerie_Doc
	
	   LNICM_RTD_S = &PBDocFisItAlias .ICM_RTD_S
	   LNVLR_FINAL = &PBDocFisItAlias .VLR_FINAL


	   IF LNICM_RTD_S > 0
	   	  REPLACE  &PBDocFisItAlias .ICM_RTD_S ;
	   	    WITH   LNICM_RTD_S + LNdifTotal

	   	  REPLACE  &PBDocFisItAlias .VLR_FINAL ;
	   	    WITH   LNVLR_FINAL + LNdifTotal

		  EXIT
	   ENDIF
	   SKIP	
	
	ENDDO	

	

RETURN


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2WC0P61B4           DINmFileXMLDocFiscal VALID         
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         DOCFISIT,     Record Number:   46  
*        Variable:            DINmFileXMLDocFiscal               
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      36                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2wc0p61b4     &&  DINmFileXMLDocFiscal VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION DINmFileXMLDocFiscal
PARAMETER PrmEmpresa,PrmMod_Doc,PrmNro_Doc


	*-------------------------------------------------------*

   	PRIVATE LSfileXML, LNroIDfileXML, LSnomeArqXml
	
	*----------------------------------------------------------*


	LSnomeArqXml = "DFISIT"+;
				   PrmMod_Doc
	LSnomeArqXml = CHRTRAN(LSnomeArqXml," ","0")


   	LSfileXML	= LSnomeArqXml+".XML"
	
RETURN(LSfileXML)


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2WC0P61B5           DIDelItensDocFiscal VALID          
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         DOCFISIT,     Record Number:   47  
*        Variable:            DIDelItensDocFiscal                
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      37                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2wc0p61b5     &&  DIDelItensDocFiscal VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION DIDelItensDocFiscal
PARAMETER PrmEmpresa,;
		  PrmMod_Doc,;
		  PrmCOD_IDFORN,;
		  PrmNota,;
		  PrmSerie_Doc





	PRIVATE LSalias
	
	PRIVATE PrmAlsDI
	=DIVerifyInst()
	

	LSalias = ALIAS()
	PrmAlsDI = DIGetAlias()



	*-------------------------------------------------------*

	SELE &PrmAlsDI
	SET ORDER TO TAG ITEM
	SET NEAR ON
	SEEK STR(PrmEmpresa,3)+PrmMOD_DOC+;
	     PrmCOD_IDFORN+STR(PrmNota,7)+PrmSERIE_DOC
	SET NEAR OFF

	*----------------------------------------------------*

	SELE &PrmAlsDI

	DO WHILE !EOF() ;
			AND	LFsegue = .t. ;
	        AND PrmEmpresa    = &PrmAlsDI .empresa;
	        AND PrmMod_Doc    = &PrmAlsDI .MOD_DOC ;
	        AND PrmCOD_IDFORN = &PrmAlsDI .COD_IDFORN ;
	        AND PrmNota       = &PrmAlsDI .NRO_DOC ;
	        AND PrmSERIE_DOC  = &PrmAlsDI .SERIE_DOC

		=RLOCK()
		DELETE
		SKIP
	ENDDO
	*-----------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF

	
RETURN(.T.)

*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2WC0P61B6           DIV01GravaXMLItensDocFiscal VALID  
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         DOCFISIT,     Record Number:   49  
*        Variable:            DIV01GravaXMLItensDocFiscal        
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      38                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2wc0p61b6     &&  DIV01GravaXMLItensDocFiscal VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION DIV01GravaXMLItensDocFiscal
PARAMETERS  PrmEmp,;
			PrmMod_doc,;
			PrmCod_IDForn,;
			PrmNro_Doc,;
			PrmSerie_Doc,;
			PrmNro_Item,;
			PrmFileXML,;
			PrmNroIDfileXML

	*---------------------------------------------------*

	IF !DILerRegistro(PrmEmp,;
			PrmMod_doc,;
			PrmCod_IDForn,;
			PrmNro_Doc,;
			PrmSerie_Doc,;
			PrmNro_Item)
	      wait "Nao foi localizado Item DOC.FISCL :"+;
		      "FILIAL: "+STR(PrmEMPRESA,3)+;
		      "MODELO: "+MOD_DOC+;
		      "FORN. : "+PrmCOD_IDFORN+;
		      "NRO.  : "+STR(PrmNRO_DOC,7)+;
		      "SERIE : "+PrmSERIE_DOC+;
		      "ITEM  : "+STR(PrmNro_Item,4)
    	  return(.F.)
	ENDIF


	IF DIGetPropVT("QTDE") = 0
    	  return(.t.)
	ENDIF		




	=W_DEFPROC("DOCFISCA.SPR")
	IF !DFLerRegistro(PrmEmp,;
			PrmMod_doc,;
			PrmCod_IDForn,;
			PrmNro_Doc,;
			PrmSerie_Doc)
	      wait "Nao foi localizado Capa DOC.FISCL :"+;
		      "FILIAL: "+STR(PrmEMPRESA,3)+;
		      "MODELO: "+MOD_DOC+;
		      "FORN. : "+PrmCOD_IDFORN+;
		      "NRO.  : "+STR(PrmNRO_DOC,7)+;
		      "SERIE : "+PrmSERIE_DOC
    	  return(.F.)
	ENDIF
	

	*-------------------------------------------------------*

   	PRIVATE lErro
   	PRIVATE LSLinhaXML

	SET POINT TO ","
	SET SEPARATOR  TO "."


	*-------------------------------------------------------*


		=W_DEFPROC("EMPRESA.SPR")
		=EMLerRegistro(PrmEmp)

		=W_DEFPROC("EMPRESA.SPR")
		LFieldTmp    =  EMGetPropVT("CGC")
	    UNEM_CNPJ    =  STR(LFieldTmp,14)
		UNEM_CNPJ    =  chrtran(UNEM_CNPJ, " ","0")


		LSLinhaXML = '<ROW UNEM_CNPJ="'+UNEM_CNPJ+'"'
					=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	


		*==========================================================*
		*  CAMPOS IDENTIFICADORES
		*==========================================================*
	

		=W_DEFPROC("EMPRESA.SPR")
		LFieldTmp    =  EMGetPropVT("EMITE_NFE")

		IF LFieldTmp $ "H"   && H=HOMOLOGACAO

			=W_DEFPROC("DOCFISCA.SPR")
			LSLinhaXML = 'DFIS_MOD_DOCUMENTO="'+;
	    	         "55" +;
	        	     '"'
					=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		ELSE
			=W_DEFPROC("DOCFISCA.SPR")
			LSLinhaXML = 'DFIS_MOD_DOCUMENTO="'+;
	    	         DFGetPropVT("MOD_DOC") +;
	        	     '"'
					=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
		ENDIF



		=W_DEFPROC("DOCFISCA.SPR")
		LSLinhaXML = 'DFIS_CLFS_SIGLA="'+;
	             DFGetPropVT("TIPO") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))



		=W_DEFPROC("DOCFISCA.SPR")
		LSLinhaXML = 'DFIS_IND_OPERACAO="'+;
	             DFGetPropVT("IND_OPER") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		=W_DEFPROC("DOCFISCA.SPR")
		LSLinhaXML = 'DFIS_TP_MOVIMENTO="'+;
	             DFGetPropVT("TP_MOV") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))



		*----------------------------------------------------------*
		=W_DEFPROC("DOCFISCA.SPR")
		LNNro_Doc  = DFGetPropVT("NRO_DOC")
		IF LNNro_Doc > 3000000
			LNNro_Doc = LNNro_Doc - 3000000
		ENDIF

		LSLinhaXML = ULtratalinha('DFIS_NRO_DOCUMENTO="'+;
	             STR(LNNro_Doc,7) +;
	             '"')
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
		*----------------------------------------------------------*



		=W_DEFPROC("DOCFISCA.SPR")
		LSLinhaXML = 'DFIS_CPF="'+;
	             DFGetPropVT("CPF") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		=W_DEFPROC("DOCFISCA.SPR")
		LSLinhaXML = 'DFIS_IE="'+;
	             DFGetPropVT("IE") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))



		*----------------------------------------------------*
		* SERIE UNICA => "0"
		*----------------------------------------------------*
	

		=W_DEFPROC("DOCFISCA.SPR")
		LSLinhaXML = DFGetPropVT("SERIE_DOC")
		IF "U" $ LSLinhaXML
			LSLinhaXML = "0"
		ENDIF
		LSLinhaXML = 'DFIS_SERIE="'+;
	             LSLinhaXML +;
	             '"'
		=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		*----------------------------------------------------*

		LSLinhaXML = 'ITDF_NRO_ITEM="'+;
	             STR(DIGetPropVT("NRO_ITEM"),5) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		*-------------------------------------------------------*

		LSLinhaXML = 'ITDF_PROD_CODIGO="'+;
	             DIGetPropVT("PRODCODIGO") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_PROD_DESCRICAO="'+;
	             DIGetPropVT("PRODDESCR") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_PROD_DESCR_COMPL="'+;
	             DIGetPropVT("PRODCOMPLE") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))



		LSLinhaXML = 'ITDF_PROD_INFO_ADICIONAIS="'+;
	             DIGetPropVT("INFO_COMPL") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		LSLinhaXML = 'ITDF_UNIDADE="'+;
	             DIGetPropVT("UNIDADE") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))



		LSLinhaXML = 'ITDF_PRECO_TABELA="'+;
	             STR(DIGetPropVT("PRECO_TAB"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		LSLinhaXML = 'ITDF_PRECO_MAX_TABELADO="'+;
	             STR(DIGetPropVT("PRECOMAXTB"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		LSLinhaXML = 'ITDF_PRECO_MIN_TABELADO="'+;
	             STR(DIGetPropVT("PRECOMINTB"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

	

		LSLinhaXML = 'ITDF_QTDE="'+;
	             STR(DIGetPropVT("QTDE"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_DESCONTO="'+;
	             STR(DIGetPropVT("VLR_DESCTO"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))



		LSLinhaXML = 'ITDF_VLR_DESP_FINANCEIRA="'+;
	             STR(DIGetPropVT("VLRDESPFIN"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_OUTRAS_DESP_ACES="'+;
	             STR(DIGetPropVT("VLRDESPOUT"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_FRETE="'+;
	             STR(DIGetPropVT("VLR_FRETE"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_SEGURO="'+;
	             STR(DIGetPropVT("VLR_SEGURO"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_FINAL="'+;
	             STR(DIGetPropVT("VLR_FINAL"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		LSLinhaXML = 'ITDF_MENSAGEM="'+;
	             SPACE(5) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		LSLinhaXML = 'ITDF_IND_MOVIMENTO_ESTQ="'+;
	             DIGetPropVT("IND_MOVEST") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_LOTE_QTDE_ITENS="'+;
	             STR(DIGetPropVT("LT_QTITENS"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	
		LSLinhaXML = 'ITDF_LOTE_NRO="'+;
	             DIGetPropVT("LT_NRO") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_LOTE_FABRICACAO="'+;
	             DTOC(DIGetPropVT("LT_DT_FABR")) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_LOTE_VALIDADE="'+;
	             DTOC(DIGetPropVT("LT_VALIDAD")) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_CUSTO_MEDIO_ATUAL="'+;
	             STR(DIGetPropVT("CUSTOMEDAT"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	
		LSLinhaXML = 'ITDF_SALDO_ANTERIOR="'+;
	             STR(DIGetPropVT("SALDO_ANT"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_CUSTO_MEDIO_ANT="'+;
	             STR(DIGetPropVT("CUSTOMEDAN"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_CUSTO_NA_OPERACAO="'+;
	             STR(DIGetPropVT("CUSTONAOPE"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_A_TRIBUTAR="'+;
	             STR(DIGetPropVT("VLRATRIBUT"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_SALDO_ATUAL="'+;
	             STR(DIGetPropVT("SALDO_ATU"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_CUSTO_CONTABIL="'+;
	             STR(DIGetPropVT("CUSTOCONTB"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_CFOP="'+;
	             DIGetPropVT("CFOP") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))



		LSLinhaXML = 'ITDF_CST_ICMS="'+;
	             DIGetPropVT("CST_ICMS") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_CST_IPI="'+;
	             DIGetPropVT("CST_IPI") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_CST_ISS="'+;
	             DIGetPropVT("CST_ISS") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_CST_PIS="'+;
	             DIGetPropVT("CST_PIS") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_CST_COFINS="'+;
	             DIGetPropVT("CST_COFINS") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_CST_IR="'+;
	             DIGetPropVT("CST_IR") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_BC_BRUTA_ICMS="'+;
	             STR(DIGetPropVT("BCBRUTAICM"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_IND_REDUCAO="'+;
	             STR(DIGetPropVT("IND_REDUCA"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_BC_ICMS="'+;
	             STR(DIGetPropVT("BC_ICMS"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_ALIQ_ICMS_ORIGEM="'+;
	             STR(DIGetPropVT("ALQICMORIG"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_ALIQ_ICMS_DESTINO="'+;
	             STR(DIGetPropVT("ALQICMDEST"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_DIF_ALIQUOTA="'+;
	             STR(DIGetPropVT("DIF_ALIQ"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_ALIQ_ICMS="'+;
	             STR(DIGetPropVT("ALIQ_ICMS"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_ICMS="'+;
	             STR(DIGetPropVT("VLR_ICMS"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_REG_FISCAL_TRIB_ORIGEM="'+;
	             DIGetPropVT("RGTRIBORIG") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_REG_FISCAL_TRIB_DESTINO="'+;
	             DIGetPropVT("RGTRIBDEST") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_BC_ISENTA_ICMS="'+;
	             STR(DIGetPropVT("BASE_ISENT"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_BC_OUTR_ICMS="'+;
	             STR(DIGetPropVT("BASE_OUTR"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_BC_BRUTA_ICMS_RTD="'+;
	             STR(DIGetPropVT("BCBRTRTD_S"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_IVA="'+;
	             STR(DIGetPropVT("IVA"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_BC_ICMS_RTD="'+;
	             STR(DIGetPropVT("BC_RTD_S"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		LSLinhaXML = 'ITDF_ALIQ_ICMS_RTD="'+;
	             STR(DIGetPropVT("ALQICMRTDS"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_ICMS_RTD="'+;
	             STR(DIGetPropVT("ICM_RTD_S"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		LSLinhaXML = 'ITDF_VLR_BC_BRUTA_RTD_ENTRADA="'+;
	             STR(DIGetPropVT("BCBRTRTD_E"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		LSLinhaXML = 'ITDF_VLR_BC_RTD_ENTRADA="'+;
	             STR(DIGetPropVT("BC_RTD_E"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		LSLinhaXML = 'ITDF_VLR_ICMS_RTD_ENTRADA="'+;
	             STR(DIGetPropVT("ICM_RTD_E"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_IND_APURACAO_IPI="'+;
	             DIGetPropVT("INDAPURIPI") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_BC_IPI="'+;
	             STR(DIGetPropVT("BC_IPI"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_ALIQ_IPI="'+;
	             STR(DIGetPropVT("ALIQ_IPI"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_IPI="'+;
	             STR(DIGetPropVT("VLR_IPI"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_BC_ISS="'+;
	             STR(DIGetPropVT("BC_ISS"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_ALIQ_ISS="'+;
	             STR(DIGetPropVT("ALIQ_ISS"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_ISS="'+;
	             STR(DIGetPropVT("VLR_ISS"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_BC_ISS_RTD="'+;
	             STR(DIGetPropVT("BC_ISS_RTD"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_ALIQ_ISS_RTD="'+;
	             STR(DIGetPropVT("ALIQ_ISSRT"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_ISS_RTD="'+;
	             STR(DIGetPropVT("VLR_ISSRTD"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_BC_PIS="'+;
	             STR(DIGetPropVT("BC_PIS"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_ALIQ_PIS="'+;
	             STR(DIGetPropVT("ALIQ_PIS"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_QTDE_BC_PIS="'+;
	             STR(DIGetPropVT("QTDBASEPIS"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_PIS="'+;
	             STR(DIGetPropVT("VLR_PIS"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_PIS_RTD="'+;
	             STR(DIGetPropVT("PIS_RTD"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_BC_COFINS="'+;
	             STR(DIGetPropVT("BC_COFINS"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_ALIQ_COFINS="'+;
	             STR(DIGetPropVT("ALIQCOFINS"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_QTDE_BC_COFINS="'+;
	             STR(DIGetPropVT("QTDBASECOF"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_COFINS="'+;
	             STR(DIGetPropVT("VLR_COFINS"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_COFINS_RTD="'+;
	             STR(DIGetPropVT("COFINS_RTD"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_BC_IR="'+;
	             STR(DIGetPropVT("BC_IR"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_ALIQ_IR="'+;
	             STR(DIGetPropVT("ALIQ_IR"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_IR="'+;
	             STR(DIGetPropVT("VLR_IR"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_IR_RTD="'+;
	             STR(DIGetPropVT("IR_RTD"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_BC_CSLL="'+;
	             STR(DIGetPropVT("BC_CSLL"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_ALIQ_CSLL="'+;
	             STR(DIGetPropVT("ALIQ_CSLL"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_CSLL="'+;
	             STR(DIGetPropVT("VLR_CSLL"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_ADIANTAMENTO_CSLL="'+;
	             STR(DIGetPropVT("ADNTA_CSLL"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_LANC_AUTOMATICO="'+;
	             DIGetPropVT("LANC_AUTO") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_CLAS_CONS_SERV_TELECOM="'+;
	             DIGetPropVT("CLSCOMNC") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_CLAS_CONS_GAS="'+;
	             DIGetPropVT("CLSGAS") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_CLAS_CONS_AGUA="'+;
	             DIGetPropVT("CLSAGUA") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_CLAS_CONS_ENERGIA_ELETR="'+;
	             DIGetPropVT("CLSENRG") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_ALIQ_ICMS_SO="'+;
	             STR(DIGetPropVT("ALIQICMSSO"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_IND_MOD_BC_ICMS="'+;
	             DIGetPropVT("MOD_BCICMS") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_PERCENTUAL_ACRESCIMO="'+;
	             STR(DIGetPropVT("PRC_ACRESC"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_PERCENTUAL_DESCONTO="'+;
	             STR(DIGetPropVT("PRC_DESCON"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_PRECO_VENDA_UNITARIO="'+;
	             STR(DIGetPropVT("PRECOVENDA"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		LSLinhaXML = 'ITDF_VLR_ABATE_NT="'+;
	             STR(DIGetPropVT("VLRABATENT"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_ACRESCIMO="'+;
	             STR(DIGetPropVT("VLRACRESC"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_BC_BRUTA_ICMS_SO="'+;
	             STR(DIGetPropVT("BCBRICMSSO"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_BC_ICMS_SO="'+;
	             STR(DIGetPropVT("BCICMSSO"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_BC_ISENTA_IPI="'+;
	             STR(DIGetPropVT("BCISENTIPI"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		LSLinhaXML = 'ITDF_VLR_COFINS_IMPORTACAO="'+;
	             STR(DIGetPropVT("VLRCOFIMPO"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_DESPESAS="'+;
	             STR(DIGetPropVT("VLR_DESPES"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		LSLinhaXML = 'ITDF_VLR_ICMS_SO="'+;
	             STR(DIGetPropVT("VLR_ICMSSO"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_PIS_IMPORTACAO="'+;
	             STR(DIGetPropVT("VLRPISIMPO"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_PRODUTOS="'+;
	             STR(DIGetPropVT("VLRPRODUTO"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_SERVICO_NT="'+;
	             STR(DIGetPropVT("VLRSRVC_NT"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_SERVICOS="'+;
	             STR(DIGetPropVT("VLRSERVICO"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_TRIBUTOS="'+;
	             STR(DIGetPropVT("VLRTRIBUTO"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_ORIGEM_MERCADORIA="'+;
	             DIGetPropVT("ORIGEMMRCD") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_O_ITEM_E_SERVICO="'+;
	             DIGetPropVT("ITEMSERVIC") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_PRODUTOS_SERVICOS="'+;
	             STR(DIGetPropVT("TTPRODSRVC"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_GTIM="'+;
	             DIGetPropVT("GTIMCODIGO") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_NCM="'+;
	             DIGetPropVT("NCMCODIGO") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_EX_TIPI="'+;
	             DIGetPropVT("EXTIPI") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		LSLinhaXML = 'ITDF_GENERO="'+;
	             DIGetPropVT("GENEROPROD") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_GTIM_UNIDADE_TRIBUTAVEL="'+;
	             DIGetPropVT("GTIMUNTRIB") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_UNIDADE_TRIBUTAVEL="'+;
	             DIGetPropVT("UNIDTRIBUT") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_UNIDADE_TRIBUTAVEL="'+;
	             STR(DIGetPropVT("VLRUNTRIBU"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_QTDE_UNIDADE_TRIBUTAVEL="'+;
	             STR(DIGetPropVT("QTDTRIBUT"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_CLS_CODIGO_LISTA_SERVICO="'+;
	             DIGetPropVT("CDGLSTSRVC") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_IND_MOD_BC_ICMS_RTD="'+;
	             DIGetPropVT("MODBCICMRT") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_QTDE_BC_COFINS_RTD="'+;
	             STR(DIGetPropVT("QTDBCCOFRT"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		LSLinhaXML = 'ITDF_VLR_ALIQ_COFINS_RTD="'+;
	             STR(DIGetPropVT("VLRALQCFRT"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		LSLinhaXML = 'ITDF_IND_MED_BC_ICMS_RTD="'+;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))






		=W_DEFPROC("DOCFISCA.SPR")
		LSLinhaXML = 'DFIS_CNPJ="'+;
	             DFGetPropVT("CNPJ") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		*-------------------------------------------------------*
		LSLinhaXML = '/>'
					=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


	
		SET POINT TO
		SET SEPARATOR to

RETURN(.t.)


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2WC0P61CL           DIGravaXMLItensDocFiscal VALID     
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         DOCFISIT,     Record Number:   50  
*        Variable:            DIGravaXMLItensDocFiscal           
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      39                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2wc0p61cl     &&  DIGravaXMLItensDocFiscal VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION DIGravaXMLItensDocFiscal
PARAMETERS  PrmEmp,;
			PrmMod_doc,;
			PrmCod_IDForn,;
			PrmNro_Doc,;
			PrmSerie_Doc,;
			PrmNro_Item,;
			PrmFileXML,;
			PrmNroIDfileXML

	*---------------------------------------------------*
	PRIVATE LFRETORNO
	LFRETORNO = DIV01GravaXMLItensDocFiscal( ;
			PrmEmp,;
			PrmMod_doc,;
			PrmCod_IDForn,;
			PrmNro_Doc,;
			PrmSerie_Doc,;
			PrmNro_Item,;
			PrmFileXML,;
			PrmNroIDfileXML)
			


RETURN(LFRETORNO)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2WC0P61CM           DIERV01GravaXMLItensDocFiscal VALID
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         DOCFISIT,     Record Number:   51  
*        Variable:            DIERV01GravaXMLItensDocFiscal      
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      40                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2wc0p61cm     &&  DIERV01GravaXMLItensDocFiscal VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION DIERV01GravaXMLItensDocFiscal
PARAMETERS  PrmEmp,;
			PrmMod_doc,;
			PrmCod_IDForn,;
			PrmNro_Doc,;
			PrmSerie_Doc,;
			PrmNro_Item,;
			PrmFileXML,;
			PrmNroIDfileXML

	*---------------------------------------------------*

	IF !DILerRegistro(PrmEmp,;
			PrmMod_doc,;
			PrmCod_IDForn,;
			PrmNro_Doc,;
			PrmSerie_Doc,;
			PrmNro_Item)
	      wait "Nao foi localizado Item DOC.FISCL :"+;
		      "FILIAL: "+STR(PrmEMPRESA,3)+;
		      "MODELO: "+MOD_DOC+;
		      "FORN. : "+PrmCOD_IDFORN+;
		      "NRO.  : "+STR(PrmNRO_DOC,7)+;
		      "SERIE : "+PrmSERIE_DOC+;
		      "ITEM  : "+STR(PrmNro_Item,4)
    	  return(.F.)
	ENDIF


	IF DIGetPropVT("QTDE") = 0
    	  return(.t.)
	ENDIF		


	=W_DEFPROC("DOCFISCA.SPR")
	IF !DFLerRegistro(PrmEmp,;
			PrmMod_doc,;
			PrmCod_IDForn,;
			PrmNro_Doc,;
			PrmSerie_Doc)
	      wait "Nao foi localizado Capa DOC.FISCL :"+;
		      "FILIAL: "+STR(PrmEMPRESA,3)+;
		      "MODELO: "+MOD_DOC+;
		      "FORN. : "+PrmCOD_IDFORN+;
		      "NRO.  : "+STR(PrmNRO_DOC,7)+;
		      "SERIE : "+PrmSERIE_DOC
    	  return(.F.)
	ENDIF
	

	*-------------------------------------------------------*

   	PRIVATE lErro
   	PRIVATE LSLinhaXML

	SET POINT TO ","
	SET SEPARATOR  TO "."


	*-------------------------------------------------------*


		=W_DEFPROC("EMPRESA.SPR")
		=EMLerRegistro(PrmEmp)

		=W_DEFPROC("EMPRESA.SPR")
		LFieldTmp    =  EMGetPropVT("CGC")
	    UNEM_CNPJ    =  STR(LFieldTmp,14)
		UNEM_CNPJ    =  chrtran(UNEM_CNPJ, " ","0")


		LSLinhaXML = '<ROW UNEM_CNPJ="'+UNEM_CNPJ+'"'
					=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	


		*==========================================================*
		*  CAMPOS IDENTIFICADORES
		*==========================================================*
	

		=W_DEFPROC("EMPRESA.SPR")
		LFieldTmp    =  EMGetPropVT("EMITE_NFE")

		IF LFieldTmp $ "H"   && H=HOMOLOGACAO

			=W_DEFPROC("DOCFISCA.SPR")
			LSLinhaXML = 'DFIS_MOD_DOCUMENTO="'+;
	    	         "55" +;
	        	     '"'
					=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		ELSE
			=W_DEFPROC("DOCFISCA.SPR")
			LSLinhaXML = 'DFIS_MOD_DOCUMENTO="'+;
	    	         DFGetPropVT("MOD_DOC") +;
	        	     '"'
					=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
		ENDIF

		*----------------------------------------------------------------*







		*----------------------------------------------------------------*




		=W_DEFPROC("DOCFISCA.SPR")
		LSLinhaXML = 'DFIS_IND_OPERACAO="'+;
	             DFGetPropVT("IND_OPER") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		=W_DEFPROC("DOCFISCA.SPR")
		LSLinhaXML = 'DFIS_TP_MOVIMENTO="'+;
	             DFGetPropVT("TP_MOV") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))



		*----------------------------------------------------------*
		=W_DEFPROC("DOCFISCA.SPR")
		LNNro_Doc  = DFGetPropVT("NRO_DOC")
		IF LNNro_Doc > 3000000
			LNNro_Doc = LNNro_Doc - 3000000
		ENDIF

		LSLinhaXML = ULtratalinha('DFIS_NRO_DOCUMENTO="'+;
	             STR(LNNro_Doc,7) +;
	             '"')
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		*----------------------------------------------------*
		* SERIE UNICA => "0"
		*----------------------------------------------------*
	

		=W_DEFPROC("DOCFISCA.SPR")
		LSLinhaXML = DFGetPropVT("SERIE_DOC")
		IF "U" $ LSLinhaXML
			LSLinhaXML = "0"
		ENDIF
		LSLinhaXML = 'DFIS_SERIE="'+;
	             LSLinhaXML +;
	             '"'
		=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		*----------------------------------------------------------*









		*----------------------------------------------------------*

		*----------------------------------------------------------*

        LSLinhaXML = DFGetPropVT("CPF")
        IF EMPTY(LSLinhaXML)
	        LSLinhaXML = DFGetPropVT("CNPJ")
		ENDIF
		

		=W_DEFPROC("DOCFISCA.SPR")
		LSLinhaXML = 'DFIS_CPFCNPJ="'+;
	             LSLinhaXML +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		=W_DEFPROC("DOCFISCA.SPR")
		LSLinhaXML = 'DFIS_IE="'+;
	             DFGetPropVT("IE") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))



		*----------------------------------------------------*

		LSLinhaXML = 'ITDF_NRO_ITEM="'+;
	             STR(DIGetPropVT("NRO_ITEM"),5) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		*-------------------------------------------------------*

		LSLinhaXML = 'ITDF_PROD_CODIGO="'+;
	             DIGetPropVT("PRODCODIGO") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_PROD_DESCRICAO="'+;
	             DIGetPropVT("PRODDESCR") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_PROD_DESCR_COMPL="'+;
	             DIGetPropVT("PRODCOMPLE") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))





		LSLinhaXML = 'ITDF_UNIDADE="'+;
	             DIGetPropVT("UNIDADE") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))



		LSLinhaXML = 'ITDF_PRECO_TABELA="'+;
	             STR(DIGetPropVT("PRECO_TAB"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		LSLinhaXML = 'ITDF_PRECO_MAX_TABELADO="'+;
	             STR(DIGetPropVT("PRECOMAXTB"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		LSLinhaXML = 'ITDF_PRECO_MIN_TABELADO="'+;
	             STR(DIGetPropVT("PRECOMINTB"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

	

		LSLinhaXML = 'ITDF_QTDE="'+;
	             STR(DIGetPropVT("QTDE"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_DESCONTO="'+;
	             STR(DIGetPropVT("VLR_DESCTO"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))







		LSLinhaXML = 'ITDF_VLR_DESP_FINANCEIRA="'+;
	             STR(DIGetPropVT("VLRDESPFIN"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_OUTRAS_DESP_ACES="'+;
	             STR(DIGetPropVT("VLRDESPOUT"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_FRETE="'+;
	             STR(DIGetPropVT("VLR_FRETE"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_SEGURO="'+;
	             STR(DIGetPropVT("VLR_SEGURO"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_FINAL="'+;
	             STR(DIGetPropVT("VLR_FINAL"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		LSLinhaXML = 'ITDF_MENSAGEM="'+;
	             SPACE(5) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		LSLinhaXML = 'ITDF_IND_MOVIMENTO_ESTQ="'+;
	             DIGetPropVT("IND_MOVEST") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_LOTE_QTDE_ITENS="'+;
	             STR(DIGetPropVT("LT_QTITENS"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	
		LSLinhaXML = 'ITDF_LOTE_NRO="'+;
	             DIGetPropVT("LT_NRO") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_LOTE_FABRICACAO="'+;
	             DTOC(DIGetPropVT("LT_DT_FABR")) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_LOTE_VALIDADE="'+;
	             DTOC(DIGetPropVT("LT_VALIDAD")) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_CUSTO_MEDIO_ATUAL="'+;
	             STR(DIGetPropVT("CUSTOMEDAT"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	
		LSLinhaXML = 'ITDF_SALDO_ANTERIOR="'+;
	             STR(DIGetPropVT("SALDO_ANT"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_CUSTO_MEDIO_ANT="'+;
	             STR(DIGetPropVT("CUSTOMEDAN"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_CUSTO_NA_OPERACAO="'+;
	             STR(DIGetPropVT("CUSTONAOPE"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_A_TRIBUTAR="'+;
	             STR(DIGetPropVT("VLRATRIBUT"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_SALDO_ATUAL="'+;
	             STR(DIGetPropVT("SALDO_ATU"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_CUSTO_CONTABIL="'+;
	             STR(DIGetPropVT("CUSTOCONTB"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_CFOP="'+;
	             DIGetPropVT("CFOP") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))



		LSLinhaXML = 'ITDF_CST_ICMS="'+;
	             DIGetPropVT("CST_ICMS") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_CST_IPI="'+;
	             DIGetPropVT("CST_IPI") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_CST_ISS="'+;
	             DIGetPropVT("CST_ISS") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_CST_PIS="'+;
	             DIGetPropVT("CST_PIS") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_CST_COFINS="'+;
	             DIGetPropVT("CST_COFINS") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_CST_IR="'+;
	             DIGetPropVT("CST_IR") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_BC_BRUTA_ICMS="'+;
	             STR(DIGetPropVT("BCBRUTAICM"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_IND_REDUCAO="'+;
	             STR(DIGetPropVT("IND_REDUCA"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_BC_ICMS="'+;
	             STR(DIGetPropVT("BC_ICMS"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_ALIQ_ICMS_ORIGEM="'+;
	             STR(DIGetPropVT("ALQICMORIG"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_ALIQ_ICMS_DESTINO="'+;
	             STR(DIGetPropVT("ALQICMDEST"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_DIF_ALIQUOTA="'+;
	             STR(DIGetPropVT("DIF_ALIQ"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_ALIQ_ICMS="'+;
	             STR(DIGetPropVT("ALIQ_ICMS"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_ICMS="'+;
	             STR(DIGetPropVT("VLR_ICMS"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_REG_FISCAL_TRIB_ORIGEM="'+;
	             DIGetPropVT("RGTRIBORIG") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_REG_FISCAL_TRIB_DESTINO="'+;
	             DIGetPropVT("RGTRIBDEST") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_BC_ISENTA_ICMS="'+;
	             STR(DIGetPropVT("BASE_ISENT"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_BC_OUTR_ICMS="'+;
	             STR(DIGetPropVT("BASE_OUTR"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_BC_BRUTA_ICMS_RTD="'+;
	             STR(DIGetPropVT("BCBRTRTD_S"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_IVA="'+;
	             STR(DIGetPropVT("IVA"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_BC_ICMS_RTD="'+;
	             STR(DIGetPropVT("BC_RTD_S"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		LSLinhaXML = 'ITDF_ALIQ_ICMS_RTD="'+;
	             STR(DIGetPropVT("ALQICMRTDS"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_ICMS_RTD="'+;
	             STR(DIGetPropVT("ICM_RTD_S"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		LSLinhaXML = 'ITDF_VLR_BC_BRUTA_RTD_ENTRADA="'+;
	             STR(DIGetPropVT("BCBRTRTD_E"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		LSLinhaXML = 'ITDF_VLR_BC_RTD_ENTRADA="'+;
	             STR(DIGetPropVT("BC_RTD_E"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		LSLinhaXML = 'ITDF_VLR_ICMS_RTD_ENTRADA="'+;
	             STR(DIGetPropVT("ICM_RTD_E"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_IND_APURACAO_IPI="'+;
	             DIGetPropVT("INDAPURIPI") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_BC_IPI="'+;
	             STR(DIGetPropVT("BC_IPI"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_ALIQ_IPI="'+;
	             STR(DIGetPropVT("ALIQ_IPI"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_IPI="'+;
	             STR(DIGetPropVT("VLR_IPI"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_BC_ISS="'+;
	             STR(DIGetPropVT("BC_ISS"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_ALIQ_ISS="'+;
	             STR(DIGetPropVT("ALIQ_ISS"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_ISS="'+;
	             STR(DIGetPropVT("VLR_ISS"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_BC_ISS_RTD="'+;
	             STR(DIGetPropVT("BC_ISS_RTD"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_ALIQ_ISS_RTD="'+;
	             STR(DIGetPropVT("ALIQ_ISSRT"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_ISS_RTD="'+;
	             STR(DIGetPropVT("VLR_ISSRTD"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_BC_PIS="'+;
	             STR(DIGetPropVT("BC_PIS"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_ALIQ_PIS="'+;
	             STR(DIGetPropVT("ALIQ_PIS"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_QTDE_BC_PIS="'+;
	             STR(DIGetPropVT("QTDBASEPIS"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_PIS="'+;
	             STR(DIGetPropVT("VLR_PIS"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_PIS_RTD="'+;
	             STR(DIGetPropVT("PIS_RTD"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_BC_COFINS="'+;
	             STR(DIGetPropVT("BC_COFINS"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_ALIQ_COFINS="'+;
	             STR(DIGetPropVT("ALIQCOFINS"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_QTDE_BC_COFINS="'+;
	             STR(DIGetPropVT("QTDBASECOF"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_COFINS="'+;
	             STR(DIGetPropVT("VLR_COFINS"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_COFINS_RTD="'+;
	             STR(DIGetPropVT("COFINS_RTD"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_BC_IR="'+;
	             STR(DIGetPropVT("BC_IR"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_ALIQ_IR="'+;
	             STR(DIGetPropVT("ALIQ_IR"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_IR="'+;
	             STR(DIGetPropVT("VLR_IR"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_IR_RTD="'+;
	             STR(DIGetPropVT("IR_RTD"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_BC_CSLL="'+;
	             STR(DIGetPropVT("BC_CSLL"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_ALIQ_CSLL="'+;
	             STR(DIGetPropVT("ALIQ_CSLL"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_CSLL="'+;
	             STR(DIGetPropVT("VLR_CSLL"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_ADIANTAMENTO_CSLL="'+;
	             STR(DIGetPropVT("ADNTA_CSLL"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_LANC_AUTOMATICO="'+;
	             DIGetPropVT("LANC_AUTO") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_CLAS_CONS_SERV_TELECOM="'+;
	             DIGetPropVT("CLSCOMNC") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_CLAS_CONS_GAS="'+;
	             DIGetPropVT("CLSGAS") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_CLAS_CONS_AGUA="'+;
	             DIGetPropVT("CLSAGUA") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_CLAS_CONS_ENERGIA_ELETR="'+;
	             DIGetPropVT("CLSENRG") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_ALIQ_ICMS_SO="'+;
	             STR(DIGetPropVT("ALIQICMSSO"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_IND_MOD_BC_ICMS="'+;
	             DIGetPropVT("MOD_BCICMS") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_PERCENTUAL_ACRESCIMO="'+;
	             STR(DIGetPropVT("PRC_ACRESC"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_PERCENTUAL_DESCONTO="'+;
	             STR(DIGetPropVT("PRC_DESCON"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_VENDA_UNITARIO="'+;
	             STR(DIGetPropVT("PRECOVENDA"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		LSLinhaXML = 'ITDF_VLR_ABATE_NT="'+;
	             STR(DIGetPropVT("VLRABATENT"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_ACRESCIMO="'+;
	             STR(DIGetPropVT("VLRACRESC"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_BC_BRUTA_ICMS_SO="'+;
	             STR(DIGetPropVT("BCBRICMSSO"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_BC_ICMS_SO="'+;
	             STR(DIGetPropVT("BCICMSSO"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_BC_ISENTA_IPI="'+;
	             STR(DIGetPropVT("BCISENTIPI"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		LSLinhaXML = 'ITDF_VLR_COFINS_IMPORTACAO="'+;
	             STR(DIGetPropVT("VLRCOFIMPO"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_DESPESAS="'+;
	             STR(DIGetPropVT("VLR_DESPES"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		LSLinhaXML = 'ITDF_VLR_ICMS_SO="'+;
	             STR(DIGetPropVT("VLR_ICMSSO"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_PIS_IMPORTACAO="'+;
	             STR(DIGetPropVT("VLRPISIMPO"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_PRODUTOS="'+;
	             STR(DIGetPropVT("VLRPRODUTO"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_SERVICO_NT="'+;
	             STR(DIGetPropVT("VLRSRVC_NT"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_SERVICOS="'+;
	             STR(DIGetPropVT("VLRSERVICO"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_TRIBUTOS="'+;
	             STR(DIGetPropVT("VLRTRIBUTO"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_ORIGEM_MERCADORIA="'+;
	             DIGetPropVT("ORIGEMMRCD") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_O_ITEM_E_SERVICO="'+;
	             DIGetPropVT("ITEMSERVIC") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_PRODUTOS_SERVICOS="'+;
	             STR(DIGetPropVT("TTPRODSRVC"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_GTIM="'+;
	             DIGetPropVT("GTIMCODIGO") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_NCM="'+;
	             DIGetPropVT("NCMCODIGO") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_EX_TIPI="'+;
	             DIGetPropVT("EXTIPI") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		LSLinhaXML = 'ITDF_GENERO="'+;
	             DIGetPropVT("GENEROPROD") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_GTIM_UNIDADE_TRIBUTAVEL="'+;
	             DIGetPropVT("GTIMUNTRIB") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_UNIDADE_TRIBUTAVEL="'+;
	             DIGetPropVT("UNIDTRIBUT") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_VLR_UNIDADE_TRIBUTAVEL="'+;
	             STR(DIGetPropVT("VLRUNTRIBU"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_QTDE_UNIDADE_TRIBUTAVEL="'+;
	             STR(DIGetPropVT("QTDTRIBUT"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_CLS_CODIGO_LISTA_SERVICO="'+;
	             DIGetPropVT("CDGLSTSRVC") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_IND_MOD_BC_ICMS_RTD="'+;
	             DIGetPropVT("MODBCICMRT") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_QTDE_BC_COFINS_RTD="'+;
	             STR(DIGetPropVT("QTDBCCOFRT"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		LSLinhaXML = 'ITDF_VLR_ALIQ_COFINS_RTD="'+;
	             STR(DIGetPropVT("VLRALQCFRT"),15,4) +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


		LSLinhaXML = 'ITDF_IND_MED_BC_ICMS_RTD="'+;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))






		=W_DEFPROC("DOCFISCA.SPR")
		LSLinhaXML = 'DFIS_CNPJ="'+;
	             DFGetPropVT("CNPJ") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		*-------------------------------------------------------*
		LSLinhaXML = '/>'
					=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


	
		SET POINT TO
		SET SEPARATOR to

RETURN(.t.)

PROCEDURE V01SOBRA

		=W_DEFPROC("DOCFISCA.SPR")
		LSLinhaXML = 'DFIS_CLFS_SIGLA="'+;
	             DFGetPropVT("TIPO") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

		LSLinhaXML = 'ITDF_PROD_INFO_ADICIONAIS="'+;
	             DIGetPropVT("INFO_COMPL") +;
	             '"'
				=DF_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


RETURN