*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        05/04/15             EMPRESA.SPR               10:17:22 
*                                                                
*       픔컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        Author's Name                                           
*                                                                
*        Copyright (c) 2015 Company Name                         
*        Address                                                 
*        City,     Zip                                           
*                                                                
*        Description:                                            
*        This program was automatically generated by GENSCRN.    
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴


#REGION 0
REGIONAL m.currarea, m.talkstat, m.compstat

IF SET("TALK") = "ON"
	SET TALK OFF
	m.talkstat = "ON"
ELSE
	m.talkstat = "OFF"
ENDIF
m.compstat = SET("COMPATIBLE")
SET COMPATIBLE FOXPLUS

*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                       MS-DOS Window definitions                
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                     EMPRESA/MS-DOS Screen Layout               
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 1
@ 21,2 GET EMGet_UF ;
	PICTURE "@*HN EMGet_UF - Obter UF da Loja" ;
	SIZE 1,29,1 ;
	DEFAULT 1 ;
	VALID _4cd0m1xv4()
@ 23,2 GET EMGet_Juro ;
	PICTURE "@*HN EMGet_Juro - Obter Juro Mes da Loja" ;
	SIZE 1,37,1 ;
	DEFAULT 1 ;
	VALID _4cd0m1xvf()
@ 29,2 GET verif ;
	PICTURE "@*HN Verificar Codigo de Empresa" ;
	SIZE 1,29,1 ;
	DEFAULT 1 ;
	VALID _4cd0m1xvn()
@ 30,2 GET EMrodanroNF ;
	PICTURE "@*HN EMrodanroNF - Roda Numeracao de Nota " ;
	SIZE 1,39,1 ;
	DEFAULT 1 ;
	VALID _4cd0m1xxe()
@ 24,2 GET EMGet_Mora ;
	PICTURE "@*HN EMGet_Mora - Obter Mora diaria" ;
	SIZE 1,32,1 ;
	DEFAULT 1 ;
	VALID _4cd0m1xxm()
@ 25,2 GET EMGet_Sigla ;
	PICTURE "@*HN EMGet_Sigla - Obter Sigla da empresa" ;
	SIZE 1,39,1 ;
	DEFAULT 1 ;
	VALID _4cd0m1xxn()
@ 26,2 GET EMGet_ECFSerie ;
	PICTURE "@*HN EMGet_ECFSerie - Obter Nro Serie Ecf" ;
	SIZE 1,38,1 ;
	DEFAULT 1 ;
	VALID _4cd0m1xxo()
@ 22,2 GET EMGet_Municipio ;
	PICTURE "@*HN EMGet_Municipio - Obter UF da Loja" ;
	SIZE 1,36,1 ;
	DEFAULT 1 ;
	VALID _4cd0m1xxp()
@ 28,2 GET EMGet_TabCst ;
	PICTURE "@*HN EMGet_TabCst - Obter Tab_CST" ;
	SIZE 1,30,1 ;
	DEFAULT 1 ;
	VALID _4cd0m1xxq()
@ 17,2 GET EMLerRegistro ;
	PICTURE "@*HN EMLerRegistro - Le Registro e Carrega OBJ" ;
	SIZE 1,43,1 ;
	DEFAULT 1 ;
	VALID _4cd0m1xxr()
@ 18,2 GET EMSalvarRegistro ;
	PICTURE "@*HN EMSalvarRegistro - Salva Registro" ;
	SIZE 1,35,1 ;
	DEFAULT 1 ;
	VALID _4cd0m1xxs()
@ 16,2 GET EMExiste ;
	PICTURE "@*HN EMExiste - Le Registro nao carrega o OBJ e Retorna se existe" ;
	SIZE 1,62,1 ;
	DEFAULT 1 ;
	VALID _4cd0m1xyt()
@ 2,7 GET EMVerifyInst ;
	PICTURE "@*HN EMVerifyInst - Verifica Instancia" ;
	SIZE 1,35,1 ;
	DEFAULT 1 ;
	VALID _4cd0m1xz0()
@ 3,10 GET EMCreate ;
	PICTURE "@*HN EMCreate - Instancia" ;
	SIZE 1,22,1 ;
	DEFAULT 1 ;
	VALID _4cd0m1xz6()
@ 11,10 GET EMDestroi ;
	PICTURE "@*HN EMDestroi - Desinstancia" ;
	SIZE 1,26,1 ;
	DEFAULT 1 ;
	VALID _4cd0m1xz7()
@ 5,13 GET EMReadProp ;
	PICTURE "@*HN EMReadProp - Carga do Vetor com Base na Tabela" ;
	SIZE 1,48,1 ;
	DEFAULT 1 ;
	VALID _4cd0m1xz8()
@ 8,15 GET EMSetDerivadas ;
	PICTURE "@*HN EMSetDerivadas - Carga de Propriedades Derivadas" ;
	SIZE 1,51,1 ;
	DEFAULT 1 ;
	VALID _4cd0m1xz9()
@ 6,15 GET EMSetPropVT ;
	PICTURE "@*HN EMSetPropVT - Set o Valor de uma Propriedade do Vetor" ;
	SIZE 1,55,1 ;
	DEFAULT 1 ;
	VALID _4cd0m1xza()
@ 7,15 GET EMGetPropVT ;
	PICTURE "@*HN EMGetPropVT - Get o Valor de uma Propriedade do Vetor" ;
	SIZE 1,55,1 ;
	DEFAULT 1 ;
	VALID _4cd0m1xzb()
@ 1,2 GET EMChk_Identidade ;
	PICTURE "@*HN EMChk_Identidade - Checagem de Identidade do Objeto" ;
	SIZE 1,53,1 ;
	DEFAULT 1 ;
	VALID _4cd0m1xzc()
@ 0,2 GET EMFind ;
	PICTURE "@*HN EMFind - Localiza Registro Com Base nas Propriedades" ;
	SIZE 1,54,1 ;
	DEFAULT 1 ;
	VALID _4cd0m1y0d()
@ 13,2 GET EMGetFieldValue ;
	PICTURE "@*HN EMGetFieldValue -Rtrn vlr Campo p/ reg.existente-(erro se chave n existir)" ;
	SIZE 1,76,1 ;
	DEFAULT 1 ;
	VALID _4cd0m1y0k()
@ 12,2 GET EM_Refresh ;
	PICTURE "@*HN EM_Refresh - Forca Atualiza놹o Objeto" ;
	SIZE 1,39,1 ;
	DEFAULT 1 ;
	VALID _4cd0m1y0r()
@ 15,2 SAY "*-------------------------------------------------------------------*" ;
	SIZE 1,69, 0
@ 9,13 GET EMWriteProp ;
	PICTURE "@*HN EMWriteProp - Grava do Vetor para Base na Tabela" ;
	SIZE 1,50,1 ;
	DEFAULT 1 ;
	VALID _4cd0m1y0s()
@ 19,2 SAY "*-------------------------------------------------------------------*" ;
	SIZE 1,69, 0
@ 14,2 GET EMGetAlias ;
	PICTURE "@*HN EMGetAlias - Retorna Alias da area em que foi abertaa tabela" ;
	SIZE 1,62,1 ;
	DEFAULT 1 ;
	VALID _4cd0m1y0t()
@ 31,1 SAY "*-----------------------------------------------------------*" ;
	SIZE 1,61, 0
@ 32,2 GET EMMarcaFlgNF ;
	PICTURE "@*HN EMMarcaFlgNF - Marca flag de controle etapa faturamento NF" ;
	SIZE 1,60,1 ;
	DEFAULT 1 ;
	VALID _4cd0m1y0u()
@ 27,2 GET EMGet_ECFModelo ;
	PICTURE "@*HN EMGet_ECFModelo - Obter Nro Serie Ecf" ;
	SIZE 1,39,1 ;
	DEFAULT 1 ;
	VALID _4cd0m1y0v()



READ


#REGION 0
IF m.talkstat = "ON"
	SET TALK ON
ENDIF
IF m.compstat = "ON"
	SET COMPATIBLE ON
ENDIF


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4CD0M1XV4           EMGet_UF VALID                     
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         EMPRESA,     Record Number:    2   
*        Variable:            EMGet_UF                           
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      1                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4cd0m1xv4     &&  EMGet_UF VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION EMGet_UF
PARAMETERS PrmEmp

	=EMChk_Identidade(PrmEmp)

RETURN(EMGetPropVT("ESTADO"))


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4CD0M1XVF           EMGet_Juro VALID                   
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         EMPRESA,     Record Number:    3   
*        Variable:            EMGet_Juro                         
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      2                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4cd0m1xvf     &&  EMGet_Juro VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION EMGet_Juro
PARAMETERS PrmEmp

	=EMChk_Identidade(PrmEmp)

RETURN(EMGetPropVT("JUROMES"))


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4CD0M1XVN           verif VALID                        
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         EMPRESA,     Record Number:    4   
*        Variable:            verif                              
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      3                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4cd0m1xvn     &&  verif VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION UVerifEmp
PARAMETERS LNemp,LSnome,LNkey
	=W_DEFPROC("rotinas.spr")
	PRIVATE LSalias
	PRIVATE LFempresa
	PRIVATE LFretorno
	*-----------------------------------------------------------*
	LSalias	= ALIAS()
	LFempresa		= NetArq("empresa")
	IF (LFempresa) > 100000 && HOUVE FALHA DE ABERTURA
		=UP_fecha("empresa" ,LFempresa)
		IF !EMPTY(LSalias) AND USED(LSalias)
			SELECT &LSalias
		ENDIF
		RETURN(.f.)
	ENDIF
	*-----------------------------------------------------------*
	SELECT empresa
	SET ORDER TO TAG empresa
	IF LNkey = 9
	   ON KEY LABEL ESCAPE
	   DO loc_dlog WITH .F.
	   ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
	   LNemp	  = empresa.empresa
	ENDIF

	SET NEAR ON
	SEEK LNemp
   	IF LASTKEY() = 27 OR !FOUND()
		IF !EMPTY(LSalias) AND USED(LSalias)
			SELECT &LSalias
		ENDIF
		LFretorno = .F.
	ELSE
		LSnome  = empresa.sigla
		LFretorno = .T.
	ENDIF
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
	=UP_fecha("empresa" ,LFempresa)
RETURN(LFretorno)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4CD0M1XXE           EMrodanroNF VALID                  
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         EMPRESA,     Record Number:    5   
*        Variable:            EMrodanroNF                        
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      4                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4cd0m1xxe     &&  EMrodanroNF VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION EMrodanroNF
PARAMETERS LNemp,LStp_process
	*------------------------------------------------------------*
	* CLASSIFICACAO:  [*****]
	*------------------------------------------------------------*
	* OBJETIVO....: Incrementar Numeracao de Nota/Cupom
	*	
	*------------------------------------------------------------*
	* COMENTARIO..:
	*				
	*------------------------------------------------------------*
	* OBS........ :
	*------------------------------------------------------------*
	*  TABELAS....:
	*------------------------------------------------------------*
	*  PARAMETROS..:
	*		LNemp..........: Empresa que Esta Faturando
	*		LStp_process...: Processo definido em NFDefProcess
	*
	*------------------------------------------------------------*
	*  RETORNO.....:
	*------------------------------------------------------------*
	* EXEMPLO : CHAMADA DO PROGRAMA SCGC2.prg
	*------------------------------------------------------------*
	=W_DEFPROC("rotinas.spr")
	PRIVATE LSalias
	*-----------------------------------------------------------*
	LSalias	= ALIAS()
	*------------------------------------------------------------*
	SELECT empresa
	SET ORDER TO tag empresa
	SEEK LNemp
	IF !FOUND()
		IF !EMPTY(LSalias) AND USED(LSalias)
			SELECT &LSalias
		ENDIF
		RETURN(.f.)
	ENDIF
	=REGLOCK(.T.)
	DO CASE
		CASE LStp_proces = "NOTA" OR LStp_proces = "NOTA/CUPOM"
			REPLACE empresa.nota WITH empresa.nota + 1 && ULTIMA NOTA GERADA
			REPLACE FLAGIMPNF 	WITH 1
		CASE LStp_proces = "CUPOM"
			REPLACE empresa.ult_cupom  WITH ult_cupom + 1
			REPLACE FLAGIMPCPM 	WITH 1
		CASE LStp_proces = "NF.SERVICO"
			REPLACE empresa.Ult_NFsrvc WITH empresa.Ult_NFsrvc + 1
			REPLACE FLAGIMPSRV 	WITH 1

	ENDCASE
	*--------------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(.t.)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4CD0M1XXM           EMGet_Mora VALID                   
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         EMPRESA,     Record Number:    6   
*        Variable:            EMGet_Mora                         
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      5                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4cd0m1xxm     &&  EMGet_Mora VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION EMGet_Mora
PARAMETERS PrmEmp

	=EMChk_Identidade(PrmEmp)

RETURN(EMGetPropVT("MORA"))


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4CD0M1XXN           EMGet_Sigla VALID                  
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         EMPRESA,     Record Number:    7   
*        Variable:            EMGet_Sigla                        
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      6                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4cd0m1xxn     &&  EMGet_Sigla VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION EMGet_Sigla
PARAMETERS PrmEmp

	=EMChk_Identidade(PrmEmp)

RETURN(EMGetPropVT("SIGLA"))


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4CD0M1XXO           EMGet_ECFSerie VALID               
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         EMPRESA,     Record Number:    8   
*        Variable:            EMGet_ECFSerie                     
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      7                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4cd0m1xxo     &&  EMGet_ECFSerie VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION EMGet_ECFSerie
PARAMETERS PrmEmp

	=EMChk_Identidade(PrmEmp)

RETURN(EMGetPropVT("ECF_SERIE"))


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4CD0M1XXP           EMGet_Municipio VALID              
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         EMPRESA,     Record Number:    9   
*        Variable:            EMGet_Municipio                    
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      8                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4cd0m1xxp     &&  EMGet_Municipio VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION EMGet_Municipio
PARAMETERS PrmEmp

	=EMChk_Identidade(PrmEmp)

RETURN(EMGetPropVT("CIDADE"))


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4CD0M1XXQ           EMGet_TabCst VALID                 
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         EMPRESA,     Record Number:   10   
*        Variable:            EMGet_TabCst                       
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      9                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4cd0m1xxq     &&  EMGet_TabCst VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION EMGet_TabCst
PARAMETERS PrmEmp

	=EMChk_Identidade(PrmEmp)

RETURN(EMGetPropVT("TAB_CST"))


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4CD0M1XXR           EMLerRegistro VALID                
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         EMPRESA,     Record Number:   11   
*        Variable:            EMLerRegistro                      
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      10                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4cd0m1xxr     &&  EMLerRegistro VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION EMLerRegistro
PARAMETERS  PrmEmp



	PRIVATE LFretorno
	LFretorno = .t.

	LFretorno = EMChk_Identidade(PrmEmp)
RETURN(LFretorno)




*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4CD0M1XXS           EMSalvarRegistro VALID             
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         EMPRESA,     Record Number:   12   
*        Variable:            EMSalvarRegistro                   
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      11                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4cd0m1xxs     &&  EMSalvarRegistro VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION EMSalvarRegistro

	=EMVerifyInst()

	PRIVATE LFretorno
	LFretorno = .t.

	IF !EMExiste()
		SELE &PBEmpresaAlias
		APPEND BLANK
		LFretorno=EMWriteProp()
	ELSE
		SELE &PBEmpresaAlias
		LFretorno=EMWriteProp()
	ENDIF

RETURN(LFretorno)




*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4CD0M1XYT           EMExiste VALID                     
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         EMPRESA,     Record Number:   13   
*        Variable:            EMExiste                           
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      12                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4cd0m1xyt     &&  EMExiste VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION EMExiste
	PRIVATE LEmpresa

	PRIVATE LFreturn

	PRIVATE LSalias
	LSalias		= 	ALIAS()

	=EMVerifyInst()

	LEmpresa    = EMGetPropVT("Empresa")


	SELE &PBEmpresaAlias
	SET ORDER TO TAG empresa
	SEEK Lempresa

	
	IF FOUND()
	    LFreturn = .T.
	ELSE
	    LFreturn = .f.
	ENDIF
	*--------------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(LFreturn)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4CD0M1XZ0           EMVerifyInst VALID                 
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         EMPRESA,     Record Number:   14   
*        Variable:            EMVerifyInst                       
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      13                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4cd0m1xz0     &&  EMVerifyInst VALID
#REGION 1
return
*---------------------------------------------------------------*



FUNCTION EMVerifyInst
	
PRIVATE LSpath
	=W_DEFPROC("rotinas.spr")
	LSpath = UPobterPath("Empresa")


	DO CASE

		CASE TYPE("PBEmpresalias") = "U" ;
		   		OR EMPTY(PBEmpresaAlias) ;
		   		OR !USED(PBEmpresaAlias)
			=EMCreate()					

		CASE !("EMPRESA.DBF" $ DBF(PBEmpresaAlias))
				* APOS UM CLOSE DATABASE UM OUTRO DBF FOI
				* ABERTO NA AREA ANTES OCUPADA PELO DBF AVALIADO AKI
				RELEASE PBEmpresaAlias
			=EMCreate()					


		CASE  !(LSPath $ DBF(PBEmpresaAlias))
			 	* HOUVE MUDANCA DE DIR BASE
			 	* ELIMINA INSTACIA DE OUTRA BASE
		     	* CRIA INSTANCIA NA NOVA BASE
			=EMDestroi()				
			=EMCreate()					
	ENDCASE

	
RETURN(.t.)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4CD0M1XZ6           EMCreate VALID                     
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         EMPRESA,     Record Number:   15   
*        Variable:            EMCreate                           
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      14                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4cd0m1xz6     &&  EMCreate VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION EMCreate
	=W_DEFPROC("rotinas.spr")
	PRIVATE LSalias
	PRIVATE LSAlsTmp
    PRIVATE LMaxDim
	LSalias		= 	ALIAS()
	
	IF TYPE("PBEmpresaAlias") <> "U" ;
	   		AND !EMPTY(PBEmpresaAlias) ;
	   		AND USED(PBEmpresaAlias)
			RETURN(.T.)
	ENDIF


	PUBLIC PBEmpresaAlias

	IF USED("Empresa")
	     =NetArqAgain("Empresa")
	     PBEmpresaAlias     = Alias()
	ELSE
	     =NetArqAgain("Empresa")
	     LSAlsTmp     = Alias()
	     =NetArqAgain("Empresa")
	     PBEmpresaAlias     = Alias()
		 IF !EMPTY(LSAlsTmp) AND USED(LSAlsTmp)
			SELECT &LSAlsTmp
			USE
		 ENDIF
	ENDIF	

    SELE &PBEmpresaAlias
	LMaxDim = Fcount()
    PUBLIC DIMENSION VTEmpresa[LMaxDim]
    PUBLIC DIMENSION VDEmpresa[2,3]			&& VETOR PARA PROPRIEDADES
	*-----------------------------------------------------------*
	=EMReadProperty()
	=EMSetDerivadas()
	*--------------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4CD0M1XZ7           EMDestroi VALID                    
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         EMPRESA,     Record Number:   16   
*        Variable:            EMDestroi                          
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      15                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4cd0m1xz7     &&  EMDestroi VALID
#REGION 1
return
*---------------------------------------------------------------*


FUNCTION EMDestroi

	=W_DEFPROC("rotinas.spr")

	IF TYPE("PBEmpresaAlias") = "U"
		RETURN
	ENDIF

    *--------------------------------------------------------------------*
	*-> QUANDO O SISTEMA APLICA UM CLOSE DATABASE :
	*   EX: EM UPAltDir (Geral.spr)
	*  1- Fecha inclusive a referencia do PBDocFiscaAlias
	*  2- Novas tabelas abertas podem ocupar a area referenciada
	*     por PBDocFiscaAlias
	*  3- Se aplicar um FECHAMENTO a PBDocFiscaAlias estara fechando
	*     outra tabela
	*  4- Entao Verifica-se a coerencia do dbf esperado em PBDocFiscaAlias
	*-------------------------------------------------------------------*
	IF !(USED(PBEmpresaAlias)) OR ;
	   !("EMPRESA.DBF" $ DBF(PBEmpresaAlias))

		RELEASE PBEmpresaAlias
    	RELEASE VTEmpresa
	    RELEASE VDEmpresa
		return(.T.)			
	ENDIF
	PRIVATE LSalias
	LSalias  = Alias()
	IF !EMPTY(PBEmpresaAlias) AND USED(PBEmpresaAlias)
		SELECT &PBEmpresaAlias
		USE
	ENDIF	
	RELEASE PBEmpresaAlias
    RELEASE VTEmpresa
    RELEASE VDEmpresa

	*-----------------------------------------------------------*
	*--------------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(.T.)


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4CD0M1XZ8           EMReadProp VALID                   
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         EMPRESA,     Record Number:   17   
*        Variable:            EMReadProp                         
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      16                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4cd0m1xz8     &&  EMReadProp VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION EMReadProp
	PRIVATE LSalias
	LSalias		= 	ALIAS()

**	=EMVerifyInst()

	SELE &PBEmpresaAlias
	SCATTER TO VTEmpresa
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(.T.)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4CD0M1XZ9           EMSetDerivadas VALID               
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         EMPRESA,     Record Number:   18   
*        Variable:            EMSetDerivadas                     
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      17                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4cd0m1xz9     &&  EMSetDerivadas VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION EMSetDerivadas
	PRIVATE LSalias
	PRIVATE LEmpresa
	LSalias		= 	ALIAS()

**	=EMVerifyInst()
	*--------------------------------------------------------------*
    VDEmpresa(1,1) = "NAOINFORMADO"
   	VDEmpresa(1,2) = 0
   	VDEmpresa(1,3) = .F.
	*--------------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(.T.)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4CD0M1XZA           EMSetPropVT VALID                  
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         EMPRESA,     Record Number:   19   
*        Variable:            EMSetPropVT                        
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      18                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4cd0m1xza     &&  EMSetPropVT VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION EMSetPropVT
PARAMETER  PrmField, PrmValue
	PRIVATE Lvalue

**	=EMVerifyInst()
	=W_DEFPROC("ROTINAS.SPR")
	Lvalue = RTsetValueObj(PrmField,PrmValue,;
						    PBEmpresaAlias,VTEmpresa,VDEmpresa)

RETURN(Lvalue)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4CD0M1XZB           EMGetPropVT VALID                  
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         EMPRESA,     Record Number:   20   
*        Variable:            EMGetPropVT                        
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      19                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4cd0m1xzb     &&  EMGetPropVT VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION EMGetPropVT
PARAMETER  PrmField

	PRIVATE Lvalue

**	=DFVerifyInst()
	=W_DEFPROC("ROTINAS.SPR")
	Lvalue = RTgetValueObj(PrmField,PBEmpresaAlias,VTEmpresa,VDEmpresa)

RETURN(Lvalue)





*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4CD0M1XZC           EMChk_Identidade VALID             
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         EMPRESA,     Record Number:   21   
*        Variable:            EMChk_Identidade                   
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      20                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4cd0m1xzc     &&  EMChk_Identidade VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION EMChk_Identidade
PARAMETERS  PrmEmp


	PRIVATE LFretorno
	LFretorno = .t.



	=EMVerifyInst()

    =EMSetPropVT("EMPRESA",PrmEmp)
	LFretorno=EMFind()

RETURN(LFretorno)





*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4CD0M1Y0D           EMFind VALID                       
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         EMPRESA,     Record Number:   22   
*        Variable:            EMFind                             
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      21                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4cd0m1y0d     &&  EMFind VALID
#REGION 1
return
*---------------------------------------------------------------*
FUNCTION EMFind

	PRIVATE Lcodigo
	PRIVATE LFreturn

	=W_DEFPROC("rotinas.spr")
	PRIVATE LSalias
	LSalias		= 	ALIAS()

	=EMVerifyInst()

	Lcodigo   = EMGetPropVT("EMPRESA")

	SELE &PBEmpresaAlias
	SET ORDER TO TAG empresa
	SEEK Lcodigo

	IF FOUND()
		=EMReadProperty()
		=EMSetDerivadas()   && carga dos calculos derivados
	    LFreturn = .T.
	ELSE
	    LFreturn = .f.
	ENDIF
	*--------------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(LFreturn)






*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4CD0M1Y0K           EMGetFieldValue VALID              
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         EMPRESA,     Record Number:   23   
*        Variable:            EMGetFieldValue                    
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      22                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4cd0m1y0k     &&  EMGetFieldValue VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION EMGetFieldValue
PARAMETERS  PrmEmp,PrmField			


	IF !EMChk_Identidade(PrmEmp)
		DO WHILE .T.
			=UPerrosys("Chamada GetFieldValue para Reg. Inexistente!")
		ENDDO
	ENDIF				

RETURN(EMGetPropVT(PrmField))


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4CD0M1Y0R           EM_Refresh VALID                   
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         EMPRESA,     Record Number:   24   
*        Variable:            EM_Refresh                         
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      23                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4cd0m1y0r     &&  EM_Refresh VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION EM_Refresh
PARAMETERS  PrmEmpresa
	

	PRIVATE LFreturn

	=EMVerifyInst()


	= EMSetPropVT("Empresa"   ,PrmEmpresa)

	*----------------------------------------------------------------*


	=EMFind()
	
RETURN(.t.)




*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4CD0M1Y0S           EMWriteProp VALID                  
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         EMPRESA,     Record Number:   26   
*        Variable:            EMWriteProp                        
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      24                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4cd0m1y0s     &&  EMWriteProp VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION EMWriteProp
	PRIVATE LSalias
	LSalias		= 	ALIAS()

**	=EMVerifyInst()

	SELE &PBEmpresaAlias
	=RLOCK()
	GATHER FROM  VTEmpresa
	UNLOCK

	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF

RETURN(.T.)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4CD0M1Y0T           EMGetAlias VALID                   
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         EMPRESA,     Record Number:   28   
*        Variable:            EMGetAlias                         
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      25                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4cd0m1y0t     &&  EMGetAlias VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION EMGetAlias

	=EMVerifyInst()

RETURN(PBEmpresaAlias)


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4CD0M1Y0U           EMMarcaFlgNF VALID                 
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         EMPRESA,     Record Number:   30   
*        Variable:            EMMarcaFlgNF                       
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      26                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4cd0m1y0u     &&  EMMarcaFlgNF VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION EMMarcaFlgNF
PARAMETERS LNemp,PrmNivelProcesso
	*------------------------------------------------------------*
	* CLASSIFICACAO:  [*****]
	*------------------------------------------------------------*
	* OBJETIVO....: Incrementar Flag Nota/Cupom
	*	
	*------------------------------------------------------------*
	=W_DEFPROC("rotinas.spr")
	PRIVATE LSalias
	*-----------------------------------------------------------*
	LSalias	= ALIAS()
	*------------------------------------------------------------*
	SELECT empresa
	SET ORDER TO tag empresa
	SEEK LNemp
	IF !FOUND()
		IF !EMPTY(LSalias) AND USED(LSalias)
			SELECT &LSalias
		ENDIF
		RETURN(.f.)
	ENDIF
	=REGLOCK(.T.)

	REPLACE FLAGIMPNF 	WITH PrmNivelProcesso

	*--------------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(.t.)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4CD0M1Y0V           EMGet_ECFModelo VALID              
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         EMPRESA,     Record Number:   31   
*        Variable:            EMGet_ECFModelo                    
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      27                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4cd0m1y0v     &&  EMGet_ECFModelo VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION EMGet_ECFModelo
PARAMETERS PrmEmp

	=EMChk_Identidade(PrmEmp)

RETURN(EMGetPropVT("TIPO_ECF"))
