*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        21/12/2015             GRUPO.SPR               09:49:27 
*                                                                
*       픔컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        Author's Name                                           
*                                                                
*        Copyright (c) 2015 Company Name                         
*        Address                                                 
*        City,     Zip                                           
*                                                                
*        Description:                                            
*        This program was automatically generated by GENSCRN.    
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴


#REGION 0
REGIONAL m.currarea, m.talkstat, m.compstat

IF SET("TALK") = "ON"
	SET TALK OFF
	m.talkstat = "ON"
ELSE
	m.talkstat = "OFF"
ENDIF
m.compstat = SET("COMPATIBLE")
SET COMPATIBLE FOXPLUS

*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                       MS-DOS Window definitions                
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                      GRUPO/MS-DOS Screen Layout                
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 1
@ 29,0 GET GRGetClassifica ;
	PICTURE "@*HN GRGetClassifica - Retorna Classificacao do Produto" ;
	SIZE 1,52,1 ;
	DEFAULT 1 ;
	VALID _4is0l21mk()
@ 30,0 GET GRGetPeso ;
	PICTURE "@*HN GRGetPeso - Retorna Peso" ;
	SIZE 1,26,1 ;
	DEFAULT 1 ;
	VALID _4is0l21mq()
@ 31,0 GET ver_Prod ;
	PICTURE "@*HN GRLoc_Prod - Loc/Posicionar Reg Codigo de Produto" ;
	SIZE 1,51,1 ;
	DEFAULT 1 ;
	VALID _4is0l21mx()
@ 32,0 GET GRGetOrigem ;
	PICTURE "@*HN GRGetOrigem - Retorna Origem do Produto" ;
	SIZE 1,41,1 ;
	DEFAULT 1 ;
	VALID _4is0l21n7()
@ 8,6 GET GRVerifyInst ;
	PICTURE "@*HN GRVerifyInst - Verifica Instancia" ;
	SIZE 1,35,1 ;
	DEFAULT 1 ;
	VALID _4is0l21nd()
@ 9,9 GET GRCreate ;
	PICTURE "@*HN GRCreate - Instancia" ;
	SIZE 1,22,1 ;
	DEFAULT 1 ;
	VALID _4is0l21nk()
@ 18,8 GET GRDestroi ;
	PICTURE "@*HN GRDestroi - Desinstancia" ;
	SIZE 1,26,1 ;
	DEFAULT 1 ;
	VALID _4is0l21nu()
@ 10,11 GET GRReadProp ;
	PICTURE "@*HN GRReadProp - Carga do Vetor com Base na Tabela" ;
	SIZE 1,48,1 ;
	DEFAULT 1 ;
	VALID _4is0l21o2()
@ 11,11 GET GRSetDerivadas ;
	PICTURE "@*HN GRSetDerivadas - Carga de Propriedades Derivadas" ;
	SIZE 1,51,1 ;
	DEFAULT 1 ;
	VALID _4is0l21o7()
@ 14,11 GET GRSetPropVT ;
	PICTURE "@*HN GRSetPropVT - Set o Valor de uma Propriedade do Vetor" ;
	SIZE 1,55,1 ;
	DEFAULT 1 ;
	VALID _4is0l21od()
@ 15,11 GET GRGetPropVT ;
	PICTURE "@*HN GRGetPropVT - Get o Valor de uma Propriedade do Vetor" ;
	SIZE 1,55,1 ;
	DEFAULT 1 ;
	VALID _4is0l21oj()
@ 5,1 GET GRChk_Identidade ;
	PICTURE "@*HN GRChk_Identidade - Checagem de Identidade do Objeto" ;
	SIZE 1,53,1 ;
	DEFAULT 1 ;
	VALID _4is0l21op()
@ 4,7 GET antGRFind ;
	PICTURE "@*HN antGRFind - 28/10/11 Localiza Registro Com Base nas Propriedades" ;
	SIZE 1,66,1 ;
	DEFAULT 1 ;
	VALID _4is0l21ov() ;
	DISABLE
@ 20,0 GET GRGetFieldValue ;
	PICTURE "@*HN GRGetFieldValue -Rtrn vlr Campo p/ reg.existente-(erro se chave n existir)" ;
	SIZE 1,76,1 ;
	DEFAULT 1 ;
	VALID _4is0l21p2()
@ 19,0 GET GR_Refresh ;
	PICTURE "@*HN GR_Refresh - Forca Atualiza놹o Objeto" ;
	SIZE 1,39,1 ;
	DEFAULT 1 ;
	VALID _4is0l21p7()
@ 22,0 SAY "*-------------------------------------------------------------------*" ;
	SIZE 1,69, 0
@ 25,4 GET antGRLerRegistro ;
	PICTURE "@*HN ant GRLerRegistro - 28/10/11 Le Registro e Carrega OBJ" ;
	SIZE 1,56,1 ;
	DEFAULT 1 ;
	VALID _4is0l21qw() ;
	DISABLE
@ 17,11 GET GRWriteProp ;
	PICTURE "@*HN GRWriteProp - Grava do Vetor para Base na Tabela" ;
	SIZE 1,50,1 ;
	DEFAULT 1 ;
	VALID _4is0l21qx()
@ 26,0 GET GRSalvarRegistro ;
	PICTURE "@*HN GRSalvarRegistro - Salva Registro" ;
	SIZE 1,35,1 ;
	DEFAULT 1 ;
	VALID _4is0l21qy()
@ 23,0 GET GRExiste ;
	PICTURE "@*HN GRExiste - Le Registro nao carrega o OBJ e Retorna se existe" ;
	SIZE 1,62,1 ;
	DEFAULT 1 ;
	VALID _4is0l21qz()
@ 27,0 SAY "*-------------------------------------------------------------------*" ;
	SIZE 1,69, 0
@ 21,0 GET GRGetAlias ;
	PICTURE "@*HN GRGetAlias - Retorna Alias da area em que foi abertaa tabela" ;
	SIZE 1,62,1 ;
	DEFAULT 1 ;
	VALID _4is0l21r0()
@ 7,3 GET GRTrtChave ;
	PICTURE "@*HN GRTrtChave - Trata Acesso por Chave " ;
	SIZE 1,38,1 ;
	DEFAULT 1 ;
	VALID _4is0l21r1()
@ 12,11 GET GRSetConfig ;
	PICTURE "@*HN GRSetConfig - Carga Propriedades de Configuracao/Parametros" ;
	SIZE 1,61,1 ;
	DEFAULT 1 ;
	VALID _4is0l21r2()
@ 33,0 GET GRGetNomeFab ;
	PICTURE "@*HN GRGetNomeFab - Retorna Nome do Fabricante do Produto" ;
	SIZE 1,54,1 ;
	DEFAULT 1 ;
	VALID _4is0l21r3()
@ 34,0 GET GRGetCodPrdNoFab ;
	PICTURE "@*HN GRGetCodPrdNoFab-Ret Cod Prod no Fabricante-Indicado no Cad" ;
	SIZE 1,61,1 ;
	DEFAULT 1 ;
	VALID _4is0l21r4()
@ 28,0 GET GRFaxinaDados ;
	PICTURE "@*HN GRFaxinaDados-Retira char invalidor e outras validacoes" ;
	SIZE 1,57,1 ;
	DEFAULT 1 ;
	VALID _4is0l21r5()
@ 36,0 GET GRGerXMLProduto ;
	PICTURE "@*HN GRGerXMLProduto-Gera XML dos Produtos" ;
	SIZE 1,39,1 ;
	DEFAULT 1 ;
	VALID _4is0l21sg()
@ 38,8 GET GRNmFileXML ;
	PICTURE "@*HN GRNmFileXML-Define Path+File do XML" ;
	SIZE 1,37,1 ;
	DEFAULT 1 ;
	VALID _4is0l21sh()
@ 39,4 GET GRInicioXML ;
	PICTURE "@*HN GRInicioXML-Monta Cabecalho XML com base no modelo-xmlPRDT" ;
	SIZE 1,60,1 ;
	DEFAULT 1 ;
	WHEN .f. ;
	VALID _4is0l21si()
@ 54,4 GET GRFinalXML ;
	PICTURE "@*HN GRFinalXML-Monta Fechamento ARQ XML com base no modelo-xmlPRDT" ;
	SIZE 1,64,1 ;
	DEFAULT 1 ;
	WHEN .f. ;
	VALID _4is0l21sj()
@ 37,8 GET GRModeloRefXML ;
	PICTURE "@*HN GRModeloRefXML-MODELO P/MONTAR REF XML Produto - xmlPRDT" ;
	SIZE 1,58,1 ;
	DEFAULT 1 ;
	WHEN .f. ;
	VALID _4is0l21sk()
@ 3,1 GET GRFind ;
	PICTURE "@*HN GRFind - Localiza Registro Com Base nas Propriedades" ;
	SIZE 1,54,1 ;
	DEFAULT 1 ;
	VALID _4is0l21sl()
@ 6,7 GET antGRChk_Identidade ;
	PICTURE "@*HN antGRChk_Identidade - 28/10/11 Checagem de Identidade do Objeto" ;
	SIZE 1,65,1 ;
	DEFAULT 1 ;
	VALID _4is0l21sm() ;
	DISABLE
@ 24,0 GET GRLerRegistro ;
	PICTURE "@*HN GRLerRegistro - Le Registro e Carrega OBJ" ;
	SIZE 1,43,1 ;
	DEFAULT 1 ;
	VALID _4is0l21sq()
@ 0,0 SAY "====> Com Uso de pseudo OO" ;
	SIZE 1,26, 0
@ 40,8 GET GRCrvUnemXML ;
	PICTURE "@*HN GRCrvUnemXML - Exporta Unem para XML" ;
	SIZE 1,38,1 ;
	DEFAULT 1 ;
	VALID _4is0l21sw()
@ 60,8 GET GRGrvClassifXML ;
	PICTURE "@*HN GRGrvClassifXML - Grava Classificacao para XML" ;
	SIZE 1,48,1 ;
	DEFAULT 1 ;
	VALID _4is0l21t5()
@ 42,8 GET GRGrvProdutoXML ;
	PICTURE "@*HN GRGrvProdutoXML - Grava Produto para XML" ;
	SIZE 1,42,1 ;
	DEFAULT 1 ;
	VALID _4is0l21tg()
@ 47,8 GET GRGrvInventarioXML ;
	PICTURE "@*HN GRGrvInventarioXML - Grava Inventario Produto para XML" ;
	SIZE 1,56,1 ;
	DEFAULT 1 ;
	VALID _4is0l21u4()
@ 49,8 GET GRGrvFaricanteXML ;
	PICTURE "@*HN GRGrvFaricanteXML - Grava Fabricante Produto para XML" ;
	SIZE 1,55,1 ;
	DEFAULT 1 ;
	VALID _4is0l21ug()
@ 50,8 GET GRGrvProprietarioXML ;
	PICTURE "@*HN GRGrvProprietarioXML - Grava Proprietario Produto para XML" ;
	SIZE 1,60,1 ;
	DEFAULT 1 ;
	VALID _4is0l21up()
@ 48,8 GET GRGrvSaldosXML ;
	PICTURE "@*HN GRGrvSaldosXML - Grava Saldos Produto para XML" ;
	SIZE 1,48,1 ;
	DEFAULT 1 ;
	VALID _4is0l21ux()
@ 43,8 GET GRGrvUnidadeXML ;
	PICTURE "@*HN GRGrvUnidadeXML - Grava Unidade para XML" ;
	SIZE 1,42,1 ;
	DEFAULT 1 ;
	VALID _4is0l21v6()
@ 44,8 GET GRGrvRgmTributarioXML ;
	PICTURE "@*HN GRGrvRgmTributarioXML - Grava Regime Tributario para XML" ;
	SIZE 1,58,1 ;
	DEFAULT 1 ;
	VALID _4is0l21vg()
@ 45,8 GET GRGrvNCM_XML ;
	PICTURE "@*HN GRGrvNCM_XML - Grava NCM para XML" ;
	SIZE 1,35,1 ;
	DEFAULT 1 ;
	VALID _4is0l21vq()
@ 46,8 GET GRGrvLstServicoXML ;
	PICTURE "@*HN GRGrvLstServicoXML - Grava Cod. Lista Servico para XML" ;
	SIZE 1,56,1 ;
	DEFAULT 1 ;
	VALID _4is0l21vz()
@ 51,8 GET GRGrvEquivalentesXML ;
	PICTURE "@*HN GRGrvEquivalentesXML - Grava Equivalentes para XML" ;
	SIZE 1,52,1 ;
	DEFAULT 1 ;
	VALID _4is0l21wa() ;
	DISABLE
@ 52,8 GET GRGrvAcompanhamentoXML ;
	PICTURE "@*HN GRGrvAcompanhamentoXML - Grava Acompanhamentos Produto para XML" ;
	SIZE 1,65,1 ;
	DEFAULT 1 ;
	VALID _4is0l21wj() ;
	DISABLE
@ 62,0 GET GRtratalinha ;
	PICTURE "@*HN GRtratalinha-Trata linha antes da gravacao XML" ;
	SIZE 1,48,1 ;
	DEFAULT 1 ;
	VALID _4is0l21ws()
@ 64,0 GET GRLimpaString ;
	PICTURE "@*HN GRLimpaString - Elimina Caracteres especiais de string" ;
	SIZE 1,56,1 ;
	DEFAULT 1 ;
	VALID _4is0l21yf()
@ 63,0 GET GR_Fputs ;
	PICTURE "@*HN GR_Fputs - Elimina caracteres especiais da string XML" ;
	SIZE 1,55,1 ;
	DEFAULT 1 ;
	VALID _4is0l21yg()
@ 53,8 GET GRfecharegXML ;
	PICTURE "@*HN GRfecharegXML - Insere caracter de fecamento da linha XML" ;
	SIZE 1,59,1 ;
	DEFAULT 1 ;
	VALID _4is0l21yh()
@ 56,0 GET GRGerXMLClassifica ;
	PICTURE "@*HN GRGerXMLClassifica-Gera XML das Classificacoes de Produtos" ;
	SIZE 1,60,1 ;
	DEFAULT 1 ;
	VALID _4is0l21yi()
@ 35,0 SAY "XML=>XMLPrdt.xml" ;
	SIZE 1,16, 0
@ 55,0 SAY "XML=>XMLClsf.xml" ;
	SIZE 1,16, 0
@ 58,8 GET GRClsfNmFileXML ;
	PICTURE "@*HN GRClsfNmFileXML-Define Path+File do XML" ;
	SIZE 1,41,1 ;
	DEFAULT 1 ;
	VALID _4is0l21yj()
@ 57,8 GET GRClsfModeloRefXML ;
	PICTURE "@*HN GRClsfModeloRefXML-MODELO P/MONTAR REF XML Classificacao - xmlCLSF" ;
	SIZE 1,68,1 ;
	DEFAULT 1 ;
	WHEN .f. ;
	VALID _4is0l21yk()
@ 59,4 GET GRClsfInicioXML ;
	PICTURE "@*HN GRClsfInicioXML-Monta Cabecalho XML com base no modelo-xmlPRDT" ;
	SIZE 1,64,1 ;
	DEFAULT 1 ;
	WHEN .f. ;
	VALID _4is0l21yl()
@ 65,0 SAY "---------------------------------------------------" ;
	SIZE 1,51, 0
@ 66,0 GET GRCEST_Carregar ;
	PICTURE "@*HN GRCEST_Carregar - Carrega Tabela Cesto para produto padrao" ;
	SIZE 1,60,1 ;
	DEFAULT 1 ;
	VALID _4is0l21ym()



READ


#REGION 0
IF m.talkstat = "ON"
	SET TALK ON
ENDIF
IF m.compstat = "ON"
	SET COMPATIBLE ON
ENDIF


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21MK           GRGetClassifica VALID              
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:    2     
*        Variable:            GRGetClassifica                    
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      1                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21mk     &&  GRGetClassifica VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION GRGetClassifica
PARAMETERS PrmCodigo

	=GRChk_Identidade(PrmCodigo)

RETURN(GRGetPropVT("CLASSIFICA"))


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21MQ           GRGetPeso VALID                    
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:    3     
*        Variable:            GRGetPeso                          
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      2                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21mq     &&  GRGetPeso VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION GRGetPeso
PARAMETERS PrmCodigo

	=GRChk_Identidade(PrmCodigo)

RETURN(GRGetPropVT("PESO"))


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21MX           ver_Prod VALID                     
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:    4     
*        Variable:            ver_Prod                           
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      3                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21mx     &&  ver_Prod VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*


FUNCTION GRLoc_Prod
PARAMETERS LScod,LNkey,LScondBrow
	*------------------------------------------------------------*
	* CLASSIFICACAO:  [*****]
	*------------------------------------------------------------*
	* OBJETIVO....: Localizar um codigo
	*------------------------------------------------------------*
	* COMENTARIO..: A funcao permite localizar um codigo informado
	*			ou fazer localizacao em tabela BROWSE conform
	*			condicao browse repassada e retornar .f. ou .t.
	*			e o registro posicionado do arq. GRUPO para ser
	*			tratado na rotina camadora
	*------------------------------------------------------------*
	* OBS........ :
	*------------------------------------------------------------*
	*  TABELAS....:
	*------------------------------------------------------------*
	*  PARAMETROS..:
	*		LScod..........: Codigo do Produto que se quer localizar
	*		LNkey..........: Tecla de encerramento no campo de chamada
	*						EXEMPLO <TAB> = 9
	*		LScondBrow.....: Condicao de filtragem do browse (parametro
	*						 repassado para LOC_DLOG
	*------------------------------------------------------------*
	*  RETORNO.....:- REGISTRO DO PRODUTO POSICIONADO para
	*					ser tratado na rotina
	*				- .F. Para codigo nao localizado
	*				- .T. Para codigo Localizado
	*------------------------------------------------------------*
	* EXEMPLO : CHAMADA DO PROGRAMA SCGC407.SCR
	*
	*	=W_DEFPROC("grupo.spr")
	*	LNkey 	= LASTKEY()
	*	LScond_Brows = ".T."
	*	wl_tmp =  STRTRAN(STR(wp_empresa,3),' ','0')
	*	LScond_Brows	= ".T.,  '&wl_tmp'  $  empresas"
	*	IF !GRLoc_Prod(m.codigo,LNkey, LScond_Brows )
	*	    ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
	*	    RETURN .F.
	*	ENDIF
	*------------------------------------------------------------*
	=W_DEFPROC("rotinas.spr")

	PRIVATE LSalias
	PRIVATE LFgrupo
	PRIVATE LFretorno

	*-----------------------------------------------------------*
	LSalias	= ALIAS()
	LFgrupo		= NetArq("grupo")
	IF (LFgrupo) > 100000 && HOUVE FALHA DE ABERTURA
		=UP_fecha("grupo" ,LFgrupo)
		IF !EMPTY(LSalias) AND USED(LSalias)
			SELECT &LSalias
		ENDIF
		RETURN(.f.)
	ENDIF
	*-----------------------------------------------------------*
	PUSH KEY CLEAR		&& desabilita teclas de atalho def. anteriormente
	*-----------------------------------------------------------*
	SELECT grupo
	SET ORDER TO TAG codigo
	IF LNkey = 9
	   	DO loc_dlog WITH &LScondBrow
	   	LScod	  = grupo.codigo
	   	IF LASTKEY() <> 27
			LScod = grupo.codigo
		ENDIF	
	ENDIF
	*-----------------------------------------------------------*
   	IF LASTKEY() <> 27
		SET NEAR ON
		SEEK LScod
		SET NEAR OFF
	ENDIF
   	IF LASTKEY() = 27 OR !FOUND()
		IF !EMPTY(LSalias) AND USED(LSalias)
			SELECT &LSalias
		ENDIF
		LFretorno = .F.
	ELSE
		LFretorno = .T.
	ENDIF
	=UP_fecha("grupo" ,LFgrupo)
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
	*--------------------------------------------------------------*
	POP KEY 	&& reabilita teclas de atalho def. anteriormente
RETURN(LFretorno)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21N7           GRGetOrigem VALID                  
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:    5     
*        Variable:            GRGetOrigem                        
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      4                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21n7     &&  GRGetOrigem VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION GRGetOrigem
PARAMETERS PrmCodigo

	=GRChk_Identidade(PrmCodigo)

RETURN(GRGetPropVT("ORIGEM"))


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21ND           GRVerifyInst VALID                 
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:    6     
*        Variable:            GRVerifyInst                       
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      5                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21nd     &&  GRVerifyInst VALID
#REGION 1
return
*---------------------------------------------------------------*



FUNCTION GRVerifyInst
	
PRIVATE LSpath
	=W_DEFPROC("rotinas.spr")
	LSpath = UPobterPath("GRUPO")


	DO CASE

		CASE TYPE("PBGrupoAlias") = "U" ;
		   		OR EMPTY(PBGrupoAlias) ;
		   		OR !USED(PBGrupoAlias)
			=GRCreate()					

		CASE !("GRUPO.DBF" $ DBF(PBGrupoAlias))
				* APOS UM CLOSE DATABASE UM OUTRO DBF FOI
				* ABERTO NA AREA ANTES OCUPADA PELO DBF AVALIADO AKI
				RELEASE PBGrupoAlias
			=GRCreate()					


		CASE  !(LSPath $ DBF(PBGrupoAlias))
			 	* HOUVE MUDANCA DE DIR BASE
			 	* ELIMINA INSTACIA DE OUTRA BASE
		     	* CRIA INSTANCIA NA NOVA BASE
			=GRDestroi()				
			=GRCreate()					
	ENDCASE

	
RETURN(.t.)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21NK           GRCreate VALID                     
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:    7     
*        Variable:            GRCreate                           
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      6                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21nk     &&  GRCreate VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION GRCreate
	=W_DEFPROC("rotinas.spr")
	PRIVATE LSalias
	PRIVATE LSAlsTmp
    PRIVATE LMaxDim
	LSalias		= 	ALIAS()
	
	IF TYPE("PBGrupoAlias") <> "U" ;
	   		AND !EMPTY(PBGrupoAlias) ;
	   		AND USED(PBGrupoAlias)
			RETURN(.T.)
	ENDIF


	PUBLIC PBGrupoAlias

	IF USED("Grupo")

	     =NetArqAgain("Grupo")
	     PBGrupoAlias     = Alias()

	ELSE

	     =NetArqAgain("Grupo")
	     LSAlsTmp     = Alias()
	     =NetArqAgain("Grupo")
	     PBGrupoAlias     = Alias()
		 IF !EMPTY(LSAlsTmp) AND USED(LSAlsTmp)
			SELECT &LSAlsTmp
			USE
		 ENDIF

	ENDIF	

    SELE &PBGrupoAlias
	LMaxDim = Fcount()
    PUBLIC DIMENSION VTGrupo[LMaxDim]
    PUBLIC DIMENSION VDGrupo[2,3]			&& VETOR PARA PROPRIEDADES
    PUBLIC DIMENSION VFGrupo[1]      && VETOR CABECALHO DOS CAMPOS
    PUBLIC DIMENSION VCGrupo[8,3]	&& VETOR PARA CONFIGURACOES

	=AFIELDS(VFGrupo)

	*-----------------------------------------------------------*
	=GRReadProperty()
	=GRSetDerivadas()
	=GRSetConfig()
	*-----------------------------------------------------------*
	
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21NU           GRDestroi VALID                    
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:    8     
*        Variable:            GRDestroi                          
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      7                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21nu     &&  GRDestroi VALID
#REGION 1
return
*---------------------------------------------------------------*


FUNCTION GRDestroi

	=W_DEFPROC("rotinas.spr")

	IF TYPE("PBGrupoAlias") = "U"
		RETURN
	ENDIF

    *--------------------------------------------------------------------*
	*-> QUANDO O SISTEMA APLICA UM CLOSE DATABASE :
	*   EX: EM UPAltDir (Geral.spr)
	*  1- Fecha inclusive a referencia do PBDocFiscaAlias
	*  2- Novas tabelas abertas podem ocupar a area referenciada
	*     por PBDocFiscaAlias
	*  3- Se aplicar um FECHAMENTO a PBDocFiscaAlias estara fechando
	*     outra tabela
	*  4- Entao Verifica-se a coerencia do dbf esperado em PBDocFiscaAlias
	*-------------------------------------------------------------------*
	IF !(USED(PBGrupoAlias)) OR ;
	   !("GRUPO.DBF" $ DBF(PBGrupoAlias))

		RELEASE PBGrupoAlias
    	RELEASE VTGrupo
	    RELEASE VDGrupo
	    RELEASE VFGrupo
	    RELEASE VCGrupo
		return(.T.)			
	ENDIF
	PRIVATE LSalias
	LSalias  = Alias()
	IF !EMPTY(PBGrupoAlias) AND USED(PBGrupoAlias)
		SELECT &PBGrupoAlias
		USE
	ENDIF	
	RELEASE PBGrupoAlias
    RELEASE VTgrupo
    RELEASE VDGrupo
    RELEASE VFGrupo
    RELEASE VCGrupo

	*-----------------------------------------------------------*
	*--------------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(.T.)


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21O2           GRReadProp VALID                   
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:    9     
*        Variable:            GRReadProp                         
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      8                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21o2     &&  GRReadProp VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION GRReadProp
	PRIVATE LSalias
	LSalias		= 	ALIAS()


	SELE &PBGrupoAlias
	SCATTER TO VTGrupo
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(.T.)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21O7           GRSetDerivadas VALID               
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:   10     
*        Variable:            GRSetDerivadas                     
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      9                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21o7     &&  GRSetDerivadas VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION GRSetDerivadas
	PRIVATE LSalias
	LSalias		= 	ALIAS()

**	=GRVerifyInst()
	*--------------------------------------------------------------*
    VDGrupo(1,1) = "NAOINFORMADO"
   	VDGrupo(1,2) = 0
   	VDGrupo(1,3) = .F.
	*--------------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(.T.)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21OD           GRSetPropVT VALID                  
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:   11     
*        Variable:            GRSetPropVT                        
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      10                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21od     &&  GRSetPropVT VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION GRSetPropVT
PARAMETER  PrmField, PrmValue
	PRIVATE Lvalue

	=W_DEFPROC("ROTINAS.SPR")
	Lvalue = RTsetValueObj(PrmField,;
							PrmValue,;
						    PBGrupoAlias,;
						    VTGrupo,;
						    VDGrupo,;
						    VFGrupo,;
						    VCGrupo)


RETURN(Lvalue)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21OJ           GRGetPropVT VALID                  
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:   12     
*        Variable:            GRGetPropVT                        
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      11                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21oj     &&  GRGetPropVT VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION GRGetPropVT
PARAMETER  PrmField

	PRIVATE Lvalue

	=W_DEFPROC("ROTINAS.SPR")

	Lvalue = RTgetValueObj(PrmField,;
						    PBGrupoAlias,;
						    VTGrupo,;
						    VDGrupo,;
						    VFGrupo,;
						    VCGrupo)

RETURN(Lvalue)





*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21OP           GRChk_Identidade VALID             
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:   13     
*        Variable:            GRChk_Identidade                   
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      12                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21op     &&  GRChk_Identidade VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION GRChk_Identidade
PARAMETERS PrmCodigo,PrmClassifica

	PRIVATE LFretorno
	LFretorno = .t.


	=GRVerifyInst()
    =GRSetPropVT("CODIGO",PrmCodigo)
   	IF TYPE("PrmClassifica") $ "U/L" OR EMPTY(PrmClassifica)
	    =GRSetPropVT("CLASSIFICA",.F.)
	    =GRSetPropVT("CHAVE DE LEITURA","CODIGO")
	ELSE
	    =GRSetPropVT("CLASSIFICA",PrmClassifica)
	    =GRSetPropVT("CHAVE DE LEITURA","CLASSIFICA")
	ENDIF


	LFretorno=GRFind()

RETURN(LFretorno)






*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21OV           antGRFind VALID                    
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:   14     
*        Variable:            antGRFind                          
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      13                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21ov     &&  antGRFind VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION antGRFind
	PRIVATE LCodigo
	PRIVATE LClassifica
	PRIVATE LFreturn
	PRIVATE LSchaveAcesso

	PRIVATE LSalias
	LSalias		= 	ALIAS()

	=GRVerifyInst()




	LCodigo     = GRGetPropVT("CODIGO")

	SELE &PBGrupoAlias
	SET ORDER TO TAG CODIGO
	SEEK LCodigo

	IF FOUND()
		=GRReadProperty()
		=GRSetDerivadas()   && carga dos calculos derivados
	    LFreturn = .T.
	ELSE

	    LFreturn = .f.
	ENDIF
	*--------------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(LFreturn)




*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21P2           GRGetFieldValue VALID              
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:   15     
*        Variable:            GRGetFieldValue                    
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      14                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21p2     &&  GRGetFieldValue VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION GRGetFieldValue
PARAMETERS  PrmCodigo, PrmField


	IF !GRChk_Identidade(PrmCodigo)
		DO WHILE .T.
			=UPerrosys("Chamada GetFieldValue para Reg. Inexistente!")
		ENDDO
	ENDIF				


RETURN(GRGetPropVT(PrmField))


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21P7           GR_Refresh VALID                   
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:   16     
*        Variable:            GR_Refresh                         
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      15                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21p7     &&  GR_Refresh VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION GR_Refresh
PARAMETERS PrmCodigo
			
	
	


	PRIVATE LFreturn

	=GRVerifyInst()


	= GRSetPropVT("Codigo"   ,PrmCodigo)
	*----------------------------------------------------------------*


	=GRFind()
	
RETURN(.t.)




*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21QW           antGRLerRegistro VALID             
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:   18     
*        Variable:            antGRLerRegistro                   
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      16                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21qw     &&  antGRLerRegistro VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION antGRLerRegistro
PARAMETERS  PrmCodigo



	PRIVATE LFretorno
	LFretorno = .t.
	LFretorno = GRChk_Identidade(PrmCodigo)

RETURN(LFretorno)




*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21QX           GRWriteProp VALID                  
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:   19     
*        Variable:            GRWriteProp                        
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      17                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21qx     &&  GRWriteProp VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION GRWriteProp
	PRIVATE LSalias
	LSalias		= 	ALIAS()

**	=GRVerifyInst()

	SELE &PBGrupoAlias
	=RLOCK()
	GATHER FROM  VTGrupo
	UNLOCK

	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF

RETURN(.T.)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21QY           GRSalvarRegistro VALID             
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:   20     
*        Variable:            GRSalvarRegistro                   
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      18                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21qy     &&  GRSalvarRegistro VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION GRSalvarRegistro

	=GRVerifyInst()

	PRIVATE LFretorno
	LFretorno = .t.

	IF !GRExiste()
		SELE &PBGrupoAlias
		APPEND BLANK
		LFretorno=GRWriteProp()
	ELSE
		SELE &PBGrupoAlias
		LFretorno=GRWriteProp()
	ENDIF

RETURN(LFretorno)




*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21QZ           GRExiste VALID                     
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:   21     
*        Variable:            GRExiste                           
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      19                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21qz     &&  GRExiste VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION GRExiste

	PRIVATE LCodigo

	PRIVATE LFreturn

	PRIVATE LSalias
	LSalias		= 	ALIAS()

	=GRVerifyInst()

	LCodigo    = GRGetPropVT("Codigo")


	SELE &PBGrupoAlias
	SET ORDER TO TAG codigo
	SEEK LCodigo

	
	IF FOUND()
	    LFreturn = .T.
	ELSE
	    LFreturn = .f.
	ENDIF
	*--------------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(LFreturn)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21R0           GRGetAlias VALID                   
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:   23     
*        Variable:            GRGetAlias                         
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      20                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21r0     &&  GRGetAlias VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION GRGetAlias

	=GRVerifyInst()

RETURN(PBGrupoAlias)


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21R1           GRTrtChave VALID                   
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:   24     
*        Variable:            GRTrtChave                         
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      21                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21r1     &&  GRTrtChave VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*


FUNCTION GRTrtChave
PARAMETERS PrmCodigo

	PRIVATE LFretorno
	LFretorno = .t.

	=MNVerifyInst()


	=GRVerifyInst()
    =GRSetPropVT("CODIGO",PrmCodigo)
	LFretorno=GRFind()
	*--------------------------------------------------------------*

	LFretorno=GRFind()

	SELE &PBGrupoAlias

RETURN(UPtratachv())





*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21R2           GRSetConfig VALID                  
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:   25     
*        Variable:            GRSetConfig                        
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      22                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21r2     &&  GRSetConfig VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION GRSetConfig

	*--------------------------------------------------------------*
    VCGrupo(1,1) = "REG_STATE" && INSERT/EDICAO/BROWSER/
   	VCGrupo(1,2) = ""
   	VCGrupo(1,3) = .T.
	*--------------------------------------------------------------*
    VCGrupo(2,1) = "CHV_LER" && p/ leitura do ultimo reg + 1
   	VCGrupo(2,2) = ""
   	VCGrupo(2,3) = .T.
	*--------------------------------------------------------------*
    VCGrupo(3,1) = "CHV_COMPARA" && p/ leitura do ultimo reg + 1
   	VCGrupo(3,2) = ""
   	VCGrupo(3,3) = .T.
	*--------------------------------------------------------------*
    VCGrupo(4,1) = "CHV_BROW" && p/ leitura do ultimo reg + 1
   	VCGrupo(4,2) = ""
   	VCGrupo(4,3) = .T.
	*--------------------------------------------------------------*
    VCGrupo(5,1) = "ISEDITING" && p/ leitura do ultimo reg + 1
   	VCGrupo(5,2) = .F.
   	VCGrupo(5,3) = .T.
	*--------------------------------------------------------------*
    VCGrupo(6,1) = "ISADDING" && p/ leitura do ultimo reg + 1
   	VCGrupo(6,2) = .F.
   	VCGrupo(6,3) = .T.
	*--------------------------------------------------------------*
    VCGrupo(7,1) = "ISREADING" && p/ leitura do ultimo reg + 1
   	VCGrupo(7,2) = .F.
   	VCGrupo(7,3) = .T.
	*--------------------------------------------------------------*
    VCGrupo(8,1) = "CHAVE DE LEITURA" && TAG DO CHAVE USADA EM FIND
   	VCGrupo(8,2) = "CODIGO"
   	VCGrupo(8,3) = .T.
	*--------------------------------------------------------------*
	
RETURN(.T.)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21R3           GRGetNomeFab VALID                 
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:   26     
*        Variable:            GRGetNomeFab                       
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      23                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21r3     &&  GRGetNomeFab VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION GRGetNomeFab
PARAMETERS PrmCodigo
	private Lsforn

	=GRChk_Identidade(PrmCodigo)
	Lsforn = GRGetPropVT("CODFORN")



	=W_DEFPROC("FORNECED.SPR")
	Lsforn = FRGet_NOME( Lsforn )



RETURN(Lsforn)


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21R4           GRGetCodPrdNoFab VALID             
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:   27     
*        Variable:            GRGetCodPrdNoFab                   
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      24                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21r4     &&  GRGetCodPrdNoFab VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION GRGetCodPrdNoFab
PARAMETERS PrmCodigo

	=GRChk_Identidade(PrmCodigo)

RETURN("")


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21R5           GRFaxinaDados VALID                
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:   28     
*        Variable:            GRFaxinaDados                      
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      25                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21r5     &&  GRFaxinaDados VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION GRFaxinaDados

	PRIVATE LSAlias, TOTAL, CTR
	=GRVerifyInst()

	LSAlias = GRGetAlias()
	
	SELE &LSAlias

	COUNT TO TOTAL
	CTR = 0

	GO TOP
	DO WHILE !EOF()
		=RLOCK()


		CTR = 	CTR + 1
		MSG = STR(CTR,7)+" DE "+STR(TOTAL,7)
		WAIT WINDOW MSG NOWAIT


		REPLACE DESCRICAO WITH ;
		   UPLimpaString(DESCRICAO)

		IF EMPTY(UNIDADE)
			REPLACE UNIDADE  WITH "UN"
		ENDIF
		
		SKIP
	ENDDO
	


RETURN(.t.)


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21SG           GRGerXMLProduto VALID              
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:   29     
*        Variable:            GRGerXMLProduto                    
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      26                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21sg     &&  GRGerXMLProduto VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION GRGerXMLProduto
PARAMETERS PrmEmp, PrmData, PrmClas_Inicial,PrmClas_Final

	PRIVATE LSalias
	
	PRIVATE PrmAlsEM
	PRIVATE PrmAlsGR
	PRIVATE PrmAlsTbf
	PRIVATE PrmAlsFRN
	
	PRIVATE LNrecGrupo
	PRIVATE LFTabForn

	LSalias  = ALIAS()

	LFTabForn   		= NetArq("tabforn")
	IF (LFTabForn) > 100000
        DO GRFCHGerXMLProduto
		RETURN(.f.)
	ENDIF



    SELE TABFORN

    PrmAlsTbf = Alias()

	=W_DEFPROC("FORNECED.SPR")
	PrmAlsFRN = FRGetAlias()

	=W_DEFPROC("EMPRESA.SPR")
	PrmAlsEM  = EMGetAlias()

	PrmAlsGR  = GRGetAlias()


	*-------------------------------------------------------*
	=GRModeloRefXML()
    *-------------------------------------------------------*

   	PRIVATE LSfileXML,LNroIDfileXML


   	LSfileXML	= GRNmFileXML()
   	LSfileXML	= "C:\NFE\TMP\"+LSfileXML


  	LNroIDfileXML 		=fcreate(LSfileXML)
   	if LNroIDfileXML<0
      =fclose(LNroIDfileXML)
      wait 'ERRO cria눯o arquivo tempor쟲io '+LSfileXML+'- <ENTER> ' window
        DO GRFCHGerXMLProduto
		RETURN(.f.)
   	endif


	*---------------------------------------------------*

	SELE &PrmAlsEM
	SET ORDER TO TAG EMPRESA
	SEEK PrmEmp


	SELE &PrmAlsGR

	go bott
	go top
	

	SET ORDER TO TAG CLASSIFICA
	SET NEAR ON
	SEEK PrmClas_Inicial
	SET NEAR OFF




	*----------------------------------------------------*
	DO RELINIC.PRG          && INICIA VAR P/ TERMOMETRO

	LFsegue = .t.


    IF !EOF()
		LNregistro = RECNO()

		COUNT  WHILE  &PrmAlsGR .classifica <= PrmClas_Final ;
         TO LNimpressao
		GO LNregistro
	
	ENDIF
	
	LNimpressos = 0
	*----------------------------------------------------*


	=GRInicioXML(LSfileXML,LNroIDfileXML)


	SET POINT TO ','


	SELE &PrmAlsGR
	DO WHILE !EOF() ;
			AND  &PrmAlsGR .classifica <= PrmClas_Final

		=UPtermo()

        IF &PrmAlsGR .cdg_tipo <> 4
           SKIP
           LOOP
        ENDIF

		LNrecGrupo = RECNO()



        =GRCrvUnemXML(;
         	PrmEmp,;
            PrmData,;
            LSfileXML,;
			LNroIDfileXML,;
	        PrmAlsEM,;
	        PrmAlsGR,;
	        PrmAlsFRN,;
	        PrmAlsTbF;
	        )

        =GRGrvClassifXML(;
         	PrmEmp,;
            PrmData,;
            LSfileXML,;
			LNroIDfileXML,;
	        PrmAlsEM,;
	        PrmAlsGR,;
	        PrmAlsFRN,;
	        PrmAlsTbF;
	        )

        =GRGrvProdutoXML(;
         	PrmEmp,;
            PrmData,;
            LSfileXML,;
			LNroIDfileXML,;
	        PrmAlsEM,;
	        PrmAlsGR,;
	        PrmAlsFRN,;
	        PrmAlsTbF;
	        )

        =GRGrvUnidadeXML(;
         	PrmEmp,;
            PrmData,;
            LSfileXML,;
			LNroIDfileXML,;
	        PrmAlsEM,;
	        PrmAlsGR,;
	        PrmAlsFRN,;
	        PrmAlsTbF;
	        )

        =GRGrvRgmTributarioXML(;
         	PrmEmp,;
            PrmData,;
            LSfileXML,;
			LNroIDfileXML,;
	        PrmAlsEM,;
	        PrmAlsGR,;
	        PrmAlsFRN,;
	        PrmAlsTbF;
	        )

        =GRGrvNCM_XML(;
         	PrmEmp,;
            PrmData,;
            LSfileXML,;
			LNroIDfileXML,;
	        PrmAlsEM,;
	        PrmAlsGR,;
	        PrmAlsFRN,;
	        PrmAlsTbF;
	        )

        =GRGrvLstServicoXML(;
         	PrmEmp,;
            PrmData,;
            LSfileXML,;
			LNroIDfileXML,;
	        PrmAlsEM,;
	        PrmAlsGR,;
	        PrmAlsFRN,;
	        PrmAlsTbF;
	        )

        =GRGrvInventarioXML(;
         	PrmEmp,;
            PrmData,;
            LSfileXML,;
			LNroIDfileXML,;
	        PrmAlsEM,;
	        PrmAlsGR,;
	        PrmAlsFRN,;
	        PrmAlsTbF;
	        )

        =GRGrvSaldosXML(;
         	PrmEmp,;
            PrmData,;
            LSfileXML,;
			LNroIDfileXML,;
	        PrmAlsEM,;
	        PrmAlsGR,;
	        PrmAlsFRN,;
	        PrmAlsTbF;
	        )

        =GRGrvFaricanteXML(;
         	PrmEmp,;
            PrmData,;
            LSfileXML,;
			LNroIDfileXML,;
	        PrmAlsEM,;
	        PrmAlsGR,;
	        PrmAlsFRN,;
	        PrmAlsTbF;
	        )

        =GRGrvProprietarioXML(;
         	PrmEmp,;
            PrmData,;
            LSfileXML,;
			LNroIDfileXML,;
	        PrmAlsEM,;
	        PrmAlsGR,;
	        PrmAlsFRN,;
	        PrmAlsTbF;
	        )

        =GRfecharegXML(;
         	PrmEmp,;
            PrmData,;
            LSfileXML,;
			LNroIDfileXML,;
	        PrmAlsEM,;
	        PrmAlsGR,;
	        PrmAlsFRN,;
	        PrmAlsTbF;
	        )

		SELE &PrmAlsGR
		SET ORDER TO TAG classifica

		GO LNrecGrupo
		SKIP
	ENDDO

	=GRFinalXML(LSfileXML,LNroIDfileXML)


	SET POINT TO

	DO RELFIM.PRG          && FIM VAR P/ TERMOMETRO
	*-----------------------------------------------*
    =fclose(LNroIDfileXML)

    DO GRFCHGerXMLProduto
	
RETURN(.T.)

PROCEDURE GRFCHGerXMLProduto
	    =UP_fecha("tabforn" ,LFTabForn)
	    IF !EMPTY(LSalias) AND USED(LSalias)
		  SELECT &LSalias
	    ENDIF
RETURN


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21SH           GRNmFileXML VALID                  
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:   30     
*        Variable:            GRNmFileXML                        
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      27                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21sh     &&  GRNmFileXML VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION GRNmFileXML

	*-------------------------------------------------------*

   	PRIVATE LSfileXML, LNroIDfileXML, LSnomeArqXml
	
	*----------------------------------------------------------*



	LSnomeArqXml = "XMLPRDT"
	LSnomeArqXml = CHRTRAN(LSnomeArqXml," ","0")


   	LSfileXML	= LSnomeArqXml+".XML"
	
RETURN(LSfileXML)


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21SI           GRInicioXML VALID                  
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:   31     
*        Variable:            GRInicioXML                        
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      28                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21si     &&  GRInicioXML VALID
#REGION 1
RETURN

FUNCTION GRInicioXML
PARAMETERS 	PrmFileXML,;
			PrmNroIDfileXML



   	PRIVATE lErro
   	PRIVATE LSLinhaXML

	*-------------------------------------------------------*

	SELE 0
	USE  \scgc\comum\xmlPRDT
	SET ORDER TO TAG XML_ORDEM
	GO TOP
	
	DO WHILE !EOF() AND xmlPRDT.XML_ORDEM < 9999999999901
	
		LSLinhaXML = xmlPRDT.XML_LINHA
		=fPuts(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
		SKIP
	ENDDO
	SELE xmlPRDT
	USE
		

RETURN


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21SJ           GRFinalXML VALID                   
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:   32     
*        Variable:            GRFinalXML                         
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      29                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _4is0l21sj     &&  GRFinalXML VALID
#REGION 1
RETURN

FUNCTION GRFinalXML
PARAMETERS 	PrmFileXML,;
			PrmNroIDfileXML


	*-------------------------------------------------------*

   	PRIVATE lErro
   	PRIVATE LSLinhaXML

	*-------------------------------------------------------*

	SELE 0
	USE  \scgc\comum\xmlPRDT
	SET ORDER TO TAG XML_ORDEM
	GO TOP
	
	DO WHILE !EOF()
	    IF xmlPRDT.XML_ORDEM > 9999999999900
			LSLinhaXML = xmlPRDT.XML_LINHA
			=fPuts(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
		ENDIF
		SKIP
	ENDDO
	SELE xmlPRDT
	USE
		

RETURN


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21SK           GRModeloRefXML VALID               
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:   33     
*        Variable:            GRModeloRefXML                     
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      30                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21sk     &&  GRModeloRefXML VALID
#REGION 1
RETURN

FUNCTION GRModeloRefXML


	PRIVATE LSFDocXML
	
	LSFDocXML = "\scgc\loja\automatc\xmlPRDT.XML"
	IF !FILE(LSFDocXML)
		RETURN(.T.)
	ENDIF


	SELE 0
	USE  \scgc\comum\xmlPRDT EXCL
	ZAP
	PACK

	*------------------------------------------------------------*
	* ESTE COMANDO SERVA PARA ELIMINAR CARACTERES INDESEJADOS
	* DO CABECALHO XML
	*-----------------------------------------------------------*
	SELE xmlPRDT


	APPEND FROM &LSFDocXML TYPE SDF


	
	REPLACE ALL XML_LINHA WITH chrtran(XML_LINHA,chr(9),chr(32))
	REPLACE ALL XML_ORDEM WITH RECNO()
	GO BOTT
	SKIP -1
	REPLACE XML_ORDEM WITH 9999999999901
	SKIP	
	REPLACE XML_ORDEM WITH 9999999999902
	USE

	IF FILE(LSFDocXML)
		DELETE FILE &LSFDocXML
	ENDIF

RETURN


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21SL           GRFind VALID                       
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:   34     
*        Variable:            GRFind                             
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      31                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21sl     &&  GRFind VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION GRFind
	PRIVATE LCodigo
	PRIVATE LClassifica
	PRIVATE LFreturn
	PRIVATE LSchaveAcesso

	PRIVATE LSalias
	LSalias		= 	ALIAS()

	=GRVerifyInst()

	SELE &PBGrupoAlias
	LSchaveAcesso  =GRGetPropVT("CHAVE DE LEITURA")

	DO CASE
		CASE UPPER(LSchaveAcesso) = "CLASSIFICA"
			LClassifica    = GRGetPropVT("CLASSIFICA")
			SET ORDER TO TAG CLASSIFICA
			SEEK LClassifica
		OTHERWISE
			LCodigo     = GRGetPropVT("CODIGO")
			SET ORDER TO TAG CODIGO
			SEEK LCodigo

	ENDCASE


	IF FOUND()
		=GRReadProperty()
		=GRSetDerivadas()   && carga dos calculos derivados
	    LFreturn = .T.
	ELSE

	    LFreturn = .f.
	ENDIF
	*--------------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(LFreturn)




*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21SM           antGRChk_Identidade VALID          
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:   35     
*        Variable:            antGRChk_Identidade                
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      32                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21sm     &&  antGRChk_Identidade VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION antGRChk_Identidade
PARAMETERS PrmCodigo

	PRIVATE LFretorno
	LFretorno = .t.


	=GRVerifyInst()
    =GRSetPropVT("CODIGO",PrmCodigo)
	LFretorno=GRFind()

RETURN(LFretorno)






*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21SQ           GRLerRegistro VALID                
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:   36     
*        Variable:            GRLerRegistro                      
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      33                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21sq     &&  GRLerRegistro VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION GRLerRegistro
PARAMETERS  PrmCodigo,Prmclassifica

    *----------------------------------------------------------------
    ** pode ser informado um ou outro parametro
    ** se forem os dois sera priorizado a leitura pela classificacao
    *----------------------------------------------------------------
	PRIVATE LFretorno

    *----------------------------------------------------------------
    *** estava retornando automatico ate 28/10/11	LFretorno = .t.
    *----------------------------------------------------------------

	LFretorno = GRChk_Identidade(PrmCodigo,Prmclassifica)

RETURN(LFretorno)




*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21SW           GRCrvUnemXML VALID                 
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:   38     
*        Variable:            GRCrvUnemXML                       
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      34                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21sw     &&  GRCrvUnemXML VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*



FUNCTION GRCrvUnemXML
PARAMETERS 	PrmEmp,;
            PrmData,;
            PrmFileXML,;
			PrmNroIDfileXML,;
	        PrmAlsEM,;
	        PrmAlsGR,;
	        PrmAlsFR,;
	        PrmAlsTbF
	        	


			

	PRIVATE AlsANT       && Alias Anterior
	PRIVATE LSAlsEMP     && Empresa
	PRIVATE LSAlsGRP     && Grupo
	PRIVATE LSAlsFRN     && Fornecedor
	PRIVATE LSAlsTBF     && Tabela Fornecedor
	

	AlsANT = ALIAS()

	SELE &PrmAlsEM
	LSAlsEMP = alias()


	SELE &PrmAlsTbF
	LSAlsTBF = alias()


	SELE &PrmAlsFR
	LSAlsFRN = alias()

	SELE &PrmAlsGR
	LSAlsGRP = alias()


	*-------------------------------------------------------*

   	PRIVATE lErro
   	PRIVATE LSLinhaXML


	*-----  IDENTIFICACAO DO CONTRIBUINTE  -----------------------*
	SET POINT TO ","
	SET SEPARATOR  TO "."
	

	LSLinhaXML  = chrtran(STR( &LSAlsEmp .CGC ,14), " ","0")
	LSLinhaXML  = GRtratalinha('<ROW UNEM_CNPJ="'+LSLinhaXML+'"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

	LFieldTmp   =  &LSAlsEmp .INSCRICAO
	LSLinhaXML  = GRtratalinha('UNEM_IE="'+LFieldTmp+'"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*

	SET POINT TO
	SET SEPARATOR  TO


RETURN(.t.)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21T5           GRGrvClassifXML VALID              
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:   39     
*        Variable:            GRGrvClassifXML                    
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      35                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21t5     &&  GRGrvClassifXML VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*



FUNCTION GRGrvClassifXML
PARAMETERS 	PrmEmp,;
            PrmData,;
            PrmFileXML,;
			PrmNroIDfileXML,;
	        PrmAlsEM,;
	        PrmAlsGR,;
	        PrmAlsFR,;
	        PrmAlsTbF
	        	


			

	PRIVATE AlsANT       && Alias Anterior
	PRIVATE LSAlsEMP     && Empresa
	PRIVATE LSAlsGRP     && Grupo
	PRIVATE LSAlsFRN     && Fornecedor
	PRIVATE LSAlsTBF     && Tabela Fornecedor
	

	AlsANT = ALIAS()

	SELE &PrmAlsEM
	LSAlsEMP = alias()


	SELE &PrmAlsTbF
	LSAlsTBF = alias()


	SELE &PrmAlsFR
	LSAlsFRN = alias()

	SELE &PrmAlsGR
	LSAlsGRP = alias()


	*-------------------------------------------------------*

   	PRIVATE lErro
   	PRIVATE LSLinhaXML


	*-----  IDENTIFICACAO DO CONTRIBUINTE  -----------------------*
	SET POINT TO ","
	SET SEPARATOR  TO "."
	

	LSLinhaXML  = "SIM"
	LSLinhaXML  = ;
	   GRtratalinha('BLOCO_CLASSIFICA_INFORMA_DADOS="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*

	LSLinhaXML  = ""

    DO CASE
       CASE &LSAlsGRP .cdg_tipo = 2
   	        LSLinhaXML  = ALLTRIM( LEFT( &LSAlsGRP .classifica,2) )
       CASE &LSAlsGRP .cdg_tipo = 3
   	        LSLinhaXML  = ALLTRIM( LEFT( &LSAlsGRP .classifica,5) )
       CASE &LSAlsGRP .cdg_tipo = 4
   	        LSLinhaXML  = ALLTRIM( LEFT( &LSAlsGRP .classifica,8) )

	ENDCASE

	LSLinhaXML  = GRtratalinha('CLSF_CLASSIFICACAO_PAI="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*
	LSLinhaXML  = ALLTRIM( &LSAlsGRP .classifica )
	LSLinhaXML  = GRtratalinha('CLSF_CLASSIFICACAO="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*
	LSLinhaXML  =  &LSAlsGRP .DESCRICAO
	
	LSLinhaXML  =  GRLimpaString(LSLinhaXML)
	
	LSLinhaXML  = GRtratalinha('CLSF_DESCRICAO="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))


	*----------------------------------------------------------*

    IF &LSAlsGRP .cdg_tipo < 4
		LSLinhaXML  = "SINTETICA"
	ELSE
		LSLinhaXML  = "ANALITICA"
	ENDIF
	LSLinhaXML  = GRtratalinha('CLSF_TIPO="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*
	LSLinhaXML  = chrtran(STR(  &LSAlsGRP .cdg_tipo ,1), " ","0")
	LSLinhaXML  = GRtratalinha('CLSF_NIVEL="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*


	SET POINT TO
	SET SEPARATOR  TO


RETURN(.t.)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21TG           GRGrvProdutoXML VALID              
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:   40     
*        Variable:            GRGrvProdutoXML                    
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      36                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21tg     &&  GRGrvProdutoXML VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*



FUNCTION GRGrvProdutoXML
PARAMETERS 	PrmEmp,;
            PrmData,;
            PrmFileXML,;
			PrmNroIDfileXML,;
	        PrmAlsEM,;
	        PrmAlsGR,;
	        PrmAlsFR,;
	        PrmAlsTbF
	        	


			

	PRIVATE AlsANT       && Alias Anterior
	PRIVATE LSAlsEMP     && Empresa
	PRIVATE LSAlsGRP     && Grupo
	PRIVATE LSAlsFRN     && Fornecedor
	PRIVATE LSAlsTBF     && Tabela Fornecedor
	

	AlsANT = ALIAS()

	SELE &PrmAlsEM
	LSAlsEMP = alias()


	SELE &PrmAlsTbF
	LSAlsTBF = alias()


	SELE &PrmAlsFR
	LSAlsFRN = alias()

	SELE &PrmAlsGR
	LSAlsGRP = alias()



	*-------------------------------------------------------*

   	PRIVATE lErro
   	PRIVATE LSLinhaXML


	*-----  IDENTIFICACAO DO CONTRIBUINTE  -----------------------*
	SET POINT TO ","
	SET SEPARATOR  TO "."
	

	LSLinhaXML  = "SIM"
	LSLinhaXML  = ;
	   GRtratalinha('BLOCO_PRODUTO_INFORMA_DADOS="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*
	LSLinhaXML  = ALLTRIM( &LSAlsGRP .codigo )
	LSLinhaXML  = GRtratalinha('PRDT_CODIGO="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*
	LSLinhaXML  = ALLTRIM( &LSAlsGRP .descricao )
	LSLinhaXML  = GRtratalinha('PRDT_DESCRICAO="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*
	LSLinhaXML  = ALLTRIM( &LSAlsGRP .codigo )
	LSLinhaXML  = GRtratalinha('PRDT_CODIGO_UNIFICADO="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*

	SELE &LSAlsTbF
	SET ORDER TO TAG TABELA
	SEEK STR( &LSAlsGRP .CODFORN,5)+ &LSAlsGRP .codigo
    IF FOUND()
 	     LSLinhaXML  = ALLTRIM( &LSAlsTbF .CDGPRDFORN )
 	ELSE
 	     LSLinhaXML  = ""
 	ENDIF
 	
	LSLinhaXML  = ;
	    GRtratalinha('PRDT_CODIGO_NO_FABRICANTE="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*
	LSLinhaXML  = ""
	LSLinhaXML  = ;
	   GRtratalinha('PRDT_CODIGO_COMBUSTIVEL="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*
	LSLinhaXML  = ""
	LSLinhaXML  = ;
	   GRtratalinha('PRDT_CARACTERISTICAS="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*
	LSLinhaXML  = ""
	LSLinhaXML  = ;
	   GRtratalinha('PRDT_DT_DESC_ATUAL="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*

    IF &LSAlsGRP .flg_descri = "S"
		LSLinhaXML  = "SIM"
	ELSE
		LSLinhaXML  = "NAO"
	ENDIF
	LSLinhaXML  = ;
	   GRtratalinha('PRDT_USAR_DESC_COMPLEMENTAR="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*
    DO CASE
       CASE &LSAlsGRP .tp_control = 1  && MERCADORIA COMERCIAL
          LSLinhaXML  = "00"  && 00 MERCADORIA PARA REVENDA
       CASE &LSAlsGRP .tp_control = 2  && SERVICO
          LSLinhaXML  = "09"  && 09 SERVICOS
       CASE &LSAlsGRP .tp_control = 3  && MAT CONSUMO / USO EM SERVICO
          LSLinhaXML  = "07" && 07 MATERIAL DE USO E CONSUMO
       CASE &LSAlsGRP .tp_control = 4  && MATERIA PRIMA
          LSLinhaXML  = "01" && 01 MATERIA-PRIMA
       CASE &LSAlsGRP .tp_control = 5  && MATERIAL EXPEDIENTE
          LSLinhaXML  = "07" && 07 MATERIAL DE USO E CONSUMO
       CASE &LSAlsGRP .tp_control = 6  && MERCADORIA DE CLIENTE
          LSLinhaXML  = "00"  && 00 MERCADORIA PARA REVENDA
       CASE &LSAlsGRP .tp_control = 7  && PATRIMONIAL
          LSLinhaXML  = "08"  && 08 ATIVO IMOBILIZADO
       CASE &LSAlsGRP .tp_control = 9  && SEM CONTROLE
          LSLinhaXML  = "09"  && 09 SERVICOS
    ENDCASE

	LSLinhaXML  = ;
	   GRtratalinha('PRDT_TIPO_ITEM_CODIGO="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*
    DO CASE
       CASE &LSAlsGRP .tp_control = 1  && MERCADORIA COMERCIAL
          LSLinhaXML  = "MERCADORIA PARA REVENDA"
       CASE &LSAlsGRP .tp_control = 2  && SERVICO
          LSLinhaXML  = "SERVICOS"
       CASE &LSAlsGRP .tp_control = 3  && MAT CONSUMO / USO EM SERVICO
          LSLinhaXML  = "MATERIAL DE USO E CONSUMO"
       CASE &LSAlsGRP .tp_control = 4  && MATERIA PRIMA
          LSLinhaXML  = "MATERIA-PRIMA"
       CASE &LSAlsGRP .tp_control = 5  && MATERIAL EXPEDIENTE
          LSLinhaXML  = "MATERIAL DE USO E CONSUMO"
       CASE &LSAlsGRP .tp_control = 6  && MERCADORIA DE CLIENTE
          LSLinhaXML  = "MERCADORIA PARA REVENDA"
       CASE &LSAlsGRP .tp_control = 7  && PATRIMONIAL
          LSLinhaXML  = "ATIVO IMOBILIZADO"
       CASE &LSAlsGRP .tp_control = 9  && SEM CONTROLE
          LSLinhaXML  = "SERVICOS"
    ENDCASE

	LSLinhaXML  = ;
	   GRtratalinha('PRDT_TIPO_ITEM_DESCRICAO="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*

    DO CASE
       CASE &LSAlsGRP .tp_control = 1  && MERCADORIA COMERCIAL
          LSLinhaXML  = "COMERCIALIZACAO"
       CASE &LSAlsGRP .tp_control = 2  && SERVICO
          LSLinhaXML  = "COMERCIALIZACAO"
       CASE &LSAlsGRP .tp_control = 3  && MAT CONSUMO / USO EM SERVICO
          LSLinhaXML  = "USO EM SERVICO"
       CASE &LSAlsGRP .tp_control = 4  && MATERIA PRIMA
          LSLinhaXML  = "USO EM SERVICO"
       CASE &LSAlsGRP .tp_control = 5  && MATERIAL EXPEDIENTE
          LSLinhaXML  = "CONSUMO"
       CASE &LSAlsGRP .tp_control = 6  && MERCADORIA DE CLIENTE
          LSLinhaXML  = "COMERCIALIZACAO"
       CASE &LSAlsGRP .tp_control = 7  && PATRIMONIAL
          LSLinhaXML  = "ATIVO IMOBILIZADO"
       CASE &LSAlsGRP .tp_control = 9  && SEM CONTROLE
          LSLinhaXML  = "CONSUMO"
    ENDCASE

	LSLinhaXML  = ;
	   GRtratalinha('PRDT_NATUREZA_COMERCIAL="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*
    DO CASE
       CASE &LSAlsGRP .tp_control = 1  && MERCADORIA COMERCIAL
          LSLinhaXML  = "MERCADORIAS"
       CASE &LSAlsGRP .tp_control = 2  && SERVICO
          LSLinhaXML  = "SERVICOS"
       CASE &LSAlsGRP .tp_control = 3  && MAT CONSUMO / USO EM SERVICO
          LSLinhaXML  = "USO OU CONSUMO"
       OTHERWISE
          LSLinhaXML  = "MERCADORIAS"
    ENDCASE




	LSLinhaXML  = ;
	   GRtratalinha('PRDT_NATUREZA_ECONOMICA="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*


    LSLinhaXML  = "NAO"
	LSLinhaXML  = ;
	   GRtratalinha('PRDT_CONTROLE_POR_LOTE="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*
    LSLinhaXML  = ""
	LSLinhaXML  = ;
	   GRtratalinha('PRDT_NRO_SERIE="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*
    LSLinhaXML  = "1"
	LSLinhaXML  = ;
	   GRtratalinha('PRDT_IND_MED_BC_ICMS="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*
    LSLinhaXML  = "2"
	LSLinhaXML  = ;
	   GRtratalinha('PRDT_IND_TIPO_PRODUTO="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*
    LSLinhaXML  = "0"
	LSLinhaXML  = ;
	   GRtratalinha('PRDT_IND_USO_ARMA="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*
	LSLinhaXML  = ALLTRIM( &LSAlsGRP .EX_TIPI )
	LSLinhaXML  = ;
	   GRtratalinha('PRDT_EX_IPI="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*
	LSLinhaXML  = ALLTRIM( &LSAlsGRP .COD_GTIM )
	LSLinhaXML  = ;
	   GRtratalinha('PRDT_CODIGO_BARRA_GTIN="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*
	LSLinhaXML  = "A"
	LSLinhaXML  = ;
	   GRtratalinha('PRDT_IAT="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*
	LSLinhaXML  = "0"
	LSLinhaXML  = ;
	   GRtratalinha('PRDT_PROPRIEDADE="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*
	LSLinhaXML  = "T"
	LSLinhaXML  = ;
	   GRtratalinha('PRDT_IPPT="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*
	LSLinhaXML  = "ATIVO"
	LSLinhaXML  = ;
	   GRtratalinha('PRDT_SITUACAO="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*
	LSLinhaXML  = ""
	LSLinhaXML  = ;
	   GRtratalinha('PRDT_MARCA="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*
	LSLinhaXML  = chrtran(STR(  &LSAlsGRP .ORIGEM ,1), " ","0")
	LSLinhaXML  = ;
	   GRtratalinha('PRDT_ORIGEM="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*
	LSLinhaXML  = chrtran(STR(  &LSAlsGRP .PESO ,15,3), " ","0")
	LSLinhaXML  = ;
	   GRtratalinha('PRDT_PESO="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*
    IF  &LSAlsGRP .tp_control = 2  && SERVICO
          LSLinhaXML  = "NAO"
	ELSE
          LSLinhaXML  = "SIM"
	ENDIF
	LSLinhaXML  = ;
	   GRtratalinha('PRDT_MOVIMENTA_ESTOQUE="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*
    IF  &LSAlsGRP .tp_control = 2  && SERVICO
          LSLinhaXML  = "SIM"
	ELSE
          LSLinhaXML  = "NAO"
	ENDIF
	LSLinhaXML  = ;
	   GRtratalinha('PRDT_ACEITA_SALDO_NEGATIVO="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*
    LSLinhaXML  = ""
	LSLinhaXML  = ;
	   GRtratalinha('PRDT_CONTA_CONTABIL="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*
    LSLinhaXML  = ""
	LSLinhaXML  = ;
	   GRtratalinha('PRDT_CLAS_SELO_CONTROLE="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*
    LSLinhaXML  = ""
	LSLinhaXML  = ;
	   GRtratalinha('PRDT_CLAS_ENQUADRAMENTO_IPI="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*
    LSLinhaXML  = "60"
	LSLinhaXML  = ;
	   GRtratalinha('PRDT_CLAS_CONS_ENERGIA_ELETR="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*
    LSLinhaXML  = "00"
	LSLinhaXML  = ;
	   GRtratalinha('PRDT_CLAS_CONS_GAS="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*
    LSLinhaXML  = "00"
	LSLinhaXML  = ;
	   GRtratalinha('PRDT_CLAS_CONS_SERV_TELECOM="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*
    LSLinhaXML  = "00"
	LSLinhaXML  = ;
	   GRtratalinha('PRDT_CLAS_CONS_AGUA="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*
	*----------------------------------------------------------*
	LSLinhaXML  = ALLTRIM( &LSAlsGRP .COD_LSTSRV )
	LSLinhaXML  = ;
	   GRtratalinha('PRDT_CLAS_LISTA_SERVICO="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*
	LSLinhaXML  = ALLTRIM( &LSAlsGRP .COD_LSTSRV )
	LSLinhaXML  = ;
	   GRtratalinha('PRDT_CLAS_ITENS_ENRG_COMNC_TELC="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*













	SET POINT TO
	SET SEPARATOR  TO


RETURN(.t.)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21U4           GRGrvInventarioXML VALID           
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:   41     
*        Variable:            GRGrvInventarioXML                 
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      37                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21u4     &&  GRGrvInventarioXML VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*



FUNCTION GRGrvInventarioXML
PARAMETERS 	PrmEmp,;
            PrmData,;
            PrmFileXML,;
			PrmNroIDfileXML,;
	        PrmAlsEM,;
	        PrmAlsGR,;
	        PrmAlsFR,;
	        PrmAlsTbF
	        	


			

	PRIVATE AlsANT       && Alias Anterior
	PRIVATE LSAlsEMP     && Empresa
	PRIVATE LSAlsGRP     && Grupo
	PRIVATE LSAlsFRN     && Fornecedor
	PRIVATE LSAlsTBF     && Tabela Fornecedor
	

	AlsANT = ALIAS()

	SELE &PrmAlsEM
	LSAlsEMP = alias()


	SELE &PrmAlsTbF
	LSAlsTBF = alias()


	SELE &PrmAlsFR
	LSAlsFRN = alias()

	SELE &PrmAlsGR
	LSAlsGRP = alias()



	*-------------------------------------------------------*

   	PRIVATE lErro
   	PRIVATE LSLinhaXML


	*-----  IDENTIFICACAO DO CONTRIBUINTE  -----------------------*
	SET POINT TO ","
	SET SEPARATOR  TO "."
	

	LSLinhaXML  = "NAO"
	LSLinhaXML  = ;
	  GRtratalinha('BLOCO_INVENTARIO_INFORMA_DADOS="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*
	LSLinhaXML  = DTOS(PrmData)
	LSLinhaXML  = ;
	   GRtratalinha('INVT_DATA="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*


   =W_DEFPROC("ITEMMOV.SPR")
	LFieldTmp    =  IMGetSaldo(PrmEmp, &LSAlsGRP .codigo ,PrmData  )

    LNsaldo      = LFieldTmp


	LSLinhaXML  = chrtran(STR(  LFieldTmp ,15,3), " ","0")
	LSLinhaXML  = ;
	   GRtratalinha('INVT_QTDE="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*

   =W_DEFPROC("ITEMMOV.SPR")
	LFieldTmp    =  IMGetVlrEstq(PrmEmp, &LSAlsGRP .codigo ,PrmData  )

    LNvlrEstq    = LFieldTmp


	LSLinhaXML  = chrtran(STR(  LFieldTmp ,15,3), " ","0")
	LSLinhaXML  = ;
	   GRtratalinha('INVT_VLR="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*
    IF LNsaldo <=0
       LFieldTmp = 0
    ELSE
       LFieldTmp = LNvlrEstq / LNsaldo
    ENDIF

	LSLinhaXML  = chrtran(STR(  LFieldTmp ,15,3), " ","0")
	LSLinhaXML  = ;
	   GRtratalinha('INVT_VLR_UNITARIO="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*





	SET POINT TO
	SET SEPARATOR  TO


RETURN(.t.)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21UG           GRGrvFaricanteXML VALID            
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:   42     
*        Variable:            GRGrvFaricanteXML                  
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      38                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21ug     &&  GRGrvFaricanteXML VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*



FUNCTION GRGrvFaricanteXML
PARAMETERS 	PrmEmp,;
            PrmData,;
            PrmFileXML,;
			PrmNroIDfileXML,;
	        PrmAlsEM,;
	        PrmAlsGR,;
	        PrmAlsFR,;
	        PrmAlsTbF
	        	


			

	PRIVATE AlsANT       && Alias Anterior
	PRIVATE LSAlsEMP     && Empresa
	PRIVATE LSAlsGRP     && Grupo
	PRIVATE LSAlsFRN     && Fornecedor
	PRIVATE LSAlsTBF     && Tabela Fornecedor
	

	AlsANT = ALIAS()

	SELE &PrmAlsEM
	LSAlsEMP = alias()


	SELE &PrmAlsTbF
	LSAlsTBF = alias()


	SELE &PrmAlsFR
	LSAlsFRN = alias()

	SELE &PrmAlsGR
	LSAlsGRP = alias()



	*-------------------------------------------------------*

   	PRIVATE lErro
   	PRIVATE LSLinhaXML


	*-----  IDENTIFICACAO DO CONTRIBUINTE  -----------------------*
	SET POINT TO ","
	SET SEPARATOR  TO "."
	




	SET POINT TO
	SET SEPARATOR  TO


RETURN(.t.)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21UP           GRGrvProprietarioXML VALID         
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:   43     
*        Variable:            GRGrvProprietarioXML               
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      39                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21up     &&  GRGrvProprietarioXML VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*



FUNCTION GRGrvProprietarioXML
PARAMETERS 	PrmEmp,;
            PrmData,;
            PrmFileXML,;
			PrmNroIDfileXML,;
	        PrmAlsEM,;
	        PrmAlsGR,;
	        PrmAlsFR,;
	        PrmAlsTbF
	        	


			

	PRIVATE AlsANT       && Alias Anterior
	PRIVATE LSAlsEMP     && Empresa
	PRIVATE LSAlsGRP     && Grupo
	PRIVATE LSAlsFRN     && Fornecedor
	PRIVATE LSAlsTBF     && Tabela Fornecedor
	

	AlsANT = ALIAS()

	SELE &PrmAlsEM
	LSAlsEMP = alias()


	SELE &PrmAlsTbF
	LSAlsTBF = alias()


	SELE &PrmAlsFR
	LSAlsFRN = alias()

	SELE &PrmAlsGR
	LSAlsGRP = alias()



	*-------------------------------------------------------*

   	PRIVATE lErro
   	PRIVATE LSLinhaXML


	*-----  IDENTIFICACAO DO CONTRIBUINTE  -----------------------*
	SET POINT TO ","
	SET SEPARATOR  TO "."
	




	SET POINT TO
	SET SEPARATOR  TO


RETURN(.t.)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21UX           GRGrvSaldosXML VALID               
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:   44     
*        Variable:            GRGrvSaldosXML                     
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      40                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21ux     &&  GRGrvSaldosXML VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*



FUNCTION GRGrvSaldosXML
PARAMETERS 	PrmEmp,;
            PrmData,;
            PrmFileXML,;
			PrmNroIDfileXML,;
	        PrmAlsEM,;
	        PrmAlsGR,;
	        PrmAlsFR,;
	        PrmAlsTbF
	        	


			

	PRIVATE AlsANT       && Alias Anterior
	PRIVATE LSAlsEMP     && Empresa
	PRIVATE LSAlsGRP     && Grupo
	PRIVATE LSAlsFRN     && Fornecedor
	PRIVATE LSAlsTBF     && Tabela Fornecedor
	

	AlsANT = ALIAS()

	SELE &PrmAlsEM
	LSAlsEMP = alias()


	SELE &PrmAlsTbF
	LSAlsTBF = alias()


	SELE &PrmAlsFR
	LSAlsFRN = alias()

	SELE &PrmAlsGR
	LSAlsGRP = alias()



	*-------------------------------------------------------*

   	PRIVATE lErro
   	PRIVATE LSLinhaXML


	*-----  IDENTIFICACAO DO CONTRIBUINTE  -----------------------*
	SET POINT TO ","
	SET SEPARATOR  TO "."
	




	SET POINT TO
	SET SEPARATOR  TO


RETURN(.t.)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21V6           GRGrvUnidadeXML VALID              
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:   45     
*        Variable:            GRGrvUnidadeXML                    
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      41                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21v6     &&  GRGrvUnidadeXML VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*



FUNCTION GRGrvUnidadeXML
PARAMETERS 	PrmEmp,;
            PrmData,;
            PrmFileXML,;
			PrmNroIDfileXML,;
	        PrmAlsEM,;
	        PrmAlsGR,;
	        PrmAlsFR,;
	        PrmAlsTbF
	        	


			

	PRIVATE AlsANT       && Alias Anterior
	PRIVATE LSAlsEMP     && Empresa
	PRIVATE LSAlsGRP     && Grupo
	PRIVATE LSAlsFRN     && Fornecedor
	PRIVATE LSAlsTBF     && Tabela Fornecedor
	

	AlsANT = ALIAS()

	SELE &PrmAlsEM
	LSAlsEMP = alias()


	SELE &PrmAlsTbF
	LSAlsTBF = alias()


	SELE &PrmAlsFR
	LSAlsFRN = alias()

	SELE &PrmAlsGR
	LSAlsGRP = alias()



	*-------------------------------------------------------*

   	PRIVATE lErro
   	PRIVATE LSLinhaXML


	*-----  IDENTIFICACAO DO CONTRIBUINTE  -----------------------*
	SET POINT TO ","
	SET SEPARATOR  TO "."
	




	LSLinhaXML  = ALLTRIM( &LSAlsGRP .UNIDADE )
	LSLinhaXML  = ;
	   GRtratalinha('UNID_UNIDADE="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*
	LSLinhaXML  = ALLTRIM( &LSAlsGRP .UNIDADE )
	LSLinhaXML  = ;
	   GRtratalinha('UNID_NOME="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*





	SET POINT TO
	SET SEPARATOR  TO


RETURN(.t.)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21VG           GRGrvRgmTributarioXML VALID        
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:   46     
*        Variable:            GRGrvRgmTributarioXML              
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      42                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21vg     &&  GRGrvRgmTributarioXML VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*



FUNCTION GRGrvRgmTributarioXML
PARAMETERS 	PrmEmp,;
            PrmData,;
            PrmFileXML,;
			PrmNroIDfileXML,;
	        PrmAlsEM,;
	        PrmAlsGR,;
	        PrmAlsFR,;
	        PrmAlsTbF
	        	


			

	PRIVATE AlsANT       && Alias Anterior
	PRIVATE LSAlsEMP     && Empresa
	PRIVATE LSAlsGRP     && Grupo
	PRIVATE LSAlsFRN     && Fornecedor
	PRIVATE LSAlsTBF     && Tabela Fornecedor
	

	AlsANT = ALIAS()

	SELE &PrmAlsEM
	LSAlsEMP = alias()


	SELE &PrmAlsTbF
	LSAlsTBF = alias()


	SELE &PrmAlsFR
	LSAlsFRN = alias()

	SELE &PrmAlsGR
	LSAlsGRP = alias()



	*-------------------------------------------------------*

   	PRIVATE lErro
   	PRIVATE LSLinhaXML


	*-----  IDENTIFICACAO DO CONTRIBUINTE  -----------------------*
	SET POINT TO ","
	SET SEPARATOR  TO "."
	



	LSLinhaXML  = ""
	LSLinhaXML  = ;
	   GRtratalinha('RGTR_UF="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*
	LSLinhaXML  = ""
	LSLinhaXML  = ;
	   GRtratalinha('RGTR_REGIME_FISCAL_TRIBUTARIO="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*




	SET POINT TO
	SET SEPARATOR  TO


RETURN(.t.)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21VQ           GRGrvNCM_XML VALID                 
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:   47     
*        Variable:            GRGrvNCM_XML                       
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      43                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21vq     &&  GRGrvNCM_XML VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*



FUNCTION GRGrvNCM_XML
PARAMETERS 	PrmEmp,;
            PrmData,;
            PrmFileXML,;
			PrmNroIDfileXML,;
	        PrmAlsEM,;
	        PrmAlsGR,;
	        PrmAlsFR,;
	        PrmAlsTbF
	        	


			

	PRIVATE AlsANT       && Alias Anterior
	PRIVATE LSAlsEMP     && Empresa
	PRIVATE LSAlsGRP     && Grupo
	PRIVATE LSAlsFRN     && Fornecedor
	PRIVATE LSAlsTBF     && Tabela Fornecedor
	

	AlsANT = ALIAS()

	SELE &PrmAlsEM
	LSAlsEMP = alias()


	SELE &PrmAlsTbF
	LSAlsTBF = alias()


	SELE &PrmAlsFR
	LSAlsFRN = alias()

	SELE &PrmAlsGR
	LSAlsGRP = alias()



	*-------------------------------------------------------*

   	PRIVATE lErro
   	PRIVATE LSLinhaXML


	*-----  IDENTIFICACAO DO CONTRIBUINTE  -----------------------*
	SET POINT TO ","
	SET SEPARATOR  TO "."
	




	LSLinhaXML  = "SIM"
	LSLinhaXML  = ;
	   GRtratalinha('BLOCO_NCMS_INFORMA_DADOS="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*
	LSLinhaXML  = ALLTRIM( &LSAlsGRP .COD_NCM )
	LSLinhaXML  = ;
	   GRtratalinha('NCMS_CODIGO="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*
	LSLinhaXML  = LEFT( &LSAlsGRP .COD_NCM,2 )
	LSLinhaXML  = ;
	   GRtratalinha('NCMS_GENERO="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*
	LSLinhaXML  = ""
	LSLinhaXML  = ;
	   GRtratalinha('NCMS_DESCRICAO="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*





	SET POINT TO
	SET SEPARATOR  TO


RETURN(.t.)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21VZ           GRGrvLstServicoXML VALID           
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:   48     
*        Variable:            GRGrvLstServicoXML                 
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      44                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21vz     &&  GRGrvLstServicoXML VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*



FUNCTION GRGrvLstServicoXML
PARAMETERS 	PrmEmp,;
            PrmData,;
            PrmFileXML,;
			PrmNroIDfileXML,;
	        PrmAlsEM,;
	        PrmAlsGR,;
	        PrmAlsFR,;
	        PrmAlsTbF
	        	


			

	PRIVATE AlsANT       && Alias Anterior
	PRIVATE LSAlsEMP     && Empresa
	PRIVATE LSAlsGRP     && Grupo
	PRIVATE LSAlsFRN     && Fornecedor
	PRIVATE LSAlsTBF     && Tabela Fornecedor
	

	AlsANT = ALIAS()

	SELE &PrmAlsEM
	LSAlsEMP = alias()


	SELE &PrmAlsTbF
	LSAlsTBF = alias()


	SELE &PrmAlsFR
	LSAlsFRN = alias()

	SELE &PrmAlsGR
	LSAlsGRP = alias()


	*-------------------------------------------------------*

   	PRIVATE lErro
   	PRIVATE LSLinhaXML


	*-----  IDENTIFICACAO DO CONTRIBUINTE  -----------------------*
	SET POINT TO ","
	SET SEPARATOR  TO "."


	=W_DEFPROC("GRFISCAL.spr")
	LNtp_mercad	= GFGetTp_Mercadoria("BR",  &LSAlsGRP .CLASSIFICA )




	IF LNtp_mercad = 7
		LSLinhaXML  = "SIM"
	ELSE
		LSLinhaXML  = "NAO"
	ENDIF


	IF EMPTY(ALLTRIM( &LSAlsGRP .COD_LSTSRV ))
		LSLinhaXML  = "NAO"
	ENDIF



	LSLinhaXML  = ;
	  GRtratalinha('BLOCO_LSTS_SERV_INFORMA_DADOS="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))

	*----------------------------------------------------------*
	IF LNtp_mercad = 7
		LSLinhaXML  = ALLTRIM( &LSAlsGRP .COD_LSTSRV )
	ELSE
 	    LSLinhaXML  = ""
	ENDIF


	LSLinhaXML  = ;
	   GRtratalinha('LSTS_CODIGO="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*

	LSLinhaXML  = ALLTRIM( &LSAlsGRP .COD_LSTSRV )
	LSLinhaXML  = ;
	   GRtratalinha('LSTS_DESCRICAO="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*




	SET POINT TO
	SET SEPARATOR  TO


RETURN(.t.)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21WA           GRGrvEquivalentesXML VALID         
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:   49     
*        Variable:            GRGrvEquivalentesXML               
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      45                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21wa     &&  GRGrvEquivalentesXML VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*



FUNCTION GRGrvEquivalentesXML
PARAMETERS 	PrmEmp,;
            PrmData,;
            PrmFileXML,;
			PrmNroIDfileXML

	PRIVATE AlsANT       && Alias Anterior
	PRIVATE LSAlsTbF     && Tabele Produto Fornecedor
	PRIVATE LSAlsGrp     && Empresa
	

	AlsANT = ALIAS()

    SELE TABFORN
	LSAlsTbF = alias()


	SELE GRUPO
	LSAlsGRP = alias()


	*-------------------------------------------------------*

   	PRIVATE lErro
   	PRIVATE LSLinhaXML


	*-----  IDENTIFICACAO DO CONTRIBUINTE  -----------------------*
	SET POINT TO ","
	SET SEPARATOR  TO "."
	







	LSLinhaXML  = "SIM"
	LSLinhaXML  = ;
	  GRtratalinha('BLOCO_EQUIVALENTES_INFORMA_DADOS="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*
	LSLinhaXML  = ALLTRIM( &LSAlsGRP .CODIGO )
	LSLinhaXML  = ;
	   GRtratalinha('EQVL_CODIGO="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*







	SET POINT TO
	SET SEPARATOR  TO


RETURN(.t.)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21WJ           GRGrvAcompanhamentoXML VALID       
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:   50     
*        Variable:            GRGrvAcompanhamentoXML             
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      46                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21wj     &&  GRGrvAcompanhamentoXML VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*



FUNCTION GRGrvAcompanhamentoXML
PARAMETERS 	PrmEmp,;
            PrmData,;
            PrmFileXML,;
			PrmNroIDfileXML

	PRIVATE AlsANT       && Alias Anterior
	PRIVATE LSAlsTbF     && Tabele Produto Fornecedor
	PRIVATE LSAlsGrp     && Empresa
	

	AlsANT = ALIAS()

    SELE TABFORN
	LSAlsTbF = alias()


	SELE GRUPO
	LSAlsGRP = alias()


	*-------------------------------------------------------*

   	PRIVATE lErro
   	PRIVATE LSLinhaXML


	*-----  IDENTIFICACAO DO CONTRIBUINTE  -----------------------*
	SET POINT TO ","
	SET SEPARATOR  TO "."
	






	LSLinhaXML  = "SIM"
	LSLinhaXML  = ;
	 GRtratalinha('BLOCO_ACOMPANHAMENTOS_INFORMA_DADOS="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*
	LSLinhaXML  = ALLTRIM( &LSAlsGRP .CODIGO )
	LSLinhaXML  = ;
	   GRtratalinha('ACMP_CODIGO="'+ LSLinhaXML + '"')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
	*----------------------------------------------------------*






	SET POINT TO
	SET SEPARATOR  TO


RETURN(.t.)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21WS           GRtratalinha VALID                 
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:   51     
*        Variable:            GRtratalinha                       
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      47                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21ws     &&  GRtratalinha VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION GRtratalinha
PARAMETERS LSLINHA

	LSLINHA = UPPER(LSLINHA)
	LSLINHA = RTRIM(LSLINHA)

RETURN(LSLINHA)


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21YF           GRLimpaString VALID                
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:   52     
*        Variable:            GRLimpaString                      
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      48                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21yf     &&  GRLimpaString VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION GRLimpaString
PARAMETERS PrmString
	*-------------------------------------------------------*
	PRIVATE LSstatus
	LSstatus = ""
	*-------------------------------------------------------*
	*PRMString = UPPER(PRMString)

	PRMString = chrtran(PRMString,"","C")       && 01
	PRMString = chrtran(PRMString,"","c")       && 02
	PRMString = chrtran(PRMString,"&","e")       && 03
	PRMString = chrtran(PRMString,"","-")       && 04
	PRMString = chrtran(PRMString,"","-")       && 05
	PRMString = chrtran(PRMString,"",'')        && 06
	PRMString = chrtran(PRMString,"",'')        && 07
	PRMString = chrtran(PRMString,"",'E')       && 08
	PRMString = chrtran(PRMString,"",'e')       && 09
	PRMString = chrtran(PRMString,"",'A')       && 10
	PRMString = chrtran(PRMString,"",'a')       && 11
	PRMString = chrtran(PRMString,"",'')        && 12
	PRMString = chrtran(PRMString,chr(0),'')     && 13
	PRMString = chrtran(PRMString,'"','')        && 14
	PRMString = chrtran(PRMString,'','A')        && 14
	PRMString = chrtran(PRMString,'>',' ')        && 14
	PRMString = chrtran(PRMString,'<',' ')        && 14


RETURN(PrmString)


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21YG           GR_Fputs VALID                     
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:   53     
*        Variable:            GR_Fputs                           
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      49                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21yg     &&  GR_Fputs VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION GR_Fputs
PARAMETERS ;
			PrmNroIDfileXML,;
			PrmString,;
			PrmLEN

	PRIVATE LFretorno

	PrmString = CR_FputsLimpa(PrmString)

	LFretorno =fPuts(PrmNroIDfileXML,PrmString,LEN(PrmString))

RETURN(LFretorno)

*----------------------------------------------------------*

FUNCTION CR_FputsLimpa
PARAMETERS PrmString

	PRMString = chrtran(PRMString,"","C")       && 01
	PRMString = chrtran(PRMString,"","c")       && 02
	PRMString = chrtran(PRMString,"&","e")       && 03
	PRMString = chrtran(PRMString,"","-")       && 04
	PRMString = chrtran(PRMString,"","-")       && 05
	PRMString = chrtran(PRMString,"",'')        && 06
	PRMString = chrtran(PRMString,"",'')        && 07
	PRMString = chrtran(PRMString,"",'E')       && 08
	PRMString = chrtran(PRMString,"",'e')       && 09
	PRMString = chrtran(PRMString,"",'A')       && 10
	PRMString = chrtran(PRMString,"",'a')       && 11
	PRMString = chrtran(PRMString,"",'')        && 12
	PRMString = chrtran(PRMString,chr(0),'')     && 13

** nao 	PRMString = chrtran(PRMString,'"','')        && 14

RETURN(PrmString)


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21YH           GRfecharegXML VALID                
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:   54     
*        Variable:            GRfecharegXML                      
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      50                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21yh     &&  GRfecharegXML VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*



FUNCTION GRfecharegXML
PARAMETERS 	PrmEmp,;
            PrmData,;
            PrmFileXML,;
			PrmNroIDfileXML,;
	        PrmAlsEM,;
	        PrmAlsGR,;
	        PrmAlsFR,;
	        PrmAlsTbF


	SET POINT TO ","
	SET SEPARATOR  TO "."



	*-------------------------------------------------------*
    LSLinhaXML  = ""
	LSLinhaXML  = GRtratalinha('/>')
    =GR_Fputs(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))




	SET POINT TO
	SET SEPARATOR  TO


RETURN(.t.)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21YI           GRGerXMLClassifica VALID           
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:   55     
*        Variable:            GRGerXMLClassifica                 
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      51                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21yi     &&  GRGerXMLClassifica VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION GRGerXMLClassifica
PARAMETERS PrmEmp, PrmData, PrmClas_Inicial,PrmClas_Final

	PRIVATE LSalias
	
	PRIVATE PrmAlsEM
	PRIVATE PrmAlsGR
	PRIVATE PrmAlsTbf
	PRIVATE PrmAlsFRN
	
	PRIVATE LNrecGrupo
	PRIVATE LFTabForn

	LSalias  = ALIAS()

	LFTabForn   		= NetArq("tabforn")
	IF (LFTabForn) > 100000
        DO GRFCHGerXMLProduto
		RETURN(.f.)
	ENDIF



    SELE TABFORN

    PrmAlsTbf = Alias()

	=W_DEFPROC("FORNECED.SPR")
	PrmAlsFRN = FRGetAlias()

	=W_DEFPROC("EMPRESA.SPR")
	PrmAlsEM  = EMGetAlias()

	PrmAlsGR  = GRGetAlias()


	*-------------------------------------------------------*
	=GRClsfModeloRefXML()
    *-------------------------------------------------------*

   	PRIVATE LSfileXML,LNroIDfileXML


   	LSfileXML	= GRClsfNmFileXML()
   	LSfileXML	= "C:\NFE\TMP\"+LSfileXML


  	LNroIDfileXML 		=fcreate(LSfileXML)
   	if LNroIDfileXML<0
      =fclose(LNroIDfileXML)
      wait 'ERRO cria눯o arquivo tempor쟲io '+LSfileXML+'- <ENTER> ' window
        DO GRFCHGerXMLProduto
		RETURN(.f.)
   	endif


	*---------------------------------------------------*

	SELE &PrmAlsEM
	SET ORDER TO TAG EMPRESA
	SEEK PrmEmp


	SELE &PrmAlsGR

	go bott
	go top
	

	SET ORDER TO TAG CLASSIFICA
	SET NEAR ON
	SEEK PrmClas_Inicial
	SET NEAR OFF




	*----------------------------------------------------*
	DO RELINIC.PRG          && INICIA VAR P/ TERMOMETRO

	LFsegue = .t.


    IF !EOF()
		LNregistro = RECNO()

		COUNT  WHILE  &PrmAlsGR .classifica <= PrmClas_Final ;
         TO LNimpressao
		GO LNregistro
	
	ENDIF
	
	LNimpressos = 0
	*----------------------------------------------------*


	=GRClsfInicioXML(LSfileXML,LNroIDfileXML)


	SET POINT TO ','


	SELE &PrmAlsGR
	DO WHILE !EOF() ;
			AND  &PrmAlsGR .classifica <= PrmClas_Final

		=UPtermo()


		LNrecGrupo = RECNO()



        =GRCrvUnemXML(;
         	PrmEmp,;
            PrmData,;
            LSfileXML,;
			LNroIDfileXML,;
	        PrmAlsEM,;
	        PrmAlsGR,;
	        PrmAlsFRN,;
	        PrmAlsTbF;
	        )

        =GRGrvClassifXML(;
         	PrmEmp,;
            PrmData,;
            LSfileXML,;
			LNroIDfileXML,;
	        PrmAlsEM,;
	        PrmAlsGR,;
	        PrmAlsFRN,;
	        PrmAlsTbF;
	        )


        =GRfecharegXML(;
         	PrmEmp,;
            PrmData,;
            LSfileXML,;
			LNroIDfileXML,;
	        PrmAlsEM,;
	        PrmAlsGR,;
	        PrmAlsFRN,;
	        PrmAlsTbF;
	        )

		SELE &PrmAlsGR
		SET ORDER TO TAG classifica

		GO LNrecGrupo
		SKIP
	ENDDO

	=GRFinalXML(LSfileXML,LNroIDfileXML)


	SET POINT TO

	DO RELFIM.PRG          && FIM VAR P/ TERMOMETRO
	*-----------------------------------------------*
    =fclose(LNroIDfileXML)

    DO GRFCHGerXMLProduto
	
RETURN(.T.)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21YJ           GRClsfNmFileXML VALID              
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:   58     
*        Variable:            GRClsfNmFileXML                    
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      52                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21yj     &&  GRClsfNmFileXML VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION GRClsfNmFileXML

	*-------------------------------------------------------*

   	PRIVATE LSfileXML, LNroIDfileXML, LSnomeArqXml
	
	*----------------------------------------------------------*



	LSnomeArqXml = "XMLCLSF"
	LSnomeArqXml = CHRTRAN(LSnomeArqXml," ","0")


   	LSfileXML	= LSnomeArqXml+".XML"
	
RETURN(LSfileXML)


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21YK           GRClsfModeloRefXML VALID           
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:   59     
*        Variable:            GRClsfModeloRefXML                 
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      53                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21yk     &&  GRClsfModeloRefXML VALID
#REGION 1
RETURN

FUNCTION GRClsfModeloRefXML


	PRIVATE LSFDocXML
	
	LSFDocXML = "\scgc\loja\automatc\xmlCLSF.XML"
	IF !FILE(LSFDocXML)
		RETURN(.T.)
	ENDIF


	SELE 0
	USE  \scgc\comum\xmlCLSF EXCL
	ZAP
	PACK

	*------------------------------------------------------------*
	* ESTE COMANDO SERVA PARA ELIMINAR CARACTERES INDESEJADOS
	* DO CABECALHO XML
	*-----------------------------------------------------------*
	SELE xmlCLSF


	APPEND FROM &LSFDocXML TYPE SDF


	
	REPLACE ALL XML_LINHA WITH chrtran(XML_LINHA,chr(9),chr(32))
	REPLACE ALL XML_ORDEM WITH RECNO()
	GO BOTT
	SKIP -1
	REPLACE XML_ORDEM WITH 9999999999901
	SKIP	
	REPLACE XML_ORDEM WITH 9999999999902
	USE

	IF FILE(LSFDocXML)
		DELETE FILE &LSFDocXML
	ENDIF

RETURN


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21YL           GRClsfInicioXML VALID              
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:   60     
*        Variable:            GRClsfInicioXML                    
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      54                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21yl     &&  GRClsfInicioXML VALID
#REGION 1
RETURN

FUNCTION GRClsfInicioXML
PARAMETERS 	PrmFileXML,;
			PrmNroIDfileXML



   	PRIVATE lErro
   	PRIVATE LSLinhaXML

	*-------------------------------------------------------*

	SELE 0
	USE  \scgc\comum\xmlCLSF
	SET ORDER TO TAG XML_ORDEM
	GO TOP
	
	DO WHILE !EOF() AND xmlCLSF.XML_ORDEM < 9999999999901
	
		LSLinhaXML = xmlCLSF.XML_LINHA
		=fPuts(PrmNroIDfileXML,LSLinhaXML,LEN(LSLinhaXML))
		SKIP
	ENDDO
	SELE xmlCLSF
	USE
		

RETURN


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4IS0L21YM           GRCEST_Carregar VALID              
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         GRUPO,     Record Number:   62     
*        Variable:            GRCEST_Carregar                    
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      55                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4is0l21ym     &&  GRCEST_Carregar VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION GRCEST_Carregar

PRIVATE LSALIAS


	SET STEP ON

	IF !USED("TMP_CEST")
		SELE 0
		USE  Q:\SCGC\COMUM\TMP_CEST
		SET ORDER TO TAG CODIGO
	ENDIF
	
	
	LSALIAS  = GRGetAlias()

	

	SELE &LSALIAS
	GO TOP
	DO WHILE !EOF()
		SELE TMP_CEST
		SEEK &LSALIAS .CODIGO
		IF FOUND()
			SELE &LSALIAS

			IF RLOCK()
				REPLACE  &LSALIAS .CEST WITH TMP_CEST.CEST
			ENDIF
		ENDIF
				
		SELE &LSALIAS
		SKIP
			
	ENDDO
	

	

RETURN(.T.)
