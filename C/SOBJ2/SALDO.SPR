*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        01/03/15              SALDO.SPR                10:43:23 
*                                                                
*       픔컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        Author's Name                                           
*                                                                
*        Copyright (c) 2015 Company Name                         
*        Address                                                 
*        City,     Zip                                           
*                                                                
*        Description:                                            
*        This program was automatically generated by GENSCRN.    
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴


#REGION 0
REGIONAL m.currarea, m.talkstat, m.compstat

IF SET("TALK") = "ON"
	SET TALK OFF
	m.talkstat = "ON"
ELSE
	m.talkstat = "OFF"
ENDIF
m.compstat = SET("COMPATIBLE")
SET COMPATIBLE FOXPLUS

*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                       MS-DOS Window definitions                
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                      SALDO/MS-DOS Screen Layout                
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 1
@ 5,6 GET SLCreate ;
	PICTURE "@*HN SLCreate - Instancia" ;
	SIZE 1,22,1 ;
	DEFAULT 1 ;
	VALID _4900mzejo()
@ 7,6 GET SLReadProp ;
	PICTURE "@*HN SLReadProp - Carga do Vetor com Base na Tabela" ;
	SIZE 1,48,1 ;
	DEFAULT 1 ;
	VALID _4900mzek0()
@ 9,10 GET SLSetPropVT ;
	PICTURE "@*HN SLSetPropVT - Set o Valor de uma Propriedade do Vetor" ;
	SIZE 1,55,1 ;
	DEFAULT 1 ;
	VALID _4900mzek6()
@ 12,6 GET SLFind ;
	PICTURE "@*HN SLFind - Localiza Registro Com Base nas Propriedades" ;
	SIZE 1,54,1 ;
	DEFAULT 1 ;
	VALID _4900mzeke()
@ 10,10 GET SLGetPropVT ;
	PICTURE "@*HN SLGetPropVT - Get o Valor de uma Propriedade do Vetor" ;
	SIZE 1,55,1 ;
	DEFAULT 1 ;
	VALID _4900mzekf()
@ 4,6 GET SLVerifyInst ;
	PICTURE "@*HN SLVerifyInst - Verifica Instancia" ;
	SIZE 1,35,1 ;
	DEFAULT 1 ;
	VALID _4900mzekg()
@ 6,6 GET SLDestroi ;
	PICTURE "@*HN SLDestroi - Desinstancia" ;
	SIZE 1,26,1 ;
	DEFAULT 1 ;
	VALID _4900mzekh()
@ 3,1 SAY "====> Com Uso de pseudo OO" ;
	SIZE 1,26, 0
@ 8,6 GET SLSetDerivadas ;
	PICTURE "@*HN SLSetDerivadas - Carga de Propriedades Derivadas" ;
	SIZE 1,51,1 ;
	DEFAULT 1 ;
	VALID _4900mzeki()
@ 15,1 SAY "Metodos de Acesso aos Valores das Propriedades" ;
	SIZE 1,46, 0
@ 16,3 GET SLGetSaldo ;
	PICTURE "@*HN SLGetSaldo - Retorna Saldo Global do Produto no M늮" ;
	SIZE 1,53,1 ;
	DEFAULT 1 ;
	VALID _4900mzelb()
@ 11,6 GET SLChk_Identidade ;
	PICTURE "@*HN SLChk_Identidade - Checagem de Identidade do Objeto" ;
	SIZE 1,53,1 ;
	DEFAULT 1 ;
	VALID _4900mzeli()
@ 13,6 GET SLRefresh ;
	PICTURE "@*HN SLRefresh - Forca Atualiza눯o do Objeto" ;
	SIZE 1,41,1 ;
	DEFAULT 1 ;
	VALID _4900mzelp()
@ 18,3 GET SLGetReserva ;
	PICTURE "@*HN SLGetReserva - Retorna Saldo Reserva do Produto no M늮" ;
	SIZE 1,56,1 ;
	DEFAULT 1 ;
	VALID _4900mzelw()
@ 19,3 GET SLGetDisponivel ;
	PICTURE "@*HN SLGetDisponivel - Retorna Saldo Disponivel do Produto no M늮" ;
	SIZE 1,62,1 ;
	DEFAULT 1 ;
	VALID _4900mzelx()
@ 20,3 GET SLGetSldHst ;
	PICTURE "@*HN SLGetSldHst - Retorna Saldo em Determinado Momento (Historia)" ;
	SIZE 1,63,1 ;
	DEFAULT 1 ;
	VALID _4900mzely()
@ 21,3 GET SLGetResHst ;
	PICTURE "@*HN SLGetResHst - Retorna Saldo Reserva em Determinado Momento (Historia)" ;
	SIZE 1,71,1 ;
	DEFAULT 1 ;
	VALID _4900mzelz()
@ 17,3 GET SLGetVlrEstq ;
	PICTURE "@*HN SLGetVlrEstq - Retorna Valor/Custo do Estoque Produto no M늮" ;
	SIZE 1,62,1 ;
	DEFAULT 1 ;
	VALID _4900mzem0()




*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                     ITEMMOV/MS-DOS Screen Layout               
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 2
@ 23,1 SAY "Metodos de Acesso aos Valores das Propriedades" ;
	SIZE 1,46, 0
@ 24,3 GET IMGetSaldo ;
	PICTURE "@*HN IMGetSaldo - Retorna Saldo Com Base em um Instante no Movimento " ;
	SIZE 1,66,1 ;
	DEFAULT 1 ;
	VALID _4900mzemu()
@ 25,3 GET IMGetReserva ;
	PICTURE "@*HN IMGetReserva - Retorna Saldo Reserva Com Base em um Instante no Movimento " ;
	SIZE 1,76,1 ;
	DEFAULT 1 ;
	VALID _4900mzen1()
@ 32,3 GET IMgiroSimplesLJ ;
	PICTURE "@*HN IMgiroSimplesLJ - Venda / Total de Dias" ;
	SIZE 1,41,1 ;
	DEFAULT 1 ;
	VALID _4900mzen8()
@ 33,3 GET IMgiroRealLJ ;
	PICTURE "@*HN IMgiroRealLJ - Venda / Total de Dias Com Disponibilidade de Estoque" ;
	SIZE 1,69,1 ;
	DEFAULT 1 ;
	VALID _4900mzenf()
@ 34,3 GET IMgiroTendenciaLJ ;
	PICTURE "@*HN IMgiroTendenciaLJ - Giro Real Ponderando o Faixas dentro do Periodo" ;
	SIZE 1,69,1 ;
	DEFAULT 1 ;
	VALID _4900mzeng()
@ 35,8 GET IMDadosGiro ;
	PICTURE "@*HN IMDadosGiro - Rotina de Apoio Comum Para Calculo de Giro Diefernciados" ;
	SIZE 1,72,1 ;
	DEFAULT 1 ;
	VALID _4900mzenh()
@ 37,1 SAY "Consultas SQL" ;
	SIZE 1,13, 0
@ 39,3 GET OLDIMGiroControle ;
	PICTURE "@*HN OLDIMGiroControle - ANTES 14/04/14" ;
	SIZE 1,36,1 ;
	DEFAULT 1 ;
	VALID _4900mzeni() ;
	DISABLE
@ 26,3 GET IMGetVlrEstq ;
	PICTURE "@*HN IMGetVlrEstq-Ret.Vlr/Custo Estq.Com em um Instante no Movimento " ;
	SIZE 1,66,1 ;
	DEFAULT 1 ;
	VALID _4900mzeod()
@ 36,11 GET IMPosicItemmov ;
	PICTURE "@*HN IMPosicItemmov-Posiciona itemmov no ultimo registo de uma data" ;
	SIZE 1,64,1 ;
	DEFAULT 1 ;
	VALID _4900mzeok()
@ 0,0 SAY "====> Com Uso de pseudo OO" ;
	SIZE 1,26, 0
@ 3,6 GET IMVerifyInst ;
	PICTURE "@*HN IMVerifyInst - Verifica Instancia" ;
	SIZE 1,35,1 ;
	DEFAULT 1 ;
	VALID _4900mzeor()
@ 4,9 GET IMCreate ;
	PICTURE "@*HN IMCreate - Instancia" ;
	SIZE 1,22,1 ;
	DEFAULT 1 ;
	VALID _4900mzeox()
@ 12,9 GET IMDestroi ;
	PICTURE "@*HN IMDestroi - Desinstancia" ;
	SIZE 1,26,1 ;
	DEFAULT 1 ;
	VALID _4900mzeoy()
@ 6,12 GET IMReadProp ;
	PICTURE "@*HN IMReadProp - Carga do Vetor com Base na Tabela" ;
	SIZE 1,48,1 ;
	DEFAULT 1 ;
	VALID _4900mzeoz()
@ 9,14 GET IMSetDerivadas ;
	PICTURE "@*HN IMSetDerivadas - Carga de Propriedades Derivadas" ;
	SIZE 1,51,1 ;
	DEFAULT 1 ;
	VALID _4900mzep0()
@ 7,14 GET IMSetPropVT ;
	PICTURE "@*HN IMSetPropVT - Set o Valor de uma Propriedade do Vetor" ;
	SIZE 1,55,1 ;
	DEFAULT 1 ;
	VALID _4900mzepq()
@ 8,14 GET IMGetPropVT ;
	PICTURE "@*HN IMGetPropVT - Get o Valor de uma Propriedade do Vetor" ;
	SIZE 1,55,1 ;
	DEFAULT 1 ;
	VALID _4900mzepx()
@ 2,1 GET IMChk_Identidade ;
	PICTURE "@*HN IMChk_Identidade - Checagem de Identidade do Objeto" ;
	SIZE 1,53,1 ;
	DEFAULT 1 ;
	VALID _4900mzeq4()
@ 1,1 GET IMFind ;
	PICTURE "@*HN IMFind - Localiza Registro Com Base nas Propriedades" ;
	SIZE 1,54,1 ;
	DEFAULT 1 ;
	VALID _4900mzeqa()
@ 14,1 GET IMGetFieldValue ;
	PICTURE "@*HN IMGetFieldValue - Retorna o valor do Campo informado" ;
	SIZE 1,54,1 ;
	DEFAULT 1 ;
	VALID _4900mzeqh()
@ 13,1 GET IM_Refresh ;
	PICTURE "@*HN IM_Refresh - Forca Atualiza놹o Objeto" ;
	SIZE 1,39,1 ;
	DEFAULT 1 ;
	VALID _4900mzeqi()
@ 16,1 SAY "*-------------------------------------------------------------------*" ;
	SIZE 1,69, 0
@ 18,1 GET IMLerRegistro ;
	PICTURE "@*HN IMLerRegistro - Le Registro e Carrega OBJ" ;
	SIZE 1,43,1 ;
	DEFAULT 1 ;
	VALID _4900mzeqj()
@ 10,12 GET IMWriteProp ;
	PICTURE "@*HN IMWriteProp - Grava do Vetor para Base na Tabela" ;
	SIZE 1,50,1 ;
	DEFAULT 1 ;
	VALID _4900mzeqk()
@ 19,1 GET IMSalvarRegistro ;
	PICTURE "@*HN IMSalvarRegistro - Salva Registro" ;
	SIZE 1,35,1 ;
	DEFAULT 1 ;
	VALID _4900mzeql()
@ 17,1 GET IMExiste ;
	PICTURE "@*HN IMExiste - Le Registro nao carrega o OBJ e Retorna se existe" ;
	SIZE 1,62,1 ;
	DEFAULT 1 ;
	VALID _4900mzerg()
@ 20,1 SAY "*-------------------------------------------------------------------*" ;
	SIZE 1,69, 0
@ 15,1 GET IMGetAlias ;
	PICTURE "@*HN IMGetAlias - Retorna Alias da area em que foi abertaa tabela" ;
	SIZE 1,62,1 ;
	DEFAULT 1 ;
	VALID _4900mzerm()
@ 21,1 GET IMFaxinaDados ;
	PICTURE "@*HN IMFaxinaDados-Retira char invalidor e outras validacoes" ;
	SIZE 1,57,1 ;
	DEFAULT 1 ;
	VALID _4900mzert()
@ 40,3 GET IMGiroControle ;
	PICTURE "@*HN IMGiroControle - SQL para Montar Giro de Estoque e Duracao" ;
	SIZE 1,60,1 ;
	DEFAULT 1 ;
	VALID _4900mzes0()
@ 41,5 GET IMDura ;
	PICTURE "@*HN IMDura - Calcula duracao do estoque" ;
	SIZE 1,37,1 ;
	DEFAULT 1 ;
	VALID _4900mzes1()
@ 28,3 GET IMGetUltCstMedioEstq ;
	PICTURE "@*HN IMGetUltCstMedioEstq-Ret.ultimo Vlr/Custo Medio Estq.Com em um Instante no Movimento " ;
	SIZE 1,87,1 ;
	DEFAULT 1 ;
	VALID _4900mzes2()



READ


#REGION 0
IF m.talkstat = "ON"
	SET TALK ON
ENDIF
IF m.compstat = "ON"
	SET COMPATIBLE ON
ENDIF


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4900MZEJO           SLCreate VALID                     
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SALDO,     Record Number:    2     
*        Variable:            SLCreate                           
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      1                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4900mzejo     &&  SLCreate VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION SLCreate
	=W_DEFPROC("rotinas.spr")
	PRIVATE LSalias
	PRIVATE LSAlsTmp
    PRIVATE LMaxDim
	LSalias		= 	ALIAS()

	IF TYPE("PBSaldoAlias") <> "U" ;
	   		AND !EMPTY(PBSaldoAlias) ;
	   		AND USED(PBSaldoAlias)
			RETURN(.T.)
	ENDIF
	

	PUBLIC PBSaldoAlias

	IF USED("SALDO")
	     =NetArqAgain("Saldo")
	     PBSaldoAlias     = Alias()
	ELSE
	     =NetArqAgain("Saldo")
	     LSAlsTmp     = Alias()
	     =NetArqAgain("Saldo")
	     PBSaldoAlias     = Alias()
		 IF !EMPTY(LSAlsTmp) AND USED(LSAlsTmp)
			SELECT &LSAlsTmp
			USE
		 ENDIF
	ENDIF	

    SELE &PBSaldoAlias
	LMaxDim = Fcount()
    PUBLIC DIMENSION VTSaldo[LMaxDim]
    PUBLIC DIMENSION VDSaldo[10,3]			&& VETOR PARA PROPRIEDADES
	*-----------------------------------------------------------*
	=SLReadProperty()
	=SLSetDerivadas()   && carga dos calculos derivados
	*--------------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4900MZEK0           SLReadProp VALID                   
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SALDO,     Record Number:    3     
*        Variable:            SLReadProp                         
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      2                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4900mzek0     &&  SLReadProp VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION SLReadProp
	PRIVATE LSalias
	LSalias		= 	ALIAS()

	=SLVerifyInst()

	SELE &PBSaldoAlias
	SCATTER TO VTSaldo
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(.T.)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4900MZEK6           SLSetPropVT VALID                  
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SALDO,     Record Number:    4     
*        Variable:            SLSetPropVT                        
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      3                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4900mzek6     &&  SLSetPropVT VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION SLSetPropVT
PARAMETER  PrmField, PrmValue

	PRIVATE Lvalue
	=SLVerifyInst()
	=W_DEFPROC("ROTINAS.SPR")
	Lvalue = RTsetValueObj(PrmField,PrmValue,;
						    PBSaldoAlias,VTSaldo,VDSaldo)

RETURN(Lvalue)


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4900MZEKE           SLFind VALID                       
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SALDO,     Record Number:    5     
*        Variable:            SLFind                             
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      4                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4900mzeke     &&  SLFind VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION SLFind
	PRIVATE LEmpresa, LData,Lcodigo
	PRIVATE LFreturn

	PRIVATE LSalias
	LSalias		= 	ALIAS()

	=SLVerifyInst()

	LEmpresa    = SLGetPropVT("Empresa")
	LData       = SLGetPropVT("dtAbert")
	LCodigo     = SLGetPropVT("Codigo")


	SELE &PBSaldoAlias
	SET ORDER TO TAG SALDO
	SEEK STR(LEmpresa,3)+STR(YEAR(Ldata),4)+STR(MONTH(Ldata),2)+Lcodigo
	IF FOUND()
		=SLReadProperty()
		=SLSetDerivadas()   && carga dos calculos derivados
	    LFreturn = .T.
	ELSE
	    LFreturn = .f.
	ENDIF
	*--------------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(LFreturn)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4900MZEKF           SLGetPropVT VALID                  
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SALDO,     Record Number:    6     
*        Variable:            SLGetPropVT                        
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      5                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4900mzekf     &&  SLGetPropVT VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION SLGetPropVT
PARAMETER  PrmField
	PRIVATE Lvalue

	=SLVerifyInst()
	=W_DEFPROC("ROTINAS.SPR")
	Lvalue = RTgetValueObj(PrmField,PBSaldoAlias,VTSaldo,VDSaldo)

RETURN(Lvalue)




*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4900MZEKG           SLVerifyInst VALID                 
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SALDO,     Record Number:    7     
*        Variable:            SLVerifyInst                       
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      6                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4900mzekg     &&  SLVerifyInst VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION SLVerifyInst
PRIVATE LSpath

	=W_DEFPROC("rotinas.spr")
	LSpath = UPobterPath("SALDO")


	IF TYPE("PBSaldoAlias") = "U" ;
	   		OR EMPTY(PBSaldoAlias) ;
	   		OR !USED(PBSaldoAlias)
		=SLCreate()
	ELSE
		IF !(LSPath $ DBF(PBSaldoAlias)) && HOUVE MUDANCA DE DIR BASE
			=SLDestroi()				   && ELIMINA INSTACIA DE OUTRA BASE
			=SLCreate()					   && CRIA INSTANCIA NA NOVA BASE
		ENDIF
	ENDIF
RETURN(.t.)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4900MZEKH           SLDestroi VALID                    
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SALDO,     Record Number:    8     
*        Variable:            SLDestroi                          
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      7                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4900mzekh     &&  SLDestroi VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION SLDestroi
	=W_DEFPROC("rotinas.spr")

	PRIVATE LSalias
	LSalias  = Alias()
	IF !EMPTY(PBSaldoAlias) AND USED(PBSaldoAlias)
		SELECT &PBSaldoAlias
		USE
	ENDIF	
	RELEASE PBSaldoAlias
    RELEASE VTSaldo
    RELEASE VDSaldo

	*-----------------------------------------------------------*
	*--------------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4900MZEKI           SLSetDerivadas VALID               
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SALDO,     Record Number:   10     
*        Variable:            SLSetDerivadas                     
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      8                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4900mzeki     &&  SLSetDerivadas VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION SLSetDerivadas
	PRIVATE LSalias
	PRIVATE LEmpresa
	LSalias		= 	ALIAS()

	=SLVerifyInst()
	*--------------------------------------------------------------*
    VDSaldo(1,1) = "BSBR RETIDO ENTRADA"
   	VDSaldo(1,2) = 0
   	VDSaldo(1,3) = .F.
	*--------------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(.T.)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4900MZELB           SLGetSaldo VALID                   
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SALDO,     Record Number:   12     
*        Variable:            SLGetSaldo                         
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      9                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4900mzelb     &&  SLGetSaldo VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION SLGetSaldo
PARAMETERS PrmEmp, PrmData, PrmCodigo

	*----------------------------------------------------------------*
	=SLRefresh(PrmEmp, PrmData, PrmCodigo)
	*----------------------------------------------------------------*

RETURN(SLGetPropVT("SLD_ATU"))


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4900MZELI           SLChk_Identidade VALID             
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SALDO,     Record Number:   13     
*        Variable:            SLChk_Identidade                   
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      10                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4900mzeli     &&  SLChk_Identidade VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION SLChk_Identidade
PARAMETERS PrmEmp, PrmData, PrmCodigo
	PRIVATE LFreturn
	=SLVerifyInst()
	*----------------------------------------------------------------*


	IF ;
	   !FOUND(PBSaldoAlias) OR ;
	   PrmEmp 		 <> SLGetPropVT("EMPRESA") OR ;
       YEAR(PrmData) <> YEAR(SLGetPropVT("DTABERT")) OR ;
       MONTH(PrmData) <> MONTH(SLGetPropVT("DTABERT")) OR ;
       PrmCodigo     <> SLGetPropVT("CODIGO")
	    =SLSetPropVT("EMPRESA",PrmEmp)
	    =SLSetPropVT("DTABERT",PrmData)
	    =SLSetPropVT("CODIGO",PrmCodigo)
		=SLFind()
	ENDIF
RETURN(.t.)




*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4900MZELP           SLRefresh VALID                    
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SALDO,     Record Number:   14     
*        Variable:            SLRefresh                          
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      11                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4900mzelp     &&  SLRefresh VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION SLRefresh
PARAMETERS PrmEmp, PrmData, PrmCodigo
	PRIVATE LFreturn
	=SLVerifyInst()
	*----------------------------------------------------------------*
    =SLSetPropVT("EMPRESA",PrmEmp)
    =SLSetPropVT("DTABERT",PrmData)
    =SLSetPropVT("CODIGO",PrmCodigo)
	=SLFind()
RETURN(.t.)




*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4900MZELW           SLGetReserva VALID                 
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SALDO,     Record Number:   15     
*        Variable:            SLGetReserva                       
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      12                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4900mzelw     &&  SLGetReserva VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION SLGetReserva
PARAMETERS PrmEmp, PrmData, PrmCodigo

	*----------------------------------------------------------------*
	=SLRefresh(PrmEmp, PrmData, PrmCodigo)
	*----------------------------------------------------------------*

RETURN(SLGetPropVT("RESERVA"))


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4900MZELX           SLGetDisponivel VALID              
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SALDO,     Record Number:   16     
*        Variable:            SLGetDisponivel                    
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      13                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4900mzelx     &&  SLGetDisponivel VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION SLGetDisponivel
PARAMETERS PrmEmp, PrmData, PrmCodigo
PRIVATE LNDisponivel
	*----------------------------------------------------------------*
	=SLRefresh(PrmEmp, PrmData, PrmCodigo)
	*----------------------------------------------------------------*
	LNDisponivel = SLGetPropVT("SLD_ATU") - SLGetPropVT("RESERVA")

RETURN(SLGetPropVT("LNDisponivel"))


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4900MZELY           SLGetSldHst VALID                  
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SALDO,     Record Number:   17     
*        Variable:            SLGetSldHst                        
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      14                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4900mzely     &&  SLGetSldHst VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION SLGetSldHst
PARAMETERS PrmEmp, PrmData, PrmCodigo, PrmHora

PRIVATE LNSaldo
	*----------------------------------------------------------------*
	=W_DEFPROC("ITEMMOV.SPR")
	LNSaldo=IMGetSaldo(PrmEmp, PrmCodigo, PrmData, PrmHora)
	*----------------------------------------------------------------*

RETURN(LNSaldo)


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4900MZELZ           SLGetResHst VALID                  
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SALDO,     Record Number:   18     
*        Variable:            SLGetResHst                        
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      15                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4900mzelz     &&  SLGetResHst VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION SLGetResHst
PARAMETERS PrmEmp, PrmData, PrmCodigo, PrmHora

PRIVATE LNSaldo
	*----------------------------------------------------------------*
	=W_DEFPROC("ITEMMOV.SPR")
	LNSaldo=IMGetReserva(PrmEmp, PrmCodigo, PrmData, PrmHora)
	*----------------------------------------------------------------*

RETURN(LNSaldo)


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4900MZEM0           SLGetVlrEstq VALID                 
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SALDO,     Record Number:   19     
*        Variable:            SLGetVlrEstq                       
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      16                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4900mzem0     &&  SLGetVlrEstq VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION SLGetVlrEstq
PARAMETERS PrmEmp, PrmData, PrmCodigo
	*----------------------------------------------------------------*
    *  IMPLEMENTADA EM 26/08/2004
	*----------------------------------------------------------------*
	=SLRefresh(PrmEmp, PrmData, PrmCodigo)
	*----------------------------------------------------------------*

RETURN(SLGetPropVT("VLR_ATU"))


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4900MZEMU           IMGetSaldo VALID                   
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         ITEMMOV,     Record Number:    3   
*        Variable:            IMGetSaldo                         
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      17                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4900mzemu     &&  IMGetSaldo VALID
#REGION 2
return
*---------------------------------------------------------------*

FUNCTION IMGetSaldo
PARAMETERS PrmEmp, PrmCodigo, PrmData, PrmHora

	=W_DEFPROC("ROTINAS.SPR")

	PRIVATE LNSaldo
	PRIVATE LSalias
	LSalias		= 	ALIAS()
	IF TYPE("PrmHora") <> "C"
	    PrmHora = "99:99:99"
	ENDIF

	=IMVerifyInst()
	*----------------------------------------------------------------*
	SELE &PBItemmovAlias
	SET ORDER TO TAG movimento
	SET NEAR ON
	SEEK STR(PrmEmp,3)+PrmCodigo+dtos(PrmData)+PrmHora
										&& POSICIONA A FRENTE PARA
										&& VOLTAR E PEGAR SALDO DE
										&& FECHAMENTO OU ATUAL DO DIA
	SET NEAR OFF
	IF BOF() AND EOF()       && ITEMMOV ESTA VAZIO
		=W_DEFPROC("SALDO.SPR")
		LNSaldo = SLGetSaldo(PrmEmp, PrmData, PrmCodigo)
	ELSE
		SKIP -1
		IF BOF() OR PrmCodigo <> &PBItemmovAlias .codigo ;
			 	 OR PrmEmp    <> &PBItemmovAlias .empresa
			=W_DEFPROC("SALDO.SPR")
			LNSaldo = SLGetSaldo(PrmEmp, PrmData, PrmCodigo)
		ELSE
			LNSaldo =  &PBItemmovAlias .sld_estq
		ENDIF
	ENDIF
	*--------------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(LNSaldo)


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4900MZEN1           IMGetReserva VALID                 
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         ITEMMOV,     Record Number:    4   
*        Variable:            IMGetReserva                       
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      18                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4900mzen1     &&  IMGetReserva VALID
#REGION 2
return
*---------------------------------------------------------------*

FUNCTION IMGetReserva
PARAMETERS PrmEmp, PrmCodigo, PrmData, PrmHora

	=W_DEFPROC("ROTINAS.SPR")

	PRIVATE LNSaldo
	PRIVATE LSalias
	LSalias		= 	ALIAS()
	=IMVerifyInst()
	IF TYPE("PrmHora") <> "C"
	    PrmHora = "99:99:99"
	ENDIF
	*----------------------------------------------------------------*
	SELE &PBItemmovAlias
	SET ORDER TO TAG movimento
	SET NEAR ON
	SEEK STR(PrmEmp,3)+PrmCodigo+dtos(PrmData)+PrmHora
										&& POSICIONA A FRENTE PARA
										&& VOLTAR E PEGAR SALDO DE
										&& FECHAMENTO OU ATUAL DO DIA
	SET NEAR OFF
	IF BOF() AND EOF()       && ITEMMOV ESTA VAZIO
		=W_DEFPROC("SALDO.SPR")
		LNSaldo = SLGetReserva(PrmEmp, PrmData, PrmCodigo)
	ELSE
		SKIP -1
		IF BOF() OR PrmCodigo <> &PBItemmovAlias .codigo ;
			 	 OR PrmEmp    <> &PBItemmovAlias .empresa
			=W_DEFPROC("SALDO.SPR")
			LNSaldo = SLGetReserva(PrmEmp, PrmData, PrmCodigo)
		ELSE
			LNSaldo =  &PBItemmovAlias .sld_rese
		ENDIF
	ENDIF
	*--------------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(LNSaldo)


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4900MZEN8           IMgiroSimplesLJ VALID              
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         ITEMMOV,     Record Number:    5   
*        Variable:            IMgiroSimplesLJ                    
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      19                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _4900mzen8     &&  IMgiroSimplesLJ VALID
#REGION 2
RETURN

**********************************************************************
* exemplo chamada
* 		set procedure to ITEMMOV.spr
*		IMgiroSimplesLJ(1,"13011014   ",date()-100,date())

*******************************************************************

FUNCTION IMgiroSimplesLJ
	PARAMETERS PrmLoja,PrmCodigo,PrmDt_Inicial,PrmDt_Final
	
	=W_DEFPROC("rotinas.spr")
    PRIVATE LNgiro
    PRIVATE LNqtdDias, LNidxDia, LNidxData, LNindice
	PRIVATE LNqtvenda, LNsoma

	PRIVATE LSalias
	LSalias			= ALIAS()

	=IMVerifyInst()

    LNqtdDias = PrmDt_Final - PrmDt_Inicial
    DIMENSION Vdata[ LNqtdDias + 1 ]
    DIMENSION Vvendas[ LNqtdDias + 1]
    DIMENSION VSaldo[ LNqtdDias + 1]
    store 0 to Vvendas
    store 0 to VSaldo

	*------------------------------------------------------------------*

	=IMDadosGiro()

	*--------------------- GIRO SIMPLES -------------------------------*

    LNDiasReal = 1		&& Dias considerados para giro
    LNidxDia = 1
	LNsoma = 0

	*---------------------------------------------------------------
	
	DO WHILE LNidxDia <= LNqtdDias
		LNsoma =  LNsoma + Vvendas[ LNidxDia ]
		LNidxDia  = LNidxDia + 1
		LNDiasReal = LNDiasReal + 1
	ENDDO

	LNgiro	= LNsoma / LNDiasReal
	*------------------------------------------------------------------*

	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF

RETURN(LNgiro)




*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4900MZENF           IMgiroRealLJ VALID                 
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         ITEMMOV,     Record Number:    6   
*        Variable:            IMgiroRealLJ                       
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      20                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _4900mzenf     &&  IMgiroRealLJ VALID
#REGION 2
RETURN

**********************************************************************
* exemplo chamada
* 		set procedure to estoque.spr
*		?ESgiroLJ(1,"13011014   ",date()-100,date(), "FAIXA")

*******************************************************************

FUNCTION IMgiroRealLJ
	PARAMETERS PrmLoja,PrmCodigo,PrmDt_Inicial,PrmDt_Final
	
	=W_DEFPROC("rotinas.spr")
    PRIVATE LNgiro
    PRIVATE LNqtdDias, LNidxDia, LNidxData, LNindice
	PRIVATE LNqtvenda, LNsoma

	PRIVATE LSalias
	LSalias			= ALIAS()
	*---------------------------------------------------------------*
	=IMVerifyInst()
	*---------------------------------------------------------------*
    LNqtdDias = PrmDt_Final - PrmDt_Inicial

    DIMENSION Vdata[ LNqtdDias + 1 ]
    DIMENSION Vvendas[ LNqtdDias + 1]
    DIMENSION VSaldo[ LNqtdDias + 1]
    store 0 to Vvendas
    store 0 to VSaldo
	*---------------------------------------------------------------*
	
	=IMDadosGiro()

	*---------------------------------------------------------------*
	DO WHILE LNidxDia <= LNqtdDias
		IF Vvendas[ LNidxDia ] + Vsaldo[ LNidxDia ] > 0
			LNsoma =  LNsoma + Vvendas[ LNidxDia ]
			LNDiasReal = LNDiasReal + 1
		ENDIF
		LNidxDia  = LNidxDia + 1
	ENDDO
	LNgiro	= LNsoma / LNDiasReal
	*------------------------------------------------------------------*

	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF

RETURN(LNgiro)




*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4900MZENG           IMgiroTendenciaLJ VALID            
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         ITEMMOV,     Record Number:    7   
*        Variable:            IMgiroTendenciaLJ                  
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      21                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _4900mzeng     &&  IMgiroTendenciaLJ VALID
#REGION 2
RETURN

**********************************************************************
* exemplo chamada
* 		set procedure to itemmov.spr
*		?IMgiroLJ(1,"13011014   ",date()-100,date())

*******************************************************************

FUNCTION IMgiroTendenciaLJ
	PARAMETERS PrmLoja,PrmCodigo,PrmDt_Inicial,PrmDt_Final
	
	=W_DEFPROC("rotinas.spr")
    PRIVATE LNgiro
    PRIVATE LNqtdDias, LNidxDia, LNidxData, LNindice
	PRIVATE LNqtvenda, LNsoma

	PRIVATE LSalias
	LSalias			= ALIAS()
	*---------------------------------------------------------------*
	=IMVerifyInst()
	*---------------------------------------------------------------*
    LNqtdDias = PrmDt_Final - PrmDt_Inicial

    DIMENSION Vdata[ LNqtdDias + 2 ]
    DIMENSION Vvendas[ LNqtdDias + 2]
    DIMENSION VSaldo[ LNqtdDias + 2]
    store 0 to Vvendas
    store 0 to VSaldo
	*---------------------------------------------------------------*
	
	=IMDadosGiro()

	*---------------------------------------------------------------*

	*------------------------------------------------*
	&& 1 - Faixa Completa = Giro total
	*------------------------------------------------*


    LNDiasReal = 0		&& Dias considerados para giro
    LNidxDia = 1
	LNsoma = 0

	DO WHILE LNidxDia <= LNqtdDias
		IF Vvendas[ LNidxDia ] + Vsaldo[ LNidxDia ] > 0
			LNsoma =  LNsoma + Vvendas[ LNidxDia ]
			LNDiasReal = LNDiasReal + 1
		ENDIF
		LNidxDia  = LNidxDia + 1
	ENDDO

    IF LNDiasReal < (LNqtdDias * 0.7) 	
		LNDiasReal = LNqtdDias
	ENDIF

    IF LNDiasReal > 0 	
		LNgiro100 = LNsoma / LNDiasReal
	ELSE
		LNgiro100 = -99
	ENDIF

	*------------------------------------------------*
	&& 2 - Ultima metade do Periodo 50 %
	*------------------------------------------------*
    LNDiasReal = 1		&& Dias considerados para giro
	LNidxDia = LNqtdDias - INT(LNqtdDias / 2)
	LNsoma = 0

	DO WHILE LNidxDia <= LNqtdDias
		IF Vvendas[ LNidxDia ] + Vsaldo[ LNidxDia ] > 0
			LNsoma =  LNsoma + Vvendas[ LNidxDia ]
			LNDiasReal = LNDiasReal + 1
		ENDIF
		LNidxDia  = LNidxDia + 1
	ENDDO

    IF LNDiasReal < (INT(LNqtdDias / 2) * 0.7) 	
		LNDiasReal = INT(LNqtdDias / 2)
	ENDIF

    IF LNDiasReal > 0		&& Dias considerados para giro
		LNgiro50 = LNsoma / LNDiasReal
	ELSE
		LNgiro50 = -99
	ENDIF

	*------------------------------------------------*
	&& 3 - Ultima Quarto do Periodo 25 %
	*------------------------------------------------*
    LNDiasReal = 1		&& Dias considerados para giro
	LNidxDia = LNqtdDias - INT(LNqtdDias / 4)
	LNsoma = 0

	DO WHILE LNidxDia <= LNqtdDias
		IF Vvendas[ LNidxDia ] + Vsaldo[ LNidxDia ] > 0
			LNsoma =  LNsoma + Vvendas[ LNidxDia ]
			LNDiasReal = LNDiasReal + 1
		ENDIF
		LNidxDia  = LNidxDia + 1
	ENDDO

    IF LNDiasReal < (INT(LNqtdDias / 4) * 0.7) 	
		LNDiasReal = INT(LNqtdDias / 4)
	ENDIF

    IF LNDiasReal > 0		&& Dias considerados para giro
		LNgiro25 = LNsoma / LNDiasReal
	ELSE
		LNgiro25 = -99
	ENDIF


	DO CASE
			CASE LNgiro100 >= 0 AND LNgiro50 >= 0 AND LNgiro25 >=0
				LNgiro	= (LNgiro100 * 1 + ;
						  LNgiro50 * 1 + ;
						  LNgiro25 * 1) /  3

			CASE LNgiro100 < 0			&& nenhum dia com estoque
				LNgiro  = -1
			OTHERWISE
				LNgiro  = LNgiro100
	ENDCASE


	IF LNgiro = -1 AND Vsaldo[ LNqtdDias  ] = 0	&& NEM GIRO NEM SALDO
		LNgiro = 0
	ENDIF


	*------------------------------------------------------------------*

	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF

RETURN(LNgiro)




*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4900MZENH           IMDadosGiro VALID                  
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         ITEMMOV,     Record Number:    8   
*        Variable:            IMDadosGiro                        
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      22                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _4900mzenh     &&  IMDadosGiro VALID
#REGION 2
RETURN

**********************************************************************
*******************************************************************

FUNCTION IMDadosGiro

	LNidxDia = 1
	LNidxData = PrmDt_Inicial
	
	
	DO WHILE LNidxData <= PrmDt_final && VETOR MONTADO EM ORDEM CRESCENTE
									  && DE DATA
	    Vdata[ LNidxDia ] =  LNidxData		
	    VSaldo[ LNidxDia ] =  - 1
		LNidxDia  = LNidxDia + 1
		LNidxData = LNidxData + 1
	ENDDO
	*------------- preenchimento do vetor de saldos  -----------------*

	LNidxDia = 1
	LNidxData = PrmDt_Inicial

	*------------------------------------------------------------------*
	SELE &PBItemmovAlias
	SET ORDER TO  TAG movimento
	=IMPosicItemmov(PrmLoja,PrmCodigo,PrmDt_Inicial)


	DO WHILE &PBItemmovAlias .data < PrmDt_Final AND ;
			 &PBItemmovAlias .empresa = PrmLoja AND ;
			 &PBItemmovAlias .codigo  = PrmCodigo && DESCONSIDERA DATA BASE

		LNidxData  = &PBItemmovAlias .data
		*-------------------------------------------------------------*
		IF LEFT( &PBItemmovAlias .operacao,1) = "S"
			IF  &PBItemmovAlias .movestq = "S"
			    LNsaldo = &PBItemmovAlias .qtde + &PBItemmovAlias .sld_estq
			ELSE
			    LNsaldo = &PBItemmovAlias .sld_estq
			ENDIF			
		ELSE
			IF  &PBItemmovAlias .movestq = "S"
			    LNsaldo = &PBItemmovAlias .sld_estq - &PBItemmovAlias .qtde
			ELSE
			    LNsaldo = &PBItemmovAlias .sld_estq
			ENDIF			
		ENDIF
		*---------------------------------------------------------*

		LNindice = ASCAN(Vdata,LNidxData)
    	VSaldo[ LNindice ]  = LNsaldo
		LNidxData = LNidxData + 1

		*---------------------------------------------------------*
		SELE &PBItemmovAlias
		SET ORDER TO  TAG movimento
		=IMPosicItemmov(PrmLoja,PrmCodigo,LNidxData)
	ENDDO
	*-----------------------------------------------------------------*

	LNidxDia = 1
	LNidxData = PrmDt_Inicial

	*------------------------------------------------------------------*
	SELE &PBItemmovAlias
	SET ORDER TO  TAG movimento
	SET NEAR ON
	SEEK STR(PrmLoja,3)+PrmCodigo+DTOS(PrmDt_Inicial)
	SET NEAR OFF

	DO WHILE &PBItemmovAlias .data < PrmDt_Final AND ;
			 &PBItemmovAlias .empresa = PrmLoja AND ;
			 &PBItemmovAlias .codigo  = PrmCodigo && DESCONSIDERA DATA BASE
		***********************************************************
		*  DESPREZANDO VENDAS P/ CLIENTES => VENDA CASADA
		*          NAO PODEM AFETAR O GIRO
		***********************************************************
		**  QUEBRA POR DATA

	 	LNqtvenda  = 0
		LNqtvdrev  = 0
		LDqbrData  = &PBItemmovAlias .data

		DO WHILE &PBItemmovAlias .data    = LDqbrData AND ;
			     &PBItemmovAlias .empresa = PrmLoja AND ;
			     &PBItemmovAlias .codigo  = PrmCodigo
			     						&& DESCONSIDERA DATA BASE

			IF LEFT( &PBItemmovAlias .operacao,1) = 'S' AND ;
				&PBItemmovAlias .ch_opera = "1" 	  AND ;
				&PBItemmovAlias .negociacao = 2			&& VENDA CASADA
				SELE &PBItemmovAlias
				SKIP
				LOOP
			ENDIF
			***********************************************************
			*  EXISTEM TRATAMENTOS DIFERENCIADOS PARA IDL E AS OUTRAS
			***********************************************************
			DO CASE
				CASE &PBItemmovAlias .empresa = 10
					******************************************************
					*  PARA DETERMINAR QTDE VENDA  E ATEND. P/ NAO REV  *
					*****************************************************
					IF LEFT( &PBItemmovAlias .operacao,1) = 'S'
						IF &PBItemmovAlias .movestq = "S"
						 	LNqtvenda  = LNqtvenda  + &PBItemmovAlias .qtde
						ENDIF
					ENDIF
				OTHERWISE
					******************************************************
					* PARA DETERMINAR QTDE VENDIDA						  *
					******************************************************
					IF LEFT( &PBItemmovAlias .operacao,1) = 'S' AND ;
							 &PBItemmovAlias .ch_opera    = "1"
						IF &PBItemmovAlias .movestq = "S"
						 	LNqtvenda  = LNqtvenda  + &PBItemmovAlias .qtde
						ENDIF
					ENDIF
			ENDCASE

			***********************************************************
			*  ABATENDO DEVOLUCOES
			***********************************************************
			IF LEFT( &PBItemmovAlias .operacao,1) = 'E'  AND ;
					 &PBItemmovAlias .ch_opera    = "4"  AND ;
					 &PBItemmovAlias .movestq     = "S"

		 		LNqtvenda  = LNqtvenda  - &PBItemmovAlias .qtde
			    IF LNqtvenda < 0
	 				LNqtvenda = 0
	 			ENDIF
			ENDIF
			skip
		ENDDO
		LNindice = ASCAN(Vdata,LDqbrData)
    	Vvendas[ LNindice ]  = LNqtvenda

	ENDDO

*-------------------------------------------------------------------*
*----- DISTRIBUICAO DO ESTOQUE  P DIAS Q NA TIVERAM MOVIMENTO -----*
*-------------------------------------------------------------------*
   LNidxDia   = LNqtdDias
   LNsaldoDia=IMGetSaldo(PrmLoja,PrmCodigo,Vdata[ LNidxDia ])


	DO WHILE LNidxDia >= 1
		IF  VSaldo[ LNidxDia ]  = -1
			VSaldo[ LNidxDia ]  = LNsaldoDia
		ENDIF
	   	LNsaldoDia = VSaldo[ LNidxDia ]
		LNidxDia  = LNidxDia - 1
	ENDDO
*-------------------------------------------------------------------*


RETURN




*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4900MZENI           OLDIMGiroControle VALID            
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         ITEMMOV,     Record Number:   10   
*        Variable:            OLDIMGiroControle                  
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      23                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _4900mzeni     &&  OLDIMGiroControle VALID
#REGION 2
RETURN

**********************************************************************

FUNCTION OLDIMGiroControle
PARAMETERS PrmOrdIni, PrmOrdFim, PrmControl,PrmPerfil_01


	=W_DEFPROC("rotinas.spr")
	PRIVATE LSalias
	LSalias			= ALIAS()
	*------------------------------------------------------------------*
	SET TALK ON
	SELECT GRP.ORDEM,GRP.CODIGO ,GRP.CLASSIFICA,GRP.DESCRICAO,;
	1.000*IMgiroTendenciaLJ(1,GRP.CODIGO, DATE()-100,DATE()) AS GRO_GYN,;
		IMGetSaldo(1,GRP.Codigo, DATE()) AS SLD_GYN, ;
	1.000*IMgiroTendenciaLJ(2,GRP.CODIGO,DATE()-100,DATE()) AS GRO_SIA,;
		IMGetSaldo(2,GRP.Codigo, DATE()) AS SLD_SIA, ;
	1.000*IMgiroTendenciaLJ(3,GRP.CODIGO,DATE()-100,DATE()) AS GRO_W3,;
		IMGetSaldo(3,GRP.Codigo, DATE()) AS SLD_W3, ;
	1.000*IMgiroTendenciaLJ(4,GRP.CODIGO,DATE()-100,DATE()) AS GRO_BGS,;
		IMGetSaldo(4,GRP.Codigo, DATE()) AS SLD_BGS, ;
	1.000*IMgiroTendenciaLJ(5,GRP.CODIGO,DATE()-100,DATE()) AS GRO_IPG,;
		IMGetSaldo(5,GRP.Codigo, DATE()) AS SLD_IPG, ;
	1.000*IMgiroTendenciaLJ(6,GRP.CODIGO,DATE()-100,DATE()) AS GRO_CGB,;
		IMGetSaldo(6,GRP.Codigo, DATE()) AS SLD_CGB, ;
	1.000*IMgiroTendenciaLJ(7,GRP.CODIGO,DATE()-100,DATE()) AS GRO_T63,;
		IMGetSaldo(7,GRP.Codigo, DATE()) AS SLD_T63, ;
	1.000*IMgiroTendenciaLJ(8,GRP.CODIGO,DATE()-100,DATE()) AS GRO_ARG,;
		IMGetSaldo(8,GRP.Codigo, DATE()) AS SLD_ARG, ;
	1.000*IMgiroTendenciaLJ(9,GRP.CODIGO,DATE()-100,DATE()) AS GRO_IDP,;
		IMGetSaldo(9,GRP.Codigo, DATE()) AS SLD_IDP ;
    FROM  Q:\SCGC\COMUM\GRUPO GRP;
         ,Q:\SCGC\COMUM\FORNECE FR;
   	WHERE GRP.ORDEM >= PrmOrdIni AND GRP.ORDEM <= PrmOrdFim  ;
			 AND STR(GRP.tp_control,1) $ PrmControl ;
			 AND ALLTRIM(GRP.Perfil_01) $ PrmPerfil_01 ;
			 AND GRP.cdg_tipo  = 4 ;
			 AND  (;
			 	  	(!(LEFT(GRP.classifica,02) $ "00/01") AND ;
	             	 !(LEFT(GRP.classifica,05) $ "04042") ;
	              	);
				  OR ;			
			 	    ( (LEFT(GRP.classifica,02) $ "00/01" OR ;
	             	 LEFT(GRP.classifica,05) $ "04042") AND ;
	              	 GRP.codforn = 1;
	              	);
	              );
   	INTO CURSOR TMPG_1




	SELECT GRP.ORDEM,GRP.CODIGO ,GRP.CLASSIFICA,GRP.DESCRICAO,;
	1.000*IMgiroTendenciaLJ(11,GRP.CODIGO,DATE()-100,DATE()) AS GRO_DPO,;
		IMGetSaldo(11,GRP.Codigo, DATE()) AS SLD_DPO, ;
	1.000*IMgiroTendenciaLJ(14,GRP.CODIGO,DATE()-100,DATE()) AS GRO_ANP,;
		IMGetSaldo(14,GRP.Codigo, DATE()) AS SLD_ANP, ;
	1.000*IMgiroTendenciaLJ(10,GRP.CODIGO,DATE()-100,DATE()) AS GRO_IDL, ;
		IMGetSaldo(10,GRP.Codigo, DATE()) AS SLD_IDL, ;
	1.000*IMgiroTendenciaLJ(17,GRP.CODIGO,DATE()-100,DATE()) AS GRO_ABO, ;
		IMGetSaldo(17,GRP.Codigo, DATE()) AS SLD_ABO, ;
	1.000*IMgiroTendenciaLJ(19,GRP.CODIGO,DATE()-100,DATE()) AS GRO_SMA, ;
		IMGetSaldo(19,GRP.Codigo, DATE()) AS SLD_SMA, ;
	1.000*IMgiroTendenciaLJ(30,GRP.CODIGO,DATE()-100,DATE()) AS GRO_CNB, ;
		IMGetSaldo(30,GRP.Codigo, DATE()) AS SLD_CNB ;
    FROM Q:\SCGC\COMUM\GRUPO GRP;
   	WHERE GRP.ORDEM >= PrmOrdIni AND GRP.ORDEM <= PrmOrdFim  ;
			 AND STR(GRP.tp_control,1) $ PrmControl ;
			 AND ALLTRIM(GRP.Perfil_01) $ PrmPerfil_01 ;
			 AND GRP.cdg_tipo  = 4 ;
			 AND  (;
			 	  	(!(LEFT(GRP.classifica,02) $ "00/01") AND ;
	             	 !(LEFT(GRP.classifica,05) $ "04042") ;
	              	);
				  OR ;			
			 	    ( (LEFT(GRP.classifica,02) $ "00/01" OR ;
	             	 LEFT(GRP.classifica,05) $ "04042") AND ;
	              	 GRP.codforn = 1;
	              	);
	              );
   	INTO CURSOR TMPG_2



		SELECT T1.ORDEM,T1.CODIGO ,T1.CLASSIFICA,T1.DESCRICAO,;
	T1.GRO_GYN,;
	T1.SLD_GYN, ;
	T1.GRO_SIA,;
	T1.SLD_SIA, ;
	T1.GRO_W3,;
	T1.SLD_W3, ;
	T1.GRO_BGS,;
	T1.SLD_BGS, ;
	T1.GRO_IPG,;
	T1.SLD_IPG, ;
	T1.GRO_CGB,;
	T1.SLD_CGB, ;
	T1.GRO_T63,;
	T1.SLD_T63, ;
	T1.GRO_ARG,;
	T1.SLD_ARG, ;
	T1.GRO_IDP,;
	T1.SLD_IDP, ;
	T2.GRO_DPO,;
	T2.SLD_DPO, ;
	T2.GRO_ANP,;
	T2.SLD_ANP, ;
	T2.GRO_IDL, ;
	T2.SLD_IDL, ;
	T2.GRO_ABO, ;
	T2.SLD_ABO, ;
	T2.GRO_SMA, ;
	T2.SLD_SMA, ;
	T2.GRO_CNB, ;
	T2.SLD_CNB ;
	    FROM   TMPG_1 T1 ;
	         , TMPG_2 T2;
    WHERE ;
	      T1.ORDEM = T2.ORDEM ;
	  AND T1.CODIGO = T2.CODIGO ;
   	INTO CURSOR TMPGRO1




	SELECT TMPGRO1.*, ;
		IMDura((sld_gyn+sld_DPO),(gro_gyn+gro_DPO))  AS dura_gyn,;
		IMDura((sld_sia+sld_CNB),(gro_sia+gro_CNB))  AS dura_sia,;
		IMDura(sld_w3 ,gro_w3 )  AS dura_w3 ,;
		IMDura((sld_bgs+sld_ABO),(gro_bgs+gro_ABO))  AS dura_bgs,;
		IMDura(sld_ipg,gro_ipg)  AS dura_ipg,;
		IMDura(sld_cgb,gro_cgb)  AS dura_cgb,;
		IMDura((sld_arg+sld_SMA),(gro_arg+gro_SMA))  AS dura_arg,;
		IMDura(sld_anp,gro_anp)  AS dura_anp,;
		IMDura(sld_idp,gro_idp)  AS dura_idp,;
		IMDura(sld_T63,gro_T63)  AS dura_T63,;
		IMDura(0,0)        AS dura_DPO,;
		IMDura(0,0)        AS dura_CNB,;
		IMDura(0,0)        AS dura_SMA,;
		IMDura(sld_idl,gro_idl)  AS dura_idl,;
		IMDura(0,0)        AS dura_ABO;
	FROM TMPGRO1 ;
   	INTO CURSOR TMPGRO2 ;
    ORDER BY ORDEM
	SET TALK OFF
	

RETURN("TMPGRO2")


FUNCTION OLDIMDura
PARAMETERS PrmSaldo,PrmGiro
Private LNDura
	DO CASE
		CASE PrmGiro = 0
			IF PrmSaldo > 0
				LNDura   = 999
			ELSE
				LNDura   = 0
			ENDIF		
		OTHERWISE
			IF PrmSaldo > 0
				LNDura   = PrmSaldo / PrmGiro
				IF LNDura > 999
					LNDura   = 999
				ENDIF				
			ELSE
				LNDura   = 0
			ENDIF
	ENDCASE
RETURN(LNDura)




*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4900MZEOD           IMGetVlrEstq VALID                 
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         ITEMMOV,     Record Number:   11   
*        Variable:            IMGetVlrEstq                       
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      24                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4900mzeod     &&  IMGetVlrEstq VALID
#REGION 2
return
*---------------------------------------------------------------*

FUNCTION IMGetVlrEstq
PARAMETERS PrmEmp, PrmCodigo, PrmData, PrmHora

	=W_DEFPROC("ROTINAS.SPR")

	PRIVATE LNVlrEstq
	PRIVATE LSalias
	LSalias		= 	ALIAS()
	IF TYPE("PrmHora") <> "C"
	    PrmHora = "99:99:99"
	ENDIF

	=IMVerifyInst()
	*----------------------------------------------------------------*
	SELE &PBItemmovAlias
	SET ORDER TO TAG movimento
	SET NEAR ON
	SEEK STR(PrmEmp,3)+PrmCodigo+dtos(PrmData)+PrmHora
										&& POSICIONA A FRENTE PARA
										&& VOLTAR E PEGAR SALDO DE
										&& FECHAMENTO OU ATUAL DO DIA
	SET NEAR OFF
	IF BOF() AND EOF()       && ITEMMOV ESTA VAZIO
		=W_DEFPROC("SALDO.SPR")
		LNVlrEstq = SLGetVlrEstq(PrmEmp, PrmData, PrmCodigo)
	ELSE
		SKIP -1
		IF BOF() OR PrmCodigo <> &PBItemmovAlias .codigo ;
			 	 OR PrmEmp    <> &PBItemmovAlias .empresa
			=W_DEFPROC("SALDO.SPR")
			LNVlrEstq = SLGetVlrEstq(PrmEmp, PrmData, PrmCodigo)
		ELSE
	    	IF &PBItemmovAlias .sld_estq = 0
	    		LNVlrEstq   = 0
	    	ELSE
				LNVlrEstq   =	&PBItemmovAlias .vlr_estq
			ENDIF
		ENDIF
	ENDIF
	*--------------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(LNVlrEstq)


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4900MZEOK           IMPosicItemmov VALID               
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         ITEMMOV,     Record Number:   12   
*        Variable:            IMPosicItemmov                     
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      25                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _4900mzeok     &&  IMPosicItemmov VALID
#REGION 2
RETURN

**********************************************************************
*******************************************************************

FUNCTION IMPosicItemmov
PARAMETERS PrmLoja,PrmCodigo,PrmData

	*------------------------------------------------------------------*
	SELE &PBItemmovAlias
	SET ORDER TO  TAG movimento
	SET NEAR ON
	SEEK STR(PrmLoja,3)+PrmCodigo+DTOS(PrmData+1)
	SET NEAR OFF

	IF  &PBItemmovAlias .data <> PrmDt_Final OR  ;
	    &PBItemmovAlias .empresa <> PrmLoja OR ;
		&PBItemmovAlias .codigo  <> PrmCodigo
		skip -1
	endif
	IF  &PBItemmovAlias .data < PrmData
		skip
	endif
	
RETURN




*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4900MZEOR           IMVerifyInst VALID                 
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         ITEMMOV,     Record Number:   14   
*        Variable:            IMVerifyInst                       
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      26                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4900mzeor     &&  IMVerifyInst VALID
#REGION 2
return
*---------------------------------------------------------------*



FUNCTION IMVerifyInst
PRIVATE LSpath

	=W_DEFPROC("rotinas.spr")
	LSpath = UPobterPath("ITEMMOV")


	DO CASE

		CASE TYPE("PBItemMovAlias") = "U" ;
		   		OR EMPTY(PBItemMovAlias) ;
		   		OR !USED(PBItemMovAlias)
			=IMCreate()					

		CASE !("ITEMMOV.DBF" $ DBF(PBItemMovAlias))
				* APOS UM CLOSE DATABASE UM OUTRO DBF FOI
				* ABERTO NA AREA ANTES OCUPADA PELO DBF AVALIADO AKI
				RELEASE PBItemMovAlias
			=IMCreate()					


		CASE  !(LSPath $ DBF(PBItemMovAlias))
			 	* HOUVE MUDANCA DE DIR BASE
			 	* ELIMINA INSTACIA DE OUTRA BASE
		     	* CRIA INSTANCIA NA NOVA BASE
			=IMDestroi()				
			=IMCreate()					
	ENDCASE
RETURN(.t.)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4900MZEOX           IMCreate VALID                     
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         ITEMMOV,     Record Number:   15   
*        Variable:            IMCreate                           
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      27                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4900mzeox     &&  IMCreate VALID
#REGION 2
return
*---------------------------------------------------------------*

FUNCTION IMCreate
	=W_DEFPROC("rotinas.spr")
	PRIVATE LSalias
	PRIVATE LSAlsTmp
    PRIVATE LMaxDim
	LSalias		= 	ALIAS()
	
	IF TYPE("PBItemMovAlias") <> "U" ;
	   		AND !EMPTY(PBItemMovAlias) ;
	   		AND USED(PBItemMovAlias)
			RETURN(.T.)
	ENDIF


	PUBLIC PBItemMovAlias

	IF USED("ItemMov")
	     =NetArqAgain("ItemMov")
	     PBItemMovAlias     = Alias()
	ELSE
	     =NetArqAgain("ItemMov")
	     LSAlsTmp     = Alias()
	     =NetArqAgain("ItemMov")
	     PBItemMovAlias     = Alias()
		 IF !EMPTY(LSAlsTmp) AND USED(LSAlsTmp)
			SELECT &LSAlsTmp
			USE
		 ENDIF
	ENDIF	

    SELE &PBItemMovAlias
	LMaxDim = Fcount()
    PUBLIC DIMENSION VTItemMov[LMaxDim]
    PUBLIC DIMENSION VDItemMov[2,3]			&& VETOR PARA PROPRIEDADES
	*-----------------------------------------------------------*
	=IMReadProperty()
	=IMSetDerivadas()
	*--------------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4900MZEOY           IMDestroi VALID                    
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         ITEMMOV,     Record Number:   16   
*        Variable:            IMDestroi                          
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      28                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4900mzeoy     &&  IMDestroi VALID
#REGION 2
return
*---------------------------------------------------------------*


FUNCTION IMDestroi

	=W_DEFPROC("rotinas.spr")

	IF TYPE("PBItemMovAlias") = "U"
		RETURN
	ENDIF

    *--------------------------------------------------------------------*
	*-> QUANDO O SISTEMA APLICA UM CLOSE DATABASE :
	*   EX: EM UPAltDir (Geral.spr)
	*  1- Fecha inclusive a referencia do PBDocFiscaAlias
	*  2- Novas tabelas abertas podem ocupar a area referenciada
	*     por PBDocFiscaAlias
	*  3- Se aplicar um FECHAMENTO a PBDocFiscaAlias estara fechando
	*     outra tabela
	*  4- Entao Verifica-se a coerencia do dbf esperado em PBDocFiscaAlias
	*-------------------------------------------------------------------*
	IF !(USED(PBItemMovAlias)) OR ;
	   !("ITEMMOV.DBF" $ DBF(PBItemMovAlias))

		RELEASE PBItemMovAlias
    	RELEASE VTItemMov
	    RELEASE VDItemMov
		return(.T.)			
	ENDIF
	PRIVATE LSalias
	LSalias  = Alias()
	IF !EMPTY(PBItemMovAlias) AND USED(PBItemMovAlias)
		SELECT &PBItemMovAlias
		USE
	ENDIF	
	RELEASE PBItemMovAlias
    RELEASE VTItemMov
    RELEASE VDItemMov

	*--------------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(.T.)


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4900MZEOZ           IMReadProp VALID                   
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         ITEMMOV,     Record Number:   17   
*        Variable:            IMReadProp                         
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      29                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4900mzeoz     &&  IMReadProp VALID
#REGION 2
return
*---------------------------------------------------------------*

FUNCTION IMReadProp
	PRIVATE LSalias
	LSalias		= 	ALIAS()

	=IMVerifyInst()

	SELE &PBItemMovAlias
	SCATTER TO VTItemMov
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(.T.)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4900MZEP0           IMSetDerivadas VALID               
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         ITEMMOV,     Record Number:   18   
*        Variable:            IMSetDerivadas                     
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      30                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4900mzep0     &&  IMSetDerivadas VALID
#REGION 2
return
*---------------------------------------------------------------*

FUNCTION IMSetDerivadas
	PRIVATE LSalias
	PRIVATE LEmpresa
	LSalias		= 	ALIAS()

	=IMVerifyInst()
	*--------------------------------------------------------------*
    VDItemMov(1,1) = "NAOINFORMADO"
   	VDItemMov(1,2) = 0
   	VDItemMov(1,3) = .F.
	*--------------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(.T.)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4900MZEPQ           IMSetPropVT VALID                  
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         ITEMMOV,     Record Number:   19   
*        Variable:            IMSetPropVT                        
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      31                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4900mzepq     &&  IMSetPropVT VALID
#REGION 2
return
*---------------------------------------------------------------*

FUNCTION IMSetPropVT
PARAMETER  PrmField, PrmValue
	PRIVATE Lvalue

	=IMVerifyInst()
	=W_DEFPROC("ROTINAS.SPR")
	Lvalue = RTsetValueObj(PrmField,PrmValue,;
						    PBItemMovAlias,VTItemMov,VDItemMov)

RETURN(Lvalue)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4900MZEPX           IMGetPropVT VALID                  
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         ITEMMOV,     Record Number:   20   
*        Variable:            IMGetPropVT                        
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      32                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4900mzepx     &&  IMGetPropVT VALID
#REGION 2
return
*---------------------------------------------------------------*

FUNCTION IMGetPropVT
PARAMETER  PrmField

	PRIVATE Lvalue

	=IMVerifyInst()
	=W_DEFPROC("ROTINAS.SPR")
	Lvalue = RTgetValueObj(PrmField,PBItemMovAlias,VTItemMov,VDItemMov)

RETURN(Lvalue)





*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4900MZEQ4           IMChk_Identidade VALID             
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         ITEMMOV,     Record Number:   21   
*        Variable:            IMChk_Identidade                   
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      33                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4900mzeq4     &&  IMChk_Identidade VALID
#REGION 2
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION IMChk_Identidade
PARAMETERS 	PrmEmp, ;
			PrmCodigo,;
			PrmData,;
			PrmHora,;
			PrmTipo,;
			PrmNota,;
			PrmOrdem

	PRIVATE LFretorno
	LFretorno = .t.

	=IMVerifyInst()
	*----------------------------------------------------------------*

    =IMSetPropVT("EMPRESA",PrmEmp)
    =IMSetPropVT("CODIGO",PrmCodigo)
    =IMSetPropVT("DATA",PrmData)
    =IMSetPropVT("HORA",PrmHora)
    =IMSetPropVT("TIPO",PrmTipo)
    =IMSetPropVT("NOTA",PrmNota)
    =IMSetPropVT("ORDEM",PrmOrdem)
	LFretorno=IMFind()
RETURN(LFretorno)


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4900MZEQA           IMFind VALID                       
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         ITEMMOV,     Record Number:   22   
*        Variable:            IMFind                             
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      34                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4900mzeqa     &&  IMFind VALID
#REGION 2
return
*---------------------------------------------------------------*

FUNCTION IMFind
	PRIVATE LEmp, LCodigo,LData,LHora,LTipo,LNota,;
			LOrdem
	PRIVATE LFreturn

	PRIVATE LSalias
	LSalias		= 	ALIAS()

	=IMVerifyInst()

	LEmp 		 = IMGetPropVT("EMPRESA")
	LCodigo	 	 = IMGetPropVT("CODIGO")
	LData  	 	 = IMGetPropVT("DATA")
	LHora  	 	 = IMGetPropVT("HORA")
	LTipo   	 = IMGetPropVT("TIPO")
	LNota        = IMGetPropVT("NOTA")
	LOrdem       = IMGetPropVT("ORDEM")

	SELE &PBItemmovAlias
	SET ORDER TO TAG MOVIMENTO
	SEEK STR(LEmp,3)+Lcodigo+DTOS(Ldata)+;
			Lhora+Ltipo+STR(Lnota,7)+STR(Lordem,3)
	IF FOUND()
		=IMReadProperty()
		=IMSetDerivadas()   && carga dos calculos derivados
	    LFreturn = .T.
	ELSE
	    LFreturn = .f.
	ENDIF
	*--------------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(LFreturn)


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4900MZEQH           IMGetFieldValue VALID              
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         ITEMMOV,     Record Number:   23   
*        Variable:            IMGetFieldValue                    
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      35                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4900mzeqh     &&  IMGetFieldValue VALID
#REGION 2
return
*---------------------------------------------------------------*

FUNCTION IMGetFieldValue
PARAMETERS 	PrmEmp, ;
			PrmCodigo,;
			PrmData,;
			PrmHora,;
			PrmTipo,;
			PrmNota,;
			PrmOrdem,;
			PrmField

	=IMChk_Identidade(;
			PrmEmp, ;
			PrmCodigo,;
			PrmData,;
			PrmHora,;
			PrmTipo,;
			PrmNota,;
			PrmOrdem)

RETURN(IMGetPropVT(PrmField))


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4900MZEQI           IM_Refresh VALID                   
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         ITEMMOV,     Record Number:   24   
*        Variable:            IM_Refresh                         
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      36                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4900mzeqi     &&  IM_Refresh VALID
#REGION 2
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION IMChk_Identidade
PARAMETERS 	PrmEmp, ;
			PrmCodigo,;
			PrmData,;
			PrmHora,;
			PrmTipo,;
			PrmNota,;
			PrmOrdem

	PRIVATE LFretorno
	LFretorno = .t.

	=IMVerifyInst()
	*----------------------------------------------------------------*

    =IMSetPropVT("EMPRESA",PrmEmp)
    =IMSetPropVT("CODIGO",PrmCodigo)
    =IMSetPropVT("DATA",PrmData)
    =IMSetPropVT("HORA",PrmHora)
    =IMSetPropVT("TIPO",PrmTipo)
    =IMSetPropVT("NOTA",PrmNota)
    =IMSetPropVT("ORDEM",PrmOrdem)
	LFretorno=IMFind()
RETURN(LFretorno)





*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4900MZEQJ           IMLerRegistro VALID                
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         ITEMMOV,     Record Number:   26   
*        Variable:            IMLerRegistro                      
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      37                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4900mzeqj     &&  IMLerRegistro VALID
#REGION 2
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION IMLerRegistro
PARAMETERS 	PrmEmp, ;
			PrmCodigo,;
			PrmData,;
			PrmHora,;
			PrmTipo,;
			PrmNota,;
			PrmOrdem



	PRIVATE LFretorno
	LFretorno = .t.

	LFretorno = IMChk_Identidade(;
	 		PrmEmp, ;
			PrmCodigo,;
			PrmData,;
			PrmHora,;
			PrmTipo,;
			PrmNota,;
			PrmOrdem)
RETURN(LFretorno)




*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4900MZEQK           IMWriteProp VALID                  
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         ITEMMOV,     Record Number:   27   
*        Variable:            IMWriteProp                        
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      38                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4900mzeqk     &&  IMWriteProp VALID
#REGION 2
return
*---------------------------------------------------------------*

FUNCTION IMWriteProp
	PRIVATE LSalias
	LSalias		= 	ALIAS()

	=IMVerifyInst()

	SELE &PBItemMovAlias
	=RLOCK()
	GATHER FROM  VTItemMov
	UNLOCK

	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF

RETURN(.T.)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4900MZEQL           IMSalvarRegistro VALID             
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         ITEMMOV,     Record Number:   28   
*        Variable:            IMSalvarRegistro                   
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      39                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4900mzeql     &&  IMSalvarRegistro VALID
#REGION 2
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION IMSalvarRegistro

	=IMVerifyInst()

	PRIVATE LFretorno
	LFretorno = .t.

	IF !IMExiste()
		SELE &PBItemMovAlias
		APPEND BLANK
		LFretorno=IMWriteProp()
	ELSE
		SELE &PBItemMovAlias
		LFretorno=IMWriteProp()
	ENDIF

RETURN(LFretorno)




*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4900MZERG           IMExiste VALID                     
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         ITEMMOV,     Record Number:   29   
*        Variable:            IMExiste                           
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      40                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4900mzerg     &&  IMExiste VALID
#REGION 2
return
*---------------------------------------------------------------*

FUNCTION IMExiste


	PRIVATE LEmp, ;
			LCodigo,;
			LData,;
			LHora,;
			LTipo,;
			LNota,;
			LOrdem
	


	PRIVATE LFreturn

	PRIVATE LSalias
	LSalias		= 	ALIAS()

	=IMVerifyInst()

	LEmp        = IMGetPropVT("Empresa")
	LCodigo     = IMGetPropVT("Codigo")
	LData       = IMGetPropVT("Data")
	LHora       = IMGetPropVT("Hora")
	LTipo       = IMGetPropVT("Tipo")
	LNota       = IMGetPropVT("Nota")
	LOrdem      = IMGetPropVT("Ordem")


	SELE &PBItemmovAlias
	SET ORDER TO TAG MOVIMENTO
	SEEK STR(LEmp,3)+Lcodigo+DTOS(Ldata)+;
			Lhora+Ltipo+STR(Lnota,7)+STR(Lordem,3)

	
	IF FOUND()
	    LFreturn = .T.
	ELSE
	    LFreturn = .f.
	ENDIF
	*--------------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(LFreturn)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4900MZERM           IMGetAlias VALID                   
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         ITEMMOV,     Record Number:   31   
*        Variable:            IMGetAlias                         
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      41                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4900mzerm     &&  IMGetAlias VALID
#REGION 2
return
*---------------------------------------------------------------*

FUNCTION IMGetAlias

	=IMVerifyInst()

RETURN(PBItemMovAlias)


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4900MZERT           IMFaxinaDados VALID                
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         ITEMMOV,     Record Number:   32   
*        Variable:            IMFaxinaDados                      
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      42                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4900mzert     &&  IMFaxinaDados VALID
#REGION 2
return
*---------------------------------------------------------------*

FUNCTION IMFaxinaDados

	PRIVATE LSAlias, TOTAL, CTR
	=IMVerifyInst()

	LSAlias = IMGetAlias()
	
	SELE &LSAlias

	COUNT TO TOTAL
	CTR = 0

	GO TOP
	DO WHILE !EOF()
		=RLOCK()


		CTR = 	CTR + 1
		MSG = STR(CTR,7)+" DE "+STR(TOTAL,7)
		WAIT WINDOW MSG NOWAIT


		REPLACE DESCRICAO  WITH UPLimpaString(DESCRICAO)


		SKIP
	ENDDO
	


RETURN(.t.)


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4900MZES0           IMGiroControle VALID               
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         ITEMMOV,     Record Number:   33   
*        Variable:            IMGiroControle                     
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      43                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _4900mzes0     &&  IMGiroControle VALID
#REGION 2
RETURN

**********************************************************************

FUNCTION IMGiroControle
PARAMETERS PrmOrdIni, PrmOrdFim, PrmControl,PrmPerfil_01


	=W_DEFPROC("rotinas.spr")
	PRIVATE LSalias
	LSalias			= ALIAS()
	*------------------------------------------------------------------*



	SET TALK ON
	SELECT GRP.ORDEM,GRP.CODIGO ,GRP.CLASSIFICA,GRP.DESCRICAO,;
	1.000*IMgiroTendenciaLJ(1,GRP.CODIGO, DATE()-100,DATE()) AS GRO_GYN,;
		IMGetSaldo(1,GRP.Codigo, DATE()) AS SLD_GYN, ;
	1.000*IMgiroTendenciaLJ(2,GRP.CODIGO,DATE()-100,DATE()) AS GRO_SIA,;
		IMGetSaldo(2,GRP.Codigo, DATE()) AS SLD_SIA, ;
	1.000*IMgiroTendenciaLJ(3,GRP.CODIGO,DATE()-100,DATE()) AS GRO_W3,;
		IMGetSaldo(3,GRP.Codigo, DATE()) AS SLD_W3, ;
	1.000*IMgiroTendenciaLJ(4,GRP.CODIGO,DATE()-100,DATE()) AS GRO_BGS,;
		IMGetSaldo(4,GRP.Codigo, DATE()) AS SLD_BGS, ;
	1.000*IMgiroTendenciaLJ(5,GRP.CODIGO,DATE()-100,DATE()) AS GRO_IPG,;
		IMGetSaldo(5,GRP.Codigo, DATE()) AS SLD_IPG, ;
	1.000*IMgiroTendenciaLJ(6,GRP.CODIGO,DATE()-100,DATE()) AS GRO_CGB,;
		IMGetSaldo(6,GRP.Codigo, DATE()) AS SLD_CGB, ;
	1.000*IMgiroTendenciaLJ(7,GRP.CODIGO,DATE()-100,DATE()) AS GRO_T63,;
		IMGetSaldo(7,GRP.Codigo, DATE()) AS SLD_T63, ;
	1.000*IMgiroTendenciaLJ(8,GRP.CODIGO,DATE()-100,DATE()) AS GRO_ARG,;
		IMGetSaldo(8,GRP.Codigo, DATE()) AS SLD_ARG, ;
	1.000*IMgiroTendenciaLJ(9,GRP.CODIGO,DATE()-100,DATE()) AS GRO_IDP,;
		IMGetSaldo(9,GRP.Codigo, DATE()) AS SLD_IDP ;
    FROM  Q:\SCGC\COMUM\GRUPO GRP;
         ,Q:\SCGC\COMUM\FORNECE FRN;
   	WHERE GRP.ORDEM >= PrmOrdIni AND GRP.ORDEM <= PrmOrdFim  ;
			 AND STR(GRP.tp_control,1) $ PrmControl ;
			 AND ALLTRIM(GRP.Perfil_01) $ PrmPerfil_01 ;
			 AND GRP.cdg_tipo  = 4 ;
			 AND FRN.CODIGO = GRP.CODFORN ;
			 AND FRN.FZR_PEDIDO = "S" ;
			 AND  (;
			 	  	(!(LEFT(GRP.classifica,02) $ "00/01") AND ;
	             	 !(LEFT(GRP.classifica,05) $ "04042") ;
	              	);
				  OR ;			
			 	    ( (LEFT(GRP.classifica,02) $ "00/01" OR ;
	             	 LEFT(GRP.classifica,05) $ "04042") ;
	              	);
	              );
   	INTO CURSOR TMPG_1




	SELECT GRP.ORDEM,GRP.CODIGO ,GRP.CLASSIFICA,GRP.DESCRICAO,;
	1.000*IMgiroTendenciaLJ(11,GRP.CODIGO,DATE()-100,DATE()) AS GRO_DPO,;
		IMGetSaldo(11,GRP.Codigo, DATE()) AS SLD_DPO,;
	1.000*IMgiroTendenciaLJ(14,GRP.CODIGO,DATE()-100,DATE()) AS GRO_ANP,;
		IMGetSaldo(14,GRP.Codigo, DATE()) AS SLD_ANP,;
	1.000*IMgiroTendenciaLJ(10,GRP.CODIGO,DATE()-100,DATE()) AS GRO_IDL, ;
		IMGetSaldo(10,GRP.Codigo, DATE()) AS SLD_IDL,;
	1.000*IMgiroTendenciaLJ(17,GRP.CODIGO,DATE()-100,DATE()) AS GRO_ABO, ;
		IMGetSaldo(17,GRP.Codigo, DATE()) AS SLD_ABO,;
	1.000*IMgiroTendenciaLJ(19,GRP.CODIGO,DATE()-100,DATE()) AS GRO_SMA, ;
		IMGetSaldo(19,GRP.Codigo, DATE()) AS SLD_SMA,;
	1.000*IMgiroTendenciaLJ(30,GRP.CODIGO,DATE()-100,DATE()) AS GRO_CNB, ;
		IMGetSaldo(30,GRP.Codigo, DATE()) AS SLD_CNB,;
	1.000*IMgiroTendenciaLJ(31,GRP.CODIGO,DATE()-100,DATE()) AS GRO_CNG, ;
		IMGetSaldo(31,GRP.Codigo, DATE()) AS SLD_CNG ;
    FROM Q:\SCGC\COMUM\GRUPO GRP;
         ,Q:\SCGC\COMUM\FORNECE FRN;
   	WHERE GRP.ORDEM >= PrmOrdIni AND GRP.ORDEM <= PrmOrdFim  ;
			 AND STR(GRP.tp_control,1) $ PrmControl ;
			 AND ALLTRIM(GRP.Perfil_01) $ PrmPerfil_01 ;
			 AND GRP.cdg_tipo  = 4 ;
			 AND FRN.CODIGO = GRP.CODFORN ;
			 AND FRN.FZR_PEDIDO = "S" ;
			 AND  (;
			 	  	(!(LEFT(GRP.classifica,02) $ "00/01") AND ;
	             	 !(LEFT(GRP.classifica,05) $ "04042") ;
	              	);
				  OR ;			
			 	    ( (LEFT(GRP.classifica,02) $ "00/01" OR ;
	             	 LEFT(GRP.classifica,05) $ "04042") ;
	              	);
	              );
   	INTO CURSOR TMPG_2



		SELECT T1.ORDEM,T1.CODIGO ,T1.CLASSIFICA,T1.DESCRICAO,;
	T1.GRO_GYN,;
	T1.SLD_GYN, ;
	T1.GRO_SIA,;
	T1.SLD_SIA, ;
	T1.GRO_W3,;
	T1.SLD_W3, ;
	T1.GRO_BGS,;
	T1.SLD_BGS, ;
	T1.GRO_IPG,;
	T1.SLD_IPG, ;
	T1.GRO_CGB,;
	T1.SLD_CGB, ;
	T1.GRO_T63,;
	T1.SLD_T63, ;
	T1.GRO_ARG,;
	T1.SLD_ARG, ;
	T1.GRO_IDP,;
	T1.SLD_IDP, ;
	T2.GRO_DPO,;
	T2.SLD_DPO, ;
	T2.GRO_ANP,;
	T2.SLD_ANP, ;
	T2.GRO_IDL, ;
	T2.SLD_IDL, ;
	T2.GRO_ABO, ;
	T2.SLD_ABO, ;
	T2.GRO_SMA, ;
	T2.SLD_SMA, ;
	T2.GRO_CNB, ;
	T2.SLD_CNB, ;
	T2.GRO_CNG, ;
	T2.SLD_CNG ;
	    FROM   TMPG_1 T1 ;
	         , TMPG_2 T2;
    WHERE ;
	      T1.ORDEM = T2.ORDEM ;
	  AND T1.CODIGO = T2.CODIGO ;
   	INTO CURSOR TMPGRO1




	SELECT TMPGRO1.*, ;
		IMDura((sld_gyn+sld_DPO+sld_CNG),;
		       (gro_gyn+gro_DPO+gro_CNG))  AS dura_gyn,;
		IMDura((sld_sia+sld_CNB),(gro_sia+gro_CNB))  AS dura_sia,;
		IMDura(sld_w3 ,gro_w3 )  AS dura_w3 ,;
		IMDura((sld_bgs+sld_ABO),(gro_bgs+gro_ABO))  AS dura_bgs,;
		IMDura(sld_ipg,gro_ipg)  AS dura_ipg,;
		IMDura(sld_cgb,gro_cgb)  AS dura_cgb,;
		IMDura((sld_arg+sld_SMA),(gro_arg+gro_SMA))  AS dura_arg,;
		IMDura(sld_anp,gro_anp)  AS dura_anp,;
		IMDura(sld_idp,gro_idp)  AS dura_idp,;
		IMDura(sld_T63,gro_T63)  AS dura_T63,;
		IMDura(0,0)        AS dura_DPO,;
		IMDura(0,0)        AS dura_CNB,;
		IMDura(0,0)        AS dura_CNG,;
		IMDura(0,0)        AS dura_SMA,;
		IMDura(sld_idl,gro_idl)  AS dura_idl,;
		IMDura(0,0)        AS dura_ABO;
	FROM TMPGRO1 ;
   	INTO CURSOR TMPGRO2 ;
    ORDER BY ORDEM
	SET TALK OFF
	

RETURN("TMPGRO2")




*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4900MZES1           IMDura VALID                       
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         ITEMMOV,     Record Number:   34   
*        Variable:            IMDura                             
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      44                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _4900mzes1     &&  IMDura VALID
#REGION 2
RETURN

**********************************************************************
* IDENTIFICA DURACAO DO ESTOQUE

FUNCTION IMDura
PARAMETERS PrmSaldo,PrmGiro
Private LNDura
	DO CASE
		CASE PrmGiro = 0
			IF PrmSaldo > 0
				LNDura   = 999
			ELSE
				LNDura   = 0
			ENDIF		
		OTHERWISE
			IF PrmSaldo > 0
				LNDura   = PrmSaldo / PrmGiro
				IF LNDura > 999
					LNDura   = 999
				ENDIF				
			ELSE
				LNDura   = 0
			ENDIF
	ENDCASE
RETURN(LNDura)




*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _4900MZES2           IMGetUltCstMedioEstq VALID         
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         ITEMMOV,     Record Number:   35   
*        Variable:            IMGetUltCstMedioEstq               
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      45                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _4900mzes2     &&  IMGetUltCstMedioEstq VALID
#REGION 2
return
*---------------------------------------------------------------*

FUNCTION IMGetUltCstMedioEstq
PARAMETERS PrmEmp,PrmData, PrmCodigo

	=W_DEFPROC("ROTINAS.SPR")

	PRIVATE LNVlrEstq
	PRIVATE LNSldEstq

	PRIVATE LSalias
	LSalias		= 	ALIAS()
	IF TYPE("PrmHora") <> "C"
	    PrmHora = "99:99:99"
	ENDIF

	=IMVerifyInst()
	*----------------------------------------------------------------*
	SELE &PBItemmovAlias
	SET ORDER TO TAG movimento
	SET NEAR ON
	SEEK STR(PrmEmp,3)+ALLTRIM(PrmCodigo)+"1"
										&& POSICIONA A FRENTE PARA
										&& VOLTAR E PEGAR SALDO DE
										&& FECHAMENTO OU ATUAL DO DIA
	SET NEAR OFF
	IF BOF() AND EOF()       && ITEMMOV ESTA VAZIO

		=W_DEFPROC("SALDO.SPR")
		LNVlrEstq = SLGetVlrEstq(PrmEmp, PrmData, PrmCodigo)

		=W_DEFPROC("SALDO.SPR")
		LNSldEstq= SLGetSaldo(PrmEmp, PrmData, PrmCodigo)

	ELSE
		SKIP -1
		IF BOF() OR PrmCodigo <> &PBItemmovAlias .codigo ;
			 	 OR PrmEmp    <> &PBItemmovAlias .empresa
			=W_DEFPROC("SALDO.SPR")
			LNVlrEstq = SLGetVlrEstq(PrmEmp, PrmData, PrmCodigo)

			=W_DEFPROC("SALDO.SPR")
			LNSldEstq= SLGetSaldo(PrmEmp, PrmData, PrmCodigo)

		ELSE
			LNVlrEstq   =	&PBItemmovAlias .vlr_estq
            LNSldEstq   =   &PBItemmovAlias .sld_estq

		ENDIF
	ENDIF
   	IF LNSldEstq > 0
		LNVlrEstq   =	LNVlrEstq / ;
		                 LNSldEstq
	ENDIF



	*--------------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(LNVlrEstq)
