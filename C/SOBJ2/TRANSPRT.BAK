*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        02/25/10            TRANSPRT.SPR               14:45:44 
*                                                                
*       픔컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        Author's Name                                           
*                                                                
*        Copyright (c) 2010 Company Name                         
*        Address                                                 
*        City,     Zip                                           
*                                                                
*        Description:                                            
*        This program was automatically generated by GENSCRN.    
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴


#REGION 0
REGIONAL m.currarea, m.talkstat, m.compstat

IF SET("TALK") = "ON"
	SET TALK OFF
	m.talkstat = "ON"
ELSE
	m.talkstat = "OFF"
ENDIF
m.compstat = SET("COMPATIBLE")
SET COMPATIBLE FOXPLUS

*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                       MS-DOS Window definitions                
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                     TRANSPRT/MS-DOS Screen Layout              
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 1
@ 7,5 GET TRPVerifyInst ;
	PICTURE "@*HN TRPVerifyInst - Verifica Instancia" ;
	SIZE 1,36,1 ;
	DEFAULT 1 ;
	VALID _2vi0vn2u4()
@ 8,8 GET TRPCreate ;
	PICTURE "@*HN TRPCreate - Instancia" ;
	SIZE 1,23,1 ;
	DEFAULT 1 ;
	VALID _2vi0vn2u5()
@ 17,8 GET TRPDestroi ;
	PICTURE "@*HN TRPDestroi - Desinstancia" ;
	SIZE 1,27,1 ;
	DEFAULT 1 ;
	VALID _2vi0vn2u6()
@ 9,10 GET TRPReadProp ;
	PICTURE "@*HN TRPReadProp - Carga do Vetor com Base na Tabela" ;
	SIZE 1,49,1 ;
	DEFAULT 1 ;
	VALID _2vi0vn2u7()
@ 10,10 GET TRPSetDerivadas ;
	PICTURE "@*HN TRPSetDerivadas - Carga de Propriedades Derivadas" ;
	SIZE 1,51,1 ;
	DEFAULT 1 ;
	VALID _2vi0vn2vq()
@ 13,10 GET TRPSetPropVT ;
	PICTURE "@*HN TRPSetPropVT - Set o Valor de uma Propriedade do Vetor" ;
	SIZE 1,56,1 ;
	DEFAULT 1 ;
	VALID _2vi0vn2vr()
@ 14,10 GET TRPGetPropVT ;
	PICTURE "@*HN TRPGetPropVT - Get o Valor de uma Propriedade do Vetor" ;
	SIZE 1,56,1 ;
	DEFAULT 1 ;
	VALID _2vi0vn2vs()
@ 4,2 GET TRPChk_Identidade ;
	PICTURE "@*HN TRPChk_Identidade - Checagem de Identidade do Objeto" ;
	SIZE 1,54,1 ;
	DEFAULT 1 ;
	VALID _2vi0vn2vt()
@ 3,2 GET TRPFind ;
	PICTURE "@*HN TRPFind - Localiza Registro Com Base nas Propriedades" ;
	SIZE 1,55,1 ;
	DEFAULT 1 ;
	VALID _2vi0vn2wg()
@ 20,2 GET TRPGetFieldValue ;
	PICTURE "@*HN TRPGetFieldValue - Retorna o valor do Campo informado" ;
	SIZE 1,55,1 ;
	DEFAULT 1 ;
	VALID _2vi0vn2wo()
@ 19,2 GET TRP_Refresh ;
	PICTURE "@*HN TRP_Refresh - Forca Atualiza놹o Objeto" ;
	SIZE 1,40,1 ;
	DEFAULT 1 ;
	VALID _2vi0vn2wu()
@ 24,2 SAY "*-------------------------------------------------------------------*" ;
	SIZE 1,69, 0
@ 26,2 GET TRPLerRegistro ;
	PICTURE "@*HN TRPLerRegistro - Le Registro e Carrega OBJ" ;
	SIZE 1,44,1 ;
	DEFAULT 1 ;
	VALID _2vi0vn2x3()
@ 16,10 GET TRPWriteProp ;
	PICTURE "@*HN TRPWriteProp - Grava do Vetor para Base na Tabela" ;
	SIZE 1,51,1 ;
	DEFAULT 1 ;
	VALID _2vi0vn2x9()
@ 27,2 GET TRPSalvarRegistro ;
	PICTURE "@*HN TRPSalvarRegistro - Salva Registro" ;
	SIZE 1,36,1 ;
	DEFAULT 1 ;
	VALID _2vi0vn2xa()
@ 25,2 GET TRPExiste ;
	PICTURE "@*HN TRPExiste - Le Registro nao carrega o OBJ e Retorna se existe" ;
	SIZE 1,63,1 ;
	DEFAULT 1 ;
	VALID _2vi0vn2xb()
@ 32,2 SAY "*-------------------------------------------------------------------*" ;
	SIZE 1,69, 0
@ 21,2 GET TRPGetAlias ;
	PICTURE "@*HN TRPGetAlias - Retorna Alias da area em que foi abertaa tabela" ;
	SIZE 1,63,1 ;
	DEFAULT 1 ;
	VALID _2vi0vn2xc()
@ 11,10 GET TRPSetConfig ;
	PICTURE "@*HN TRPSetConfig - Carga Propriedades de Configuracao/Parametros" ;
	SIZE 1,62,1 ;
	DEFAULT 1 ;
	VALID _2vi0vn2xz()
@ 28,2 GET TRPBtnVal ;
	PICTURE "@*HN TRPBtnVal - Trata Comandos de navegacao" ;
	SIZE 1,41,1 ;
	DEFAULT 1 ;
	VALID _2vi0vn2y7()
@ 5,5 GET TRPTrtChave ;
	PICTURE "@*HN TRPTrtChave - Trata Acesso por Chave " ;
	SIZE 1,39,1 ;
	DEFAULT 1 ;
	VALID _2vi0vn2yg()
@ 29,2 GET TRPView ;
	PICTURE "@*HN TRPView - Visualisa BROWSE" ;
	SIZE 1,28,1 ;
	DEFAULT 1 ;
	VALID _2vi0vn2ym()
@ 30,5 GET TRPLOCATE ;
	PICTURE "@*HN TRPLOCATE - Apoio a CLView - Visualisa BROWSE" ;
	SIZE 1,47,1 ;
	DEFAULT 1 ;
	VALID _2vi0vn2yn()
@ 18,2 SAY "*-------------------------------------------------------------------*" ;
	SIZE 1,69, 0
@ 34,2 SAY "*-------------------------------------------------------------------*" ;
	SIZE 1,69, 0
@ 22,2 GET TRPScatter ;
	PICTURE "@*HN TRPScatter - Carrega Var de Memoria" ;
	SIZE 1,37,1 ;
	DEFAULT 1 ;
	VALID _2vi0vn2yo()
@ 1,2 SAY "CLAS:V-1.0 => IMPLEMENTA NAVEGACAO E MANUTENCAO COMPLETA (BASE=CLIENTES)" ;
	SIZE 1,72, 0
@ 2,2 SAY "*---------------------------------------------------------------------*" ;
	SIZE 1,71, 0



READ


#REGION 0
IF m.talkstat = "ON"
	SET TALK ON
ENDIF
IF m.compstat = "ON"
	SET COMPATIBLE ON
ENDIF


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2VI0VN2U4           TRPVerifyInst VALID                
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         TRANSPRT,     Record Number:    2  
*        Variable:            TRPVerifyInst                      
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      1                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2vi0vn2u4     &&  TRPVerifyInst VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION TRPVerifyInst
	
PRIVATE LSpath
	=W_DEFPROC("rotinas.spr")
	LSpath = UPobterPath("TRANSPRT")


	DO CASE

		CASE TYPE("PBTransprtAlias") = "U" ;
		   		OR EMPTY(PBTransprtAlias) ;
		   		OR !USED(PBTransprtAlias)
			=TRPCreate()					

		CASE !("MUNICPIO.DBF" $ DBF(PBTransprtAlias))
				* APOS UM CLOSE DATABASE UM OUTRO DBF FOI
				* ABERTO NA AREA ANTES OCUPADA PELO DBF AVALIADO AKI
				RELEASE PBTransprtAlias
			=TRPCreate()					


		CASE  !(LSPath $ DBF(PBTransprtAlias))
			 	* HOUVE MUDANCA DE DIR BASE
			 	* ELIMINA INSTACIA DE OUTRA BASE
		     	* CRIA INSTANCIA NA NOVA BASE
			=TRPDestroi()				
			=TRPCreate()					
	ENDCASE

	
RETURN(.t.)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2VI0VN2U5           TRPCreate VALID                    
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         TRANSPRT,     Record Number:    3  
*        Variable:            TRPCreate                          
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      2                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2vi0vn2u5     &&  TRPCreate VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION TRPCreate
	=W_DEFPROC("rotinas.spr")
	PRIVATE LSalias
	PRIVATE LSAlsTmp
    PRIVATE LMaxDim
	LSalias		= 	ALIAS()
	
	IF TYPE("PBTRANSPRTAlias") <> "U" ;
	   		AND !EMPTY(PBTRANSPRTAlias) ;
	   		AND USED(PBTRANSPRTAlias)
			RETURN(.T.)
	ENDIF


	PUBLIC PBTRANSPRTAlias

	IF USED("TRANSPRT")
	     =NetArqAgain("TRANSPRT")
	     PBTRANSPRTAlias     = Alias()
	ELSE
	     =NetArqAgain("TRANSPRT")
	     LSAlsTmp     = Alias()
	     =NetArqAgain("TRANSPRT")
	     PBTRANSPRTAlias     = Alias()
		 IF !EMPTY(LSAlsTmp) AND USED(LSAlsTmp)
			SELECT &LSAlsTmp
			USE
		 ENDIF
	ENDIF	

    SELE &PBTRANSPRTAlias
	LMaxDim = Fcount()
    PUBLIC DIMENSION VTTRANSPRT[LMaxDim]&& VETOR PARA CAMPOS DA TABELA
    PUBLIC DIMENSION VDTRANSPRT[2,3]	&& VETOR PARA CAMPOS DERIVADAS
    PUBLIC DIMENSION VFTRANSPRT[1]      && VETOR CABECALHO DOS CAMPOS
    PUBLIC DIMENSION VCTRANSPRT[8,3]	&& VETOR PARA CONFIGURACOES


	=AFIELDS(VFTRANSPRT)



	*-----------------------------------------------------------*
	=TRPReadProperty()
	=TRPSetDerivadas()
	=TRPSetConfig()
	*--------------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2VI0VN2U6           TRPDestroi VALID                   
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         TRANSPRT,     Record Number:    4  
*        Variable:            TRPDestroi                         
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      3                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2vi0vn2u6     &&  TRPDestroi VALID
#REGION 1
return
*---------------------------------------------------------------*


FUNCTION TRPDestroi

	=W_DEFPROC("rotinas.spr")

	IF TYPE("PBTRANSPRTAlias") = "U"
		RETURN
	ENDIF

    *--------------------------------------------------------------------*
	*-> QUANDO O SISTEMA APLICA UM CLOSE DATABASE :
	*   EX: EM UPAltDir (Geral.spr)
	*  1- Fecha inclusive a referencia do PBTRANSPRTAlias
	*  2- Novas tabelas abertas podem ocupar a area referenciada
	*     por PBTRANSPRTAlias
	*  3- Se aplicar um FECHAMENTO a PBTRANSPRTAlias estara fechando
	*     outra tabela
	*  4- Entao Verifica-se a coerencia do dbf esperado em PBTRANSPRTAlias
	*-------------------------------------------------------------------*
	IF !(USED(PBTRANSPRTAlias)) OR ;
	   !("TRANSPRT.DBF" $ DBF(PBTRANSPRTAlias))

		RELEASE PBTRANSPRTAlias
    	RELEASE VTTRANSPRT
	    RELEASE VDTRANSPRT
		RELEASE VFTRANSPRT
		RELEASE VCTRANSPRT
		return(.T.)			
	ENDIF
	PRIVATE LSalias
	LSalias  = Alias()
	IF !EMPTY(PBTRANSPRTAlias) AND USED(PBTRANSPRTAlias)
		SELECT &PBTRANSPRTAlias
		USE
	ENDIF	
	RELEASE PBTRANSPRTAlias
    RELEASE VTTRANSPRT
    RELEASE VDTRANSPRT
	RELEASE VFTRANSPRT
	RELEASE VCTRANSPRT

	*-----------------------------------------------------------*
	*--------------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(.T.)


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2VI0VN2U7           TRPReadProp VALID                  
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         TRANSPRT,     Record Number:    5  
*        Variable:            TRPReadProp                        
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      4                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2vi0vn2u7     &&  TRPReadProp VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION TRPReadProp
	PRIVATE LSalias
	LSalias		= 	ALIAS()


	SELE &PBTRANSPRTAlias
	SCATTER TO VTTRANSPRT
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(.T.)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2VI0VN2VQ           TRPSetDerivadas VALID              
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         TRANSPRT,     Record Number:    6  
*        Variable:            TRPSetDerivadas                    
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      5                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2vi0vn2vq     &&  TRPSetDerivadas VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION TRPSetDerivadas
	PRIVATE LSalias
	PRIVATE LEmpresa
	LSalias		= 	ALIAS()

	*--------------------------------------------------------------*
    VDTRANSPRT(1,1) = "NAOINFORMADO"	&& TITULO	
   	VDTRANSPRT(1,2) = 0					&& VALOR
   	VDTRANSPRT(1,3) = .F.				&& FLAG .T. => FOI CARREGADO
	*--------------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(.T.)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2VI0VN2VR           TRPSetPropVT VALID                 
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         TRANSPRT,     Record Number:    7  
*        Variable:            TRPSetPropVT                       
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      6                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2vi0vn2vr     &&  TRPSetPropVT VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION TRPSetPropVT
PARAMETER  PrmField, PrmValue
	PRIVATE Lvalue

	=W_DEFPROC("ROTINAS.SPR")
	Lvalue = RTsetValueObj(PrmField,;
							PrmValue,;
						    PBTRANSPRTAlias,;
						    VTTRANSPRT,;
						    VDTRANSPRT,;
						    VFTRANSPRT,;
						    VCTRANSPRT)

RETURN(Lvalue)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2VI0VN2VS           TRPGetPropVT VALID                 
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         TRANSPRT,     Record Number:    8  
*        Variable:            TRPGetPropVT                       
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      7                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2vi0vn2vs     &&  TRPGetPropVT VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION TRPGetPropVT
PARAMETER  PrmField

	PRIVATE Lvalue

	=W_DEFPROC("ROTINAS.SPR")
	Lvalue = RTgetValueObj(PrmField,;
	            PBTRANSPRTAlias,;
	            VTTRANSPRT,;
	            VDTRANSPRT,;
			    VFTRANSPRT,;
			    VCTRANSPRT)

RETURN(Lvalue)





*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2VI0VN2VT           TRPChk_Identidade VALID            
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         TRANSPRT,     Record Number:    9  
*        Variable:            TRPChk_Identidade                  
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      8                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2vi0vn2vt     &&  TRPChk_Identidade VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*


FUNCTION TRPChk_Identidade
PARAMETERS PrmCGC
	PRIVATE LFretorno
	LFretorno = .t.

	=TRPVerifyInst()

    =TRPSetPropVT("CGC",PrmCGC)

	LFretorno=TRPFind()
RETURN(LFretorno)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2VI0VN2WG           TRPFind VALID                      
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         TRANSPRT,     Record Number:   10  
*        Variable:            TRPFind                            
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      9                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2vi0vn2wg     &&  TRPFind VALID
#REGION 1
return

*---------------------------------------------------------------*

FUNCTION TRPFind


	PRIVATE LCGC
	PRIVATE LFreturn

	PRIVATE LSalias
	LSalias		= 	ALIAS()

	=TRPVerifyInst()


	SELE &PBTransprtAlias

	LSchaveAcesso  =TRPGetPropVT("CHAVE DE LEITURA")


	DO CASE
		CASE UPPER(LSchaveAcesso) = "CGC"
			LCGC = TRPgetPropVT("CGC")
			SET ORDER TO TAG CGC
			SEEK LCgc
		OTHERWISE
			LCGC = TRPgetPropVT("CGC")
			SET ORDER TO TAG CGC
			SEEK LCgc
	ENDCASE


	IF FOUND()
		=TRPReadProperty()
		=TRPSetDerivadas()
	    LFreturn = .T.
	ELSE
	    LFreturn = .f.
	ENDIF
	*--------------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF

RETURN(LFreturn)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2VI0VN2WO           TRPGetFieldValue VALID             
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         TRANSPRT,     Record Number:   11  
*        Variable:            TRPGetFieldValue                   
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      10                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2vi0vn2wo     &&  TRPGetFieldValue VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION TRPGetFieldValue
PARAMETERS PrmCGC,PrmField

	=TRPChk_Identidade(PrmCGC)

RETURN(TRPGetPropVT(PrmField))


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2VI0VN2WU           TRP_Refresh VALID                  
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         TRANSPRT,     Record Number:   12  
*        Variable:            TRP_Refresh                        
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      11                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2vi0vn2wu     &&  TRP_Refresh VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION TRP_Refresh
PARAMETERS PrmCGC
	PRIVATE LFretorno
	LFretorno = .t.

	=TRPVerifyInst()

    =TRPSetPropVT("CGC",PrmCGC)

	LFretorno=TRPFind()
RETURN(LFretorno)






*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2VI0VN2X3           TRPLerRegistro VALID               
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         TRANSPRT,     Record Number:   14  
*        Variable:            TRPLerRegistro                     
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      12                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2vi0vn2x3     &&  TRPLerRegistro VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION TRPLerRegistro
PARAMETERS PrmCGC

	PRIVATE LFretorno
	LFretorno = .t.

	LFretorno =TRPChk_Identidade(PrmCGC)

RETURN(LFretorno)




*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2VI0VN2X9           TRPWriteProp VALID                 
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         TRANSPRT,     Record Number:   15  
*        Variable:            TRPWriteProp                       
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      13                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2vi0vn2x9     &&  TRPWriteProp VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION TRPWriteProp
	PRIVATE LSalias
	LSalias		= 	ALIAS()


	SELE &PBTRANSPRTAlias
	=RLOCK()
	GATHER FROM  VTTRANSPRT
	UNLOCK

	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF

RETURN(.T.)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2VI0VN2XA           TRPSalvarRegistro VALID            
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         TRANSPRT,     Record Number:   16  
*        Variable:            TRPSalvarRegistro                  
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      14                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2vi0vn2xa     &&  TRPSalvarRegistro VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION TRPSalvarRegistro

	=TRPVerifyInst()

	PRIVATE LFretorno
	LFretorno = .t.

	IF !TRPExiste()
		SELE &PBTRANSPRTAlias
		APPEND BLANK
		LFretorno=TRPWriteProp()
	ELSE
		SELE &PBTRANSPRTAlias
		LFretorno=TRPWriteProp()
	ENDIF

RETURN(LFretorno)




*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2VI0VN2XB           TRPExiste VALID                    
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         TRANSPRT,     Record Number:   17  
*        Variable:            TRPExiste                          
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      15                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2vi0vn2xb     &&  TRPExiste VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION TRPExiste


	PRIVATE LCGC
	PRIVATE LFreturn

	PRIVATE LSalias
	LSalias		= 	ALIAS()

	=TRPVerifyInst()


	SELE &PBTRANSPRTAlias

	LSchaveAcesso  =TRPGetPropVT("CHAVE DE LEITURA")


	DO CASE
		CASE UPPER(LSchaveAcesso) = "CGC"
			LCGC = TRPgetPropVT("CGC")
			SET ORDER TO TAG CGC
			SEEK LCGC
		OTHERWISE
			LCGC = TRPgetPropVT("CGC")
			SET ORDER TO TAG CGC
			SEEK LCGC
	ENDCASE


	IF FOUND()
	    LFreturn = .T.
	ELSE
	    LFreturn = .f.
	ENDIF
	*--------------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF

RETURN(LFreturn)




*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2VI0VN2XC           TRPGetAlias VALID                  
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         TRANSPRT,     Record Number:   19  
*        Variable:            TRPGetAlias                        
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      16                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2vi0vn2xc     &&  TRPGetAlias VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION TRPGetAlias

	=TRPVerifyInst()

RETURN(PBTRANSPRTAlias)


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2VI0VN2XZ           TRPSetConfig VALID                 
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         TRANSPRT,     Record Number:   20  
*        Variable:            TRPSetConfig                       
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      17                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2vi0vn2xz     &&  TRPSetConfig VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION TRPSetConfig

	*--------------------------------------------------------------*
    VCTRANSPRT(1,1) = "REG_STATE" && INSERT/EDICAO/BROWSER/
   	VCTRANSPRT(1,2) = ""
   	VCTRANSPRT(1,3) = .T.
	*--------------------------------------------------------------*
    VCTRANSPRT(2,1) = "CHV_LER" && p/ leitura do ultimo reg + 1
   	VCTRANSPRT(2,2) = ""
   	VCTRANSPRT(2,3) = .T.
	*--------------------------------------------------------------*
    VCTRANSPRT(3,1) = "CHV_COMPARA" && p/ leitura do ultimo reg + 1
   	VCTRANSPRT(3,2) = ""
   	VCTRANSPRT(3,3) = .T.
	*--------------------------------------------------------------*
    VCTRANSPRT(4,1) = "CHV_BROW" && p/ leitura do ultimo reg + 1
   	VCTRANSPRT(4,2) = ""
   	VCTRANSPRT(4,3) = .T.
	*--------------------------------------------------------------*
    VCTRANSPRT(5,1) = "ISEDITING" && p/ leitura do ultimo reg + 1
   	VCTRANSPRT(5,2) = .F.
   	VCTRANSPRT(5,3) = .T.
	*--------------------------------------------------------------*
    VCTRANSPRT(6,1) = "ISADDING" && p/ leitura do ultimo reg + 1
   	VCTRANSPRT(6,2) = .F.
   	VCTRANSPRT(6,3) = .T.
	*--------------------------------------------------------------*
    VCTRANSPRT(7,1) = "ISREADING" && p/ leitura do ultimo reg + 1
   	VCTRANSPRT(7,2) = .F.
   	VCTRANSPRT(7,3) = .T.
	*--------------------------------------------------------------*
    VCTRANSPRT(8,1) = "CHAVE DE LEITURA" && TAG DO CHAVE USADA EM FIND
   	VCTRANSPRT(8,2) = "CGC"
   	VCTRANSPRT(8,3) = .T.
	*--------------------------------------------------------------*
	
RETURN(.T.)



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2VI0VN2Y7           TRPBtnVal VALID                    
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         TRANSPRT,     Record Number:   21  
*        Variable:            TRPBtnVal                          
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      18                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2vi0vn2y7     &&  TRPBtnVal VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION TRPBtnVal
PARAMETERS PrmTecla

	PRIVATE Lchv_Ler
	PRIVATE Lchv_Compara
	PRIVATE Lchv_Brow

	PRIVATE LCGC


	=TRPVerifyInst()

	Lchv_ler     = TRPGetPropVT("CHV_LER")
	Lchv_compara = TRPGetPropVT("CHV_COMPARA")
	Lchv_brow    = TRPGetPropVT("CHV_BROW")

	
	SELE &PBTRANSPRTAlias
	DO CASE
	
		CASE PrmTecla = "LOCATE"
			LCGC    = MNGetPropVT("CGC")

			=TRPView(LCGC)
			SELE &PBTRANSPRTAlias
			SCATTER MEMVAR MEMO

			
		OTHERWISE

		    DO btn_val with PrmTecla,;
	   			       Lchv_ler,;
	   			       Lchv_compara,;
	   			       Lchv_brow,;
	   			       .T.,;
	   			       .T.
	   			
	ENDCASE
	   			
	=TRPSetPropVT("ISEDITING",ISEDITING)
	=TRPSetPropVT("ISADDING",ISADDING)
	=TRPSetPropVT("ISREADING",ISREADING)
	   			
RETURN(.t.)




*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2VI0VN2YG           TRPTrtChave VALID                  
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         TRANSPRT,     Record Number:   22  
*        Variable:            TRPTrtChave                        
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      19                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2vi0vn2yg     &&  TRPTrtChave VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION TRPTrtChave
PARAMETERS PrmCGC

	PRIVATE LFretorno
	LFretorno = .t.

	=TRPVerifyInst()


    =TRPSetPropVT("CGC",PrmCGC)
	*--------------------------------------------------------------*

	LFretorno=TRPFind()

	SELE &PBTransprtAlias

RETURN(UPtratachv())





*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2VI0VN2YM           TRPView VALID                      
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         TRANSPRT,     Record Number:   23  
*        Variable:            TRPView                            
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      20                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2vi0vn2ym     &&  TRPView VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION TRPView
PARAMETERS PrmCGC

	PRIVATE LerTrans
	LerMuni =""


	PRIVATE PrmVlrLocate && VARIAVEL USADA PARA LOCATE
	                     && E PRESERVADA PARA USO NO CONTINUE
	                     && ELA E PUBLICA PARA:
	                     && MNView, MNLOCATE e MNContinue

	PrmVlrLocate = ""


	=W_DEFPROC("rotinas.spr")
	PRIVATE Lretorno
	=TRPVerifyInst()
	*--------------------------------------------------------------*
	IF TYPE("PrmCGC") <> "N"
		PrmCGC = 0
	ENDIF
	
	IF TYPE("PrmOrdem") <> "C" OR EMPTY(PrmOrdem)
		PrmOrdem = "CGC"
	ENDIF


	DO CASE
		CASE PrmOrdem = ""

			 PrmOrdem = ""

		OTHERWISE
		    SELECT DISTINCT ;
    		   	  CGC,;
    		   	  NOME,;
    		   	  BAIRRO,;
    	 		  CIDADE;
		     FROM  &PBTRANSPRTAlias ;
    		 ORDER BY  NOME;
		     INTO CURSOR TRPVIEW
	ENDCASE

	LOCATE FOR ALLTRIM(PrmCGC) $ CGC


	=UPLocDefWindow()

	ON KEY LABEL L DO TRPLOCATE WITH "CGC", LerCGC
	ON KEY LABEL M DO TRPLOCATE WITH "CGC", LerCGC
	ON KEY LABEL l DO TRPLOCATE WITH "CGC", LerCGC
	ON KEY LABEL m DO TRPLOCATE WITH "CGC", LerCGC



	ON KEY LABEL CTRL-G DO TRPCONTINUE


	BROWSE  FIELDS;
			CGC,;
			NOME ;
			:P="@S30";
			CIDADE ;
			:P="@S30";
			:H="MUNICIPIO - (M)",;
			BAIRRO ;
			:P="@S30";
		WINDOW wzlocate ;
    		NOAPPEND NODELETE NOEDIT  ;
    			COLOR SCHEME 10



	=UPLocRelWindow()


	ON KEY LABEL CTRL-G
	ON KEY LABEL L
	ON KEY LABEL l
	ON KEY LABEL M
	ON KEY LABEL m
	ON KEY LABEL C
	ON KEY LABEL c
	ON KEY LABEL I
	ON KEY LABEL i


	PrmCGC    = TRPVIEW.CGC


	SELE TRPVIEW
	USE

	=TRP_Refresh(PrmCGC)
		
	*--------------------------------------------------------------*
RETURN(PrmTRANSPRT)

PROCEDURE  TRPCONTINUE

	CONTINUE
	IF EOF()
		GO TOP
		CONTINUE
	ENDIF

RETURN


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2VI0VN2YN           TRPLOCATE VALID                    
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         TRANSPRT,     Record Number:   24  
*        Variable:            TRPLOCATE                          
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      21                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2vi0vn2yn     &&  TRPLOCATE VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*


FUNCTION TRPLOCATE
PARAMETERS PrmCGC,PrmUltimaPesquisa


	DO LOC_BROW.SPR with PrmFields,PrmUltimaPesquisa



	PrmVlrLocate = PrmUltimaPesquisa
	
	PrmVlrLocate = ALLTRIM(PrmVlrLocate)
	PrmVlrLocate = UPPER(PrmVlrLocate)




	
	DO CASE

		CASE  PrmFields = "CGC"
			LOCATE FOR PrmVlrLocate $ CGC ALL

	ENDCASE
	
RETURN


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2VI0VN2YO           TRPScatter VALID                   
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         TRANSPRT,     Record Number:   27  
*        Variable:            TRPScatter                         
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      22                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2vi0vn2yo     &&  TRPScatter VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION TRPScatter

	PRIVATE LFretorno
	LFretorno = .t.

	=TRPVerifyInst()
	SELE &PBTRANSPRTAlias
	SCATTER MEMVAR MEMO
RETURN(.T.)




