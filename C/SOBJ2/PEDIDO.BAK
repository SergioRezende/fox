*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º 04/06/16             PEDIDO.SPR                10:13:19 º
*       º                                                         º
*       ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
*       º                                                         º
*       º Author's Name                                           º
*       º                                                         º
*       º Copyright (c) 2016 Company Name                         º
*       º Address                                                 º
*       º City,     Zip                                           º
*       º                                                         º
*       º Description:                                            º
*       º This program was automatically generated by GENSCRN.    º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½


#REGION 0
REGIONAL m.currarea, m.talkstat, m.compstat

IF SET("TALK") = "ON"
	SET TALK OFF
	m.talkstat = "ON"
ELSE
	m.talkstat = "OFF"
ENDIF
m.compstat = SET("COMPATIBLE")
SET COMPATIBLE FOXPLUS

*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º                MS-DOS Window definitions                º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º               PEDIDO/MS-DOS Screen Layout               º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 1
@ 17,0 GET ver_Prod ;
	PICTURE "@*HN PROG tmp = SOLUCAO TEMPORARIA PARA CORRIGIR QTDES DE TRANSITO /PENDENCIA" ;
	SIZE 1,74,1 ;
	DEFAULT 1 ;
	VALID _4lt0lwqkq()
@ 19,0 GET PDregistra_qte ;
	PICTURE "@*HN PDregistra_qte  - Registra/Cancela em PEDITE (TRANSITO e CHEGADA)" ;
	SIZE 1,67,1 ;
	DEFAULT 1 ;
	VALID _4lt0lwql2()
@ 18,0 GET PDloc_item ;
	PICTURE "@*HN PDloc_item  - Le um item de Pedido " ;
	SIZE 1,37,1 ;
	DEFAULT 1 ;
	VALID _4lt0lwqlg()
@ 20,0 GET PDstat_pedd ;
	PICTURE "@*HN PDstat_pedd  - Checagem de Status do Pedito e Itens" ;
	SIZE 1,53,1 ;
	DEFAULT 1 ;
	VALID _4lt0lwqlo()
@ 26,3 GET PDpedido ;
	PICTURE "@*HN PDpedido  - Pesquisa Qtde Pendente e em Transito de um Produto" ;
	SIZE 1,64,1 ;
	DEFAULT 1 ;
	VALID _4lt0lwqnh() ;
	DISABLE
@ 22,0 GET PDprevisao ;
	PICTURE "@*HN PDprevisao  - Processa a Sugestao de Compra " ;
	SIZE 1,46,1 ;
	DEFAULT 1 ;
	VALID _4lt0lwqni() ;
	DISABLE
@ 23,3 GET PDdefGiro ;
	PICTURE "@*HN PDdefGiro  - Define Giro Para Produto em 5 Faixas Prefixadas" ;
	SIZE 1,62,1 ;
	DEFAULT 1 ;
	VALID _4lt0lwqnj() ;
	DISABLE
@ 24,3 GET PDgiro ;
	PICTURE "@*HN PDgiro - Calculo Efetivo do Giro " ;
	SIZE 1,35,1 ;
	DEFAULT 1 ;
	VALID _4lt0lwqnk() ;
	DISABLE
@ 25,3 GET PDvendasparagiro ;
	PICTURE "@*HN PDvendasparagiro - Apurar Movimento dew Vendas Para Calculo do Giro" ;
	SIZE 1,69,1 ;
	DEFAULT 1 ;
	VALID _4lt0lwqnl() ;
	DISABLE
@ 12,1 GET PDQtds_pedido ;
	PICTURE "@*HN PDQtds_pedido  - Pesquisa Qtde Pendente e em Transito de um Produto" ;
	SIZE 1,69,1 ;
	DEFAULT 1 ;
	VALID _4lt0lwqox()
@ 3,5 GET PDCreate ;
	PICTURE "@*HN PDCreate - Instancia" ;
	SIZE 1,22,1 ;
	DEFAULT 1 ;
	VALID _4lt0lwqp6()
@ 5,5 GET PDReadProp ;
	PICTURE "@*HN PDReadProp - Carga do Vetor com Base na Tabela" ;
	SIZE 1,48,1 ;
	DEFAULT 1 ;
	VALID _4lt0lwqp7()
@ 7,9 GET PDSetPropVT ;
	PICTURE "@*HN PDSetPropVT - Set o Valor de uma Propriedade do Vetor" ;
	SIZE 1,55,1 ;
	DEFAULT 1 ;
	VALID _4lt0lwqp8()
@ 10,5 GET PDFind ;
	PICTURE "@*HN PDFind - Localiza Registro Com Base nas Propriedades" ;
	SIZE 1,54,1 ;
	DEFAULT 1 ;
	VALID _4lt0lwqp9()
@ 8,9 GET PDGetPropVT ;
	PICTURE "@*HN PDGetPropVT - Get o Valor de uma Propriedade do Vetor" ;
	SIZE 1,55,1 ;
	DEFAULT 1 ;
	VALID _4lt0lwqpa()
@ 2,5 GET PDVerifyInst ;
	PICTURE "@*HN PDVerifyInst - Verifica Instancia" ;
	SIZE 1,35,1 ;
	DEFAULT 1 ;
	VALID _4lt0lwqpb()
@ 4,5 GET PDDestroi ;
	PICTURE "@*HN PDDestroi - Desinstancia" ;
	SIZE 1,26,1 ;
	DEFAULT 1 ;
	VALID _4lt0lwqqg()
@ 1,0 SAY "====> Com Uso de pseudo OO" ;
	SIZE 1,26, 0
@ 6,5 GET PDSetDerivadas ;
	PICTURE "@*HN PDSetDerivadas - Carga de Propriedades Derivadas" ;
	SIZE 1,51,1 ;
	DEFAULT 1 ;
	VALID _4lt0lwqqp()
@ 9,5 GET PDChk_Identidade ;
	PICTURE "@*HN PDChk_Identidade - Checagem de Identidade do Objeto" ;
	SIZE 1,53,1 ;
	DEFAULT 1 ;
	VALID _4lt0lwqqq()
@ 13,1 GET PDPedir ;
	PICTURE "@*HN PDPedir - Montar Necessidade de Pedido para Estoque" ;
	SIZE 1,53,1 ;
	DEFAULT 1 ;
	VALID _4lt0lwqqr()
@ 27,0 GET PDencerra ;
	PICTURE "@*HN PDencerra - Encerramento do Pedido" ;
	SIZE 1,36,1 ;
	DEFAULT 1 ;
	VALID _4lt0lwqqs()
@ 29,0 GET PDencerra ;
	PICTURE "@*HN PDImpPendPedido - Relatorio de Pendencias de Pedido" ;
	SIZE 1,53,1 ;
	DEFAULT 1 ;
	VALID _4lt0lwqqt()
@ 28,0 SAY "*------------------------------ DIVERSOS --------------------------------------*" ;
	SIZE 1,80, 0



READ


#REGION 0
IF m.talkstat = "ON"
	SET TALK ON
ENDIF
IF m.compstat = "ON"
	SET COMPATIBLE ON
ENDIF


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4LT0LWQKQ           ver_Prod VALID                     º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         PEDIDO,     Record Number:    2    º
*       º Variable:            ver_Prod                           º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      1                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4lt0lwqkq     &&  ver_Prod VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*
*------------------------------------------------------------

CLOSE ALL
USE \SCGC\CENTRAL\PEDITE
SET ORDER TO TAG PEDIDO

REPLACE ALL QTDEATD WITH 0, QTDETR WITH 0 ;
			FOR RLOCK() AND DATA > {01.01.2000}

USE \SCGC\CENTRAL\PEDITE
SET ORDER TO TAG PEDIDO

SELE 0
USE \SCGC\CENTRAL\NOTAENT
SET ORDER TO TAG NOTA


SELE 0
USE \SCGC\CENTRAL\NOTAITE
SET ORDER TO TAG DATA
SET RELATION TO STR(EMPRESA,3)+STR(CODFORN,5);
				+STR(NOTA,6)+SERIE+LEFT(TIPO,1) INTO NOTAENT

SET NEAR ON
SEEK STR(1,3)+DTOS({01.01.2000})
DO WHILE !EOF() AND EMPRESA = 1
*	IF NOTAENT.PEDIDO = 500 OR NOTAENT.PEDIDO = 600 ;
*		OR NOTAENT.PEDIDO = 700
		
		SELE PEDITE	
		SEEK STR(NOTAENT.EMPRESA,3)+STR(NOTAENT.PEDIDO,6)+NOTAITE.CODIGO
		IF FOUND()
			=RLOCK()
			DO CASE
				CASE LEFT(NOTAENT.SITUACAO,1) ="B"
					REPLACE QTDETR WITH QTDETR + NOTAITE.QTDE
				CASE LEFT(NOTAENT.SITUACAO,1) ="C"
					REPLACE QTDEATD WITH QTDEATD + NOTAITE.QTDE
			ENDCASE
		ENDIF
*	ENDIF
	SELE NOTAITE
	SKIP
ENDDO


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4LT0LWQL2           PDregistra_qte VALID               º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         PEDIDO,     Record Number:    3    º
*       º Variable:            PDregistra_qte                     º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      2                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4lt0lwql2     &&  PDregistra_qte VALID
#REGION 1
RETURN

FUNCTION PDregistra_qte
	PARAMETERS LNemp,LNpedido,LSproduto,LNqtde,LSoperacao,LSmodoOper
	*------------------------------------------------------------*
	*  CLASSIFICACAO:  [*****]
	*------------------------------------------------------------*
	*  OBJETIVO.......: Registrar saldos de mercaoria em transito e
	*				mercadoria atendida
	*------------------------------------------------------------*
	*  COMENTARIO.....:
	*------------------------------------------------------------*
	*  OBS............:
	*------------------------------------------------------------*
	*  TABELAS.......:
	*------------------------------------------------------------*
	*  PARAMETROS..:
	*		LNemp......:
	*		LNpedido...:
	*		LSproduto..:
	*		LNqtde.....:
	*		LSoperacao.: 	Operacao a ser realizada
	*					"REG.TRANSITO"
	*					"CANC.TRANSITO"
	*					"REG.ENTRADA"
	*					"CANC.ENTRADA"
	*		LSmodoOper.:    "CORRECAO" => NAO EXIBE MENS E CORRIGE
	*									TRANS NEGATIVO
	*						"NORMAL"
	*------------------------------------------------------------*
	*  RETORNO.....:
	*------------------------------------------------------------*
	* CHAMADAS : SCGC210.SCR -
	*			 SCGC211.PRG -
	*------------------------------------------------------------*
	=W_DEFPROC("rotinas.spr")
	*------------------------------------------------------------*
	IF TYPE("LSmodoOper") <> "C"
		LSmodoOper	= "NORMAL"
	ENDIF
	
	PRIVATE LSalias
	PRIVATE LSmens
	PRIVATE qtde,qtdetr,qtdeatd		&& EVITA EFEITO COLATERAL
	PRIVATE situacao
	LSalias = ALIAS()
	*------------------------------------------------------------*
	SELE pedite
	SET ORDER TO pedido
	SEEK STR(LNemp,3)+STR(LNpedido,6)+LSproduto
	IF !FOUND()	OR !REGLOCK(.T.)
		IF !EMPTY(LSalias) AND USED(LSalias)
			SELECT &LSalias
		ENDIF
		LSmens = " Pedido nao Localizado  "+CHR(13)+;
		   "PEDIDO :"+STR(LNpedido,6)+;
		   " FILIAL: "+STR(LNemp,3)+;
		   " PRODUTO: "+LSproduto+CHR(13)
		DO OBJ_MENS.SPR WITH  LSmens
		RETURN(.f.)
	ENDIF
	*-----------------------------------------------------------*
	SCATTER MEMVAR FIELDS qtde,qtdetr,qtdeatd
	DO CASE
		****  ATIVADAS NA VERIFICACAO DO PEDIDO *******

		CASE LSoperacao	= "CORRIGE.TRANSITO"
			m.qtdetr 	= 	m.qtdetr 	+ 	LNqtde
		CASE LSoperacao = "CORRIGE.ENTRADA"
			m.qtdeatd	= 	m.qtdeatd 	+ 	LNqtde

		****  ATIVADAS NA ENTRADA DA NF *******

		CASE LSoperacao	= "REG.TRANSITO"
			m.qtdetr 	= 	m.qtdetr 	+ 	LNqtde
		CASE LSoperacao = "CANC.TRANSITO"
			m.qtdetr 	= 	m.qtdetr 	- 	LNqtde
		CASE LSoperacao = "REG.ENTRADA"
			m.qtdetr 	= 	m.qtdetr 	- 	LNqtde
			m.qtdeatd	= 	m.qtdeatd 	+ 	LNqtde
		CASE LSoperacao = "CANC.ENTRADA"
			m.qtdetr 	= 	m.qtdetr 	+ 	LNqtde
			m.qtdeatd	= 	m.qtdeatd 	- 	LNqtde
		OTHERWISE
			IF !EMPTY(LSalias) AND USED(LSalias)
				SELECT &LSalias
			ENDIF
			RETURN(.f.)
	ENDCASE

	IF LSmodoOper = "CORRECAO"
		IF m.qtdetr < 0
			m.qtdetr = 0
		ENDIF
		IF m.qtdetr+m.qtdeatd > pedite.qtde
			m.qtde = m.qtdetr+m.qtdeatd
		ENDIF
	ENDIF


	LSstt1 = "B"
	LSstt2 = " "
	DO CASE
		CASE m.qtde <= m.qtdeatd
			LSstt1 = "C"		&& FECHADO POR ATENDIMENTO
			LSstt2 = "D" 		&& ATENDIDO POR COMPLETO
		OTHERWISE
			LSstt2 = "B" 		&& ITENS EM TRANSITO
	ENDCASE
    m.situacao = LSstt1 + LSstt2

	**************************
	SET FIELDS TO qtde, qtdetr,qtdeatd,dtregis, hregis,;
						 usrregis,deletado,situacao
	=edithand('REGRAVA')
	CLEAR FIELDS
	SET FIELDS OFF
	**************************

	LSmens = " Falha no Controle "+CHR(13)+;
		   "PEDIDO :"+STR(LNpedido,6)+;
		   " FILIAL: "+STR(LNemp,3)+;
		   " PRODUTO: "+LSproduto+CHR(13)+;
		   "QTDE :"+STR(pedite.qtde,4)+;
		   "TRANS:"+STR(m.qtdetr,4)+;
		   "ATENDIDO:"+STR(m.qtdeatd,4)

	IF m.qtdetr+m.qtdeatd > pedite.qtde
		DO OBJ_MENS.SPR WITH  LSmens
	ENDIF
	IF m.qtdetr < 0 OR m.qtdeatd < 0
		DO OBJ_MENS.SPR WITH  LSmens
	ENDIF
	*------------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(.T.)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4LT0LWQLG           PDloc_item VALID                   º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         PEDIDO,     Record Number:    4    º
*       º Variable:            PDloc_item                         º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      3                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4lt0lwqlg     &&  PDloc_item VALID
#REGION 1
RETURN

FUNCTION PDloc_item
	PARAMETERS LNemp,LNpedido,LSproduto,LFmens
	*------------------------------------------------------------*
	*  CLASSIFICACAO:  [*****]
	*------------------------------------------------------------*
	*  OBJETIVO.......: Ver se Item de Pedido existe
	*------------------------------------------------------------*
	*  COMENTARIO.....:
	*------------------------------------------------------------*
	*  OBS............:
	*------------------------------------------------------------*
	*  TABELAS.......:
	*------------------------------------------------------------*
	*  PARAMETROS..:
	*		LNemp......:
	*		LNpedido...:
	*		LSproduto..:
	*		LFmens.....: .f. Nao da Menssagem
	*					 .t. Da Menssagem
	*------------------------------------------------------------*
	*  RETORNO.....:
	*------------------------------------------------------------*
	* CHAMADAS : SCGC210.SCR -
	*			 SCGC211.PRG -
	*------------------------------------------------------------*
	=W_DEFPROC("rotinas.spr")
	*------------------------------------------------------------*
	PRIVATE LSalias
	PRIVATE LSmens
	LSalias = ALIAS()
	*------------------------------------------------------------*
	SELE pedite
	SET ORDER TO pedido
	SEEK STR(LNemp,3)+STR(LNpedido,6)+LSproduto
	IF !FOUND()	OR !REGLOCK(.T.)
		IF !EMPTY(LSalias) AND USED(LSalias)
			SELECT &LSalias
		ENDIF
		IF LFmens
			LSmens = " Pedido nao Localizado  "+CHR(13)+;
			   "PEDIDO :"+STR(LNpedido,6)+;
			   " FILIAL: "+STR(LNemp,3)+;
			   " PRODUTO: "+LSproduto+CHR(13)
			DO OBJ_MENS.SPR WITH  LSmens
		ENDIF
		RETURN(.f.)
	ENDIF
	*-----------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(.T.)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4LT0LWQLO           PDstat_pedd VALID                  º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         PEDIDO,     Record Number:    5    º
*       º Variable:            PDstat_pedd                        º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      4                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4lt0lwqlo     &&  PDstat_pedd VALID
#REGION 1
RETURN

FUNCTION PDstat_pedd
	PARAMETERS LNemp,LNpedido
	*------------------------------------------------------------*
	*  CLASSIFICACAO:  [*****]
	*------------------------------------------------------------*
	*  OBJETIVO.......: Ajusta Status do Pedido
	*------------------------------------------------------------*
	*  COMENTARIO.....:
	*------------------------------------------------------------*
	*  OBS............:
	*------------------------------------------------------------*
	*  TABELAS.......:
	*------------------------------------------------------------*
	*  PARAMETROS..:
	*		LNemp......:
	*		LNpedido...:
	*------------------------------------------------------------*
	*  RETORNO.....:
	*------------------------------------------------------------*
	* CHAMADAS : SCGC210.SCR -
	*			 SCGC211.PRG -
	*------------------------------------------------------------*
	=W_DEFPROC("rotinas.spr")
	*------------------------------------------------------------*
	PRIVATE LSalias
	PRIVATE LNped 	&& SOMA DAS QTDES PEDIDAS
	PRIVATE LNtra 	&& SOMA DAS QTDES EM TRANSITO
	PRIVATE LNatd 	&& SOMA DAS QTDES ATENDIDAS
	PRIVATE	LSstat1,LSstat2
	PRIVATE situacao

	LSalias = ALIAS()
	*------------------------------------------------------------*

	SELE pedido
	SET ORDER TO TAG pedido
	SEEK LNpedido
	IF !FOUND()
		IF !EMPTY(LSalias) AND USED(LSalias)
			SELECT &LSalias
		ENDIF
		IF !EMPTY(LSalias) AND USED(LSalias)
			SELECT &LSalias
		ENDIF
		RETURN	
	ENDIF
	=REGLOCK(.T.)

	SELE pedite
    SET ORDER TO TAG relacaoit
	SET NEAR ON
	SEEK LNpedido
	SET NEAR OFF
	LNped = 0	&& SOMA DAS QTDES PEDIDAS
	LNtra = 0	&& SOMA DAS QTDES EM TRANSITO
	LNatd = 0	&& SOMA DAS QTDES ATENDIDAS
	IF LNpedido <> pedite.pedido
		SELE pedido
		UNLOCK
		IF !EMPTY(LSalias) AND USED(LSalias)
			SELECT &LSalias
		ENDIF
		RETURN	
	ENDIF

	DO WHILE !EOF() AND LNpedido  =  pedite.pedido
		LNped = LNped + pedite.qtde	
		LNtra = LNtra + pedite.qtdetr
		LNatd = LNatd + pedite.qtdeatd

		*----------------------------------------*
		LSstt1 = "B"
		LSstt2 = " "
		DO CASE
			CASE pedite.qtde <= pedite.qtdeatd
				LSstt1 = "C"		&& FECHADO POR ATENDIMENTO
				LSstt2 = "D" 		&& ATENDIDO POR COMPLETO
			OTHERWISE
				LSstt2 = "B" 		&& ITENS EM TRANSITO
		ENDCASE
	    m.situacao = LSstt1 + LSstt2
		*----------------------------------------*
	   	***************************
	   	SET FIELDS TO dtregis, hregis, usrregis,deletado,situacao
	   	=edithand('REGRAVA')
	   	CLEAR FIELDS
	   	SET FIELDS OFF
	   	***************************
		SKIP
	ENDDO

	LSstat1 = "B"
	LSstat2 = " "
	DO CASE
		CASE LNped <= LNatd
			LSstat1 = "C"		&& FECHADO POR ATENDIMENTO
			LSstat2 = "D" 		&& ATENDIDO POR COMPLETO
		OTHERWISE
			LSstat2 = "B" 		&& ITENS EM TRANSITO
	ENDCASE
	SELE pedido
	m.situacao =  LSstat1+LSstat2
    ***************************
    SET FIELDS TO situacao,dtregis, hregis, usrregis,deletado
    =edithand('REGRAVA')
    CLEAR FIELDS
    SET FIELDS OFF
    ***************************
	UNLOCK
	*-----------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(.T.)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4LT0LWQNH           PDpedido VALID                     º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         PEDIDO,     Record Number:    6    º
*       º Variable:            PDpedido                           º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      5                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4lt0lwqnh     &&  PDpedido VALID
#REGION 1
RETURN

PROCEDURE PDpedido
	PARAMETERS LNemp,LScod,LSclass,LDdtbase,LNqtPend,LNqtTrans

	*------------------------------------------------------------*
	* CLASSIFICACAO:  [****]   MODULO INDEPENDENTE				 *
	*------------------------------------------------------------*
	* OBJETIVO....: Devolve a qtde em TRANSIO e PENDENTE de 	 *
	*		pedidos do produto    						 *
	*------------------------------------------------------------*
	* COMENTARIO..: Utilizada para abater na sugestao de compra a*
	*	    quantidade ja pedida e pendente              *
	*------------------------------------------------------------*
	* OBS : As informacoes de qtde pedida ficam inconsistentes   *
	*       quando a simulacao for feita no passado pois os itens *
	*       pedidos constaram como fechados (<> B)				 *
	*       o que fatalmente sera contraditorio com os itens que  *
	*       estavam pendentes na epoca							 *
	*------------------------------------------------------------*
	*  TABELAS....: PEDITE
	*------------------------------------------------------------*
	*  PARAMETROS..:
	*		LSclass,LScod..: Classificacao e Codigo p/ Pesquisa
	*		LNemp..........: Empresa
	*		LDdtbase.......: Data final p/ considerar qtdes
	*------------------------------------------------------------*
	*  RETORNO.....:                                             *
	*------------------------------------------------------------*
	=W_DEFPROC("rotinas.spr")
	*------------------------------------------------------------*
	PRIVATE LSalias
	PRIVATE LNqttrans		&& ACM. QTDE EM TRANSITO
	PRIVATE LNqtPend		&& ACM. QTDE PENDENTE

	LSalias = ALIAS()
	*----------------------------------------------------------------*
	LNqttrans 		= 0
	LNqtPend 		= 0

	SELECT  pedite
	SET ORDER TO TAG codsit
	SET NEAR ON
	SEEK STR(LNemp,3)+LScod+"B"   && REGISTROS PENDENTES DE PEDIDO
	SET NEAR OFF
	IF BOF() AND EOF()       && ITEMMOV ESTA VAZIO
		IF !EMPTY(LSalias) AND USED(LSalias)
			SELECT &LSalias
		ENDIF
		RETURN(.t.)
	ENDIF

	DO WHILE !EOF() AND LScod 	  = pedite.codigo ;
					AND LNemp 	  = pedite.empresa;
					AND	LDdtbase >= pedite.data ;
					AND LEFT(pedite.situacao,1) = "B"
	 	LNqttrans	= LNqttrans 	+ pedite.qtdetr
	 	LNqtPend	= LNqtPend+ ;
				(pedite.qtde - pedite.qtdetr - pedite.qtdeatd)
		SKIP
	ENDDO
	*-----------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(.T.)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4LT0LWQNI           PDprevisao VALID                   º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         PEDIDO,     Record Number:    7    º
*       º Variable:            PDprevisao                         º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      6                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4lt0lwqni     &&  PDprevisao VALID
#REGION 1
RETURN

PROCEDURE PDprevisao
	PARAMETERS LNemp,LNnro,LSclasini,LSclasfim,LScontrol,LSfiliais,LDdata,;
			LNemdias

	*------------------------------------------------------------*
	* CLASSIFICACAO:  [**]
	*------------------------------------------------------------*
	* OBJETIVO....:  1o ESTAGIO da montagem do pedido
	*  			Controla o processo de sugestao de compra para os itens
	*		do intervalo passado em parametro
	*------------------------------------------------------------*
	* COMENTARIO..:
	*------------------------------------------------------------*
	* OBS :
	*------------------------------------------------------------*
	*  TABELAS....:
	*------------------------------------------------------------*
	*  PARAMETROS..:
	*		LNemp......: Empresa que Comandou o Processamento
	*		LNnro......: Numero do Doc. para Registro do Processo
	*		LSclasini..: Codigo de Classificacao Inicial do intervalo
	*		LSclasfim..: Codigo de Classificacao Final do Intervalo
	*		LScontrol..: Identifica os Tipos de Estoque que estao
	*				sendo incluidos no processo
	*		LSfiliais..: String com os Codigos das Empresas para as
	*				quais se escoleu a previsao
	*		LNemdias...: Numero de Dias que se deve Estocar
	*------------------------------------------------------------*
	=W_DEFPROC("rotinas.spr")
	*------------------------------------------------------------*
	PRIVATE LSalias
	LSalias = ALIAS()

	PRIVATE LNordini, LNordfim
	PRIVATE	LNctracm
	PRIVATE QBRregiao,QBRfilial
	PRIVATE LAgiro180,LAgiro90,LAgiro45,LAgiro25,LAgiro15,LAgiromedio
	PRIVATE LAsaldo,LApdpendente,LApdtransito,LAsugestao
	
	*------------------------------------------------------------*

	SELECT  itprvstq
	SET ORDER TO TAG ordena

	SET NEAR ON
	SEEK STR(LNemp,3)+STR(LNnro,6)
	SET NEAR OFF

	IF  LNemp = itprvstq.empresa AND LNnro  = itprvstq.numero
		DO OBJ_ALER.SPR WITH " ATENCAO !!!" +;
			 " Se voce confirmar a proxima pergunta os dados "+;
			 " anteriores do PROCESSO" +;
		 	" Nro :" +STR(LNnro,6)+"  serao apagados ."
		IF !fox_alert('Confirmacao 1a de 2 => Confirma o Processamento ?.')
			SELE prvcbstq
			UNLOCK
	   		RETURN(.f.)
		ENDIF

		IF !fox_alert('Confirmacao 2a de 2 => Confirma o Processamento ?.')
			SELE prvcbstq
			UNLOCK
   			RETURN(.f.)
		ENDIF
	ENDIF

	***> ((((( EXCLUSAO )))

	DO WHILE !eof() AND LNemp = itprvstq.empresa ;
					AND LNnro  = itprvstq.numero
			LSmsg = " Eliminando Registro Anteriores : "+STR(RECNO(),6)
			WAIT WINDOWS LSmsg NOWAIT
			
		  	=REGLOCK(.T.)
			=EDITHAND("APAGA")
			SKIP
	ENDDO

	*-----------------------------------------------------------------*
	*  	Definindo Intervalo de Produtos Pela Ordem Relacionadas a
	* LSclasini e LSclasfim
	*-----------------------------------------------------------------*
	SELE GRUPO
	SET ORDER TO TAG classifica
	SET NEAR ON
	SEEK  LSclasfim
	SET NEAR OFF
	DO WHILE !EOF() AND grupo.ordem = 0
		SKIP
	ENDDO
	IF EOF()
		LNordfim = 99999
	ELSE
		LNordfim = grupo.ordem
	ENDIF
	SET NEAR ON
	SEEK  LSclasini
	SET NEAR OFF
	LNordini = grupo.ordem
	DO WHILE !EOF() AND grupo.ordem = 0
		SKIP
	ENDDO
	IF EOF()
	   WAIT WINDOW ;
   			"Nao Foram Encontrados Iten com Ordem no Intervalo de Produtos."
	   RETURN(.F.)
	ENDIF
	LNordini = grupo.ordem
	SET ORDER TO TAG ordem
	SET NEAR ON
	SEEK  LNordini
	SET NEAR OFF
	*-----------------------------------------------------------------*
	*   (INICIALIZACAO DO CONTROLE DE STATUS IMPRESSAO)
	*-----------------------------------------------------------------*
	DO RELINIC.PRG          && INICIA VAR P/ TERMOMETRO
	LFsegue = .t.
	LNregistro = RECNO()
	COUNT FOR 	(STR(grupo.tp_control,1) $ LScontrol ;
   			AND grupo.cdg_tipo  = 4) ;
		    WHILE  grupo.ordem <= LNordfim TO LNimpressao

	LNimpressos = 0
	GO LNregistro
	*-----------------------------------------------------------------*
	*  (COMPLETADO PREPARACAO DO CONTROLE DE STATUS IMPRESSAO)
	*-----------------------------------------------------------------*
	SET RELATION TO

	DO WHILE !EOF() AND grupo.ordem <= LNordfim AND LFsegue
		LSmsg = 	  " Cod. : "+ grupo.codigo
		WAIT WINDOW LSmsg NOWAIT

		IF !(STR(grupo.tp_control,1) $ LScontrol) OR grupo.cdg_tipo <> 4
			SKIP
			LOOP
		ENDIF
		=UPtermo()		
		*---------------------------------------------------------------*	
		*    Seleciona so Produto Indicados para Empresas e que Constem
		* em Tabelas
		*---------------------------------------------------------------*	
		IF EMPTY(ALLTRIM(grupo.empresas)) ;
			AND	EMPTY(ALLTRIM(grupo.tab_preco))
				SKIP
				LOOP
		ENDIF
		*---------------------------------------------------------------*	
		*    Seleciona so Produto quando (Pneus, Camaras e Protetores
		* se Fornecedor for Firestone= 1
		*		PNEU     = 00
		*       CAMARA   = 01
		*       PROTETOR = 04042
		*---------------------------------------------------------------*	
		IF (LEFT(grupo.classifica,02) $ "00/01" OR ;
		   LEFT(grupo.classifica,05) $ "04042") AND ;
			 AND grupo.codforn <> 1 "
				SKIP
				LOOP
		ENDIF

		SELE empresa
		SET ORDER TO TAG regiao
		GO TOP
		QBRregiao 	= 	empresa.regiao
		QBRfilial 	= 	empresa.empresa

		m.tp_reg   = "1" && PRIMEIRO REGISTRO DO CODIGO => PRIM. EMP
		DO WHILE !EOF()
			LSmsg = 	  " Cod. : "+ grupo.codigo ;
						+ " Emp. : "+ STR(empresa.empresa)
			WAIT WINDOW LSmsg NOWAIT

			QBRregiao 	= 	empresa.regiao
			QBRfilial 	= 	empresa.empresa
			*<<<<<<<< ACUMULADORES DO CODIGO ENTRE EMPRESAS >>>>>>>>*
			LNctracm    = 	0
			LAgiro180	= 	0
			LAgiro90	=	0
			LAgiro45	=	0
			LAgiro25	=	0
			LAgiro15	=	0
			LAgiromedio =  	0

			LAsaldo	  	= 	0
			LApdpendente= 	0
			LApdtransito= 	0
			LAsugestao	= 	0

			DO WHILE !EOF() AND QBRregiao = empresa.regiao
				LSmsg = 	  " Cod. : "+ grupo.codigo ;
							+ " Emp. : "+ STR(empresa.empresa)

				WAIT WINDOW LSmsg NOWAIT
				SELE empresa
				LNfil = empresa.empresa
				LSfil = STR(empresa.empresa,3)
				LSfil = CHRTRAN(LSfil," ","0")
				IF !(LSfil $ LSfiliais)
					SKIP
					LOOP
				ENDIF
				SELE ITPRVSTQ
				SCATTER MEMVAR BLANK
				*------------------------------------------------------*

				*------------------------------------------------------*
				=W_DEFPROC("PEDIDO.SPR")
				=PDdefGiro(LNfil,grupo.codigo,grupo.classifica,LDdata,;
					m.giro15,m.giro25,m.giro45,m.giro90,m.giro180)
				*------------------------------------------------------*
				=W_DEFPROC("ESTOQUE.SPR")
				=ESsaldo(LNfil,grupo.codigo,grupo.classifica,LDdata,;
							m.saldo,0,.f.,0)
				*------------------------------------------------------*
				=W_DEFPROC("PEDIDO.SPR")
				=PDpedido(LNfil,grupo.codigo,grupo.classifica,LDdata,;
						m.pdpendente,m.pdtransito)
				*------------------------------------------------------*

				*------------------------------------------------------*

				m.giromedio = 	((m.giro15 * 2.4)+;
								(m.giro25  * 2.4)+;
								(m.giro45  * 2.4)+;
								(m.giro90  * 0.64)+;
								(m.giro180 * 0.16)) / 8

				m.sugestao  =  (LNemdias * m.giromedio) - m.saldo ;
								- m.pdpendente - m.pdtransito

				***********************************************************
				*  Uma filial pode ser configurada para nao contribuir com
				* o estoque da regional(CONTRBSTQR) em caso de
				* SOBRA (SUGESTAO < 0) a sugestao nao e considerada
				* pois o estoque nao sera realocado para outra filial
				*  Em filias que compartilham estoqu a sugestao NEGATIVA
				* anula sugestoes ex:
				*		SUGESTAO ATE O MOMENTO COMPRAR 20
				*			UMA FILIAL COMPARTILHA E SOBRA 6 =>
				*			COMPRAR 14
				**********************************************************
				IF m.sugestao < 0  AND empresa.contrbstqr = "N"
					m.sugestao  =  0
				ENDIF
				**********************************************************
				m.regional  = 	QBRregiao
				m.numero 	= 	LNnro
				m.tipo_reg  = 	m.tp_reg
				m.empresa 	= 	LNemp
				m.filial	=	LNfil
				m.codigo	=	grupo.codigo
				m.classifica=   grupo.classifica
				m.data		=	LDdata
				************************************************************
				*  VALORES ACUMULADOS PARA REGISTRO GERAL FILIAL = (999)
				************************************************************
				LNctracm  	=	LNctracm    + 	1

				LAgiro180	= 	(LAgiro180	+ 	m.giro180)/ 	2
				LAgiro90	=	(LAgiro90	+ 	m.giro90)	/	2
				LAgiro45	=	(LAgiro45	+ 	m.giro45)	/	2
				LAgiro25	=	(LAgiro25	+ 	m.giro25)	/	2
				LAgiro15	=	(LAgiro15	+ 	m.giro15)	/	2
				
				LAgiromedio = 	(LAgiromedio +  ;
								((LAgiro15 * 2.4)+;
								(LAgiro25 * 2.4)+;
								(LAgiro45 * 2.4)+;
								(LAgiro90 * 0.64)+;
								(LAgiro180* 0.16)) /8  ) / 2


				LApdpendente=   LApdpendente+ 	m.pdpendente
				LApdtransito=	LApdtransito+ 	m.pdtransito
				LAsaldo	  	= 	LAsaldo		+ 	m.saldo
				LAsugestao 	=   LAsugestao 	+	m.sugestao			

				SELE ITPRVSTQ
				=EDITHAND("SAVE")
				m.tp_reg = "2"	&& DEMAIS REGISTROS DO CODIGO=>ALEM DA 1aEMP
				SELE GRUPO
				SET ORDER TO TAG ordem

				SELE empresa
				SET ORDER TO TAG regiao
				SKIP
			ENDDO
			IF LNctracm  > 0
				m.tipo_reg = "T"
					&& REG. TOTALIZADOR => ULTIMO QDO GRUPO DE EMPRES

				m.filial 	 = 999
				m.regional 	 = QBRregiao

				m.codigo	=	grupo.codigo
				m.classifica=   grupo.classifica
				m.data		=	LDdata

				m.giro180	= 	LAgiro180
				m.giro90	=	LAgiro90
				m.giro45	=	LAgiro45
				m.giro25	=	LAgiro25
				m.giro15	=	LAgiro15

				m.giromedio  = LAgiromedio

				m.pdpendente=   LApdpendente
				m.pdtransito=	LApdtransito
				m.saldo	  	= 	LAsaldo		
				m.sugestao 	=   LAsugestao

				SELE ITPRVSTQ
				=EDITHAND("SAVE")
			
			ENDIF
			SELE empresa
		ENDDO
		SELE grupo
		SET ORDER TO TAG ordem
		SKIP
	ENDDO
	DO RELFIM.PRG          && FIM VAR P/ TERMOMETRO
	*-----------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(.T.)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4LT0LWQNJ           PDdefGiro VALID                    º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         PEDIDO,     Record Number:    8    º
*       º Variable:            PDdefGiro                          º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      7                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4lt0lwqnj     &&  PDdefGiro VALID
#REGION 1
RETURN

FUNCTION PDdefGiro
	PARAMETERS LNemp,LScod,LSclas,LDdtref,LNgiro15,LNgiro25,;
			LNgiro45,LNgiro90,LNgiro180
	*------------------------------------------------------------*
	* CLASSIFICACAO:  [**]
	*------------------------------------------------------------*
	* OBJETIVO....:  Definir o Giro em 5 faixas predeterminadas
	*			15,25,45,90 e 180 dias uteis
	*------------------------------------------------------------*
	* COMENTARIO..:
	*------------------------------------------------------------*
	* OBS :
	*------------------------------------------------------------*
	*  TABELAS....:
	*------------------------------------------------------------*
	*  PARAMETROS..:
	*		LNemp......: Empresa que Comandou o Processamento
	*		LScod......: Codigo do Produto
	*		LSclas.....: Codigo de Classificacao Associada ao Produto
	*		LDdtref....: Data de Referencia para Deslocamento de dias
	*		LNgiro15,LNgiro25,LNgiro45,LNgiro90,LNgiro180....:
	*					 Giros a Serem retornados
	*------------------------------------------------------------*
	=W_DEFPROC("rotinas.spr")
	*------------------------------------------------------------*
	PRIVATE LSalias
	LSalias			= ALIAS()
	*------------------------------------------------------------*

	DIMENSION LVvendas[180,2]
	STORE 0 TO LVvendas
	PRIVATE LNqtvenda
	PRIVATE LNsaldo
	PRIVATE LNuteis 	&& Qtde de Dias Uteis Ja Encontrados	
	PRIVATE LNtotal     && Total de Dias Independente de Ser Util

	LNqtvenda 	= 0
	LNsaldo     = 0
	LNuteis 	= 0		&& Qtde de Dias Uteis Ja Encontrados	
	LNtotal 	= 0     && Total de Dias Independente de Ser Util
	*----------------------------------------------------------------*
	*   Carrega Vetor com Vendas e Saldos nos 180 uteis anteriores
	* a data de Referencia
	*----------------------------------------------------------------*
	DO WHILE LNuteis < 180
		LNtotal = LNtotal + 1
		LDEncontrada = LDdtref - LNtotal

		LSmsg = 	  " Cod. : "+ LScod ;
					+ " Emp. : "+ STR(LNemp) ;
					+ " Dias.Ut : "+ STR(LNuteis,4,0) ;
					+ " Data : "+ DTOC(LDEncontrada)
		WAIT WINDOW LSmsg NOWAIT


		IF DOW(LDEncontrada) <> 1
			*------------------------------------------------------*
			=W_DEFPROC("PEDIDO.SPR")
			=PDvendasparagiro(LNemp,LScod,LDEncontrada,;
					LDEncontrada,LNqtvenda)
			*------------------------------------------------------*
			=W_DEFPROC("ESTOQUE.SPR")
			=ESsaldo(LNemp,LScod,LSclas,LDEncontrada-1,LNsaldo,0,.f.,0)
			*------------------------------------------------------*
			LNuteis = LNuteis + 1
			LVvendas[LNuteis,1] = LNqtvenda
			LVvendas[LNuteis,2] = LNsaldo
		ENDIF
	ENDDO
	*----------------------------------------------------------------*
	LNgiro15 = PDgiro(LVvendas,15)
	LNgiro25 = PDgiro(LVvendas,25)
	LNgiro45 = PDgiro(LVvendas,45)
	LNgiro90 = PDgiro(LVvendas,90)
	LNgiro180 = PDgiro(LVvendas,180)
	*------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(.T.)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4LT0LWQNK           PDgiro VALID                       º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         PEDIDO,     Record Number:    9    º
*       º Variable:            PDgiro                             º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      8                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4lt0lwqnk     &&  PDgiro VALID
#REGION 1
RETURN
FUNCTION PDgiro
	PARAMETERS LVvendas, LNdias
	*------------------------------------------------------------*
	* CLASSIFICACAO:  [**]
	*------------------------------------------------------------*
	* OBJETIVO....:  Calcula o Giro
	*------------------------------------------------------------*
	* COMENTARIO..:
	*------------------------------------------------------------*
	* OBS :
	*------------------------------------------------------------*
	*  TABELAS....:
	*------------------------------------------------------------*
	*  PARAMETROS..:
	*		LVvendas...: Vetor Bidimensional com Qtde Vendas e Saldo
	*		LNdias.....: Numero de Dias para calculo do giro
	*------------------------------------------------------------*
 	=W_DEFPROC("rotinas.spr")
	*------------------------------------------------------------*
	PRIVATE LSalias
	LSalias			= ALIAS()
	*------------------------------------------------------------*
	PRIVATE LNmaiorVenda ,LNmenorVenda	
	PRIVATE LNqtdDiasZero
	PRIVATE LNacmVenda
	PRIVATE LNpercent
	LNmaiorVenda	= 1		&& Indice do Ventor Onde se Encontra o Pico + de Venda
	LNmenorVenda	= 1		&& Indice do Ventor Onde se Encontra o Pico - de Venda
	LNacmVenda		= 0
	LNqtdDiasZero 	= 0
	
	FOR LNind = 1 TO LNdias
		IF LVvendas[LNind,1] >  LVvendas[LNmaiorVenda,1]
			LNmaiorVenda = LNind
		ENDIF
		IF LVvendas[LNind,1] <  LVvendas[LNmenorVenda,1]
			LNmenorVenda = LNind
		ENDIF
		LNacmVenda = LNacmVenda + LVvendas[LNind,1]
		IF LVvendas[LNind,2]  < 2				&& < 2 CONSIDERA = 0
			LNqtdDiasZero = LNqtdDiasZero + 1  	&& DIAS COM ESTOQUE ZERO
		ENDIF
	NEXT
	*----------------------------------------------------------------*
	* 	O calculo do percentual de dias em que o estoque fica zerado
	* indica conforme o seu indice que :
	*		> 70 % => Indica que o produto pode estar sendo atendido
	*					sob encomenda o que provoca um alto  valor
	*					de giro porem falso. Neste caso o giro e feito
	*					sobre todo o periodo e nao somente sobre os dias
	*					com estoque
	*	   <= 70 % => Produto com venda normal e provavelmente nao venda
	*					nos dias zerados pela falta de estoque. Neste
	*					caso o giro e feito sobre os dias com estoque.
	*----------------------------------------------------------------*
	LNacmVenda = LNacmVenda - LVvendas[LNmaiorVenda,1]
	LNacmVenda = LNacmVenda - LVvendas[LNmenorVenda,1]

	LNpercent  = (LNqtdDiasZero * 100) / LNdias
	IF LNpercent > 70
		LNgiro = LNacmVenda / (LNdias - 2)
	ELSE	
		LNgiro = LNacmVenda / (LNdias - LNqtdDiasZero - 2)
	ENDIF
	*------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(LNgiro)



*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4LT0LWQNL           PDvendasparagiro VALID             º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         PEDIDO,     Record Number:   10    º
*       º Variable:            PDvendasparagiro                   º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      9                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4lt0lwqnl     &&  PDvendasparagiro VALID
#REGION 1
RETURN

FUNCTION PDvendasparagiro
	*------------------------------------------------------------*
	* CLASSIFICACAO:  [*****]   MODULO INDEPENDENTE				 *
	*------------------------------------------------------------*
	* OBJETIVO....: Informar Vendas em Periodo informado
	*------------------------------------------------------------*
	* COMENTARIO..:
	*------------------------------------------------------------*
	* OBS........ :
	*------------------------------------------------------------*
	* TABELAS....: EMPRESA,SALDO,ITEMMOV
	*------------------------------------------------------------*
	* PARAMETROS..:
	*		LNemp..........: Empresa
	*		LScod..........: Codigo do Produto
	*		LDdtInicio.....: Data inicial
	*		LDdtFim........: Data inicial
	*		LNqtvenda.........: Referencia p/ Retorno
	*------------------------------------------------------------*
	*	CHAMADA............: NEsoma_Saldo
	*
	*
	*
	*------------------------------------------------------------*
	* RETORNO.....:
	*		LNqtvenda.........: Qtde Vendida
	*------------------------------------------------------------*
	PARAMETERS LNemp,LScod,LDdtInicio,LDdtFim,LNqtvenda
	*------------------------------------------------------------*
	=W_DEFPROC("rotinas.spr")
	*------------------------------------------------------------*
	PRIVATE LSalias
	PRIVATE LFitemmov,LFnotaent

	LNqtvenda  	= 0
	LSalias			= ALIAS()
	LFitemmov		= NetArq("itemmov")
	LFnotaent		= NetArq("notaent")
	IF (LFitemmov) > 100000 && HOUVE FALHA DE ABERTURA
		=UP_fecha("itemmov" ,LFitemmov)
		=UP_fecha("notaent" ,LFnotaent)
		IF !EMPTY(LSalias) AND USED(LSalias)
			SELECT &LSalias
		ENDIF
		RETURN(.f.)
	ENDIF
	*-----------------------------------------------------------*
	SELE itemmov
	SET ORDER TO  TAG movimento
	SET NEAR ON
	SEEK STR(LNemp,3)+LScod+DTOS(LDdtinicio)
	SET NEAR OFF

	DO WHILE itemmov.data <= LDdtFim AND ;
			 itemmov.empresa = LNemp AND ;
			 itemmov.codigo  = LScod
		DO  CASE
			*------------------------------------------------------------*
			*  DESPREZANDO : OPER Q. NAO SEJAM VENDA, VENDA CASADA,
			*			OPER. QUE NAO MOV ESTOQUE ,
			*			OPERACAO QUE NAO SEJAM SAIDA
			*			
			*          NAO PODEM AFETAR O GIRO
			*------------------------------------------------------------*
			CASE itemmov.ch_opera = "1" 	 ;
				AND	itemmov.negociacao  <> 2 ;
				AND itemmov.movestq = "S"    ;
				AND LEFT(itemmov.operacao,1) = 'S'
				 	LNqtvenda  = LNqtvenda  + itemmov.qtde
			*------------------------------------------------------------*
			*  ABATENDO DEVOLUCOES
			*------------------------------------------------------------*
			CASE LEFT(itemmov.operacao,1) = 'E' ;
				AND itemmov.ch_opera = "4";
				AND itemmov.movestq = "S"
				SELE notaent
				SET ORDER TO TAG boletim
				SEEK STR(itemmov.empresa,3)+;
					 STR(itemmov.orcamento,6)+;
					 STR(itemmov.codforn,5)
				IF FOUND() AND !empty(notaent.nfdevolve)
				 	LNqtvenda  = LNqtvenda  - itemmov.qtde
				    IF LNqtvenda < 0
		 				LNqtvenda = 0
					ENDIF
				ENDIF
		ENDCASE
		SELE itemmov
		SKIP
	ENDDO
	=UP_fecha("itemmov" ,LFitemmov)
	=UP_fecha("notaent" ,LFnotaent)
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(.T.)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4LT0LWQOX           PDQtds_pedido VALID                º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         PEDIDO,     Record Number:   11    º
*       º Variable:            PDQtds_pedido                      º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      10                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4lt0lwqox     &&  PDQtds_pedido VALID
#REGION 1
RETURN

PROCEDURE PDQtds_pedido
	*------------------------------------------------------------*
	=W_DEFPROC("rotinas.spr")
	*------------------------------------------------------------*
	PRIVATE LSalias
	LSalias = ALIAS()
	*----------------------------------------------------------------*
	=PDVerifyInst()
	*-----------------------------------------------------------*
	SELECT  empresa AS LOJA, ;
			codigo,;
			qtdetr AS TRANSITO, ;
			(qtde - qtdetr - qtdeatd) AS PENDENTE ;
    FROM &PBPediteAlias ;
    WHERE LEFT(situacao,1)  = "B";
    INTO CURSOR CRSpendencias




	*-----------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN("CRSpendencias")


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4LT0LWQP6           PDCreate VALID                     º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         PEDIDO,     Record Number:   12    º
*       º Variable:            PDCreate                           º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      11                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4lt0lwqp6     &&  PDCreate VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION PDCreate
	=W_DEFPROC("rotinas.spr")
	PRIVATE LSalias
	PRIVATE LSAlsTmp
    PRIVATE LMaxDim
	LSalias		= 	ALIAS()

	IF TYPE("PBPediteAlias") <> "U" ;
	   		AND !EMPTY(PBPediteAlias) ;
	   		AND USED(PBPediteAlias)
			RETURN(.T.)
	ENDIF
	

	PUBLIC PBPediteAlias

	IF USED("PEDITE")
	     =NetArqAgain("Pedite")
	     PBPediteAlias     = Alias()
	ELSE
	     =NetArqAgain("Pedite")
	     LSAlsTmp     = Alias()
	     =NetArqAgain("Pedite")
	     PBPediteAlias     = Alias()
		 IF !EMPTY(LSAlsTmp) AND USED(LSAlsTmp)
			SELECT &LSAlsTmp
			USE
		 ENDIF
	ENDIF	

    SELE &PBPediteAlias
	LMaxDim = Fcount()
    PUBLIC DIMENSION VTPEDITE[LMaxDim]
    PUBLIC DIMENSION VDPEDITE[1,3]			&& VETOR PARA PROPRIEDADES
	*-----------------------------------------------------------*
	=PDReadProperty()
	=PDSetDerivadas()   && carga dos calculos derivados
	*--------------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN



*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4LT0LWQP7           PDReadProp VALID                   º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         PEDIDO,     Record Number:   13    º
*       º Variable:            PDReadProp                         º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      12                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4lt0lwqp7     &&  PDReadProp VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION PDReadProp
	PRIVATE LSalias
	LSalias		= 	ALIAS()

	=PDVerifyInst()

	SELE &PBPediteAlias
	SCATTER TO VTPedite
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(.T.)



*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4LT0LWQP8           PDSetPropVT VALID                  º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         PEDIDO,     Record Number:   14    º
*       º Variable:            PDSetPropVT                        º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      13                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4lt0lwqp8     &&  PDSetPropVT VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION PDSetPropVT
PARAMETER  PrmField, PrmValue

	PRIVATE Lvalue
	=PDVerifyInst()
	=W_DEFPROC("ROTINAS.SPR")
	Lvalue = RTsetValueObj(PrmField,PrmValue,;
						    PBPediteAlias,VTPedite,VDPedite)

RETURN(Lvalue)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4LT0LWQP9           PDFind VALID                       º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         PEDIDO,     Record Number:   15    º
*       º Variable:            PDFind                             º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      14                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4lt0lwqp9     &&  PDFind VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION PDFind
	PRIVATE LEmpresa, LPedido , Lcodigo, Lordem
	PRIVATE LFreturn

	PRIVATE LSalias
	LSalias		= 	ALIAS()

	=PDVerifyInst()

	LEmpresa    = PDGetPropVT("Empresa")
	LPedido     = PDGetPropVT("Pedido")
	LCodigo     = PDGetPropVT("Codigo")
	LOrdem      = PDGetPropVT("Ordem")

	SELE &PBPediteAlias
	SET ORDER TO TAG CHV_EXCLUS
	SEEK STR(LEmpresa,3)+STR(LPedido,6)+LCodigo+STR(LOrdem,5)

	IF FOUND()
		=PDReadProperty()
		=PDSetDerivadas()   && carga dos calculos derivados
	    LFreturn = .T.
	ELSE
	    LFreturn = .f.
	ENDIF
	*--------------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(LFreturn)



*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4LT0LWQPA           PDGetPropVT VALID                  º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         PEDIDO,     Record Number:   16    º
*       º Variable:            PDGetPropVT                        º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      15                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4lt0lwqpa     &&  PDGetPropVT VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION PDGetPropVT
PARAMETER  PrmField
	PRIVATE Lvalue

	=PDVerifyInst()
	=W_DEFPROC("ROTINAS.SPR")
	Lvalue = RTgetValueObj(PrmField,PBPediteAlias,VTPedite,VDPedite)

RETURN(Lvalue)




*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4LT0LWQPB           PDVerifyInst VALID                 º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         PEDIDO,     Record Number:   17    º
*       º Variable:            PDVerifyInst                       º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      16                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4lt0lwqpb     &&  PDVerifyInst VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION PDVerifyInst
PRIVATE LSpath


	=W_DEFPROC("rotinas.spr")
	LSpath = UPobterPath("PEDITE")


	IF TYPE("PBPediteAlias") = "U" ;
	   		OR EMPTY(PBPediteAlias) ;
	   		OR !USED(PBPediteAlias)
		=PDCreate()
	ELSE
		IF !(LSPath $ DBF(PBPediteAlias)) && HOUVE MUDANCA DE DIR BASE
			=PDDestroi()				   && ELIMINA INSTACIA DE OUTRA BASE
			=PDCreate()					   && CRIA INSTANCIA NA NOVA BASE
		ENDIF
	ENDIF
RETURN(.t.)



*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4LT0LWQQG           PDDestroi VALID                    º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         PEDIDO,     Record Number:   18    º
*       º Variable:            PDDestroi                          º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      17                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4lt0lwqqg     &&  PDDestroi VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION PDDestroi
	=W_DEFPROC("rotinas.spr")

	PRIVATE LSalias
	LSalias  = Alias()
	IF !EMPTY(PBPediteAlias) AND USED(PBPediteAlias)
		SELECT &PBPediteAlias
		USE
	ENDIF	
	RELEASE PBPediteAlias
    RELEASE VTPedite
    RELEASE VDPedite

	*-----------------------------------------------------------*
	*--------------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN



*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4LT0LWQQP           PDSetDerivadas VALID               º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         PEDIDO,     Record Number:   20    º
*       º Variable:            PDSetDerivadas                     º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      18                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4lt0lwqqp     &&  PDSetDerivadas VALID
#REGION 1
return
*---------------------------------------------------------------*

FUNCTION PDSetDerivadas
	PRIVATE LSalias
	PRIVATE LEmpresa
	LSalias		= 	ALIAS()

	=PDVerifyInst()
	*--------------------------------------------------------------*
    VDPedite(1,1) = " "
   	VDPedite(1,2) = 0
   	VDPedite(1,3) = .F.
	*--------------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(.T.)



*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4LT0LWQQQ           PDChk_Identidade VALID             º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         PEDIDO,     Record Number:   21    º
*       º Variable:            PDChk_Identidade                   º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      19                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4lt0lwqqq     &&  PDChk_Identidade VALID
#REGION 1
return
*---------------------------------------------------------------*
*------------------------ < ROT. APOIO >------------------------*
*---------------------------------------------------------------*

FUNCTION PDChk_Identidade
PARAMETERS PrmEmp, PrmPedido, PrmCodigo, PrmOrdem

	PRIVATE LFreturn
	=PDVerifyInst()
	*----------------------------------------------------------------*

	IF ;
	   !FOUND(PBPedidoAlias) OR ;
       PrmEmp 		 <> PDGetPropVT("EMPRESA") OR ;
	   PrmPedido  	 <> PDGetPropVT("PEDIDO") OR ;
	   PrmCodigo     <> PDGetPropVT("CODIGO") OR ;
	   PrmOrdem   	 <> PDGetPropVT("ORDEM")
	    =PDSetPropVT("EMPRESA",PrmEmp)
	    =PDSetPropVT("PEDIDO",PrmPedido)
	    =PDSetPropVT("CODIGO",PrmCodigo)
	    =PDSetPropVT("ORDEM",PrmOrdem)
		=PDFind()
	ENDIF
	RETURN(.t.)




*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4LT0LWQQR           PDPedir VALID                      º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         PEDIDO,     Record Number:   22    º
*       º Variable:            PDPedir                            º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      20                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4lt0lwqqr     &&  PDPedir VALID
#REGION 1
RETURN

PROCEDURE PDPedir
PARAMETERS PrmOrdIni, PrmOrdFim, PrmControl,;
			 PrmParaXDias,PrmPerfil_01,PrmDuracaPor

	*---------------------------------*
	* PrmDuracaPor = "PADRAO"
	* PrmDuracaPor = "POR LOJA"
	* PrmDuracaPor = "POR CIDADE"
	*---------------------------------*

	PRIVATE LSalias

    IF TYPE("PrmDuracaPor") <> "C"
        PrmDuracaPor = "PADRAO"
    ENDIF
	
	
	LSalias = alias()
	=PDVerifyInst()

	*------------------------------------------------------------*
	=W_DEFPROC("ITEMMOV.SPR")
	CRSGro_tmp   =IMGiroControle(PrmOrdIni, PrmOrdFim, PrmControl,;
                                PrmPerfil_01)
	*-----------------------------------------------------------*
	*                       FILTRO
	*-----------------------------------------------------------*

	SELECT GIR.* ;
	FROM &CRSGro_tmp GIR, GRUPO GRP ;
	WHERE    GIR.CODIGO = GRP.CODIGO ;
		AND !EMPTY(ALLTRIM(grp.empresas)) ;
		AND	!EMPTY(ALLTRIM(grp.tab_preco)) ;
	INTO CURSOR CRSGro_estq


	*-----------------------------------------------------------*
	SELECT  empresa AS LOJA, ;
			codigo,;
			sum(qtdetr) AS TRANSITO, ;
			sum(qtde - qtdetr - qtdeatd) AS PENDENTE ;
    FROM &PBPediteAlias ;
    WHERE LEFT(situacao,1)  = "B";
    GROUP BY LOJA, CODIGO      ;
    INTO CURSOR CRSpendencias
	*-----------------------------------------------------------*



	*-----------------------------------------------------------*
	SELECT ;	
		ORDEM,CODIGO,DESCRICAO,CLASSIFICA,;
		SLD_GYN,SLD_SIA,SLD_W3,SLD_BGS,SLD_IPG,SLD_CGB,SLD_ARG,;
		SLD_ANP,SLD_RIO,SLD_IDL,SLD_T63,SLD_DPO,SLD_CNB,SLD_CNG,SLD_DPA,;
		SLD_ABO,SLD_T2,SLD_DPA2,SLD_DPN,;
		GRO_GYN,GRO_SIA,GRO_W3,GRO_BGS,GRO_IPG,GRO_CGB,GRO_ARG,;
        GRO_ANP,GRO_RIO,GRO_IDL,GRO_T63,GRO_DPO,GRO_CNB,GRO_CNG,;
        GRO_DPA,GRO_ABO,GRO_T2,GRO_DPA2,GRO_DPN,;
		ULtransito(1,CODIGO) AS Tran_GYN,;
		ULtransito(2,CODIGO) AS Tran_SIA,;
		ULtransito(3,CODIGO) AS Tran_W3,;
		ULtransito(4,CODIGO) AS Tran_BGS,;
		ULtransito(5,CODIGO) AS Tran_IPG,;
		ULtransito(6,CODIGO) AS Tran_CGB,;
		ULtransito(7,CODIGO) AS Tran_T63,;
		ULtransito(8,CODIGO) AS Tran_ARG,;
		ULtransito(9,CODIGO) AS Tran_RIO,;
		ULtransito(10,CODIGO) AS Tran_IDL,;
		ULtransito(11,CODIGO) AS Tran_DPO,;
		ULtransito(14,CODIGO) AS Tran_ANP,;
		ULtransito(17,CODIGO) AS Tran_ABO,;
		ULtransito(20,CODIGO) AS Tran_DPA,;
		ULtransito(30,CODIGO) AS Tran_CNB,;
		ULtransito(31,CODIGO) AS Tran_CNG,;
		ULtransito(18,CODIGO) AS Tran_T2,;
		ULtransito(21,CODIGO) AS Tran_DPA2,;
		ULtransito(22,CODIGO) AS Tran_DPN,;
		ULpendente(1,CODIGO) AS Pend_GYN,;
		ULpendente(2,CODIGO) AS Pend_SIA,;
		ULpendente(3,CODIGO) AS Pend_W3,;
		ULpendente(4,CODIGO) AS Pend_BGS,;
		ULpendente(5,CODIGO) AS Pend_IPG,;
		ULpendente(6,CODIGO) AS Pend_CGB,;
		ULpendente(7,CODIGO) AS Pend_T63,;
		ULpendente(8,CODIGO) AS Pend_ARG,;
		ULpendente(9,CODIGO) AS Pend_RIO,;
		ULpendente(10,CODIGO) AS Pend_IDL,;
		ULpendente(11,CODIGO) AS Pend_DPO,;
		ULpendente(14,CODIGO) AS Pend_ANP,;
		ULpendente(17,CODIGO) AS Pend_ABO,;
		ULpendente(20,CODIGO) AS Pend_DPA,;
		ULpendente(30,CODIGO) AS Pend_CNB,;
		ULpendente(31,CODIGO) AS Pend_CNG,;
		ULpendente(18,CODIGO) AS Pend_T2,;
		ULpendente(21,CODIGO) AS Pend_DPA2,;
		ULpendente(22,CODIGO) AS Pend_DPN;
	FROM CRSGro_est ;
	ORDER BY ORDEM;
	INTO CURSOR CrsPrevio


	SELECT CrsPrevio.*, ;	
		Sld_GYN+Tran_GYN+Pend_GYN AS DSPN_GYN ,;
		Sld_SIA+Tran_SIA+Pend_SIA AS DSPN_SIA,;
		Sld_W3+Tran_W3+Pend_W3    AS DSPN_W3  ,;
		Sld_BGS+Tran_BGS+Pend_BGS AS DSPN_BGS,;
		Sld_IPG+Tran_IPG+Pend_IPG AS DSPN_IPG,;
		Sld_CGB+Tran_CGB+Pend_CGB AS DSPN_CGB,;
		Sld_T63+Tran_T63+Pend_T63 AS DSPN_T63,;
		Sld_ARG+Tran_ARG+Pend_ARG AS DSPN_ARG,;
		Sld_RIO+Tran_RIO+Pend_RIO AS DSPN_RIO,;
		Sld_IDL+Tran_IDL+Pend_IDL AS DSPN_IDL,;
		Sld_DPO+Tran_DPO+Pend_DPO AS DSPN_DPO,;
		Sld_ANP+Tran_ANP+Pend_ANP AS DSPN_ANP,;
		Sld_ABO+Tran_ABO+Pend_ABO AS DSPN_ABO,;
		Sld_DPA+Tran_DPA+Pend_DPA AS DSPN_DPA,;
		Sld_CNB+Tran_CNB+Pend_CNB AS DSPN_CNB,;
		Sld_CNG+Tran_CNG+Pend_CNG AS DSPN_CNG,;
		Sld_T2+Tran_T2+Pend_T2 	  AS DSPN_T2,;
		Sld_DPA2+Tran_DPA2+Pend_DPA2  AS DSPN_DPA2,;
		Sld_DPN+Tran_DPN+Pend_DPN 	  AS DSPN_DPN;
	FROM CrsPrevio ;
	ORDER BY ORDEM;
	INTO CURSOR PDDPrevio


	DO CASE


		CASE 	 PrmDuracaPor = "POR CIDADE"
				=ULDraPCidade()

		OTHERWISE
				=ULDraPPadrao()


	ENDCASE



	
	
	*-----------------------------------------------------------*
	=up_fecha("crspendenc")
	=up_fecha("crsgro_est")
	=up_fecha("pddprevio")
	=UP_fecha("CRSPed")


	*-----------------------------------------------------------*
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN("L:\TMP\CRSPed.dbf")



FUNCTION ULDraPCidade


	SELECT *, ;
		ULPDDura((;
				 DSPN_Gyn;
				+DSPN_DPO;
				+DSPN_CNG;
				+DSPN_IPG;
				+DSPN_RIO;
				+DSPN_T63;
				+DSPN_T2;
				),;
		        (;
		          Gro_Gyn;
		         +Gro_DPO;
		         +Gro_CNG;
		         +Gro_IPG;
		         +Gro_RIO;
		         +Gro_T63;
		         +Gro_T2;
		         )) AS dura_gyn,;
		ULPDDura((;
				 DSPN_SIA;
				+DSPN_CNB;
				+DSPN_W3;
				),;
		        (;
		          Gro_SIA;
		         +Gro_CNB;
		         +Gro_W3;
		         )) AS dura_SIA,;
		ULPDDura((;
				 DSPN_ARG;
				+DSPN_DPA;
				+DSPN_DPA2;
				),;
		        (;
		          Gro_ARG;
		         +Gro_DPA;
		         +Gro_DPA2;
		         )) AS dura_ARG,;
		ULPDDura((DSPN_Bgs),(Gro_Bgs)) AS dura_Bgs,;
		ULPDDura(DSPN_Cgb,Gro_Cgb) AS dura_Cgb,;
		ULPDDura((DSPN_ANP+DSPN_DPN),(Gro_ANP+Gro_DPN)) AS dura_ANP,;
		ULPDDura((DSPN_ABO),(Gro_ABO)) AS dura_ABO;
	FROM PDDPrevio ;
	ORDER BY ORDEM ;
	INTO TABLE L:\TMP\CRSPed
RETURN

FUNCTION ULDraPPadrao


	SELECT *, ;
		ULPDDura((DSPN_Gyn+DSPN_DPO+DSPN_CNG),;
		         (Gro_Gyn+Gro_DPO+Gro_CNG)) AS dura_gyn,;
		ULPDDura((DSPN_Sia+DSPN_CNB),(Gro_Sia+Gro_CNB)) AS dura_Sia,;
		ULPDDura(DSPN_W3,Gro_W3 ) AS dura_W3 ,;
		ULPDDura((DSPN_Bgs),(Gro_Bgs)) AS dura_Bgs,;
		ULPDDura(DSPN_Ipg,Gro_Ipg) AS dura_Ipg,;
		ULPDDura(DSPN_Cgb,Gro_Cgb) AS dura_Cgb,;
		ULPDDura((DSPN_Arg+DSPN_DPA+DSPN_DPA2),;
		         (Gro_Arg+Gro_DPA+Gro_DPA2)) AS dura_Arg,;
		ULPDDura(DSPN_RIO,Gro_RIO) AS dura_RIO,;
		ULPDDura(DSPN_T63,Gro_T63) AS dura_T63,;
		(0) AS dura_DPO,;
		ULPDDura(DSPN_Idl,Gro_Idl) AS dura_Idl,;
		ULPDDura((DSPN_ANP+DSPN_DPN),(Gro_ANP+Gro_DPN)) AS dura_ANP,;
		ULPDDura((DSPN_ABO),(Gro_ABO)) AS dura_ABO,;
		(0) AS dura_DPA,;
		(0) AS dura_CNB,;
		(0) AS dura_CNG,;
		ULPDDura((DSPN_t2),(Gro_t2)) AS dura_t2,;
		(( (PrmParaXDias*;
		   (Gro_Gyn+Gro_Ipg+Gro_T63+Gro_DPO+Gro_CNG+Gro_RIO+Gro_T2);
		   )-;
		 (DSPN_Gyn+DSPN_Ipg+DSPN_T63+DSPN_DPO+DSPN_CNG+DSPN_RIO+DSPN_T2);
		 );
		) AS Pdir_Gyn, ;
		((PrmParaXDias*(Gro_Arg+Gro_DPA+Gro_DPA2));
			-(DSPN_Arg+DSPN_DPA+DSPN_DPA2))  AS Pdir_Arg, ;
		(((PrmParaXDias*Gro_Sia)-(DSPN_Sia))+;
	 	((PrmParaXDias*Gro_W3 )-(DSPN_W3))) AS Pdir_SIA ,;
  	 	((PrmParaXDias*(Gro_Bgs)-(DSPN_Bgs))) AS Pdir_BGS ,;
	 	((PrmParaXDias*Gro_Cgb)-(DSPN_Cgb)) AS Pdir_Cgb,;
		((PrmParaXDias*Gro_Idl)-(DSPN_Idl)) AS Pdir_Idl,;
		((PrmParaXDias*(Gro_ANP+Gro_DPN))-(DSPN_ANP+DSPN_DPN)) AS Pdir_ANP,;
  	 	((PrmParaXDias*(Gro_ABO)-(DSPN_ABO))) AS Pdir_ABO ,;
		(0) AS Pdir_DPA,;
		(0) AS Pdir_CNB;
	FROM PDDPrevio ;
	ORDER BY ORDEM ;
	INTO TABLE L:\TMP\CRSPed
RETURN



FUNCTION ULtransito
PARAMETERS PrmLoja,PrmCodigo
	PRIVATE LNtransito
	PRIVATE LSalias
	LSalias = alias()
	SELECT CRSpendencias
	LOCATE FOR Loja = PrmLoja AND CODIGO = PrmCodigo
	IF FOUND()
		LNtransito = TRANSITO
	ELSE
		LNtransito = 0
	ENDIF
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(LNtransito)

FUNCTION ULpendente
PARAMETERS PrmLoja,PrmCodigo
	PRIVATE LNpendente
	PRIVATE LSalias
	LSalias = alias()
	SELECT CRSpendencias
	LOCATE FOR Loja = PrmLoja AND CODIGO = PrmCodigo
	IF FOUND()
		LNpendente = PENDENTE
	ELSE
		LNpendente = 0
	ENDIF
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF
RETURN(LNpendente)


FUNCTION ULPDDura
PARAMETERS PrmSaldo,PrmGiro
Private LNDura
	DO CASE
		CASE PrmGiro = 0
			IF PrmSaldo > 0
				LNDura   = 999
			ELSE
				LNDura   = 0
			ENDIF		
		OTHERWISE
			LNDura   = PrmSaldo / PrmGiro
			IF LNDura > 999
				LNDura   = 999
			ENDIF				
	ENDCASE
RETURN(LNDura)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4LT0LWQQS           PDencerra VALID                    º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         PEDIDO,     Record Number:   23    º
*       º Variable:            PDencerra                          º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      21                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4lt0lwqqs     &&  PDencerra VALID
#REGION 1
RETURN

PROCEDURE PDencerra
	PARAMETERS LNemp,LNpedido

	*------------------------------------------------------------*
	=W_DEFPROC("rotinas.spr")
	*------------------------------------------------------------*
	PRIVATE LSalias
	PRIVATE situacao,LFflgtrans


	LSalias = ALIAS()
	*------------------------------------------------------------*

	SELE pedido
	SET ORDER TO TAG pedido
	SEEK LNpedido
	IF !FOUND()
		IF !EMPTY(LSalias) AND USED(LSalias)
			SELECT &LSalias
		ENDIF
		IF !EMPTY(LSalias) AND USED(LSalias)
			SELECT &LSalias
		ENDIF
		RETURN	
	ENDIF

	IF !REGLOCK()
	   WAIT WINDOW "Documento nao poder ser bloqueado para o processo."
	   RETURN
	ENDIF
	SELECT  pedite
	SET ORDER TO TAG relacaoit
	SEEK LNpedido


	***> ((((( PREVIA )))
	LFflgtrans = .t.

	*---->  POSICIONA ARQUIVOS RELACIONADOS
	************************************
	=UPtransacao("INICIAR")
	************************************
	DO WHILE !eof() AND  LNpedido = pedite.pedido
   		SELECT pedite
		IF REGLOCK()
			if pedite.qtdpedida = 0
			   m.qtdpedida = pedite.qtde
			else
			   m.qtdpedida = pedite.qtdpedida
			endif

			m.qtde =  QTDETR + QTDEATD

			IF QTDETR = 0		
				m.situacao  =   "C"+RIGHT(pedite.situacao,1)
			ELSE
				m.situacao  =   pedite.situacao
			ENDIF
			***************************
			SET FIELDS TO dtregis, hregis, usrregis,deletado
	    	SET FIELDS TO qtde,qtdpedida,situacao
			=edithand('REGRAVA')
			CLEAR FIELDS
			SET FIELDS OFF
			***************************
		ELSE
			LFflgtrans = .F.
			EXIT
		ENDIF
		SKIP
	ENDDO
	SELE pedite
	IF !LFflgtrans   && OPERACAO ABORTADA
		************************************
		=UPtransacao("ABORTAR")
		************************************
		SELE pedido
		UNLOCK
		RETURN
	ENDIF			
	************
	SELECT pedido
	m.situacao  =   "C"+RIGHT(situacao,1)
	************************************
	SET FIELDS TO dtregis, hregis, usrregis,deletado
   	SET FIELDS TO situacao
	=edithand('REGRAVA')
	CLEAR FIELDS
	SET FIELDS OFF
	************************************
	=UPtransacao("TERMINAR")
	************************************
	UNLOCK
RETURN


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4LT0LWQQT           PDencerra VALID                    º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         PEDIDO,     Record Number:   24    º
*       º Variable:            PDencerra                          º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      22                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

FUNCTION _4lt0lwqqt     &&  PDencerra VALID
#REGION 1
RETURN

PROCEDURE PDImpPendPedido

	PRIVATE LSAlias
	PRIVATE ARQ_Empresa,ALS_Empresa,ARQ_Grupo,ALS_Grupo
	PRIVATE ARQ_TabForn,ALS_TabForn,ARQ_PedIte,ALS_Pedite

	LSAlias = Alias()

    ARQ_Empresa     = NetArqAgain("EMPRESA")
    ALS_Empresa     = Alias()

    ARQ_Grupo       = NetArqAgain("GRUPO")
    ALS_Grupo       = Alias()

    ARQ_TabForn     = NetArqAgain("TABFORN")
    ALS_TabForn     = Alias()

    ARQ_PedIte      = NetArqAgain("PEDITE")
    ALS_Pedite      = Alias()

	IF (ARQ_empresa+ARQ_Grupo+ARQ_TabForn+ARQ_Pedite) > 100000 ;
							&& HOUVE FALHA DE ABERTURA
	    =up_fecha("&ALS_empresa")
	    =up_fecha("&ALS_grupo")
	    =up_fecha("&ALS_TabForn")
	    =up_fecha("&ALS_Pedite")
		IF !EMPTY(LSalias) AND USED(LSalias)
			SELECT &LSalias
		ENDIF
		RETURN
	ENDIF

	WAIT WINDOW "Aguarde. Gerando Consulta." NOWAIT
	SET TALK ON
	SELECT pd.empresa as filial, ;
	   lj.sigla,;
	   pd.data,;
	   pd.codigo,;
	   tb.cdgprdforn,;
	   grp.ordem,;
	   grp.descricao,;
	   pd.situacao,;
	   pd.pedido,;
	   pd.qtde     AS QtdPedida,;
	   pd.qtdeatd  AS QtAtendida,;
	   pd.qtdetr   AS QtTransito,;
	   (pd.qtde - pd.qtdeatd - pd.qtdetr) AS QtdPendente  ;
	FROM ;
      &ALS_Empresa lj ,;
      &ALS_Grupo grp, ;
      &ALS_TabForn tb ,;
      &ALS_Pedite pd;
	WHERE ;
		  lj.empresa = pd.empresa ;
	  AND grp.codigo = pd.codigo ;
	  AND LEFT(grp.classifica,2) $ "00";
	  AND tb.codforn = pd.codforn ;
	  AND tb.codigo  = pd.codigo ;
	  AND (pd.qtde - pd.qtdeatd - pd.qtdetr) > 0 ;
	  AND LEFT(pd.SITUACAO,1) = "B" ;
	ORDER BY pd.EMPRESA,grp.ordem,pd.CODIGO,pd.PEDIDO ;
	INTO CURSOR TMP_PDD
	SET TALK OFF

	*--------------------------------------------------------------*
	*	modif report q:\fpd26\prog\sqls\rpendped
	* 	report form q:\fpd26\prog\sqls\rpendped to file l:\tmp\prt0001x.rel
	*--------------------------------------------------------------*

	DO UPPreImpressao WITH  "RCP0100", .F. , .F., .F.

	*--------------------------------------------------------------*
    =up_fecha("&ALS_empresa")
    =up_fecha("&ALS_grupo")
    =up_fecha("&ALS_TabForn")
    =up_fecha("&ALS_Pedite")
    =up_fecha("TMP_PDD")
	IF !EMPTY(LSalias) AND USED(LSalias)
		SELECT &LSalias
	ENDIF

	
RETURN


sdsds