*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є 03/19/09             STB0055.SPR               15:04:15 є
*       є                                                         є
*       ЗДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД¶
*       є                                                         є
*       є Author's Name                                           є
*       є                                                         є
*       є Copyright (c) 2009 Company Name                         є
*       є Address                                                 є
*       є City,     Zip                                           є
*       є                                                         є
*       є Description:                                            є
*       є This program was automatically generated by GENSCRN.    є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є          STB0055/MS-DOS Setup Code - SECTION 1          є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1
***************
*~ WIZARDSCREEN

*---------------------------------------------------------------------*
* ARQUIVOS UTILIZADOS :                                               *
*              - EMPRESA
*              - CADTAB
*              - GRUPO
*              - PROD_CMS
*              - PRECO
*              - MARCA
* OBJETIVOS : MANUTENCAO  TABELA DE PRECOS
*	
*---------------------------------------------------------------------*
******>>>> INICIO CONTROLE AMBIENTAL

ON KEY LABEL ESCAPE

PRIVATE isediting,isadding, isreading
PRIVATE wp_record
PRIVATE isreadonly,is2table,wzalias
PRIVATE grupo, marca


PRIVATE LS409areant
LS409areant	= ALLTRIM(ALIAS()) && PERMITE RETORNAR A AREA ANTER. A CHAMADA

m.wzalias	=	SELECT()
m.isediting	=	.F.
m.isadding	=	.F.
m.isreading =   .F.
m.is2table 	= 	.F.
wp_flgfecha = 	.F. 		&& defaut nao fechamento da secao
WP_RECORD 	= 	0
wp_ref_local =  .f.     &&  nao POSSUI CONTROLE DE REFRESH LOCAL

LFsalfecha	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFgrufecha	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFempfecha	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFcadfecha	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFprofecha	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFmarca		=   .F.

m.codinicio  = " "
m.clasinicio = " "
m.descinicio = " "
m.ordinicio  = 0
m.ordfim  	 = 9999999

m.flpreco    = .F.
m.flcomis    = .F.
m.flordem    = 1

m.grupo		 = 0
m.marca		 = 0

******>>>> INICIO CONTROLE ARQUIVOS

*>> parametros repassados a btn_val

VLleitura = ""
           * repassa chave de leitura p/ btn_val (POSICAO INICIO)
VLlerfim  = ""
           * repassa chave de leitura p/ btn_val (POSICAO FINAL + 1 REG)
VLcompara =  ""
           * repassa chave de comparacao p/ btn_val
VLchvlimi =  ""

IF !USED("empresa")
	LFempfecha	= .T.
	IF ! NetUse("empresa")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("cadtab")
	LFcadfecha	= .T.
	IF ! NetUse("cadtab")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("preco")
	LFprefecha	= .T.
	IF ! NetUse("preco")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("grup_cms")
	LFprofecha	= .T.
	IF ! NetUse("grup_cms")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("marca")
	LFmarca	= .T.
	IF ! NetUse("marca")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("grupo")
	LFgrufecha	= .T.
	IF ! NetUse("grupo")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF wp_flgfecha
	DO ULfecha
	RETURN
ENDIF


#REGION 0
REGIONAL m.currarea, m.talkstat, m.compstat

IF SET("TALK") = "ON"
	SET TALK OFF
	m.talkstat = "ON"
ELSE
	m.talkstat = "OFF"
ENDIF
m.compstat = SET("COMPATIBLE")
SET COMPATIBLE FOXPLUS

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є                MS-DOS Window definitions                є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

IF NOT WEXIST("stb0055") ;
	OR UPPER(WTITLE("STB0055")) == "STB0055.PJX" ;
	OR UPPER(WTITLE("STB0055")) == "STB0055.SCX" ;
	OR UPPER(WTITLE("STB0055")) == "STB0055.MNX" ;
	OR UPPER(WTITLE("STB0055")) == "STB0055.PRG" ;
	OR UPPER(WTITLE("STB0055")) == "STB0055.FRX" ;
	OR UPPER(WTITLE("STB0055")) == "STB0055.QPR"
	DEFINE WINDOW stb0055 ;
		FROM INT((SROW()-22)/2),INT((SCOL()-77)/2) ;
		TO INT((SROW()-22)/2)+21,INT((SCOL()-77)/2)+76 ;
		TITLE "[ Manutencao Tabelas de Preco ]" ;
		FOOTER "stb0055" ;
		NOFLOAT ;
		NOCLOSE ;
		SHADOW ;
		NOMINIMIZE ;
		NONE ;
		COLOR SCHEME 1
ENDIF


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є          STB0055/MS-DOS Setup Code - SECTION 2          є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1

******>>>> INICIO CONTROLE LOCAL

DO CASE
	CASE !wp_flgfecha
		*-------------------------> criado pelo wizard
		m.wzalias=SELECT()
		m.isreadonly=IIF(ISREAD(),.T.,.F.)
		IF m.isreadonly
			WAIT WINDOW C_READONLY TIMEOUT 1
		ENDIF
ENDCASE







*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є              STB0055/MS-DOS Screen Layout               є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1
IF WVISIBLE("stb0055")
	ACTIVATE WINDOW stb0055 SAME
ELSE
	ACTIVATE WINDOW stb0055 NOSHOW
ENDIF
@ 2,20 SAY "-" ;
	SIZE 1,1, 0
@ 17,22 SAY "%" ;
	SIZE 1,1, 0
@ 17,46 SAY "-" ;
	SIZE 1,1, 0
@ 11,5 TO 14,67 ;
	COLOR SCHEME 23
@ 14,6 TO 14,66 ;
	COLOR SCHEME 24
@ 11,67 SAY "ї" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 12,67 TO 13,67 ;
	COLOR SCHEME 24
@ 14,67 SAY "Щ" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 11,6 SAY "[Intervalo Produtos]" ;
	SIZE 1,20, 0
@ 2,40 SAY "-" ;
	SIZE 1,1, 0
@ 1,35 TO 3,63 ;
	COLOR SCHEME 23
@ 3,36 TO 3,62 ;
	COLOR SCHEME 24
@ 3,63 SAY "Щ" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 2,63 SAY "і" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,63 SAY "ї" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,36 SAY "[Filial]" ;
	SIZE 1,8, 0
@ 1,13 TO 3,26 ;
	COLOR SCHEME 23
@ 3,14 TO 3,25 ;
	COLOR SCHEME 24
@ 3,26 SAY "Щ" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 2,26 SAY "і" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,26 SAY "ї" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,14 SAY "[Tabela]" ;
	SIZE 1,8, 0
@ 16,39 TO 18,66 ;
	COLOR SCHEME 23
@ 18,40 TO 18,65 ;
	COLOR SCHEME 24
@ 18,66 SAY "Щ" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 16,66 SAY "ї" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 17,66 SAY "і" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 16,6 TO 18,33 ;
	COLOR SCHEME 23
@ 18,7 TO 18,32 ;
	COLOR SCHEME 24
@ 18,33 SAY "Щ" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 16,33 SAY "ї" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 17,33 SAY "і" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 0,0 TO 21,76 ;
	COLOR SCHEME 23
@ 21,1 TO 21,75 ;
	COLOR SCHEME 24
@ 21,76 SAY "Щ" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,76 TO 20,76 ;
	COLOR SCHEME 24
@ 0,76 SAY "ї" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 0,18 SAY "[ Processa Precos e Grupos de Comissao ] " ;
	SIZE 1,41, 0
@ 19,2 TO 21,18 ;
	COLOR SCHEME 24
@ 21,3 TO 21,17 ;
	COLOR SCHEME 23
@ 20,18 SAY "і" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 21,18 SAY "Щ" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 19,18 SAY "ї" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 19,29 TO 21,45 ;
	COLOR SCHEME 24
@ 21,30 TO 21,44 ;
	COLOR SCHEME 23
@ 20,45 SAY "і" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 21,45 SAY "Щ" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 19,45 SAY "ї" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 19,57 TO 21,73 ;
	COLOR SCHEME 24
@ 21,58 TO 21,72 ;
	COLOR SCHEME 23
@ 20,73 SAY "і" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 21,73 SAY "Щ" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 19,73 SAY "ї" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 6,22 SAY "-" ;
	SIZE 1,1, 0
@ 5,18 SAY "Marca :" ;
	SIZE 1,7, 0
@ 4,1 TO 7,75 ;
	COLOR SCHEME 23
@ 7,2 TO 7,74 ;
	COLOR SCHEME 24
@ 4,75 SAY "ї" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 5,75 TO 6,75 ;
	COLOR SCHEME 24
@ 7,75 SAY "Щ" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 5,3 SAY "Grupo Prod." ;
	SIZE 1,11, 0
@ 2,17 GET m.tbbase ;
	SIZE 1,3 ;
	DEFAULT 0 ;
	PICTURE "999" ;
	WHEN _2lx0waw6r() ;
	VALID _2lx0waw6t() ;
	MESSAGE "<TAB> = Zoom  ;  <ESC> = Sai " ;
	ERROR "Codigo de Tabela Nao Confere."
@ 2,21 GET m.sbase ;
	SIZE 1,1 ;
	DEFAULT " " ;
	WHEN _2lx0waw6x() ;
	VALID _2lx0waw8j()
@ 2,37 GET m.empbase ;
	SIZE 1,3 ;
	DEFAULT " " ;
	PICTURE "999" ;
	WHEN _2lx0waw8m() ;
	VALID _2lx0waw8o()
@ 2,41 GET m.nome_emp ;
	SIZE 1,20 ;
	DEFAULT " " ;
	PICTURE "@!K" ;
	WHEN _2lx0waw8s()
@ 6,7 GET m.grupo ;
	SIZE 1,2 ;
	DEFAULT 0 ;
	WHEN _2lx0waw8t() ;
	ERROR wp_msg
@ 6,20 GET m.marca ;
	SIZE 1,2 ;
	DEFAULT 0 ;
	PICTURE "@Z 99" ;
	WHEN _2lx0waw8u() ;
	VALID _2lx0waw8v()
@ 6,23 GET m.marcdesc ;
	SIZE 1,13 ;
	DEFAULT " " ;
	WHEN .f.
@ 12,6 GET m.codinicio ;
	SIZE 1,16 ;
	DEFAULT " " ;
	PICTURE "&masc_codi" ;
	WHEN _2lx0waw8w() ;
	VALID _2lx0waw8x() ;
	ERROR wp_msg
@ 12,39 GET m.codfim ;
	SIZE 1,16 ;
	DEFAULT " " ;
	PICTURE "&masc_codi" ;
	WHEN _2lx0waw9c() ;
	VALID _2lx0waw9f() ;
	ERROR wp_msg
@ 13,12 GET m.descinicio ;
	SIZE 1,22 ;
	DEFAULT " " ;
	PICTURE "@!" ;
	WHEN .f.
@ 13,42 GET m.descfim ;
	SIZE 1,24 ;
	DEFAULT " " ;
	PICTURE "@!" ;
	WHEN .f.
@ 16,7 GET m.flpreco ;
	PICTURE "@*C Atualiza Preco ?" ;
	SIZE 1,20 ;
	DEFAULT 0 ;
	WHEN _2lx0waw9k()
@ 16,40 GET m.flcomis ;
	PICTURE "@*C Atu. Grupo Comissao ?" ;
	SIZE 1,25 ;
	DEFAULT 0 ;
	WHEN _2lx0waw9m()
@ 17,15 GET m.reajuste ;
	SIZE 1,6 ;
	DEFAULT 0 ;
	PICTURE "999.99" ;
	WHEN _2lx0waw9q() ;
	MESSAGE " "
@ 17,41 GET m.clas_cms ;
	SIZE 1,5 ;
	DEFAULT " " ;
	PICTURE "@R 99.99" ;
	WHEN isediting AND m.flcomis ;
	VALID _2lx0waw9s() ;
	MESSAGE "<TAB> = Zoom " ;
	ERROR WP_MSG
@ 17,47 GET m.desc_cms ;
	SIZE 1,18 ;
	DEFAULT " " ;
	PICTURE "@!" ;
	WHEN .f.
@ 20,6 GET m.edit_btn ;
	PICTURE "@*HN \<Edita" ;
	SIZE 1,9,1 ;
	DEFAULT 1 ;
	VALID btn_val1('EDIT') ;
	MESSAGE 'Permite a alteracao de dados do registro corrente'
@ 20,32 GET m.imp_btn ;
	PICTURE "@*HN \<Processa" ;
	SIZE 1,10,1 ;
	DEFAULT 1 ;
	VALID _2lx0waw9x() ;
	DISABLE
@ 20,62 GET exit_btn ;
	PICTURE "@*HN \<Saida" ;
	SIZE 1,7,1 ;
	DEFAULT 1 ;
	VALID _2lx0waw9z()
@ 4,32 SAY "Filtrar" ;
	SIZE 1,7, 0
@ 9,6 SAY "ATENCAO !! Os produtos estao organizados pela ordem da tabela." ;
	SIZE 1,62, 0
@ 0,66 SAY "[stb0055]" ;
	SIZE 1,9, 0

IF NOT WVISIBLE("stb0055")
	ACTIVATE WINDOW stb0055
ENDIF


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є     MS-DOSREAD contains clauses from SCREEN stb0055     є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

READ CYCLE ;
	NOLOCK

RELEASE WINDOW stb0055

#REGION 0
IF m.talkstat = "ON"
	SET TALK ON
ENDIF
IF m.compstat = "ON"
	SET COMPATIBLE ON
ENDIF


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є               STB0055/MS-DOS Cleanup Code               є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1
DO ULfecha
RETURN



*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є   STB0055/MS-DOS Supporting Procedures and Functions    є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1
PROCEDURE ULfecha
	IF LFsalfecha		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("saldo")
	ENDIF
	IF LFgrufecha		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("grupo")
	ENDIF
	IF LFcadfecha		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("cadtab")
	ENDIF
	IF LFempfecha		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("empresa")
	ENDIF
	IF LFmarca		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("marca")
	ENDIF
	IF LFprofecha		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("grup_cms")
	ENDIF
	wp_flgfecha = .F. 		&& defaut nao fechamento da secao
	IF !EMPTY(LS409areant)
		SELECT &LS409areant
	ENDIF
	ON KEY LABEL ESCAPE
	SET FORMAT TO
RETURN

PROCEDURE BTN_VAL1
	PARAMETER tecla, m.chv_ler, m.chv_compara, m.chv_brow
	LN_prxobj = _CUROBJ
    DO CASE
		CASE tecla = "EDIT" AND !isediting   && INICIA EDICAO
			SHOW GET edit_btn,1 PROMPT "\<Ok"
			SHOW GET m.imp_btn DISABLE
			isediting = .t.
			_CUROBJ = 1	
		    ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
			ON KEY LABEL END DO BTN_VAL1 WITH 'DELETE'
		CASE tecla = "EDIT" AND isediting     && CONFIRMA EDICAO
			SHOW GET edit_btn,1 PROMPT "\<Edita"
			isediting = .f.
			_CUROBJ = 1	
			SHOW GET m.imp_btn ENABLE
		    ON KEY LABEL ESCAPE
			ON KEY LABEL END
		CASE tecla = "DELETE" AND isediting     && CANCELA EDICAO
			SHOW GET edit_btn,1 PROMPT "\<Edita"
			isediting = .f.
			_CUROBJ = 1	
			SHOW GET m.imp_btn DISABLE
		    ON KEY LABEL ESCAPE
			ON KEY LABEL END
	ENDCASE
RETURN

PROCEDURE ULpro_ordem
	SELE grupo
    SET ORDER TO TAG ordem
	SET NEAR ON
    SEEK m.ordinicio
	SET NEAR OFF
    m.emptmp = STRTRAN(STR(m.empbase,3)," ","0")
	
	
	DO WHILE !EOF() AND grupo.ordem <= m.ordfim

		*******<<< INICIO FILTRANDO >>>> *******
		LSgrupo   = CHRTRAN(STR(m.grupo,2)," ","0")
		IF grupo.cdg_tipo <> 4
			  SELE grupo
			  SKIP
			  LOOP
		ENDIF
		IF m.marca <> 0
		   IF LEFT(grupo.classifica,2) <> LSgrupo OR grupo.marca <> m.marca
			  SELE grupo
			  SKIP
			  LOOP
		   ENDIF
		ENDIF
		*******<<< FIM FILTRANDO >>>> *******
		DO ULajusta
		SELE grupo
		SKIP
	ENDDO
    SHOW GETS
	SHOW GET prc_btn DISABLE
RETURN

******************
PROCEDURE ULajusta
	   	SELE preco       && LE A TABELA BASE DO CODIGO
		SEEK STR(m.empbase,3)+STR(m.tbbase,3)+m.sbase+grupo.codigo
	   	IF !FOUND()
            RETURN
		ENDIF
        IF !FLcomis     && NAO ALTERAR PARTE DE COMISSIONAMENTO
        	SCATTER MEMVAR MEMO		
		ELSE
			SCATTER FIELDS empresa,tabpreco,serie,codigo,classifica,;
			  			preco MEMVAR MEMO && ALTERAR PARTE DE COMISSIO;
									NAMENTO COM AS VAR. DE MEMORIA INF.;
							NAO PODE JOGAR P/ MEMO SENAO ALTERA INFORM.
		ENDIF
		IF FLpreco    && ALTERA PRECO CONF. PERC. DE REAJUSTE
		   IF m.reajuste < 0	&& ANULAR AUMENTO
				m.preco =  (m.preco )/(1+(ABS(m.reajuste)/100))
		   ELSE
			   m.preco = m.preco + (m.preco * m.reajuste / 100)
    		ENDIF
        ENDIF
		=REGLOCK(.T.)
		=edithand('REGRAVA')
RETURN


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _2LX0WAW6R           m.tbbase WHEN                      є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         STB0055,     Record Number:   63   є
*       є Variable:            m.tbbase                           є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Field                              є
*       є Snippet Number:      1                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _2lx0waw6r     &&  m.tbbase WHEN
#REGION 1
ON KEY LABEL ESCAPE	KEYBOARD "{END}"
IF LASTKEY() = 15 AND !(isediting)
	KEYBOARD "{ESCAPE}"
ENDIF
RETURN(isediting)

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _2LX0WAW6T           m.tbbase VALID                     є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         STB0055,     Record Number:   63   є
*       є Variable:            m.tbbase                           є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Field                              є
*       є Snippet Number:      2                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _2lx0waw6t     &&  m.tbbase VALID
#REGION 1
SELECT cadtab
IF LASTKEY() = 9
   ON KEY LABEL ESCAPE
   DO loc_dlog WITH .T.,""
   m.tbbase = cadtab.tabela
   m.sbase  = cadtab.serie
   SHOW GET  m.tbbase
   SHOW GET  m.sbase
   ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
ENDIF
RETURN .T.


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _2LX0WAW6X           m.sbase WHEN                       є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         STB0055,     Record Number:   64   є
*       є Variable:            m.sbase                            є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Field                              є
*       є Snippet Number:      3                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _2lx0waw6x     &&  m.sbase WHEN
#REGION 1
ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
RETURN(isediting)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _2LX0WAW8J           m.sbase VALID                      є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         STB0055,     Record Number:   64   є
*       є Variable:            m.sbase                            є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Field                              є
*       є Snippet Number:      4                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _2lx0waw8j     &&  m.sbase VALID
#REGION 1
IF SEEK(STR(m.tbbase,3)+m.sbase)
   SHOW GET  m.tbbase
   SHOW GET  m.sbase
   RETURN .T.
ENDIF
_CUROBJ = 1
RETURN .T.

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _2LX0WAW8M           m.empbase WHEN                     є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         STB0055,     Record Number:   65   є
*       є Variable:            m.empbase                          є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Field                              є
*       є Snippet Number:      5                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _2lx0waw8m     &&  m.empbase WHEN
#REGION 1
ON KEY LABEL ESCAPE	KEYBOARD "{END}"
IF LASTKEY() = 15 AND !(isediting)
	KEYBOARD "{ESCAPE}"
ENDIF
RETURN(isediting)

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _2LX0WAW8O           m.empbase VALID                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         STB0055,     Record Number:   65   є
*       є Variable:            m.empbase                          є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Field                              є
*       є Snippet Number:      6                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _2lx0waw8o     &&  m.empbase VALID
#REGION 1
SELECT empresa
SET ORDER TO TAG empresa
IF LASTKEY() = 9
   ON KEY LABEL ESCAPE
   DO loc_dlog WITH .F.
   ON KEY LABEL ESCAPE DO BTN_VAL WITH 'DELETE'
   IF LASTKEY() = 27
		SELECT empresa
		RETURN .F.
	ENDIF
ELSE
	IF !SEEK(m.empbase)
		SELECT empresa
		RETURN .F.
	ENDIF
ENDIF
m.empbase   = empresa
m.nome_emp  = empresa.nome
SHOW GET m.empbase
SHOW GET m.nome_emp
SELECT empresa
RETURN .T.


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _2LX0WAW8S           m.nome_emp WHEN                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         STB0055,     Record Number:   66   є
*       є Variable:            m.nome_emp                         є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Field                              є
*       є Snippet Number:      7                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _2lx0waw8s     &&  m.nome_emp WHEN
#REGION 1
ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
RETURN(.f.)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _2LX0WAW8T           m.grupo WHEN                       є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         STB0055,     Record Number:   67   є
*       є Variable:            m.grupo                            є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Field                              є
*       є Snippet Number:      8                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _2lx0waw8t     &&  m.grupo WHEN
#REGION 1
ON KEY LABEL ENTER
ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
RETURN(isediting)

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _2LX0WAW8U           m.marca WHEN                       є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         STB0055,     Record Number:   68   є
*       є Variable:            m.marca                            є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Field                              є
*       є Snippet Number:      9                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _2lx0waw8u     &&  m.marca WHEN
#REGION 1
ON KEY LABEL ENTER
ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
RETURN(isediting)

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _2LX0WAW8V           m.marca VALID                      є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         STB0055,     Record Number:   68   є
*       є Variable:            m.marca                            є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Field                              є
*       є Snippet Number:      10                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _2lx0waw8v     &&  m.marca VALID
#REGION 1
select marca
SET ORDER TO TAG marca
if lastkey() = 9
   ON KEY LABEL ESCAPE
   DO loc_dlog
   ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
   m.marca = marca
   m.marcdesc = descricao
   select grupo
   show get m.marca
   SHOW GET m.marcdesc
	IF LASTKEY() = 27
		RETURN .F.
	ENDIF
   return .T.
endif

IF m.marca = 0
   m.marcdesc = "TODAS"
   select grupo
   SHOW GET m.marcdesc
   return .t.
endif

if SEEK(STR(m.grupo,2)+STR(m.marca,2))
   m.marcdesc = descricao
   select grupo
   SHOW GET m.marcdesc
   return .t.
endif

select grupo
return .f.


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _2LX0WAW8W           m.codinicio WHEN                   є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         STB0055,     Record Number:   70   є
*       є Variable:            m.codinicio                        є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Field                              є
*       є Snippet Number:      11                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _2lx0waw8w     &&  m.codinicio WHEN
#REGION 1
ON KEY LABEL ENTER
ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
RETURN(isediting or isreading)

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _2LX0WAW8X           m.codinicio VALID                  є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         STB0055,     Record Number:   70   є
*       є Variable:            m.codinicio                        є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Field                              є
*       є Snippet Number:      12                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _2lx0waw8x     &&  m.codinicio VALID
#REGION 1
PRIVATE LSforlocal, LSgrupo

IF EMPTY(m.codinicio) AND LASTKEY() <> 9
	m.clasinicio  = " "
	m.descinicio  =   "PRIMEIRO"
	m.ordinicio  = 1
	SHOW GET  m.descinicio
	RETURN(.T.)
ENDIF
SELE grupo
SET ORDER TO TAG codigo
SET NEAR ON
SEEK ALLTRIM(m.codinicio)
SET NEAR OFF
*----------------------------------------------------------*
LSforlocal  = ""

IF m.marca <> 0
	LSgrupo   = CHRTRAN(STR(m.grupo,2)," ","0")
	LSforlocal = ;
	   "LEFT(grupo.classifica,2) = LSgrupo AND grupo.marca = m.marca "
ENDIF	

*----------------------------------------------------------*
SELECT grupo
ON KEY LABEL ESCAPE
IF LASTKEY() = 9
	SET ORDER TO TAG ordem
	ON KEY LABEL ESCAPE
	DO loc_dlog WITH .T.,LSforlocal
	ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
	IF LASTKEY() = 27
		RETURN .F.
	ENDIF
ENDIF
m.codinicio  = grupo.codigo
m.clasinicio = grupo.classifica
m.descinicio = grupo.descricao
m.ordinicio  = grupo.ordem
*******
SHOW GET  m.codinicio
SHOW GET  m.descinicio


RETURN .t.


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _2LX0WAW9C           m.codfim WHEN                      є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         STB0055,     Record Number:   71   є
*       є Variable:            m.codfim                           є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Field                              є
*       є Snippet Number:      13                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _2lx0waw9c     &&  m.codfim WHEN
#REGION 1
ON KEY LABEL ENTER
ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
RETURN(isediting or isreading)

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _2LX0WAW9F           m.codfim VALID                     є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         STB0055,     Record Number:   71   є
*       є Variable:            m.codfim                           є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Field                              є
*       є Snippet Number:      14                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _2lx0waw9f     &&  m.codfim VALID
#REGION 1
PRIVATE LSforlocal, LSgrupo

IF EMPTY(m.codfim) AND LASTKEY() <> 9
	m.clasfim 	= 	REPL("9",15)
	m.descfim   =   "ULTIMO"
	m.ordfim  	 = 9999999
	SHOW GET  m.descfim
	RETURN(.T.)
ENDIF
SELE grupo
SET ORDER TO TAG codigo
SET NEAR ON
SEEK ALLTRIM(m.codfim)
SET NEAR OFF
*----------------------------------------------------------*
LSforlocal  = ""

IF m.marca <> 0
	LSgrupo   = CHRTRAN(STR(m.grupo,2)," ","0")
	LSforlocal = ;
	   "LEFT(grupo.classifica,2) = LSgrupo AND grupo.marca = m.marca "
ENDIF	

*----------------------------------------------------------*
SELECT grupo
ON KEY LABEL ESCAPE
IF LASTKEY() = 9
	SET ORDER TO TAG ordem
	ON KEY LABEL ESCAPE
	DO loc_dlog WITH .T.,LSforlocal
	ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
	IF LASTKEY() = 27
		RETURN .F.
	ENDIF
ENDIF
m.codfim  = grupo.codigo
m.clasfim = grupo.classifica
m.descfim = grupo.descricao
m.ordfim  = grupo.ordem

*******
SHOW GET  m.codfim
SHOW GET  m.descfim
RETURN .t.


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _2LX0WAW9K           m.flpreco WHEN                     є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         STB0055,     Record Number:   74   є
*       є Variable:            m.flpreco                          є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Check Box                          є
*       є Snippet Number:      15                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _2lx0waw9k     &&  m.flpreco WHEN
#REGION 1
ON KEY LABEL ENTER  KEYBOARD "{RIGHTARROW}"
RETURN(isediting)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _2LX0WAW9M           m.flcomis WHEN                     є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         STB0055,     Record Number:   75   є
*       є Variable:            m.flcomis                          є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Check Box                          є
*       є Snippet Number:      16                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _2lx0waw9m     &&  m.flcomis WHEN
#REGION 1
ON KEY LABEL ENTER  KEYBOARD "{RIGHTARROW}"
RETURN(isediting)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _2LX0WAW9Q           m.reajuste WHEN                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         STB0055,     Record Number:   76   є
*       є Variable:            m.reajuste                         є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Field                              є
*       є Snippet Number:      17                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _2lx0waw9q     &&  m.reajuste WHEN
#REGION 1
ON KEY LABEL ENTER
RETURN(isediting AND m.flpreco )


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _2LX0WAW9S           m.clas_cms VALID                   є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         STB0055,     Record Number:   77   є
*       є Variable:            m.clas_cms                         є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Field                              є
*       є Snippet Number:      18                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _2lx0waw9s     &&  m.clas_cms VALID
#REGION 1
SELECT grup_cms
SET ORDER TO TAG grupo
IF LASTKEY() = 9
   	ON KEY LABEL ESCAPE
	DO loc_dlog WITH .F.
	ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
  	SELECT preco
ELSE
	IF !SEEK(m.clas_cms)
       wp_msg = 'Grupo de Comissao nao cadastrado.'
	   SELECT preco
       RETURN .F.
    ENDIF
ENDIF
m.clas_cms = grup_cms.grupo
m.desc_cms = grup_cms.descricao
SHOW GET  m.clas_cms
SHOW GET  m.desc_cms
RETURN .T.


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _2LX0WAW9X           m.imp_btn VALID                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         STB0055,     Record Number:   80   є
*       є Variable:            m.imp_btn                          є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      19                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _2lx0waw9x     &&  m.imp_btn VALID
#REGION 1
SELECT grupo

IF fox_alert('Confirma Atualizacao ?')
	SET ORDER TO TAG ordem
	DO ULpro_ordem
ENDIF

SELE grupo
SET FILTER TO
SHOW GET m.imp_btn DISABLE
RETURN



*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _2LX0WAW9Z           exit_btn VALID                     є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         STB0055,     Record Number:   81   є
*       є Variable:            exit_btn                           є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      20                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _2lx0waw9z     &&  exit_btn VALID
#REGION 1
CLEAR READ
CLEAR GETS
