*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        03/19/09             STB0060.SPR               15:04:35 
*                                                                
*       픔컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        Author's Name                                           
*                                                                
*        Copyright (c) 2009 Company Name                         
*        Address                                                 
*        City,     Zip                                           
*                                                                
*        Description:                                            
*        This program was automatically generated by GENSCRN.    
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                 STB0060/MS-DOS Setup Code - SECTION 1          
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 1
***************
*~ WIZARDSCREEN

*---------------------------------------------------------------------*
* ARQUIVOS UTILIZADOS :                                               *
*              - EMPRESA
*              - CADTAB
*              - GRUPO
*              - PRECO
*              - PROD_CMS
* OBJETIVOS : GERECAO DE TABELAS DE PRECO
*	
*---------------------------------------------------------------------*
******>>>> INICIO CONTROLE AMBIENTAL

ON KEY LABEL ESCAPE

PRIVATE isediting,isadding,isreading
PRIVATE wp_record
PRIVATE isreadonly,is2table,wzalias
PRIVATE LS408areant
LS408areant	= ALLTRIM(ALIAS()) && PERMITE RETORNAR A AREA ANTER. A CHAMADA

m.wzalias	=	SELECT()
m.isediting	=	.F.
m.isadding	=	.F.
m.isreading =   .F.
m.is2table 	= 	.F.
wp_flgfecha = 	.F. 		&& defaut nao fechamento da secao
WP_RECORD 	= 	0
wp_ref_local =  .f.     &&  nao POSSUI CONTROLE DE REFRESH LOCAL

LFemp408	= .F.
LFcad408	= .F.
LFpre408	= .F.
LFgru408	= .F.
LFpro408	= .F.


DIMENSION wv_empresa(1,1)    	   && CONTERA EMPRESAS REG. NO SISTEMA
		  wi_empresa  = 2          && INDICE P/ SELECAO EMPRESA
          LN_emp	  = 0          && Num Regstros

******>>>> INICIO CONTROLE ARQUIVOS

*>> parametros repassados a btn_val

VLleitura = ""
           * repassa chave de leitura p/ btn_val (POSICAO INICIO)
VLlerfim  = ""
           * repassa chave de leitura p/ btn_val (POSICAO FINAL + 1 REG)
VLcompara =  ""
           * repassa chave de comparacao p/ btn_val
VLchvlimi = ""

IF !USED("empresa")
	LFemp408	= .T.
	IF ! NetUse("empresa")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("cadtab")
	LFcad408 = .T.
	IF ! NetUse("cadtab")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("preco")
	LFpre408	= .T.
	IF ! NetUse("preco")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("prod_cms")
	LFpro408	= .T.
	IF ! NetUse("prod_cms")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("grupo")
	LFgru408  	= .T.
	IF ! NetUse("grupo")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF wp_flgfecha
	DO ULfecha
	RETURN
ENDIF


#REGION 0
REGIONAL m.currarea, m.talkstat, m.compstat

IF SET("TALK") = "ON"
	SET TALK OFF
	m.talkstat = "ON"
ELSE
	m.talkstat = "OFF"
ENDIF
m.compstat = SET("COMPATIBLE")
SET COMPATIBLE FOXPLUS

*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                       MS-DOS Window definitions                
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

IF NOT WEXIST("scgc418") ;
	OR UPPER(WTITLE("SCGC418")) == "SCGC418.PJX" ;
	OR UPPER(WTITLE("SCGC418")) == "SCGC418.SCX" ;
	OR UPPER(WTITLE("SCGC418")) == "SCGC418.MNX" ;
	OR UPPER(WTITLE("SCGC418")) == "SCGC418.PRG" ;
	OR UPPER(WTITLE("SCGC418")) == "SCGC418.FRX" ;
	OR UPPER(WTITLE("SCGC418")) == "SCGC418.QPR"
	DEFINE WINDOW scgc418 ;
		FROM INT((SROW()-9)/2),INT((SCOL()-60)/2) ;
		TO INT((SROW()-9)/2)+8,INT((SCOL()-60)/2)+59 ;
		TITLE "[ Elimina Tabelas de Preco ]" ;
		FOOTER "[418]" ;
		NOFLOAT ;
		NOCLOSE ;
		SHADOW ;
		NOMINIMIZE ;
		COLOR SCHEME 1
ENDIF


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                 STB0060/MS-DOS Setup Code - SECTION 2          
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 1

******>>>> INICIO CONTROLE LOCAL

DO CASE
	CASE !wp_flgfecha
		DO ULtabempresa    && TRANSF. EMPRE. P/ TABELA
		*-------------------------> criado pelo wizard
		m.wzalias=SELECT()
		m.isreadonly=IIF(ISREAD(),.T.,.F.)
		IF m.isreadonly
			WAIT WINDOW C_READONLY TIMEOUT 1
		ENDIF
ENDCASE







*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                     STB0060/MS-DOS Screen Layout               
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 1
IF WVISIBLE("scgc418")
	ACTIVATE WINDOW scgc418 SAME
ELSE
	ACTIVATE WINDOW scgc418 NOSHOW
ENDIF
@ 1,1 SAY "Gerar Tabela" ;
	SIZE 1,12, 0
@ 1,23 SAY "-" ;
	SIZE 1,1, 0
@ 3,1 SAY "Para empresas" ;
	SIZE 1,13, 0
@ 1,20 GET m.tbgera ;
	SIZE 1,3 ;
	DEFAULT 0 ;
	PICTURE "999" ;
	WHEN _2lx0wbbjh() ;
	VALID _2lx0wbbl3() ;
	MESSAGE "<TAB> = Zoom  ;  <ESC> = Sai " ;
	ERROR "Codigo de Tabela Nao Confere."
@ 1,24 GET m.sgera ;
	SIZE 1,1 ;
	DEFAULT " " ;
	WHEN _2lx0wbbl4() ;
	VALID _2lx0wbbl5()
@ 3,20 GET m.empgera ;
	SIZE 2,36 ;
	DEFAULT " " ;
	WHEN isediting ;
	VALID _2lx0wbbl6()
@ 6,0 GET m.edit_btn ;
	PICTURE "@*HN \<Edita" ;
	SIZE 1,9,1 ;
	DEFAULT 1 ;
	VALID btn_val1('EDIT') ;
	MESSAGE 'Permite a alteracao de dados do registro corrente'
@ 6,25 GET m.imp_btn ;
	PICTURE "@*HN \<Apagar" ;
	SIZE 1,8,1 ;
	DEFAULT 1 ;
	VALID _2lx0wbbl7() ;
	DISABLE
@ 6,49 GET exit_btn ;
	PICTURE "@*HN \<Saida" ;
	SIZE 1,7,1 ;
	DEFAULT 1 ;
	VALID _2lx0wbbl8()

IF NOT WVISIBLE("scgc418")
	ACTIVATE WINDOW scgc418
ENDIF


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*            MS-DOSREAD contains clauses from SCREEN stb0060     
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

READ CYCLE ;
	NOLOCK

RELEASE WINDOW scgc418

#REGION 0
IF m.talkstat = "ON"
	SET TALK ON
ENDIF
IF m.compstat = "ON"
	SET COMPATIBLE ON
ENDIF


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                      STB0060/MS-DOS Cleanup Code               
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 1
DO ULfecha
RETURN



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*          STB0060/MS-DOS Supporting Procedures and Functions    
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 1
PROCEDURE ULfecha
	IF LFemp408		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("empresa")
	ENDIF
	IF LFcad408  		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("cadtab")
	ENDIF
	IF LFpre408  		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("preco")
	ENDIF
	IF LFpro408  		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("prod_cms")
	ENDIF
	IF LFgru408		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("grupo")
	ENDIF
	wp_flgfecha = .F. 		&& defaut nao fechamento da secao
	IF !EMPTY(LS408areant)
		SELECT &LS408areant
	ENDIF
	ON KEY LABEL ESCAPE
	SET FORMAT TO
RETURN

PROCEDURE BTN_VAL1
	PARAMETER tecla, m.chv_ler, m.chv_compara, m.chv_brow
	LN_prxobj = _CUROBJ
    DO CASE
		CASE tecla = "EDIT" AND !isediting   && INICIA EDICAO
			SHOW GET edit_btn,1 PROMPT "\<Ok"
			SHOW GET m.imp_btn DISABLE
			isediting = .t.
			_CUROBJ = 1	
		    ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
			ON KEY LABEL END DO BTN_VAL1 WITH 'DELETE'
		CASE tecla = "EDIT" AND isediting     && CONFIRMA EDICAO
			SHOW GET edit_btn,1 PROMPT "\<Edita"
			isediting = .f.
			_CUROBJ = 1	
			SHOW GET m.imp_btn ENABLE
		    ON KEY LABEL ESCAPE
			ON KEY LABEL END
		CASE tecla = "DELETE" AND isediting     && CANCELA EDICAO
			SHOW GET edit_btn,1 PROMPT "\<Edita"
			isediting = .f.
			_CUROBJ = 1	
			SHOW GET m.imp_btn DISABLE
		    ON KEY LABEL ESCAPE
			ON KEY LABEL END
	ENDCASE
RETURN

PROCEDURE ULtabempresa && TRANSF. EMPRE. P/ TABELA INTERNA
	SELECT empresa
	LN_emp = 0
	COUNT TO LN_emp
	LN_emp = LN_emp + 1
	DIMENSION wv_empresa(LN_emp,1)
	GO TOP
	wv_empresa(1) = "Recomeca Selecao."
	DO WHILE !EOF()
	   wv_empresa(wi_empresa) = STRTRAN(STR(empresa,3),' ','0')+" - "+nome
	   wi_empresa = wi_empresa + 1
	   SKIP
	ENDDO
RETURN

PROCEDURE ULdeltabela		&& apaga tabelas

   	SELE preco
	SET ORDER TO TAG cod_tab
	
*******************
*---->   (INICIALIZACAO DO CONTROLE DE STATUS IMPRESSAO)
*******************	
	DO RELINIC.PRG          && INICIA VAR P/ TERMOMETRO
	LFsegue = .t.
	SET NEAR ON
	SEEK STR(m.tbgera,3)+m.sgera
	SET NEAR OFF

	LNregistro = RECNO()
    COUNT WHILE m.tbgera = tabpreco AND m.sgera = serie TO LNimpressao
	LNimpressos = 0
	GO LNregistro
	wp_msg = " Eliminando tabela de PRECO <ESC> = Interrompe"
*******************
	DO WHILE !EOF() AND m.tbgera = tabpreco ;
					AND m.sgera = serie AND LFsegue
		=UPtermo()
		LNempresa = CHRTRAN(TRANSFORM(preco.empresa,"999")," ","0")
		=REGLOCK()
		DELETE
		SKIP
	ENDDO		
	DO RELFIM.PRG          && FIM VAR P/ TERMOMETRO
*-----------------------------
   	SELE prod_cms
	SET ORDER TO TAG cod_tab
	
*******************
*---->   (INICIALIZACAO DO CONTROLE DE STATUS IMPRESSAO)
*******************	
	DO RELINIC.PRG          && INICIA VAR P/ TERMOMETRO
	LFsegue = .t.
	SET NEAR ON
	SEEK STR(m.tbgera,3)+m.sgera
	SET NEAR OFF

	LNregistro = RECNO()
    COUNT WHILE m.tbgera = tabpreco AND m.sgera = serie TO LNimpressao
	LNimpressos = 0
	GO LNregistro
	wp_msg = " Eliminando tabela de COMISSAO.  <ESC> = Interrompe"
*******************
	DO WHILE !EOF() AND m.tbgera = tabpreco ;
					AND m.sgera = serie AND LFsegue
		=UPtermo()
		LNempresa = CHRTRAN(TRANSFORM(prod_cms.empresa,"999")," ","0")
		=REGLOCK()
		DELETE
		SKIP
	ENDDO		
	DO RELFIM.PRG          && FIM VAR P/ TERMOMETRO
*-----------------------------
    SET PRINTER TO SET('PRINTER',1)
	SET RELATION TO
	SET POINT TO
	SET SEPARATOR  TO

RETURN


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2LX0WBBJH           m.tbgera WHEN                      
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         STB0060,     Record Number:    5   
*        Variable:            m.tbgera                           
*        Called By:           WHEN Clause                        
*        Object Type:         Field                              
*        Snippet Number:      1                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _2lx0wbbjh     &&  m.tbgera WHEN
#REGION 1
ON KEY LABEL ESCAPE	KEYBOARD "{END}"
IF LASTKEY() = 15 AND !(isediting)
	KEYBOARD "{ESCAPE}"
ENDIF
RETURN(isediting)


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2LX0WBBL3           m.tbgera VALID                     
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         STB0060,     Record Number:    5   
*        Variable:            m.tbgera                           
*        Called By:           VALID Clause                       
*        Object Type:         Field                              
*        Snippet Number:      2                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _2lx0wbbl3     &&  m.tbgera VALID
#REGION 1
SELECT cadtab
IF LASTKEY() = 9
   ON KEY LABEL ESCAPE
   DO loc_dlog WITH .T.,""
   m.tbgera = cadtab.tabela
   m.sgera  = cadtab.serie
   SHOW GET  m.tbgera
   SHOW GET  m.sgera
   ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
ENDIF
RETURN .T.


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2LX0WBBL4           m.sgera WHEN                       
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         STB0060,     Record Number:    6   
*        Variable:            m.sgera                            
*        Called By:           WHEN Clause                        
*        Object Type:         Field                              
*        Snippet Number:      3                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _2lx0wbbl4     &&  m.sgera WHEN
#REGION 1
ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
RETURN(isediting)


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2LX0WBBL5           m.sgera VALID                      
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         STB0060,     Record Number:    6   
*        Variable:            m.sgera                            
*        Called By:           VALID Clause                       
*        Object Type:         Field                              
*        Snippet Number:      4                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _2lx0wbbl5     &&  m.sgera VALID
#REGION 1
IF SEEK(STR(m.tbgera,3)+m.sgera)
   SHOW GET  m.tbgera
   SHOW GET  m.sgera
   RETURN .T.
ENDIF
_CUROBJ = 1
RETURN .T.

*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2LX0WBBL6           m.empgera VALID                    
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         STB0060,     Record Number:    7   
*        Variable:            m.empgera                          
*        Called By:           VALID Clause                       
*        Object Type:         Field                              
*        Snippet Number:      5                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _2lx0wbbl6     &&  m.empgera VALID
#REGION 1
if lastkey() = 9
	SELECT empresa
	wp_string = m.empgera
	do obj_empr.spr
	if lastkey() != 27
	   m.empgera  = wp_string
	endif
endif
show get m.empgera


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2LX0WBBL7           m.imp_btn VALID                    
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         STB0060,     Record Number:    9   
*        Variable:            m.imp_btn                          
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      6                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _2lx0wbbl7     &&  m.imp_btn VALID
#REGION 1
DO ULdeltabela
SHOW GET m.imp_btn DISABLE
RETURN



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _2LX0WBBL8           exit_btn VALID                     
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         STB0060,     Record Number:   10   
*        Variable:            exit_btn                           
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      7                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _2lx0wbbl8     &&  exit_btn VALID
#REGION 1
CLEAR READ
CLEAR GETS
