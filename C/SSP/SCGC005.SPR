*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є 18/02/99             SCGC005.SPR               17:15:15 є
*       є                                                         є
*       ЗДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД¶
*       є                                                         є
*       є Author's Name                                           є
*       є                                                         є
*       є Copyright (c) 1999 Company Name                         є
*       є Address                                                 є
*       є City,     Zip                                           є
*       є                                                         є
*       є Description:                                            є
*       є This program was automatically generated by GENSCRN.    є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є          SCGC005/MS-DOS Setup Code - SECTION 1          є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1
*~ WIZARDSCREEN
*---------------------------------------------------------------------*
* ARQUIVOS UTILIZADOS :                                               *
*              - TRANSMIT  e INDICADOS
* OBJETIVOS : GERAR DADOS PARA BACKUP
*	
*---------------------------------------------------------------------*
******>>>> INICIO CONTROLE AMBIENTAL
CLEAR TYPEAHEAD
PUSH KEY CLEAR		&& desabilita teclas de atalho def. anteriormente
ON KEY LABEL F1		DO HLP2000.SPR WITH  POPUP(),PROMPT(),PROGRAM(),;
							WONTOP(),VARREAD()
******************************************************************
PRIVATE wl_areant, isediting,isadding,isreading,wp_record,wp_flgfecha
PRIVATE LFjanela, wp_ref_local, LNcr_ant
PRIVATE VLleitura, VLlerfim, VLcompara, VLchvlimi
PRIVATE LFtra,LFemp
PRIVATE empinicio
*****************************************************************
******************************************************************

ON KEY LABEL ESCAPE
wl_areant = ALLTRIM(ALIAS()) && PERMITE RETORNAR A AREA ANTER. A CHAMADA

m.isediting	=	.F.
m.isadding	=	.F.
m.isreading =   .F.
wp_flgfecha = 	.F. 		&& defaut nao fechamento da secao
WP_RECORD 	= 	0
LNcr_ant	= 0
***********>>>>> USO LOCAL <<<<< ******************************
LFtra 		 = 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFemp 		 = 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
wp_ref_local =  .f.     && NAO POSSUI CONTROLE DE REFRESH LOCAL
m.empinicio  = 	0
*****************>>>> INICIO CONTROLE ARQUIVOS<<<<<<<<

*>> parametros repassados a btn_val
VLleitura = ""   && repassa chave de leitura p/ btn_val
VLlerfim  = ""   && p/ leitura do ultimo reg + 1
VLcompara = ""   && repassa chave de comparacao p/ btn_val
VLchvlimi = ""   && otimiza browse
**************************************************************

IF !USED("empresa")
	LFemp 	= .T.
	IF ! NetUse("empresa")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("transmit")
	LFtra 	= .T.
	IF ! NetUse("transmit")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF wp_flgfecha
	do ULfecha
	RETURN
ENDIF

#REGION 0
REGIONAL m.currarea, m.talkstat, m.compstat

IF SET("TALK") = "ON"
	SET TALK OFF
	m.talkstat = "ON"
ELSE
	m.talkstat = "OFF"
ENDIF
m.compstat = SET("COMPATIBLE")
SET COMPATIBLE FOXPLUS

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є                MS-DOS Window definitions                є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

IF NOT WEXIST("scgc005") ;
	OR UPPER(WTITLE("SCGC005")) == "SCGC005.PJX" ;
	OR UPPER(WTITLE("SCGC005")) == "SCGC005.SCX" ;
	OR UPPER(WTITLE("SCGC005")) == "SCGC005.MNX" ;
	OR UPPER(WTITLE("SCGC005")) == "SCGC005.PRG" ;
	OR UPPER(WTITLE("SCGC005")) == "SCGC005.FRX" ;
	OR UPPER(WTITLE("SCGC005")) == "SCGC005.QPR"
	DEFINE WINDOW scgc005 ;
		FROM INT((SROW()-23)/2),INT((SCOL()-78)/2) ;
		TO INT((SROW()-23)/2)+22,INT((SCOL()-78)/2)+77 ;
		TITLE "[ TRANSFERE DADOS PARA ARQUIVOS SECUNDARIOS ]" ;
		FOOTER "[ 005 ]" ;
		FLOAT ;
		NOCLOSE ;
		SHADOW ;
		NOMINIMIZE ;
		NONE ;
		COLOR SCHEME 1
ENDIF


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є          SCGC005/MS-DOS Setup Code - SECTION 2          є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1
******************  PARA SELECIONAR ARQUIVOS A RESTURAR ********
wl_record = 1

DIMENSION wv_seletor(wl_record,1)
DIMENSION wv_marcador(wl_record,1)

wi_seletor = 0

wl_marca = " "

*************** BUSCA PARAMETROS PARA PROXIMO RELATO *****
ON ERROR TMP=""   && EVITA MENS. DE ERRO QDO ARQ.NAO EXISTIR
RESTORE FROM  temp005a ADDITIVE
RESTORE FROM  temp005b ADDITIVE
ON ERROR
****************************************************************
SHOW GETS


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є              SCGC005/MS-DOS Screen Layout               є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1
IF WVISIBLE("scgc005")
	ACTIVATE WINDOW scgc005 SAME
ELSE
	ACTIVATE WINDOW scgc005 NOSHOW
ENDIF
@ 0,0 TO 22,77 ;
	COLOR SCHEME 23
@ 0,71 SAY "[005]" ;
	SIZE 1,5, 0
@ 2,25 SAY "a" ;
	SIZE 1,1, 0
@ 8,1 TO 13,36 ;
	COLOR SCHEME 23
@ 13,2 TO 13,35 ;
	COLOR SCHEME 24
@ 13,36 SAY "Щ" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 8,36 SAY "ї" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 8,2 SAY "[ Diretorio Destino ]" ;
	SIZE 1,21, 0
@ 10,2 SAY "EX:" ;
	SIZE 1,3, 0
@ 11,3 SAY "\SCGC\LOJA\  ==>  \SCGCBK\LOJA\" ;
	SIZE 1,31, 0
@ 9,3 SAY "\SCGCBK\ + [Diretorio Origem]  " ;
	SIZE 1,31, 0
@ 1,77 TO 21,77 ;
	COLOR SCHEME 24
@ 9,36 TO 12,36 ;
	COLOR SCHEME 24
@ 22,1 TO 22,76 ;
	COLOR SCHEME 24
@ 22,77 SAY "Щ" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 0,77 SAY "ї" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 12,24 SAY "<destino>" ;
	SIZE 1,9, 0
@ 12,5 SAY "<origem>" ;
	SIZE 1,8, 0
@ 0,29 SAY "[ Backup de Dados ]" ;
	SIZE 1,19, 0
@ 19,1 TO 21,9 ;
	COLOR SCHEME 24
@ 21,2 TO 21,8 ;
	COLOR SCHEME 23
@ 20,9 SAY "і" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 21,9 SAY "Щ" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 19,9 SAY "ї" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 19,36 TO 21,48 ;
	COLOR SCHEME 24
@ 21,37 TO 21,47 ;
	COLOR SCHEME 23
@ 20,48 SAY "і" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 21,48 SAY "Щ" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 19,48 SAY "ї" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 19,49 TO 21,61 ;
	COLOR SCHEME 24
@ 21,50 TO 21,60 ;
	COLOR SCHEME 23
@ 20,61 SAY "і" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 21,61 SAY "Щ" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 19,61 SAY "ї" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 19,22 TO 21,30 ;
	COLOR SCHEME 24
@ 21,23 TO 21,29 ;
	COLOR SCHEME 23
@ 20,30 SAY "і" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 21,30 SAY "Щ" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 19,30 SAY "ї" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 19,10 TO 21,21 ;
	COLOR SCHEME 24
@ 21,11 TO 21,20 ;
	COLOR SCHEME 23
@ 20,21 SAY "і" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 21,21 SAY "Щ" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 19,21 SAY "ї" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 19,62 TO 21,75 ;
	COLOR SCHEME 24
@ 21,63 TO 21,74 ;
	COLOR SCHEME 23
@ 20,75 SAY "і" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 21,75 SAY "Щ" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 19,75 SAY "ї" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 14,2 SAY "Nome do Arq.Gerado toma por Base a Data Final Para Composicao na Forma :" ;
	SIZE 1,72, 0
@ 17,25 SAY "<CO> = Arq. do Diretorio Comum" ;
	SIZE 1,30, 0
@ 18,25 SAY "<CE> = Arq. do Diretorio Central" ;
	SIZE 1,32, 0
@ 16,19 SAY "** => <nn> = Codigo da Filial " ;
	SIZE 1,30, 0
@ 15,2 SAY "IDddmm**.DBF :   ID =  Identificador do Arq Cadastrado no Arq. Controle " ;
	SIZE 1,72, 0
@ 4,2 SAY "Filtrar Para Filial :" ;
	SIZE 1,21, 0
@ 4,26 SAY "-" ;
	SIZE 1,1, 0
@ 5,24 SAY "00 => TODAS" ;
	SIZE 1,11, 0
@ 2,16 GET m.dt_inicio ;
	SIZE 1,8 ;
	DEFAULT {  /  /  } ;
	WHEN isediting ;
	VALID _s2m10zdn8()
@ 2,27 GET m.dt_fim ;
	SIZE 1,8 ;
	DEFAULT {  /  /  } ;
	WHEN _s2m10zdnz() ;
	VALID _s2m10zdol() ;
	MESSAGE "Data Final deve ser maior ou igual a Inicial"
@ 4,24 GET m.empinicio ;
	SIZE 1,2 ;
	DEFAULT 0 ;
	PICTURE "99" ;
	WHEN _s2m10zdpf() ;
	VALID _s2m10zdq6()
@ 4,27 GET m.nome_ini ;
	SIZE 1,15 ;
	DEFAULT " " ;
	PICTURE "@!K" ;
	WHEN .F.
@ 1,44 GET wi_seletor ;
 	PICTURE "@&N" ;
	FROM wv_seletor ;
	SIZE 13,32 ;
	DEFAULT 1 ;
	WHEN _s2m10zdsp() ;
	VALID _s2m10zdta() ;
	MESSAGE "<ENTER> - Seleciona    -   <F2> - Sai " ;
	COLOR SCHEME 2
@ 20,2 GET m.edit_btn ;
	PICTURE "@*HN \<Edita" ;
	SIZE 1,7,1 ;
	DEFAULT 1 ;
	WHEN _s2m10zdvb() ;
	VALID btn_val1('EDIT')
@ 20,12 GET m.imp_btn ;
	PICTURE "@*HN \<Backup" ;
	SIZE 1,8,1 ;
	DEFAULT 1 ;
	VALID _s2m10zdw0() ;
	DISABLE
@ 20,23 GET m.canc_btn ;
	PICTURE "@*HT \<Saida" ;
	SIZE 1,7,1 ;
	DEFAULT 1 ;
	VALID _s2m10zdwp()
@ 20,37 GET m.grv ;
	PICTURE "@*VN \<Grv.Marca" ;
	SIZE 1,11,1 ;
	DEFAULT 1 ;
	WHEN _s2m10zdxg() ;
	VALID _s2m10zdxz()
@ 20,50 GET m.rec ;
	PICTURE "@*VN Rec.\<Marca" ;
	SIZE 1,11,1 ;
	DEFAULT 1 ;
	WHEN _s2m10zdyo() ;
	VALID _s2m10zdz7()
@ 20,63 GET m.nov ;
	PICTURE "@*VN \<Nova Marca" ;
	SIZE 1,12,1 ;
	DEFAULT 1 ;
	WHEN _s2m10ze0q() ;
	VALID _s2m10ze19()
@ 2,2 SAY "Periodo de :" ;
	SIZE 1,12, 0

IF NOT WVISIBLE("scgc005")
	ACTIVATE WINDOW scgc005
ENDIF


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є     MS-DOSREAD contains clauses from SCREEN scgc005     є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

READ CYCLE MODAL ;
	ACTIVATE READACT() ;
	DEACTIVATE READDEAC() ;
	NOLOCK

RELEASE WINDOW scgc005

#REGION 0
IF m.talkstat = "ON"
	SET TALK ON
ENDIF
IF m.compstat = "ON"
	SET COMPATIBLE ON
ENDIF


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є               SCGC005/MS-DOS Cleanup Code               є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1
DO ULfecha 		&& FECHA ARQUIVOS ABERTOS
RETURN



*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є   SCGC005/MS-DOS Supporting Procedures and Functions    є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1
PROCEDURE ULfecha
	IF LFemp		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("empresa")
	ENDIF
	IF LFtra		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("transmit")
	ENDIF
	wp_flgfecha = .F. 		&& defaut nao fechamento da secao
	IF !EMPTY(wl_areant)
		SELECT &wl_areant
	ENDIF
	ON KEY LABEL ESCAPE
	SET FORMAT TO
	************************************
	POP KEY 			&& reabilita teclas de atalho def. anteriormente

RETURN

PROCEDURE BTN_VAL1
	PARAMETER tecla, m.chv_ler, m.chv_compara, m.chv_brow
	LN_prxobj = _CUROBJ
	ON KEY LABEL ENTER
    DO CASE
		CASE tecla = "EDIT" AND !isediting   && INICIA EDICAO
			SHOW GETS
			SHOW GET edit_btn,1 PROMPT "\<Ok"
			SHOW GET m.imp_btn DISABLE
			isediting = .t.
			_CUROBJ = 1	
		    ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
			ON KEY LABEL END DO BTN_VAL1 WITH 'DELETE'
		CASE tecla = "EDIT" AND isediting     && CONFIRMA EDICAO
			SHOW GET edit_btn,1 PROMPT "\<Edita"
			isediting = .f.
			_CUROBJ = 1	
			SHOW GET m.imp_btn ENABLE
		    ON KEY LABEL ESCAPE
			ON KEY LABEL END
		CASE tecla = "DELETE" AND isediting     && CANCELA EDICAO
			SHOW GET edit_btn,1 PROMPT "\<Edita"
			isediting = .f.
			_CUROBJ = 1	
			SHOW GET m.imp_btn DISABLE
		    ON KEY LABEL ESCAPE
			ON KEY LABEL END
	ENDCASE
RETURN

PROCEDURE ULtransempre

LFsegue = .t.

CLEAR TYPEAHEAD

***************************************
*** 	INICIO DA TRANSFERENCIA		***
***************************************

	SELE transmit
	GO TOP
	DO WHILE !EOF() AND LFsegue AND !CHRSAW(0.1)
		SCATTER MEMVAR
		LNindice = ASCAN(wv_marcador,m.arquivo)
		IF LNindice = 0 OR LEFT(wv_seletor(LNindice),1) = " "
				SKIP
				LOOP
		ENDIF

		wp_msg = ALLTRIM(m.descricao)+" "+m.arquivo
		wait window wp_msg nowait
		LSarq = ALLTRIM(m.arquivo)
		IF USED(ALLTRIM(LSarq))
			=UP_fecha(LSarq)
		ENDIF

		IF m.arq_reg = 1
			IF !NetUse(LSarq,.T.)
			   DO OBJ_ALER.SPR WITH ;
			   "Nao Foi Possivel Acessar Arquivo Origem. "+LSarq+ ;
			    chr(13)+chr(13)+;
			   "Repita o Processo. "
				LFsegue = .F.
				LOOP
			ENDIF
		ELSE
			IF !NetUse(LSarq)
			   DO OBJ_ALER.SPR WITH ;
			   "Nao Foi Possivel Acessar Arquivo Origem. "+LSarq+ ;
			    chr(13)+chr(13)+;
			   "Repita o Processo. "
				LFsegue = .F.
				LOOP
			ENDIF
		ENDIF
		SELECT &LSarq
		**************************************************
		*   INICIO DA TRANSFERENCIA DE DADOS			  *
		**************************************************
		SET DELE OFF   && COPIAR REGISTRO DELETADOS DEIXANDO-OS ATIVOS
						   && NO ARQUIVO DESTINO, POREM COM O CAMPO
						   && deletado = .t. QUE PERMITE TRATAMENTO NA
						   && RECUPERACAO
		*********   IDENTIFICA DIRETORIO ORIGEM DO ARQUIVO ********
		LStmpO = DBF()				&& ARQUIVO ORIGEM
		LStmpD = DBF()				&& ARQUIVO DESTINO
		LStmpD = LEFT(LStmpD,RAT("\",LStmpD)-1)
		LStmpD = RIGHT(LStmpD,LEN(LStmpD) - RAT("\",LStmpD))

		*********   MONTA NOME DO ARQUIVO  ********
		IF LEFT(LStmpD,2) $ "CE/CO"  && CENTRAL E COMUM
				LSnomearq = m.chr_ident+ ;
						CHRTRAN(STR(DAY(m.dt_fim),2)," ","0") + ;
						CHRTRAN(STR(MONTH(m.dt_fim),2)," ","0") + ;
						LEFT(LStmpD,2)		
		ELSE		&& IMPOE A ESTENSAO DA EMPRESA
				LSnomearq = m.chr_ident+ ;
						CHRTRAN(STR(DAY(m.dt_fim),2)," ","0") + ;
						CHRTRAN(STR(MONTH(m.dt_fim),2)," ","0") + ;
						CHRTRAN(STR(WP_EMPRESA,2)," ","0")
		ENDIF		
		*********   COPIA DADOS PARA ARQUIVO DESTINO *********
		IF FILE("\SCGCBK\"+LStmpD+"\"+LSnomearq+".DBF")
		   IF !fox_alert('Arquivo '+LSnomearq+' ja existe. Substituir ?')
				=UP_fecha(LSarq)
		    	SELE transmit
				skip
				loop
			ENDIF
		ENDIF
		*********   CARACTERIZA ARQUIVO DESTINO *********
		IF m.arq_reg = 1  && ARQUIVO INTEGRAL
			LStmpD = "\SCGCBK\"+LStmpD+"\"+LSnomearq+".*"
		ELSE
			LStmpD = "\SCGCBK\"+LStmpD+"\"+LSnomearq
		ENDIF

		IF m.arq_reg = 1  && ARQUIVO INTEGRAL
			=UP_fecha(LSarq)
			! /0 XCOPY &LStmpO  &LStmpD
		ELSE

			DO ULtransfere

			=UP_fecha(LSnomearq)
			=UP_fecha(LSarq)
		ENDIF
		IF !FILE(LStmpD+".DBF")
		   DO OBJ_ALER.SPR WITH ;
		   "Arq.Destino "+LStmpd+" nao foi Gerado. "+chr(13)+chr(13)+;
		   "Repita o Processo. "
			LFsegue = .f.
			LOOP		
		ENDIF

		SET DELE ON
		**************************************************
		*   FIM DA TRANSFERENCIA DE DADOS			  *
		**************************************************
		SELE transmit
		skip
	ENDDO

	IF LFsegue
		=UPbeeps(.t.,"Processo Concluido com Sucesso. <ENTER>")
	ELSE
		=UPbeeps(.t.,"Processo Interrompido. <ENTER>")
	ENDIF
RETURN


******************************************************************
PROCEDURE ULtransfere
		SELECT &LSarq		&& ARQ. ORIGEM DE REGISTROS
		SET ORDER TO TAG DTREGIS
		COPY STRU TO &LStmpD
	    on error WAIT WINDOW "" NOWAIT
		select 0
	    use &LStmpD exclusive
		IF ERROR() > 0
		   on error
		   DO OBJ_ALER.SPR WITH ;
		   "Nao Foi Possivel Acessar Arquivo Destino. "+LStmpD+ ;
		    chr(13)+chr(13)+;
		   "Repita o Processo. "
			LFsegue = .F.
			RETURN
		ENDIF
	    on error
		SELECT &LSarq		&& ARQ. ORIGEM DE REGISTROS
		SET NEAR ON
		SEEK m.dt_inicio
		SET NEAR OFF

		DO WHILE !EOF() AND  &LSarq .dtregis >= m.dt_inicio ;
						AND  &LSarq .dtregis <= m.dt_fim ;
						AND LFsegue
			SCATTER MEMVAR MEMO

			wp_msg = ALIAS()+"    "+STR(RECNO(),7)+"  "+DTOC(m.dtregis)
			WAIT WINDOW  wp_msg  NOWAIT
			
			IF m.indica_emp AND m.empinicio <> 0 AND ;
					 m.empinicio <> m.empresa
				SKIP
				LOOP
			ENDIF

			SELE &LSnomearq
			APPEND BLANK
			GATHER MEMVAR MEMO
			SELECT &LSarq		&& ARQ. ORIGEM DE REGISTROS
			SKIP
		ENDDO


RETURN

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _S2M10ZDN8           m.dt_inicio VALID                  є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC005,     Record Number:   59   є
*       є Variable:            m.dt_inicio                        є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Field                              є
*       є Snippet Number:      1                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _s2m10zdn8     &&  m.dt_inicio VALID
#REGION 1
m.dt_fim = m.dt_inicio
SHOW GET m.dt_fim
RETURN .T.

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _S2M10ZDNZ           m.dt_fim WHEN                      є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC005,     Record Number:   60   є
*       є Variable:            m.dt_fim                           є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Field                              є
*       є Snippet Number:      2                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _s2m10zdnz     &&  m.dt_fim WHEN
#REGION 1
ON KEY LABEL ENTER
RETURN(isediting)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _S2M10ZDOL           m.dt_fim VALID                     є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC005,     Record Number:   60   є
*       є Variable:            m.dt_fim                           є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Field                              є
*       є Snippet Number:      3                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _s2m10zdol     &&  m.dt_fim VALID
#REGION 1
IF m.dt_fim >= m.dt_inicio
	KEYBOARD CHR(24)
	RETURN(.T.)
ENDIF
RETURN(.F.)

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _S2M10ZDPF           m.empinicio WHEN                   є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC005,     Record Number:   61   є
*       є Variable:            m.empinicio                        є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Field                              є
*       є Snippet Number:      4                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _s2m10zdpf     &&  m.empinicio WHEN
#REGION 1
ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
ON KEY LABEL ENTER
RETURN(isediting)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _S2M10ZDQ6           m.empinicio VALID                  є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC005,     Record Number:   61   є
*       є Variable:            m.empinicio                        є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Field                              є
*       є Snippet Number:      5                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _s2m10zdq6     &&  m.empinicio VALID
#REGION 1
SELECT empresa
SET ORDER TO TAG empresa
IF LASTKEY() = 9
   ON KEY LABEL ESCAPE
   DO loc_dlog WITH .F.
   ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
   IF LASTKEY() = 27
		SELECT empresa
		RETURN .F.
	ENDIF
ELSE
	IF m.empinicio = 0
		m.empresa     = 0
		m.nome_ini    = "TODAS"
		SHOW GET m.empinicio
		SHOW GET m.nome_ini
		SELECT empresa
		RETURN .T.
	ENDIF
	IF !SEEK(m.empinicio)
		SELECT empresa
		RETURN .F.
	ENDIF
ENDIF
m.empresa     = empresa
m.empinicio   = empresa
m.nome_ini    = empresa.nome
SHOW GET m.empinicio
SHOW GET m.nome_ini
SELECT empresa
RETURN .T.


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _S2M10ZDSP           wi_seletor WHEN                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC005,     Record Number:   63   є
*       є Variable:            wi_seletor                         є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         List                               є
*       є Snippet Number:      6                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _s2m10zdsp     &&  wi_seletor WHEN
#REGION 1
ON KEY LABEL SPACEBAR  KEYBOARD "{ENTER}"
RETURN(isediting)

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _S2M10ZDTA           wi_seletor VALID                   є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC005,     Record Number:   63   є
*       є Variable:            wi_seletor                         є
*       є Called By:           VALID Clause                       є
*       є Object Type:         List                               є
*       є Snippet Number:      7                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _s2m10zdta     &&  wi_seletor VALID
#REGION 1
wl_marca = ""
wl_max = wi_seletor
wl_marca = LEFT(wv_seletor(wi_seletor),1)

DO CASE
   CASE wi_seletor = 1
        wl_comando = "ZERA"
        wi_seletor = 3
        wl_max     = ALEN(wv_seletor,1)
        wl_marca   = " "
   CASE wi_seletor = 2
        wl_comando = "TODAS"
        wi_seletor = 3
        wl_max     = ALEN(wv_seletor,1)
        wl_marca = chr(10)
   OTHERWISE
        if wl_marca = " "
           wl_marca = chr(10)
           wl_comando = "MARCA"
        else
           wl_marca = " "
           wl_comando = "ZERA"
        endif
ENDCASE

*--->   MARCA ou DESMARCA

DO WHILE ! (wi_seletor > wl_max)
   wv_seletor(wi_seletor)= wl_marca+SUBS(wv_seletor(wi_seletor),2)
   wi_seletor = wi_seletor + 1
ENDDO

_CUROBJ = OBJNUM(wi_seletor)
SHOW GET wi_seletor

ON KEY LABEL SPACEBAR
RETURN(.T.)

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _S2M10ZDVB           m.edit_btn WHEN                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC005,     Record Number:   64   є
*       є Variable:            m.edit_btn                         є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      8                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _s2m10zdvb     &&  m.edit_btn WHEN
#REGION 1
ON KEY LABEL SPACEBAR
RETURN(.T.)

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _S2M10ZDW0           m.imp_btn VALID                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC005,     Record Number:   65   є
*       є Variable:            m.imp_btn                          є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      9                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _s2m10zdw0     &&  m.imp_btn VALID
#REGION 1
DO ULtransempre
RETURN



*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _S2M10ZDWP           m.canc_btn VALID                   є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC005,     Record Number:   66   є
*       є Variable:            m.canc_btn                         є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      10                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _s2m10zdwp     &&  m.canc_btn VALID
#REGION 1
CLEAR GETS
CLEAR READ
isediting = .f.
RETURN .T.

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _S2M10ZDXG           m.grv WHEN                         є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC005,     Record Number:   67   є
*       є Variable:            m.grv                              є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      11                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _s2m10zdxg     &&  m.grv WHEN
#REGION 1
ON KEY LABEL SPACEBAR  KEYBOARD "{ENTER}"
RETURN(.T.)

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _S2M10ZDXZ           m.grv VALID                        є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC005,     Record Number:   67   є
*       є Variable:            m.grv                              є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      12                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
		*************** SALVA COMO PARAMETROS PARA PROXIMO RELATO *****
FUNCTION _s2m10zdxz     &&  m.grv VALID
#REGION 1
			SAVE TO temp005A ALL LIKE wv_marcador
			SAVE TO temp005B ALL LIKE wv_seletor
		****************************************************************


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _S2M10ZDYO           m.rec WHEN                         є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC005,     Record Number:   68   є
*       є Variable:            m.rec                              є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      13                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _s2m10zdyo     &&  m.rec WHEN
#REGION 1
ON KEY LABEL SPACEBAR  KEYBOARD "{ENTER}"
RETURN(.T.)

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _S2M10ZDZ7           m.rec VALID                        є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC005,     Record Number:   68   є
*       є Variable:            m.rec                              є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      14                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
		*************** BUSCA PARAMETROS PARA PROXIMO RELATO *****
FUNCTION _s2m10zdz7     &&  m.rec VALID
#REGION 1
			ON ERROR TMP=""   && EVITA MENS. DE ERRO QDO ARQ.NAO EXISTIR
			RESTORE FROM  temp005a ADDITIVE
			RESTORE FROM  temp005b ADDITIVE
			ON ERROR
		****************************************************************
			SHOW GETS


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _S2M10ZE0Q           m.nov WHEN                         є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC005,     Record Number:   69   є
*       є Variable:            m.nov                              є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      15                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _s2m10ze0q     &&  m.nov WHEN
#REGION 1
ON KEY LABEL SPACEBAR  KEYBOARD "{ENTER}"
RETURN(.T.)

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _S2M10ZE19           m.nov VALID                        є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC005,     Record Number:   69   є
*       є Variable:            m.nov                              є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      16                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _s2m10ze19     &&  m.nov VALID
#REGION 1
sele transmit
go top
******************  PARA SELECIONAR ARQUIVOS A RESTURAR ********
COUNT TO wl_record
wl_record = wl_record + 2

DIMENSION wv_seletor(wl_record,1)
DIMENSION wv_marcador(wl_record,1)

wi_seletor = 3
GO TOP

wv_seletor(1) = "Anula Selecoes."
wv_seletor(2) = "Seleciona Todas."
wv_marcador(1) = "Anula Selecoes."
wv_marcador(2) = "Seleciona Todas."

DO WHILE !EOF()
   wl_marca = " "
   wv_seletor(wi_seletor)  = wl_marca+transmit.arquivo+" - "+descricao
   wv_marcador(wi_seletor) = transmit.arquivo
   wi_seletor = wi_seletor + 1
   SKIP
ENDDO
SHOW GETS








