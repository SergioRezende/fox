*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º 02/04/16             SCGC800.SPR               15:04:27 º
*       º                                                         º
*       ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶
*       º                                                         º
*       º Author's Name                                           º
*       º                                                         º
*       º Copyright (c) 2016 Company Name                         º
*       º Address                                                 º
*       º City,     Zip                                           º
*       º                                                         º
*       º Description:                                            º
*       º This program was automatically generated by GENSCRN.    º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º          SCGC800/MS-DOS Setup Code - SECTION 1          º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 1
*---------------------------------------------------------------------*
*	PROCESSA PROVIMENTO DE ESTQOQUE
*---------------------------------------------------------------------*
#DEFINE C_DELREC		'Apagar Registro Selecionado ?'

PRIVATE LS800areant
LS800areant	= ALLTRIM(ALIAS()) && PERMITE RETORNAR A AREA ANTER. A CHAMADA
ON KEY LABEL ESCAPE


PRIVATE isediting,isadding,isreading,wp_flgfecha,wp_ref_local,iscancela
PRIVATE WP_RECORD,LFusr800,LFtab800,LFemp800,LFgru800,LFsld800,LFmov800
PRIVATE LFfor800,LFpvc800,LFpvi800,LFpdi800,LFtbc800,LFnfs800,LFnfe800
PRIVATE LFcll800,LFgat800,LFpedido,LFdsctforn
PRIVATE LFitprvstq
PRIVATE codinicio,clasinicio,descinicio,codfim,clasfim,descfim
PRIVATE ordinicio,ordfim

PRIVATE imp_cons

private ALSPedir, CrsPedir

CrsPedir = ""
ALSPedir = ""

m.isediting		=	.F.
m.isadding		=	.F.
m.isreading 	=   .F.
wp_flgfecha 	= 	.F. 		&& defaut nao fechamento da secao
wp_ref_local 	=  .T.     &&  POSSUI CONTROLE DE REFRESH LOCAL
iscancela   	= .f.
m.codinicio  	= " "
m.clasinicio 	= " "
m.descinicio 	= " "
m.ordinicio		= 0
m.codfim     	= " "    	&& CODIGO FINAL INFORMADO
m.clasfim    	= " "    	&& CLASSIFIC. DE ENCERRA ALTERACAO
m.descfim    	= " "
m.ordfim		= 0
imp_cons		= 1



m.duracao_estq = 0


WP_RECORD 		= 	0
LFusr800		= 	.F.		&& .F. =>  ITMANEXO	DEVE SER FECHADA NA SAIDA
LFtab800		= 	.F.		&& .F. =>  EMPRESA	DEVE SER FECHADA NA SAIDA
LFemp800		= 	.F.		&& .F. =>  FORNECE	DEVE SER FECHADA NA SAIDA
LFgru800		= 	.F.		&& .F. =>  GRUPO	DEVE SER FECHADA NA SAIDA
LFsld800		= 	.F.		&& .F. =>  NOTAITE  DEVE SER 211DA NA SAIDA
LFmov800		= 	.F.		&& .F. =>  ITEMMOV	DEVE SER FECHADA NA SAIDA
LFfor800		= 	.F.		&& .F. =>  ITMANEXO	DEVE SER FECHADA NA SAIDA
LFpvc800		= 	.F.		&& .F. =>  ITMANEXO	DEVE SER FECHADA NA SAIDA
LFpvi800		= 	.F.		&& .F. =>  ITMANEXO	DEVE SER FECHADA NA SAIDA
LFpdi800		= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFtbc800		= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFnfs800		= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFnfE800		= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFfer800		= 	.F.		&& .F. =>  FERIADOS
LFgat800		= 	.F.		&& .F. =>  GATILHOS
LFitprvstq		= 	.F.		&& .F. =>  GATILHOS
LFgrupoanx		= 	.F.		&& .F. =>  GATILHOS
LFpedido		= 	.F.		&& .F. =>  GATILHOS
LFdsctforn	=	.F.		
*------------------- CONTROLE DE ARQUIVOS
IF !USED("usuario")
	LFusr800	= .T.
	IF ! NetUse("usuario")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("tab001")
	LFtab800	= .T.
	IF ! NetUse("tab001")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("tabforn")
	LFtbc800	= .T.
	IF ! NetUse("tabforn")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF

IF !USED("empresa")
	LFemp800	= .T.
	IF ! NetUse("empresa")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("grupo")
	LFgru800	= .T.
	IF ! NetUse("grupo")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("grupoanx")
	LFgrupoanx	= .T.
	IF ! NetUse("grupoanx")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("saldo")
	LFsld800	= .T.
	IF ! NetUse("saldo")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("itemmov")
	LFmov800	= .T.
	IF ! NetUse("itemmov")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("fornece")
	LFfor800	= .T.
	IF ! NetUse("fornece")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("pedido")
	LFpedido	= .T.
	IF ! NetUse("pedido")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("itprvstq")
	LFitprvstq	= .T.
	IF ! NetUse("itprvstq")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("pedite")
	LFpdi800	= .T.
	IF ! NetUse("pedite")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("nota")
	LFnfs800	= .T.
	IF ! NetUse("nota")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("notaent")
	LFnfe800	= .T.
	IF ! NetUse("notaent")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("feriado")
	LFfer800	= .T.
	IF ! NetUse("feriado")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("gatilho")
	LFgat800	= .T.
	IF ! NetUse("gatilho")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF

IF !USED("dsctforn")
	LFdsctforn	= .T.
	IF ! NetUse("dsctforn")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF

IF !USED("prvitstq")
	LFpvi800	= .T.
	IF ! NetUse("prvitstq")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("prvcbstq")
	LFpvc800	= .T.
	IF ! NetUse("prvcbstq")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
******>>>> INICIO CONTROLE ARQUIVOS
*>> parametros repassados a btn_val
VLleitura = "STR(wp_empresa,3)"  && OPERACOES DE COMPRA
                         * repassa chave de leitura p/ btn_val
VLlerfim  = "STR(wp_empresa+1,3)"   && 1o REG. APOS OPER. COMPRAS
           * repassa chave de leitura p/ btn_val (POSICAO FINAL + 1 REG)
VLcompara = "prvcbstq.empresa = wp_empresa "
                         * repassa chave de comparacao p/ btn_val
VLchvlimi = "STR(wp_empresa,3)"  && otimiza browse
***************************************************
IF wp_flgfecha
	DO ULfecha 		&& FECHA ARQUIVOS ABERTOS
	RETURN
ENDIF
SELE prvcbstq


#REGION 0
REGIONAL m.currarea, m.talkstat, m.compstat

IF SET("TALK") = "ON"
	SET TALK OFF
	m.talkstat = "ON"
ELSE
	m.talkstat = "OFF"
ENDIF
m.compstat = SET("COMPATIBLE")
SET COMPATIBLE FOXPLUS

*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º                MS-DOS Window definitions                º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

IF NOT WEXIST("scgc800") ;
	OR UPPER(WTITLE("SCGC800")) == "SCGC800.PJX" ;
	OR UPPER(WTITLE("SCGC800")) == "SCGC800.SCX" ;
	OR UPPER(WTITLE("SCGC800")) == "SCGC800.MNX" ;
	OR UPPER(WTITLE("SCGC800")) == "SCGC800.PRG" ;
	OR UPPER(WTITLE("SCGC800")) == "SCGC800.FRX" ;
	OR UPPER(WTITLE("SCGC800")) == "SCGC800.QPR"
	DEFINE WINDOW scgc800 ;
		FROM 1, 0 ;
		TO 19,79 ;
		TITLE "[ PROVISAO DE ESTOQUE ]" ;
		FOOTER "[800]" ;
		FLOAT ;
		NOCLOSE ;
		MINIMIZE ;
		NONE ;
		COLOR SCHEME 1
ENDIF

IF NOT WEXIST("navega") ;
	OR UPPER(WTITLE("NAVEGA")) == "NAVEGA.PJX" ;
	OR UPPER(WTITLE("NAVEGA")) == "NAVEGA.SCX" ;
	OR UPPER(WTITLE("NAVEGA")) == "NAVEGA.MNX" ;
	OR UPPER(WTITLE("NAVEGA")) == "NAVEGA.PRG" ;
	OR UPPER(WTITLE("NAVEGA")) == "NAVEGA.FRX" ;
	OR UPPER(WTITLE("NAVEGA")) == "NAVEGA.QPR"
	DEFINE WINDOW navega ;
		FROM 22, 0 ;
		TO 24,79 ;
		FLOAT ;
		NOCLOSE ;
		NOMINIMIZE ;
		NONE ;
		COLOR SCHEME 1
ENDIF


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º          SCGC800/MS-DOS Setup Code - SECTION 2          º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 1
******>>>> INICIO CONTROLE LOCAL
DO CASE
	CASE !wp_flgfecha
		SELE empresa
		SET ORDER TO TAG empresa
		SEEK wp_empresa
		SELE prvcbstq
		SET ORDER TO TAG ordena
		SCATTER MEMVAR MEMO BLANK
		*-------------------------> criado pelo wizard
		m.wzalias=SELECT()
		m.isreadonly=IIF(ISREAD(),.T.,.F.)
		IF m.isreadonly
			WAIT WINDOW C_READONLY TIMEOUT 1
		ENDIF
		KEYBOARD "F"
		ON KEY LABEL CTRL-I DO ULitens
ENDCASE


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º              SCGC800/MS-DOS Screen Layout               º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 1
IF WVISIBLE("scgc800")
	ACTIVATE WINDOW scgc800 SAME
ELSE
	ACTIVATE WINDOW scgc800 NOSHOW
ENDIF
@ 2,1 TO 4,77 ;
	COLOR SCHEME 23
@ 5,29 TO 7,76 ;
	COLOR SCHEME 23
@ 0,0 TO 18,79 ;
	COLOR SCHEME 23
@ 18,79 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,79 TO 17,79 ;
	COLOR SCHEME 24
@ 0,79 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 3,27 SAY "-" ;
	SIZE 1,1, 0
@ 0,73 SAY "[800]" ;
	SIZE 1,5, 0
@ 0,2 SAY "[ Provisionamento de Estoque ]" ;
	SIZE 1,30, 0
@ 3,68 SAY "(" ;
	SIZE 1,1, 0
@ 3,72 SAY "dias)" ;
	SIZE 1,5, 0
@ 7,30 TO 7,70 ;
	COLOR SCHEME 24
@ 5,76 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 6,76 SAY "³" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 5,30 SAY "[ Indique Filiais p/ Avaliar Estoque ]" ;
	SIZE 1,38, 0
@ 18,2 TO 18,77 ;
	COLOR SCHEME 23
@ 7,76 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 2,2 SAY "[ Fil ]" ;
	SIZE 1,7, 0
@ 2,10 SAY "[ Prov.Num ]" ;
	SIZE 1,12, 0
@ 4,2 TO 4,76 ;
	COLOR SCHEME 24
@ 4,77 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 3,77 SAY "³" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 2,77 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 8,1 TO 10,19 ;
	COLOR SCHEME 23
@ 10,2 TO 10,18 ;
	COLOR SCHEME 24
@ 10,19 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 9,19 SAY "³" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 8,19 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 10,3 SAY "<TAB>-> Opcoes" ;
	SIZE 1,14, 0 ;
	COLOR SCHEME 24
@ 8,20 TO 10,54 ;
	COLOR SCHEME 23
@ 10,21 TO 10,53 ;
	COLOR SCHEME 24
@ 10,54 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 9,54 SAY "³" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 8,54 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 8,21 SAY "[ Avaliar Prod.]" ;
	SIZE 1,16, 0
@ 6,15 SAY "%" ;
	SIZE 1,1, 0
@ 5,1 TO 7,27 ;
	COLOR SCHEME 23
@ 7,2 TO 7,26 ;
	COLOR SCHEME 24
@ 7,27 SAY "Ù" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 6,27 SAY "³" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 5,27 SAY "¿" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 5,2 SAY "[ Variacao Mercado Geral]" ;
	SIZE 1,25, 0
@ 7,9 SAY "(-)=>Queda" ;
	SIZE 1,10, 0 ;
	COLOR SCHEME 24
@ 2,39 SAY "[Data Consulta]" ;
	SIZE 1,15, 0
@ 2,24 SAY "[ Usuario ]" ;
	SIZE 1,11, 0
@ 2,58 SAY "[ Estocar ate ]" ;
	SIZE 1,15, 0
@ 18,1 TO 18,78 ;
	COLOR SCHEME 24
@ 8,2 SAY "[Selec.Prod.Tipo]" ;
	SIZE 1,17, 0
@ 3,4 GET m.empresa ;
	SIZE 1,3 ;
	DEFAULT 0 ;
	PICTURE "999" ;
	WHEN .f.
@ 3,11 GET m.numero ;
	SIZE 1,7 ;
	DEFAULT 0 ;
	PICTURE "999,999" ;
	WHEN _4k30wb51r() ;
	VALID _4k30wb51s() ;
	ERROR wp_msg
@ 3,23 GET m.operador ;
	SIZE 1,4 ;
	DEFAULT 0 ;
	PICTURE "9999" ;
	WHEN isediting ;
	VALID _4k30wb51t() ;
	ERROR "Banco nao Cadastrado no sistema"
@ 3,28 GET m.nomeusr ;
	SIZE 1,10 ;
	DEFAULT " " ;
	PICTURE "@K XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX" ;
	WHEN .F.
@ 3,42 GET m.data ;
	SIZE 1,10 ;
	DEFAULT {  /  /  } ;
	WHEN _4k30wb51u() ;
	VALID _4k30wb51v()
@ 3,58 GET m.prover_ate ;
	SIZE 1,10 ;
	DEFAULT {  /  /  } ;
	WHEN _4k30wb534() ;
	VALID _4k30wb539()
@ 3,69 GET m.em_dias ;
	SIZE 1,3 ;
	DEFAULT " " ;
	PICTURE "999" ;
	WHEN .f.
@ 6,11 GET m.variacao ;
	SIZE 1,4 ;
	DEFAULT " " ;
	PICTURE "999.99" ;
	WHEN _4k30wb53f()
@ 6,30 GET m.filiais ;
	SIZE 1,46 ;
	DEFAULT " " ;
	PICTURE "999/999/999/999/999/999/999/999/999/999/999/999" ;
	WHEN _4k30wb53l() ;
	VALID _4k30wb53m()
@ 8,55 GET m.Perfil_01 ;
	PICTURE "@^ Nacional;Importado;Nacional/Importado/ /" ;
	SIZE 3,24 ;
	DEFAULT "Nacional" ;
	WHEN _4k30wb53n() ;
	VALID _4k30wb53o() ;
	COLOR SCHEME 1, 2
@ 9,8 GET m.controles ;
	SIZE 1,10 ;
	DEFAULT " " ;
	WHEN _4k30wb53p() ;
	VALID _4k30wb53q()
@ 9,21 GET m.codinicio ;
	SIZE 1,16 ;
	DEFAULT " " ;
	PICTURE "&masc_codi" ;
	WHEN _4k30wb53r() ;
	VALID _4k30wb54r() ;
	ERROR wp_msg
@ 9,38 GET m.codfim ;
	SIZE 1,16 ;
	DEFAULT " " ;
	PICTURE "&masc_codi" ;
	WHEN _4k30wb54x() ;
	VALID _4k30wb553() ;
	ERROR wp_msg
@ 11,1 GET it_btn ;
	PICTURE "@*HN \<3-Edicao Itens" ;
	SIZE 1,16,1 ;
	DEFAULT 1 ;
	VALID _4k30wb554() ;
	MESSAGE 'Primeiro registro'
@ 11,42 GET pb2_btn ;
	PICTURE "@*HN \<2-Montar Matriz Ped. sem Sugestao" ;
	SIZE 1,35,1 ;
	DEFAULT 1 ;
	VALID _4k30wb555() ;
	MESSAGE 'Primeiro registro'
@ 12,42 GET IMP1_btn ;
	PICTURE "@*HN \<5-Imp.Pdd-GYN/DF/ARG/ANP" ;
	SIZE 1,26,1 ;
	DEFAULT 1 ;
	VALID _4k30wb556() ;
	MESSAGE 'Primeiro registro'
@ 13,42 GET ver_btn ;
	PICTURE "@*HN \<6-Imp.pdd BGS/ABO/CGB" ;
	SIZE 1,23,1 ;
	DEFAULT 1 ;
	VALID _4k30wb557() ;
	MESSAGE 'Primeiro registro'
@ 15,1 GET IMPY_btn ;
	PICTURE "@*HN \<Y-Imp. Estoque com mais de      dias de duracao" ;
	SIZE 1,49,1 ;
	DEFAULT 1 ;
	VALID _4k30wb558() ;
	MESSAGE 'Primeiro registro'
@ 15,29 GET m.duracao_estq ;
	SIZE 1,4 ;
	DEFAULT " " ;
	PICTURE "999" ;
	WHEN _4k30wb569()
@ 17,2 GET IMP8_btn ;
	PICTURE "@*HN \<H-Reanexar Sugestao" ;
	SIZE 1,21,1 ;
	DEFAULT 1 ;
	VALID _4k30wb56f() ;
	MESSAGE 'Primeiro registro'
@ 17,5 GET IMP6_btn ;
	PICTURE "@*HN \<G-Imp.Gatilho" ;
	SIZE 1,15,1 ;
	DEFAULT 1 ;
	VALID _4k30wb56l() ;
	MESSAGE 'Primeiro registro'
@ 17,8 GET IMP4_btn ;
	PICTURE "@*HN \<8-Imp.Pedido" ;
	SIZE 1,14,1 ;
	DEFAULT 1 ;
	VALID _4k30wb56m() ;
	MESSAGE 'Primeiro registro'
@ 17,11 GET X_btn ;
	PICTURE "@*HN \<X-Imp.Estoques" ;
	SIZE 1,16,1 ;
	DEFAULT 1 ;
	VALID _4k30wb56n() ;
	MESSAGE 'Primeiro registro'
@ 17,14 GET IMP5_btn ;
	PICTURE "@*HN \<9-Imp.Sugestao Com Giro Medio" ;
	SIZE 1,31,1 ;
	DEFAULT 1 ;
	VALID _4k30wb56o() ;
	MESSAGE 'Primeiro registro'
@ 17,17 GET IMP2_btn ;
	PICTURE "@*HN \<W-Imp.Duracao do Estoque Regional" ;
	SIZE 1,35,1 ;
	DEFAULT 1 ;
	VALID _4k30wb56p() ;
	MESSAGE 'Primeiro registro'
@ 17,20 GET IMP3_btn ;
	PICTURE "@*HN \<7-Imp.Verificacao por Regional" ;
	SIZE 1,32,1 ;
	DEFAULT 1 ;
	VALID _4k30wb56q() ;
	MESSAGE 'Primeiro registro'
@ 17,26 GET pb_btn ;
	PICTURE "@*HN \<1-Montar Matriz Ped. com Sugestao" ;
	SIZE 1,35,1 ;
	DEFAULT 1 ;
	VALID _4k30wb57p() ;
	MESSAGE 'Primeiro registro'
@ 18,50 GET IMP7_btn ;
	PICTURE "@*HN \<X-Gera Pedido Final" ;
	SIZE 1,21,1 ;
	DEFAULT 1 ;
	VALID _4k30wb57v() ;
	MESSAGE 'Primeiro registro'




*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º              OBJ_WNAV/MS-DOS Screen Layout              º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 2
IF WVISIBLE("navega")
	ACTIVATE WINDOW navega SAME
ELSE
	ACTIVATE WINDOW navega NOSHOW
ENDIF
@ 1,8 GET m.top_btn ;
	PICTURE "@*HN \<Inicio" ;
	SIZE 1,8,1 ;
	DEFAULT 1 ;
	VALID BTN_VAL1('TOP', VLleitura, Vlcompara) ;
	MESSAGE 'Primeiro registro'
@ 1,16 GET m.prev_btn ;
	PICTURE "@*HN \<Ant" ;
	SIZE 1,5,1 ;
	DEFAULT 1 ;
	VALID btn_val1('PREV', VLleitura, Vlcompara) ;
	MESSAGE 'Posiciona no registro anterior.' 	
@ 1,21 GET m.next_btn ;
	PICTURE "@*HN \<Proximo" ;
	SIZE 1,9,1 ;
	DEFAULT 1 ;
	VALID btn_val1('NEXT', VLleitura, Vlcompara) ;
	MESSAGE 'Avanca para proximo registro'
@ 1,30 GET m.end_btn ;
	PICTURE "@*HN \<Fim" ;
	SIZE 1,5,1 ;
	DEFAULT 1 ;
	VALID btn_val1('END', VLlerfim, Vlcompara) ;
	MESSAGE 'Ultimo registro do arquivo' 																																													
@ 1,35 GET m.loc_btn ;
	PICTURE "@*HN \<Zoom" ;
	SIZE 1,6,1 ;
	DEFAULT 1 ;
	VALID btn_val1('LOCATE', VLleitura, Vlcompara,VLchvlimi)		 ;
	MESSAGE 'Permite consulta visual ampliada a varios registros na tela'
@ 1,41 GET m.add_btn ;
	PICTURE "@*HN \<Lanca" ;
	SIZE 1,7,1 ;
	DEFAULT 1 ;
	VALID btn_val1('ADD') ;
	MESSAGE 'Abre novo registro para lancamento de dados' 
@ 1,55 GET m.edit_btn ;
	PICTURE "@*HN \<Edit" ;
	SIZE 1,6,1 ;
	DEFAULT 1 ;
	VALID btn_val1('EDIT') ;
	MESSAGE 'Permite a alteracao de dados do registro corrente'
@ 1,61 GET m.del_btn ;
	PICTURE "@*HN \<Del" ;
	SIZE 1,5,1 ;
	DEFAULT 1 ;
	VALID btn_val1('DELETE', VLleitura, Vlcompara) ;
	MESSAGE 'Delete current record.'
@ 1,73 GET m.exit_btn ;
	PICTURE "@*HN \<Sair" ;
	SIZE 1,6,1 ;
	DEFAULT 1 ;
	VALID btn_val1('EXIT') ;
	MESSAGE 'Close screen.'
@ 1,48 GET m.cop_btn ;
	PICTURE "@*HN \<Copia" ;
	SIZE 1,7,1 ;
	DEFAULT 1 ;
	VALID btn_val1('COPY') ;
	MESSAGE 'Abre novo registro sel limpar os dados do reg corrente' 
@ 1,1 GET m.busca_btn ;
	PICTURE "@*HN \<Busca" ;
	SIZE 1,7,1 ;
	DEFAULT 1 ;
	VALID BTN_VAL1('BUSCA') ;
	MESSAGE 'Busca dirata pela chave do documento.'
@ 1,66 GET m.imp_btn ;
	PICTURE "@*HN i\<Mpr" ;
	SIZE 1,6,1 ;
	DEFAULT 1 ;
	VALID btn_val1('PRINT') ;
	MESSAGE 'Close screen.'
@ 0,0 TO 2,79 DOUBLE ;
	COLOR SCHEME 24
@ 2,1 TO 2,78 DOUBLE ;
	COLOR SCHEME 23
@ 1,79 SAY "³" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 0,79 SAY "»" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 2,79 SAY "¼" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 1,79 SAY "º" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23

IF NOT WVISIBLE("navega")
	ACTIVATE WINDOW navega
ENDIF
IF NOT WVISIBLE("scgc800")
	ACTIVATE WINDOW scgc800
ENDIF


READ CYCLE ;
	VALID READVALID() ;
	WHEN READWHEN() ;
	ACTIVATE READACT() ;
	DEACTIVATE READDEAC()

RELEASE WINDOW navega
RELEASE WINDOW scgc800

#REGION 0
IF m.talkstat = "ON"
	SET TALK ON
ENDIF
IF m.compstat = "ON"
	SET COMPATIBLE ON
ENDIF


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º               SCGC800/MS-DOS Cleanup Code               º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 1


	DO ULfecha 		&& FECHA ARQUIVOS ABERTOS
	wp_flgfecha = .F. 		&& defaut nao fechamento da secao
	ON KEY LABEL ESCAPE
	SET FORMAT TO
	ON KEY LABEL CTRL-I
RETURN



*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º   SCGC800/MS-DOS Supporting Procedures and Functions    º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*

#REGION 1
PROCEDURE ULitens
*-*-*-----*-*--*-*-*-*-*-*-*-*>> TALVEZ ABRA TRANZACAO
	IF isediting
		WAIT WINDOW "Termine a Edicao para ativar os itens."
 		RETURN
	ENDIF
	HIDE WINDOW SCGC800, NAVEGA
	DO SCGC800A.spx
	SHOW WINDOW SCGC800, NAVEGA
	SELE prvcbstq
    CLEAR TYPEAHEAD
	UNLOCK
	ON KEY LABEL ESCAPE
    SCATTER MEMVAR MEMO
	DO refresh

RETURN

*-------------->
PROCEDURE ULfecha
	IF LFusr800		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("usuario")
	ENDIF
	IF LFtab800		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("tab001")
	ENDIF
	IF LFtbc800		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("tbc001")
	ENDIF
	IF LFemp800		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("empresa")
	ENDIF
	IF LFgru800		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("grupo")
	ENDIF
	IF LFgrupoanx		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("grupoanx")
	ENDIF
	IF LFsld800		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("saldo")
	ENDIF
	IF LFmov800		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("itemmov")
	ENDIF
	IF LFfor800		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("fornece")
	ENDIF
	IF LFpdi800		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("pedite")
	ENDIF
	IF LFnfs800		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("nota")
	ENDIF
	IF LFnfe800		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("notaent")
	ENDIF
	IF LFfer800		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("feriado")
	ENDIF
	IF LFgat800		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("gatilho")
	ENDIF
	IF LFpvc800		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("prvcbstq")
	ENDIF
	IF LFpvi800		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("prvitstq")
	ENDIF
	IF LFpedido		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("pedido")
	ENDIF
	IF LFtbc800
		=UP_fecha("tabforn")
	ENDIF
	IF LFdsctforn
		=UP_fecha("dsctforn")
	ENDIF
	IF LFitprvstq
		=UP_fecha("itprvstq")
	ENDIF


	=UP_fecha(CrsPedir)

	wp_flgfecha = .F. 		&& defaut nao fechamento da secao
	IF !EMPTY(LS800areant)
		SELECT &LS800areant
	ENDIF
	ON KEY LABEL ESCAPE
	SET FORMAT TO
	ON KEY LABEL CTRL-I

RETURN
	

PROCEDURE BTN_VAL1
	PARAMETER tecla, m.chv_ler, m.chv_compara, m.chv_brow
	SELE prvcbstq
	SET ORDER TO TAG  ordena
    DO CASE
		CASE tecla = "ADD"
		    DO btn_val with tecla, m.chv_ler, m.chv_compara, m.chv_brow
			wl_cota = .T.    && BUSCAR NUMERO DE COTACAO
			m.situacao = "A "
			m.empresa  = wp_empresa
			m.operador =   nUsr
			SHOW GET m.situacao
			SHOW GET m.empresa
			SHOW GET m.operador
			SELECT empresa
			=REGLOCK(.T.)
			UNLOCK
			SHOW GET m.numero
			SELECT prvcbstq
		    ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"

			ON KEY LABEL END do btn_val1 with 'DELETE', VLleitura, ;
												 Vlcompara
			RETURN .T.
        CASE tecla = "DELETE"
			IF isediting     && .T. => CANCELA A EDICAO
*-*-*-*-*-*-*-*-*-*-* INICIA TRANZACAO
			    DO btn_val with tecla, m.chv_ler, m.chv_compara, m.chv_brow
				iscancela = .F.
*-*-*-*-*-*-*-*-*-*-* FIM TRANZACAO
			   	iscancela = .F.
			   	RETURN
			ENDIF
*	*	*	*	*	*	*	* APAGA REGISTROS RELACIONADOS			
			IF EOF() OR BOF()
			   WAIT WINDOW C_ENDFILE NOWAIT
			   RETURN
			ENDIF
			IF !fox_alert(C_DELREC)
			   RETURN
			ENDIF
*-*-*-**-*-*-*-*-*-*-*-*--*> INICIA TRANZACAO
			SELECT  prvitstq
			SET ORDER TO TAG ordena
			SET NEAR ON
			SEEK STR(m.empresa,3)+STR(m.numero,6)
			SET NEAR OFF
			DO WHILE !eof() AND m.empresa 		= EMPRESA ;
							AND m.numero 		= numero
			   =REGLOCK()
			   =EDITHAND("APAGA")
			   SKIP
			ENDDO
			SELECT prvcbstq
			KEYBOARD "{S}"
		    DO btn_val with tecla, m.chv_ler, m.chv_compara, m.chv_brow
*-*-*-**-*-*-*-*-*-*-*-*--*> FIM TRANZACAO

			RETURN .T.
		OTHERWISE
		    DO btn_val with tecla, m.chv_ler, m.chv_compara, m.chv_brow

	ENDCASE		

	SELE usuario
	SET ORDER TO TAG usuario
	SEEK m.operador
	m.nomeusr	 = usuario.nome
	SHOW GET m.nomeusr

	SELE grupo
	IF EMPTY(m.codinicio)
		SET ORDER TO TAG classifica
		GO TOP
		m.clasinicio  = grupo.CLASSIFICA
		m.descinicio  =   "PRIMEIRO"
		SHOW GET  m.descinicio
	ELSE
		SELE grupo
		SET ORDER TO TAG codigo
		SET NEAR ON
		SEEK ALLTRIM(m.codinicio)
		SET NEAR OFF
		m.codinicio  = grupo.codigo
		m.clasinicio = grupo.classifica
		m.descinicio = grupo.descricao
	ENDIF
	IF EMPTY(m.codfim)
		SET ORDER TO TAG classifica
		GO BOTT
		m.clasfim 	= 	alltrim(grupo.classifica)+REPL("9",15)
		m.descfim   =   "ULTIMO"
	ELSE
		SELE grupo
		SET ORDER TO TAG codigo
		SET NEAR ON
		SEEK ALLTRIM(m.codfim)
		SET NEAR OFF
		m.codfim  = grupo.codigo
		m.clasfim = grupo.classifica
		m.descfim = grupo.descricao
	ENDIF
*----------------------------------------------------------*
	SHOW GET  m.descfim
	SHOW GET  m.descinicio
*----------------------------------------------------------*
	SELECT prvcbstq

RETURN
*------------>
*------------->
PROCEDURE local_refresh
PARAMETERS wl_branco

IF  isediting or wl_branco
	  SHOW GET pb_btn   DISABLE
	  SHOW GET pb2_btn   DISABLE
	  SHOW GET it_btn   DISABLE
	  SHOW GET ver_btn   DISABLE
	  SHOW GET imp1_BTN   DISABLE
	  SHOW GET imp2_BTN   DISABLE
	  SHOW GET imp3_BTN   DISABLE
	  SHOW GET imp4_BTN   DISABLE
	  SHOW GET imp5_BTN   DISABLE
	  SHOW GET imp6_BTN   DISABLE
	  SHOW GET imp7_BTN   DISABLE
	  SHOW GET imp8_BTN   DISABLE
	  SHOW GET impY_BTN   DISABLE
	  SHOW GET X_BTN   DISABLE
	
ENDIF


RETURN




**>>>>
*<<<<<<<<<<<<<<<<<<<<<<       1o ESTAGIO           >>>>>>>>>>>>>>>>>>>>>

***********************************************************************
*  UPprevisao : Recebe os parametros de processamento para gerar os
*				registros em PRVITSTQ.
*
***********************************************************************

PROCEDURE UPREGprevisao


PARAMETERS LNempr,LNnro,LSclasini,LSclasfim,LScontrol,LSfiliais,LDdata,;
			LNqtdiaA,LNqtdiaB,LNqtdiaC,LNqtdiaD,LNqtdiaE,LNemdias,;
			LNvariacao,LFformaprev

PRIVATE   LNordini, LNordfim
PRIVATE   LFanx
PRIVATE	LNctracm


PRIVATE LAsaldo
PRIVATE LAgiromed,LAsug_var,LAvdprv_V
PRIVATE LArvgiromed,LAsug_rev,LAvdprv_R
PRIVATE LAsug_saz,LAvdprv_S
PRIVATE LAgatilho


PRIVATE LAmediaperm
PRIVATE LApedidotran,LApedidopfat

PRIVATE LVAqtdatend,LVAvendas,LVAcasada,LVAentradas,LVAgiro
PRIVATE LVArvendas,LVArentradas,LVArgiro

DIMENSION LVAqtdatend(6),LVAvendas(6),LVAcasada(6),LVAentradas(6),LVAgiro(6)
DIMENSION LVArvendas(6),LVArentradas(6),LVArgiro(6)

STORE 0 TO  LVAqtdatend,LVAvendas,LVAcasada,LVAentradas,LVAgiro
STORE 0 TO  LVArvendas,LVArentradas,LVArgiro

IF !REGLOCK()
   WAIT WINDOW "Documento nao poder ser bloqueado para o processo."
   RETURN
ENDIF

SELECT  prvitstq
SET ORDER TO TAG ordena

SET NEAR ON
SEEK STR(LNempr,3)+STR(LNnro,6)
SET NEAR OFF

IF  LNempr = prvitstq.empresa AND LNnro  = prvitstq.numero
	DO OBJ_ALER.SPR WITH " ATENCAO !!!" +;
		 " Se voce confirmar a proxima pergunta os dados "+;
		 " anteriores do PROCESSO" +;
		 " Nro :" +STR(LNnro,6)+"  serao apagados ."

	IF !fox_alert('Confirmacao 1a de 2 => Confirma o Processamento ?.')
		SELE prvcbstq
		UNLOCK
   		RETURN
	ENDIF
	IF !fox_alert('Confirmacao 2a de 2 => Confirma o Processamento ?.')
		SELE prvcbstq
		UNLOCK
   		RETURN
	ENDIF
ENDIF

***> ((((( EXCLUSAO )))

DO WHILE !eof() AND LNempr = prvitstq.empresa ;
				AND LNnro  = prvitstq.numero
	  	=REGLOCK(.T.)
		=EDITHAND("APAGA")
		SKIP
ENDDO

*---->  POSICIONA ARQUIVOS RELACIONADOS


SELE GRUPO
SET ORDER TO TAG classifica


SET NEAR ON
SEEK  LSclasfim
SET NEAR OFF

DO WHILE !EOF() AND grupo.ordem = 0
	SKIP
ENDDO
IF EOF()
	LNordfim = 99999
ELSE
	LNordfim = grupo.ordem
ENDIF

SET NEAR ON
SEEK  LSclasini
SET NEAR OFF
LNordini = grupo.ordem

DO WHILE !EOF() AND grupo.ordem = 0
	SKIP
ENDDO
IF EOF()
   WAIT WINDOW ;
   			"Nao Foram Encontrados Iten com Ordem no Intervalo de Produtos."
   RETURN
ENDIF


LNordini = grupo.ordem
SET ORDER TO TAG ordem

SET NEAR ON
SEEK  LNordini
SET NEAR OFF

*******************
*---->   (INICIALIZACAO DO CONTROLE DE STATUS IMPRESSAO)
*******************	
DO RELINIC.PRG          && INICIA VAR P/ TERMOMETRO

LFsegue = .t.
LNregistro = RECNO()


COUNT FOR 	(STR(grupo.tp_control,1) $ LScontrol ;
   			AND grupo.cdg_tipo  = 4) ;
		    WHILE  grupo.ordem <= LNordfim TO LNimpressao

LNimpressos = 0
GO LNregistro
*******************
*---->   (COMPLETADO PREPARACAO DO CONTROLE DE STATUS IMPRESSAO)
*******************	
SET RELATION TO
**************************>>> REGISTRO DE SAIDAS

DO WHILE !EOF() AND grupo.ordem <= LNordfim AND LFsegue

	IF !(STR(grupo.tp_control,1) $ LScontrol) OR grupo.cdg_tipo <> 4
		SKIP
		LOOP
	ENDIF

	=UPtermo()		

	IF EMPTY(ALLTRIM(grupo.tab_preco))
		SKIP
		LOOP
	ENDIF

	*---------------------------------------------------------------*	
	*    Seleciona so Produto Indicados para Empresas e que Constem
	* em Tabelas
	*---------------------------------------------------------------*	
	IF EMPTY(ALLTRIM(grupo.empresas)) ;
		AND	EMPTY(ALLTRIM(grupo.tab_preco))
			SKIP
			LOOP
	ENDIF
	*---------------------------------------------------------------*	
	*    Seleciona so Produto quando (Pneus, Camaras e Protetores
	* se Fornecedor for Firestone= 1
	*		PNEU     = 00
	*       CAMARA   = 01
	*       PROTETOR = 04042
	*---------------------------------------------------------------*	
	IF (LEFT(grupo.classifica,02) $ "00/01" OR ;
	   LEFT(grupo.classifica,05) $ "04042") AND ;
	   grupo.codforn <> 1
			SKIP
			LOOP
	ENDIF

	SELE empresa
	SET ORDER TO TAG regiao
	GO TOP
	QBRregiao 	= 	empresa.regiao
	QBRfilial 	= 	empresa.empresa

	m.tp_reg   = "1" && PRIMEIRO REGISTRO DO CODIGO => PRIM. EMP
	DO WHILE !EOF()
		QBRregiao 	= 	empresa.regiao
		QBRfilial 	= 	empresa.empresa

		*<<<<<<<< ACUMULADORES DO CODIGO ENTRE EMPRESAS >>>>>>>>*

		LNctracm    = 0
		LAsaldo	  	= 0

		LAgiromed 	= 0
		LAsug_var	= 0
		LAvdprv_V	= 0

		LArvgiromed = 0
		LAsug_rev	= 0
		LAvdprv_R	= 0

		LAsug_saz	= 0
		LAvdprv_S	= 0

		LAmediaperm = 0
		LApedidotran= 0
		LApedidopfat= 0

		LAgatilho	= 0

		FOR LI = 1 to 5
	    	LVAqtdatend(LI) = 0
			LVAentradas(LI) = 0
			LVAvendas(LI) 	= 0
			LVAcasada(LI) 	= 0
			LVAgiro(LI)		= 0
			LVArvendas(LI)	= 0
			LVArgiro(LI)	= 0
		NEXT
		DO WHILE !EOF() AND QBRregiao = empresa.regiao
			SELE empresa
			LNfil = empresa.empresa
			LSfil = STR(empresa.empresa,3)
			LSfil = CHRTRAN(LSfil," ","0")
			IF !(LSfil $ LSfiliais)
				SKIP
				LOOP
			ENDIF

	
			LFanx = .F.

			SELE prvitstq
			SCATTER MEMVAR BLANK

			IF	LFanx  &&  CODG. ANEXO => APENA CITAR CODIGO SEM DADOS
				=UPprevstq(grupo.classifica,LNfil,LDdata,;
						LNqtdiaA,LNqtdiaB,LNqtdiaC,LNqtdiaD,LNqtdiaE,;
						LNemdias,LNvariacao,"VAZIO")
				m.sugestao_a = 0
				m.sugestao_b = 0
				m.gatilho    = 0

			ELSE
				=UPprevstq(grupo.classifica,LNfil,LDdata,;
						LNqtdiaA,LNqtdiaB,LNqtdiaC,LNqtdiaD,LNqtdiaE,;
						LNemdias,LNvariacao,LFformaprev)
			ENDIF	
			*-----------------------------------------------------------*	
			*    Os Produtos Nao devem ter Previsao sua compra so e feita
			* por	por encomenda
			*-----------------------------------------------------------*	
			IF ALLTRIM(GRUPO.CODIGO) $ "13010611/13010913/13011111"
				m.sugestao_a = 0
				m.sugestao_b = 0
				m.sugestao_C = 0
				m.gatilho    = 0
			ENDIF
						
			IF ALLTRIM(GRUPO.CODIGO) $ "13012711/13012819/13012916"
				m.sugestao_a = 0
				m.sugestao_b = 0
				m.sugestao_C = 0
				m.gatilho    = 0
			ENDIF
			IF ALLTRIM(GRUPO.CODIGO) $ "14010119"
				m.sugestao_a = 0
				m.sugestao_b = 0
				m.sugestao_C = 0
				m.gatilho    = 0
			ENDIF
	
			m.pedir 	 = 0	&& PEDIR SERA DEFINIDO PELO USUARIO

			m.regional  = QBRregiao

			m.numero 	= LNnro
			m.tipo_reg  = m.tp_reg

			SELE GRUPO
			SET ORDER TO TAG ordem

			m.empresa = LNempr
			************************************************************
			*  VALORES ACUMULADOS PARA REGISTRO GERAL FILIAL = (999)
			************************************************************
			LNctracm  	= LNctracm    	+ 1
			LAsaldo	  	= LAsaldo		+ m.saldo
			LAgiromed 	= LAgiromed   	+ m.giromedio
			LArvgiromed	= LArvgiromed  	+ m.rvgiromedi

			***********************************************************
			*  Uma filial pode ser configurada para nao contribuir com
			* o estoque da regional(CONTRBSTQR) em caso de
			* SOBRA (SUGESTAO < 0)
			**********************************************************

			IF m.sugestao_B > 0  OR  empresa.contrbstqr <> "N"
				LAsug_var	= LAsug_var  	+ m.sugestao_A
				LAsug_rev	= LAsug_rev  	+ m.sugestao_B
				LAsug_saz	= LAsug_saz  	+ m.sugestao_C
			ENDIF
			**********************************************************
			LAvdprv_V	= LAvdprv_V  	+ m.prvvenda_A
			LAvdprv_R	= LAvdprv_R  	+ m.prvvenda_B
			LAvdprv_S	= LAvdprv_S  	+ m.prvvenda_C
	
			LAmediaperm = LAmediaperm   + m.media_perm
			LApedidotran= LApedidotran  + m.pedidotran
			LApedidopfat= LApedidopfat  + m.pedidopfat

			LAgatilho   = LAgatilho     + m.gatilho

			FOR LI = 1 to 5
				Lsc = CHR(LI+64)
    			LVAqtdatend(LI) = LVAqtdatend(LI) + m.qtdatend_&Lsc
				LVAentradas(LI) = LVAentradas(LI) + m.entradas_&Lsc
				LVAvendas(LI) 	= LVAvendas(LI)   + m.vendas_&Lsc
				LVAcasada(LI) 	= LVAcasada(LI)   + m.vdcasada_&Lsc
				LVAgiro(LI)		= LVAgiro(LI) 	  + m.giro_&Lsc
				LVArvendas(LI)	= LVArvendas(LI)  + m.rvvendas_&Lsc
				LVArgiro(LI)	= LVArgiro(LI)    + m.rvgiro_&Lsc
			NEXT

			SELE prvitstq
			=EDITHAND("SAVE")
			m.tp_reg = "2"	&& DEMAIS REGISTROS DO CODIGO=>ALEM DA 1aEMP
			SELE empresa
			SET ORDER TO TAG regiao
			SKIP
		ENDDO
		IF LNctracm  > 0
			m.tipo_reg = "T"
					&& REG. TOTALIZADOR => ULTIMO QDO GRUPO DE EMPRES

			m.filial 	 = 999
			m.regional 	 = QBRregiao

			FOR Ll = 1 to 5
				Lsc = CHR(Ll+64)
    			m.qtdatend_&Lsc = 0
				m.entradas_&Lsc = 0
				m.vendas_&Lsc 	= 0
				m.vdcasada_&Lsc	= 0
				m.rvvendas_&Lsc	= 0
				m.giro_&Lsc		= 0
				m.rvgiro_&Lsc	= 0
****	    	m.qtd_dias_&Lsc = 0
				m.semstq_&Lsc 	= 0
			NEXT

			FOR LI = 1 to 5
				Lsc = CHR(LI+64)
    			m.qtdatend_&Lsc = LVAqtdatend(LI)
				m.entradas_&Lsc = LVAentradas(LI)
				m.vendas_&Lsc 	= LVAvendas(LI)
				m.vdcasada_&Lsc = LVAcasada(LI)
				m.rvvendas_&Lsc	= LVArvendas(LI)
				m.giro_&Lsc		= LVAgiro(LI)
				m.rvgiro_&Lsc	= LVArgiro(LI)
			NEXT

			m.saldo		 = LAsaldo		
			m.giromedio  = LAgiromed
			m.rvgiromedi = LArvgiromed

			m.sugestao_A = LAsug_var
			m.sugestao_B = LAsug_rev
			m.sugestao_C = LAsug_saz

*			m.pedir 	 = LAsug_rev
			m.pedir 	 = 0	&& PEDIR SERA DEFINIDO PELO USUARIO

			m.prvvenda_A	= LAvdprv_V
			m.prvvenda_B	= LAvdprv_R
			m.prvvenda_C	= LAvdprv_S

			m.media_perm = LAmediaperm
			m.pedidotran = LApedidotran
			m.pedidopfat = LApedidopfat
			m.gatilho 	 = LAgatilho

***			m.codforn	 = 0

			*<<<<  DEFINE A NESCESSIDADE DO ESTOQUE ATE O DIA DESEJADO
			*******************************************************

			SELE prvitstq
			=EDITHAND("SAVE")
		
		ENDIF
		SELE empresa
	ENDDO
	SELE grupo
	SET ORDER TO TAG ordem
	SKIP
ENDDO

**************************************************************
* INFORMA OS DIAS EM QUE ESTAO ATUALIZADOS OS SALDOS		  *
**************************************************************

	m.dgyn = ULatunf(1,prvcbstq.data)
	m.dsia = ULatunf(2,prvcbstq.data)
	m.dw3  = ULatunf(3,prvcbstq.data)
	m.dbgs = ULatunf(4,prvcbstq.data)
	m.dipg = ULatunf(5,prvcbstq.data)
	m.dcgb = ULatunf(6,prvcbstq.data)
	m.darg = ULatunf(8,prvcbstq.data)
	m.didp = 0
	**************************************************************
	SET NEAR OFF
	SELE prvcbstq
	=REGLOCK(.T.)
	GATHER MEMVAR FIELDS dgyn,dsia,dw3,dbgs,dipg,dcgb,darg,didp	

DO RELFIM.PRG          && FIM VAR P/ TERMOMETRO


**** PROCESSAR A JUNCAO DAS SUGESTOES DOS ITENS ANEXADOS ****

	DO ULanexa WITH LNempr,LNnro

****

RETURN

**>>>>


****************************  RELATORIO ****************************

PROCEDURE ULimp
PARAMETER LNcons,LNemp,LNnro
	************************************************************
	PRIVATE wl_arqtmp
	PRIVATE LNtmp
	PRIVATE LNreginicio, LNregfinal
	PRIVATE LSorienta
	***********************************************************

	ON ERROR	
	SELE fornece
	SET ORDER TO TAG codigo
	SELE GRUPO
	SET ORDER TO TAG classifica
	SELECT  prvitstq

	IF LNcons = 4
		SET ORDER TO TAG separaforn
	ELSE
		SET ORDER TO TAG ordena
	ENDIF

	SET NEAR ON
	SEEK STR(LNemp,3)+STR(LNnro,6)
	SET NEAR OFF

	wl_arqtmp = "prvitstq"

	IF LNcons = 4
		*********************************************************	
		wl_arqtmp = ""
		LNtmp     = 65		&& TABELA ASCII A = 65
		IF !UPabretmp("tmp")
			wp_flgfecha = .t.
		ENDIF
		IF wp_flgfecha
			RETURN
		ENDIF
		SET SAFET OFF
		LStmp = "&wp_dirtmp"+"&wl_arqtmp"

		SELE prvitstq
		COPY STRU TO &LStmp WITH CDX

		SELE 0
		USE &LStmp  EXCL
		*******************
		SELE prvitstq
		SCATTER MEMVAR
		LNreginicio = RECNO()
		LNregfinal  = RECNO()
		LNpedir	= 	0
		DO WHILE !EOF() AND prvcbstq.numero  = prvitstq.numero ;
						AND prvcbstq.empresa = prvitstq.empresa
		
			MSG = ALIAS()+STR(prvitstq.ordem,6)
			WAIT WINDOW MSG NOWAIT
			IF prvitstq.tipo_reg <> "T"
				SKIP
				LOOP
			ENDIF
		
			IF prvitstq.pedir > 0
				SCATTER MEMVAR
				SELE &wl_arqtmp
				=edithand('SAVE')
			ENDIF
			SELE prvitstq
			SKIP
		ENDDO
		SELE &wl_arqtmp
		GO TOP
	ENDIF
	*******************
	*---->   (INICIALIZACAO DO CONTROLE DE STATUS IMPRESSAO)
	*******************	
	SELE &wl_arqtmp

	DO RELINIC.PRG          && INICIA VAR P/ TERMOMETRO

	LFsegue = .t.
	LNregistro = RECNO()

	IF LNcons = 4
	*******************	
		COUNT TO LNimpressao
	ELSE
		COUNT WHILE     LNemp = prvitstq.empresa  ;
				AND LNnro  = prvitstq.numero TO LNimpressao

	ENDIF
	LNimpressos = 0
	IF EOF() AND BOF()
		GO TOP
	ELSE
		GO LNregistro
	ENDIF
	*******************
	*---->   (COMPLETADO PREPARACAO DO CONTROLE DE STATUS IMPRESSAO)
	*******************	
	SET RELATION TO  classifica INTO grupo
	SET RELATION TO  codforn	INTO fornece ADDITIVE

	**************************>>> REGISTRO DE SAIDAS
	LSorienta  = " "          && fornece as condicoe de impressao
	LSorienta = ;
		    "   WHILE prvcbstq.empresa = prvitstq.empresa "+;
		    "   AND   prvcbstq.numero  = prvitstq.numero  AND LFsegue "
	DO CASE
		CASE LNcons = 1

			IF "010" $ m.filiais
				LSrel = "REL800H2"  && relatorio padrao p/ impr ex: epson
			else
				LSrel = "REL800H"   && relatorio padrao p/ impr ex: epson
			endif
		CASE LNcons = 2
			LSrel = "REL800B"   && relatorio padrao p/ impressoras ex: epson
		CASE LNcons = 3
			LSrel = "REL800F"   && relatorio padrao p/ impressoras ex: epson
		CASE LNcons = 4
			LSorienta = ;
			    "   WHILE prvcbstq.empresa = empresa "+;
		    	"   AND   prvcbstq.numero  = numero  AND LFsegue "
			LSrel = "REL800G"   && relatorio padrao p/ impressoras ex: epson
			SET ORDER TO TAG separaforn
		CASE LNcons = 5
			LSrel = "REL800D"  && relatorio padrao p/ impressoras ex: epson
		CASE LNcons = 6
			LSrel = "REL800I"  && relatorio padrao p/ impressoras ex: epson
			LSorienta  = " "          && fornece as condicoe de impressao
		CASE LNcons = 7
			LSrel = "REL800c"  && relatorio padrao p/ impressoras ex: epson

	ENDCASE
	DO UPimpressao    && COORDENA TRABALHO DE IMPRESSAO
	**********
	***********
	DO RELFIM.PRG          && FIM VAR P/ TERMOMETRO
	*-----------------------------
	SET RELATION TO
RETURN


******************************************************************
*      ULanexa = Apos fazer a previsao normal esta rotina e
*				ativada para somar as sugestoes dos itens anexados
*				ao item pincipal e zerar a sugestao do anexado
*					A rotina procede :
*						-Varre o arquivo GRUPOANX pelo codigo anexado
*						-Determina o CODIGO princial p/ receber sugestao
*						-Passa a processao a previsao PRVITSTQ
*						-Posicionapela chave ORDENA no codigo anexado
*							- Captuta sugestao
*							- Zera sugestao
*						-Posiciona no CODIGO principal equivalendo
*							-REGIONAL
*							-FILIAL
*						-Soma a quantidade do item anexado
*******************************************************************	
PROCEDURE ULanexa
	PARAMETERS LNemp, LNnumero

	PRIVATE LNmarcareg, LNordprinc,LNordanexo,LNsugestao
	PRIVATE LSconta,LNctr

	SELE grupoanx
	LSconta 	= STR(RECCOUNT(),5)
	LNctr 		= 1
	SET ORDER TO TAG clasanx
	GO TOP
	
	DO WHILE !EOF()
		wp_msg	=  STR(LNctr,5)+"    "+LSconta

		WAIT WINDOW wp_msg NOWAIT

		SELE prvitstq
		SET ORDER TO TAG codigo
		SEEK STR(LNemp,3)+STR(LNnumero,6)+grupoanx.codigo
		IF FOUND()
			LNordprinc = prvitstq.ordem &&P/COMPOR CHAVE DO CODIGO PRINCIPAL
			SEEK STR(LNemp,3)+STR(LNnumero,6)+grupoanx.codanx
			IF FOUND()
				LNordanexo = prvitstq.ordem &&P/COMPOR CHV CDGO ANEXADO
				SET ORDER TO TAG ordena
				SET NEAR ON		&& POSICIONA NO 1o REGISTRO DA ORDEM				
				SEEK STR(LNemp,3)+STR(LNnumero,6)+STR(LNordanexo,5)
				SET NEAR OFF
				DO WHILE !EOF() AND grupoanx.codanx = prvitstq.codigo
					LNmarcareg	= RECNO()
									&& NRO PARA RETORNAR E CONTINUAR SKIP
									&& DEPOIS DO DESPOSICIONAMENTO NA LEI
									&& TURA DO REGISTRO EQUIVALENTE DO
									&& CODIGO PRINCIPAL
					LNsugestao  = prvitstq.sugestao_b
					SEEK STR(LNemp,3)+STR(LNnumero,6)+STR(LNordprinc,5)+;
						 STR(prvitstq.regional,2)+STR(prvitstq.filial,3)
					IF FOUND()
						=REGLOCK(.T.)																	
						REPLACE prvitstq.sugestao_b ;
									WITH prvitstq.sugestao_b + LNsugestao
						LNsugestao	= 0 && P/ ZERAR SUGESTAO DO ANEXO
					ENDIF
					SELE prvitstq
					GO LNmarcareg
					=REGLOCK(.T.)																	
					REPLACE prvitstq.sugestao_b WITH LNsugestao
					SKIP
				ENDDO
			ENDIF
		ENDIF
		LNctr 		= 	LNctr + 1
		SELE grupoanx
		SKIP
	ENDDO

	WAIT WINDOW " OK ! " NOWAIT
	SELE prvcbstq
RETURN


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4K30WB51R           m.numero WHEN                      º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC800,     Record Number:   51   º
*       º Variable:            m.numero                           º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Field                              º
*       º Snippet Number:      1                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4k30wb51r     &&  m.numero WHEN
#REGION 1
ON KEY LABEL ENTER

RETURN(isreading or isadding)

*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4K30WB51S           m.numero VALID                     º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC800,     Record Number:   51   º
*       º Variable:            m.numero                           º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Field                              º
*       º Snippet Number:      2                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4k30wb51s     &&  m.numero VALID
#REGION 1
SELE prvcbstq
SET ORDER TO TAG ordena
SET NEAR ON
SEEK STR(m.empresa,3)+STR(m.numero,6)
SET NEAR OFF

RETURN(UPtratachv())


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4K30WB51T           m.operador VALID                   º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC800,     Record Number:   52   º
*       º Variable:            m.operador                         º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Field                              º
*       º Snippet Number:      3                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4k30wb51t     &&  m.operador VALID
#REGION 1
SELECT usuario
SET ORDER TO TAG usuario
IF LASTKEY() = 9
   ON KEY LABEL ESCAPE
   DO loc_dlog
    ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
   IF LASTKEY() = 27
		SELECT pedido
		RETURN .F.
	ENDIF
ELSE
	SET ORDER TO TAG usuario
	IF !SEEK(m.operador)
		SELECT prvcbstq
		RETURN .F.
	ENDIF
ENDIF

SCATTER MEMVAR FIELDS nome MEMO
m.operador	 = usuario.usuario
m.nomeusr	 = usuario.nome
SELECT prvcbstq
SHOW GET m.operador
SHOW GET m.nomeusr

RETURN .T.


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4K30WB51U           m.data WHEN                        º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC800,     Record Number:   54   º
*       º Variable:            m.data                             º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Field                              º
*       º Snippet Number:      4                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4k30wb51u     &&  m.data WHEN
#REGION 1
IF isadding
   data = wp_dtoper
ENDIF
SHOW GET m.data
RETURN(isadding)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4K30WB51V           m.data VALID                       º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC800,     Record Number:   54   º
*       º Variable:            m.data                             º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Field                              º
*       º Snippet Number:      5                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4k30wb51v     &&  m.data VALID
#REGION 1
m.qtd_dias_a 	= 180
m.qtd_dias_b	= 90
m.qtd_dias_c	= 45
m.qtd_dias_d	= 25
m.qtd_dias_e	= 15



RETURN(.T.)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4K30WB534           m.prover_ate WHEN                  º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC800,     Record Number:   55   º
*       º Variable:            m.prover_ate                       º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Field                              º
*       º Snippet Number:      6                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4k30wb534     &&  m.prover_ate WHEN
#REGION 1
IF isadding
   m.prover_ate = wp_dtoper
ENDIF
SHOW GET m.prover_ate
RETURN(isadding)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4K30WB539           m.prover_ate VALID                 º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC800,     Record Number:   55   º
*       º Variable:            m.prover_ate                       º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Field                              º
*       º Snippet Number:      7                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4k30wb539     &&  m.prover_ate VALID
#REGION 1
m.em_dias=ULdias_ut(m.data,m.prover_ate)
SHOW GET m.em_dias	
RETURN(.T.)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4K30WB53F           m.variacao WHEN                    º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC800,     Record Number:   57   º
*       º Variable:            m.variacao                         º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Field                              º
*       º Snippet Number:      8                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4k30wb53f     &&  m.variacao WHEN
#REGION 1
ON KEY LABEL ENTER
RETURN(isediting)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4K30WB53L           m.filiais WHEN                     º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC800,     Record Number:   58   º
*       º Variable:            m.filiais                          º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Field                              º
*       º Snippet Number:      9                                  º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4k30wb53l     &&  m.filiais WHEN
#REGION 1
ON KEY LABEL ENTER
RETURN(isediting)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4K30WB53M           m.filiais VALID                    º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC800,     Record Number:   58   º
*       º Variable:            m.filiais                          º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Field                              º
*       º Snippet Number:      10                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4k30wb53m     &&  m.filiais VALID
#REGION 1
if lastkey() = 9
	SELECT empresa
	do obj_empr.spr WITH m.filiais
	if lastkey() != 27
	   m.filiais  = wp_retorno(1)
	endif
endif
show get m.filiais


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4K30WB53N           m.Perfil_01 WHEN                   º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC800,     Record Number:   59   º
*       º Variable:            m.Perfil_01                        º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Popup                              º
*       º Snippet Number:      11                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4k30wb53n     &&  m.Perfil_01 WHEN
#REGION 1
if isediting
	ON KEY LABEL ENTER KEYBOARD "{RIGHTARROW}"
ENDIF
	
RETURN(isediting)

*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4K30WB53O           m.Perfil_01 VALID                  º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC800,     Record Number:   59   º
*       º Variable:            m.Perfil_01                        º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Popup                              º
*       º Snippet Number:      12                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4k30wb53o     &&  m.Perfil_01 VALID
#REGION 1
ON KEY LABEL ENTER
RETURN(.t.)

*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4K30WB53P           m.controles WHEN                   º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC800,     Record Number:   60   º
*       º Variable:            m.controles                        º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Field                              º
*       º Snippet Number:      13                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4k30wb53p     &&  m.controles WHEN
#REGION 1
ON KEY LABEL ENTER
ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
RETURN(isediting)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4K30WB53Q           m.controles VALID                  º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC800,     Record Number:   60   º
*       º Variable:            m.controles                        º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Field                              º
*       º Snippet Number:      14                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4k30wb53q     &&  m.controles VALID
#REGION 1
IF LASTKEY() = 13 OR LASTKEY() = 27 OR LASTKEY() = 15
	RETURN(.T.)
ENDIF
SELECT tab001
IF LASTKEY() = 9
   ON KEY LABEL ESCAPE
   DO loc_dlog WITH .T., "tab001.tabela = 'TPC'"
   ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
   SELECT grupo
   IF LASTKEY() = 27
      RETURN .F.
   ENDIF
   m.controles = ALLTRIM(m.controles)+(tab001.codigo)+"/"
   SHOW GET m.controles
ENDIF
SELECT grupo
KEYBOARD CHR(13)
RETURN(-1)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4K30WB53R           m.codinicio WHEN                   º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC800,     Record Number:   61   º
*       º Variable:            m.codinicio                        º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Field                              º
*       º Snippet Number:      15                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4k30wb53r     &&  m.codinicio WHEN
#REGION 1
ON KEY LABEL ENTER
ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
RETURN(isediting or isreading)

*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4K30WB54R           m.codinicio VALID                  º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC800,     Record Number:   61   º
*       º Variable:            m.codinicio                        º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Field                              º
*       º Snippet Number:      16                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4k30wb54r     &&  m.codinicio VALID
#REGION 1
SELE grupo
SET ORDER TO TAG ordem

IF EMPTY(m.codinicio) AND LASTKEY() <> 9
	GO TOP
	m.ordinicio	  = 1	
	m.clasinicio  = grupo.CLASSIFICA
	m.descinicio  =   "PRIMEIRO"
	SHOW GET  m.descinicio
	RETURN(.T.)
ENDIF
SELE grupo
SET ORDER TO TAG codigo
SET NEAR ON
SEEK ALLTRIM(m.codinicio)
SET NEAR OFF
*----------------------------------------------------------*
SELECT grupo
ON KEY LABEL ESCAPE
IF LASTKEY() = 9
	SET ORDER TO TAG ordem
	ON KEY LABEL ESCAPE
	DO loc_dlog WITH .T.
	ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
	IF LASTKEY() = 27
		RETURN .F.
	ENDIF
ENDIF
m.codinicio  = grupo.codigo
m.clasinicio = grupo.classifica
m.descinicio = grupo.descricao
m.ordinicio	 = grupo.ordem
*******
SHOW GET  m.descinicio
RETURN .t.


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4K30WB54X           m.codfim WHEN                      º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC800,     Record Number:   62   º
*       º Variable:            m.codfim                           º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Field                              º
*       º Snippet Number:      17                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4k30wb54x     &&  m.codfim WHEN
#REGION 1
ON KEY LABEL ENTER
ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
RETURN(isediting or isreading)

*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4K30WB553           m.codfim VALID                     º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC800,     Record Number:   62   º
*       º Variable:            m.codfim                           º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Field                              º
*       º Snippet Number:      18                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4k30wb553     &&  m.codfim VALID
#REGION 1
SELE grupo
SET ORDER TO TAG ordem
IF EMPTY(m.codfim) AND LASTKEY() <> 9
	GO BOTT
	m.clasfim 	= 	alltrim(grupo.classifica)+REPL("9",15)
	m.descfim   =   "ULTIMO"
	m.ordfim    =   99999999
	SHOW GET  m.descfim
	RETURN(.T.)
ENDIF
SELE grupo
SET ORDER TO TAG codigo
SET NEAR ON
SEEK ALLTRIM(m.codfim)
SET NEAR OFF
*----------------------------------------------------------*
SELECT grupo
ON KEY LABEL ESCAPE
IF LASTKEY() = 9
	SET ORDER TO TAG ordem
	ON KEY LABEL ESCAPE
	DO loc_dlog WITH .T.
	ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
	IF LASTKEY() = 27
		RETURN .F.
	ENDIF
ENDIF
m.codfim  = grupo.codigo
m.clasfim = grupo.classifica
m.descfim = grupo.descricao
m.ordfim  = grupo.ordem
*******
*******
SHOW GET  m.descfim
RETURN .t.


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4K30WB554           it_btn VALID                       º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC800,     Record Number:   63   º
*       º Variable:            it_btn                             º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      19                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4k30wb554     &&  it_btn VALID
#REGION 1
DO ULitens


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4K30WB555           pb2_btn VALID                      º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC800,     Record Number:   64   º
*       º Variable:            pb2_btn                            º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      20                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
***********************************************************************
*  UPprevegrava : Recebe os parametros de processamento para gerar os
*				registros em PRVITSTQ.
*
***********************************************************************
FUNCTION _4k30wb555     &&  pb2_btn VALID
#REGION 1
IF !fox_alert('Confirma Processo de Previsao ?')
   RETURN
ENDIF


=W_DEFPROC("PEDIDO.SPR")


CrsPedir = PDPedir(M.ordinicio, m.ordfim,;
                   m.controles,m.em_dias,;
                   m.Perfil_01)


SHOW WINDOW NAVEGA TOP
SHOW WINDOW SCGC800 TOP


=UP_fecha(CrsPedir)
					
RETURN					



PROCEDURE ULPDNvImp
	************************************************************
	PRIVATE LNtmp
	PRIVATE LNreginicio, LNregfinal
	PRIVATE LSorienta
	***********************************************************

	ON ERROR	
	*******************
	*---->   (INICIALIZACAO DO CONTROLE DE STATUS IMPRESSAO)
	*******************	

    IF USED(CrsPedir)
       SELE &CrsPedir
       USE
    ENDIF


	SELE 0
	USE &CrsPedir

	DO RELINIC.PRG          && INICIA VAR P/ TERMOMETRO

	LFsegue = .t.
	LNregistro = RECNO()

	COUNT TO LNimpressao
	LNimpressos = 0
	IF EOF() AND BOF()
		GO TOP
	ELSE
		GO LNregistro
	ENDIF
	*******************
	*---->   (COMPLETADO PREPARACAO DO CONTROLE DE STATUS IMPRESSAO)
	*******************	

	**************************>>> REGISTRO DE SAIDAS
	LSorienta  = " "          && fornece as condicoe de impressao
	LSorienta =  "   WHILE  LFsegue "
	IF "010" $ m.filiais
			LSrel = "REL800a3"  && relatorio padrao p/ impr ex: epson
		else
			** LSrel = "REL800a2"   && relatorio padrao p/ impr ex: epson
			LSrel = "REL800a4"   && relatorio padrao p/ impr ex: epson
	endif


	DO UPimpressao    && COORDENA TRABALHO DE IMPRESSAO
	**********
	***********
	DO RELFIM.PRG          && FIM VAR P/ TERMOMETRO
	*-----------------------------
	SET RELATION TO
	SHOW WINDOW NAVEGA TOP
	SHOW WINDOW SCGC800 TOP

RETURN


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4K30WB556           IMP1_btn VALID                     º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC800,     Record Number:   65   º
*       º Variable:            IMP1_btn                           º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      21                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
	************************************************************
FUNCTION _4k30wb556     &&  IMP1_btn VALID
#REGION 1
	PRIVATE LNtmp
	PRIVATE LNreginicio, LNregfinal
	PRIVATE LSorienta
	***********************************************************

	ON ERROR	
	*******************
	*---->   (INICIALIZACAO DO CONTROLE DE STATUS IMPRESSAO)
	*******************	





    IF EMPTY(CrsPedir)
		CrsPedir = "L:\TMP\CRSPed.dbf"
	ENDIF


    IF  !FILE(CrsPedir)
		RETURN
	ENDIF

    IF USED(ALSPedir)
       SELE &ALSPedir
	ELSE
		SELE 0
		USE &CrsPedir
		ALSPedir = ALIAS()
    ENDIF




	DO RELINIC.PRG          && INICIA VAR P/ TERMOMETRO

	LFsegue = .t.
	LNregistro = RECNO()

	COUNT TO LNimpressao
	LNimpressos = 0
	IF EOF() AND BOF()
		GO TOP
	ELSE
		GO LNregistro
	ENDIF
	*******************
	*---->   (COMPLETADO PREPARACAO DO CONTROLE DE STATUS IMPRESSAO)
	*******************	

	**************************>>> REGISTRO DE SAIDAS
	LSorienta  = " "          && fornece as condicoe de impressao
	LSorienta =  "   WHILE  LFsegue "

	LSrel = "REL800a5"   && relatorio padrao p/ impr ex: epson


	DO UPimpressao    && COORDENA TRABALHO DE IMPRESSAO
	**********
	***********
	DO RELFIM.PRG          && FIM VAR P/ TERMOMETRO
	*-----------------------------
	SET RELATION TO
	SHOW WINDOW NAVEGA TOP
	SHOW WINDOW SCGC800 TOP




	=UP_fecha(CrsPedir)

RETURN

*--------------------------------------------------------------*
* TEXRO ANTIDO VINCULADO AO BOTAO
* \<5-Imp.Sugestao de Compra
PROCEDURE OLDFGGGG

	PRIVATE LFimp_Negativo

	LFimp_Negativo = .F.		
			&& .T. => IMPRIMIR SUGESTAO NEGATIVA OU SOBRA
			&& .F. => NAO IMPRIMIR SUGESTAO NEGATIVA OU SOBRA

	IF !fox_alert('Confirma a Impressao ?')
	   RETURN
	ENDIF

	LFimp_Negativo = ;
		fox_alert('Deseja Impimir Sugestao Negativa - (Sobra) ?')


	DO ULimp WITH 1,m.empresa,m.numero

	SHOW WINDOW NAVEGA TOP
	SHOW WINDOW SCGC800 TOP
RETURN


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4K30WB557           ver_btn VALID                      º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC800,     Record Number:   66   º
*       º Variable:            ver_btn                            º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      22                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*


	************************************************************
FUNCTION _4k30wb557     &&  ver_btn VALID
#REGION 1
	PRIVATE LNtmp
	PRIVATE LNreginicio, LNregfinal
	PRIVATE LSorienta
	***********************************************************

	ON ERROR	
	*******************
	*---->   (INICIALIZACAO DO CONTROLE DE STATUS IMPRESSAO)
	*******************	



    IF EMPTY(CrsPedir)
		CrsPedir = "L:\TMP\CRSPed.dbf"
	ENDIF


    IF  !FILE(CrsPedir)
		RETURN
	ENDIF


    IF USED(ALSPedir)
       SELE &ALSPedir
	ELSE
		SELE 0
		USE &CrsPedir
		ALSPedir = ALIAS()
    ENDIF


	DO RELINIC.PRG          && INICIA VAR P/ TERMOMETRO

	LFsegue = .t.
	LNregistro = RECNO()

	COUNT TO LNimpressao
	LNimpressos = 0
	IF EOF() AND BOF()
		GO TOP
	ELSE
		GO LNregistro
	ENDIF
	*******************
	*---->   (COMPLETADO PREPARACAO DO CONTROLE DE STATUS IMPRESSAO)
	*******************	

	**************************>>> REGISTRO DE SAIDAS
	LSorienta  = " "          && fornece as condicoe de impressao
	LSorienta =  "   WHILE  LFsegue "
	LSrel = "REL800a6"   && relatorio padrao p/ impr ex: epson


	DO UPimpressao    && COORDENA TRABALHO DE IMPRESSAO
	**********
	***********
	DO RELFIM.PRG          && FIM VAR P/ TERMOMETRO
	*-----------------------------
	SET RELATION TO
	SHOW WINDOW NAVEGA TOP
	SHOW WINDOW SCGC800 TOP




	=UP_fecha(CrsPedir)

RETURN

**************************************************************

* ANTIGO TITULO DO BOTAO
* \<6-Proc.Verificacao Prev X Real

PROCEDURE ONFFF
PRIVATE	LDdtinicio,LNdiassld, LNqtvenda,LNqtacm,LNctrdia
PRIVATE LNqtentra,LDdtfimsld,LNacmentra
PRIVATE LNsldini
IF !fox_alert('Confirma a Processo de Verificacao ?.')
   RETURN
ENDIF

IF !REGLOCK()
   WAIT WINDOW "Documento nao poder ser bloqueado para o processo."
   RETURN
ENDIF

SELE itemmov
SET ORDER TO  TAG movimento

SELECT  prvitstq
SET ORDER TO TAG ordena
SET NEAR ON
SEEK STR(m.empresa,3)+STR(m.numero,6)
SET NEAR OFF


*---->  POSICIONA ARQUIVOS RELACIONADOS
*******************
*---->   (INICIALIZACAO DO CONTROLE DE STATUS IMPRESSAO)
*******************	
DO RELINIC.PRG          && INICIA VAR P/ TERMOMETRO

LFsegue = .t.
LNregistro = RECNO()

COUNT WHILE m.empresa = prvitstq.empresa AND  ;
			m.numero  = prvitstq.numero TO LNimpressao

LNimpressos = 0
GO LNregistro
*******************
*---->   (COMPLETADO PREPARACAO DO CONTROLE DE STATUS IMPRESSAO)
*******************	
SET RELATION TO


LDdtinicio = m.data 		 && acumular vendas do dia
							 	 &&seguinte em diante
LScodqbr   = prvitstq.codigo && marcar quebra quando nao houver registro
							 && acumulador => filial = 999
LNqtacm	   = 0
LNacmentra = 0

DO WHILE !EOF() AND m.empresa = prvitstq.empresa ;
				AND m.numero  = prvitstq.numero AND LFsegue

	=UPtermo()		
	=REGLOCK(.T.)

	*<<<<<<<<<<<<<<< VERIFICACAO DA VENDA REAL >>>>>>>>>>>>>>>>>>
	* -Considera os dias para os quais foi feita a previsao =>
	*  Nao considera a data base acumulando as vendas apartir do
	*  dia seguinte ate a data de provisao
	*************************************************************

	IF prvitstq.filial = 999	&& GRUPO
		REPLACE prvitstq.verifica WITH LNqtacm	
		REPLACE prvitstq.stqdispo WITH LNacmentra	&& GRAVA A VERIFICACAO
		LNqtacm = 0
		LNacmentra = 0
		SKIP
		LOOP
	ENDIF
	IF prvitstq.codigo <> LScodqbr	&& P/REG PROD. NAO AGRUPADO (FIL=999)
		LNqtacm = 0
		LNacmentra = 0
	ENDIF

	LScodqbr   = prvitstq.codigo && marcar quebra quando nao houver registro
							 	 && acumulador => filial = 999

	LNempresa	= 	prvitstq.filial
	LScodigo	=	prvitstq.codigo
	LSclas		=	prvitstq.classifica
	LDdtini		=	m.data
	LDdtfim		=   m.prover_ate
	LNemdias	=	m.em_dias
	LNqtvenda	=   0
	***************** APURAR SALDO FORMADO ATE METADE DO PERIODO ******
	SET PROCEDURE TO ROTESTOQ.PRG
	LNsldini   = UEsaldo(prvitstq.classifica,prvitstq.codigo,;
						  prvitstq.filial, LDdtinicio-1)
	LNacmentra = LNacmentra + LNsldini
	*******************************************************************
	********************************************************************
	* UEvendas => Processa o movimento de um produto solicitado para  *
	*             determinar a quantidade vendida em um periodo
	********************************************************************

	SET PROCEDURE TO ROTESTOQ.PRG
	Ltmp = 0
	STORE 0 TO LNqtvenda,LNqtentra,Ltmp

	DO UEvendas WITH LNempresa,LSclas,LScodigo,LDdtini,;
						 LDdtfim,LNemdias,LNqtvenda,LNqtentra,Ltmp
	
	LNqtacm = LNqtacm + LNqtvenda
	REPLACE prvitstq.verifica WITH LNqtvenda	&& GRAVA A VERIFICACAO
	REPLACE prvitstq.stqdispo WITH LNqtentra	&& GRAVA A VERIFICACAO
	
	SELE prvitstq
	SKIP
ENDDO
	
DO RELFIM.PRG          && FIM VAR P/ TERMOMETRO
RETURN




*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4K30WB558           IMPY_btn VALID                     º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC800,     Record Number:   67   º
*       º Variable:            IMPY_btn                           º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      23                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
***********************************************************************
*  UPprevegrava : Recebe os parametros de processamento para gerar os
*				registros em PRVITSTQ.
*
***********************************************************************
FUNCTION _4k30wb558     &&  IMPY_btn VALID
#REGION 1
	IF !fox_alert('Confirma Processo de Previsao ?')
	   RETURN
	ENDIF


	=W_DEFPROC("PEDIDO.SPR")


	CrsPedir = PDPedir(M.ordinicio, m.ordfim,;
                   m.controles,m.em_dias,;
                   m.Perfil_01,"POR CIDADE")




	=UP_fecha(CrsPedir)
					



***********************************************************************
*  UPprevegrava : Recebe os parametros de processamento para gerar os
*				registros em PRVITSTQ.
*
***********************************************************************


    IF EMPTY(CrsPedir)
		CrsPedir = "L:\TMP\CRSPed.dbf"
	ENDIF


    IF  !FILE(CrsPedir)
		RETURN
	ENDIF

    IF USED(ALSPedir)
       SELE &ALSPedir
	ELSE
		SELE 0
		USE &CrsPedir
		ALSPedir = ALIAS()
    ENDIF





*	IF !fox_alert('Confirma a Impressao ?')
*	   RETURN
*	ENDIF

	DO  ULduracao

	SHOW WINDOW NAVEGA TOP
	SHOW WINDOW SCGC800 TOP

					
RETURN					


*------------------------------------------------------------------------*

PROCEDURE ULDuracao
	************************************************************
	PRIVATE LNtmp
	PRIVATE LNreginicio, LNregfinal
	PRIVATE LSorienta
	***********************************************************

	ON ERROR	
	*******************
	*---->   (INICIALIZACAO DO CONTROLE DE STATUS IMPRESSAO)
	*******************	

    SELECT * ;
	FROM &CrsPedir ;
	WHERE			;
			    dura_gyn > m.duracao_estq ;
			OR  dura_sia > m.duracao_estq ;
			OR  dura_arg > m.duracao_estq ;
			OR  dura_bgs > m.duracao_estq ;
			OR  dura_cgb > m.duracao_estq ;
			OR  dura_abo > m.duracao_estq ;
    INTO TABLE L:\TMP\GIRO ;
    ORDER BY ORDEM

	=UP_fecha("giro")


	SELE 0
	USE L:\TMP\GIRO

	DO RELINIC.PRG          && INICIA VAR P/ TERMOMETRO

	LFsegue = .t.
	LNregistro = RECNO()

	COUNT TO LNimpressao
	LNimpressos = 0
	IF EOF() AND BOF()
		GO TOP
	ELSE
		GO LNregistro
	ENDIF
	*******************
	*---->   (COMPLETADO PREPARACAO DO CONTROLE DE STATUS IMPRESSAO)
	*******************	

	**************************>>> REGISTRO DE SAIDAS
	LSorienta  = " "          && fornece as condicoe de impressao
	LSorienta =  "   WHILE  LFsegue "

*	LSrel = "REL800c2"  && PRIMEIRA VERSAO POR LOJA

	LSrel = "REL800c6"  && SEGUNDA VERSAO POR CIDADE


	DO UPimpressao    && COORDENA TRABALHO DE IMPRESSAO
	**********
	***********
	DO RELFIM.PRG          && FIM VAR P/ TERMOMETRO
	*-----------------------------
	SET RELATION TO
	SELE GIRO
	USE
	SHOW WINDOW NAVEGA TOP
	SHOW WINDOW SCGC800 TOP

RETURN



*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4K30WB569           m.duracao_estq WHEN                º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC800,     Record Number:   68   º
*       º Variable:            m.duracao_estq                     º
*       º Called By:           WHEN Clause                        º
*       º Object Type:         Field                              º
*       º Snippet Number:      24                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4k30wb569     &&  m.duracao_estq WHEN
#REGION 1
ON KEY LABEL ENTER
ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"

RETURN(isediting)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4K30WB56F           IMP8_btn VALID                     º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC800,     Record Number:   69   º
*       º Variable:            IMP8_btn                           º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      25                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
***********************************************************************
*  UPprevegrava : Recebe os parametros de processamento para gerar os
*				registros em PRVITSTQ.
*
***********************************************************************
FUNCTION _4k30wb56f     &&  IMP8_btn VALID
#REGION 1
IF !fox_alert('Confirma Processo de Anexacao de Previsao ?')
   RETURN
ENDIF
				
DO ULanexa WITH m.empresa,m.numero





*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4K30WB56L           IMP6_btn VALID                     º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC800,     Record Number:   70   º
*       º Variable:            IMP6_btn                           º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      26                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4k30wb56l     &&  IMP6_btn VALID
#REGION 1
	PRIVATE LNordfim

	IF !fox_alert('Confirma a Impressao ?')
	   RETURN
	ENDIF
	
	SELE GRUPO
	SET ORDER TO TAG codigo

	SET NEAR ON
	SEEK m.codfim
	SET NEAR OFF
	LNordfim 	= grupo.ordem

	SET NEAR ON
	SEEK m.codinicio
	SET NEAR OFF

	SET ORDER TO TAG ordem


	DO RELINIC.PRG          && INICIA VAR P/ TERMOMETRO
	LFsegue = .t.
	LNregistro = RECNO()

	COUNT 	FOR 	(STR(grupo.tp_control,1) $ m.controles ;
   			AND grupo.cdg_tipo  = 4) ;
			WHILE grupo.ordem <= LNordfim  TO LNimpressao

	LNimpressos = 0
	GO LNregistro
	*******************
	*---->   (COMPLETADO PREPARACAO DO CONTROLE DE STATUS IMPRESSAO)
	*******************	

	**************************>>> REGISTRO DE SAIDAS
	LSorienta  = " "          && fornece as condicoe de impressao
	LSorienta = ;
			" 	FOR	(STR(grupo.tp_control,1) $ m.controles " +;
			"   AND grupo.cdg_tipo  = 4)  "+;
		    "   WHILE grupo.ordem <= LNordfim  AND LFsegue "

	LSrel = "REL800I"  && relatorio padrao p/ impressoras ex: epson

	DO UPimpressao    && COORDENA TRABALHO DE IMPRESSAO
	**********
	***********
	DO RELFIM.PRG          && FIM VAR P/ TERMOMETRO
	*-----------------------------
	SET RELATION TO
	SELE prvcbstq
	SHOW WINDOW NAVEGA TOP
	SHOW WINDOW SCGC800 TOP
RETURN


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4K30WB56M           IMP4_btn VALID                     º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC800,     Record Number:   71   º
*       º Variable:            IMP4_btn                           º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      27                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4k30wb56m     &&  IMP4_btn VALID
#REGION 1
IF !fox_alert('Confirma a Impressao ?')
   RETURN
ENDIF

DO ULimp WITH 4,m.empresa,m.numero

SHOW WINDOW NAVEGA TOP
SHOW WINDOW SCGC800 TOP


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4K30WB56N           X_btn VALID                        º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC800,     Record Number:   72   º
*       º Variable:            X_btn                              º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      28                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
***********************************************************************
*  UPprevegrava : Recebe os parametros de processamento para gerar os
*				registros em PRVITSTQ.
*
***********************************************************************
FUNCTION _4k30wb56n     &&  X_btn VALID
#REGION 1
IF !fox_alert('Confirma Processo de Previsao ?')
   RETURN
ENDIF

LDdataSaldo =  m.data

=W_DEFPROC("PEDIDO.SPR")

CrsPedir = PDPedir(M.ordinicio, m.ordfim, m.controles,m.em_dias)

IF !fox_alert('Confirma a Impressao ?')
   RETURN
ENDIF

DO  ULSldFiliais

SHOW WINDOW NAVEGA TOP
SHOW WINDOW SCGC800 TOP

					
RETURN					


*------------------------------------------------------------------------*

PROCEDURE ULSldFiliais
	************************************************************
	PRIVATE LNtmp
	PRIVATE LNreginicio, LNregfinal
	PRIVATE LSorienta
	***********************************************************

	ON ERROR	
	*******************
	*---->   (INICIALIZACAO DO CONTROLE DE STATUS IMPRESSAO)
	*******************	

	=UP_fecha("giro")



    SELECT * ,;
		ULsdlData(1,CODIGO,classifica,LDdataSaldo) AS ESTQ_GYN,;
		ULsdlData(5,CODIGO,classifica,LDdataSaldo) AS ESTQ_IPG,;
		ULsdlData(9,CODIGO,classifica,LDdataSaldo) AS ESTQ_IDP,;
		ULsdlData(7,CODIGO,classifica,LDdataSaldo) AS ESTQ_T63,;
		ULsdlData(11,CODIGO,classifica,LDdataSaldo) AS ESTQ_DPO,;
		ULsdlData(2,CODIGO,classifica,LDdataSaldo) AS ESTQ_SIA,;
		ULsdlData(3,CODIGO,classifica,LDdataSaldo) AS ESTQ_W3,;
		ULsdlData(8,CODIGO,classifica,LDdataSaldo) AS ESTQ_ARG,;
		ULsdlData(4,CODIGO,classifica,LDdataSaldo) AS ESTQ_BGS,;
		ULsdlData(6,CODIGO,classifica,LDdataSaldo) AS ESTQ_CGB;
	FROM &CrsPedir ;
    INTO TABLE L:\TMP\GIRO ;
    ORDER BY ORDEM



	=UP_fecha("giro")



	SELE 0
	USE L:\TMP\GIRO

	DO RELINIC.PRG          && INICIA VAR P/ TERMOMETRO

	LFsegue = .t.
	LNregistro = RECNO()

	COUNT TO LNimpressao
	LNimpressos = 0
	IF EOF() AND BOF()
		GO TOP
	ELSE
		GO LNregistro
	ENDIF
	*******************
	*---->   (COMPLETADO PREPARACAO DO CONTROLE DE STATUS IMPRESSAO)
	*******************	

	**************************>>> REGISTRO DE SAIDAS
	LSorienta  = " "          && fornece as condicoe de impressao
	LSorienta =  "   WHILE  LFsegue "
	LSrel = "REL800c4"  && relatorio padrao p/ impressoras ex: epson

	DO UPimpressao    && COORDENA TRABALHO DE IMPRESSAO
	**********
	***********
	DO RELFIM.PRG          && FIM VAR P/ TERMOMETRO
	*-----------------------------
	SET RELATION TO
	SELE GIRO
	USE
	SHOW WINDOW NAVEGA TOP
	SHOW WINDOW SCGC800 TOP

RETURN


FUNCTION ULsdlData
PARAMETERS LNemp,LScod,LSclass,LDdtbase,LNqtde,LNcusto, LShora,;
			LNreserva

	=W_DEFPROC("ESTOQUE.SPR")

RETURN(ESsaldo(LNemp,LScod,LSclass,LDdtbase,LNqtde,LNcusto, LShora,;
				LNreserva)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4K30WB56O           IMP5_btn VALID                     º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC800,     Record Number:   73   º
*       º Variable:            IMP5_btn                           º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      29                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4k30wb56o     &&  IMP5_btn VALID
#REGION 1
IF !fox_alert('Confirma a Impressao ?')
   RETURN
ENDIF

DO ULimp WITH 5,m.empresa,m.numero

SHOW WINDOW NAVEGA TOP
SHOW WINDOW SCGC800 TOP



*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4K30WB56P           IMP2_btn VALID                     º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC800,     Record Number:   74   º
*       º Variable:            IMP2_btn                           º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      30                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
***********************************************************************
*  UPprevegrava : Recebe os parametros de processamento para gerar os
*				registros em PRVITSTQ.
*
***********************************************************************
FUNCTION _4k30wb56p     &&  IMP2_btn VALID
#REGION 1
IF !fox_alert('Confirma Processo de Previsao ?')
   RETURN
ENDIF


=W_DEFPROC("PEDIDO.SPR")

CrsPedir = PDPedir(M.ordinicio, m.ordfim, m.controles,m.em_dias)

IF !fox_alert('Confirma a Impressao ?')
   RETURN
ENDIF

DO  ULRegiaoduracao

SHOW WINDOW NAVEGA TOP
SHOW WINDOW SCGC800 TOP

					
RETURN					


*------------------------------------------------------------------------*

PROCEDURE ULRegiaoDuracao
	************************************************************
	PRIVATE LNtmp
	PRIVATE LNreginicio, LNregfinal
	PRIVATE LSorienta
	***********************************************************

	ON ERROR	
	*******************
	*---->   (INICIALIZACAO DO CONTROLE DE STATUS IMPRESSAO)
	*******************	

    SELECT * ,;
		ULRgDura((DSPN_Gyn+DSPN_Ipg+DSPN_Idp+DSPN_DPO+DSPN_T63),;
		          Gro_Gyn+Gro_Ipg+Gro_Idp+Gro_T63) AS dura_RGgyn,;
		ULRgDura((DSPN_Sia+DSPN_W3),Gro_Sia+dura_W3) AS dura_RGSia,;
		ULRgDura((DSPN_Anp),Gro_Anp) AS dura_RGAnp,;
		ULRgDura((DSPN_Bgs),Gro_Bgs) AS dura_RGBgs,;
		ULRgDura((DSPN_Cgb),Gro_Cgb) AS dura_RGCgb,;
		ULRgDura((DSPN_Arg),Gro_Arg) AS dura_RGArg;
	FROM &CrsPedir ;
    INTO TABLE L:\TMP\GIRO1 ;
    ORDER BY ORDEM

	=UP_fecha("giro1")

    SELECT * ;
	FROM L:\TMP\GIRO1 ;
	WHERE			;
			  dura_RGGyn > 200 ;
			OR  dura_RGSia > 200 ;
			OR  dura_RGarg > 200 ;
			OR  dura_RGbgs > 200 ;
			OR  dura_RGanp > 200 ;
			OR  dura_RGcgb > 200 ;
    INTO TABLE L:\TMP\GIRO ;
    ORDER BY ORDEM


	=UP_fecha("giro")


	SELE 0
	USE L:\TMP\GIRO

	DO RELINIC.PRG          && INICIA VAR P/ TERMOMETRO

	LFsegue = .t.
	LNregistro = RECNO()

	COUNT TO LNimpressao
	LNimpressos = 0
	IF EOF() AND BOF()
		GO TOP
	ELSE
		GO LNregistro
	ENDIF
	*******************
	*---->   (COMPLETADO PREPARACAO DO CONTROLE DE STATUS IMPRESSAO)
	*******************	

	**************************>>> REGISTRO DE SAIDAS
	LSorienta  = " "          && fornece as condicoe de impressao
	LSorienta =  "   WHILE  LFsegue "
	*LSrel = "REL800c3"  && relatorio padrao p/ impressoras ex: epson
	LSrel = "REL800c5"  && relatorio padrao p/ impressoras ex: epson

	DO UPimpressao    && COORDENA TRABALHO DE IMPRESSAO
	**********
	***********
	DO RELFIM.PRG          && FIM VAR P/ TERMOMETRO
	*-----------------------------
	SET RELATION TO
	SELE GIRO
	USE
	SHOW WINDOW NAVEGA TOP
	SHOW WINDOW SCGC800 TOP

RETURN

FUNCTION ULRgDura
PARAMETERS PrmSaldo,PrmGiro
Private LNDura
	DO CASE
		CASE PrmGiro = 0
			IF PrmSaldo > 0
				LNDura   = 999
			ELSE
				LNDura   = 0
			ENDIF		
		OTHERWISE
			LNDura   = PrmSaldo / PrmGiro
			IF LNDura > 999
				LNDura   = 999
			ENDIF				
	ENDCASE
RETURN(LNDura)


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4K30WB56Q           IMP3_btn VALID                     º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC800,     Record Number:   75   º
*       º Variable:            IMP3_btn                           º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      31                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4k30wb56q     &&  IMP3_btn VALID
#REGION 1
DO ULimp WITH 3,m.empresa,m.numero


*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4K30WB57P           pb_btn VALID                       º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC800,     Record Number:   76   º
*       º Variable:            pb_btn                             º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      32                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
***********************************************************************
*  UPprevegrava : Recebe os parametros de processamento para gerar os
*				registros em PRVITSTQ.
*
***********************************************************************
FUNCTION _4k30wb57p     &&  pb_btn VALID
#REGION 1
IF !fox_alert('Confirma Processo de Previsao ?')
   RETURN
ENDIF

DO UPregprevisao WITH ;
		 m.empresa,m.numero,m.clasinicio,m.clasfim,m.controles,;
		 m.filiais,m.data,180,90,45,25,15,m.em_dias,m.variacao,"NORMAL"
				





*       ÖÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ·
*       º                                                         º
*       º _4K30WB57V           IMP7_btn VALID                     º
*       º                                                         º
*       º Function Origin:                                        º
*       º                                                         º
*       º From Platform:       MS-DOS                             º
*       º From Screen:         SCGC800,     Record Number:   77   º
*       º Variable:            IMP7_btn                           º
*       º Called By:           VALID Clause                       º
*       º Object Type:         Push Button                        º
*       º Snippet Number:      33                                 º
*       º                                                         º
*       ÓÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ½
*
FUNCTION _4k30wb57v     &&  IMP7_btn VALID
#REGION 1
IF !fox_alert('1a Confirmacao do Processo p/ Gerar Pedido ?')
   RETURN
ENDIF

LNemp		= 	m.empresa
LNnro		=	m.numero
LNregional	=	0
LNpedido	=	0
LNforn		=	0
LNcondicao	=	1

DO OBJ_800B.SPR WITH LNregional,LNpedido,LNforn,LNcondicao

IF !fox_alert('2a Confirmacao do  Processo p/ Gerar Pedido ?')
   RETURN
ENDIF

SELE prvitstq
SET ORDER TO TAG separaforn
SET NEAR ON
SEEK STR(LNemp,3)+STR(LNnro,6)+STR(LNforn,5)
SET NEAR OFF

IF  LNemp <> prvitstq.empresa;
	OR LNnro <> prvitstq.numero;
	OR LNforn <> prvitstq.codforn;
	WAIT WINDOW " Nao existem registros p/ Fornecedor informado."
	SELE prvcbstq
	RETURN
ENDIF

DO WHILE !EOF() AND LNemp = prvitstq.empresa;
				AND LNnro = prvitstq.numero;
				AND LNforn= prvitstq.codforn
		IF prvitstq.tipo_reg <> "T"
			SKIP
			LOOP
		ENDIF
		IF prvitstq.regional <>  LNregional
			SKIP
			LOOP
		ENDIF
		IF prvitstq.pedir =  0
			SKIP
			LOOP
		ENDIF

		****** POSICIONA NO 1o ITEM COM PEDIDO 				*****
		****** P/ JUSTIFICAR A MONTAGEM DA CAPA DO PEDIDO	*****

		m.empresa	= 	LNregional
		m.data		= 	wp_dtoper
		m.dtregistro=   wp_dtoper
		m.dtencerra	= 	{}
		m.pedido	=	LNpedido
		m.codforn	=	LNforn
		m.situacao	=	"B"
		m.total_ped = 	0
		SELE pedido
		SET ORDER TO TAG pedido
		SEEK STR(m.empresa,3)+STR(m.pedido,6)

		IF FOUND()
			=edithand('REGRAVA')
		ELSE
			=edithand('SAVE')
		ENDIF
		SELE prvitstq
		DO WHILE !EOF() AND LNemp = prvitstq.empresa;
					AND LNnro = prvitstq.numero;
					AND LNforn= prvitstq.codforn
			IF prvitstq.tipo_reg <> "T"
				SKIP
				LOOP
			ENDIF
			IF prvitstq.regional <>  LNregional
				SKIP
				LOOP
			ENDIF
			IF prvitstq.pedir =  0
				SKIP
				LOOP
			ENDIF
			****** POSICIONA NOS ITENS COM PEDIDO 				*****
			****** P/ A MONTAGEM DA CAPA DO PEDIDO	*****
			m.empresa	= 	LNregional
			m.data		= 	wp_dtoper
			m.pedido	=	LNpedido
			m.codforn	=	LNforn
			m.situacao	=	"B"
			m.codigo	= 	prvitstq.codigo
			m.classifica=   prvitstq.classifica
			m.qtde		=  	prvitstq.pedir	
			m.qtdetr	=	0
			m.qtdeatd	=	0
			m.preco_tab	=	prvitstq.preco_tab
			m.desc_1	=	prvitstq.desc_1
			m.desc_2	=	prvitstq.desc_2
			m.desc_3	=	prvitstq.desc_3
			m.desc_4	=	prvitstq.desc_4
			m.desc_5	=	prvitstq.desc_5
			m.desc_6	=	prvitstq.desc_6
			m.desc_7	=	prvitstq.desc_7
			m.desc_8	=	prvitstq.desc_8
			m.desc_9	=	prvitstq.desc_9
			m.desc_T	=	prvitstq.desc_T
			m.preco_norm=	prvitstq.preco_norm
			m.preco_vend=	prvitstq.preco_vend
			m.avindice	= 	prvitstq.avindice
			m.apindice	= 	prvitstq.apindice
			
			m.aliq_ipi		=	prvitstq.aliq_ipi
			m.ordem		=	prvitstq.ordem				
			IF LNcondicao = 1		&& A VISTA
				m.vlrcompra = m.qtde * m.preco_norm
				m.total_ped = ;
					m.total_ped + m.qtde * m.preco_norm
			ELSE
				m.vlrcompra = m.qtde * m.preco_vend
				m.total_ped = ;
					m.total_ped + m.qtde * m.preco_vend
			ENDIF
			SELE pedite
			SET ORDER TO TAG pedido
			SEEK STR(m.empresa,3)+STR(m.pedido,6)+m.codigo
			IF FOUND()
				IF (pedite.qtdetr + pedite.qtdeatd) > m.qtde
					m.qtde = pedite.qtde
				ENDIF
				m.qtdetr	=	pedite.qtdetr
				m.qtdeatd	=	pedite.qtdeatd
				=edithand('REGRAVA')
			ELSE
				=edithand('SAVE')
			ENDIF
			SELE prvitstq
			SKIP
		ENDDO
		EXIT
ENDDO
m.empresa 	= wp_empresa
SHOW WINDOW NAVEGA TOP
SHOW WINDOW SCGC800 TOP

