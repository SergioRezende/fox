*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є 05/14/15             SCGC240.SPR               16:31:17 є
*       є                                                         є
*       ЗДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД¶
*       є                                                         є
*       є Author's Name                                           є
*       є                                                         є
*       є Copyright (c) 2015 Company Name                         є
*       є Address                                                 є
*       є City,     Zip                                           є
*       є                                                         є
*       є Description:                                            є
*       є This program was automatically generated by GENSCRN.    є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є          SCGC240/MS-DOS Setup Code - SECTION 1          є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1
*~ WIZARDSCREEN
#DEFINE C_DBFEMPTY		'Database is empty, add a record?'
#DEFINE C_DELREC		'Apagar Registro Selecionado ?'
#DEFINE C_ENDFILE		'Final do Arquivo.'
#DEFINE C_CANCORCA   	'Confirma o Cancelamento do Orcamento ? '
#DEFINE C_APROORCA   	'Confirma o Aprovacao do Orcamento ?'
*---------------------------------------------------------------------*
* ARQUIVOS UTILIZADOS :                                               *
*              - PEDIDO
*              - PEDITE
*              - EMPRESA
*              - TIPOOPER
*              - FORNECE
*              - PARAMETR
*              - TPPGTO
*              - TAB_CST
*              - SALDO
*              - ITEMMOV
*              - GRUPO  =>OBJ_ITOR
*              - PROD_CMS  =>OBJ_ITOR
*              - TAB001
*              - TRANSPRT
*              - BANCO
* OBJETIVOS : VENDAS
*	
*---------------------------------------------------------------------*
******>>>> INICIO CONTROLE AMBIENTAL
PRIVATE LS240areant
LS240areant	= ALLTRIM(ALIAS()) && PERMITE RETORNAR A AREA ANTER. A CHAMADA

ON KEY LABEL ESCAPE
m.wzalias	=	SELECT()
m.isediting	=	.F.
m.isadding	=	.F.
m.isreading =   .F.
m.is2table 	= 	.F.
wp_flgfecha = 	.F. 		&& defaut nao fechamento da secao
WP_RECORD 	= 	0
wp_ref_local =  .T.     &&  POSSUI CONTROLE DE REFRESH LOCAL
*******************************************************
wl_cota     = .f.
iscancela   = .f.
isediprz    = .t.     && Permite ou nao a edicao dos prasos
isitens     = .f.     && indica se houve edicao doas itens durante ed. orca.
m.cgcfornece = SPACE(14)

LFemp240		= 	.F.		&& .F. =>  EMPRESA	DEVE SER FECHADA NA SAIDA
LFfor240		= 	.F.		&& .F. =>  FORNECE	DEVE SER FECHADA NA SAIDA
LFgru240		= 	.F.		&& .F. =>  GRUPO	DEVE SER FECHADA NA SAIDA
LFite240		= 	.F.		&& .F. =>  NOTAITE  DEVE SER 211DA NA SAIDA
LFmov240		= 	.F.		&& .F. =>  ITEMMOV	DEVE SER FECHADA NA SAIDA
LFmvx240		= 	.F.		&& .F. =>  ITMANEXO	DEVE SER FECHADA NA SAIDA
LFped240		= 	.F.		&& .F. =>  ITMANEXO	DEVE SER FECHADA NA SAIDA
LFpdi240		= 	.F.		&& .F. =>  ITMANEXO	DEVE SER FECHADA NA SAIDA
LFusr240		= 	.F.		&& .F. =>  ITMANEXO	DEVE SER FECHADA NA SAIDA
LFsld240		= 	.F.		&& .F. =>  ITMANEXO	DEVE SER FECHADA NA SAIDA
LFtabforn		= 	.F.		&& .F. =>  ITMANEXO	DEVE SER FECHADA NA SAIDA
LFdsctforn		= 	.F.		&& .F. =>  ITMANEXO	DEVE SER FECHADA NA SAIDA

*------------------- CONTROLE DE ARQUIVOS
IF !USED("empresa")
	LFemp240	= .T.
	IF ! NetUse("empresa")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("fornece")
	LFfor240	= .T.
	IF ! NetUse("fornece")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("saldo")
	LFsld240	= .T.
	IF ! NetUse("saldo")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("itemmov")
	LFmov240	= .T.
	IF ! NetUse("itemmov")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("itmanexo")
	LFmvx240	= .T.
	IF ! NetUse("itmanexo")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("grupo")
	LFgru240	= .T.
	IF ! NetUse("grupo")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("usuario")
	LFusr240	= .T.
	IF ! NetUse("usuario")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("tabforn")
	LFtabforn	= .T.
	IF ! NetUse("tabforn")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("dsctforn")
	LFdsctforn	= .T.
	IF ! NetUse("dsctforn")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF

IF !USED("pedite")
	LFpdi240	= .T.
	IF ! NetUse("pedite")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("pedido")
	LFped240	= .T.
	IF ! NetUse("pedido")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
******>>>> INICIO CONTROLE ARQUIVOS
*>> parametros repassados a btn_val
VLleitura = ""   && OPERACOES DE COMPRA
                         * repassa chave de leitura p/ btn_val
VLlerfim  = ""   && 1o REG. APOS OPER. COMPRAS
           * repassa chave de leitura p/ btn_val (POSICAO FINAL + 1 REG)
VLcompara = ""
                         * repassa chave de comparacao p/ btn_val
VLchvlimi = ""   && otimiza browse
***************************************************
IF wp_flgfecha
	DO ULfecha 		&& FECHA ARQUIVOS ABERTOS
	RETURN
ENDIF


#REGION 0
REGIONAL m.currarea, m.talkstat, m.compstat

IF SET("TALK") = "ON"
	SET TALK OFF
	m.talkstat = "ON"
ELSE
	m.talkstat = "OFF"
ENDIF
m.compstat = SET("COMPATIBLE")
SET COMPATIBLE FOXPLUS

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є                MS-DOS Window definitions                є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

IF NOT WEXIST("scgc240") ;
	OR UPPER(WTITLE("SCGC240")) == "SCGC240.PJX" ;
	OR UPPER(WTITLE("SCGC240")) == "SCGC240.SCX" ;
	OR UPPER(WTITLE("SCGC240")) == "SCGC240.MNX" ;
	OR UPPER(WTITLE("SCGC240")) == "SCGC240.PRG" ;
	OR UPPER(WTITLE("SCGC240")) == "SCGC240.FRX" ;
	OR UPPER(WTITLE("SCGC240")) == "SCGC240.QPR"
	DEFINE WINDOW scgc240 ;
		FROM 3, 2 ;
		TO 20,75 ;
		TITLE "[ PEDIDO DE COMPRA ]" ;
		FOOTER "[240]" ;
		FLOAT ;
		NOCLOSE ;
		MINIMIZE ;
		NONE ;
		COLOR SCHEME 1
ENDIF

IF NOT WEXIST("navega") ;
	OR UPPER(WTITLE("NAVEGA")) == "NAVEGA.PJX" ;
	OR UPPER(WTITLE("NAVEGA")) == "NAVEGA.SCX" ;
	OR UPPER(WTITLE("NAVEGA")) == "NAVEGA.MNX" ;
	OR UPPER(WTITLE("NAVEGA")) == "NAVEGA.PRG" ;
	OR UPPER(WTITLE("NAVEGA")) == "NAVEGA.FRX" ;
	OR UPPER(WTITLE("NAVEGA")) == "NAVEGA.QPR"
	DEFINE WINDOW navega ;
		FROM 22, 0 ;
		TO 24,79 ;
		FLOAT ;
		NOCLOSE ;
		NOMINIMIZE ;
		NONE ;
		COLOR SCHEME 1
ENDIF


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є          SCGC240/MS-DOS Setup Code - SECTION 2          є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1
******>>>> INICIO CONTROLE LOCAL
DO CASE
	CASE !wp_flgfecha
		SELE pedido
		SET ORDER TO TAG pedido
		SCATTER MEMVAR MEMO BLANK
		*-------------------------> criado pelo wizard
		m.wzalias=SELECT()
		m.isreadonly=IIF(ISREAD(),.T.,.F.)
		IF m.isreadonly
			WAIT WINDOW C_READONLY TIMEOUT 1
		ENDIF
		KEYBOARD "F"
		ON KEY LABEL CTRL-I DO ULitens
ENDCASE


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є              SCGC240/MS-DOS Screen Layout               є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1
IF WVISIBLE("scgc240")
	ACTIVATE WINDOW scgc240 SAME
ELSE
	ACTIVATE WINDOW scgc240 NOSHOW
ENDIF
@ 2,3 SAY "Pedido.:" ;
	SIZE 1,8, 0
@ 6,5 SAY "-" ;
	SIZE 1,1, 0
@ 0,0 TO 17,73 ;
	COLOR SCHEME 23
@ 17,1 TO 17,72 ;
	COLOR SCHEME 24
@ 17,73 SAY "Щ" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,73 TO 16,73 ;
	COLOR SCHEME 24
@ 0,73 SAY "ї" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 5,57 TO 7,71 ;
	COLOR SCHEME 23
@ 7,58 TO 7,70 ;
	COLOR SCHEME 24
@ 7,71 SAY "Щ" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 6,71 SAY "і" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 5,71 SAY "ї" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 5,2 TO 8,39 ;
	COLOR SCHEME 23
@ 8,3 TO 8,38 ;
	COLOR SCHEME 24
@ 8,39 SAY "Щ" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 6,39 TO 7,39 ;
	COLOR SCHEME 24
@ 5,39 SAY "ї" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,57 SAY "Data:" ;
	SIZE 1,5, 0
@ 0,25 SAY "[ Controle de Pedidos ]" ;
	SIZE 1,23, 0
@ 0,67 SAY "[240]" ;
	SIZE 1,5, 0
@ 5,41 TO 7,55 ;
	COLOR SCHEME 23
@ 7,42 TO 7,54 ;
	COLOR SCHEME 24
@ 7,55 SAY "Щ" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 6,55 SAY "і" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 5,55 SAY "ї" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 5,58 SAY "[TOTAL] " ;
	SIZE 1,8, 0
@ 5,42 SAY "[Aliq.Frete]" ;
	SIZE 1,12, 0
@ 5,3 SAY "[ Situacao do Pedido ]" ;
	SIZE 1,22, 0
@ 1,62 GET m.data ;
	SIZE 1,10 ;
	DEFAULT " " ;
	PICTURE "@K" ;
	WHEN _4cn0zet4m()
@ 2,11 GET m.STRpedido ;
	SIZE 1,7 ;
	DEFAULT " " ;
	PICTURE "@R 9999/99" ;
	WHEN .F. ;
	ERROR wp_msg
@ 2,11 GET m.pedido ;
	SIZE 1,7 ;
	DEFAULT " " ;
	PICTURE "@K 9999999" ;
	WHEN isreading or isadding ;
	VALID _4cn0zet56() ;
	ERROR wp_msg
@ 6,3 GET m.situacao ;
	SIZE 1,2 ;
	DEFAULT " " ;
	WHEN .F.
@ 6,6 GET m.descstt ;
	SIZE 1,33 ;
	DEFAULT " " ;
	WHEN _4cn0zet5f() ;
	COLOR SCHEME 1
@ 6,45 GET m.aliq_frete ;
	SIZE 1,5 ;
	DEFAULT 0 ;
	PICTURE "99.99" ;
	WHEN isediting
@ 6,58 GET m.total_PED ;
	SIZE 1,12 ;
	DEFAULT " " ;
	PICTURE "@K 9,999,999.99" ;
	WHEN .f.
@ 7,6 GET m.desc2stt ;
	SIZE 1,33 ;
	DEFAULT " " ;
	WHEN _4cn0zet5j() ;
	COLOR SCHEME 1
@ 11,2 GET m.nfp_btn ;
	PICTURE "@*HN \<1-NF.Emit.Ped." ;
	SIZE 1,16,1 ;
	DEFAULT 1 ;
	VALID _4cn0zet5n() ;
	MESSAGE 'Primeiro registro'
@ 11,30 GET m.nft_btn ;
	PICTURE "@*HN \<2-NF.em Trans" ;
	SIZE 1,15,1 ;
	DEFAULT 1 ;
	VALID _4cn0zet5r() ;
	MESSAGE 'Primeiro registro'
@ 11,53 GET m.pendt_btn ;
	PICTURE "@*HN \<3-Pendencias Trans" ;
	SIZE 1,20,1 ;
	DEFAULT 1 ;
	VALID _4cn0zet5x()
@ 13,2 GET m.pendg_btn ;
	PICTURE "@*HN \<4-Pendencias Geral" ;
	SIZE 1,20,1 ;
	DEFAULT 1 ;
	VALID _4cn0zet61()
@ 13,53 GET impped_btn ;
	PICTURE "@*HN \<6-Pedido (word)" ;
	SIZE 1,17,1 ;
	DEFAULT 1 ;
	VALID _4cn0zet66()
@ 15,2 GET impped2_btn ;
	PICTURE "@*HN \<7-Pedido C/ Valor" ;
	SIZE 1,19,1 ;
	DEFAULT 1 ;
	VALID _4cn0zet67()
@ 16,53 GET m.ep_btn ;
	PICTURE "@*HN \<9-Encerra Pedido" ;
	SIZE 1,18,1 ;
	DEFAULT 1 ;
	VALID _4cn0zet6j() ;
	MESSAGE 'Primeiro registro'
@ 17,33 GET m.item_btn ;
	PICTURE "@*HN ite\<Ns" ;
	SIZE 1,7,1 ;
	DEFAULT 1 ;
	VALID _4cn0zet6o()
@ 13,29 GET impped_btn ;
	PICTURE "@*HN \<5-Pedido (excel)" ;
	SIZE 1,18,1 ;
	DEFAULT 1 ;
	VALID _4cn0zet6s()




*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є              OBJ_WNAV/MS-DOS Screen Layout              є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 2
IF WVISIBLE("navega")
	ACTIVATE WINDOW navega SAME
ELSE
	ACTIVATE WINDOW navega NOSHOW
ENDIF
@ 1,8 GET m.top_btn ;
	PICTURE "@*HN \<Inicio" ;
	SIZE 1,8,1 ;
	DEFAULT 1 ;
	VALID BTN_VAL1('TOP', VLleitura, Vlcompara) ;
	MESSAGE 'Primeiro registro'
@ 1,16 GET m.prev_btn ;
	PICTURE "@*HN \<Ant" ;
	SIZE 1,5,1 ;
	DEFAULT 1 ;
	VALID btn_val1('PREV', VLleitura, Vlcompara) ;
	MESSAGE 'Posiciona no registro anterior.' 	
@ 1,21 GET m.next_btn ;
	PICTURE "@*HN \<Proximo" ;
	SIZE 1,9,1 ;
	DEFAULT 1 ;
	VALID btn_val1('NEXT', VLleitura, Vlcompara) ;
	MESSAGE 'Avanca para proximo registro'
@ 1,30 GET m.end_btn ;
	PICTURE "@*HN \<Fim" ;
	SIZE 1,5,1 ;
	DEFAULT 1 ;
	VALID btn_val1('END', VLlerfim, Vlcompara) ;
	MESSAGE 'Ultimo registro do arquivo' 																																													
@ 1,35 GET m.loc_btn ;
	PICTURE "@*HN \<Zoom" ;
	SIZE 1,6,1 ;
	DEFAULT 1 ;
	VALID btn_val1('LOCATE', VLleitura, Vlcompara,VLchvlimi)		 ;
	MESSAGE 'Permite consulta visual ampliada a varios registros na tela'
@ 1,41 GET m.add_btn ;
	PICTURE "@*HN \<Lanca" ;
	SIZE 1,7,1 ;
	DEFAULT 1 ;
	VALID btn_val1('ADD') ;
	MESSAGE 'Abre novo registro para lancamento de dados' 
@ 1,55 GET m.edit_btn ;
	PICTURE "@*HN \<Edit" ;
	SIZE 1,6,1 ;
	DEFAULT 1 ;
	VALID btn_val1('EDIT') ;
	MESSAGE 'Permite a alteracao de dados do registro corrente'
@ 1,61 GET m.del_btn ;
	PICTURE "@*HN \<Del" ;
	SIZE 1,5,1 ;
	DEFAULT 1 ;
	VALID btn_val1('DELETE', VLleitura, Vlcompara) ;
	MESSAGE 'Delete current record.'
@ 1,73 GET m.exit_btn ;
	PICTURE "@*HN \<Sair" ;
	SIZE 1,6,1 ;
	DEFAULT 1 ;
	VALID btn_val1('EXIT') ;
	MESSAGE 'Close screen.'
@ 1,48 GET m.cop_btn ;
	PICTURE "@*HN \<Copia" ;
	SIZE 1,7,1 ;
	DEFAULT 1 ;
	VALID btn_val1('COPY') ;
	MESSAGE 'Abre novo registro sel limpar os dados do reg corrente' 
@ 1,1 GET m.busca_btn ;
	PICTURE "@*HN \<Busca" ;
	SIZE 1,7,1 ;
	DEFAULT 1 ;
	VALID BTN_VAL1('BUSCA') ;
	MESSAGE 'Busca dirata pela chave do documento.'
@ 1,66 GET m.imp_btn ;
	PICTURE "@*HN i\<Mpr" ;
	SIZE 1,6,1 ;
	DEFAULT 1 ;
	VALID btn_val1('PRINT') ;
	MESSAGE 'Close screen.'
@ 0,0 TO 2,79 DOUBLE ;
	COLOR SCHEME 24
@ 2,1 TO 2,78 DOUBLE ;
	COLOR SCHEME 23
@ 1,79 SAY "і" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 0,79 SAY "»" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 2,79 SAY "ј" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 1,79 SAY "є" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23

IF NOT WVISIBLE("navega")
	ACTIVATE WINDOW navega
ENDIF
IF NOT WVISIBLE("scgc240")
	ACTIVATE WINDOW scgc240
ENDIF



*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є     MS-DOSREAD contains clauses from SCREEN scgc240     є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

READ CYCLE ;
	VALID READVALID() ;
	WHEN READWHEN() ;
	ACTIVATE READACT() ;
	DEACTIVATE READDEAC() ;
	NOLOCK

RELEASE WINDOW navega
RELEASE WINDOW scgc240

#REGION 0
IF m.talkstat = "ON"
	SET TALK ON
ENDIF
IF m.compstat = "ON"
	SET COMPATIBLE ON
ENDIF


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є               SCGC240/MS-DOS Cleanup Code               є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1
	DO ULfecha 		&& FECHA ARQUIVOS ABERTOS
	wp_flgfecha = .F. 		&& defaut nao fechamento da secao
	ON KEY LABEL ESCAPE
	SET FORMAT TO
	ON KEY LABEL CTRL-I
RETURN



*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є   SCGC240/MS-DOS Supporting Procedures and Functions    є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1
PROCEDURE ULitens
*-*-*-----*-*--*-*-*-*-*-*-*-*>> TALVEZ ABRA TRANZACAO
	IF isediting
		WAIT WINDOW "Termine a Edicao para ativar os itens."
 		RETURN
	ENDIF
	SELE pedido
	IF !REGLOCK()
		WAIT WINDOW "Registro esta em Uso por outro usuario.." NOWAIT
 		RETURN
	ENDIF
	HIDE WINDOW SCGC240, NAVEGA
	DO SCGC240A.spr
	SHOW WINDOW SCGC240, NAVEGA
	SELE pedido
	IF LASTKEY() <> 27
		IF pedido.total_ped <> m.total_ped
			=REGLOCK()
			GATHER MEMVAR FIELDS total_ped  MEMO
		ENDIF
	ENDIF
    CLEAR TYPEAHEAD
	UNLOCK
	ON KEY LABEL ESCAPE
    SCATTER MEMVAR MEMO
	DO refresh

RETURN

*-------------->
PROCEDURE ULfecha
	IF LFtabforn		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("tabforn")
	ENDIF
	IF LFdsctforn		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("dsctforn")
	ENDIF
	IF LFemp240		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("empresa")
	ENDIF
	IF LFfor240		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("fornece")
	ENDIF
	IF LFsld240		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("saldo")
	ENDIF
	IF LFmov240		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("itemmov")
	ENDIF
	IF LFmvx240		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("itmanexo")
	ENDIF
	IF LFgru240		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("grupo")
	ENDIF
	IF LFpdi240		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("pedite")
	ENDIF
	IF LFped240		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("pedido")
	ENDIF
	IF LFusr240		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("usuario")
	ENDIF

	wp_flgfecha = .F. 		&& defaut nao fechamento da secao
	IF !EMPTY(LS240areant)
		SELECT &LS240areant
	ENDIF
	ON KEY LABEL ESCAPE
	SET FORMAT TO
	ON KEY LABEL CTRL-I

RETURN
	

PROCEDURE BTN_VAL1
	PARAMETER tecla, m.chv_ler, m.chv_compara, m.chv_brow
	SELE pedido
	SET ORDER TO TAG pedido
    DO CASE
		CASE tecla = "ADD"
		    DO btn_val with tecla, m.chv_ler, m.chv_compara, m.chv_brow
			wl_cota = .T.    && BUSCAR NUMERO DE COTACAO
			m.situacao = "B "
			m.operador =   nUsr
			SHOW GET m.situacao
			SHOW GET m.operador
			SHOW GET m.pedido
			SELECT pedido
		    ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
			ON KEY LABEL END do btn_val1 with 'DELETE', VLleitura, ;
												 Vlcompara
			RETURN .T.
        CASE tecla = "DELETE"
			IF isediting     && .T. => CANCELA A EDICAO
			    DO btn_val with tecla, m.chv_ler, m.chv_compara, m.chv_brow
				iscancela = .F.
			   	iscancela = .F.
			   	RETURN
			ENDIF
			IF EOF() OR BOF()
			   WAIT WINDOW C_ENDFILE NOWAIT
			   RETURN
			ENDIF
			IF !fox_alert(C_DELREC)
			   RETURN
			ENDIF
			SELECT  pedite
			SET ORDER TO TAG relacaoit
			SEEK m.pedido
			DO WHILE !eof()	AND m.pedido 	= pedido
			   =REGLOCK()
			   DELETE
			   SKIP
			ENDDO
			SELECT pedido
			KEYBOARD "{S}"
		    DO btn_val with tecla, m.chv_ler, m.chv_compara, m.chv_brow
			RETURN .T.
		OTHERWISE
		    DO btn_val with tecla, m.chv_ler, m.chv_compara, m.chv_brow

	ENDCASE		

	SELE usuario
	SET ORDER TO TAG usuario
	SEEK m.operador
	m.nomeusr	 = usuario.nome
	SHOW GET m.nomeusr
	DO CASE
		CASE LEFT(m.situacao,1) = "B"
			m.descstt = "Pedido Registrado"
		CASE LEFT(m.situacao,1) = "C"
			m.descstt = "Pedido Fechado"
	ENDCASE
	SHOW GET m.descstt
	DO CASE
		CASE RIGHT(m.situacao,1) = "A"
			m.desc2stt = "Nenhum Item Atendido."
		CASE RIGHT(m.situacao,1) = "B"
			m.desc2stt = "Itens em Transito."
		CASE RIGHT(m.situacao,1) = "C"
			m.desc2stt = "Atendido Parcial"
		CASE RIGHT(m.situacao,1) = "D"
			m.desc2stt = "Atendido Completo."
	ENDCASE
	SHOW GET m.desc2stt
	SELECT pedido
	m.STRpedido = STR(m.PEDIDO,6)
	SHOW GET m.STRpedido

RETURN
*------------>
*------------->
PROCEDURE local_refresh
PARAMETERS wl_branco

DO CASE
   CASE isediting or wl_branco
	  SHOW GET ep_btn   DISABLE
	  SHOW GET pb_btn   DISABLE
	  SHOW GET cp_btn   DISABLE
	  SHOW GET nfp_btn   DISABLE
	  SHOW GET nft_btn   DISABLE
	  SHOW GET item_btn  DISABLE
	  SHOW GET pendt_btn  DISABLE
	  SHOW GET pendg_btn  DISABLE
	  SHOW GET impped_btn DISABLE
	  SHOW GET impped2_btn DISABLE
	OTHERWISE
	  LSl = LEFT(m.situacao,1)
	  LSr = RIGHT(m.situacao,1)
	  IF (LSl $ "B")
	  	  SHOW GET cop_btn   	DISABLE
	  	  SHOW GET edit_btn   	DISABLE
	  	  SHOW GET del_btn   	DISABLE
	  ENDIF
ENDCASE


RETURN





*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4CN0ZET4M           m.data WHEN                        є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC240,     Record Number:   30   є
*       є Variable:            m.data                             є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Field                              є
*       є Snippet Number:      1                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4cn0zet4m     &&  m.data WHEN
#REGION 1
IF isadding
   data = wp_dtoper
ENDIF
SHOW GET m.data
RETURN(isadding)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4CN0ZET56           m.pedido VALID                     є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC240,     Record Number:   32   є
*       є Variable:            m.pedido                           є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Field                              є
*       є Snippet Number:      2                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4cn0zet56     &&  m.pedido VALID
#REGION 1
SELE pedido
SET ORDER TO TAG pedido
SET NEAR ON
SEEK m.pedido
SET NEAR OFF
m.STRpedido = STR(m.PEDIDO,6)
SHOW GET m.STRpedido

RETURN(UPtratachv())


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4CN0ZET5F           m.descstt WHEN                     є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC240,     Record Number:   34   є
*       є Variable:            m.descstt                          є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Field                              є
*       є Snippet Number:      3                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4cn0zet5f     &&  m.descstt WHEN
#REGION 1
RETURN(.F.)

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4CN0ZET5J           m.desc2stt WHEN                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC240,     Record Number:   37   є
*       є Variable:            m.desc2stt                         є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Field                              є
*       є Snippet Number:      4                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4cn0zet5j     &&  m.desc2stt WHEN
#REGION 1
RETURN(.F.)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4CN0ZET5N           m.nfp_btn VALID                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC240,     Record Number:   38   є
*       є Variable:            m.nfp_btn                          є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      5                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4cn0zet5n     &&  m.nfp_btn VALID
#REGION 1
DO OBJ_NETR.SPR WITH 1,0, m.pedido
SELECT pedido
UNLOCK ALL
SCATTER MEMVAR MEMO
SHOW GETS
DO refresh
RETURN


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4CN0ZET5R           m.nft_btn VALID                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC240,     Record Number:   39   є
*       є Variable:            m.nft_btn                          є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      6                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4cn0zet5r     &&  m.nft_btn VALID
#REGION 1
IF fox_alert('Relacionar so N.F. referentes ao Pedido em Tela ?')
   DO OBJ_NETR.SPR WITH 2,0, m.pedido
ELSE
   DO OBJ_NETR.SPR WITH 2,0, 0
ENDIF
SELECT pedido
UNLOCK ALL
SCATTER MEMVAR MEMO
SHOW GETS
DO refresh
RETURN


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4CN0ZET5X           m.pendt_btn VALID                  є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC240,     Record Number:   40   є
*       є Variable:            m.pendt_btn                        є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      7                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4cn0zet5x     &&  m.pendt_btn VALID
#REGION 1
IF fox_alert('Relacionar Pendencias se referentes ao Pedido em Tela ?')
   DO OBJ_PEND.SPR WITH 2,m.empresa, m.pedido
ELSE
   DO OBJ_PEND.SPR WITH 2,m.empresa, 0
ENDIF
SELECT pedido
UNLOCK ALL
SCATTER MEMVAR MEMO
SHOW GETS
DO refresh
RETURN


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4CN0ZET61           m.pendg_btn VALID                  є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC240,     Record Number:   41   є
*       є Variable:            m.pendg_btn                        є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      8                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4cn0zet61     &&  m.pendg_btn VALID
#REGION 1
IF fox_alert('Relacionar Pendencias se referentes ao Pedido em Tela ?')
   DO OBJ_PEND.SPR WITH 1,m.empresa, m.pedido
ELSE
   DO OBJ_PEND.SPR WITH 1,m.empresa, 0
ENDIF
SELECT pedido
UNLOCK ALL
SCATTER MEMVAR MEMO
SHOW GETS
DO refresh
RETURN


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4CN0ZET66           impped_btn VALID                   є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC240,     Record Number:   42   є
*       є Variable:            impped_btn                         є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      9                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4cn0zet66     &&  impped_btn VALID
#REGION 1
	SELE empresa
	SET ORDER TO TAG empresa
	
	SELE tabforn
	SET ORDER TO TAG tabela

	SELE fornece
	SET ORDER TO TAG codigo

	SELE GRUPO
	SET ORDER TO TAG classifica
	SELECT pedite
	SET ORDER TO TAG separaforn

	SET NEAR ON
	SEEK STR(pedido.pedido,6)
	SET NEAR OFF
	IF EOF() OR pedite.pedido <> pedido.pedido
		SELE pedido
		WAIT WINDOW  "Pedido Nao Possui Itens..   <ENTER> "
		RETURN
	ENDIF
	*******************
	*---->   (INICIALIZACAO DO CONTROLE DE STATUS IMPRESSAO)
	*******************	

	DO RELINIC.PRG          && INICIA VAR P/ TERMOMETRO

	LFsegue = .t.
	LNregistro = RECNO()

	COUNT WHILE     pedite.pedido = pedido.pedido TO LNimpressao

	LNimpressos = 0
	GO LNregistro
	*******************
	*---->   (COMPLETADO PREPARACAO DO CONTROLE DE STATUS IMPRESSAO)
	*******************	
	SET RELATION TO  classifica INTO grupo
	SET RELATION TO  codforn	INTO fornece ADDITIVE
	SET RELATION TO  empresa	INTO empresa ADDITIVE
	SET RELATION TO  STR(codforn,5)+codigo INTO tabforn ADDITIVE
	**************************>>> REGISTRO DE SAIDAS
	LSorienta  = " "          && fornece as condicoe de impressao
	LSorienta = ;
		    "   WHILE pedite.pedido = pedido.pedido "+;
	    	"   AND LFsegue "
	LSrel = "REL240B"   && relatorio padrao p/ impressoras ex: epson
	SET ORDER TO TAG separaforn
	DO UPimpressao    && COORDENA TRABALHO DE IMPRESSAO
	**********
	***********
	DO RELFIM.PRG          && FIM VAR P/ TERMOMETRO
	*-----------------------------
	SET RELATION TO

	SELECT pedido
	UNLOCK ALL
	SCATTER MEMVAR MEMO
	SHOW WINDOW NAVEGA  TOP
	SHOW WINDOW SCGC240 TOP
	SHOW GETS
	DO refresh
RETURN


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4CN0ZET67           impped2_btn VALID                  є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC240,     Record Number:   43   є
*       є Variable:            impped2_btn                        є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      10                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4cn0zet67     &&  impped2_btn VALID
#REGION 1
	SELE empresa
	SET ORDER TO TAG empresa
	
	SELE fornece
	SET ORDER TO TAG codigo

	SELE GRUPO
	SET ORDER TO TAG classifica
	SELECT pedite
	SET ORDER TO TAG separaforn

	SET NEAR ON
	SEEK STR(pedido.pedido,6)
	SET NEAR OFF
	IF EOF() OR pedite.pedido <> pedido.pedido
		SELE pedido
		WAIT WINDOW  "Pedido Nao Possui Itens..   <ENTER> "
		RETURN
	ENDIF
	*******************
	*---->   (INICIALIZACAO DO CONTROLE DE STATUS IMPRESSAO)
	*******************	

	DO RELINIC.PRG          && INICIA VAR P/ TERMOMETRO

	LFsegue = .t.
	LNregistro = RECNO()

	COUNT WHILE     pedite.pedido = pedido.pedido TO LNimpressao

	LNimpressos = 0
	GO LNregistro
	*******************
	*---->   (COMPLETADO PREPARACAO DO CONTROLE DE STATUS IMPRESSAO)
	*******************	
	SET RELATION TO  classifica INTO grupo
	SET RELATION TO  codforn	INTO fornece ADDITIVE
	SET RELATION TO  empresa	INTO empresa ADDITIVE

	**************************>>> REGISTRO DE SAIDAS
	LSorienta  = " "          && fornece as condicoe de impressao
	LSorienta = ;
			    "   WHILE pedite.pedido = pedido.pedido "+;
		    	"   AND LFsegue "
	LSrel = "REL240C"   && relatorio padrao p/ impressoras ex: epson
	SET ORDER TO TAG separaforn
	DO UPimpressao    && COORDENA TRABALHO DE IMPRESSAO
	**********
	***********
	DO RELFIM.PRG          && FIM VAR P/ TERMOMETRO
	*-----------------------------
	SET RELATION TO

	SELECT pedido
	UNLOCK ALL
	SCATTER MEMVAR MEMO
	SHOW WINDOW NAVEGA  TOP
	SHOW WINDOW SCGC240 TOP
	SHOW GETS
	DO refresh
RETURN


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4CN0ZET6J           m.ep_btn VALID                     є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC240,     Record Number:   44   є
*       є Variable:            m.ep_btn                           є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      11                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4cn0zet6j     &&  m.ep_btn VALID
#REGION 1
wp_msg = " ATENCAO !! "+CHR(13)+;
		 "   O  Encerramento do Pedido Elimina Todas as Pendencias."+;
		 "Tecle <ENTER> e Responda a Confirmacao."

DO OBJ_ALER.SPR WITH wp_msg		


IF !fox_alert('1a - Confirma Encerramento Registro de Pedido ?.')
   RETURN
ENDIF

IF !fox_alert('2a - Confirma Encerramento Registro de Pedido ?.')
   RETURN
ENDIF




IF !REGLOCK()
   WAIT WINDOW "Documento nao poder ser bloqueado para o processo."
   RETURN
ENDIF
SELECT  pedite
SET ORDER TO TAG relacaoit
SEEK m.pedido


***> ((((( PREVIA )))
LFflgtrans = .t.

*---->  POSICIONA ARQUIVOS RELACIONADOS
************************************
=UPtransacao("INICIAR")
************************************
DO WHILE !eof() AND  m.pedido = pedido
   	SELECT pedite
	IF REGLOCK()
		m.qtde =  QTDETR + QTDEATD
		IF QTDETR = 0		
			m.situacao  =   "C"+RIGHT(pedite.situacao,1)
		ELSE
			m.situacao  =   pedite.situacao
		ENDIF
		***************************
		SET FIELDS TO dtregis, hregis, usrregis,deletado
	    SET FIELDS TO qtde,situacao
		=edithand('REGRAVA')
		CLEAR FIELDS
		SET FIELDS OFF
		***************************
	ELSE
		LFflgtrans = .F.
		EXIT
	ENDIF
	SKIP
ENDDO
SELE pedite
IF !LFflgtrans   && OPERACAO ABORTADA
	************************************
	=UPtransacao("ABORTAR")
	************************************
	UNLOCK ALL
	SELE pedido
	SCATTER MEMVAR MEMO
	SHOW GETS
	DO refresh
	RETURN
ENDIF			
************
SELECT pedido
m.situacao  =   "C"+RIGHT(situacao,1)
=edithand('REGRAVA')
************************************
=UPtransacao("TERMINAR")
************************************
UNLOCK ALL
SCATTER MEMVAR MEMO
SHOW GETS
DO refresh
RETURN


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4CN0ZET6O           m.item_btn VALID                   є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC240,     Record Number:   45   є
*       є Variable:            m.item_btn                         є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      12                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4cn0zet6o     &&  m.item_btn VALID
#REGION 1
DO ULitens


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4CN0ZET6S           impped_btn VALID                   є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC240,     Record Number:   46   є
*       є Variable:            impped_btn                         є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      13                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4cn0zet6s     &&  impped_btn VALID
#REGION 1
	SELE empresa
	SET ORDER TO TAG empresa
	
	SELE tabforn
	SET ORDER TO TAG tabela

	SELE fornece
	SET ORDER TO TAG codigo

	SELE GRUPO
	SET ORDER TO TAG classifica
	SELECT pedite
	SET ORDER TO TAG separaforn

	SET NEAR ON
	SELECT ;
	   wp_empresa as EMPRESA,;
	   emp.nome   as NOME_EMP,;
	   emp.sigla  as SIGLA,;
	   pdd.pedido ,;
	   pdd.data ,;
	   pdi.codforn,;
	   for.nome,;
	   pdi.classifica,;
	   pdi.codigo,;
	   pdi.ordem,;
	   grp.descricao,;
	   pdi.empresa as loja,;
	   IIF(pdi.EMPRESA=1,QTDE,000000) AS qt_prvgyn,;
	   IIF(pdi.EMPRESA=2,QTDE,000000) AS qt_prvsia,;
	   IIF(pdi.EMPRESA=4,QTDE,000000) AS qt_prvbgs,;
	   IIF(pdi.EMPRESA=6,QTDE,000000) AS qt_prvcgb,;
	   IIF(pdi.EMPRESA=14,QTDE,000000) AS qt_prvanp,;
	   IIF(pdi.EMPRESA=8,QTDE,000000) AS qt_prvarg,;
	   IIF(pdi.EMPRESA=17,QTDE,000000) AS qt_prvabo;
  	FROM empresa emp, ;
        pedido pdd, ;
        grupo grp, ;
        fornece for, ;
        pedite pdi ;
 	WHERE  pdd.pedido = m.pedido ;
       and emp.empresa = wp_empresa ;
       and pdi.codforn = for.codigo ;
	   and pdi.classifica = grp.classifica ;
	   and pdd.pedido = pdi.pedido ;
    INTO CURSOR CRS_pdtmp


	SELECT ;
	   EMPRESA,;
	   NOME_EMP,;
	   SIGLA,;
	   pedido ,;
	   data ,;
	   codforn,;
	   nome,;
	   classifica,;
	   codigo,;
	   ordem,;
	   descricao,;
	   loja,;
	   SUM(qt_prvgyn) AS qt_prvgyn,;
	   SUM(qt_prvsia) AS qt_prvsia,;
	   SUM(qt_prvbgs) AS qt_prvbgs,;
	   SUM(qt_prvcgb) AS qt_prvcgb,;
	   SUM(qt_prvanp) AS qt_prvanp,;
	   SUM(qt_prvarg) AS qt_prvarg,;
	   SUM(qt_prvabo) AS qt_prvabo;
  	FROM CRS_pdtmp ;
 	GROUP BY pedido,codigo,codforn ;
    ORDER BY pedido,codforn,ordem ;
    INTO CURSOR CRS_PEDIDO


	COUNT TO A
	SET NEAR OFF
	IF A=0
		SELE pedido
		WAIT WINDOW  "Pedido Nao Possui Itens..   <ENTER> "
		RETURN
	ENDIF
	*******************
	*---->   (INICIALIZACAO DO CONTROLE DE STATUS IMPRESSAO)
	*******************	

	DO RELINIC.PRG          && INICIA VAR P/ TERMOMETRO

	LFsegue = .t.
	go top
	LNregistro = RECNO()

	COUNT  TO LNimpressao

	LNimpressos = 0
	GO TOP
	*******************
	*---->   (COMPLETADO PREPARACAO DO CONTROLE DE STATUS IMPRESSAO)
	*******************	
	SET RELATION TO  STR(codforn,5)+codigo INTO tabforn
	**************************>>> REGISTRO DE SAIDAS
	LSorienta  = " "          && fornece as condicoe de impressao
	LSorienta = ;
		    "   WHILE LFsegue "
	LSrel = "REL240B2"   && relatorio padrao p/ impressoras ex: epson
	DO UPimpressao    && COORDENA TRABALHO DE IMPRESSAO
	**********
	***********
	DO RELFIM.PRG          && FIM VAR P/ TERMOMETRO
	*-----------------------------
	SET RELATION TO

  	SELE  CRS_pdtmp
  	USE
    SELE CRS_PEDIDO
    USE
	SELECT pedido
	UNLOCK ALL
	SCATTER MEMVAR MEMO
	SHOW WINDOW NAVEGA  TOP
	SHOW WINDOW SCGC240 TOP
	SHOW GETS
	DO refresh
RETURN
