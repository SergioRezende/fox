*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨ 19/03/2009           SCGC240A.SPR              11:37:48 ╨
*       ╨                                                         ╨
*       гддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╤
*       ╨                                                         ╨
*       ╨ Author's Name                                           ╨
*       ╨                                                         ╨
*       ╨ Copyright (c) 2009 Company Name                         ╨
*       ╨ Address                                                 ╨
*       ╨ City,     Zip                                           ╨
*       ╨                                                         ╨
*       ╨ Description:                                            ╨
*       ╨ This program was automatically generated by GENSCRN.    ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫


*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨         SCGC240A/MS-DOS Setup Code - SECTION 1          ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*

#REGION 1
CLEAR TYPEAHEAD
*---------------------------------------------------------------*
* OPERA ARQUIVOS :
*
* OBJETIVO:  PROGRAMA PRINCIPAL PARA EDICAO DE ITENS DO PEDIDO
*
*---------------------------------------------------------------*

PUSH KEY CLEAR		&& desabilita teclas de atalho def. anteriormente
ON KEY LABEL F1		DO HLP2000.SPR WITH  POPUP(),PROMPT(),PROGRAM(),;
							WONTOP(),VARREAD()
*********************************************************************

PRIVATE LNSliq,LNSipi,LNScti,LNSfret,LNSadic,LNSicms,LNSicmr,LNScto	
PRIVATE LNStot
PRIVATE	LNSliqANT,LNSipiANT,LNSctiANT,LNSfretANT,LNSicmrANT

PRIVATE LStelabrow

PRIVATE LScodant


PRIVATE wl_areant,wp_flgfecha,LFjanela,LNobjeto
PRIVATE LSmarca,LNregbrow,LSsvtela

******>>>> INICIO CONTROLE AMBIENTAL

ON KEY LABEL ESCAPE	KEYBOARD "{SHIFT-TAB}"

wl_areant 	= ALLTRIM(ALIAS()) && PERMITE RETORNAR A AREA ANTER. A CHAMADA
wp_flgfecha = .F. 		&& defaut nao fechamento da secao

LFjanela    = 1 		&& FLAG PARA CONTROLAR AS JANELAS
LNobjeto    = 1			&& permite voltar em scgc240a no mesmo obj ant

LSmarca   	= " "			&& referenciar registro
LNregbrow   = 1				&& suporte para a marca do registro corrente

SAVE SCREEN TO LSsvtela	&& SO P/ INICIALISAR

************************************************************************

STORE 0 TO  LNSliq,LNSipi,LNScti,LNSfret,LNSadic,LNSicms,LNScto
STORE 0 TO  LNStot

STORE 0 TO  LNSliqANT,LNSipiANT,LNSctiANT,LNSfretANT,LNSctoANT

STORE 0 TO 	LNSicmr,LNSicmrANT

LScodant	= ""
LFpaslin   = .f.        && .t. indica que houve pedido de mudanca de linha
						&& em passalin

*********************>>>> FIM CONTROLE AMBIENTAL <<<<<******************
************************************************************************

******>>>> INICIO CONTROLE ARQUIVOS
SELE pedite
wl_arqtmp = ""
LNtmp     = 65		&& TABELA ASCII A = 65
IF !UPabretmp("ped")
	wp_flgfecha = .t.
ENDIF
IF wp_flgfecha
	DO ULfecha
	RETURN
ENDIF

******>>>> INICIO CONTROLE LOCAL


#REGION 0
REGIONAL m.currarea, m.talkstat, m.compstat

IF SET("TALK") = "ON"
	SET TALK OFF
	m.talkstat = "ON"
ELSE
	m.talkstat = "OFF"
ENDIF
m.compstat = SET("COMPATIBLE")
SET COMPATIBLE FOXPLUS

*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨                MS-DOS Window definitions                ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*

IF NOT WEXIST("scgc240a") ;
	OR UPPER(WTITLE("SCGC240A")) == "SCGC240A.PJX" ;
	OR UPPER(WTITLE("SCGC240A")) == "SCGC240A.SCX" ;
	OR UPPER(WTITLE("SCGC240A")) == "SCGC240A.MNX" ;
	OR UPPER(WTITLE("SCGC240A")) == "SCGC240A.PRG" ;
	OR UPPER(WTITLE("SCGC240A")) == "SCGC240A.FRX" ;
	OR UPPER(WTITLE("SCGC240A")) == "SCGC240A.QPR"
	DEFINE WINDOW scgc240a ;
		FROM 2, 2 ;
		TO 7,76 ;
		TITLE "[ ]" ;
		FOOTER "[240A]" ;
		NOFLOAT ;
		NOCLOSE ;
		SHADOW ;
		NOMINIMIZE ;
		NONE ;
		COLOR SCHEME 1
ENDIF

IF NOT WEXIST("obj_vlro") ;
	OR UPPER(WTITLE("OBJ_VLRO")) == "OBJ_VLRO.PJX" ;
	OR UPPER(WTITLE("OBJ_VLRO")) == "OBJ_VLRO.SCX" ;
	OR UPPER(WTITLE("OBJ_VLRO")) == "OBJ_VLRO.MNX" ;
	OR UPPER(WTITLE("OBJ_VLRO")) == "OBJ_VLRO.PRG" ;
	OR UPPER(WTITLE("OBJ_VLRO")) == "OBJ_VLRO.FRX" ;
	OR UPPER(WTITLE("OBJ_VLRO")) == "OBJ_VLRO.QPR"
	DEFINE WINDOW obj_vlro ;
		FROM 22, 1 ;
		TO 24,78 ;
		TITLE "[ ]" ;
		FOOTER "[OBJ_VLRO]" ;
		NOFLOAT ;
		NOCLOSE ;
		NOMINIMIZE ;
		NONE ;
		COLOR SCHEME 1
ENDIF

IF NOT WEXIST("item") ;
	OR UPPER(WTITLE("ITEM")) == "ITEM.PJX" ;
	OR UPPER(WTITLE("ITEM")) == "ITEM.SCX" ;
	OR UPPER(WTITLE("ITEM")) == "ITEM.MNX" ;
	OR UPPER(WTITLE("ITEM")) == "ITEM.PRG" ;
	OR UPPER(WTITLE("ITEM")) == "ITEM.FRX" ;
	OR UPPER(WTITLE("ITEM")) == "ITEM.QPR"
	DEFINE WINDOW item ;
		FROM 9, 0 ;
		TO 19,79 ;
		TITLE " " ;
		FOOTER "ITEM" ;
		FLOAT ;
		NOCLOSE ;
		NOMINIMIZE ;
		NONE ;
		COLOR SCHEME 1
ENDIF


*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨         SCGC240A/MS-DOS Setup Code - SECTION 2          ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*

#REGION 1
		SELECT  pedite
		SET ORDER TO TAG relacaoit
		SET NEAR ON
		SEEK m.pedido
		SET NEAR OFF
		***
		SET SAFET OFF
		LStmp = "\TMP\"+"&wl_arqtmp"
		COPY TO &LStmp WHILE !eof() AND m.pedido = pedido   WITH CDX
	    SELE 0
	    USE "\TMP\"+"&wl_arqtmp"  EXCLUSIVE
		SET ORDER TO
   *****************	    INDEX ON pedido TAG pedido ADDITIVE
		GO TOP
 	    DO brappend
		SCATTER MEMVAR
GO TOP

DO WHILE !EOF()
	=ULsomvalor("SOMA")
	SKIP
ENDDO
GO TOP
****
isediting = .T.   && PERMITIR A EDICAO DOS CAMPOS OBJ_PRSO
******

LFjanela = 3
CLEAR TYPEAHEAD

**********************************************

SET SYSMENU ON
PUSH MENU _MSYSMENU
SET SYSMENU TO _MWINDOW, _MWI_ZOOM,_MWI_MOVE, _MEDIT, _MED_FIND, ;
			_MED_FINDA
ON KEY LABEL F10    KEYBOARD "{CTRL-F10}"
HIDE MENU _MSYSMENU




*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨              SCGC240A/MS-DOS Screen Layout              ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*

#REGION 1
IF WVISIBLE("scgc240a")
	ACTIVATE WINDOW scgc240a SAME
ELSE
	ACTIVATE WINDOW scgc240a NOSHOW
ENDIF
@ 2,19 SAY "+" ;
	SIZE 1,1, 0
@ 2,28 SAY "+" ;
	SIZE 1,1, 0
@ 2,37 SAY "+" ;
	SIZE 1,1, 0
@ 2,46 SAY "+" ;
	SIZE 1,1, 0
@ 4,54 SAY "%IPI" ;
	SIZE 1,4, 0
@ 4,20 SAY "%" ;
	SIZE 1,1, 0
@ 4,59 SAY "====>" ;
	SIZE 1,5, 0
@ 2,2 GET M.DESC_1 ;
	SIZE 1,8 ;
	DEFAULT " " ;
	PICTURE "99.99999" ;
	WHEN isediting AND LFjanela = 1
@ 2,11 GET M.DESC_2 ;
	SIZE 1,8 ;
	DEFAULT " " ;
	PICTURE "99.99999" ;
	WHEN isediting AND LFjanela = 1
@ 2,20 GET M.DESC_3 ;
	SIZE 1,8 ;
	DEFAULT " " ;
	PICTURE "99.99999" ;
	WHEN isediting AND LFjanela = 1
@ 2,29 GET M.DESC_4 ;
	SIZE 1,8 ;
	DEFAULT " " ;
	PICTURE "99.99999" ;
	WHEN isediting AND LFjanela = 1
@ 2,38 GET M.DESC_5 ;
	SIZE 1,8 ;
	DEFAULT " " ;
	PICTURE "99.99999" ;
	WHEN isediting AND LFjanela = 1
@ 2,47 GET M.DESC_6 ;
	SIZE 1,8 ;
	DEFAULT " " ;
	PICTURE "99.99999" ;
	WHEN isediting AND LFjanela = 1
@ 4,15 GET M.DESC_T ;
	SIZE 1,5 ;
	DEFAULT " " ;
	PICTURE "99.99" ;
	WHEN _2lx0oxe8f()
@ 4,66 GET M.ALIQ_IPI ;
	SIZE 1,5 ;
	DEFAULT " " ;
	PICTURE "99.99" ;
	WHEN isediting AND LFjanela = 1
@ 0,0 TO 5,74 ;
	COLOR SCHEME 23
@ 5,1 TO 5,73 ;
	COLOR SCHEME 24
@ 5,74 SAY "ы" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,74 TO 4,74 ;
	COLOR SCHEME 24
@ 0,74 SAY "©" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,1 TO 3,73 ;
	COLOR SCHEME 23
@ 3,2 TO 3,72 ;
	COLOR SCHEME 24
@ 3,73 SAY "ы" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 2,73 SAY "Ё" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,73 SAY "©" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,14 SAY "[ Descontos (%) ]" ;
	SIZE 1,17, 0
@ 0,66 SAY "[240A]" ;
	SIZE 1,6, 0
@ 2,55 SAY "+" ;
	SIZE 1,1, 0
@ 2,61 SAY "+" ;
	SIZE 1,1, 0
@ 2,67 SAY "+" ;
	SIZE 1,1, 0
@ 2,56 GET M.DESC_7 ;
	SIZE 1,5 ;
	DEFAULT " " ;
	PICTURE "99.99" ;
	WHEN isediting AND LFjanela = 1
@ 2,62 GET M.DESC_8 ;
	SIZE 1,5 ;
	DEFAULT " " ;
	PICTURE "99.99" ;
	WHEN isediting AND LFjanela = 1
@ 2,68 GET M.DESC_9 ;
	SIZE 1,5 ;
	DEFAULT " " ;
	PICTURE "99.99" ;
	WHEN isediting AND LFjanela = 1
@ 2,10 SAY "+" ;
	SIZE 1,1, 0
@ 4,3 SAY "Desconto..:" ;
	SIZE 1,11, 0
@ 4,38 SAY "%" ;
	SIZE 1,1, 0
@ 4,33 GET M.IVA ;
	SIZE 1,5 ;
	DEFAULT " " ;
	PICTURE "99.99" ;
	WHEN _2lx0oxe8o()
@ 4,27 SAY "IVA.:" ;
	SIZE 1,5, 0




*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨              SCGC240B/MS-DOS Screen Layout              ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*

#REGION 2
IF WVISIBLE("obj_vlro")
	ACTIVATE WINDOW obj_vlro SAME
ELSE
	ACTIVATE WINDOW obj_vlro NOSHOW
ENDIF
@ 0,0 TO 2,11 ;
	COLOR SCHEME 23
@ 2,1 TO 2,10 ;
	COLOR SCHEME 24
@ 2,11 SAY "ы" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,11 SAY "Ё" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 0,11 SAY "©" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,1 GET LNSliq ;
	SIZE 1,10 ;
	DEFAULT 0 ;
	PICTURE "999,999.99" ;
	WHEN .f.
@ 0,13 TO 2,24 ;
	COLOR SCHEME 23
@ 2,14 TO 2,23 ;
	COLOR SCHEME 24
@ 2,24 SAY "ы" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,24 SAY "Ё" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 0,24 SAY "©" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,14 GET LNSipi ;
	SIZE 1,10 ;
	DEFAULT 0 ;
	PICTURE "999,999.99" ;
	WHEN .f.
@ 0,26 TO 2,37 ;
	COLOR SCHEME 23
@ 2,27 TO 2,36 ;
	COLOR SCHEME 24
@ 2,37 SAY "ы" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,37 SAY "Ё" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 0,37 SAY "©" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,27 GET LNSicmr ;
	SIZE 1,10 ;
	DEFAULT 0 ;
	PICTURE "999,999.99" ;
	WHEN .f.
@ 0,41 TO 2,52 ;
	COLOR SCHEME 23
@ 2,42 TO 2,51 ;
	COLOR SCHEME 24
@ 2,52 SAY "ы" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,52 SAY "Ё" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 0,52 SAY "©" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,42 GET LNStot ;
	SIZE 1,10 ;
	DEFAULT 0 ;
	PICTURE "999,999.99" ;
	WHEN .f.
@ 0,1 SAY "Liq.Merc." ;
	SIZE 1,9, 0
@ 0,14 SAY "IPI" ;
	SIZE 1,3, 0
@ 0,27 SAY "Retido" ;
	SIZE 1,6, 0
@ 1,39 SAY "=" ;
	SIZE 1,1, 0
@ 1,25 SAY "+" ;
	SIZE 1,1, 0
@ 1,12 SAY "+" ;
	SIZE 1,1, 0
@ 0,42 SAY "Pedido" ;
	SIZE 1,6, 0




*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨              OBJ_ITPD/MS-DOS Screen Layout              ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*

#REGION 3
IF WVISIBLE("item")
	ACTIVATE WINDOW item SAME
ELSE
	ACTIVATE WINDOW item NOSHOW
ENDIF
@ 1,2 GET GET_1ITEM ;
	SIZE 1,1 ;
	DEFAULT " " ;
	WHEN _2lx0oxe90()

IF NOT WVISIBLE("item")
	ACTIVATE WINDOW item
ENDIF
IF NOT WVISIBLE("obj_vlro")
	ACTIVATE WINDOW obj_vlro
ENDIF
IF NOT WVISIBLE("scgc240a")
	ACTIVATE WINDOW scgc240a
ENDIF


READ CYCLE ;
	WHEN LFjanela = 3 ;
	DEACTIVATE !isediting ;
	SHOW LFjanela = 3

RELEASE WINDOW item
RELEASE WINDOW obj_vlro
RELEASE WINDOW scgc240a

#REGION 0
IF m.talkstat = "ON"
	SET TALK ON
ENDIF
IF m.compstat = "ON"
	SET COMPATIBLE ON
ENDIF


*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨              SCGC240A/MS-DOS Cleanup Code               ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*

#REGION 1
	PRIVATE LFnovitem
	LFnovitem = .f.

	POP MENU _MSYSMENU
	SET SYSMENU OFF
	isediting = .F.   && INIBIE A EDICAO DOS CAMPOS SCGC240A
	IF LEFT(m.situacao,1) = "A"
		SET POINT TO ","
		SET SEPARATOR  TO "."
	ENDIF
	RELEASE WINDOW ITEM
	SET FORMAT TO
	#DEFINE C_ABORTA      'Deseja Gravar as Alteracoes ?.'
	*<<<<<<<<<<<<<<<<<<<<<<<<<<---------->>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>*
	*----- INICIO - VRIFICA SE E NECESSARIO PROCESSAR GRAVACAO DE ITENS ---*
	*<<<<<<<<<<<<<<<<<<<<<<<<<<---------->>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>*

	IF LASTKEY() = 27
		DO ULfecha
   		RETURN
	ENDIF
	*----------------------------------------------------------------*
	SELE pedite
	SET ORDER TO TAG pedido

	SELECT &wl_arqtmp
	SET ORDER TO
	SET DELE OFF		&& VISUALIZAR APGADOS NO TEMPORARIO P/ APGAR NO
					&& PRINCIPAL
	GO TOP
	DO WHILE !EOF()
		SCATTER MEMVAR
		m.situacao = "B"
		IF DELETED()
			SELE pedite
			SET DELE ON		&& NAO VISUALIZAR APGADOS NO ARQ PRINCIPAL
			SEEK STR(m.empresa,3)+STR(m.pedido,6)+m.codigo
			IF FOUND()
				m.situacao = "C"
        	   =REGLOCK(.T.)
			   =EDITHAND("APAGA")
			ENDIF
		ELSE
			SELE pedite
			SET DELE ON		&& NAO VISUALIZAR APGADOS NO ARQ PRINCIPAL
			SEEK STR(m.empresa,3)+STR(m.pedido,6)+m.codigo
			IF FOUND()
	          	m.qtdetr	= pedite.qtdetr		&& ALTERAR SO EM PROCESSO
    	      	m.qtdeatd	= pedite.qtdeatd	&& ALTERAR SO EM PROCESSO
				IF m.qtde <= qtdeatd
					m.situacao = "C"
				ENDIF
        	   =REGLOCK(.T.)
			   =EDITHAND("REGRAVA")
			ELSE
        	   =REGLOCK(.T.)
			   =EDITHAND("SAVE")
			   LFnovitem = .t.						
			ENDIF
	        m.total_ped = m.total_ped +	;
				          &wl_arqtmp .vlrcompra + ;
        				  &wl_arqtmp .vlripi	+ ;
        				  &wl_arqtmp .vlrretido
		ENDIF


		SELECT &wl_arqtmp
		SET DELE OFF		&& VISUALIZAR APGADOS NO TEMPORARIO P/ APGAR NO
		SKIP
	ENDDO
	SET DELE ON		&& NAO VISUALIZAR APGADOS NO ARQ PRINCIPAL
	SELE pedido
	DO ULfecha
RETURN




*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨  SCGC240A/MS-DOS Supporting Procedures and Functions    ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*

#REGION 1
PROCEDURE ULfecha
	=UP_fecha("&wl_arqtmp")
	wp_flgfecha = .F. 		&& defaut nao fechamento da secao
	IF !EMPTY(wl_areant)
		SELECT &wl_areant
	ENDIF
	ON KEY LABEL ESCAPE
	POP KEY 			&& reabilita teclas de atalho def. anteriormente
	SET FORMAT TO
RETURN

*<<<<<<<<<<<<<<<<<<<<<<<<<<---------->>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>*
*----- ROTINAS DE APOIO A EXECUCAO DO PROGRAMA                      ---*
*<<<<<<<<<<<<<<<<<<<<<<<<<<---------->>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>*
*
*  CENTRAL DE CONTROLE DO BROWSE / EDI─гO
*----------------------------------------------------------------------*

FUNCTION ULinfcamp	&& mantem variavel com nome do campo em edicao
	PARAMETERS Lcmp,Loper
		LSposcampo = Lcmp

		SAVE SCREEN TO LSsvtela	&& SO P/ INICIALISAR

		AKEY= LASTKEY()
		*===<<< ============================================== >>>===*
		*===<<<  TESTAR SAIDA			              		   >>>===*
		*===<<< ============================================== >>>===*
		IF  AKEY = 23 AND Loper <> "W"		&& CTRL-END
			CLEAR TYPEAHEAD
			CLEAR TYPEAHEAD
			IF  &wl_arqtmp .codigo <> LScodant
				IF !ULverprod()
					SELE &wl_arqtmp
					REPLACE &wl_arqtmp .codigo	WITH  SPACE(11)
					DEACTIVATE WINDOWS ITENS
			    	SHOW WINDOW ITEM TOP
					ACTIVATE WINDOWS ITENS TOP
				    SHOW WINDOW ITENS REFRESH TOP
				ENDIF
			ENDIF
			IF !ULversaida()
				Lcmp = "ATVJAN-3"
			ENDIF
		ENDIF						
		************************************************************
		IF !ISEDITING
			RETURN(.T.)
		ENDIF
		*===<<< ROTINAS TRATADAS NA ENTRADA OU SAIDA DE CAMPOS >>>===*
		*===<<< ============================================== >>>===*
		*===<<<  EXIBIR JANELAS 		O              		   >>>===*
		*===<<< ============================================== >>>===*
		IF  Lcmp = "ATVJAN-1"
			LFjanela = 1
			CLEAR TYPEAHEAD
			ACTIVATE WINDOW SCGC240A TOP
			SHOW WINDOW SCGC240A TOP
			SHOW GETS
		ENDIF
		IF  Lcmp = "ATVJAN-3"
		    LFjanela = 3
			CLEAR TYPEAHEAD
			DEACTIVATE WINDOWS ITENS
		    SHOW WINDOW ITEM TOP
			ACTIVATE WINDOWS ITENS TOP
		    SHOW WINDOW ITENS REFRESH TOP
			SHOW GETS
		ENDIF
		*===<<< ============================================== >>>===*
		*===<<<  FORCAR BUSCA DO PRECO DE TABELA    		   >>>===*
		*===<<< ============================================== >>>===*
		IF  Lcmp = "PRECOTAB"
			 =ULsomvalor("ANTERIOR")	&& retirar valores nos tatais
			 =ULverprod()
			 =ULverqtde()
			 =ULsomvalor("SOMA")	&& acrescentar valores nos tatais
			 =ULsomvalor("ANTERIOR")	&& retirar valores nos tatais
			 CLEAR TYPEAHEAD
			 DEACTIVATE WINDOWS ITENS
		     SHOW WINDOW ITEM TOP
			 ACTIVATE WINDOWS ITENS TOP
		     SHOW WINDOW ITENS REFRESH TOP
			 SHOW GETS
			 =ULatualiza()
			 RETURN(.T.)
		ENDIF
		*===<<< ============================================== >>>===*
		*===<<<  LOCALIZACAO DE CODIGO              		   >>>===*
		*===<<< ============================================== >>>===*
		IF  Lcmp = "ATVJAN-4"
		    LFjanela = 4
			CLEAR TYPEAHEAD
			DO SCGC800D.SPR WITH &wl_arqtmp .empresa, &wl_arqtmp .pedido
		    LFjanela = 3
			CLEAR TYPEAHEAD
		    SHOW WINDOW ITENS REFRESH TOP
			SHOW GETS
			RETURN(.T.)
		ENDIF
		*===<<< ============================================== >>>===*
		*===<<<  RETORNO DE REGISTRO PELA TECLA ESC			   >>>===*
		*===<<< ============================================== >>>===*
		IF  Loper $ "W" AND (AKEY = 27 OR AKEY = 15) AND LCmp $ "QTDE"
			=ULsomvalor("ANTERIOR")	&& retirar valores nos tatais
									&& como nao vai ate o final da rotina
									&& compensa
			CLEAR TYPEAHEAD
			KEYBOARD "{UPARROW}"
			DEACTIVATE WINDOWS ITENS
		    SHOW WINDOW ITEM TOP
			ACTIVATE WINDOWS ITENS TOP
		    SHOW WINDOW ITENS REFRESH TOP
			RETURN(.T.)
		ENDIF
		*===<<< ============================================== >>>===*
		*===<<<  AVANCO DE LINHA PELA TECLA ENTER  			   >>>===*
		*===<<< ============================================== >>>===*
		IF  Loper = "W" AND AKEY = 13 AND LCmp $ "FORNECEDOR"
	    	CLEAR TYPEAHEAD
			LNrgant = RECNO()
			SKIP
			IF EOF()
				DO brappend
			ENDIF
			GO LNrgant
	    	CLEAR TYPEAHEAD
			KEYBOARD "{DNARROW}"
			DEACTIVATE WINDOWS ITENS
		    SHOW WINDOW ITEM TOP
			ACTIVATE WINDOWS ITENS TOP
		    SHOW WINDOW ITENS REFRESH TOP
			RETURN(.T.)
		ENDIF
		*===<<< ============================================== >>>===*
		*===<<<  F4 - NEGOCIA CONDICOES                 	   >>>===*
		*===<<< ============================================== >>>===*
		IF  Lcmp = "ATVJAN-6"
		    LFjanela = 6
			DO ULcombina
		    LFjanela = 3
			CLEAR TYPEAHEAD
		    SHOW WINDOW ITENS REFRESH TOP
			SHOW GETS
		ENDIF
		IF  LFjanela <>  3
			RETURN
		ENDIF
		*===<<< ============================================== >>>===*
		*===<<<  TABELA DE PRODUTO TECLA TAB EM CODIGO 		   >>>===*
		*===<<< ============================================== >>>===*
		IF  AKEY = 9 AND LCmp $ "CODIGO" AND Loper = "V"
	    	CLEAR TYPEAHEAD
		   	SELECT grupo
		    SET ORDER TO  TAG codigo
		    SET NEAR ON
		    SEEK RTRIM(&wl_arqtmp .codigo)
	        SET NEAR OFF
			ON KEY LABEL ESCAPE
	    	DO brbrow
			ON KEY LABEL ESCAPE	KEYBOARD "{BACKTAB}"
		    IF LASTKEY() = 27  OR !(left(situacao,1) $ "A")
	    	   RETURN(.F.)
			ENDIF
			=INKEY(0.001)
	    	CLEAR TYPEAHEAD
	    	CLEAR TYPEAHEAD
			REPLACE &wl_arqtmp .codigo     WITH  grupo.codigo
			AKEY = 13			&& ASSUMIR A VALIDACAO <ENTER>
		ENDIF
		*===<<< ============================================== >>>===*
		*===<<<  VERRIFICACAO DO CAMPO CODIGO       		   >>>===*
		*===<<< ============================================== >>>===*
		*--<<<<<<<<< TESTE PARA CONF. NOVO CODIGO SO COM ENTER >>>>---
		IF  Loper = "W" AND LCmp $ "CODIGO"
			LScodant	= &wl_arqtmp .codigo
			IF !(left(situacao,1) $ "A")
				RETURN(.F.)
			ENDIF
		ENDIF	
		IF  Loper = "V" AND LCmp $ "CODIGO" AND AKEY <> 13
			REPLACE  &wl_arqtmp .codigo WITH LScodant
		ENDIF	
		IF  Loper = "V" AND LCmp $ "CODIGO"
			IF  &wl_arqtmp .codigo <> LScodant
				IF !ULverprod()
					SELE &wl_arqtmp
					REPLACE &wl_arqtmp .codigo	WITH  SPACE(11)
					DEACTIVATE WINDOWS ITENS
			    	SHOW WINDOW ITEM TOP
					ACTIVATE WINDOWS ITENS TOP
				    SHOW WINDOW ITENS REFRESH TOP
					IF AKEY <> 27 AND AKEY <> 15 AND AKEY <> 5 AND ;
					   AKEY <> 9
						RETURN(.F.)
					ENDIF		
				ENDIF
			ENDIF
		ENDIF						
		*===<<< ============================================== >>>===*
		*===<<<  VERRIFICACAO DO CAMPO QTDE       		   >>>===*
		*===<<< ============================================== >>>===*
		IF  Loper = "V" AND LCmp $ "QTDE"
			=ULverqtde()
		ENDIF						
    	CLEAR TYPEAHEAD
		=INKEY(0.001)
    	CLEAR TYPEAHEAD
		*===<<< ============================================== >>>===*

		*--------------------------------------------------------------*
		* O usuario Master Pode Editar os Campos Independente da Situacao
		*--------------------------------------------------------------*
		IF Loper = "W" ;
			AND !(left(situacao,1) $ "A") ;
			AND (LCmp $ "/FILIAL/CODIGO/")
				    RETURN(.F.)
		ENDIF

		IF !(LCmp $ "FORNECEDOR/FILIAL/CODIGO/QTDE") && /QTDETR/QTDEATD")
				RETURN(.F.)
		ENDIF

		*----------------------------------------------------------*
		IF !(LCmp $ "CODIGO/QTDE")
				RETURN(.T.)
		ENDIF
		DO CASE
		   CASE Loper = "W"  && QUANDO => ENTRADA NO CAMPO
				=ULsomvalor("ANTERIOR")	&& retirar valores nos tatais
		   CASE Loper = "V"  && VALIDE => SAIDA DO CAMPO
				=ULsomvalor("SOMA")	&& acrescentar valores nos tatais
		ENDCASE

RETURN(.T.)


***************************************************************
*------------->>>>>>>>
***************************************************************

FUNCTION ULverprod
	SHOW GET DESC_1
   	SELECT grupo
    SET ORDER TO  TAG codigo
    SEEK RTRIM(&wl_arqtmp .codigo)
    IF FOUND()
       SET NEAR OFF
       SELECT pedite
	   SELE &wl_arqtmp
	   DO ULatrcampo
       RETURN .T.
    ENDIF
    SET NEAR OFF
	REPLACE &wl_arqtmp .codigo	WITH  SPACE(11)
RETURN .F.

FUNCTION ULverqtde		&& CALCULA O VALOR DE COMPAR
		*************************************************************
		* VARIAVEIS PARA RECEBER VALORES CALCULADOS NA ROT. UPcalcust
		*************************************************************
		LNaliq_frete = 0
		STORE 0 TO  m.preco_liq,m.vlr_ipi,;
				    m.custo_ini,m.vlr_frete,m.vlr_adicional,;
				    m.vlr_icmc,m.vlr_retido,m.custo_total,;
				    m.preco_compra
		*------------------- Calculo do Preco Final ------------------*
		IF pedido.vendor = 1
			LNvendor =  &wl_arqtmp  .avindice
		ELSE
			LNvendor =  &wl_arqtmp  .apindice
		ENDIF
		DO UPcalcusto WITH ;
			 &wl_arqtmp .qtde ,&wl_arqtmp .preco_tab, &wl_arqtmp .desc_t,;
			 &wl_arqtmp .aliq_ipi, LNaliq_frete, &wl_arqtmp .aliq_icmr,;
			 &wl_arqtmp .IVA, &wl_arqtmp .aliq_icmc, LNvendor, m.preco_liq,;
			 m.vlr_ipi, m.custo_ini,m.vlr_frete,m.vlr_adicional,;
		     m.vlr_icmc,m.vlr_retido,m.custo_total,;
			 0,0,0,;
			 m.preco_compra,0
		********************************************************************
		REPLACE &wl_arqtmp .vlrcompra WITH m.preco_compra
		REPLACE &wl_arqtmp .vlripi    WITH m.vlr_ipi
		REPLACE &wl_arqtmp .vlrretido WITH m.vlr_retido
RETURN(.T.)


FUNCTION ULversaida     && VERIFICA O INTERESSE DE SAIDA
	   CLEAR TYPEAHEAD
	   LCtmp = foxalert2('Confirma edicao e grava itens ?')
	   IF LCtmp = "S"
		  	  isediting = .F.   && INIBIE A EDICAO DOS CAMPOS SCGC240A
		  	  ON KEY LABEL ESCAPE
		      KEYBOARD '{CTRL-W}'
			  RETURN(.T.)
   	   ELSE	
   		   IF LCtmp = "N"   && abandonar
			  ON KEY LABEL ESCAPE
			  KEYBOARD CHR(27)
			  isediting = .F.   && INIBIE A EDICAO DOS CAMPO OBJ_PRSO
			  RETURN(.T.)
		   ENDIF
	   ENDIF					
RETURN(.F.)

PROCEDURE brbrow
   	SELECT grupo
    SET ORDER TO TAG classifica

	DO loc_dlog WITH .T.

    IF !(LEFT(&wl_arqtmp .situacao,1) $ "A")
       WAIT WINDOW " Registro nao esta ABERTO, nao pode ser alterado."
       SELECT &wl_arqtmp
       RETURN
    ENDIF
    SELECT &wl_arqtmp
RETURN

PROCEDURE ULatrcampo
	REPLACE &wl_arqtmp .codigo     WITH  grupo.codigo
	REPLACE &wl_arqtmp .classifica WITH  grupo.classifica
	REPLACE &wl_arqtmp .ordem      WITH  grupo.ordem
	SELE tabforn
	SET ORDER TO TAG tabela
	SEEK STR(&wl_arqtmp .codforn,5)+&wl_arqtmp .codigo
	IF FOUND()
		IF !EMPTY(tabforn.grp_desc)
			SELE dsctforn
			SET ORDER TO TAG tabela
			SEEK STR(&wl_arqtmp .codforn,5)+tabforn.grp_desc
			IF !FOUND()
				SELE tabforn
			ENDIF			
		ENDIF
		SCATTER MEMVAR fields desc_1,desc_2,desc_3,desc_4,desc_5,desc_6,;
						desc_7,desc_8,desc_9,desc_t,;
						avindice,apindice,aliq_ipi,aliq_icmr,aliq_icmc,;
						iva
		m.preco_tab  = tabforn.preco_tab
		REPLACE &wl_arqtmp .aliq_ipi   WITH  m.aliq_ipi
		REPLACE &wl_arqtmp .aliq_icmr  WITH  m.aliq_icmr
		REPLACE &wl_arqtmp .aliq_icmc  WITH  m.aliq_icmc
		REPLACE &wl_arqtmp .iva		   WITH  m.iva
		REPLACE &wl_arqtmp .preco_tab  WITH  tabforn.preco_tab
		REPLACE &wl_arqtmp .desc_1     WITH  m.desc_1
		REPLACE &wl_arqtmp .desc_2     WITH  m.desc_2
		REPLACE &wl_arqtmp .desc_3     WITH  m.desc_3
		REPLACE &wl_arqtmp .desc_4     WITH  m.desc_4
		REPLACE &wl_arqtmp .desc_5     WITH  m.desc_5
		REPLACE &wl_arqtmp .desc_6     WITH  m.desc_6
		REPLACE &wl_arqtmp .desc_7     WITH  m.desc_7
		REPLACE &wl_arqtmp .desc_8     WITH  m.desc_8
		REPLACE &wl_arqtmp .desc_9     WITH  m.desc_9
		REPLACE &wl_arqtmp .desc_t     WITH  m.desc_t
		REPLACE &wl_arqtmp .avindice   WITH  m.avindice
		REPLACE &wl_arqtmp .apindice   WITH  m.apindice
		*------------- Calculo do Preco Final --------------*
		STORE 0 TO m.preco_compra
		LNvendor =  m.avindice
		DO UPcalcusto WITH ;
					 1,m.preco_tab,m.desc_t,m.aliq_ipi,0,0,;
						0,0,LNvendor,0,0,;
				    	0,0,0,;
					    0,0,0,;
					    0,0,0,;
					    m.preco_compra,0
		m.preco_normal= m.preco_compra
		*--------------------------------------------------*
		LNvendor =  m.apindice
		DO UPcalcusto WITH ;
					 1,m.preco_tab,m.desc_t,m.aliq_ipi,0,0,;
						0,0,LNvendor,0,0,;
			    		0,0,0,;
				    	0,0,0,;
					    0,0,0,;
					    m.preco_compra,0
		m.preco_vendor= m.preco_compra
		*--------------------------------------------------*
		REPLACE &wl_arqtmp .preco_normal WITH m.preco_normal
		REPLACE &wl_arqtmp .preco_vendor WITH m.preco_vendor
	ENDIF
    SELECT &wl_arqtmp
RETURN

PROCEDURE  brtotal
  PARAMETERS wl_ms
     GO TOP
     m.valor     = 0
	 m.LNqtde    =  0 	&& soma das qtdes
	 m.LNbs_ipi  = 0         && base para calculo ipi
	 m.LNbs_icms = 0         && base para calculo icms
	 m.LNbs_subs = 0	     && base para calculo subs
     m.LNbs_sbbrt= 0	     && base para abater icms do icms da subs
	 m.LNbs_iss  = 0        && base para calculo iss
	 m.LNbs_isen = 0        && mercadorias isentas
	 m.LNbs_outr = 0        && outras tributacoes
	 m.LNalqicms = 0		&& aliquota de icms
	 m.LNalqiss  = 0		&& aliquota de iss
	 m.LNicms 	 = 0		&& valor de icms
	 m.LNsubs 	 = 0		&& valor de icms por substituicao
	 m.LNiss  	 = 0		&& valor de iss
	 m.LNtotprod  = 0		&& soma dos valores dos produtos
	 m.LNtot  	 = 0		&& total da nota

     DO WHILE !EOF()
*		DO UPimpent
        skip
     ENDDO
     skip -1
	 m.LNtot  = m.valor + LNbs_ipi + m.LNsubs + ;
				m.vlrfrete + m.vlrdespes + m.vlrseguro
	 m.valor 		= m.LNtot
	 m.totproduto 	= m.LNtotprod
	 m.vlr_ipi		= m.LNbs_ipi
     m.base_icms	= m.LNbs_icms
     m.vlr_icms		= m.LNicms
     m.base_subs	= m.LNbs_subs
	 m.base_sbbrt	= m.LNbs_sbbrt
     m.icms_subs	= m.LNsubs
     m.base_isent	= m.LNbs_isen
	 m.total_nota	= m.LNtot
	******************  VALOR PARA FECHAMENTO ********************
	m.soma_comp  = (m.LNqtde/100) + m.totproduto + m.vlr_ipi ;
					+  m.vlr_icms + m.base_subs	+  m.icms_subs ;
                    +  m.vlrfrete + m.vlrdespes + m.vlrseguro	
	***************************************************************

     IF wl_ms
        DO OBJ_MENS.SPR WITH  ;
        "[Merc:"+ALLTRIM(transform(m.LNtotprod,"@RT 999,999.99"))+;
		"] [ISS:"+ALLTRIM(transform(m.LNiss,"@RT 999,999.99"))+;
		"] [ICMS:"+ALLTRIM(transform(m.LNicms,"@RT 999,999.99"))+;
		"] [IPI:"+ALLTRIM(transform(m.LNbs_ipi,"@RT 999,999.99"))+;
        "] [Base Subs:"+ALLTRIM(transform(m.LNbs_subs,"@RT 999,999.99"))+;
        "] [Subs:"+ALLTRIM(transform(m.LNsubs,"@RT 999,999.99"))+;
        "] =>"+ALLTRIM(transform(m.LNtot,"@RT 999,999.99"))+ ;
        "-----------------"+;
        "] [FECHAM.INF.:"+ALLTRIM(transform(m.soma_qtde,"@RT 999,999.99"))+;
        "] [FECHAM.ENC.:"+ALLTRIM(transform(m.soma_comp,"@RT 999,999.99"))
     ENDIF

RETURN

****-------------->>>>>

PROCEDURE brdeleta
  IF &wl_arqtmp .qtdetr+&wl_arqtmp .qtdeatd > 0
      WAIT WINDOW " Registro com TRANS/ATENDIMENTO, nao pode ser apagado."
      RETURN
  ENDIF
  IF DELETED()
	 =ULsomvalor("ANTERIOR")	&& retirar valores nos tatais
     RECALL
	 =ULsomvalor("SOMA")	&& acrescentar valores nos tatais
  ELSE
	 =ULsomvalor("ANTERIOR")	&& retirar valores nos tatais
     DELETE
	 =ULsomvalor("SOMA")	&& acrescentar valores nos tatais
  ENDIF
  =ULsomvalor("ANTERIOR")	&& retirar valores nos tatais
  =ULatualiza()
RETURN

****-------------->>>>>

PROCEDURE brappend
  SELE &wl_arqtmp
  APPEND BLANK
  GATHER MEMVAR FIELDS EMPRESA, DATA
  REPLACE FAVORECIDO WITH m.favorecido
*  REPLACE CODFORN    WITH m.codforn
  REPLACE pedido     WITH m.pedido
  REPLACE CODIGO     WITH SPACE(11)
  REPLACE situacao with "A"+RIGHT(situacao,1)
RETURN
**---->

FUNCTION ULatualiza
	REPLACE &wl_arqtmp .marcador WITH ""
	SCATTER MEMVAR
	SHOW GET M.DESC_T
	SHOW GET m.desc_1
	SHOW GET m.desc_2
	SHOW GET m.desc_3
	SHOW GET m.desc_4
	SHOW GET m.desc_5
	SHOW GET m.desc_6
	SHOW GET m.desc_t
	SHOW GET m.IVA
	SHOW GET LNSliq
 	SHOW GET LNSipi
 	SHOW GET LNSicmr
 	SHOW GET LNStot

	IF m.aliq_ipi = 3
		SHOW GET m.aliq_ipi COLOR W/R,GR+/R
		SET COLOR OF SCHEME 10 TO ,,,,,,GR+/R
	else
		SHOW GET m.aliq_ipi COLOR W/B,W+/B
		SET COLOR OF SCHEME 10 TO ,,,,,,W+/B
	ENDIF
RETURN(.T.)

FUNCTION  ULsai
*	IF LASTKEY() <> 3
		REPLACE &wl_arqtmp .marcador WITH " "
*	ENDIF
RETURN(.T.)


FUNCTION ULsomvalor
PARAMETERS	LSoperar		&& "ANTERIOR" => REGISTRAR VLRS ANTERIORES
							&& "SOMA"	  => OPERAR SOMA DOS VALORES
	SELE &wl_arqtmp
	IF LSoperar	= "ANTERIOR" 	&& => REGISTRAR VLRS ANTERIORES
		IF DELETED()
		 	LNSliqANT = 0
 			LNSipiANT = 0
	 		LNSicmrANT= 0
		ELSE
		 	LNSliqANT = &wl_arqtmp .vlrcompra
 			LNSipiANT = &wl_arqtmp .vlripi
	 		LNSicmrANT= &wl_arqtmp .vlrretido
		ENDIF
	ELSE
		IF DELETED()
		 	LNSliq	=	LNSliq - LNSliqANT
 			LNSipi	=	LNSipi - LNSipiANT
		 	LNSicmr	=	LNSicmr- LNSicmrANT
			LNStot  =   LNSliq + LNSipi + LNSicmr
		ELSE
		 	LNSliq	=	LNSliq - LNSliqANT  + &wl_arqtmp .vlrcompra
 			LNSipi	=	LNSipi - LNSipiANT  + &wl_arqtmp .vlripi
		 	LNSicmr	=	LNSicmr- LNSicmrANT + &wl_arqtmp .vlrretido
			LNStot  =   LNSliq + LNSipi + LNSicmr
		ENDIF
	ENDIF
RETURN(.T.)	


FUNCTION ULcombina
 		LNpreco		=   &wl_arqtmp  .preco_tab
		LNdesc_1	=	&wl_arqtmp  .desc_1
		LNdesc_2	=	&wl_arqtmp  .desc_2
		LNdesc_3	=	&wl_arqtmp  .desc_3
		LNdesc_4	=	&wl_arqtmp  .desc_4
		LNdesc_5	=	&wl_arqtmp  .desc_5
		LNdesc_6	=	&wl_arqtmp  .desc_6
		LNdesc_7	=	&wl_arqtmp  .desc_7
		LNdesc_8	=	&wl_arqtmp  .desc_8
		LNdesc_9	=	&wl_arqtmp  .desc_9
		LNdesc_t	=	&wl_arqtmp  .desc_t
		LNavindice	=	&wl_arqtmp  .avindice
		LNapindice	=	&wl_arqtmp  .apindice

		*------------------------------------------------------------*
		* OBJ_800A.SPR 	= AInformar descontos especificos,alterar
		*				  preco de tabela de um produto
		*------------------------------------------------------------*
		wp_retorno(1) = 0
		DO  OBJ_800A.SPR WITH ;
					&wl_arqtmp .codforn, codigo, ;
				    grupo.descricao,LNpreco,;
					LNdesc_1,LNdesc_2,LNdesc_3,LNdesc_4,LNdesc_5,LNdesc_6,;
					LNdesc_7,LNdesc_8,LNdesc_9,;
					LNdesc_t,LNavindice,LNapindice
		*------------------------------------------------------------*
		IF wp_retorno(1) > 0	&& FOI ALTERADO E CONFIRMADO COM <OK>
			=ULsomvalor("ANTERIOR")	&& retirar valores nos tatais
			REPLACE &wl_arqtmp .preco_tab WITH LNpreco
			REPLACE &wl_arqtmp .desc_1 WITH LNdesc_1
			REPLACE &wl_arqtmp .desc_2 WITH LNdesc_2
			REPLACE &wl_arqtmp .desc_3 WITH LNdesc_3
			REPLACE &wl_arqtmp .desc_4 WITH LNdesc_4
			REPLACE &wl_arqtmp .desc_5 WITH LNdesc_5
			REPLACE &wl_arqtmp .desc_6 WITH LNdesc_6
			REPLACE &wl_arqtmp .desc_7 WITH LNdesc_7
			REPLACE &wl_arqtmp .desc_8 WITH LNdesc_8
			REPLACE &wl_arqtmp .desc_9 WITH LNdesc_9
			REPLACE &wl_arqtmp .desc_t WITH LNdesc_t
			REPLACE &wl_arqtmp .avindice WITH LNavindice
			REPLACE &wl_arqtmp .apindice WITH LNapindice
			m.preco_tab  = LNpreco
			m.aliq_ipi	 = &wl_arqtmp .aliq_ipi
			m.desc_t	 = LNdesc_t
			m.avindice	 = LNavindice
			m.apindice	 = LNapindice
			*------------- Calculo do Preco Final --------------*
			STORE 0 TO m.preco_compra
			LNvendor =  m.avindice
			DO UPcalcusto WITH ;
						 1,m.preco_tab,m.desc_t,m.aliq_ipi,0,0,;
							0,0,LNvendor,0,0,;
					    	0,0,0,;
						    0,0,0,;
						    0,0,0,;
						    m.preco_compra,0
			m.preco_normal= m.preco_compra
			*--------------------------------------------------*
			LNvendor =  m.apindice
			DO UPcalcusto WITH ;
						 1,m.preco_tab,m.desc_t,m.aliq_ipi,0,0,;
							0,0,LNvendor,0,0,;
				    		0,0,0,;
					    	0,0,0,;
						    0,0,0,;
						    m.preco_compra,0
			m.preco_vendor= m.preco_compra
			*--------------------------------------------------*
			REPLACE &wl_arqtmp .preco_normal WITH m.preco_normal
			REPLACE &wl_arqtmp .preco_vendor WITH m.preco_vendor
			=ULverqtde()  && PARA ATRIBUIR VALORE COMPRA/IPI/RETIDO
		  	SELE &wl_arqtmp
			=ULsomvalor("SOMA")	&& acrescentar valores nos tatais
		ENDIF
    	CLEAR TYPEAHEAD
	   	CLEAR TYPEAHEAD
	  	SELE &wl_arqtmp
RETURN


*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨ _2LX0OXE8F           M.DESC_T WHEN                      ╨
*       ╨                                                         ╨
*       ╨ Function Origin:                                        ╨
*       ╨                                                         ╨
*       ╨ From Platform:       MS-DOS                             ╨
*       ╨ From Screen:         SCGC240A,     Record Number:   15  ╨
*       ╨ Variable:            M.DESC_T                           ╨
*       ╨ Called By:           WHEN Clause                        ╨
*       ╨ Object Type:         Field                              ╨
*       ╨ Snippet Number:      1                                  ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*
FUNCTION _2lx0oxe8f     &&  M.DESC_T WHEN
#REGION 1
SHOW GET m.desc_T

RETURN(.F.)

*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨ _2LX0OXE8O           M.IVA WHEN                         ╨
*       ╨                                                         ╨
*       ╨ Function Origin:                                        ╨
*       ╨                                                         ╨
*       ╨ From Platform:       MS-DOS                             ╨
*       ╨ From Screen:         SCGC240A,     Record Number:   38  ╨
*       ╨ Variable:            M.IVA                              ╨
*       ╨ Called By:           WHEN Clause                        ╨
*       ╨ Object Type:         Field                              ╨
*       ╨ Snippet Number:      2                                  ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*
FUNCTION _2lx0oxe8o     &&  M.IVA WHEN
#REGION 1
SHOW GET m.desc_T

RETURN(.F.)

*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨ _2LX0OXE90           GET_1ITEM WHEN                     ╨
*       ╨                                                         ╨
*       ╨ Function Origin:                                        ╨
*       ╨                                                         ╨
*       ╨ From Platform:       MS-DOS                             ╨
*       ╨ From Screen:         OBJ_ITPD,     Record Number:    2  ╨
*       ╨ Variable:            GET_1ITEM                          ╨
*       ╨ Called By:           WHEN Clause                        ╨
*       ╨ Object Type:         Field                              ╨
*       ╨ Snippet Number:      3                                  ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*

FUNCTION _2lx0oxe90     &&  GET_1ITEM WHEN
#REGION 3
ON KEY LABEL ENTER
ON KEY LABEL F5     DO ULinfcamp WITH "PRECOTAB" , "X" && SOBREPOR PRECO TAB
ON KEY LABEL F4     DO ULinfcamp WITH "ATVJAN-6" , "X" && NEGOCIACAO
ON KEY LABEL L      DO ULinfcamp WITH "ATVJAN-4" , "X"
ON KEY LABEL END    KEYBOARD "{CTRL-END}"
ON KEY LABEL CTRL-T DO brtotal WITH .T.
ON KEY LABEL ESCAPE	KEYBOARD "{BACKTAB}"
ON KEY LABEL CTRL-Y DO brdeleta
ON KEY LABEL CTRL-N DO brappend

SET POINT TO "."
SET SEPARATOR  TO ","
LNregbrow   = RECNO()
CLEAR TYPEAHEAD
IF LFjanela = 3
		BROWSE  FIELDS ;
				ord=STR(recno(),2)  :H="Nr" :P="99" ;
					:W=ULinfcamp("ORD","W") AND .F.;
					:R,;
				MARCADOR :H=" " ;
					:W=ULinfcamp("MARCADOR","W") AND .F. ;
					:R,;
				CODFORN		:H="FORN";
					:P="@r 99999";
					:W=ULinfcamp("FORNECEDOR","W");
					:V=ULinfcamp("FORNECEDOR","V");
					:F,;
				CODIGO		:H="CODIGO";
					:P=masc_codi;
					:W=ULinfcamp("CODIGO","W");
					:V=ULinfcamp("CODIGO","V");
					:F,;
				EMPRESA 		:H="Filial";
					:P="@r 999";
					:W=ULinfcamp("FILIAL","W");
					:V=ULinfcamp("FILIAL","V");
					:F,;
				QTDE		:H="QTD/PD";
					:P="@r 99,999";
					:W=ULinfcamp("QTDE","W");
					:V=ULinfcamp("QTDE","V");
					:F,;
				QTDETR		:H="TRANS";
					:P="@r 99,999";
					:W=ULinfcamp("QTDETR","W");
					:F,;
				QTDEATD		:H="FAT";
					:P="@r 99,999";
					:W=ULinfcamp("QTDEATD","W");
					:F,;
				PRECO_TAB		:H="$ TAB";
					:P="@r 999,999.99";
					:W=ULinfcamp("PRECO","W") AND left(situacao,1) $ "A" ;
					:V=ULinfcamp("PRECO","V");
					:F,;
				VLRCOMPRA	:H="$ FINAL";
					:P="@r 999,999.99";
					:W=.F.,;
				SITUACAO	:H="";
					:P="@X";
					:W=ULinfcamp("SITUACAO","W") AND .F. ;
				TITLE "ITENS";
				  VALID :F ULsai() ;
				  WHEN ULatualiza() AND LFjanela = 3;
				COLOR SCHEME 10 ;
				  NODELETE NOAPPEND  NOCLEAR NORMAL ;
				  WINDOW ITEM
ENDIF

RETURN(.F.)

*				DESCRICAO	:H="DESC.";
*					:P="@S13" ;
*					:W=.F.,;
*