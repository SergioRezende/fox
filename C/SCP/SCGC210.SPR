*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є 11/24/15             SCGC210.SPR               10:05:22 є
*       є                                                         є
*       ЗДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД¶
*       є                                                         є
*       є Author's Name                                           є
*       є                                                         є
*       є Copyright (c) 2015 Company Name                         є
*       є Address                                                 є
*       є City,     Zip                                           є
*       є                                                         є
*       є Description:                                            є
*       є This program was automatically generated by GENSCRN.    є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є          SCGC210/MS-DOS Setup Code - SECTION 1          є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1
*~ WIZARDSCREEN
#DEFINE C_DBFEMPTY		'Database is empty, add a record?'
#DEFINE C_DELREC		'Apagar Registro Selecionado ?'
#DEFINE C_ENDFILE		'Final do Arquivo.'
#DEFINE C_CANCORCA   	'Confirma o Cancelamento do Orcamento ? '
#DEFINE C_APROORCA   	'Confirma o Aprovacao do Orcamento ?'
*---------------------------------------------------------------------*
* ARQUIVOS UTILIZADOS :                                               *
*              - NOTAENT
*              - NOTAITE
*              - EMPRESA
*              - TIPOOPER
*              - FORNECE
*              - PARAMETR
*              - TPPGTO
*              - TAB_CST
*              - SALDO
*              - ITEMMOV
*              - GRUPO  =>OBJ_ITOR
*              - PROD_CMS  =>OBJ_ITOR
*              - TAB001
*              - TRANSPRT
*              - BANCO
* OBJETIVOS : VENDAS
*	
*---------------------------------------------------------------------*
PRIVATE 	LSaces 	&& PERMITE QUE O ACESSO SEJA VISTO NA
					&& EDICAO DE BASE_ISEN E BASE_OUTR
					&& SE * $ A ACES E PERMITIDA A EDICAO DO ITEM


******>>>> INICIO CONTROLE AMBIENTAL
ON KEY LABEL ESCAPE
m.wzalias	=	SELECT()
m.isediting	=	.F.
m.isadding	=	.F.
m.isreading =   .F.
m.is2table 	= 	.F.
wp_flgfecha = 	.F. 		&& defaut nao fechamento da secao
WP_RECORD 	= 	0
wp_ref_local =  .T.     &&  POSSUI CONTROLE DE REFRESH LOCAL
******************************************************
DIMENSION VTLmotivo[9] && MOTIVOS DAS OPERACOES. ATRIB. CONF OPERACAO
STORE 0 TO VTLmotivo
*******************************************************
LSaces = "   "
wl_cota     = .f.
LDdtant	= {}		&& SE HOUVER MUDANCA NA DATA DO BOLETIM
					&& ATUALIZARA A HORA (QUANDO O TRANSITO E
					&&	LANCADO REGISTRA DATA E HORA E QUANDO
					&& CHEGA MERC. MUDA DATA E HORA FICAVA A ANTIGA



iscancela   = .f.
isediprz    = .t.     && Permite ou nao a edicao dos prasos
isitens     = .f.     && indica se houve edicao doas itens durante ed. orca.
m.cgcfornece = SPACE(14)
******>>>> INICIO CONTROLE ARQUIVOS
*>> parametros repassados a btn_val
VLleitura = "STR(wp_empresa,3)"  && OPERACOES DE COMPRA
                         * repassa chave de leitura p/ btn_val
VLlerfim  = "STR(wp_empresa+1,3)"   && 1o REG. APOS OPER. COMPRAS
           * repassa chave de leitura p/ btn_val (POSICAO FINAL + 1 REG)
VLcompara = "notaent.empresa = wp_empresa "
                         * repassa chave de comparacao p/ btn_val
VLchvlimi = "STR(wp_empresa,3)"  && otimiza browse
***************************************************


#REGION 0
REGIONAL m.currarea, m.talkstat, m.compstat

IF SET("TALK") = "ON"
	SET TALK OFF
	m.talkstat = "ON"
ELSE
	m.talkstat = "OFF"
ENDIF
m.compstat = SET("COMPATIBLE")
SET COMPATIBLE FOXPLUS

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є                MS-DOS Window definitions                є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

IF NOT WEXIST("scgc210") ;
	OR UPPER(WTITLE("SCGC210")) == "SCGC210.PJX" ;
	OR UPPER(WTITLE("SCGC210")) == "SCGC210.SCX" ;
	OR UPPER(WTITLE("SCGC210")) == "SCGC210.MNX" ;
	OR UPPER(WTITLE("SCGC210")) == "SCGC210.PRG" ;
	OR UPPER(WTITLE("SCGC210")) == "SCGC210.FRX" ;
	OR UPPER(WTITLE("SCGC210")) == "SCGC210.QPR"
	DEFINE WINDOW scgc210 ;
		FROM 1, 2 ;
		TO 21,78 ;
		TITLE "[ BOLETIM DE ENTRADA ]" ;
		FLOAT ;
		NOCLOSE ;
		MINIMIZE ;
		NONE ;
		COLOR SCHEME 1
ENDIF

IF NOT WEXIST("navega") ;
	OR UPPER(WTITLE("NAVEGA")) == "NAVEGA.PJX" ;
	OR UPPER(WTITLE("NAVEGA")) == "NAVEGA.SCX" ;
	OR UPPER(WTITLE("NAVEGA")) == "NAVEGA.MNX" ;
	OR UPPER(WTITLE("NAVEGA")) == "NAVEGA.PRG" ;
	OR UPPER(WTITLE("NAVEGA")) == "NAVEGA.FRX" ;
	OR UPPER(WTITLE("NAVEGA")) == "NAVEGA.QPR"
	DEFINE WINDOW navega ;
		FROM 22, 0 ;
		TO 24,79 ;
		FLOAT ;
		NOCLOSE ;
		NOMINIMIZE ;
		NONE ;
		COLOR SCHEME 1
ENDIF

IF NOT WEXIST("scgc210r") ;
	OR UPPER(WTITLE("SCGC210R")) == "SCGC210R.PJX" ;
	OR UPPER(WTITLE("SCGC210R")) == "SCGC210R.SCX" ;
	OR UPPER(WTITLE("SCGC210R")) == "SCGC210R.MNX" ;
	OR UPPER(WTITLE("SCGC210R")) == "SCGC210R.PRG" ;
	OR UPPER(WTITLE("SCGC210R")) == "SCGC210R.FRX" ;
	OR UPPER(WTITLE("SCGC210R")) == "SCGC210R.QPR"
	DEFINE WINDOW scgc210r ;
		FROM 11, 0 ;
		TO 40,79 ;
		TITLE " " ;
		FOOTER "SCGC210R" ;
		FLOAT ;
		NOCLOSE ;
		NOMINIMIZE ;
		NONE ;
		COLOR SCHEME 1
ENDIF


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є          SCGC210/MS-DOS Setup Code - SECTION 2          є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1
******>>>> INICIO CONTROLE LOCAL
DO CASE
	CASE !wp_flgfecha
		SELE empresa
		SET ORDER TO TAG empresa
		SEEK wp_empresa
		SELE notaent
		SET ORDER TO TAG rldtentr
		SCATTER MEMVAR MEMO BLANK
		*-------------------------> criado pelo wizard
		m.wzalias=SELECT()
		m.isreadonly=IIF(ISREAD(),.T.,.F.)
		IF m.isreadonly
			WAIT WINDOW C_READONLY TIMEOUT 1
		ENDIF
		KEYBOARD "F"
		ON KEY LABEL CTRL-I DO ULitens
ENDCASE


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є              SCGC210/MS-DOS Screen Layout               є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1
IF WVISIBLE("scgc210")
	ACTIVATE WINDOW scgc210 SAME
ELSE
	ACTIVATE WINDOW scgc210 NOSHOW
ENDIF
@ 5,1 SAY "Fornecedor:" ;
	SIZE 1,11, 0
@ 8,9 SAY "-" ;
	SIZE 1,1, 0
@ 6,38 SAY "Origem:" ;
	SIZE 1,7, 0
@ 6,46 SAY "-" ;
	SIZE 1,1, 0
@ 12,50 SAY "%" ;
	SIZE 1,1, 0
@ 13,1 SAY "Frete(Custo): " ;
	SIZE 1,14, 0
@ 19,1 SAY "IPI.........:" ;
	SIZE 1,13, 0
@ 15,14 SAY "(+)" ;
	SIZE 1,3, 0
@ 17,14 SAY "(+)" ;
	SIZE 1,3, 0
@ 19,14 SAY "(+)" ;
	SIZE 1,3, 0
@ 15,59 SAY "(=)" ;
	SIZE 1,3, 0
@ 1,50 SAY "Fil:" ;
	SIZE 1,4, 0
@ 5,16 SAY "-" ;
	SIZE 1,1, 0
@ 5,37 SAY "-" ;
	SIZE 1,1, 0
@ 10,67 SAY "Status:" ;
	SIZE 1,7, 0
@ 10,57 SAY "Operador:" ;
	SIZE 1,9, 0
@ 14,63 SAY "Total N.F." ;
	SIZE 1,10, 0
@ 16,63 SAY "Fechamento" ;
	SIZE 1,10, 0
@ 0,0 TO 20,76 ;
	COLOR SCHEME 23
@ 0,27 SAY "[ Boletim de Entrada ]" ;
	SIZE 1,22, 0
@ 0,69 SAY "[210]" ;
	SIZE 1,5, 0
@ 20,1 TO 20,75 ;
	COLOR SCHEME 24
@ 20,76 SAY "Щ" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,76 TO 19,76 ;
	COLOR SCHEME 24
@ 0,76 SAY "ї" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 4,1 TO 4,75 ;
	COLOR SCHEME 24
@ 13,58 TO 18,75 ;
	COLOR SCHEME 24
@ 18,59 TO 18,74 ;
	COLOR SCHEME 23
@ 13,75 SAY "ї" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 18,75 SAY "Щ" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 14,75 TO 17,75 ;
	COLOR SCHEME 23
@ 11,20 SAY "{1=A Vista ; 2=A Prazo}" ;
	SIZE 1,23, 0
@ 2,36 SAY "Bolet:" ;
	SIZE 1,6, 0
@ 1,36 SAY "Tipo.:" ;
	SIZE 1,6, 0
@ 3,36 SAY "Pedid:" ;
	SIZE 1,6, 0
@ 1,58 SAY "Dt.Ent." ;
	SIZE 1,7, 0
@ 3,50 SAY "CFO" ;
	SIZE 1,3, 0
@ 13,50 SAY "%" ;
	SIZE 1,1, 0
@ 13,30 SAY "Bs.BrutaICMS.:" ;
	SIZE 1,14, 0
@ 12,30 SAY "Aliquota.....:" ;
	SIZE 1,14, 0
@ 14,30 SAY "Reducao......:" ;
	SIZE 1,14, 0
@ 15,30 SAY "Base ICMS....:" ;
	SIZE 1,14, 0
@ 16,30 SAY "Vlr. ICMS....:" ;
	SIZE 1,14, 0
@ 18,30 SAY "Outras.......:" ;
	SIZE 1,14, 0
@ 19,30 SAY "Isentas......:" ;
	SIZE 1,14, 0
@ 18,14 SAY "(+)" ;
	SIZE 1,3, 0
@ 18,1 SAY "Base IPI....:" ;
	SIZE 1,13, 0
@ 7,24 SAY "Mod.Doc" ;
	SIZE 1,7, 0
@ 10,1 SAY "Dev.Ref.NF" ;
	SIZE 1,10, 0
@ 10,18 SAY "Pgto.:" ;
	SIZE 1,6, 0
@ 7,14 SAY "Dt.Emi.NF:" ;
	SIZE 1,10, 0
@ 7,32 SAY "CHAVE NFe:" ;
	SIZE 1,10, 0
@ 7,1 SAY "NOTA-SERIE" ;
	SIZE 1,10, 0
@ 6,33 SAY "S/N" ;
	SIZE 1,3, 0
@ 6,12 SAY "Inf.IVA Manualmente:" ;
	SIZE 1,20, 0
@ 0,1 SAY "<" ;
	SIZE 1,1, 0
@ 0,24 SAY ">" ;
	SIZE 1,1, 0
@ 15,1 SAY "ICMS Subst..:" ;
	SIZE 1,13, 0
@ 17,1 SAY "Produto.....:" ;
	SIZE 1,13, 0
@ 17,30 SAY "Base ICMS ST.:" ;
	SIZE 1,14, 0
@ 9,32 SAY "Nfinterna:" ;
	SIZE 1,10, 0
@ 0,2 GET M.nfe_status ;
	SIZE 1,22 ;
	DEFAULT " " ;
	WHEN .F.
@ 1,1 GET m.natu_oper ;
	PICTURE "@^ \<Compra;\<Transferencia;\<S. Remessa;\<Devolucao;\<Entrada Movim. Interna;\<Saida Movim. Interna" ;
	SIZE 3,15 ;
	DEFAULT "Compra" ;
	WHEN _4i10lmic8() ;
	VALID _4i10lmice() ;
	COLOR SCHEME 1, 2
@ 1,16 GET m.motivo ;
	PICTURE "@^" ;
	FROM VTLmotivo ;
	SIZE 3,20 ;
	DEFAULT 1 ;
	WHEN _4i10lmie5() ;
	COLOR SCHEME 1, 2
@ 1,42 GET m.tipo ;
	SIZE 1,3 ;
	DEFAULT " " ;
	PICTURE "@!" ;
	WHEN _4i10lmied() ;
	VALID _4i10lmiej()
@ 1,54 GET m.empresa ;
	SIZE 1,3 ;
	DEFAULT 0 ;
	PICTURE "999" ;
	WHEN .f.
@ 1,65 GET m.data ;
	SIZE 1,10 ;
	DEFAULT " " ;
	PICTURE "@K" ;
	WHEN _4i10lmiep() ;
	VALID _4i10lmieq()
@ 2,42 GET m.referencia ;
	SIZE 1,7 ;
	DEFAULT " " ;
	PICTURE "@K 999,999" ;
	WHEN isreading or (isadding OR (isediting AND m.tipo $ "ENT/???" AND LEFT(m.situacao,1) = "A")) ;
	VALID _4i10lmier() ;
	ERROR wp_msg
@ 2,65 GET m.hora ;
	SIZE 1,8 ;
	DEFAULT " " ;
	PICTURE "@K XX:XX:XX" ;
	WHEN isadding or isediting AND LEFT(m.situacao,1) = "A"
@ 3,42 GET m.pedido ;
	SIZE 1,7 ;
	DEFAULT 0 ;
	PICTURE "999,999" ;
	WHEN (isadding OR (isediting AND !(m.tipo $ "ENT/???") AND LEFT(m.situacao,1) = "A")) ;
	VALID _4i10lmies() ;
	ERROR wp_msg
@ 3,54 GET M.cfo ;
	SIZE 1,5 ;
	DEFAULT " " ;
	WHEN isediting AND LEFT(m.situacao,1) = "A"
@ 5,12 GET m.codforn ;
	SIZE 1,4 ;
	DEFAULT 0 ;
	WHEN _4i10lmiet() ;
	VALID _4i10lmieu() ;
	ERROR wp_msg
@ 5,17 GET m.cgcfornece ;
	SIZE 1,20 ;
	DEFAULT " " ;
	PICTURE "@R 99.999.999/9999-99" ;
	WHEN .f.
@ 5,38 GET m.nome ;
	SIZE 1,32 ;
	DEFAULT " " ;
	PICTURE "@K XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX" ;
	WHEN .F.
@ 6,32 GET m.informaiva ;
	SIZE 1,1 ;
	DEFAULT " " ;
	PICTURE "@!" ;
	WHEN _4i10lmiev() ;
	VALID _4i10lmift()
@ 6,45 GET m.ch_desti ;
	SIZE 1,1 ;
	DEFAULT " " ;
	WHEN .f.
@ 6,47 GET m.descdest ;
	SIZE 1,7 ;
	DEFAULT " " ;
	WHEN .f.
@ 8,1 GET m.notareal ;
	SIZE 1,8 ;
	DEFAULT 0 ;
	PICTURE "9999999" ;
	WHEN isadding or isreading ;
	VALID _4i10lmifz() ;
	ERROR "Digitacao incorreta Nro de Nota Deve Ser Igual ao do Boletim"
@ 8,10 GET m.serie ;
	SIZE 1,3 ;
	DEFAULT " " ;
	WHEN isadding or isreading ;
	VALID _4i10lmig4() ;
	ERROR wp_msg
@ 8,14 GET m.data_emi ;
	SIZE 1,10 ;
	DEFAULT " " ;
	PICTURE "@K" ;
	WHEN isediting AND LEFT(m.situacao,1) = "A" ;
	VALID _4i10lmig5()
@ 8,29 GET m.nf_mod_doc ;
	SIZE 1,2 ;
	DEFAULT " " ;
	WHEN isediting ;
	VALID _4i10lmig6()
@ 8,32 GET m.nfe_chv ;
	SIZE 1,44 ;
	DEFAULT " " ;
	WHEN isediting ;
	VALID _4i10lmig7()
@ 9,42 GET m.nota ;
	SIZE 1,7 ;
	DEFAULT 0 ;
	PICTURE "999999" ;
	WHEN .f. ;
	VALID .t. ;
	ERROR "Digitacao incorreta Nro de Nota Deve Ser Igual ao do Boletim"
@ 20,1 GET m.rmt_btn ;
	PICTURE "@*HN \<1-Transito" ;
	SIZE 1,12,1 ;
	DEFAULT 1 ;
	VALID _4i10lmig8() ;
	MESSAGE 'Primeiro registro'
@ 20,14 GET m.cmt_btn ;
	PICTURE "@*HN \<2-Canc.Trans" ;
	SIZE 1,14,1 ;
	DEFAULT 1 ;
	VALID _4i10lmig9() ;
	MESSAGE 'Primeiro registro'
@ 20,29 GET m.pb_btn ;
	PICTURE "@*HN \<3-Entrada" ;
	SIZE 1,11,1 ;
	DEFAULT 1 ;
	VALID _4i10lmih6() ;
	MESSAGE 'Primeiro registro'
@ 20,41 GET m.cp_btn ;
	PICTURE "@*HN \<4-Canc.Entr" ;
	SIZE 1,13,1 ;
	DEFAULT 1 ;
	VALID _4i10lmihc() ;
	MESSAGE 'Primeiro registro'
@ 20,55 GET m.dcFis ;
	PICTURE "@*HN \<7-Escriturar" ;
	SIZE 1,14,1 ;
	DEFAULT 1 ;
	VALID _4i10lmihi()
@ 20,70 GET m.it_btn ;
	PICTURE "@*HN ite\<Ns" ;
	SIZE 1,7,1 ;
	DEFAULT 1 ;
	VALID _4i10lmihq() ;
	MESSAGE 'Primeiro registro'
@ 11,4 GET m.nfdevolve ;
	SIZE 1,8 ;
	DEFAULT 0 ;
	PICTURE "9999999" ;
	WHEN m.natu_oper = 4 and isediting ;
	VALID _4i10lmihr()
@ 11,18 GET m.condicao ;
	SIZE 1,1 ;
	DEFAULT " " ;
	PICTURE "@K 9" ;
	WHEN isediting AND LEFT(m.situacao,1) = "A" ;
	VALID m.condicao = 1 OR m.condicao = 2
@ 13,17 GET m.vlrfrete ;
	SIZE 1,12 ;
	DEFAULT 0 ;
	PICTURE "9,999,999.99" ;
	WHEN _4i10lmihs()
@ 15,17 GET m.icms_subs ;
	SIZE 1,12 ;
	DEFAULT 0 ;
	PICTURE "9,999,999.99" ;
	WHEN isediting AND LEFT(m.situacao,1) = "A"
@ 17,17 GET m.totproduto ;
	SIZE 1,12 ;
	DEFAULT 0 ;
	PICTURE "9,999,999.99" ;
	WHEN isediting AND LEFT(m.situacao,1) = "A" ;
	VALID _4i10lmiht()
@ 18,17 GET m.base_ipi ;
	SIZE 1,12 ;
	DEFAULT 0 ;
	PICTURE "@K 9,999,999.99" ;
	WHEN isediting AND LEFT(m.situacao,1) = "A" ;
	VALID _4i10lmihu()
@ 19,17 GET m.vlr_ipi ;
	SIZE 1,12 ;
	DEFAULT 0 ;
	PICTURE "@K 9,999,999.99" ;
	WHEN isediting AND LEFT(m.situacao,1) = "A" ;
	VALID _4i10lmihv()
@ 12,45 GET m.aliq_icms ;
	SIZE 1,5 ;
	DEFAULT 0 ;
	PICTURE "99.99" ;
	WHEN isediting  AND LEFT(m.situacao,1) = "A" ;
	VALID _4i10lmiir()
@ 13,45 GET m.bsbrt_icms ;
	SIZE 1,12 ;
	DEFAULT 0 ;
	PICTURE "9,999,999.99" ;
	WHEN .f. and isediting AND LEFT(m.situacao,1) = "A" ;
	VALID _4i10lmiix()
@ 14,45 GET m.reduc_icms ;
	SIZE 1,7 ;
	DEFAULT 0 ;
	PICTURE "999.9999" ;
	WHEN .F. AND isediting AND LEFT(m.situacao,1) = "A" ;
	VALID _4i10lmij2()
@ 15,45 GET m.base_icms ;
	SIZE 1,12 ;
	DEFAULT 0 ;
	PICTURE "9,999,999.99" ;
	WHEN isediting AND LEFT(m.situacao,1) = "A" ;
	VALID _4i10lmij9()
@ 16,45 GET m.vlr_icms ;
	SIZE 1,12 ;
	DEFAULT 0 ;
	PICTURE "9,999,999.99" ;
	WHEN _4i10lmija() ;
	VALID _4i10lmijb() ;
	ERROR wp_msg
@ 17,45 GET m.base_subs ;
	SIZE 1,12 ;
	DEFAULT 0 ;
	PICTURE "9,999,999.99" ;
	WHEN isediting and m.icms_subs > 0 AND LEFT(m.situacao,1) = "A" ;
	VALID _4i10lmijc() ;
	ERROR WP_MSG
@ 18,45 GET m.base_outr ;
	SIZE 1,12 ;
	DEFAULT 0 ;
	PICTURE "9,999,999.99" ;
	WHEN isediting AND "*" $ LSaces	AND LEFT(m.situacao,1) = "A"
@ 19,45 GET m.base_isent ;
	SIZE 1,12 ;
	DEFAULT 0 ;
	PICTURE "9,999,999.99" ;
	WHEN isediting AND "*" $ LSaces	AND LEFT(m.situacao,1) = "A"
@ 11,62 GET m.operador ;
	SIZE 1,4 ;
	DEFAULT 0 ;
	PICTURE "9999" ;
	WHEN .f. ;
	ERROR "Banco nao Cadastrado no sistema"
@ 11,72 GET m.situacao ;
	SIZE 1,2 ;
	DEFAULT " " ;
	WHEN isediting AND lMaster
@ 15,62 GET m.total_nota ;
	SIZE 1,12 ;
	DEFAULT 0 ;
	PICTURE "9,999,999.99" ;
	WHEN _4i10lmijd()
@ 17,62 GET m.soma_qtde ;
	SIZE 1,12 ;
	DEFAULT 0 ;
	PICTURE "9,999,999.99" ;
	WHEN isediting AND LEFT(m.situacao,1) = "A"
@ 19,59 GET m.btncalc ;
	PICTURE "@*HN \<9-Calcular" ;
	SIZE 1,14,1 ;
	DEFAULT 1 ;
	VALID _4i10lmije()




*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є              OBJ_WNAV/MS-DOS Screen Layout              є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 2
IF WVISIBLE("navega")
	ACTIVATE WINDOW navega SAME
ELSE
	ACTIVATE WINDOW navega NOSHOW
ENDIF
@ 1,8 GET m.top_btn ;
	PICTURE "@*HN \<Inicio" ;
	SIZE 1,8,1 ;
	DEFAULT 1 ;
	VALID BTN_VAL1('TOP', VLleitura, Vlcompara) ;
	MESSAGE 'Primeiro registro'
@ 1,16 GET m.prev_btn ;
	PICTURE "@*HN \<Ant" ;
	SIZE 1,5,1 ;
	DEFAULT 1 ;
	VALID btn_val1('PREV', VLleitura, Vlcompara) ;
	MESSAGE 'Posiciona no registro anterior.' 	
@ 1,21 GET m.next_btn ;
	PICTURE "@*HN \<Proximo" ;
	SIZE 1,9,1 ;
	DEFAULT 1 ;
	VALID btn_val1('NEXT', VLleitura, Vlcompara) ;
	MESSAGE 'Avanca para proximo registro'
@ 1,30 GET m.end_btn ;
	PICTURE "@*HN \<Fim" ;
	SIZE 1,5,1 ;
	DEFAULT 1 ;
	VALID btn_val1('END', VLlerfim, Vlcompara) ;
	MESSAGE 'Ultimo registro do arquivo' 																																													
@ 1,35 GET m.loc_btn ;
	PICTURE "@*HN \<Zoom" ;
	SIZE 1,6,1 ;
	DEFAULT 1 ;
	VALID btn_val1('LOCATE', VLleitura, Vlcompara,VLchvlimi)		 ;
	MESSAGE 'Permite consulta visual ampliada a varios registros na tela'
@ 1,41 GET m.add_btn ;
	PICTURE "@*HN \<Lanca" ;
	SIZE 1,7,1 ;
	DEFAULT 1 ;
	VALID btn_val1('ADD') ;
	MESSAGE 'Abre novo registro para lancamento de dados' 
@ 1,55 GET m.edit_btn ;
	PICTURE "@*HN \<Edit" ;
	SIZE 1,6,1 ;
	DEFAULT 1 ;
	VALID btn_val1('EDIT') ;
	MESSAGE 'Permite a alteracao de dados do registro corrente'
@ 1,61 GET m.del_btn ;
	PICTURE "@*HN \<Del" ;
	SIZE 1,5,1 ;
	DEFAULT 1 ;
	VALID btn_val1('DELETE', VLleitura, Vlcompara) ;
	MESSAGE 'Delete current record.'
@ 1,73 GET m.exit_btn ;
	PICTURE "@*HN \<Sair" ;
	SIZE 1,6,1 ;
	DEFAULT 1 ;
	VALID btn_val1('EXIT') ;
	MESSAGE 'Close screen.'
@ 1,48 GET m.cop_btn ;
	PICTURE "@*HN \<Copia" ;
	SIZE 1,7,1 ;
	DEFAULT 1 ;
	VALID btn_val1('COPY') ;
	MESSAGE 'Abre novo registro sel limpar os dados do reg corrente' 
@ 1,1 GET m.busca_btn ;
	PICTURE "@*HN \<Busca" ;
	SIZE 1,7,1 ;
	DEFAULT 1 ;
	VALID BTN_VAL1('BUSCA') ;
	MESSAGE 'Busca dirata pela chave do documento.'
@ 1,66 GET m.imp_btn ;
	PICTURE "@*HN i\<Mpr" ;
	SIZE 1,6,1 ;
	DEFAULT 1 ;
	VALID btn_val1('PRINT') ;
	MESSAGE 'Close screen.'
@ 0,0 TO 2,79 DOUBLE ;
	COLOR SCHEME 24
@ 2,1 TO 2,78 DOUBLE ;
	COLOR SCHEME 23
@ 1,79 SAY "і" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 0,79 SAY "»" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 2,79 SAY "ј" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 1,79 SAY "є" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23




*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є              SCGC210R/MS-DOS Screen Layout              є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 3
IF WVISIBLE("scgc210r")
	ACTIVATE WINDOW scgc210r SAME
ELSE
	ACTIVATE WINDOW scgc210r NOSHOW
ENDIF
@ 1,0 GET ULitens ;
	PICTURE "@*HN ULitens" ;
	SIZE 1,9,1 ;
	DEFAULT 1 ;
	WHEN .f. ;
	VALID _4i10lmikb()
@ 2,0 GET BTN_VAL1 ;
	PICTURE "@*HN BTN_VAL1" ;
	SIZE 1,10,1 ;
	DEFAULT 1 ;
	WHEN .f. ;
	VALID _4i10lmikj()
@ 3,0 GET local_refresh ;
	PICTURE "@*HN local_refresh" ;
	SIZE 1,15,1 ;
	DEFAULT 1 ;
	WHEN .f. ;
	VALID _4i10lmikr()
@ 4,0 GET ULcompara ;
	PICTURE "@*HN ULcompara" ;
	SIZE 1,11,1 ;
	DEFAULT 1 ;
	WHEN .f. ;
	VALID _4i10lmiks()
@ 6,0 GET ULatrmotivos ;
	PICTURE "@*HN ULatrmotivos" ;
	SIZE 1,14,1 ;
	DEFAULT 1 ;
	WHEN .f. ;
	VALID _4i10lmikt()
@ 7,0 GET ULclassifica ;
	PICTURE "@*HN ULclassifica" ;
	SIZE 1,14,1 ;
	DEFAULT 1 ;
	WHEN .f. ;
	VALID _4i10lmiku()
@ 8,0 GET ULorigem ;
	PICTURE "@*HN ULorigem" ;
	SIZE 1,10,1 ;
	DEFAULT 1 ;
	WHEN .f. ;
	VALID _4i10lmikv()
@ 11,0 GET ULReg_Trans ;
	PICTURE "@*HN ULReg_Trans" ;
	SIZE 1,13,1 ;
	DEFAULT 1 ;
	WHEN .f. ;
	VALID _4i10lmikw()
@ 12,0 GET ULCanc_Trans ;
	PICTURE "@*HN ULCanc_Trans" ;
	SIZE 1,14,1 ;
	DEFAULT 1 ;
	WHEN .f. ;
	VALID _4i10lmilz()
@ 13,0 GET ULReg_Entrada ;
	PICTURE "@*HN ULReg_Entrada" ;
	SIZE 1,15,1 ;
	DEFAULT 1 ;
	WHEN .f. ;
	VALID _4i10lmim5()
@ 14,0 GET ULCanc_Entrada ;
	PICTURE "@*HN ULCanc_Entrada" ;
	SIZE 1,16,1 ;
	DEFAULT 1 ;
	WHEN .f. ;
	VALID _4i10lmimb()
@ 2,23 GET ULvldCampos ;
	PICTURE "@*HN ULvldCampos" ;
	SIZE 1,13,1 ;
	DEFAULT 1 ;
	WHEN .f. ;
	VALID _4i10lmimc()
@ 3,23 GET ULLibLanc ;
	PICTURE "@*HN ULLibLanc - Libera Lancamento nova entrada" ;
	SIZE 1,44,1 ;
	DEFAULT 1 ;
	WHEN .f. ;
	VALID _4i10lmimd()
@ 16,0 GET ULCalc_Entrada ;
	PICTURE "@*HN ULCalc_Entrada" ;
	SIZE 1,16,1 ;
	DEFAULT 1 ;
	WHEN .f. ;
	VALID _4i10lmime()

IF NOT WVISIBLE("scgc210r")
	ACTIVATE WINDOW scgc210r
ENDIF
IF NOT WVISIBLE("navega")
	ACTIVATE WINDOW navega
ENDIF
IF NOT WVISIBLE("scgc210")
	ACTIVATE WINDOW scgc210
ENDIF



*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є     MS-DOSREAD contains clauses from SCREEN scgc210     є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

READ CYCLE ;
	VALID READVALID() ;
	WHEN READWHEN() ;
	ACTIVATE READACT() ;
	DEACTIVATE READDEAC() &wp_timeout ;
	SHOW _4i10lmimf() ;
	NOLOCK

RELEASE WINDOW navega
RELEASE WINDOW scgc210
RELEASE WINDOW scgc210r

#REGION 0
IF m.talkstat = "ON"
	SET TALK ON
ENDIF
IF m.compstat = "ON"
	SET COMPATIBLE ON
ENDIF


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є               SCGC210/MS-DOS Cleanup Code               є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1

	wp_flgfecha = .F. 		&& defaut nao fechamento da secao
	ON KEY LABEL ESCAPE
	SET FORMAT TO
	ON KEY LABEL CTRL-I
RETURN

*-------------->




*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є              SCGC210R/MS-DOS Cleanup Code               є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 3
RETURN




*------------------------------------------------------------*
*------------------------------------------------------------*
*------------------------------------------------------------*






*-------------------------------------------------------------------*
**


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIC8           m.natu_oper WHEN                   є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210,     Record Number:   64   є
*       є Variable:            m.natu_oper                        є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Popup                              є
*       є Snippet Number:      1                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4i10lmic8     &&  m.natu_oper WHEN
#REGION 1
ON KEY LABEL ESCAPE	KEYBOARD "{END}"
IF LASTKEY() = 15
	KEYBOARD "{ESCAPE}"
ENDIF
RETURN(isadding OR (isediting AND m.tipo $ "ENT/???" AND LEFT(m.situacao,1) = "A" ))


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMICE           m.natu_oper VALID                  є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210,     Record Number:   64   є
*       є Variable:            m.natu_oper                        є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Popup                              є
*       є Snippet Number:      2                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4i10lmice     &&  m.natu_oper VALID
#REGION 1
DO ULatrmotivos
ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
RETURN .T.


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIE5           m.motivo WHEN                      є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210,     Record Number:   65   є
*       є Variable:            m.motivo                           є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Popup                              є
*       є Snippet Number:      3                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4i10lmie5     &&  m.motivo WHEN
#REGION 1
ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
RETURN(m.natu_oper < 5 AND (isadding OR (isediting AND m.tipo $ "ENT/???"    AND LEFT(m.situacao,1) = "A")))


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIED           m.tipo WHEN                        є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210,     Record Number:   66   є
*       є Variable:            m.tipo                             є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Field                              є
*       є Snippet Number:      4                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4i10lmied     &&  m.tipo WHEN
#REGION 1
LFtmp =(isediting and ((m.natu_oper = 1 AND m.motivo >= 6) OR (m.natu_oper = 2 AND m.motivo >= 5) OR (m.natu_oper = 3 AND m.motivo = 4) OR (m.natu_oper = 4 AND m.motivo = 5) OR m.natu_oper >= 5))
RETURN(LFtmp and isediting AND LEFT(m.situacao,1) = "A")





*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIEJ           m.tipo VALID                       є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210,     Record Number:   66   є
*       є Variable:            m.tipo                             є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Field                              є
*       є Snippet Number:      5                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4i10lmiej     &&  m.tipo VALID
#REGION 1
IF m.natu_oper < 6
	SELECT tipooper
	SET ORDER TO TAG tipo
	IF LASTKEY() = 9
	   ON KEY LABEL ESCAPE
	   DO loc_dlog WITH .F.,.F.
	   ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
	   m.tipo = tipooper.tipo
	   m.natureza = tipooper.descnatu
	   SHOW GET m.natureza
	   SELECT notaent
	   IF LASTKEY()  =  27
			RETURN .F.
	   ENDIF
	ELSE
	   ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
		IF !SEEK("e"+m.tipo)
			IF !SEEK("E"+m.tipo)
				SELECT notaent
				RETURN .F.
			ENDIF
		ENDIF
 	    m.tipo = tipooper.tipo
		m.natureza = tipooper.descnatu
		SHOW GET m.natureza
	ENDIF
	IF m.natu_oper = 6
		IF INT(VAL(tipooper.ch_opera)) <> 5
			WAIT WINDOW "Tipo nao Pertence a operacao comercial informada."
			SELECT notaent
			RETURN .F.
		ENDIF
	ELSE
		IF INT(VAL(tipooper.ch_opera)) <> m.natu_oper	
			WAIT WINDOW "Tipo nao Pertence a operacao comercial informada."
			SELECT notaent
			RETURN .F.
		ENDIF
	ENDIF
ELSE
	SELECT tipooper
	SET ORDER TO TAG tipo
	IF LASTKEY() = 9
	   ON KEY LABEL ESCAPE
	   DO loc_dlog WITH .F.,.F.
	   ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
	   m.tipo = tipooper.tipo
	   m.natureza = tipooper.descnatu
	   SHOW GET m.natureza
	   SELECT notaent
	   IF LASTKEY()  =   27
			RETURN .F.
		ENDIF
	ELSE
		IF !SEEK("s"+m.tipo)
			IF !SEEK("S"+m.tipo)
				SELECT notaent
				RETURN .F.
			ENDIF
		ENDIF
 	    m.tipo = tipooper.tipo
		m.natureza = tipooper.descnatu
		SHOW GET m.natureza
	ENDIF
	IF m.natu_oper = 6
		IF INT(VAL(tipooper.ch_opera)) <> 5
			WAIT WINDOW "Tipo nao Pertence a operacao comercial informada."
			SELECT notaent
			RETURN .F.
		ENDIF
	ELSE
		IF INT(VAL(tipooper.ch_opera)) <> m.natu_oper	
			WAIT WINDOW "Tipo nao Pertence a operacao comercial informada."
			SELECT notaent
			RETURN .F.
		ENDIF
	ENDIF


ENDIF
SELECT notaent
RETURN .T.


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIEP           m.data WHEN                        є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210,     Record Number:   68   є
*       є Variable:            m.data                             є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Field                              є
*       є Snippet Number:      6                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4i10lmiep     &&  m.data WHEN
#REGION 1
IF isadding
   data = wp_dtoper
   hora = TIME()
ENDIF
SHOW GET m.data
SHOW GET m.hora
RETURN(isediting AND LEFT(m.situacao,1) = "A")


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIEQ           m.data VALID                       є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210,     Record Number:   68   є
*       є Variable:            m.data                             є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Field                              є
*       є Snippet Number:      7                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4i10lmieq     &&  m.data VALID
#REGION 1
IF ISEDITING AND LDdtant <> m.data	&& SE ALTERAR DATA => ALTERAR HORA
   M.hora = TIME()
ENDIF
SHOW GET m.hora


IF ABS(wp_dtoper - m.data) > 2

    LSmsg = "Existe diferenca maior que 2 dias entre a data "+;
            "lancada e a data do sistema. Cofirma a "+;
            "data lancada? A data "+DTOC(m.data)

    IF !fox_alert(lsmsg)
       return(.F.)
    ENDIF
ENDIF	
RETURN(.T.)

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIER           m.referencia VALID                 є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210,     Record Number:   69   є
*       є Variable:            m.referencia                       є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Field                              є
*       є Snippet Number:      8                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4i10lmier     &&  m.referencia VALID
#REGION 1
IF !isreading OR (isreading AND m.referencia = 0)
	RETURN .T.
ENDIF
SELE notaent
SET ORDER TO TAG boletim
SET NEAR ON
SEEK STR(wp_empresa,3)+STR(m.referencia,6)
SET NEAR OFF
IF wp_empresa = notaent.empresa AND m.referencia = notaent.referencia
	m.codforn = notaent.codforn
	SEEK STR(wp_empresa,3)+STR(m.referencia,6)+STR(m.codforn,5)
ENDIF

RETURN(UPtratachv())


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIES           m.pedido VALID                     є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210,     Record Number:   71   є
*       є Variable:            m.pedido                           є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Field                              є
*       є Snippet Number:      9                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4i10lmies     &&  m.pedido VALID
#REGION 1
SELE pedido
SET ORDER TO TAG pedido
IF LASTKEY() = 9
   ON KEY LABEL ESCAPE
   DO loc_dlog
   ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
   SELECT notaent
   IF LASTKEY() = 27
	   RETURN .F.
   ENDIF
ELSE
   IF m.pedido = 0
   		SELECT notaent
		RETURN .t.
   ENDIF
   IF !SEEK(m.pedido)
   		SELECT notaent
		RETURN .F.
   ENDIF
ENDIF
SELECT notaent
m.pedido 	 = pedido.pedido
SHOW GET m.pedido
RETURN .T.


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIET           m.codforn WHEN                     є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210,     Record Number:   73   є
*       є Variable:            m.codforn                          є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Field                              є
*       є Snippet Number:      10                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
*************************************************************************
* 05/05/98 - PARA SISTEMA DE BACKUP                                     *
*************************************************************************
* O motivo por nao permitir a alteracao do fornecedor e manter uma chave
* fixa que usada de forma CRITICA no sistema de BACKUP do SCGC;
* A  alteracao fara com que o registro em backup nao seja encontrado no
* arquivo de dados e o mesmo sera gravado como este fosse perdido
* provocando um registro errado;
*  	Confira no SCGC007 que a chave que permite a localizacao do registro
* e STR(EMPRESA,3)+STR(REFERENCIA,6)+STR(CODFORN,5) TAG BOLETIM
*************************************************************************
FUNCTION _4i10lmiet     &&  m.codforn WHEN
#REGION 1
RETURN(isadding or isreading)

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIEU           m.codforn VALID                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210,     Record Number:   73   є
*       є Variable:            m.codforn                          є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Field                              є
*       є Snippet Number:      11                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4i10lmieu     &&  m.codforn VALID
#REGION 1
SELECT fornece
IF LASTKEY() = 9
   ON KEY LABEL ESCAPE
   DO loc_dlog
    ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
   IF LASTKEY() = 27
		SELECT notaent
		RETURN .F.
	ENDIF
ELSE
	SET ORDER TO TAG codigo
	IF !SEEK(m.codforn)
		SELECT notaent
		RETURN .F.
	ENDIF
ENDIF
IF  m.natu_oper = 1 ;
    and LEFT(STR(empresa.CGC,14),9) = LEFT(STR(fornece.CGC,14),9)
	WAIT WINDOW "Nao pode haver COMPRA entre FILIAIS.  < ENTER > "
	RETURN .F.
ENDIF

IF  m.empresa <> 1 and m.codforn = 911
	WAIT WINDOW "Nao pode haver ENTRADA DA DPO.  < ENTER > "
	RETURN .F.
ENDIF



SCATTER MEMVAR FIELDS nome, estado, pais MEMO
m.uf         = m.estado
m.codforn	 = fornece.codigo
m.favorecido = fornece.cgc






SELECT notaent
SHOW GET m.nome
m.cgcfornece = str(m.favorecido,14)
SHOW GET m.cgcfornece
DO  ULorigem

IF isediting
	SELE notaent
	SET ORDER TO TAG boletim
	SEEK STR(wp_empresa,3)+STR(m.referencia,6)+STR(m.codforn,5)
	RETURN(UPtratachv())
ENDIF
RETURN .T.


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIEV           m.informaiva WHEN                  є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210,     Record Number:   76   є
*       є Variable:            m.informaiva                       є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Field                              є
*       є Snippet Number:      12                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
** RETURN(isediting AND LEFT(m.situacao,1) = "A")
FUNCTION _4i10lmiev     &&  m.informaiva WHEN
#REGION 1
RETURN(isediting)

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIFT           m.informaiva VALID                 є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210,     Record Number:   76   є
*       є Variable:            m.informaiva                       є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Field                              є
*       є Snippet Number:      13                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4i10lmift     &&  m.informaiva VALID
#REGION 1
 IF !( m.informaiva $ "SNO")


   DO OBJ_MENS.SPR WITH "    ATENCAO!!"+CHR(13)+CHR(13)+;
		   " S=IVA Digitado pelo Operador / N=IVA automatico"
	SELECT notaent
	RETURN(.F.)
 endif

RETURN(.T.)

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIFZ           m.notareal VALID                   є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210,     Record Number:   79   є
*       є Variable:            m.notareal                         є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Field                              є
*       є Snippet Number:      14                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4i10lmifz     &&  m.notareal VALID
#REGION 1
if m.notareal > 999999

*    m.nota = m.notareal - 1000000
     m.nota = m.notareal -  int(m.notareal/1000000)*1000000

 else
    m.nota = m.notareal

endif
  show get m.NOTA

return(.t.)

*return(LASTKEY() <> 13)

*return(m.referencia = m.nota OR LASTKEY() <> 13)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIG4           m.serie VALID                      є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210,     Record Number:   80   є
*       є Variable:            m.serie                            є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Field                              є
*       є Snippet Number:      15                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4i10lmig4     &&  m.serie VALID
#REGION 1
IF LASTKEY() = 15
	RETURN(.T.)
ENDIF
IF isadding AND EMPTY(M.SERIE)
	WAIT WINDOW "Informe a Serie.  < ENTER > "
	RETURN(.F.)
ENDIF
SELE notaent
SET ORDER TO TAG nota
IF LASTKEY() = 9
    ON KEY LABEL ESCAPE
	DO loc_dlog WITH .T.
    ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
	IF LASTKEY() <> 27
		m.nota = notaent.nota
		m.serie= notaent.serie
		m.codforn = notaent.codforn
	ENDIF	
ENDIF	
SET ORDER TO TAG nota

*** ATENCAO ! O complementop de chave LEFT(TIPO,1) foi incorporado para
*** permitir a aceitacao de erros de duplicidade de notas no sist. cobol.
*** Nao e necessario para o sistema fox que impede a duplicidade

SET NEAR ON
SEEK STR(wp_empresa,3)+STR(m.codforn,5)+STR(m.nota,6)+m.serie
SET NEAR OFF
IF wp_empresa = notaent.empresa AND m.codforn = notaent.codforn  AND ;
   m.nota	  = notaent.nota    ANT m.serie   = notaent.serie

	m.tipo = notaent.tipo
	SEEK STR(wp_empresa,3)+STR(m.codforn,5)+STR(m.nota,6)+m.serie+;
			LEFT(m.tipo,1)
ENDIF

SET ORDER TO TAG boletim
RETURN(UPtratachv())


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIG5           m.data_emi VALID                   є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210,     Record Number:   81   є
*       є Variable:            m.data_emi                         є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Field                              є
*       є Snippet Number:      16                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4i10lmig5     &&  m.data_emi VALID
#REGION 1
IF EMPTY(m.data_emi)
  		return(.F.)
ENDIF

IF m.data_emi > date()
  		return(.F.)
ENDIF




IF !EMPTY(m.data_emi) OR LASTKEY() <> 13

	IF ABS(m.data_emi - m.data) > 5

   		 LSmsg = "Existe diferenca maior que 5 dias entre a data "+;
            "lancada e a data de Emissao. Cofirma a "+;
            "data de emissao? A data "+DTOC(m.data_emi)
	    IF fox_alert(lsmsg)
       		return(.t.)
    	ENDIF
	ELSE
  		return(.t.)
	ENDIF	

ENDIF

RETURN(.F.)

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIG6           m.nf_mod_doc VALID                 є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210,     Record Number:   82   є
*       є Variable:            m.nf_mod_doc                       є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Field                              є
*       є Snippet Number:      17                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*






FUNCTION _4i10lmig6     &&  m.nf_mod_doc VALID
#REGION 1
 lsTMPDOC=  "2D/03/3A/3B/01/1B/02/2E/04/06/07/08/8B/09/10/11/";
        +   "13/14/15/17/16/18/20/21/22/23/24/25/26/27/28/29/55/57/"
 IF !( m.nf_mod_doc $ lsTMPDOC)


   DO OBJ_MENS.SPR WITH "    ATENCAO!!"+CHR(13)+CHR(13)+;
		   "Informe Mod: " +lsTMPDOC


	SELECT notaent
	RETURN(.F.)
 endif

RETURN(.T.)

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIG7           m.nfe_chv VALID                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210,     Record Number:   83   є
*       є Variable:            m.nfe_chv                          є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Field                              є
*       є Snippet Number:      18                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4i10lmig7     &&  m.nfe_chv VALID
#REGION 1
	CLEAR TYPEAHEAD
	CLEAR TYPEAHEAD
*    KEYBOARD CHR(13)
RETURN(.T.)

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIG8           m.rmt_btn VALID                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210,     Record Number:   85   є
*       є Variable:            m.rmt_btn                          є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      19                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4i10lmig8     &&  m.rmt_btn VALID
#REGION 1
	=W_DEFPROC("rotinas.SPR")
	DO ULReg_Trans
RETURN



*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIG9           m.cmt_btn VALID                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210,     Record Number:   86   є
*       є Variable:            m.cmt_btn                          є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      20                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4i10lmig9     &&  m.cmt_btn VALID
#REGION 1
	=W_DEFPROC("rotinas.SPR")

	DO ULCanc_Trans
RETURN(.T.)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIH6           m.pb_btn VALID                     є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210,     Record Number:   87   є
*       є Variable:            m.pb_btn                           є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      21                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4i10lmih6     &&  m.pb_btn VALID
#REGION 1
	=W_DEFPROC("rotinas.SPR")

	DO ULReg_Entrada

RETURN



*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIHC           m.cp_btn VALID                     є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210,     Record Number:   88   є
*       є Variable:            m.cp_btn                           є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      22                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4i10lmihc     &&  m.cp_btn VALID
#REGION 1
	=W_DEFPROC("rotinas.SPR")

	DO ULCanc_Entrada

RETURN



*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIHI           m.dcFis VALID                      є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210,     Record Number:   89   є
*       є Variable:            m.dcFis                            є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      23                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*


	*---------------------------------------------------------------*
	* ESTA CHAMADA E FEITA EM NEGeraDFIS
	*---------------------------------------------------------------*
	*=W_DEFPROC("DOCFISCA.SPR")
	*=DFConvrtNEDocFiscal(Notaent.Empresa,Notaent.Nota,notaent.CodForn)
	*---------------------------------------------------------------*


FUNCTION _4i10lmihi     &&  m.dcFis VALID
#REGION 1
    PRIVATE LSobjetivo , PrmExibeMsg


	=W_DEFPROC("NOTAENT.SPR")
	LSobjetivo = NEDefEnvDFis( Notaent.Empresa, Notaent.nf_mod_doc )




	=W_DEFPROC("GERAL.SPR")

	=W_DEFPROC("NOTAENT.SPR")

	PrmExibeMsg	 = "SIM"
	

	=NEGeraDFIS(Notaent.Empresa,;
	            Notaent.Nota,;
	            notaent.CodForn,;
	            PrmExibeMsg,;
	            LSobjetivo)


	=W_DEFPROC("GERAL.SPR")

	SELECT notaent
	SCATTER MEMVAR MEMO
	SHOW GETS
	DO refresh
RETURN

			


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIHQ           m.it_btn VALID                     є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210,     Record Number:   90   є
*       є Variable:            m.it_btn                           є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      24                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4i10lmihq     &&  m.it_btn VALID
#REGION 1
	=W_DEFPROC("rotinas.SPR")
	do ULitens
RETURN

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIHR           m.nfdevolve VALID                  є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210,     Record Number:   91   є
*       є Variable:            m.nfdevolve                        є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Field                              є
*       є Snippet Number:      25                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4i10lmihr     &&  m.nfdevolve VALID
#REGION 1
if !empty(m.nfdevolve)
	SELE nota
	SET ORDER TO TAG nota
	SEEK STR(wp_empresa,3)+STR(m.nfdevolve,7)
	SELE notaent
	RETURN(FOUND("nota"))
ENDIF
RETURN(.T.)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIHS           m.vlrfrete WHEN                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210,     Record Number:   93   є
*       є Variable:            m.vlrfrete                         є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Field                              є
*       є Snippet Number:      26                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4i10lmihs     &&  m.vlrfrete WHEN
#REGION 1
IF isediting
	DO ULclassifica
	SHOW GET m.tipo
ENDIF
RETURN(isediting AND LEFT(m.situacao,1) = "A")

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIHT           m.totproduto VALID                 є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210,     Record Number:   95   є
*       є Variable:            m.totproduto                       є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Field                              є
*       є Snippet Number:      27                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4i10lmiht     &&  m.totproduto VALID
#REGION 1
m.bsbrt_icms = m.totproduto

*****m.base_icms = m.totproduto

SHOW GET m.base_icms
SHOW GET m.bsbrt_icms
RETURN(.T.)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIHU           m.base_ipi VALID                   є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210,     Record Number:   96   є
*       є Variable:            m.base_ipi                         є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Field                              є
*       є Snippet Number:      28                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4i10lmihu     &&  m.base_ipi VALID
#REGION 1
m.base_outr = m.vlr_ipi
SHOW GET m.base_outr
RETURN(.T.)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIHV           m.vlr_ipi VALID                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210,     Record Number:   97   є
*       є Variable:            m.vlr_ipi                          є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Field                              є
*       є Snippet Number:      29                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4i10lmihv     &&  m.vlr_ipi VALID
#REGION 1
m.base_outr = m.vlr_ipi
SHOW GET m.base_outr
RETURN(.T.)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIIR           m.aliq_icms VALID                  є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210,     Record Number:   98   є
*       є Variable:            m.aliq_icms                        є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Field                              є
*       є Snippet Number:      30                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4i10lmiir     &&  m.aliq_icms VALID
#REGION 1
IF m.aliq_icms = 0
    m.bsbrt_icms = 0
    m.base_icms  = 0
    m.base_isent = m.totproduto


else

    m.bsbrt_icms = m.totproduto
    m.base_isent = m.totproduto

endif



*****m.base_icms = m.totproduto

SHOW GET m.base_icms
SHOW GET m.bsbrt_icms
SHOW GET m.base_isent
RETURN(.T.)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIIX           m.bsbrt_icms VALID                 є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210,     Record Number:   99   є
*       є Variable:            m.bsbrt_icms                       є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Field                              є
*       є Snippet Number:      31                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4i10lmiix     &&  m.bsbrt_icms VALID
#REGION 1
  m.base_icms = m.bsbrt_icms * m.reduc_icms
  show get m.base_icms
 RETURN(.T.)

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIJ2           m.reduc_icms VALID                 є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210,     Record Number:  100   є
*       є Variable:            m.reduc_icms                       є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Field                              є
*       є Snippet Number:      32                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4i10lmij2     &&  m.reduc_icms VALID
#REGION 1
  m.base_icms = m.bsbrt_icms * m.reduc_icms
  show get m.base_icms
 RETURN(.T.)

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIJ9           m.base_icms VALID                  є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210,     Record Number:  101   є
*       є Variable:            m.base_icms                        є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Field                              є
*       є Snippet Number:      33                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
*-------------------------------------------------*

*if m.reduc_icms = 0
*	m.bsbrt_icms = m.base_icms
*endif
*----- SUBSTITUIDO EM 10/02/2011 PARA MELHORAR A ENTRADA DE DADOS



FUNCTION _4i10lmij9     &&  m.base_icms VALID
#REGION 1
IF m.bsbrt_icms > 0
	set decimals to 4
    m.reduc_icms =  m.base_icms / m.bsbrt_icms
	set decimals to 2

ENDIF

if m.bsbrt_icms = m.base_icms
    m.reduc_icms = 0
endif

*-------------------------------------------------*


DO case

	CASE m.ch_opera $ "12" AND  m.icms_subs > 0

*		m.base_isent = m.base_icms   alterado em 9/2/2012
		m.base_isent = m.bsbrt_icms

	CASE m.ch_opera $ "12"  AND m.ch_produ = "1" AND m.aliq_icms = 0 ;
			AND  m.icms_subs = 0

		m.base_isent = m.totproduto
		m.base_icms  = 0



	CASE m.ch_opera $ "12"  AND m.ch_produ = "1" AND m.aliq_icms > 0
		m.base_isent = m.totproduto - m.base_icms

	CASE m.ch_opera $ "2"  AND m.ch_desti = "1"	AND m.ch_produ = "1" ;
		                   AND m.aliq_icms = 0
		m.base_isent = m.totproduto
		m.base_icms  = 0

	CASE m.ch_opera $ "4"  AND m.ch_produ = "1"  AND m.aliq_icms = 0
		m.base_isent = m.totproduto
		m.base_icms  = 0

	CASE m.ch_opera $ "12"  AND m.ch_produ $ "56"
	    m.aliq_icms  = 0
		m.base_isent = 0
		m.base_icms  = 0
		m.base_outr  = m.totproduto + m.vlr_ipi
ENDCASE

*DO case
*	CASE m.icms_subs > 0
*		m.base_isent = m.base_icms
*	CASE 	 m.ch_opera $ "124" ;
*		 AND m.ch_desti = "1"	;
*		 AND m.icms_subs  = 0 AND m.aliq_icms = 0
*
*		m.base_outr  = m.vlr_ipi
*		m.base_isent = m.base_icms
*		m.base_icms  = 0
*	CASE m.icms_subs = 0 AND m.aliq_icms = 0
*		m.base_outr  = m.base_icms + m.vlr_ipi
*		m.base_icms  = 0
*	OTHERWISE
*		m.base_isent = 0
*ENDCASE
SHOW GET m.aliq_icms
SHOW GET m.base_icms
SHOW GET m.base_isent
SHOW GET m.base_outr
SHOW GET m.reduc_icms
SHOW GET m.bsbrt_icms

RETURN(.T.)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIJA           m.vlr_icms WHEN                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210,     Record Number:  102   є
*       є Variable:            m.vlr_icms                         є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Field                              є
*       є Snippet Number:      34                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4i10lmija     &&  m.vlr_icms WHEN
#REGION 1
IF isediting and m.base_icms = 0
	m.vlr_icms =  0
	SHOW GET m.vlr_icms
ENDIF	

IF isadding
	m.vlr_icms =  ROUND((m.aliq_icms * m.base_icms ) / 100,2)
	SHOW GET m.vlr_icms
ENDIF	
RETURN(isediting and LEFT(m.situacao,1) = "A")

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIJB           m.vlr_icms VALID                   є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210,     Record Number:  102   є
*       є Variable:            m.vlr_icms                         є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Field                              є
*       є Snippet Number:      35                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4i10lmijb     &&  m.vlr_icms VALID
#REGION 1
RETURN(.T.)

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIJC           m.base_subs VALID                  є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210,     Record Number:  103   є
*       є Variable:            m.base_subs                        є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Field                              є
*       є Snippet Number:      36                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4i10lmijc     &&  m.base_subs VALID
#REGION 1
IF m.icms_subs > 0 AND m.base_icms = 0
	wp_msg = "Informe a base do ICMS..."
	WAIT WINDOW WP_MSG NOWAIT
	_CUROBJ = OBJNUM(m.base_icms)
ENDIF
RETURN(.T.)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIJD           m.total_nota WHEN                  є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210,     Record Number:  108   є
*       є Variable:            m.total_nota                       є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Field                              є
*       є Snippet Number:      37                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4i10lmijd     &&  m.total_nota WHEN
#REGION 1
m.total_nota =  m.vlrdespes + m.vlrseguro + m.totproduto + ;
			   m.vlr_ipi + m.icms_subs
SHOW GET m.total_nota
RETURN(.F.)

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIJE           m.btncalc VALID                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210,     Record Number:  110   є
*       є Variable:            m.btncalc                          є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      38                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4i10lmije     &&  m.btncalc VALID
#REGION 1
	=W_DEFPROC("rotinas.SPR")

	DO ULCalc_Entrada

RETURN



*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIKB           ULitens VALID                      є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210R,     Record Number:    2  є
*       є Variable:            ULitens                            є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      39                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4i10lmikb     &&  ULitens VALID
#REGION 3
RETURN

FUNCTION ULitens
	IF isediting
		WAIT WINDOW "Termine a Edicao para ativar os itens."
 		RETURN
	ENDIF
	SELE tipooper
	SET ORDER TO TAG tipo
	IF m.natu_oper < 6
		SEEK 'e'+m.tipo
		IF !FOUND()
			SEEK 'E'+m.tipo
		ENDIF
	ELSE
		SEEK 's'+m.tipo
		IF !FOUND()
			SEEK 'S'+m.tipo
		ENDIF
	ENDIF
	DO OBJ_ITEN.spr
	SELE notaent
	IF LASTKEY() <> 27
		IF notaent.totproduto <> m.totproduto or ;
		   notaent.vlr_ipi <> m.vlr_ipi or ;
		   notaent.base_icms <> m.base_icms or ;
		   notaent.vlr_icms <> m.vlr_icms or ;
		   notaent.base_subs <> m.base_subs or ;
		   notaent.base_sbbrt <> m.base_sbbrt or ;
		   notaent.icms_subs <> m.icms_subs or ;
		   notaent.base_isent <> m.base_isent or ;
		   notaent.base_outr  <> m.base_outr  or ;
		   notaent.total_nota <> m.total_nota
			=REGLOCK(.T.)
			***********************  ACEITANDO A DIGITACAO
			SET FIELDS TO dtregis, hregis, usrregis,deletado
			SET FIELDS TO totproduto, vlr_ipi
			=edithand('REGRAVA')
			CLEAR FIELDS
			SET FIELDS OFF
			***************************
		ENDIF
	ENDIF
    CLEAR TYPEAHEAD
	UNLOCK
	ON KEY LABEL ESCAPE
    SCATTER MEMVAR MEMO
	DO refresh
RETURN(.T.)



*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIKJ           BTN_VAL1 VALID                     є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210R,     Record Number:    3  є
*       є Variable:            BTN_VAL1                           є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      40                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4i10lmikj     &&  BTN_VAL1 VALID
#REGION 3
RETURN

PROCEDURE BTN_VAL1
	PARAMETER tecla, m.chv_ler, m.chv_compara, m.chv_brow
	SELE notaent
	SET ORDER TO TAG rldtentr
    DO CASE
		CASE tecla = "ADD"
			IF !ULLibLanc()
			   RETURN(.F.)
			ENDIF


		    DO btn_val with tecla, m.chv_ler, m.chv_compara, m.chv_brow
			wl_cota = .T.    && BUSCAR NUMERO DE COTACAO
			m.situacao = "A "
			m.empresa  = wp_empresa
			m.operador =   nUsr
			m.condicao	= 1
			m.pedido = 0
			SHOW GET m.situacao
			SHOW GET m.empresa
			SHOW GET m.operador

		*	SELECT empresa
		*	=REGLOCK(.T.)
		*	m.referencia = boletim + 1
		*	REPLACE boletim WITH m.referencia
		*	UNLOCK
            m.referencia = 0

			SHOW GET m.referencia
			SELECT notaent
		    ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"

			ON KEY LABEL END do btn_val1 with 'DELETE', VLleitura, ;
												 Vlcompara
			RETURN .T.
		CASE tecla = "EDIT" AND isediting  && SALVANDO



			 IF !ULvldCampos()
				SELECT notaent
				RETURN(.F.)
			 endif

			SELE notaent
			do ULclassifica
            do ULcompara
		    DO btn_val with tecla, m.chv_ler, m.chv_compara, m.chv_brow
			iscancela = .F.
			IF isadding
				do  ULitens
			ENDIF				
		CASE tecla = "EDIT"
		    DO btn_val with tecla, m.chv_ler, m.chv_compara, m.chv_brow
			iscancela = .F.
        CASE tecla = "DELETE"
			IF isediting     && .T. => CANCELA A EDICAO
			    DO btn_val with tecla, m.chv_ler, m.chv_compara, m.chv_brow
				iscancela = .F.
			   	iscancela = .F.
			   	RETURN
			ENDIF
*	*	*	*	*	*	*	* APAGA REGISTROS RELACIONADOS			
			IF EOF() OR BOF()
			   WAIT WINDOW C_ENDFILE NOWAIT
			   RETURN
			ENDIF
			IF !fox_alert(C_DELREC)
			   RETURN
			ENDIF
			SELECT  notaite
			SET ORDER TO TAG orcamento
			SEEK STR(wp_empresa,3)+STR(m.referencia,6)+;
				   STR(m.codforn,5)+STR(m.nota,6)+m.serie+LEFT(m.tipo,1)
			DO WHILE !eof() AND wp_empresa 		= EMPRESA ;
							AND m.referencia 	= orcamento ;
							AND m.codforn 	 	= codforn ;
							AND m.nota 			= nota ;
							AND m.serie			= serie ;
							AND LEFT(m.tipo,1)  = LEFT(tipo,1)
			   =REGLOCK(.T.)
				=edithand('APAGA')
			   SKIP
			ENDDO
			SELECT notaent
			KEYBOARD "{S}"
		    DO btn_val with tecla, m.chv_ler, m.chv_compara, m.chv_brow
			RETURN .T.
		OTHERWISE
		    DO btn_val with tecla, m.chv_ler, m.chv_compara, m.chv_brow
	ENDCASE		
	LDdtant	= m.data	&& SE ALTERAR DATA => ALTERAR HORA

	SELE tipooper
	SET ORDER TO TAG tipo
	IF m.natu_oper < 6
		SEEK 'e'+m.tipo
		IF !FOUND()
			SEEK 'E'+m.tipo
		ENDIF
	ELSE
		SEEK 's'+m.tipo
		IF !FOUND()
			SEEK 'S'+m.tipo
		ENDIF
	ENDIF
	


	m.natureza = tipooper.descnatu
	SHOW GET m.natureza
	SELE transprt
	SEEK m.transp
	m.transp = transprt.cgc
	m.nome_trans = transprt.nome
	SHOW GET m.transp
	SHOW GET m.nome_trans
	SELE fornece
	SET ORDER TO TAG codigo
	SEEK m.codforn
	SCATTER MEMVAR FIELDS nome, estado, pais MEMO
	m.codforn	 = fornece.codigo
	m.favorecido = fornece.cgc
	DO  ULorigem
	SELE notaent
	m.cgcfornece = str(m.favorecido,14)
	SHOW GET m.cgcfornece
	SHOW GET m.nome
	SHOW GET m.ch_desti
   	SHOW GET m.descdest
	DO ULatrmotivos
	SHOW GET m.motivo
	SELE notaent
RETURN


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIKR           local_refresh VALID                є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210R,     Record Number:    4  є
*       є Variable:            local_refresh                      є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      41                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4i10lmikr     &&  local_refresh VALID
#REGION 3
RETURN

PROCEDURE local_refresh
PARAMETERS wl_branco
*****>>>>>>>>>>>  abilita os acessos permitidos
	LNindice = 0
	LSaces = "   "
	IF !lMaster
		LNindice = ASCAN(vAcessos,WPprgativo)
		IF LNindice > 0
				LNindice = ASUBSCRIPT(VACESSOS,LNindice,1)
				LSaces = vAcessos(LNindice,2)
		ENDIF
	ENDIF
	******	
	DO CASE
	   CASE isediting or wl_branco
		  SHOW GET pb_btn   DISABLE
		  SHOW GET cp_btn   DISABLE
		  SHOW GET rmt_btn   DISABLE
		  SHOW GET cmt_btn   DISABLE
		  SHOW GET it_btn   DISABLE
		  SHOW GET	m.dcFis DISABLE

		OTHERWISE
		  LSl = LEFT(m.situacao,1)
		  LSr = RIGHT(m.situacao,1)
		  IF (LSl $ "A")			&& Sem registro de transito
			  SHOW GET cmt_btn   DISABLE
		      SHOW GET cp_btn  DISABLE
	    	  SHOW GET pb_btn  DISABLE
		  ENDIF
		  IF (LSl $ "B")			&& em transito
			  SHOW GET rmt_btn   DISABLE
		      SHOW GET cp_btn  DISABLE
		  ENDIF
		  IF (LSl $ "Cc")   			&& entrada registrada
		  	  SHOW GET pb_btn   	DISABLE
			  SHOW GET rmt_btn      DISABLE
			  SHOW GET cmt_btn      DISABLE
		  ENDIF
		  IF !(LSl $ "A")			&& qualque sit fora inicial
		  	 * SHOW GET cop_btn   	DISABLE
	  		 * SHOW GET edit_btn   	DISABLE
		  	  SHOW GET del_btn   	DISABLE
		  ENDIF
		  IF !(LSl $ "Cc")			&& qualque sit fora inicial
		  	  SHOW GET m.dcFis   	DISABLE
          ENDIF
		*****************
		IF "1" $ LSaces
		  SHOW GET rmt_btn   DISABLE
		ENDIF
		IF "2" $ LSaces	
		  SHOW GET cmt_btn   DISABLE
		ENDIF
		IF "3" $ LSaces	
		  SHOW GET pb_btn   DISABLE
		ENDIF
		IF "4" $ LSaces	
		  SHOW GET cp_btn   DISABLE
		ENDIF
		IF "N" $ LSaces	
		  SHOW GET it_btn   DISABLE
		ENDIF
	ENDCASE
RETURN	


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIKS           ULcompara VALID                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210R,     Record Number:    5  є
*       є Variable:            ULcompara                          є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      42                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4i10lmiks     &&  ULcompara VALID
#REGION 3
RETURN

PROCEDURE ULcompara
	SELECT  notaite
	SET ORDER TO TAG orcamento
	SEEK STR(wp_empresa,3)+STR(m.referencia,6)+;
				   STR(m.codforn,5)+STR(m.nota,6)+m.serie+LEFT(m.tipo,1)
	IF !FOUND()
		SELECT notaent
		RETURN
	ENDIF
    IF 	m.codforn <> codforn or isitens or;
    	m.ch_opera <> ch_opera or m.ch_produ <> ch_produ or;
    	m.ch_motiv <> ch_motiv or m.ch_desti <> ch_desti or;
    	m.ch_contr <> ch_contr or m.ch_condi <> ch_condi or ;
    	m.data	   <> data     or m.hora     <> hora     or ;
    	m.aliq_icms <> aliq_icms
        WAIT WINDOW "Os itens serao reprocessados."
*		set step on
		DO WHILE !eof() AND wp_empresa 		= notaite.EMPRESA ;
						AND m.referencia 	= notaite.orcamento ;
						AND m.codforn 	 	= notaite.codforn
			LNregMarca = RECNO()

			SKIP
			IF EOF()
			   GO BOTT
			ENDIF

  		    LNregistro = RECNO()
			GO LNregMarca


			*	   IF m.nota <> notaite.nota OR m.serie <> notaite.serie
			*		AND LEFT(m.tipo,1)  = LEFT(tipo,1)

			=REGLOCK(.T.)
			SET FIELDS TO dtregis, hregis, usrregis,deletado
			SET FIELDS TO aliq_icms, ch_opera, ch_produ, ;
		   			ch_motiv, ch_desti, ch_contr, ch_condi
			=edithand('REGRAVA')
			CLEAR FIELDS
			SET FIELDS OFF
			***************************
	       	REPLACE favorecido 		   WITH m.favorecido
	       	REPLACE codforn	 		   WITH m.codforn
			REPLACE notaite.movestq    WITH  tipooper.movestq
			REPLACE notaite.movfin     WITH  tipooper.info_vlr && afeta cust
			REPLACE notaite.tipo       WITH  tipooper.tipo
		
            LScfo = ""
 			=W_DEFPROC("notaent.spr")
 			=NEDef_CFO(notaent.tipo,notaite.Tp_Mercad,LScfo)
			REPLACE notaite.cfo        WITH  LScfo

			REPLACE notaite.aliq_icms  WITH  m.aliq_icms
			REPLACE notaite.data       WITH  m.data
			REPLACE notaite.hora       WITH  m.hora
 			GO LNregistro
		ENDDO
		isitens = .f.
    ENDIF
	SELECT notaent
RETURN


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIKT           ULatrmotivos VALID                 є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210R,     Record Number:    6  є
*       є Variable:            ULatrmotivos                       є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      43                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4i10lmikt     &&  ULatrmotivos VALID
#REGION 3
RETURN

PROCEDURE ULatrmotivos
DO CASE
	CASE m.natu_oper = 1
		VTLmotivo(1) = "Mercadoria Comercial      "
		VTLmotivo(2) = "Material de Uso em Servico"
		VTLmotivo(3) = "Material de Consumo       "
		VTLmotivo(4) = "Bens Imobilizados         "
		VTLmotivo(5) = "Complemento de Preco      "
		VTLmotivo(6) = "Conhecimento de Transporte"
		VTLmotivo(7) = "Outros                    "
	CASE m.natu_oper = 2
		VTLmotivo(1) = "Mercadoria Comercial      "
		VTLmotivo(2) = "Material de Uso em Servico"
		VTLmotivo(3) = "Material de Consumo       "
		VTLmotivo(4) = "Bens Imobilizados         "
		VTLmotivo(5) = "Conhecimento de Transporte"
		VTLmotivo(6) = "Outros                    "
		VTLmotivo(7) = "                          "
	CASE m.natu_oper = 3
		VTLmotivo(1) = "Consignacao               "
		VTLmotivo(2) = "Demonstracao              "
		VTLmotivo(3) = "Reclamacao                "
		VTLmotivo(4) = "Outros                    "
		VTLmotivo(5) = "                          "
		VTLmotivo(6) = "                          "
	CASE m.natu_oper = 4
		VTLmotivo(1) = "Mercadoria Comercial      "
		VTLmotivo(2) = "Material de Uso em Servico"
		VTLmotivo(3) = "Material de Consumo       "
		VTLmotivo(4) = "Bens Imobilizados         "
		VTLmotivo(5) = "Outros                    "
		VTLmotivo(6) = "                          "
	CASE m.natu_oper = 5 or m.natu_oper = 6
		VTLmotivo(1) = "                          "
		VTLmotivo(2) = "                          "
		VTLmotivo(3) = "                          "
		VTLmotivo(4) = "                          "
		VTLmotivo(5) = "                          "
		VTLmotivo(6) = "                          "
ENDCASE
RETURN


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIKU           ULclassifica VALID                 є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210R,     Record Number:    7  є
*       є Variable:            ULclassifica                       є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      44                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4i10lmiku     &&  ULclassifica VALID
#REGION 3
RETURN

PROCEDURE ULclassifica
	IF (m.natu_oper = 1 AND m.motivo >= 6) OR ;
	   (m.natu_oper = 2 AND m.motivo >= 5) OR ;
	   (m.natu_oper = 3 AND m.motivo = 4) OR ;
	   (m.natu_oper = 4 AND m.motivo = 5) OR ;
	   (m.natu_oper = 5)
		SELECT tipooper
		SET ORDER TO TAG tipo
 		SEEK 'e'+m.tipo
		IF !FOUND()
			SEEK 'E'+m.tipo  	
		ENDIF
	    SCATTER MEMVAR FIELDS ch_opera, ch_produ, ch_motiv, ch_desti,;
	    			 ch_contr, ch_condi
	ELSE
	  DO CASE
		CASE m.natu_oper = 6
			SELECT tipooper
			SET ORDER TO TAG tipo
 			SEEK 's'+m.tipo
			IF !FOUND()
				SEEK 'S'+m.tipo  	
			ENDIF
		    SCATTER MEMVAR FIELDS ch_opera, ch_produ, ch_motiv, ch_desti,;
		    			 ch_contr, ch_condi
		CASE m.natu_oper = 1
			STORE "1"     TO m.ch_opera  && 1=COMPRA
			STORE "1"     TO m.ch_motiv  && 1=NORMAL  (EXETOCOMPLEMENTO)
			STORE "5"     TO m.ch_contr  && 5=NULO
			STORE STR(m.condicao,1) TO m.ch_condi  && 1=A VISTA  2 -APRAZO
			DO CASE
				CASE m.motivo = 1  && MERCADORIA P/ COMERCIALIZACAO
					m.ch_produ = "1"
				CASE m.motivo = 2  && MATERIAL DE USO NO SERVICO
					m.ch_produ = "5"
				CASE m.motivo = 3  && MATERIAL DE CONSUMO
					m.ch_produ = "6"
				CASE m.motivo = 4  && IMOBILIZADO
					m.ch_produ = "2"
				CASE m.motivo = 5  && COMPLEMENTO PRECO
					m.ch_produ = "1"   && MERCADORI
					m.ch_motiv = "3"   && COMPLEMENTO DE PRECO
					m.ch_condi = "3"   && 3=NULA  EM COMPLEMENTO
			ENDCASE
			SELECT tipooper
			SET ORDER TO TAG tpopera
			SEEK 'E'+m.ch_opera+m.ch_produ+m.ch_motiv+;
					m.ch_desti+m.ch_contr+m.ch_condi
************ Em casos de compra onde a condicao de pgto e nula em
************ termos fiscais. Verifica 1o com condicao e depois sem
************ condicao => ch_condi = 3
			IF !FOUND()
				m.ch_condi = "3"   && 3=NULA  EM COMPLEMENTO
				SEEK 'E'+m.ch_opera+m.ch_produ+m.ch_motiv+;
					m.ch_desti+m.ch_contr+m.ch_condi
			ENDIF
		CASE m.natu_oper = 2
			STORE "2"     TO m.ch_opera  && 2=TRANSFERENCIA
			STORE "1"     TO m.ch_motiv  && 1=NORMAL
			STORE "5"     TO m.ch_contr  && 5=NULO
			STORE "3"     TO m.ch_condi  && 3= NULA
			DO CASE
				CASE m.motivo = 1  && MERCADORIA P/ COMERCIALIZACAO
					m.ch_produ = "1"
				CASE m.motivo = 2  && MATERIAL DE USO NO SERVICO
					m.ch_produ = "5"
				CASE m.motivo = 3  && MATERIAL DE CONSUMO
					m.ch_produ = "6"
				CASE m.motivo = 4  && IMOBILIZADO
					m.ch_produ = "2"
			ENDCASE
			SELECT tipooper
			SET ORDER TO TAG tpopera
			SEEK 'E'+m.ch_opera+m.ch_produ+m.ch_motiv+;
						m.ch_desti+m.ch_contr+m.ch_condi
		CASE m.natu_oper = 3
			STORE "3"     TO m.ch_opera  && 2=TRANSFERENCIA
			STORE "1"     TO m.ch_produ  && 1=MERCADORIA
			STORE "5"     TO m.ch_contr  && 5=NULO
			STORE "3"     TO m.ch_condi  && 3= NULA
			DO CASE
				CASE m.motivo = 1  && CONSIGNACAO
					m.ch_motiv = "5"
				CASE m.motivo = 2  && DEMONSTRACAO
					m.ch_motiv = "6"
				CASE m.motivo = 3  && RECLAMACAO
					m.ch_motiv = "2"
			ENDCASE
			SELECT tipooper
			SET ORDER TO TAG tpopera
			SEEK 'E'+m.ch_opera+m.ch_produ+m.ch_motiv+;
				m.ch_desti+m.ch_contr+m.ch_condi
		CASE m.natu_oper = 4
			STORE "4"     TO m.ch_opera  && 4=DEVOLUCAO
			STORE "1"     TO m.ch_motiv  && 1=NORMAL  (EXETO P/ COMPLEMENTO)
			STORE "5"     TO m.ch_contr  && 5=NULO
			STORE "3"     TO m.ch_condi  && 3= NULA
			DO CASE
				CASE m.motivo = 1  && MERCADORIA
					m.ch_produ = "1"
				CASE m.motivo = 2  && MATERIAL DE USO NO SERVICO
					m.ch_produ = "5"
				CASE m.motivo = 3  && MATERIAL DE CONSUMO
					m.ch_produ = "6"
					m.ch_condi = "3"   && NULO P/ ESTA OPER.
				CASE m.motivo = 4  && IMOBILIZADO
					m.ch_produ = "2"
					m.ch_condi = "3"   && NULO P/ ESTA OPER.
			ENDCASE
			SELECT tipooper
			SET ORDER TO TAG tpopera
			SEEK 'E'+m.ch_opera+m.ch_produ+m.ch_motiv+;
							m.ch_desti+m.ch_contr+m.ch_condi
	  ENDCASE
	ENDIF
	IF !FOUND()
		WAIT WINDOW ;
		"A OPERACAO NAO PODE SER CLASSIFICADA. CHAME SUPORTE...<<ENTER>>"
		m.tipo = "???"
		m.cfo  = "    "
	ELSE
		m.tipo = tipo
		m.cfo  = cfo
	ENDIF
	SELE notaent
RETURN


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIKV           ULorigem VALID                     є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210R,     Record Number:    8  є
*       є Variable:            ULorigem                           є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      45                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4i10lmikv     &&  ULorigem VALID
#REGION 3
RETURN

PROCEDURE ULorigem
	SELE empresa
	SET ORDER TO TAG empresa
	SEEK wp_empresa
	IF empresa.pais <> fornece.pais
	   m.ch_desti = "3"
	   m.descdest = "INTERNACIONAL"
	ELSE
	   IF empresa.pais = fornece.pais AND empresa.estado <> fornece.estado
		   m.ch_desti = "2"
		   m.descdest = "INTERESTADUAL"
	   ELSE
		   m.ch_desti = "1"
		   m.descdest = "ESTADUAL"
	   ENDIF
   ENDIF
   SELE notaent
   SHOW GET m.ch_desti
   SHOW GET m.descdest
RETURN


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIKW           ULReg_Trans VALID                  є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210R,     Record Number:    9  є
*       є Variable:            ULReg_Trans                        є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      46                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4i10lmikw     &&  ULReg_Trans VALID
#REGION 3
RETURN

PROCEDURE ULReg_Trans

	SELECT  notaent

	IF !fox_alert('Confirma a Registro de Mercadoria em Transito ?.')
	   RETURN
	ENDIF

	IF !REGLOCK()
	   WAIT WINDOW "Documento nao poder ser bloqueado para o processo."
	   RETURN
	ENDIF


	IF m.data <> wp_dtoper
    	DO OBJ_MENS.SPR WITH ;
		 "ATENCAO !!!! "+CHR(13)+;
		 "A data do Boletin Nao corresponde a Data Atual..."+CHR(13)+;
		 " Tecle <ENTER> e Responda a Confirmacao."
		IF !fox_alert('Confirma a Processo ?')
			RETURN
		ENDIF
	ENDIF

	SELECT  notaite
	SET ORDER TO TAG orcamento
	SEEK STR(wp_empresa,3)+STR(m.referencia,6)+;
			   STR(m.codforn,5)+STR(m.nota,6)+m.serie+LEFT(m.tipo,1)
	IF      wp_empresa 		<> notaite.EMPRESA ;
		OR  m.referencia 	<> notaite.orcamento ;
		OR  m.codforn 	 	<> notaite.codforn ;
		OR  m.nota 			<> notaite.nota ;
		OR  m.serie			<> notaite.serie ;
		OR  LEFT(m.tipo,1)  <> LEFT(notaite.tipo,1)
	    WAIT WINDOW "Nao foram Lancados Itens......<ENTER>"
    	SELE notaent
	    UNLOCK
    	RETURN
	ENDIF

	***> ((((( PREVIA )))
	LFflgtrans = .t.
	m.valor     = 0
	m.LNqtde	= 0			&& soma das quantidades
	m.LNbs_ipi  = 0         && base para calculo ipi
	m.LNbs_icms = 0         && base para calculo icms
	m.LNbs_subs = 0	     && base para calculo subs
	m.LNbs_sbbrt= 0	     && base para abater icms do icms da subs
	m.LNbs_iss  = 0        && base para calculo iss
	m.LNbs_isen = 0        && mercadorias isentas
	m.LNbs_outr = 0        && outras tributacoes
	m.LNalqicms = tipooper.aliq_icms		&& aliquota de icms
	m.LNalqiss  = empresa.aliq_iss		&& aliquota de iss
	m.LNicms 	 = 0		&& valor de icms
	m.LNsubs 	 = 0		&& valor de icms por substituicao
	m.LNiss  	 = 0		&& valor de iss
	m.LNtotprod  = 0		&& soma dos valores dos produtos
	m.LNtot  	 = 0		&& total da nota

	DO WHILE !eof() AND wp_empresa 		= EMPRESA ;
				AND m.referencia 	= orcamento ;
				AND m.codforn 	 	= codforn ;
				AND m.nota 			= nota ;
				AND m.serie			= serie ;
				AND LEFT(m.tipo,1)  = LEFT(tipo,1)
		IF notaite.movestq = "S" AND (LEFT(notaite.situacao,1) $ "A")
			IF  notaent.data > {01.05.99} ;
		        AND (notaent.codforn = 1 or notaent.codforn = 2) ;
			    AND (notaent.empresa = 1 OR "CENTRAL" $ wp_dirdat);
				AND notaite.ch_opera = "1" ;
				AND LEFT(notaite.classifica,2) $ "00/01" ;
				AND notaent.pedido = 0
			    WAIT WINDOW ;
			    	"Entrada "+STR(notaent.referencia,6)+" sem Nro.Pedido."
				LFflgtrans = .F.
				EXIT
			ENDIF
		    IF m.pedido > 0 AND notaent.data > {01.01.2000}
	  			SELE pedite
	   			SET ORDER TO TAG pedido
	   			SEEK STR(m.empresa,3)+STR(m.pedido,6)+notaite.codigo
			    IF !FOUND()
					LFflgtrans = .F.
	   	   			LSref = STR(notaent.referencia,6)
				    DO OBJ_ALER.SPR WITH ;
		   			"Codigo : "+notaite.codigo+;
		   			" Consta no Boletim "+notaent.tipo+;
		   			" "+LSref+CHR(13)+;
		   			" e nao esta registrado no Pedido "+;
		   			str(notaent.pedido,6)
					EXIT
	   			ENDIF
			ENDIF
			=W_DEFPROC("NOTAITE.SPR")
			=IEVerifCustoDistocido(notaite.empresa, ;
								   notaite.Favorecido,;
								   notaite.orcamento,;
								   notaite.Ordem)
		ENDIF
		SELE notaite

**		do UPimpent
        LNbs_ipi  = LNbs_ipi + vlripi
		LNbs_outr = m.LNbs_outr + vlripi
		LNtotprod = LNtotprod + vlrvenda
		LNqtde	  = LNqtde + qtde
        m.valor   = m.valor + vlrvenda

		SKIP
	ENDDO
	IF !LFflgtrans
	   WAIT WINDOW "Os itens apresentam irregularidades."
	   SELE notaent
	   UNLOCK
	   RETURN
	ENDIF

	LFflgtrans = .T.

	IF m.LNtotprod <> m.totproduto		&& soma dos valores dos produtos
		wp_msg = "TOTAL PRODUTO NAO CONFERE - Informado =" + ;
						 TRANSFORM(m.totproduto,"9,999,999.99");
		+chr(13)+;
				 "                      - Encontrado=" + ;
						 TRANSFORM(m.LNtotprod,"9,999,999.99")
	    DO OBJ_MENS.SPR WITH  wp_msg

		LFflgtrans = .F.
	ENDIF

	IF m.LNbs_ipi <> m.vlr_ipi		&& soma dos valores dos produtos
		wp_msg = "TOTAL IPI NAO CONFERE     - Informado =" + ;
						 TRANSFORM(m.vlr_ipi,"9,999,999.99");
		+chr(13)+;
				 "                      - Encontrado=" + ;
						 TRANSFORM(m.LNbs_ipi,"9,999,999.99")
	    DO OBJ_MENS.SPR WITH  wp_msg
		LFflgtrans = .F.
	ENDIF
	******************  VALOR DA NOTA  ********************
	m.soma_nota  =  m.vlrdespes + m.vlrseguro + m.totproduto + ;
			   	m.vlr_ipi + m.icms_subs

	IF ABS(m.soma_nota) <> ABS(m.total_nota)
		wp_msg = "TOTAL NF. NAO CONFERE - Informado =" + ;
						 TRANSFORM(m.total_nota,"9,999,999.99");
		+chr(13)+;
				 "                      - Calculado =" + ;
						 TRANSFORM(soma_nota,"9,999,999.99")
    	DO OBJ_MENS.SPR WITH  wp_msg
		LFflgtrans = .F.
	ENDIF
	***************************************************************
	IF !LFflgtrans
	   SELE notaent
	   UNLOCK
	   RETURN
	ENDIF
	******************  VALOR PARA FECHAMENTO ********************
	m.soma_comp  = (m.LNqtde/100) + m.LNtotprod + m.LNbs_ipi ;
					+  m.vlr_icms + m.vlrfrete + m.base_subs;
					+  m.icms_subs	+ m.vlrseguro + ;
					   m.vlrdespes
	***************************************************************
	IF ABS(ABS(m.soma_qtde) - ABS(m.soma_comp)) > 0
		wp_msg = "Vlr. de FECHAMENTO =;
			 "+TRANSFORM(soma_qtde,"9,999,999.99");
			+chr(13)+ " Inconsistente. "
	    DO OBJ_MENS.SPR WITH  wp_msg
		RETURN
	ENDIF
    *
	*-------------------------------------------------------------------*
	=W_DEFPROC("NOTAENT.SPR")
	=NEReg_Trans(notaent.empresa,notaent.referencia,notaent.codforn)
	*----------------------------------------------------------*
	UNLOCK ALL
	SELECT notaent
	SCATTER MEMVAR MEMO
	SHOW GETS
	DO refresh
RETURN


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMILZ           ULCanc_Trans VALID                 є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210R,     Record Number:   10  є
*       є Variable:            ULCanc_Trans                       є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      47                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4i10lmilz     &&  ULCanc_Trans VALID
#REGION 3
RETURN

PROCEDURE ULCanc_Trans

	SELECT  notaent


	IF !fox_alert('Confirma a Cancelamento Reg. de Merc. em Transito ?.')
	   RETURN
	ENDIF
	*-------------------------------------------------------------------*
	=W_DEFPROC("NOTAENT.SPR")
	=NECanc_Trans(notaent.empresa,notaent.referencia,notaent.codforn)
	*----------------------------------------------------------*
	UNLOCK ALL
	SELECT notaent
	SCATTER MEMVAR MEMO
	SHOW GETS
	DO refresh
RETURN


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIM5           ULReg_Entrada VALID                є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210R,     Record Number:   11  є
*       є Variable:            ULReg_Entrada                      є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      48                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4i10lmim5     &&  ULReg_Entrada VALID
#REGION 3
RETURN

PROCEDURE ULReg_Entrada

	SELECT  notaent


	IF !fox_alert('Confirma a Faturamento ?.')
	   RETURN
	ENDIF
	*-------------------------------------------------------------------*
	=W_DEFPROC("NOTAENT.SPR")

	=NEReg_Entrada(notaent.empresa,;
	               notaent.referencia,;
	               notaent.codforn,;
	               "PROCESSO ENTRADA")
	*----------------------------------------------------------*
	UNLOCK ALL
	SELECT notaent
	SCATTER MEMVAR MEMO
	SHOW GETS
	DO refresh
RETURN


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIMB           ULCanc_Entrada VALID               є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210R,     Record Number:   12  є
*       є Variable:            ULCanc_Entrada                     є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      49                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4i10lmimb     &&  ULCanc_Entrada VALID
#REGION 3
RETURN

PROCEDURE ULCanc_Entrada
	#DEFINE C_FATURA			'Confirma a Cancelamento do Processo ?.'


	SELECT  notaent


	IF !fox_alert(C_FATURA)
	   RETURN
	ENDIF


	IF MONTH(wp_dtoper) <> MONTH(m.data) OR  ;
		YEAR(wp_dtoper) <> YEAR(m.data)
		wp_msg = 'Usuario com Acesso a Outros Meses...'
		BTMP   =  'usuario.outro_mes = "S"'
		LNusr_ret = 0
		DO obj_prmt.SPR WITH   wp_msg , Btmp
		IF LNusr_ret =  0
			 return(.f.)
		ENDIF
	ELSE	
		IF (wp_dtoper - m.data) > 1
			wp_msg = 'Usuario com Acesso a Data Retroativa...'
			BTMP   =  'usuario.retroacao = "S" '
			LNusr_ret = 0
			DO obj_prmt.SPR WITH   wp_msg , Btmp
			IF LNusr_ret =  0
				 return(.f.)
			ENDIF
		ENDIF	
	ENDIF
	*-------------------------------------------------------------------*
	=W_DEFPROC("NOTAENT.SPR")
	=NECanc_Entrada(notaent.empresa,notaent.referencia,notaent.codforn)
	*----------------------------------------------------------*
	UNLOCK ALL
	SELECT notaent
	SCATTER MEMVAR MEMO
	SHOW GETS
	DO refresh
RETURN


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIMC           ULvldCampos VALID                  є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210R,     Record Number:   13  є
*       є Variable:            ULvldCampos                        є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      50                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4i10lmimc     &&  ULvldCampos VALID
#REGION 3
RETURN

FUNCTION ULvldCampos
	PARAMETER tecla, m.chv_ler, m.chv_compara, m.chv_brow

 	PRIVATE  LSAno,LSMes,LSDT,lsTMPDOC


             *------------------------------------------------------*

			 lsTMPDOC=  "2D/03/3A/3B/01/1B/02/2E/04/06/07/08/8B/09/10/11/";
        		+  	"13/14/15/17/16/18/20/21/22/23/24/25/26/27/28/29/55/57/"

			 IF !( m.nf_mod_doc $ lsTMPDOC)

		   		DO OBJ_MENS.SPR WITH "    ATENCAO!!"+CHR(13)+CHR(13)+;
			   		"Informe Mod: " +lsTMPDOC
				SELECT notaent
				RETURN(.F.)
			 endif

             *------------------------------------------------------*

			 IF      m.nf_mod_doc = "55/57" ;
			     AND EMPTY(M.NFE_CHV) ;
			     AND M.DATA > {01.01.2012}

		   		DO OBJ_MENS.SPR WITH "    ATENCAO!!"+CHR(13)+CHR(13)+;
			   		"Informe Chave NFe "
				SELECT notaent
				RETURN(.F.)
			 endif

             *------------------------------------------------------*
             LSCpfCnpj = CHRTRAN(m.cgcfornece," ","0")
			 IF     ( m.nf_mod_doc $ "55/57") ;
			    AND  !(m.LSCpfCnpj $ M.NFE_CHV)


		   		DO OBJ_MENS.SPR WITH "    ATENCAO!!"+CHR(13)+CHR(13)+;
			   		"CNPJ Fornecedor nao compativel com CHAVE NFe "
				SELECT notaent
				RETURN(.F.)
			 endif

             *------------------------------------------------------*
             LSAno = CHRTRAN(SUBS(STR(YEAR(m.data_emi),4),3,2)," ","0")
             LSMes = CHRTRAN(STR(MONTH(m.data_emi),2)," ","0")

             LSDT = LSAno+LSMes

			 IF     ( m.nf_mod_doc $ "55/57") ;
			    AND  !(LSDT $ M.NFE_CHV)

		   		DO OBJ_MENS.SPR WITH "    ATENCAO!!"+CHR(13)+CHR(13)+;
			   		"Data Emissao nao compativel com Chave NFe "
				SELECT notaent
				RETURN(.F.)
			 endif

             *------------------------------------------------------*
             LSDoc = ALLTRIM(STR(m.nota,9))


			 IF     ( m.nf_mod_doc $ "55/57") ;
			    AND  !(LSDoc $ M.NFE_CHV)

		   		DO OBJ_MENS.SPR WITH "    ATENCAO!!"+CHR(13)+CHR(13)+;
			   		"Nro Documento nao compativel com Chave NFe "
				SELECT notaent
				RETURN(.F.)
			 endif

RETURN(.T.)

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIMD           ULLibLanc VALID                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210R,     Record Number:   14  є
*       є Variable:            ULLibLanc                          є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      51                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4i10lmimd     &&  ULLibLanc VALID
#REGION 3
RETURN

FUNCTION ULLibLanc

PRIVATE LSNroDoc

	*-------------------------------------------------------------------*
	=W_DEFPROC("NOTAENT.SPR")



    LSNroDoc =  NEVerPendencias(Wp_empresa)

    IF LSNroDoc > 0
        LSNroDoc = STR(LSNroDoc,6)
   		DO OBJ_MENS.SPR WITH "    ATENCAO!!"+CHR(13)+CHR(13)+;
   	   	   "Existem entradas pendentes de envio XML"+;
   	   	   " ( situacao = c): "+ LSNroDoc
				SELECT notaent
				RETURN(.F.)
	ENDIF
   	   	
RETURN(.T.)

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIME           ULCalc_Entrada VALID               є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC210R,     Record Number:   15  є
*       є Variable:            ULCalc_Entrada                     є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      52                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

FUNCTION _4i10lmime     &&  ULCalc_Entrada VALID
#REGION 3
RETURN

PROCEDURE ULCalc_Entrada
	IF !fox_alert('Confirma a Calculo?.')
	   RETURN
	ENDIF
	*-------------------------------------------------------------------*
	=W_DEFPROC("NOTAENT.SPR")

	=NECalc_Entrada(notaent.empresa,;
	               notaent.referencia,;
	               notaent.codforn,;
	               "PROCESSO ENTRADA")
	*----------------------------------------------------------*
	UNLOCK ALL
	SELECT notaent
	SCATTER MEMVAR MEMO
	SHOW GETS
	DO refresh
RETURN


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _4I10LMIMF           Read Level Show                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         Multiple Screens                   є
*       є Called By:           READ Statement                     є
*       є Snippet Number:      53                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _4i10lmimf     && Read Level Show
PRIVATE currwind
STORE WOUTPUT() TO currwind
*
* Show Code from screen: SCGC210R
*
#REGION 3
HIDE WINDOW SCGC210R

IF NOT EMPTY(currwind)
	ACTIVATE WINDOW (currwind) SAME
ENDIF