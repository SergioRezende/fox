*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        06/10/13            PRTSETUP.SPR               17:10:18 
*                                                                
*       픔컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        Author's Name                                           
*                                                                
*        Copyright (c) 2013 Company Name                         
*        Address                                                 
*        City,     Zip                                           
*                                                                
*        Description:                                            
*        This program was automatically generated by GENSCRN.    
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                PRTSETUP/MS-DOS Setup Code - SECTION 1          
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 1
**** #READCLAUSES MODAL

PRIVATE LSprtareant
PRIVATE isediting
isediting = .t.


LSprtareant = ALLTRIM(ALIAS()) && PERMITE RETORNAR A AREA ANTER. A CHAMADA
LFpriprt	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
wp_flgfecha = .f.
IF !USED("printer")
	LFpriprt 	= .T.
	IF ! NetUse("printer")
		IF !EMPTY(LSprtareant)
			SELECT &LSprtareant
		ENDIF
		RETURN
	ENDIF
ENDIF



#REGION 0
REGIONAL m.currarea, m.talkstat, m.compstat

IF SET("TALK") = "ON"
	SET TALK OFF
	m.talkstat = "ON"
ELSE
	m.talkstat = "OFF"
ENDIF
m.compstat = SET("COMPATIBLE")
SET COMPATIBLE FOXPLUS

*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                       MS-DOS Window definitions                
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

IF NOT WEXIST("_3t010szkk")
	DEFINE WINDOW _3t010szkk ;
		FROM INT((SROW()-20)/2),INT((SCOL()-66)/2) ;
		TO INT((SROW()-20)/2)+19,INT((SCOL()-66)/2)+65 ;
		TITLE "Direcionamento de Impressao" ;
		FLOAT ;
		NOCLOSE ;
		SHADOW ;
		NOMINIMIZE ;
		DOUBLE ;
		COLOR SCHEME 5
ENDIF


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                PRTSETUP/MS-DOS Setup Code - SECTION 2          
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 1
******>>>> INICIO CONTROLE LOCAL
PUSH KEY CLEAR
ON KEY LABEL F1		DO HLP2000.SPR WITH  POPUP(),PROMPT(),PROGRAM(),;
							WONTOP(),VARREAD()

*************
skipvar = .T.
pfilname = SPACE(67)
pdest = wp_destimp
IF ":" $ pdest
   pdest = LEFT(pdest,AT(':',pdest)-1)
ENDIF
IF !INLIST(pdest,'PRN','LPT1','LPT2','LPT3','COM1','COM2','COM3')
   pfilname = PADR(pdest,67)
   pdest = 'REDE'
ENDIF
origdest = pdest
origimpr = wp_impressora
origdesc = wp_descimp
orignome = wp_nomeimp
origserv = wp_servimp
origspool= wp_servspool
orignum  = wp_servnum
origlibe = wp_libimp

prt_infile =pfilname

*******  IF EMPTY(ALLTRIM(wp_arqname))

=UParqvisao() 	   && atribui nome a wp_arqname

******  ENDIF

IF SET('PRINT') = 'ON'
   prtstat = 1
ELSE
   prtstat = 2
ENDIF
origprtstat = prtstat

pdrivstup = IIF(LEN(_PDRIVER)=0,0,1)
wp_drivstup = IIF(LEN(_PDRIVER)=0,0,1)


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                     PRTSETUP/MS-DOS Screen Layout              
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 1
IF WVISIBLE("_3t010szkk")
	ACTIVATE WINDOW _3t010szkk SAME
ELSE
	ACTIVATE WINDOW _3t010szkk NOSHOW
ENDIF
@ 10,1 TO 17,61
@ 0,1 TO 7,62
@ 2,3 SAY "Imprimie em:" ;
	SIZE 1,12, 0
@ 13,42 SAY "Copias.:" ;
	SIZE 1,8, 0
@ 12,27 SAY "-" ;
	SIZE 1,1, 0
@ 12,41 SAY "-" ;
	SIZE 1,1, 0
@ 1,43 SAY "Pg.Inicio:" ;
	SIZE 1,10, 0
@ 2,43 SAY "Pg.Fim...:" ;
	SIZE 1,10, 0
@ 14,27 SAY "-" ;
	SIZE 1,1, 0
@ 15,5 SAY "Controlador Spool:" ;
	SIZE 1,18, 0
@ 12,5 SAY "Impressora.......:" ;
	SIZE 1,18, 0
@ 13,5 SAY "Formulario.......:" ;
	SIZE 1,18, 0
@ 14,5 SAY "Serv.Impressao...:" ;
	SIZE 1,18, 0
@ 1,16 GET pdest ;
	PICTURE "@^ REDE;PRN;LPT1;LPT2;LPT3;COM1;COM2;COM3" ;
	SIZE 3,18 ;
	DEFAULT "REDE" ;
	WHEN _3t010szkq() ;
	VALID _3t010szkr() ;
	COLOR SCHEME 5, 6
@ 1,54 GET wp_pgini ;
	SIZE 1,4 ;
	DEFAULT 0 ;
	PICTURE "9999" ;
	WHEN isediting
@ 2,54 GET wp_pgfim ;
	SIZE 1,4 ;
	DEFAULT 0 ;
	PICTURE "9999" ;
	WHEN isediting
@ 5,3 GET arqlist ;
	PICTURE "@*HN \<Arq.Video" ;
	SIZE 1,12,1 ;
	DEFAULT 1 ;
	WHEN _3t010szks() ;
	VALID _3t010szkt()
@ 5,16 GET wp_arqname ;
	SIZE 1,41 ;
	DEFAULT " " ;
	PICTURE "@K " ;
	WHEN isediting
@ 7,15 GET OKbut ;
	PICTURE "@*HT \<OK" ;
	SIZE 1,10,6 ;
	DEFAULT 1 ;
	WHEN isediting ;
	VALID _3t010szku()
@ 7,35 GET CancBut ;
	PICTURE "@*HN \<Cancela" ;
	SIZE 1,10,1 ;
	DEFAULT 1 ;
	WHEN isediting  ;
	VALID _3t010szkv()
@ 10,10 GET pdrivstup ;
	PICTURE "@*C \<Definicao Tipo Impressora e Impressao..." ;
	SIZE 1,44 ;
	DEFAULT 0 ;
	WHEN isediting  ;
	VALID _3t010szkw()
@ 12,25 GET wp_impressora ;
	SIZE 1,2 ;
	DEFAULT 0 ;
	PICTURE "99" ;
	WHEN isediting  ;
	VALID _3t010szkx()
@ 12,28 GET wp_descimp ;
	SIZE 1,13 ;
	DEFAULT " " ;
	PICTURE "@3S67" ;
	WHEN .F.
@ 12,42 GET wp_nomeimp ;
	SIZE 1,13 ;
	DEFAULT " " ;
	PICTURE "@3S25" ;
	WHEN .F.
@ 13,25 GET wp_formimp ;
	SIZE 1,2 ;
	DEFAULT " " ;
	PICTURE "99" ;
	WHEN isediting 
@ 13,51 GET wp_copimp ;
	SIZE 1,2 ;
	DEFAULT " " ;
	PICTURE "99" ;
	WHEN isediting 
@ 14,25 GET wp_servnum ;
	SIZE 1,2 ;
	DEFAULT " " ;
	PICTURE "99" ;
	WHEN .F.
@ 14,28 GET wp_servimp ;
	SIZE 1,13 ;
	DEFAULT " " ;
	PICTURE "@3S25" ;
	WHEN .F.
@ 15,25 GET wp_servspool ;
	SIZE 1,13 ;
	DEFAULT " " ;
	PICTURE "@3S25" ;
	WHEN .F.
@ 0,2 SAY "s" ;
	SIZE 1,1, 0

IF NOT WVISIBLE("_3t010szkk")
	ACTIVATE WINDOW _3t010szkk
ENDIF

READ CYCLE MODAL ;
	DEACTIVATE _3t010szky() ;
	SHOW _3t010szkz()

RELEASE WINDOW _3t010szkk

#REGION 0
IF m.talkstat = "ON"
	SET TALK ON
ENDIF
IF m.compstat = "ON"
	SET COMPATIBLE ON
ENDIF


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                     PRTSETUP/MS-DOS Cleanup Code               
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 1
LParqant = " "
IF TYPE("wl_arqtmp") <> "U"
	LParqant = wl_arqtmp && PREVE  QUE A VAR (WL_ARQTMP) JA ESTEJA USADA
ELSE
	wl_arqtmp = " "
ENDIF
LNtmp     = 65		&& TABELA ASCII A = 65
IF !UPabretmp("si")
	wl_arqtmp = "SAIDA"
ENDIF
SET SAFET OFF
****************
LPtmp = "&wp_dirtmp"+"&wl_arqtmp"
****************
wl_arqtmp = LParqant

HIDE MENU ALL
HIDE WINDOW ALL
HIDE POPUP  ALL

DO CASE
CASE okbut = 1
	=UPapaga()
   SET PRINTER TO
   pdest = ALLTRIM(UPPER(pdest))
   DO CASE
   CASE pdest = 'REDE'
      IF !EMPTY(wp_impressora)
		RUN CAPTURE /SERVER=&wp_servimp ;
		        /QUEUE=&wp_nomeimp /FORM=&wp_formimp ;
		        /COPIES=&wp_copimp /NO FORMFEED /NO BANNER > &LPtmp

		RUN PSC PS=&wp_servspool P=&wp_servnum MOUNT FORM ;
				 &wp_formimp > &LPtmp
		RUN PSC PS= &wp_servspool  P=&wp_servnum STAT > &LPtmp
      ENDIF
   OTHERWISE
      SET PRINTER TO &pdest
   ENDCASE
   wp_destimp = pdest
CASE cancbut = 1
   pdest = origdest
   pfilname = prt_infile
   wp_impressora = origimpr
   wp_descimp    = origdesc
   wp_nomeimp    = orignome
   wp_servimp    = origserv
   wp_servspool  = origspool
   wp_servnum    = orignum
   wp_libimp     = origlibe
	CLEAR TYPEAHEAD
	KEYBOARD CHR(27)
    =INKEY()
ENDCASE
skipvar = .F.
IF LFpriprt 		&& .t. =>  DEVE SER FECHADA NA SAIDA
	=UP_fecha("printer")
ENDIF
wp_flgfecha = .F. 		&& defaut nao fechamento da secao
IF !EMPTY(LSprtareant)
	SELECT &LSprtareant
ENDIF
ON KEY LABEL ESCAPE
SET FORMAT TO

POP KEY 			&& reabilita teclas de atalho def. anteriormente

=UPapaga()

*SHOW  MENU ALL
*SHOW  WINDOW ALL
*SHOW  POPUP  ALL

RETURN


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _3T010SZKQ           pdest WHEN                         
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         PRTSETUP,     Record Number:   15  
*        Variable:            pdest                              
*        Called By:           WHEN Clause                        
*        Object Type:         Popup                              
*        Snippet Number:      1                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _3t010szkq     &&  pdest WHEN
#REGION 1
ON KEY LABEL ESCAPE	KEYBOARD "{END}"
RETURN(isediting)


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _3T010SZKR           pdest VALID                        
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         PRTSETUP,     Record Number:   15  
*        Variable:            pdest                              
*        Called By:           VALID Clause                       
*        Object Type:         Popup                              
*        Snippet Number:      2                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _3t010szkr     &&  pdest VALID
#REGION 1
SHOW GETS


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _3T010SZKS           arqlist WHEN                       
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         PRTSETUP,     Record Number:   18  
*        Variable:            arqlist                            
*        Called By:           WHEN Clause                        
*        Object Type:         Push Button                        
*        Snippet Number:      3                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _3t010szks     &&  arqlist WHEN
#REGION 1
ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
RETURN(isediting)


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _3T010SZKT           arqlist VALID                      
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         PRTSETUP,     Record Number:   18  
*        Variable:            arqlist                            
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      4                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _3t010szkt     &&  arqlist VALID
#REGION 1
LStmp  = sys(5)+sys(2003)  		&&  UNIDADE E DIRETORIO CORRENTES
IF arqlist = 1 AND LASTKEY() <> 13
   LStmp2 = sys(5)+"\RELATO" &&  UNIDADE E DIRETORIO ARQ. SAIDA
   origfile = wp_arqname
   SET DEFA TO &LStmp2
   wp_arqname = GETFILE('','Arquivo de saida:')
   IF EMPTY(wp_arqname)
      wp_arqname = origfile
	ELSE
	  keytmp = ON('KEY', 'ESCAPE')
	  ON KEY LABEL ESCAPE
  	  MODIF COMM &wp_arqname NOEDIT
	  ON KEY LABEL ESCAPE &keytmp
   ENDIF
ENDIF
wp_arqname = UPPER(PADR(wp_arqname,67))
SHOW GETS
SET DEFA TO &LStmp
SET PATH TO &LStmp		&& VOLTA AO DIRETORIO PADRAO


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _3T010SZKU           OKbut VALID                        
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         PRTSETUP,     Record Number:   20  
*        Variable:            OKbut                              
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      5                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _3t010szku     &&  OKbut VALID
#REGION 1
isediting = .f.
RETURN(.T.)


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _3T010SZKV           CancBut VALID                      
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         PRTSETUP,     Record Number:   21  
*        Variable:            CancBut                            
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      6                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _3t010szkv     &&  CancBut VALID
#REGION 1
isediting = .f.
CLEAR TYPEAHEAD
ON KEY
KEYBOARD CHR(27)
=INKEY()

*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _3T010SZKW           pdrivstup VALID                    
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         PRTSETUP,     Record Number:   22  
*        Variable:            pdrivstup                          
*        Called By:           VALID Clause                       
*        Object Type:         Check Box                          
*        Snippet Number:      7                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _3t010szkw     &&  pdrivstup VALID
#REGION 1
DO (_GENPD) WITH 1,"?"
ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
IF LEN(_PDSETUP) = 0
   pdrivstup = 0
   wp_drivstup = 0
ELSE
   pdrivstup = 1
   wp_drivstup = 1
ENDIF
SHOW GET pdrivstup


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _3T010SZKX           wp_impressora VALID                
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         PRTSETUP,     Record Number:   23  
*        Variable:            wp_impressora                      
*        Called By:           VALID Clause                       
*        Object Type:         Field                              
*        Snippet Number:      8                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _3t010szkx     &&  wp_impressora VALID
#REGION 1
SELECT printer
SET ORDER TO TAG codimp
IF LASTKEY() = 9
   ON KEY LABEL ESCAPE
   DO loc_dlog WITH .T.
   ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
   IF LASTKEY() = 27
		RETURN .F.
	ENDIF
ENDIF
IF !SEEK(wp_impressora)
	wp_impressora= 	0
	wp_descimp 	= 	""
	wp_servimp 	= 	""
	wp_servspo	= 	""
	wp_sernum 	= 	""
	wp_nomeimp 	= 	""
ELSE
	wp_descimp 	= 	ALLTRIM(printer.descricao)
	wp_servimp 	= 	ALLTRIM(printer.servimp)
	wp_servspo 	= 	ALLTRIM(printer.servspool)
	wp_servnum 	= 	ALLTRIM(printer.servnum)
	wp_nomeimp 	= 	ALLTRIM(printer.nomeimp)
ENDIF
SHOW GET wp_impressora
SHOW GET wp_descimp
SHOW GET wp_servimp
SHOW GET wp_servspo
SHOW GET wp_servnum
SHOW GET wp_nomeimp
RETURN .T.


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _3T010SZKY           Read Level Deactivate              
*                                                                
*        Function Origin:                                        
*                                                                
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         PRTSETUP                           
*        Called By:           READ Statement                     
*        Snippet Number:      9                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _3t010szky     && Read Level Deactivate
*
* Deactivate Code from screen: PRTSETUP
*
#REGION 1
?? CHR(7)
CLEAR TYPEAHEAD
KEYBOARD CHR(27)

RETURN .F.


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _3T010SZKZ           Read Level Show                    
*                                                                
*        Function Origin:                                        
*                                                                
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         PRTSETUP                           
*        Called By:           READ Statement                     
*        Snippet Number:      10                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _3t010szkz     && Read Level Show
PRIVATE currwind
STORE WOUTPUT() TO currwind
*
* Show Code from screen: PRTSETUP
*
#REGION 1
IF UPPER(pdest) = 'REDE'
   SHOW GET wp_impressora ENABLE
   SHOW GET wp_descimp    ENABLE
   SHOW GET wp_nomeimp    ENABLE
   SHOW GET wp_servimp    ENABLE
   SHOW GET wp_formimp    ENABLE
   SHOW GET wp_copimp     ENABLE
ELSE
   SHOW GET wp_impressora DISABLE
   SHOW GET wp_descimp    DISABLE
   SHOW GET wp_nomeimp    DISABLE
   SHOW GET wp_servimp    DISABLE
   SHOW GET wp_formimp    DISABLE
   SHOW GET wp_copimp     DISABLE
ENDIF
SHOW GET okbut ENABLE

IF NOT EMPTY(currwind)
	ACTIVATE WINDOW (currwind) SAME
ENDIF

ss