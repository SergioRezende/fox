	SET TALK ON
	CLOSE ALL

***** INFORMA NOMES DOS MUNICIPIO 
	SELE 0
	USE  X:\FPD26\CEP\MUNICPIO.DBF ALIAS NM_MUN
	SET ORDER TO TAG MUNI_ID

***** INFORMA LIGACAO DO CEP COM O MUNICIPIO
	SELE 0
	USE  X:\FPD26\CEP\BAIRROS.DBF ALIAS BAI
	SET ORDER TO TAG BAIR_ID
	SET RELATION TO MUNI_ID INTO NM_MUN

*---------------------------------------*

	SELE 0
	USE  X:\FPD26\CEP\CEP_MUNI.DBF ALIAS MUN
	SET ORDER TO TAG UF_CIDADE

	SELE 0
	USE  X:\FPD26\CEP\CEP_INV.DBF ALIAS INV
	SET ORDER TO TAG CEP

	SELE 0
	USE  X:\FPD26\CEP\CEP_ENC3.DBF ALIAS LOC
	SET ORDER TO TAG CEP

	SELE 0
	USE  X:\FPD26\CEP\CEP.DBF ALIAS CEP
	SET ORDER TO TAG ENDE_CEP
	SET RELATION TO BAIR_ID INTO BAI
*-------------------------------------*

	SELE 0
	USE  X:\SCGC\CENTRAL\CLIENTES ALIAS NF
	SET ORDER TO TAG NOME
	SET RELATION TO  ESTADO+LEFT(ALLTRIM(CIDADE),30) INTO MUN
	SET RELATION TO  INT(VAL(CEP))  INTO CEP ADDITIVE
	SET RELATION TO  ESTADO+LEFT(ALLTRIM(CIDADE),30) INTO LOC ADDITIVE

	DO VER

 	DO CORRIGE
	
RETURN

PROCEDURE CORRIGE

	ON ERROR
	ON KEY
	SET ESCAPE ON
	SET ESCAPE ON
	GO TOP
	DO WHILE !EOF()
		DO CASE
    	   CASE !EMPTY(CEP.ENDE_CEP)   && O CEP E VALIDO
	            IF MUN.MUNI_CEP > 0
				    REPLACE NF.CIDADE WITH  MUN.MUNICIPIO
				    REPLACE NF.ESTADO WITH  MUN.UF
	    	    ENDIF
    	   CASE EMPTY(CEP.ENDE_CEP)   && O CEP INVALIDO
				DO CASE
					CASE MUN.MUNI_CEP > 0
		                REPLACE NF.CEP WITH STR(MUN.MUNI_CEP,8)
					    REPLACE NF.CIDADE WITH  MUN.MUNICIPIO
					    REPLACE NF.ESTADO WITH  MUN.UF
					CASE LOC.CEP > 0
		                REPLACE NF.CEP WITH STR(LOC.CEP,8)
					    REPLACE NF.CIDADE WITH  LOC.CIDADE_OK
					    REPLACE NF.ESTADO WITH  LOC.UF_OK
				ENDCASE
		ENDCASE
		SKIP
	ENDDO
RETURN

PROCEDURE VER

*-----------
	BROWS FIELDS NF.CEP  	:H="NF CEP",;
             CEP.ENDE_CEP :H="END CEP",;
             MUN.MUNI_CEP  :H="MUN CEP",;
             LOC.CEP  :H="ENC CEP",;
             NF.ESTADO :H="NF UF",;
             NF.CIDADE,;
             MUN.UF,;
             MUN.MUNICIPIO 

*	  FOR     EMPTY(CEP.ENDE_CEP) ;
*     AND EMPTY(MUN.MUNI_CEP) ;
*      AND EMPTY(LOC.CEP)
             
RETURN
*-----------


PROCEDURE COP_INVALIDOS

	*---------------------------------------------------*
	* 1- IDENTIFICA CIDADES SEM REFERENCIA EM MUN e LOC
	*---------------------------------------------------*

	COPY FIELDS NF.CEP,NF.ESTADO,NF.CIDADE ;
	  TO  X:\FPD26\CEP\CEP_INV4 ;
	  FOR     EMPTY(CEP.ENDE_CEP) ;
      AND EMPTY(MUN.MUNI_CEP) ;
       AND EMPTY(LOC.CEP)

	*---------------------------------------------------*
	* 2- CRIA RELACAO DE CIDADES SEM REFERENCIA EM MUN e LOC
	*---------------------------------------------------*

	SELECT CEP,ESTADO AS UF,CIDADE ;
	FROM X:\FPD26\CEP\CEP_INV4 ;
	GROUP BY UF,CIDADE ;
	INTO  TABLE X:\FPD26\CEP\CEP_INV
	

	*---------------------------------------------------*
	* 3- ANEXA CIDADE INVALIDAS EM LOC
	*-    MANUALMENTE DEVE SER ATRIBUIDO OS CEPs AS NOVAS
	*     CIDADES INVALIDAS
	*---------------------------------------------------*
	SELE LOC
	APPEND FROM X:\FPD26\CEP\CEP_INV

	*---------------------------------------------------*
	* 4- EXECUTAR A PROCEDURE CORRIGE
	*---------------------------------------------------*

RETURN
*-----------
