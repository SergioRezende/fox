*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨ 19/03/2009            SCGC243.SPR              11:30:33 ╨
*       ╨                                                         ╨
*       гддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╤
*       ╨                                                         ╨
*       ╨ Author's Name                                           ╨
*       ╨                                                         ╨
*       ╨ Copyright (c) 2009 Company Name                         ╨
*       ╨ Address                                                 ╨
*       ╨ City,     Zip                                           ╨
*       ╨                                                         ╨
*       ╨ Description:                                            ╨
*       ╨ This program was automatically generated by GENSCRN.    ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫


*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨          SCGC243/MS-DOS Setup Code - SECTION 1          ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*

#REGION 1
*---------------------------------------------------------------*
* OPERA ARQUIVOS :
*           clientes
* OBJETIVO:	CLIENTES ALTERADOS P/ CONFERENCIA
*	
*---------------------------------------------------------------*

******>>>> INICIO CONTROLE AMBIENTAL

ON KEY LABEL ESCAPE

PRIVATE isediting,isadding,isreading
PRIVATE wp_record
PRIVATE isreadonly,is2table,wzalias
PRIVATE LS243areant
LS243areant = ALLTRIM(ALIAS()) && PERMITE RETORNAR A AREA ANTER. A CHAMADA

m.wzalias	=	SELECT()
m.isediting	=	.F.
m.isadding	=	.F.
m.isreading=	.F.
m.is2table 	= 	.F.
wp_flgfecha = 	.F. 		&& defaut nao fechamento da secao
WP_RECORD 	= 	0
wp_ref_local =  .f.     && NAO POSSUI CONTROLE DE REFRESH LOCAL

LFrescfo	= .f.       && AUTORIZA OU NAO EMI. RESUMO POR CFO
LFresuf		= .f.       && AUTORIZA OU NAO EMI. RESUMO POR UF

LFtab243	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFcli243	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFemp243	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFusr243	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
m.dt_inicio = {}
m.dt_fim = DATE()
******>>>> INICIO CONTROLE ARQUIVOS
IF !USED("tab001")
	LFtab243	= .T.
	IF ! NetUse("tab001")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("usuario")
	LFusr243	= .T.
	IF ! NetUse("usuario")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("empresa")
	LFemp243	= .T.
	IF ! NetUse("empresa")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("clientes")
	LFcli243	= .T.
	IF ! NetUse("clientes")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF wp_flgfecha
	DO ULfecha
	RETURN
ENDIF


#REGION 0
REGIONAL m.currarea, m.talkstat, m.compstat

IF SET("TALK") = "ON"
	SET TALK OFF
	m.talkstat = "ON"
ELSE
	m.talkstat = "OFF"
ENDIF
m.compstat = SET("COMPATIBLE")
SET COMPATIBLE FOXPLUS

*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨                MS-DOS Window definitions                ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*

IF NOT WEXIST("scgc243") ;
	OR UPPER(WTITLE("SCGC243")) == "SCGC243.PJX" ;
	OR UPPER(WTITLE("SCGC243")) == "SCGC243.SCX" ;
	OR UPPER(WTITLE("SCGC243")) == "SCGC243.MNX" ;
	OR UPPER(WTITLE("SCGC243")) == "SCGC243.PRG" ;
	OR UPPER(WTITLE("SCGC243")) == "SCGC243.FRX" ;
	OR UPPER(WTITLE("SCGC243")) == "SCGC243.QPR"
	DEFINE WINDOW scgc243 ;
		FROM INT((SROW()-12)/2),INT((SCOL()-72)/2) ;
		TO INT((SROW()-12)/2)+11,INT((SCOL()-72)/2)+71 ;
		TITLE "[ Clientes Alterados ]" ;
		FOOTER "[ 243 ]" ;
		FLOAT ;
		NOCLOSE ;
		SHADOW ;
		NOMINIMIZE ;
		NONE ;
		COLOR SCHEME 1
ENDIF


*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨          SCGC243/MS-DOS Setup Code - SECTION 2          ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*

#REGION 1

******>>>> INICIO CONTROLE LOCAL

SELECT empresa
SET ORDER TO TAG empresa
SEEK wp_empresa

m.empresa   = empresa.empresa
m.nome_emp  = empresa.nome
m.inscricao = empresa.inscricao
SHOW GET m.empresa
SHOW GET m.nome_emp


*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨              SCGC243/MS-DOS Screen Layout               ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*

#REGION 1
IF WVISIBLE("scgc243")
	ACTIVATE WINDOW scgc243 SAME
ELSE
	ACTIVATE WINDOW scgc243 NOSHOW
ENDIF
@ 0,0 TO 11,71 ;
	COLOR SCHEME 23
@ 11,1 TO 11,70 ;
	COLOR SCHEME 24
@ 11,71 SAY "ы" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,71 TO 10,71 ;
	COLOR SCHEME 24
@ 0,71 SAY "©" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 5,4 TO 7,67 ;
	COLOR SCHEME 23
@ 7,5 TO 7,66 ;
	COLOR SCHEME 24
@ 7,67 SAY "ы" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 6,67 SAY "Ё" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 5,67 SAY "©" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 8,3 TO 10,19 ;
	COLOR SCHEME 24
@ 10,4 TO 10,18 ;
	COLOR SCHEME 23
@ 9,19 SAY "Ё" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 10,19 SAY "ы" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 8,19 SAY "©" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 8,28 TO 10,44 ;
	COLOR SCHEME 24
@ 10,29 TO 10,43 ;
	COLOR SCHEME 23
@ 9,44 SAY "Ё" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 10,44 SAY "ы" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 8,44 SAY "©" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 8,52 TO 10,68 ;
	COLOR SCHEME 24
@ 10,53 TO 10,67 ;
	COLOR SCHEME 23
@ 9,68 SAY "Ё" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 10,68 SAY "ы" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 8,68 SAY "©" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 1,11 TO 3,25 ;
	COLOR SCHEME 23
@ 3,12 TO 3,24 ;
	COLOR SCHEME 24
@ 3,25 SAY "ы" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 2,25 SAY "Ё" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,25 SAY "©" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 5,32 SAY "[Titulo]" ;
	SIZE 1,8, 0
@ 1,13 SAY "[Dt.Inicio]" ;
	SIZE 1,11, 0
@ 1,46 TO 3,60 ;
	COLOR SCHEME 23
@ 3,47 TO 3,59 ;
	COLOR SCHEME 24
@ 3,60 SAY "ы" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 2,60 SAY "Ё" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,60 SAY "©" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,48 SAY "[Dt.Final]" ;
	SIZE 1,10, 0
@ 2,13 GET m.dt_inicio ;
	SIZE 1,10 ;
	DEFAULT {  /  /  } ;
	WHEN _2lx0oo2mh() ;
	VALID _2lx0oo2mw()
@ 2,48 GET m.dt_fim ;
	SIZE 1,10 ;
	DEFAULT {  /  /  } ;
	WHEN isediting ;
	VALID _2lx0oo2n2() ;
	MESSAGE "Data Final deve ser maior ou igual a Inicial"
@ 6,6 GET m.titulo ;
	SIZE 1,60 ;
	DEFAULT " " ;
	WHEN _2lx0oo2oo()
@ 9,7 GET m.edit_btn ;
	PICTURE "@*HN \<Edita" ;
	SIZE 1,9,1 ;
	DEFAULT 1 ;
	VALID btn_val1('EDIT') ;
	MESSAGE 'Permite a alteracao de dados do registro corrente'
@ 9,31 GET m.imp1_btn ;
	PICTURE "@*HN \<Imprimir" ;
	SIZE 1,10,1 ;
	DEFAULT 1 ;
	VALID _2lx0oo2or() ;
	DISABLE
@ 9,56 GET m.canc_btn ;
	PICTURE "@*HN \<Saida" ;
	SIZE 1,9,1 ;
	DEFAULT 1 ;
	VALID _2lx0oo2ow()
@ 0,20 SAY "[ Relatorio Clientes Alterados ]" ;
	SIZE 1,32, 0
@ 0,65 SAY "[243]" ;
	SIZE 1,5, 0

IF NOT WVISIBLE("scgc243")
	ACTIVATE WINDOW scgc243
ENDIF

READ CYCLE ;
	ACTIVATE READACT() ;
	DEACTIVATE READDEAC()

RELEASE WINDOW scgc243

#REGION 0
IF m.talkstat = "ON"
	SET TALK ON
ENDIF
IF m.compstat = "ON"
	SET COMPATIBLE ON
ENDIF


*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨               SCGC243/MS-DOS Cleanup Code               ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*

#REGION 1
do ULfecha
RETURN



*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨   SCGC243/MS-DOS Supporting Procedures and Functions    ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*

#REGION 1
PROCEDURE ULfecha
	IF LFtab243  		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("tab001")
	ENDIF
	IF LFcli243  		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("clientes")
	ENDIF
	IF LFemp243  		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("empresa")
	ENDIF
	IF LFusr243  		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("usuario")
	ENDIF
	wp_flgfecha = .F. 		&& defaut nao fechamento da secao
	IF !EMPTY(LS243areant)
		SELECT &LS243areant
	ENDIF
	ON KEY LABEL ESCAPE
	SET FORMAT TO
RETURN


PROCEDURE BTN_VAL1
	PARAMETER tecla, m.chv_ler, m.chv_compara, m.chv_brow
	LN_prxobj = _CUROBJ
	SHOW GET m.empresa
	SHOW GET m.nome_emp
    DO CASE
		CASE tecla = "EDIT" AND !isediting   && INICIA EDICAO
			m.dt_inicio = {}
			m.dt_fim = DATE()
			SHOW GET edit_btn,1 PROMPT "\<Ok"
			SHOW GET m.imp1_btn DISABLE
			isediting = .t.
			_CUROBJ = 1	
		    ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
			ON KEY LABEL END DO BTN_VAL1 WITH 'DELETE'
		CASE tecla = "EDIT" AND isediting     && CONFIRMA EDICAO
			SHOW GET edit_btn,1 PROMPT "\<Edita"
			isediting = .f.
			_CUROBJ = 1	
			SHOW GET m.imp1_btn ENABLE
		    ON KEY LABEL ESCAPE
			ON KEY LABEL END
		CASE tecla = "DELETE" AND isediting     && CANCELA EDICAO
			SHOW GET edit_btn,1 PROMPT "\<Edita"
			isediting = .f.
			_CUROBJ = 1	
			SHOW GET m.imp1_btn DISABLE
		    ON KEY LABEL ESCAPE
			ON KEY LABEL END
	ENDCASE
RETURN

*******************
FUNCTION ULlenatu		&& chamada por rel243
PARAMETERS LNnatu

SELECT tab001
SET ORDER TO TAG codigo

SEEK 'NTZ'+CHRTRAN(STR(LNnatu,1)," ","0")
SELECT duplicat

RETURN(TAB001.descricao)


*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨ _2LX0OO2MH           m.dt_inicio WHEN                   ╨
*       ╨                                                         ╨
*       ╨ Function Origin:                                        ╨
*       ╨                                                         ╨
*       ╨ From Platform:       MS-DOS                             ╨
*       ╨ From Screen:         SCGC243,     Record Number:   40   ╨
*       ╨ Variable:            m.dt_inicio                        ╨
*       ╨ Called By:           WHEN Clause                        ╨
*       ╨ Object Type:         Field                              ╨
*       ╨ Snippet Number:      1                                  ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*
FUNCTION _2lx0oo2mh     &&  m.dt_inicio WHEN
#REGION 1
ON KEY LABEL ENTER
ON KEY LABEL ESCAPE	KEYBOARD "{END}"
IF LASTKEY() = 15 AND !(isediting)
	KEYBOARD "{ESCAPE}"
ENDIF
RETURN(isediting)


*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨ _2LX0OO2MW           m.dt_inicio VALID                  ╨
*       ╨                                                         ╨
*       ╨ Function Origin:                                        ╨
*       ╨                                                         ╨
*       ╨ From Platform:       MS-DOS                             ╨
*       ╨ From Screen:         SCGC243,     Record Number:   40   ╨
*       ╨ Variable:            m.dt_inicio                        ╨
*       ╨ Called By:           VALID Clause                       ╨
*       ╨ Object Type:         Field                              ╨
*       ╨ Snippet Number:      2                                  ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*
FUNCTION _2lx0oo2mw     &&  m.dt_inicio VALID
#REGION 1
SHOW GET m.dt_fim
ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
RETURN (.T.)


*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨ _2LX0OO2N2           m.dt_fim VALID                     ╨
*       ╨                                                         ╨
*       ╨ Function Origin:                                        ╨
*       ╨                                                         ╨
*       ╨ From Platform:       MS-DOS                             ╨
*       ╨ From Screen:         SCGC243,     Record Number:   41   ╨
*       ╨ Variable:            m.dt_fim                           ╨
*       ╨ Called By:           VALID Clause                       ╨
*       ╨ Object Type:         Field                              ╨
*       ╨ Snippet Number:      3                                  ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*
FUNCTION _2lx0oo2n2     &&  m.dt_fim VALID
#REGION 1
RETURN(m.dt_fim >= m.dt_inicio)


*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨ _2LX0OO2OO           m.titulo WHEN                      ╨
*       ╨                                                         ╨
*       ╨ Function Origin:                                        ╨
*       ╨                                                         ╨
*       ╨ From Platform:       MS-DOS                             ╨
*       ╨ From Screen:         SCGC243,     Record Number:   42   ╨
*       ╨ Variable:            m.titulo                           ╨
*       ╨ Called By:           WHEN Clause                        ╨
*       ╨ Object Type:         Field                              ╨
*       ╨ Snippet Number:      4                                  ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*
FUNCTION _2lx0oo2oo     &&  m.titulo WHEN
#REGION 1
IF !isediting
	RETURN .F.
ENDIF
m.titulo = "Clientes Alterados no Periodo de "+DTOC(m.dt_inicio);
			+" a "+DTOC(m.dt_fim)
RETURN .T.

*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨ _2LX0OO2OR           m.imp1_btn VALID                   ╨
*       ╨                                                         ╨
*       ╨ Function Origin:                                        ╨
*       ╨                                                         ╨
*       ╨ From Platform:       MS-DOS                             ╨
*       ╨ From Screen:         SCGC243,     Record Number:   44   ╨
*       ╨ Variable:            m.imp1_btn                         ╨
*       ╨ Called By:           VALID Clause                       ╨
*       ╨ Object Type:         Push Button                        ╨
*       ╨ Snippet Number:      5                                  ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*
FUNCTION _2lx0oo2or     &&  m.imp1_btn VALID
#REGION 1
	SELE clientes
	SET ORDER TO TAG dt_alter

	SET NEAR ON
	SEEK m.dt_inicio
	SET NEAR OFF
	IF clientes.dt_alter > m.dt_fim
 		WAIT WINDOW "Nao Foram encotrados dados para impessao."
		UNLOCK
 		RETURN
 	ENDIF		
************************>
	SELE TAB001
	SET ORDER TO TAG CODIGO
	SELE usuario
	SET ORDER TO TAG usuario
************************>
	wl_arqtmp = ""
	LNtmp     = 65		&& TABELA ASCII A = 65
	IF !UPabretmp("dtc")
		wp_flgfecha = .t.
	ENDIF
	IF wp_flgfecha
		RETURN
	ENDIF
	SET SAFET OFF
	LStmp = "&wp_dirtmp"+"&wl_arqtmp"

	SELECT clientes
	WAIT WINDOW "AGUARDE. Gerando Arq. Temporario." NOWAIT

	COPY TO &LStmp WHILE  clientes.dt_alter  <= m.dt_fim
    SELE 0
    USE "&wp_dirtmp"+"&wl_arqtmp" exclu
    INDEX ON nome  TAG nome  	 ADDITIVE
	SET ORDER TO TAG nome
	GO TOP
	SET RELATION TO 'NTZ'+CHRTRAN(STR(natureza,1)," ","0") INTO TAB001
	SET RELATION TO usr_altcr INTO usuario ADDITIVE

*******************
*---->   (INICIALIZACAO DO CONTROLE DE STATUS IMPRESSAO)
*******************	
	DO RELINIC.PRG          && INICIA VAR P/ TERMOMETRO
	LFsegue = .t.
	LNregistro = RECNO()
	LNimpressao = 0
    LNimpressao = RECCOUNT()
	LNimpressos = 0
*******************
*---->   (COMPLETADO PREPARACAO DO CONTROLE DE STATUS IMPRESSAO)
*******************	
	SELECT &wl_arqtmp

	LF_fim  = .f.
    LSrel = "REL243"      && relatorio padrao
    LSorienta = " FOR LFsegue "
	GO TOP
	DO UPimpressao    && COORDENA TRABALHO DE IMPRESSAO
************
	LNpagina = _PAGENO   && DAR SEQUENCIA AO N. PAGINA
	DO RELFIM.PRG          && FIM VAR P/ TERMOMETRO
**************************>>> RESUMO POR CFO
*-----------------------------
	SET RELATION TO
	SHOW GET m.imp1_btn DISABLE
	SHOW WINDOW SCGC243 TOP
	SELECT &wl_arqtmp
    USE
    SELE clientes


*       жддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╥
*       ╨                                                         ╨
*       ╨ _2LX0OO2OW           m.canc_btn VALID                   ╨
*       ╨                                                         ╨
*       ╨ Function Origin:                                        ╨
*       ╨                                                         ╨
*       ╨ From Platform:       MS-DOS                             ╨
*       ╨ From Screen:         SCGC243,     Record Number:   45   ╨
*       ╨ Variable:            m.canc_btn                         ╨
*       ╨ Called By:           VALID Clause                       ╨
*       ╨ Object Type:         Push Button                        ╨
*       ╨ Snippet Number:      6                                  ╨
*       ╨                                                         ╨
*       сддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╫
*
FUNCTION _2lx0oo2ow     &&  m.canc_btn VALID
#REGION 1
CLEAR GETS
CLEAR READ
isediting = .f.
RETURN .T.