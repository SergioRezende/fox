*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        07/28/97            OBJ_NAVE.SPR               10:00:03 
*                                                                
*       픔컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        Author's Name                                           
*                                                                
*        Copyright (c) 1997 Company Name                         
*        Address                                                 
*        City,     Zip                                           
*                                                                
*        Description:                                            
*        This program was automatically generated by GENSCRN.    
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                 SCGC201/MS-DOS Setup Code - SECTION 1          
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 1
*~ WIZARDSCREEN
#DEFINE C_DBFEMPTY		'Database is empty, add a record?'
#DEFINE C_DELREC		'Apagar Registro Selecionado ?'
#DEFINE C_ENDFILE		'Final do Arquivo.'
#DEFINE C_CANCORCA   	'Confirma o Cancelamento do Orcamento ? '
#DEFINE C_APROORCA   	'Confirma o Aprovacao do Orcamento ?'
*---------------------------------------------------------------------*
* ARQUIVOS UTILIZADOS :                                               *
*              - ORCAMENT
*              - ORCATMP
*              - EMPRESA
*              - TIPOOPER
*              - CLIENTES
*              - TAB_CITA
*              - PARAMETR
*              - NOTA
*              - NF_ANEXO
*              - TPPGTO
*              - TAB_CST
*              - SALDO
*              - ITEMMOV
*              - GRUPO  =>OBJ_ITOR
*              - PRECO  =>OBJ_ITOR
*              - PROD_CMS  =>OBJ_ITOR
*              - TAB001
*              - TAB002
*              - TRANSPRT
*              - BANCO
*              - DUPLICAT
* OBJETIVOS : VENDAS
*---------------------------------------------------------------------*
******>>>> INICIO CONTROLE AMBIENTAL
m.wzalias		=	SELECT()
m.isediting		=	.F.
m.isadding		=	.F.
m.isreading 	=   .F.
m.is2table 		= 	.F.
WP_RECORD 		= 	0
wp_ref_local 	=  .T.     &&  POSSUI CONTROLE DE REFRESH LOCAL
LSjanela		= ""		&&  NOME DA JANELA AUX ATIVA
LSj_var 		= ""		&&  NOME DO BOTAO INVISIVEL DA JANELA ATIVA
LN_prxobj 		= 0	 		&&  ORIENTA A SAIDA DE EDICAO DE TELAS COMPLEM.
WL_vendedor     = 0			&& contem o codigo do vendedor atual
LFpendente		= .F.		&& Acessa somente orc. nao Fat e nao Canc

******************************************************
DIMENSION VTLmotivo[9] && MOTIVOS DAS OPERACOES. ATRIB. CONF OPERACAO
STORE 0 TO VTLmotivo
*******************************************************
********>>>>>> INTERESE LOCAL
PRIVATE   wl_cota, iscancela
DIMENSION VTLservfx[9] && Serv. comissionados fixos
STORE 0 TO VTLservfx
wl_cota     	= .f.
iscancela   	= .f.
isediprz    	= .t.     && Permite ou nao a edicao dos prasos
******>>>> INICIO CONTROLE ARQUIVOS
*>> parametros repassados a btn_val
VLleitura = "STR(wp_empresa,3)"
                         * repassa chave de leitura p/ btn_val
VLlerfim  = "STR(wp_empresa+1,3)"
           * repassa chave de leitura p/ btn_val (POSICAO FINAL + 1 REG)

VLcompara = "orcament.empresa = wp_empresa"
                         * repassa chave de comparacao p/ btn_val
VLchvlimi = "STR(wp_empresa,3)"   && otimiza browse
**

#REGION 0
REGIONAL m.currarea, m.talkstat, m.compstat

IF SET("TALK") = "ON"
	SET TALK OFF
	m.talkstat = "ON"
ELSE
	m.talkstat = "OFF"
ENDIF
m.compstat = SET("COMPATIBLE")
SET COMPATIBLE FOXPLUS

*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                       MS-DOS Window definitions                
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

IF NOT WEXIST("scgc201") ;
	OR UPPER(WTITLE("SCGC201")) == "SCGC201.PJX" ;
	OR UPPER(WTITLE("SCGC201")) == "SCGC201.SCX" ;
	OR UPPER(WTITLE("SCGC201")) == "SCGC201.MNX" ;
	OR UPPER(WTITLE("SCGC201")) == "SCGC201.PRG" ;
	OR UPPER(WTITLE("SCGC201")) == "SCGC201.FRX" ;
	OR UPPER(WTITLE("SCGC201")) == "SCGC201.QPR"
	DEFINE WINDOW scgc201 ;
		FROM 0, 0 ;
		TO 20,79 ;
		FLOAT ;
		NOCLOSE ;
		MINIMIZE ;
		COLOR SCHEME 1
ENDIF

IF NOT WEXIST("navega") ;
	OR UPPER(WTITLE("NAVEGA")) == "NAVEGA.PJX" ;
	OR UPPER(WTITLE("NAVEGA")) == "NAVEGA.SCX" ;
	OR UPPER(WTITLE("NAVEGA")) == "NAVEGA.MNX" ;
	OR UPPER(WTITLE("NAVEGA")) == "NAVEGA.PRG" ;
	OR UPPER(WTITLE("NAVEGA")) == "NAVEGA.FRX" ;
	OR UPPER(WTITLE("NAVEGA")) == "NAVEGA.QPR"
	DEFINE WINDOW navega ;
		FROM 21, 3 ;
		TO 23,75 ;
		FLOAT ;
		NOCLOSE ;
		SHADOW ;
		NOMINIMIZE ;
		COLOR SCHEME 1
ENDIF


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                 SCGC201/MS-DOS Setup Code - SECTION 2          
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 1
******>>>> INICIO CONTROLE LOCAL

DO CASE
	CASE !wp_flgfecha
		DO OBJ_VDOR.SPR
		SELE empresa
		SET ORDER TO TAG empresa
		SEEK wp_empresa
		SELE orcament
		SET ORDER TO TAG orcamento
		SCATTER MEMVAR MEMO BLANK
****************************		DO OBJ_VEND.SPR
		SELE ORCAMENT
		*-------------------------> criado pelo wizard
		m.wzalias=SELECT()
		m.isreadonly=IIF(ISREAD(),.T.,.F.)
		IF m.isreadonly
			WAIT WINDOW C_READONLY TIMEOUT 1
		ENDIF
		KEYBOARD "F"
		KEYBOARD "Z"
		ON KEY LABEL CTRL-I DO ULitens

ENDCASE


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                     SCGC201/MS-DOS Screen Layout               
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 1
IF WVISIBLE("scgc201")
	ACTIVATE WINDOW scgc201 SAME
ELSE
	ACTIVATE WINDOW scgc201 NOSHOW
ENDIF
@ 15,59 SAY "TOTAL" ;
	SIZE 1,5, 0
@ 0,9 SAY "EMP" ;
	SIZE 1,3, 0
@ 15,0 SAY "STATUS" ;
	SIZE 1,6, 0
@ 4,0 SAY "Cliente.:" ;
	SIZE 1,9, 0
@ 0,0 SAY "Numero:" ;
	SIZE 1,7, 0
@ 0,64 SAY "Tipo.:" ;
	SIZE 1,6, 0
@ 10,10 SAY "-" ;
	SIZE 1,1, 0
@ 9,0 SAY "C.E.P." ;
	SIZE 1,6, 0
@ 8,30 SAY "UF.:" ;
	SIZE 1,4, 0
@ 10,0 SAY "Tp.Inscr:" ;
	SIZE 1,9, 0
@ 6,0 SAY "End.....:" ;
	SIZE 1,9, 0
@ 7,0 SAY "Bairro..:" ;
	SIZE 1,9, 0
@ 8,0 SAY "Cidade..:" ;
	SIZE 1,9, 0
@ 9,6 SAY "..:" ;
	SIZE 1,3, 0
@ 11,0 SAY "Inscri..:" ;
	SIZE 1,9, 0
@ 10,30 SAY "Revenda?" ;
	SIZE 1,8, 0
@ 12,0 SAY "Fone....:" ;
	SIZE 1,9, 0
@ 4,40 TO 13,40
@ 13,21 SAY "Placa:" ;
	SIZE 1,6, 0
@ 4,52 SAY "-" ;
	SIZE 1,1, 0
@ 5,41 SAY "Condicao:" ;
	SIZE 1,9, 0
@ 5,52 SAY "-" ;
	SIZE 1,1, 0
@ 9,76 SAY "%" ;
	SIZE 1,1, 0
@ 8,41 SAY "Praso...:" ;
	SIZE 1,9, 0
@ 9,41 SAY "P.Medio.:" ;
	SIZE 1,9, 0
@ 9,54 SAY "dias" ;
	SIZE 1,4, 0
@ 9,64 SAY "Juros.:" ;
	SIZE 1,7, 0
@ 10,41 SAY "Banco...:" ;
	SIZE 1,9, 0
@ 10,55 SAY "Agenc:" ;
	SIZE 1,6, 0
@ 11,41 SAY "Frete...:" ;
	SIZE 1,9, 0
@ 12,41 SAY "Seguro..:" ;
	SIZE 1,9, 0
@ 13,0 SAY "Veiculo.:" ;
	SIZE 1,9, 0
@ 13,54 SAY "-" ;
	SIZE 1,1, 0
@ 13,41 SAY "Vendedor:" ;
	SIZE 1,9, 0
@ 16,0 TO 16,77
@ 14,0 TO 14,77
@ 3,0 TO 3,77
@ 0,22 GET m.natu_oper ;
	PICTURE "@^ \<Venda;\<Transferencia;\<S. Remessa;\<Devolucao a Forn." ;
	SIZE 3,14 ;
	DEFAULT "Venda" ;
	WHEN _rmo0lfpq2() ;
	VALID _rmo0lfprr() ;
	COLOR SCHEME 1, 2
@ 0,36 GET m.motivo ;
	PICTURE "@^" ;
	FROM VTLmotivo ;
	SIZE 3,25 ;
	DEFAULT 1 ;
	WHEN _rmo0lfptb() ;
	COLOR SCHEME 1, 2
@ 0,71 GET m.tipo ;
	SIZE 1,3 ;
	DEFAULT " " ;
	PICTURE "@!" ;
	WHEN _rmo0lfpun() ;
	VALID _rmo0lfpvy()
@ 1,1 GET m.orcamento ;
	SIZE 1,7 ;
	DEFAULT " " ;
	PICTURE "@K 999,999" ;
	WHEN isreading or isadding ;
	VALID _rmo0lfpzg()
@ 1,10 GET m.empresa ;
	SIZE 1,3 ;
	DEFAULT 0 ;
	PICTURE "999" ;
	WHEN .f.
@ 1,14 GET m.data ;
	SIZE 1,8 ;
	DEFAULT " " ;
	PICTURE "@K" ;
	WHEN _rmo0lfq2n()
@ 2,14 GET m.hora ;
	SIZE 1,5 ;
	DEFAULT " " ;
	PICTURE "@K XXXXX" ;
	WHEN .f.
@ 1,65 GET m.natureza ;
	SIZE 2,12 ;
	DEFAULT " " ;
	WHEN .f.
@ 4,41 SAY "Pago em.:" ;
	SIZE 1,9, 0
@ 6,41 SAY "Entrada.:" ;
	SIZE 1,9, 0
@ 6,62 SAY "R$" ;
	SIZE 1,2, 0
@ 4,9 GET m.cliente ;
	SIZE 1,20 ;
	DEFAULT 0 ;
	PICTURE "99999999999999" ;
	WHEN isediting AND LSjanela = "SCGC201" AND  !(RIGHT(orcament.situacao,1) $ "EO") ;
	VALID _rmo0lfq5b() ;
	ERROR wp_msg
@ 4,9 GET m.cgccliente ;
	SIZE 1,20 ;
	DEFAULT " " ;
	PICTURE "@R 99.999.999/9999-99" ;
	WHEN .f.
@ 5,9 GET m.nome ;
	SIZE 1,31 ;
	DEFAULT " " ;
	PICTURE "@K XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX" ;
	WHEN _rmo0lfqb9()
@ 6,9 GET m.endereco ;
	SIZE 1,31 ;
	DEFAULT " " ;
	WHEN isediting AND LSjanela = "SCGC201" ;
	VALID .T.
@ 7,9 GET m.bairro ;
	SIZE 1,20 ;
	DEFAULT " " ;
	PICTURE "@!" ;
	WHEN isediting AND LSjanela = "SCGC201" ;
	VALID .T.
@ 8,9 GET m.cidade ;
	SIZE 1,20 ;
	DEFAULT " " ;
	PICTURE "@!" ;
	WHEN isediting AND LSjanela = "SCGC201" ;
	VALID .T.
@ 8,34 GET m.estado ;
	SIZE 1,2 ;
	DEFAULT " " ;
	PICTURE "@! XX" ;
	WHEN isediting AND LSjanela = "SCGC201" ;
	VALID m.estado $ wp_estado ;
	ERROR 'Sigla Nao identificada'
@ 9,9 GET m.cep ;
	SIZE 1,10 ;
	DEFAULT " " ;
	PICTURE "999999-99" ;
	WHEN isediting AND LSjanela = "SCGC201" ;
	VALID .T.	
@ 10,9 GET m.tp_inscr ;
	SIZE 1,1 ;
	DEFAULT 0 ;
	PICTURE "9" ;
	WHEN isediting AND LSjanela = "SCGC201" ;
	VALID _rmo0lfqe5()
@ 10,11 GET m.nome_inscr ;
	SIZE 1,18 ;
	DEFAULT " " ;
	WHEN .f.
@ 10,39 GET m.revendedor ;
	SIZE 1,1 ;
	DEFAULT " " ;
	PICTURE "!" ;
	WHEN isediting AND LSjanela = "SCGC201" ;
	VALID m.revendedor $ "SN" ;
	ERROR "S => Sim  //  N => Nao "
@ 11,9 GET m.inscricao ;
	SIZE 1,18 ;
	DEFAULT " " ;
	WHEN isediting AND LSjanela = "SCGC201" ;
	VALID _rmo0lfqil()
@ 12,9 GET m.fone ;
	SIZE 1,15 ;
	DEFAULT " " ;
	PICTURE "(999)-999-9999" ;
	WHEN isediting AND LSjanela = "SCGC201" ;
	VALID _rmo0lfqjv()
@ 13,9 GET m.veiculo ;
	SIZE 1,11 ;
	DEFAULT " " ;
	WHEN isediting AND LSjanela = "SCGC201" ;
	VALID _rmo0lfqn6()
@ 13,28 GET m.placa ;
	SIZE 1,7 ;
	DEFAULT " " ;
	WHEN isediting AND LSjanela = "SCGC201"
@ 4,50 GET m.forma_pgto ;
	SIZE 1,2 ;
	DEFAULT 0 ;
	PICTURE "99" ;
	WHEN isediting AND LSjanela = "SCGC201" AND m.natu_oper = 1 ;
	VALID _rmo0lfqp5()
@ 4,53 GET m.nome_forma ;
	SIZE 1,12 ;
	DEFAULT " " ;
	WHEN .f.
@ 5,50 GET m.tp_pgto ;
	SIZE 1,2 ;
	DEFAULT " " ;
	WHEN isediting AND LSjanela = "SCGC201" AND m.natu_oper = 1 ;
	VALID _rmo0lfqs8()
@ 5,53 GET tppgto.descricao ;
	SIZE 1,12 ;
	DEFAULT " " ;
	WHEN .F.
@ 6,50 GET m.vlr_ent ;
	SIZE 1,11 ;
	DEFAULT " " ;
	PICTURE "@K 9,999,999.99" ;
	WHEN isediting AND LSjanela = "SCGC201" AND m.natu_oper = 1
@ 8,50 GET m.prazo ;
	SIZE 1,23 ;
	DEFAULT " " ;
	PICTURE "999/999/999/999/999/999/" ;
	WHEN EMPTY(ALLTRIM(LEFT(tppgto.prazo,3))) AND isediting AND LSjanela = "SCGC201"
@ 9,50 GET m.prazomedio ;
	SIZE 1,3 ;
	DEFAULT 0 ;
	PICTURE "@Z 999" ;
	WHEN .f.
@ 9,71 GET m.juromes ;
	SIZE 1,5 ;
	DEFAULT 0 ;
	PICTURE "@Z 99.99" ;
	WHEN _rmo0lfqw5()
@ 10,50 GET m.banco ;
	SIZE 1,4 ;
	DEFAULT 0 ;
	PICTURE "999" ;
	WHEN isediting AND LSjanela = "SCGC201"  AND m.natu_oper = 1 ;
	VALID _rmo0lfqxe() ;
	ERROR "Banco nao Cadastrado no sistema"
@ 10,61 GET m.agencia ;
	SIZE 1,6 ;
	DEFAULT 0 ;
	PICTURE "99999" ;
	WHEN isediting AND LSjanela = "SCGC201"  AND m.natu_oper = 1 ;
	ERROR "Banco nao Cadastrado no sistema"
@ 11,50 GET m.vlrfrete ;
	SIZE 1,10 ;
	DEFAULT " " ;
	PICTURE "@K 999,999.99" ;
	WHEN _rmo0lfr09()
@ 11,61 GET m.pgto_frete ;
	PICTURE "@*RHN Emp ;Cli" ;
	SIZE 1,8,0 ;
	DEFAULT 1 ;
	WHEN _rmo0lfr1j() ;
	VALID _rmo0lfr2p()
@ 12,50 GET m.vlrseguro ;
	SIZE 1,10 ;
	DEFAULT " " ;
	PICTURE "@K 999,999.99" ;
	WHEN _rmo0lfr44() ;
	VALID _rmo0lfr56()
@ 13,50 GET m.operador ;
	SIZE 1,4 ;
	DEFAULT 0 ;
	PICTURE "9999" ;
	WHEN isediting AND LSjanela = "SCGC201"  AND m.natu_oper = 1 ;
	VALID _rmo0lfr6t() ;
	ERROR "Usuario nao Cadastrado no sistema"
@ 13,55 GET m.nome_vend ;
	SIZE 1,15 ;
	DEFAULT " " ;
	WHEN .F.
@ 15,7 GET m.situacao ;
	SIZE 1,2 ;
	DEFAULT " " ;
	WHEN .F.
@ 15,10 GET m.nome_sit ;
	SIZE 1,30 ;
	DEFAULT " " ;
	WHEN .f.
@ 15,65 GET m.valor ;
	SIZE 1,12 ;
	DEFAULT " " ;
	PICTURE "@K 9,999,999.99" ;
	WHEN .F. ;
	VALID _rmo0lfra2()
@ 17,0 GET m.VP_btn ;
	PICTURE "@*HN \<1-Venda" ;
	SIZE 1,9,1 ;
	DEFAULT 1 ;
	VALID _rmo0lfrbo() ;
	MESSAGE 'Processa Reserva de Mercadoria'
@ 17,12 GET m.ap_btn ;
	PICTURE "@*HN \<2-Aprova" ;
	SIZE 1,10,1 ;
	DEFAULT 1 ;
	VALID _rmo0lfrkj() ;
	MESSAGE 'Primeiro registro'
@ 17,25 GET m.rm_btn ;
	PICTURE "@*HN \<3-Resrv" ;
	SIZE 1,9,1 ;
	DEFAULT 1 ;
	VALID _rmo0lfrq6() ;
	MESSAGE 'Processa Reserva de Mercadoria'
@ 17,35 GET m.lib_btn ;
	PICTURE "@*HN \<4-Lib.CR" ;
	SIZE 1,10,1 ;
	DEFAULT 1 ;
	VALID _rmo0lfry7() ;
	MESSAGE 'Primeiro registro'
@ 17,47 GET m.osi_btn ;
	PICTURE "@*HN \<5-OSI" ;
	SIZE 1,7,1 ;
	DEFAULT 1 ;
	VALID _rmo0lfs2d() ;
	MESSAGE 'Primeiro registro'
@ 17,58 GET m.fat_btn ;
	PICTURE "@*HN \<6-Fat" ;
	SIZE 1,7,1 ;
	DEFAULT 1 ;
	VALID _rmo0lfsew() ;
	MESSAGE 'Primeiro registro'
@ 17,66 GET m.cr_btn ;
	PICTURE "@*HN \<7-Canc.Res" ;
	SIZE 1,12,1 ;
	DEFAULT 1 ;
	VALID _rmo0lftgr() ;
	MESSAGE 'Primeiro registro'
@ 18,0 GET m.co_btn ;
	PICTURE "@*HN \<8-Can.Orc" ;
	SIZE 1,11,1 ;
	DEFAULT 1 ;
	VALID _rmo0lftnf() ;
	MESSAGE 'Primeiro registro'
@ 18,12 GET m.atva_btn ;
	PICTURE "@*HN \<9-Lib.Res" ;
	SIZE 1,11,1 ;
	DEFAULT 1 ;
	VALID _rmo0lftrf() ;
	MESSAGE 'Ativa Parametros Sistemicos'
@ 18,25 GET m.tab_btn ;
	PICTURE "@*HN \<Tabela" ;
	SIZE 1,8,1 ;
	DEFAULT 1 ;
	VALID _rmo0lftya() ;
	MESSAGE 'Processa Reserva de Mercadoria'
@ 18,35 GET m.item_btn ;
	PICTURE "@*HN ite\<Ns" ;
	SIZE 1,7,1 ;
	DEFAULT 1 ;
	VALID _rmo0lfu37()
@ 18,47 GET m.oper_btn ;
	PICTURE "@*HN \<Operador" ;
	SIZE 1,10,1 ;
	DEFAULT 1 ;
	VALID _rmo0lfu4g() ;
	MESSAGE 'Primeiro registro'
@ 18,58 GET m.cad_btn ;
	PICTURE "@*HN \<k-cad" ;
	SIZE 1,7,1 ;
	DEFAULT 1 ;
	VALID _rmo0lfu5s() ;
	MESSAGE 'Processa Reserva de Mercadoria'
@ 18,66 GET m.nro_btn ;
	PICTURE "@*HN \<Q-Nro.Nota" ;
	SIZE 1,12,1 ;
	DEFAULT 1 ;
	VALID _rmo0lfua9() ;
	MESSAGE 'Primeiro registro'




*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                     OBJ_NAVE/MS-DOS Screen Layout              
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 2
IF WVISIBLE("navega")
	ACTIVATE WINDOW navega SAME
ELSE
	ACTIVATE WINDOW navega NOSHOW
ENDIF
@ 0,7 GET m.top_btn ;
	PICTURE "@*HN \<Inic" ;
	SIZE 1,6,1 ;
	DEFAULT 1 ;
	VALID BTN_VAL1('TOP', VLleitura, Vlcompara) ;
	MESSAGE 'Primeiro registro'
@ 0,13 GET m.prev_btn ;
	PICTURE "@*HN \<Ant" ;
	SIZE 1,5,1 ;
	DEFAULT 1 ;
	VALID btn_val1('PREV', VLleitura, Vlcompara) ;
	MESSAGE 'Posiciona no registro anterior.' 	
@ 0,18 GET m.next_btn ;
	PICTURE "@*HN \<Prox" ;
	SIZE 1,6,1 ;
	DEFAULT 1 ;
	VALID btn_val1('NEXT', VLleitura, Vlcompara) ;
	MESSAGE 'Avanca para proximo registro'
@ 0,24 GET m.end_btn ;
	PICTURE "@*HN \<Fim" ;
	SIZE 1,5,1 ;
	DEFAULT 1 ;
	VALID btn_val1('END', VLlerfim, Vlcompara) ;
	MESSAGE 'Ultimo registro do arquivo' 																																													
@ 0,29 GET m.loc_btn ;
	PICTURE "@*HN \<Zoom" ;
	SIZE 1,6,1 ;
	DEFAULT 1 ;
	VALID btn_val1('LOCATE', VLleitura, Vlcompara,VLchvlimi)		 ;
	MESSAGE 'Permite consulta visual ampliada a varios registros na tela'
@ 0,35 GET m.add_btn ;
	PICTURE "@*HN \<Lanca" ;
	SIZE 1,7,1 ;
	DEFAULT 1 ;
	VALID btn_val1('ADD') ;
	MESSAGE 'Abre novo registro para lancamento de dados' 
@ 0,49 GET m.edit_btn ;
	PICTURE "@*HN \<Edita" ;
	SIZE 1,7,1 ;
	DEFAULT 1 ;
	VALID btn_val1('EDIT') ;
	MESSAGE 'Permite a alteracao de dados do registro corrente'
@ 0,56 GET m.del_btn ;
	PICTURE "@*HN \<Delet" ;
	SIZE 1,7,1 ;
	DEFAULT 1 ;
	VALID btn_val1('DELETE', VLleitura, Vlcompara) ;
	MESSAGE 'Delete current record.'
@ 0,63 GET m.exit_btn ;
	PICTURE "@*HN \<Sai" ;
	SIZE 1,5,1 ;
	DEFAULT 1 ;
	VALID btn_val1('EXIT') ;
	MESSAGE 'Close screen.'
@ 0,42 GET m.cop_btn ;
	PICTURE "@*HN \<Copia" ;
	SIZE 1,7,1 ;
	DEFAULT 1 ;
	VALID btn_val1('COPY') ;
	MESSAGE 'Abre novo registro sel limpar os dados do reg corrente' 
@ 0,0 GET m.busca_btn ;
	PICTURE "@*HN \<Busca" ;
	SIZE 1,7,1 ;
	DEFAULT 1 ;
	VALID BTN_VAL1('BUSCA') ;
	MESSAGE 'Busca dirata pela chave do documento.'
@ 0,68 GET m.imp_btn ;
	PICTURE "@*HN \<M" ;
	SIZE 1,3,1 ;
	DEFAULT 1 ;
	VALID btn_val1('PRINT') ;
	MESSAGE 'Close screen.'

IF NOT WVISIBLE("navega")
	ACTIVATE WINDOW navega
ENDIF
IF NOT WVISIBLE("scgc201")
	ACTIVATE WINDOW scgc201
ENDIF



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*            MS-DOSREAD contains clauses from SCREEN scgc201     
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

READ CYCLE MODAL ;
	VALID READVALID() ;
	WHEN READWHEN() ;
	ACTIVATE _rmo0lfuc4() ;
	DEACTIVATE READDEAC() ;
	NOLOCK

RELEASE WINDOW navega
RELEASE WINDOW scgc201

#REGION 0
IF m.talkstat = "ON"
	SET TALK ON
ENDIF
IF m.compstat = "ON"
	SET COMPATIBLE ON
ENDIF


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                      SCGC201/MS-DOS Cleanup Code               
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 1
ON KEY LABEL ESCAPE
ON KEY LABEL CTRL-I
RELEASE WINDOW lista

RETURN

******>>>>>... PROCESSO DE TRANSACAO  (DESARMAR ARQUIVOS P/ PROCESSO )

*-------------->



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*          SCGC201/MS-DOS Supporting Procedures and Functions    
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 1
PROCEDURE ULitens
*-*-*-----*-*--*-*-*-*-*-*-*-*>> TALVEZ ABRA TRANZACAO
	IF isediting
		WAIT WINDOW "Termine a Edicao para ativar os itens."
 		RETURN
	ENDIF
	SELE tipooper
	SET ORDER TO TAG tipo
	SEEK 's'+m.tipo
	IF !FOUND()
		SEEK 'S'+m.tipo
	ENDIF
	HIDE WINDOW SCGC201, NAVEGA
	DO OBJ_ITOR.spr
	SHOW WINDOW SCGC201, NAVEGA
	SELE orcament
	IF orcament.valor <> m.valor
		=REGLOCK()
		REPLACE valor with m.valor
	ENDIF
	UNLOCK ALL
	ON KEY LABEL ESCAPE
    SCATTER MEMVAR MEMO
	SHOW GET m.valor
	DO refresh
*-*-*-----*-*--*-*-*-*-*-*-*-*>> TALVEZ FECHE TRANZACAO
RETURN

PROCEDURE ULbsc_nota

	SELECT empresa
	DO WHILE !RLOCK()
	ENDDO
	m.nota  = nota
	m.nota  = m.nota + 1
	REPLACE nota WITH m.nota
	SELECT orcament

RETURN

PROCEDURE ULcomissao
	DO obj_itcm.spr
	ON KEY LABEL ESCAPE
RETURN

PROCEDURE ULprzmedio
	LNocorrenc = 1
    LNposic    = 0
    LNinicio   = 1
    LNprzacm   = 0
    LNnumpgt   = 0
    m.prazomedio = 0
	DO WHILE .t.
        LNposic = AT("/",m.prazo, LNocorrenc)
		IF LNposic = 0
			EXIT
		ENDIF
		IF SUBS(m.prazo,LNinicio,3) = "   "
           EXIT
        ENDIF
        LNdias     = INT(VAL(SUBS(m.prazo,LNinicio,3)))
		IF LNdias = 0 AND LNnumpgt > 0
	        LNnumpgt   = LNnumpgt
		ELSE
	        LNnumpgt   = LNnumpgt + 1
		ENDIF
        LNprzacm   = LNprzacm  + INT(VAL(SUBS(m.prazo,LNinicio,3)))
		LNocorrenc = LNocorrenc + 1
        LNinicio   = LNposic + 1
	ENDDO
	IF LNnumpgt = 0
	    SHOW GET m.prazomedio
	    SHOW GET m.taxa
	   RETURN
	ENDIF
    m.prazomedio = LNprzacm / LNnumpgt
    m.taxa = ROUND((m.juromes / 30) *m.prazomedio,2)
    SHOW GET m.prazomedio
    SHOW GET m.taxa
RETURN

*-------------->

PROCEDURE BTN_VAL1
	PARAMETER tecla, m.chv_ler, m.chv_compara, m.chv_brow
	SELE orcament
	SET ORDER TO TAG orcamento
 	LN_prxobj = _CUROBJ
    DO CASE
		CASE tecla = "RODIZIO"
			IF LSjanela = "SCGC201B"
				HIDE WINDOW &LSjanela
				LSjanela = "SCGC201"
				SHOW WINDOW SCGC201  TOP
			ELSE
				IF LSjanela <> "SCGC201"
					HIDE WINDOW &LSjanela
				ENDIF
				LSjanela = "SCGC201B"
				SHOW WINDOW SCGC201B TOP
				SHOW GET b_btn
				_CUROBJ = OBJNUM(b_btn)
				LSj_var 	= "b_btn"
				SHOW GETS				
			ENDIF	
			RETURN
		CASE tecla = "ADD"
		    DO btn_val with tecla, m.chv_ler, m.chv_compara, m.chv_brow
			wl_cota = .T.    && BUSCAR NUMERO DE COTACAO
			m.situacao = "A "
			m.empresa  = wp_empresa
			m.tab_cst  = wp_tabcst
			m.vias_osi = 1
			m.tp_pgto  = 1
			DO OBJ_VDOR.SPR
			DO WHILE wl_vendedor = 0
				DO OBJ_VDOR.SPR
			ENDDO
			_CUROBJ = 1
			m.operador = wl_vendedor
			STORE 1 TO m.dd, m.md, m.td, m.idd, m.itd, m.ide, m.ite, ;
					   m.de, m.de, m.me, m.te, m.rdd, m.rtd, m.rde, m.rte, ;
					   m.rstp
			SHOW GET m.situacao
			SHOW GET m.empresa
   			VLnivnum = 0
			FOR VLnivnum = 1 TO 9  && reg os servid. fixos
			    VLnivstr = STR(VLnivnum,1)
                serv_&VLnivstr =  VTLservfx(VLnivnum)
                			&& Atrib. Serv. comissionados fixos
			ENDFOR	
**  BUSCA NUMERO DE ORCAMENTO
			SELECT empresa
			=REGLOCK(.T.)
			m.orcamento = orcamento   + 1
			m.juromes   = juromes
			REPLACE orcamento WITH m.orcamento
			UNLOCK
			SHOW GET m.orcamento
			SHOW GET m.juromes
			SELECT orcament
		    ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
			ON KEY LABEL END do btn_val1 with 'DELETE', VLleitura, ;
												 Vlcompara
			RETURN
		CASE tecla = "EDIT" AND isediting  && SALVANDO
*->>>>>>>>>>>>>>>>> VERIFICA ALTERACOES EM CAMPOS QUE COMPROMETEM A
* 					LIBERACAO CASO TENHA OCORRIDO
			IF m.cliente	<> orcament.cliente AND ;
				RIGHT(m.situacao,1) $ 'E') AND  m.prazomedio > 0
			      m.situacao = LEFT(m.situacao,1)+'D' && RETORNA P/ LIBERAR
			ENDIF  			   		
			do ULprzmedio
			do ULclassifica
            do ULcompara
		    DO btn_val with tecla, m.chv_ler, m.chv_compara, m.chv_brow
			iscancela = .F.
		CASE tecla = "EDIT"
		    DO btn_val with tecla, m.chv_ler, m.chv_compara, m.chv_brow
			iscancela = .F.
			IF LSjanela <> "SCGC201"
				SHOW WINDOW &LSjanela TOP
				SHOW GET &LSj_var
				_CUROBJ = OBJNUM(&LSj_var)
			ENDIF
			RETURN
        CASE tecla = "DELETE"
			IF isediting     && .T. => CANCELA A EDICAO
			    DO btn_val with tecla, m.chv_ler, m.chv_compara, m.chv_brow
			   	iscancela = .F.
			   	RETURN
			ENDIF
			IF EOF() OR BOF()
			   WAIT WINDOW C_ENDFILE NOWAIT
			   RETURN
			ENDIF
			IF !fox_alert(C_DELREC)
			   RETURN
 			ENDIF
			SELECT  orcatmp
			SET ORDER TO TAG orcamento
			SEEK STR(wp_empresa,3)+LEFT(m.tipo,1)+STR(m.orcamento,6)
			DO WHILE !EOF() AND m.orcamento = orcamento ;
							AND wp_empresa = empresa ;
							AND LEFT(m.tipo,1) = LEFT(tipo,1)
			   =REGLOCK()
			   DELETE
			   SKIP
			ENDDO
			SELECT orcament
			KEYBOARD "{S}"
		    DO btn_val with tecla, m.chv_ler, m.chv_compara, m.chv_brow

        CASE tecla = "BUSCA" OR tecla = "LOCATE"
			DO ULloc_orc WITH "ABCDdEF",.T.
        CASE tecla = "PRINT"
			DO ULimporca
		OTHERWISE
		    DO btn_val with tecla, m.chv_ler, m.chv_compara, m.chv_brow
			IF m.dd = 0
				STORE 1 TO m.dd, m.md, m.td, m.idd, m.itd, m.ide, m.ite, ;
					   m.de, m.de, m.me, m.te
			ENDIF
	ENDCASE		
	SELE TPPGTO		
	SET ORDER TO TIPO
	SEEK m.tp_pgto
	SHOW GET tppgto.descricao
	SELE TAB002
	SEEK 'FPG'+CHRTRAN(STR(m.forma_pgto,2)," ","0")
	m.nome_forma = tab002.descricao
	SHOW GET m.nome_forma
	SELE TAB001
	SEEK 'INS'+STR(m.tp_inscr,1)
	m.nome_inscr = tab001.descricao
	SHOW GET m.nome_inscr
	SEEK "ST1"+LEFT(m.situacao,1)
	m.nome_sit = RTRIM(tab001.descricao)
	SEEK "ST2"+RIGHT(m.situacao,1)
	m.nome_sit = m.nome_sit+" "+RTRIM(tab001.descricao)
	SHOW GET m.nome_sit

	SELE tipooper
	SET ORDER TO TAG tipo
	SEEK 's'+m.tipo
	IF !FOUND()
		SEEK 'S'+m.tipo
	ENDIF
	m.natureza = tipooper.descnatu
	SHOW GET m.natureza
	SELE transprt
	SEEK m.transp
	m.transp = transprt.cgc
	m.nome_trans = transprt.nome
	SHOW GET m.transp
	SHOW GET m.nome_trans
	SELE usuario
	SET ORDER TO TAG usuario
	SEEK m.operador
	m.nome_vend = usuario.nome
	SHOW GET m.nome_vend
	SELE orcament
	m.cgccliente = str(m.cliente,14)
	SHOW GET m.cgccliente
	DO ULatrmotivos
	SHOW GET m.motivo
	IF LSjanela <> "SCGC201"
		SHOW WINDOW &LSjanela
		SHOW GET &LSj_var
		_CUROBJ = OBJNUM(&LSj_var)
	ENDIF
	UNLOCK ALL
RETURN
*------------>

PROCEDURE ULcompara

	SELECT  orcatmp
	SET ORDER TO TAG orcamento
	SEEK STR(wp_empresa,3)+LEFT(m.tipo,1)+STR(m.orcamento,6)
	IF !FOUND()
		SELECT orcament
		RETURN
	ENDIF

    IF m.taxa <> taxa or m.prazomedio <> prazomedio or ;
    	m.cliente <> favorecido or m.tp_pgto <> tp_pgto or ;
 		m.forma_pgto	<> forma_pgto or ;
    	m.ch_opera <> ch_opera or m.ch_produ <> ch_produ or;
    	m.ch_motiv <> ch_motiv or m.ch_desti <> ch_desti or;
    	m.ch_contr <> ch_contr or m.ch_condi <> ch_condi
        WAIT WINDOW "Os itens serao reprocessados."

	*------>     REINICIALIZA VALORES ESPECIFICOS POR NOTA
     m.valor     = 0
	 m.LNbs_ipi  = 0         && base para calculo ipi
	 m.LNbs_icms = 0         && base para calculo icms
	 m.LNbs_subs = 0	     && base para calculo subs
	 m.LNbs_sbbrt= 0	     && base para abater icms do icms da subs
	 m.LNbs_iss  = 0        && base para calculo iss
	 m.LNbs_isen = 0        && mercadorias isentas
	 m.LNbs_outr = 0        && outras tributacoes
	 m.LNalqicms = 0		&& aliquota de icms
	 m.LNalqiss  = 0		&& aliquota de iss
	 m.LNsubs 	 = 0		&& valor de icms por substituicao
	 m.LNicms 	 = 0		&& valor de icms
	 m.LNiss  	 = 0		&& valor de iss
	 m.LNtot  	 = 0		&& total da nota
	*----> PARA RESUMO ANEXO
	 m.LNpneus	 	= 0		&& venda de pneus p/ resumo anexo
	 m.LNcamaras 	= 0		&& venda de camaras p/ resumo anexo
	 m.LNrodas	  	= 0		&& venda de rodas p/ resumo anexo
	 m.LNacessorios = 0		&& venda de acessorios p/ resumo anexo
	 m.LNmatborrach	= 0		&& venda de mat.borracharia p/ resumo anexo
	 m.LNrecauchuta	= 0		&& venda de recauchutagem p/ resumo anexo
	 m.LNalinhament = 0		&& venda de alinhamento  p/ resumo anexo
	 m.LNbalanceame = 0		&& venda de balanceamento p/ resumo anexo
	 m.LNconserto  	= 0		&& venda de conserto p/ resumo anexo
	 m.LNoutras  	= 0
	*----------------------------
	 m.LNalqicms = tipooper.aliq_icms		&& aliquota de icms
	 m.LNalqiss  = empresa.aliq_iss		&& aliquota de iss

		DO WHILE !EOF() AND m.orcamento = orcamento ;
						AND wp_empresa = empresa ;
						AND LEFT(m.tipo,1)  = LEFT(tipo,1)
			=REGLOCK()
		   	GATHER MEMVAR FIELDS taxa, prazomedio, ch_opera, ch_produ, ;
		   			ch_motiv, ch_desti, ch_contr, ch_condi,;
		   			situacao MEMO
	       	REPLACE vlrvenda WITH ;
	          ((PRECO - (PRECO * DESCONTO / 100)) * QTDE) + ;
			  ((PRECO - (PRECO * DESCONTO / 100)) * QTDE) * TAXA / 100
			IF qtde > 0
		       	REPLACE precofinal WITH vlrvenda / qtde
		    ELSE
		       	REPLACE precofinal WITH vlrvenda
			ENDIF
			REPLACE favorecido WITH m.cliente
			REPLACE orcatmp.movestq    WITH  tipooper.movestq
			REPLACE orcatmp.tipo       WITH  tipooper.tipo
			REPLACE orcatmp.cfo        WITH  tipooper.cfo
			REPLACE orcatmp.aliq_icms  WITH  tipooper.aliq_icms
			REPLACE orcatmp.info_vlr   WITH  tipooper.info_vlr

			SELECT tab_cst
			SET ORDER TO TAG cst
			SEEK STR(orcament.tab_cst,2)+STR(tipooper.status,2);
					+STR(orcatmp.tp_mercad,1)
			REPLACE orcatmp.cst       WITH  RIGHT(tab_cst.cst,1)
			SELECT orcatmp
			DO UPimpostos     && APURA VALORES DA NOTA
			SKIP
		ENDDO

		m.vlr_ipi	=	LNbs_ipi
 		m.base_iss	=	LNbs_iss
		m.base_icms	=	LNbs_icms
		m.base_sbbrt=   LNbs_sbbrt
		m.base_subs	=	LNbs_subs
		m.base_isent=	LNbs_isen
		m.base_outr	=	LNbs_outr
		m.icms_subs	=	LNsubs
		m.totservico=	LNbs_iss
		m.totproduto = m.valor - m.totservico
		m.total_nota=	m.valor + m.icms_subs + m.vlrfrete + m.vlrseguro + ;
					m.vlr_ipi

    ENDIF
	SELECT orcament
RETURN
*------------->
PROCEDURE ULclassifica

	IF (m.natu_oper = 1 AND m.motivo = 8) OR ;
	   (m.natu_oper = 2 AND m.motivo = 5) OR ;
	   (m.natu_oper = 3 AND m.motivo = 6) OR ;
	   (m.natu_oper = 4 AND m.motivo = 8)
		SELECT tipooper
		SET ORDER TO TAG tipo
		SEEK 's'+m.tipo
		IF !FOUND()
			SEEK 'S'+m.tipo  	
		ENDIF
	    SCATTER MEMVAR FIELDS ch_opera, ch_produ, ch_motiv, ch_desti,;
	    			 ch_contr, ch_condi
	ELSE
	  DO CASE
		CASE m.natu_oper = 1
			STORE "1"     TO m.ch_opera  && 1=VENDA 		
			STORE "1"     TO m.ch_produ  && 1=PROD.E SERV COMERCIAL
			STORE STR(m.motivo,1)  TO m.ch_motiv    && 1=NORMAL  2=RECLAMADA
											&& 3=COMPLEMENTO 4=ENTRGA FUTU.		
			SELE empresa
			SET ORDER TO TAG empresa
			SEEK WP_empresa
			IF empresa.estado = m.estado
				m.ch_desti = "1"   && ESTADUAL
				m.ch_contr = "1"   && CONSUMIDOR ESTADUAL				
			ELSE
				m.ch_desti = "2"   && ITERESTADUAL
				IF m.tp_inscr = 1
					m.ch_contr = "2"
				ELSE
					m.ch_contr = "3"
				ENDIF			
			ENDIF
			IF m.revendedor = "S"
				ch_contr = "4"
			ENDIF	
			IF m.ch_motiv = "4"  && VENDA P/ ENTREGA FUTURA
				m.ch_condi = "3"
			ELSE
			    IF m.prazomedio > 0
					m.ch_condi = "2"
				ELSE
					m.ch_condi = "1"
				ENDIF
			ENDIF
		**------>>> para IMOBILIZADO // CARCACA E SUCATA
			IF m.motivo > 4    && 5=IMOBIL // 6=CARAC // 7= SUCATA
				STORE "1"  TO m.ch_motiv    && 1=NORMAL
				STORE "3"  TO m.ch_condi    && 3=CONDICAO NULA DE PGTO
				STORE "5"  TO m.ch_contr    && 5=CONTRIBUINTE NULO
			ENDIF
			DO CASE
				CASE m.motivo = 5
					STORE "2"     TO m.ch_produ  && 2=IMOBILIZADO		
				CASE m.motivo = 6
					STORE "3"     TO m.ch_produ  && 3=CARCACA
				CASE m.motivo = 7
					STORE "4"     TO m.ch_produ  && 4=SUCATA
			ENDCASE
		CASE m.natu_oper = 2
			STORE "2"     TO m.ch_opera  && 2=TRANSFERENCIA
			STORE "5"     TO m.ch_contr  && 5=CONTR. NULO SEM EFEITO NA
			STORE "3"	  TO m.ch_condi  && 3=CONDICAO NULA SEM EFEITO OPER.
			STORE "1"     TO m.ch_motiv  && 1=TRANSFERENCIA NORMAL
			STORE STR(m.motivo,1)  TO m.ch_produ && VALIDO P/ OPCAO 1 e 2
			IF m.motivo = 3
			   STORE "5"  TO m.ch_produ    && 5=MAT.DE USO SERVICO
		    ELSE
				IF m.motivo = 4
				   STORE "6"  TO m.ch_produ    && 6=MAT.DE CONSUMO
				ENDIF
			ENDIF
		
			SELE empresa
			SEEK WP_empresa          && EMPRESA NO PAPEL DE PARAMETRO
			IF empresa.estado = m.estado
				m.ch_desti = "1"   && ESTADUAL
			ELSE
				m.ch_desti = "2"   && ITERESTADUAL
			ENDIF
		CASE m.natu_oper = 3
			STORE "3"     TO m.ch_opera  && 3=REMESSA
			STORE "5"     TO m.ch_contr  && 5=CONTR. NULO SEM EFEITO OPER
			STORE "3"	  TO m.ch_condi  && 3=CONDICAO NULA SEM EFEITO OPER.
		    STORE "1"  	  TO m.ch_produ  && 1=CONSIDERA SEMPRE MERCADORIA

			DO CASE
				CASE m.motivo = 1
					STORE "5"     TO m.ch_motiv  && 5=CONSIGNACAO
		    	CASE m.motivo = 2
					STORE "6"  TO m.ch_motiv    && 6=DEMONSTRACAO
				CASE m.motivo = 3
					STORE "2"  TO m.ch_motiv    && 2=RECLAMADA
				CASE m.motivo = 4
					STORE "4"  TO m.ch_motiv    && 4=ENTREGA FUTURA
				CASE m.motivo = 5
					STORE "7"  TO m.ch_motiv    && 7=CONSERTO
				CASE m.motivo = 6
					STORE "8"  TO m.ch_motiv    && 8=OUTRAS
			ENDCASE
			SELE empresa
			SEEK WP_empresa
			IF empresa.estado = m.estado
				m.ch_desti = "1"   && ESTADUAL
			ELSE
				m.ch_desti = "2"   && ITERESTADUAL
			ENDIF
		CASE m.natu_oper = 4
			STORE "4"     TO m.ch_opera  && 4=DEVOLUCAO
			STORE "5"     TO m.ch_contr  && 5=CONTR. NULO SEM EFEITO NA OPE
			STORE "3"	  TO m.ch_condi  && 3=CONDICAO NULA SEM EFEITO OPER.
		    STORE "1"  	  TO m.ch_motiv  &&1=NOR EXCETO P/CONSIG(2)DEMONS(3)
			DO CASE
				CASE m.motivo < 4
					STORE "1"     TO m.ch_produ  && 1=MERCADORIA
					IF m.motivo = 2
						STORE "5"  	  TO m.ch_motiv  && 5=CONSIGNACAO
					ELSE
						IF m.motivo = 3
							STORE "6"  	  TO m.ch_motiv  && 6=DEMONSTRACAO
						ENDIF
					ENDIF
		    	CASE m.motivo = 4
					STORE "5"  TO m.ch_produ    && 5=MAT. USO SERVICO
				CASE m.motivo = 5
					STORE "6"  TO m.ch_produ    && 6=MAT. CONSUMO
				CASE m.motivo = 6
					STORE "2"  TO m.ch_produ    && 2=IMOILIZADO
				CASE m.motivo = 7
					STORE "7"  TO m.ch_produ    && 7=ICMS P/ REEMBOLSO
				CASE m.motivo = 8
					STORE "8"  TO m.ch_produ    && 8=OUTRAS
			ENDCASE
			SELE empresa
			SEEK WP_empresa
			IF empresa.estado = m.estado
				m.ch_desti = "1"   && ESTADUAL
			ELSE
				m.ch_desti = "2"   && ITERESTADUAL
			ENDIF
			SELECT tipooper
	  ENDCASE
 	  SELECT tipooper
	  SET ORDER TO tpopera
	  SEEK 'S'+m.ch_opera+m.ch_produ+m.ch_motiv+;
	  m.ch_desti+m.ch_contr+m.ch_condi
	ENDIF
***
	IF !FOUND()
		WAIT WINDOW ;
		"A OPERACAO NAO PODE SER CLASSIFICADA. CHAME SUPORTE...<<ENTER>>"
		m.tipo = "???"
		m.cfo  = "    "
	ELSE
		m.tipo = tipo
		m.cfo  = cfo
	ENDIF

	SELE orcament
	
RETURN

*------------->
PROCEDURE local_refresh
PARAMETERS wl_branco

DO CASE

   CASE isediting
      SHOW GET rc_btn   DISABLE
	  SHOW GET co_btn   DISABLE
	  SHOW GET ap_btn   DISABLE
      SHOW GET rm_btn   DISABLE
	  SHOW GET cr_btn   DISABLE
	  SHOW GET lib_btn  DISABLE
	  SHOW GET osi_btn  DISABLE
	  SHOW GET fat_btn  DISABLE
	  SHOW GET cm_btn   DISABLE
	  SHOW GET cad_btn  DISABLE
	  SHOW GET atdm_btn DISABLE
	  SHOW GET atdr_btn DISABLE
	  SHOW GET atva_btn DISABLE
	  SHOW GET com_btn DISABLE
	  SHOW GET fin_btn DISABLE
	  SHOW GET tab_btn DISABLE
	  SHOW GET vp_btn DISABLE
	  SHOW GET oper_btn DISABLE
	  SHOW GET rodiz_btn DISABLE
	  SHOW GET item_btn DISABLE
	  SHOW GET nro_btn DISABLE
	  IF LSjanela <> "SCGC201"
		  SHOW GET prov_btn   DISABLE
		  SHOW GET financ_btn DISABLE
		  SHOW GET inform_btn DISABLE
	  ENDIF
   CASE  wl_branco
      SHOW GET rc_btn   DISABLE
	  SHOW GET co_btn   DISABLE
	  SHOW GET ap_btn   DISABLE
      SHOW GET rm_btn   DISABLE
	  SHOW GET cr_btn   DISABLE
	  SHOW GET lib_btn  DISABLE
	  SHOW GET osi_btn  DISABLE
	  SHOW GET fat_btn  DISABLE
	  SHOW GET cm_btn   DISABLE
	  SHOW GET cad_btn  DISABLE
	  SHOW GET atdm_btn DISABLE
	  SHOW GET atdr_btn DISABLE
	  SHOW GET atva_btn DISABLE
	  SHOW GET com_btn DISABLE
	  SHOW GET fin_btn DISABLE
	  SHOW GET tab_btn DISABLE
	  SHOW GET oper_btn DISABLE
	  SHOW GET rodiz_btn DISABLE
	  SHOW GET prov_btn   DISABLE
	  SHOW GET financ_btn DISABLE
	  SHOW GET inform_btn DISABLE
	  SHOW GET item_btn DISABLE
	OTHERWISE
	  LSl = LEFT(m.situacao,1)
	  LSr = RIGHT(m.situacao,1)
********************************** DESABILITACAO POR LIMITACAO DO USR
	  IF "1" $ LSaces			&& VENDA PADRAO
			SHOW GET vp_btn   DISABLE
	  ENDIF
	  IF "2" $ LSaces			&& APROVA
			SHOW GET ap_btn   DISABLE
	  ENDIF
	  IF "3" $ LSaces			&& RESERVA
			SHOW GET rm_btn   DISABLE
	  ENDIF
	  IF "4" $ LSaces			&& LIBERA
			SHOW GET lib_btn   DISABLE
	  ENDIF
	  IF "5" $ LSaces			&& OSI
			SHOW GET osi_btn   DISABLE
	  ENDIF
	  IF "6" $ LSaces			&& FATURAMENTO
			SHOW GET fat_btn   DISABLE
	  ENDIF
	  IF "7" $ LSaces			&& CANC. RESERVA
			SHOW GET cr_btn   DISABLE
	  ENDIF
	  IF "8" $ LSaces			&& CANC. ORCA.
			SHOW GET co_btn   DISABLE
	  ENDIF
	  IF "9" $ LSaces			&& LIBERA RESERVAS
			SHOW GET atva_btn   DISABLE
	  ENDIF
	  IF "T" $ LSaces			&& Cadastro
			SHOW GET tab_btn   DISABLE
	  ENDIF
	  IF "N" $ LSaces			&& Cadastro
			SHOW GET item_btn   DISABLE
	  ENDIF
	  IF "O" $ LSaces			&& Cadastro
			SHOW GET oper_btn   DISABLE
	  ENDIF
	  IF "K" $ LSaces			&& Cadastro
			SHOW GET cad_btn   DISABLE
	  ENDIF
	  IF LSl <> "A" AND !EMPTY(m.hora)
			SHOW GET del_btn   DISABLE
	  ENDIF

ENDCASE


RETURN

*--------------

*--------------------

PROCEDURE LOCA_SALDO  && VERIFICA DISPONIBILIDADE DE SALDO

   IF orcatmp.qtde  = 0  	 && ITENS COM QTDE = 0 NAO SAO PROCESSADOS
      WAIT WINDOW RTRIM(transform(orcatmp.codigo,'@R &masc_codi'))+;
                   " tem QUANTIDADE =  0 "
      RETURN .F.
   ENDIF
   IF LEFT(orcatmp.codigo,6) = "999999"  && COMENTARIO NAO NECESSITA SALDO
      RETURN .T.
   ENDIF
   SELECT saldo
   SET ORDER TO TAG clas_saldo
   SEEK STR(wp_empresa,3)+orcatmp.classifica+;
        STR(YEAR(wp_dtoper),4)+;
        STR(MONTH(wp_dtoper),2)
   IF !FOUND()
      WAIT WINDOW RTRIM(transform(orcatmp.codigo,'@R &masc_codi'))+;
                   " nao foi aberto para movimentacao. Solicite abertura."
      RETURN .F.
   ENDIF
   IF STATUS = 'F'
      WAIT WINDOW RTRIM(transform(orcatmp.codigo,'@R &masc_codi'))+;
                   " nao permite movimentacoes neste mes"
      RETURN .F.
   ENDIF
   IF orcatmp.tp_mercad = 7  && SERVICO NAO NECESSITA SALDO
      RETURN .T.
   ENDIF
   DO CASE
		CASE LEFT(orcatmp.situacao,1) = 'C'  && VE SE E POSSIVEL FAZER RES
		   wl_real_saldo = saldo.sld_atu
		   wl_bloq_saldo = saldo.sld_atu - saldo.reserva
		   IF orcatmp.qtde > wl_real_saldo
		      WAIT WINDOW RTRIM(transform(orcatmp.codigo,'@R &masc_codi'))+;
                   " nao possui saldo para atende-lo."
		      RETURN .F.
		   ENDIF
		   IF orcatmp.qtde > wl_bloq_saldo
		      WAIT WINDOW RTRIM(transform(orcatmp.codigo,'@R &masc_codi'))+;
                   " nao possui saldo para atende-lo devido a reservas."
		      RETURN .F.
		   ENDIF
		   IF !REGLOCK()
		      WAIT WINDOW RTRIM(transform(orcatmp.codigo,'@R &masc_codi'))+;
                   " nao pode ser bloqueado para efetivar reserva."
		      RETURN .F.
		   ENDIF
		OTHERWISE
		   IF orcatmp.qtde > saldo.reserva
		      WAIT WINDOW RTRIM(transform(orcatmp.codigo,'@R &masc_codi'))+;
                   " nao possui reserva suficiente p/ baixa. Problema!"
		      RETURN .F.
		   ENDIF
	ENDCASE		
RETURN .T.


PROCEDURE RESERVA

   IF orcatmp.qtde  = 0  	 && ITENS COM QTDE = 0 NAO SAO PROCESSADOS
      RETURN
   ENDIF
   IF orcatmp.tp_mercad = 7  && SERVICO NAO NECESSITA SALDO
      RETURN
   ENDIF
   IF LEFT(orcatmp.codigo,6) = "999999"  && COMENTARIO NAO NECESSITA SALDO
      RETURN
   ENDIF
   SELECT orcatmp
   SCATTER MEMVAR MEMO

   IF LEFT(orcatmp.situacao,1) $ 'Dd'    && CANCELA RESERVAS
      m.situacao = 'C'+RIGHT(m.situacao,1)
      m.operacao = 'RVCS'   && RESERVA/VENDA/CANCELADA/
   ELSE
      m.situacao = 'D'+RIGHT(m.situacao,1)
      m.operacao = 'RVPS'   && RESERVA/VENDA/PROCESSADA/
   ENDIF

   SELECT itemmov
   SET ORDER TO TAG itemnota
   SEEK STR(m.empresa,3)+"R"+STR(m.orcamento,6)+m.classifica

   IF FOUND()
		SELE itmanexo
		SET ORDER TO TAG movanexo
		SEEK STR(itemmov.empresa,3)+itemmov.codigo+;
			 DTOS(itemmov.data)+itemmov.hora+itemmov.tipo+;
			 STR(itemmov.nota,6)+STR(itemmov.ordem,2)
		=REGLOCK()
		DELETE
		UNLOCK
		SELE itemmov
	    SET ORDER TO TAG movimento
		=REGLOCK()
		DELETE
		UNLOCK
   ENDIF

   SELECT orcatmp
   REPLACE situacao WITH m.situacao
   REPLACE operacao WITH m.operacao

   SELECT itemmov
   SET ORDER TO TAG movimento

   IF m.operacao = 'RVPS'   && RESERVA/VENDA/PROCESSADA/
	 	m.data = wp_dtoper
 		m.hora = time()
	 	m.sld_estq = 0
	 	m.vlr_estq = 0
	   =edithand('SAVE')
   ENDIF

   DO UPatu_cmd		&& ROTINA DE VERIFICACAO E ATUALIZACAO DO SALDO
						&& VAI DEVOLVER m.sld_atu e


RETURN

*************************>

PROCEDURE BAIXA_SALDO  && VERIFICA POSSIBILIDADE DE  BAIXA  NO ESTOQUE

   IF orcatmp.qtde  = 0  	 && ITENS COM QTDE = 0 NAO SAO PROCESSADOS
      RETURN .T.
   ENDIF
   IF LEFT(orcatmp.codigo,6) = "999999"  && COMENTARIO NAO NECESSITA SALDO
      RETURN .T.
   ENDIF

   SELECT saldo
   SET ORDER TO TAG clas_saldo
   SEEK STR(wp_empresa,3)+orcatmp.classifica+;
        STR(YEAR(wp_dtoper),4)+;
        STR(MONTH(wp_dtoper),2)
   IF !FOUND()
      WAIT WINDOW RTRIM(transform(orcatmp.codigo,'@R &masc_codi'))+;
                   " nao foi aberto para movimentacao. Solicite abertura."
      RETURN .F.
   ENDIF
   IF STATUS = 'F'
      WAIT WINDOW RTRIM(transform(orcatmp.codigo,'@R &masc_codi'))+;
                   " nao permite movimentacoes neste mes"
      RETURN .F.
   ENDIF
   IF orcatmp.tp_mercad = 7  && SERVICO NAO NECESSITA SALDO
      RETURN .T.
   ENDIF
   DO CASE
		CASE LEFT(orcatmp.situacao,1) <> 'D'  && FAT. SEM RESERV. PREVIA
		   wl_real_saldo = saldo.sld_atu
		   wl_bloq_saldo = saldo.sld_atu - saldo.reserva

		   IF orcatmp.qtde > wl_real_saldo
		      WAIT WINDOW RTRIM(transform(orcatmp.codigo,'@R &masc_codi'))+;
                   " nao possui saldo para atende-lo."
		      RETURN .F.
		   ENDIF
		   IF orcatmp.qtde > wl_bloq_saldo
		      WAIT WINDOW RTRIM(transform(orcatmp.codigo,'@R &masc_codi'))+;
                   " nao possui saldo para atende-lo devido a reservas."
		      RETURN .F.
		   ENDIF
		   IF !REGLOCK()
		      WAIT WINDOW RTRIM(transform(orcatmp.codigo,'@R &masc_codi'))+;
                   " nao pode ser bloqueado para efetivar reserva."
		      RETURN .F.
		   ENDIF
		CASE LEFT(orcatmp.situacao,1) = 'D'  && FAT. SEM RESERV. PREVIA
		   IF orcatmp.qtde > saldo.reserva
		      WAIT WINDOW RTRIM(transform(orcatmp.codigo,'@R &masc_codi'))+;
                   " nao possui reserva suficiente p/ baixa. Problema!"
		      RETURN .F.
		   ENDIF
	ENDCASE		
RETURN .T.


PROCEDURE FATURA

   SELECT orcatmp
   LNnota = m.nota     && EVITA APAGAR N. NOTA
   SCATTER MEMVAR MEMO
   DO CASE
		CASE orcatmp.movestq = "N"
	    	  m.operacao = 'INFO'   && MERA INFORMACAO SEM EFEITO ESTOQUE
		CASE m.natu_oper = 1
		   IF LEFT(orcatmp.situacao,1) $ 'Dd'  && BAIXA REZERVA E SALDO
	    	  m.operacao = 'SVPS'   && SAIDA/VENDA/PROCESSADA/COM RESERVA
		   ELSE
    		  m.operacao = 'SVPN'   && SAIDA/VENDA/PROCESSADA/SEM RESERVA
		   ENDIF
		CASE m.natu_oper = 2
		   IF LEFT(orcatmp.situacao,1) $ 'Dd'  && BAIXA REZERVA E SALDO
		      m.operacao = 'STPS'   && SAIDA/COMERCIAL/PROC/COM RESERVA
		   ELSE
		      m.operacao = 'STPN'   && SAIDA/COMERCIAL/PROCE/SEM RESERVA
		   ENDIF
		CASE m.natu_oper = 3
		   IF LEFT(orcatmp.situacao,1) $ 'Dd'  && BAIXA REZERVA E SALDO
		      m.operacao = 'SRPS'   && SAIDA/REMESSA/PROCESSADA/COM RESERVA
		   ELSE                                && BAIXA SALDO SEM REZERVA
		      m.operacao = 'SRPN'   && SAIDA/REMESSA/PROCESSADA/SEM RESERVA
		   ENDIF
 		CASE m.natu_oper = 4
		   IF LEFT(orcatmp.situacao,1) $ 'Dd'  && BAIXA REZERVA E SALDO
		      m.operacao = 'SDPS'   && SAIDA/COMERCIAL/PROC/COM RESERVA
		   ELSE
		      m.operacao = 'SDPN'   && SAIDA/COMERCIAL/PROCE/COM RESERVA
		   ENDIF
   ENDCASE
   m.situacao = 'E'+RIGHT(m.situacao,1)
   m.nota = LNnota
   m.dtfat = wp_dtoper

*****  ATRIBUIR SERVIDORES COMISSIONADOS
	IF LEFT(m.tipo,1) = "V"
		VLnivnum = 0
	 	FOR VLnivnum = 1 TO 9  && reg os servid. fixos
	 		VLnivstr = STR(VLnivnum,1)
	    	IF !(VLnivstr $ m.comissiona)
			     m.serv_&VLnivstr =  0
	        ELSE
		         m.serv_&VLnivstr = VTLservfx(VLnivnum)	
		         							&& Atrib. Serv. comiss fixos
	        ENDIF
		ENDFOR	
	ENDIF
*****
   SELECT orcatmp
   GATHER MEMVAR MEMO

   SELECT itemmov
	m.data = m.datanf
	m.hora = m.horanf
	m.sld_estq = 0
	m.vlr_estq = 0
	
   =edithand('SAVE')
   IF LEFT(orcatmp.codigo,6) <> "999999"
						    && NAO PROCESSA CUSTO PARA SERVICO
		DO UPatu_cmd		&& ROTINA DE VERIFICACAO E ATUALIZACAO DO SALDO
							&& VAI DEVOLVER m.sld_atu e
	ENDIF
RETURN
******
PROCEDURE ULgeradupl


	SELE orcament
	IF orcament.tp_pgto = 1   && VENDA A VISTA
		RETURN
	ENDIF
	LNocorrenc = 1
    LNposic    = 0
    LNinicio   = 1
    LNnumpgt   = 0
	LNdias		= 0
	LNserie		= 1
	LNentrada  = orcament.vlr_ent  && valor da entrada
	DO WHILE .t.
        LNposic = AT("/",m.prazo, LNocorrenc)
		IF LNposic = 0
			EXIT
		ENDIF
		IF SUBS(m.prazo,LNinicio,3) = "   "
           EXIT
        ENDIF
        LNdias     = INT(VAL(SUBS(m.prazo,LNinicio,3)))
******************************************************************

		IF LNdias = 0 AND LNnumpgt > 0
	        LNnumpgt   = LNnumpgt
		ELSE			
	        LNnumpgt   = LNnumpgt + 1
		ENDIF
		LNocorrenc = LNocorrenc + 1
        LNinicio   = LNposic + 1
	ENDDO

	IF LNentrada > 0 AND LNnumpgt > 1
		LNvlrdupl = ROUND((m.total_nota- LNentrada) / (LNnumpgt - 1) ,2)
		LNdifere  = m.total_nota- (ROUND(LNvlrdupl * (LNnumpgt - 1),2) + ;
							+  LNentrada)
    ELSE
		LNvlrdupl = ROUND(m.total_nota/ LNnumpgt ,2)
		LNdifere  = m.total_nota- ROUND(LNvlrdupl * LNnumpgt,2)
	ENDIF
**>>>>>
	m.empresa	= wp_empresa
	m.duplicata	= m.nota
	m.dt_emi	= m.wp_dtoper
	m.multa_prv	= empresa.multa
	m.mora_prv	= empresa.mora
	m.bonus_prv	= empresa.bonus
	m.prem_pont	= empresa.prem_pont
	m.portador	= 0
	m.regiao    = clientes.regiao
	m.natu      = clientes.natureza
	m.tp_cobranc= 01 		  && COB. SIMPLES
**>>>>>
	LNocorrenc = 1
    LNposic    = 0
    LNinicio   = 1
	LNdias		= 0
	LVindice   = 1

	DO WHILE .t.
        LNposic = AT("/",m.prazo, LNocorrenc)
		IF LNposic = 0
			EXIT
		ENDIF
		IF SUBS(m.prazo,LNinicio,3) = "   "
           EXIT
        ENDIF
		m.duplicata	= INT( VAL(   CHRTRAN(STR(m.nota,6)," ","0")+;
								  CHRTRAN(STR(LNserie,1)," ","0")+;
								  "1"))   && 1 => DUPLICATA

        LNdias     = INT(VAL(SUBS(m.prazo,LNinicio,3)))

		IF LNentrada > 0 AND LNnumpgt > 1
			m.vlr_doc = LNentrada
			LNentrada = 0
		ELSE
			m.vlr_doc  = LNvlrdupl + LNdifere
			LNdifere   = 0
		ENDIF
		m.dt_venc  = m.dt_emi + LNdias
		m.dtproxproc  = m.dt_venc

*------------------  P/ IMPRESSAO NA NOTA ------------------------*
		LNstmp = STR(LVindice,1)
        LVnumdup&LNstmp  = m.duplicata
        LVvendup&LNstmp  = m.dt_venc
        LVvlrdup&LNstmp  = m.vlr_doc
		LVindice   = LVindice + 1
*-----------------------------------------------------------------*
		SELE  duplicat
		=ADIREG()
		GATHER MEMVAR MEMO
		SELE orcament

		LNserie    = LNserie + 1
		LNocorrenc = LNocorrenc + 1
        LNinicio   = LNposic + 1
	ENDDO


RETURN

PROCEDURE ULatrmotivos
STORE ""   TO VTLmotivo
DO CASE
	CASE m.natu_oper = 1
		VTLmotivo(1) = "Normal         "
		VTLmotivo(2) = "Reclamada      "
		VTLmotivo(3) = "Complemento    "
		VTLmotivo(4) = "Entrega Futura "
		VTLmotivo(5) = "Imobilizado    "
		VTLmotivo(6) = "Carcacas       "
		VTLmotivo(7) = "Sucatas        "
		VTLmotivo(8) = "Outras         "
	CASE m.natu_oper = 2
		VTLmotivo(1) = "Mercadoria Comercial  "
		VTLmotivo(2) = "Bens Imobilizados     "
		VTLmotivo(3) = "Mat. de Uso em Servico"
		VTLmotivo(4) = "Material de Consumo   "
		VTLmotivo(5) = "Outros                "
		VTLmotivo(6) = "                      "
		VTLmotivo(7) = "                      "
		VTLmotivo(8) = "                      "
	CASE m.natu_oper = 3
		VTLmotivo(1) = "Consignacao    "
		VTLmotivo(2) = "Demonstracao   "
		VTLmotivo(3) = "Reclamacao     "
		VTLmotivo(4) = "Entrega Futura "
		VTLmotivo(5) = "Conserto       "
		VTLmotivo(6) = "Outras         "
		VTLmotivo(7) = "               "
		VTLmotivo(8) = "               "
	CASE m.natu_oper = 4
		VTLmotivo(1) = "Mercadoria Comercial   "
		VTLmotivo(2) = "Remessa em Consignacao "
		VTLmotivo(3) = "Remessa em Demonstracao"
		VTLmotivo(4) = "Mat. Uso Servico       "
		VTLmotivo(5) = "Mat. Consumo           "
		VTLmotivo(6) = "Compra de Imobilizado  "
		VTLmotivo(7) = "ICMS p/ Reembolso      "
		VTLmotivo(8) = "Outros                 "
ENDCASE
RETURN
*****************************************************************


PROCEDURE ULloc_orc		&& sist. localizacao de orcamentos
PARAMETERS LSsit, LFtmp	
*---> LSsit => indica as situacoes que devem ser relacionadas
*---> LFtmp => indica solicitacao de uso de arq. temporario	
*--->
	ON KEY LABEL ESCAPE
	CLEAR TYPEAHEAD
    SELECT orcament
	LFtmp = !LFtmp		&& ind.solic. do uso de arq.temporario
	LNreg = RECNO()     && permite reposicionar registro
	LNemp = orcament.empresa
	LNorca= orcament.orcamento
	IF EMPTY(wl_vendedor)
		SET ORDER TO tag situacao
		SET NEAR ON
		SEEK STR(wp_empresa,3)+LEFT(LSsit,1)    &&posic. na 1a sit.strig
		SET NEAR OFF
		IF EOF() OR wp_empresa <> orcament.empresa OR ;
				!(LEFT(orcament.situacao,1) $ LSsit)
	 		WAIT WINDOW "Nao Foram encotrados dados para pesquisa."
			UNLOCK
			GO LNreg
			KEYBOARD "{ESCAPE}"
			=INKEY()
	 		RETURN
		ENDIF
	ELSE
		SET ORDER TO tag vend_data
		SET NEAR ON
		SEEK STR(wp_empresa,3)+STR(wl_vendedor,4)+LEFT(LSsit,1)
		SET NEAR OFF
		IF EOF() OR wp_empresa <> orcament.empresa OR ;
				wl_vendedor <> orcament.operador   OR ;
				!(LEFT(orcament.situacao,1) $ LSsit)
	 		WAIT WINDOW "Nao Foram encotrados dados para pesquisa."
			UNLOCK
			GO LNreg
			KEYBOARD "{ESCAPE}"
			=INKEY()
	 		RETURN
		ENDIF
 	ENDIF		
************************>
	IF LFtmp
		wl_arqtmp = ""
		LNtmp     = 65		&& TABELA ASCII A = 65
		IF !UPabretmp("orc")
			wp_flgfecha = .t.
		ENDIF
		IF wp_flgfecha
			KEYBOARD "{ESCAPE}"
			RETURN
		ENDIF
		SET SAFET OFF
		LStmp = "&wp_dirtmp"+"&wl_arqtmp"
		SELE orcament
		IF EMPTY(wl_vendedor)
			COPY TO &LStmp ;
	    	     WHILE wp_empresa = orcament.empresa AND ;
	   	           LEFT(orcament.situacao,1) <= RIGHT(LSsit,1) WITH CDX
		ELSE
			COPY TO &LStmp  ;
	    	     WHILE wp_empresa = orcament.empresa AND ;
	   			   wl_vendedor = orcament.operador AND ;
	   	           LEFT(orcament.situacao,1) <= RIGHT(LSsit,1) WITH CDX
		ENDIF
	    SELE 0
	    USE "&wp_dirtmp"+"&wl_arqtmp" EXCLU ALIAS ORCABROW
	ENDIF
	SET ORDER TO tag orcamento
*------------------------------------- posiciona
	SET NEAR ON
	SEEK STR(LNemp,3)+STR(LNorca,6)
	SET NEAR OFF		
*	SET ORDER TO tag vend_data
*-----------------------> FIM PREPARACAO ARQ. TEMPORARIO	
*	KEYBOARD "{CTRL-F10}"
	IF LFpendente	&& EXCLUI FATURADOS E CANCELADOS DA LISTA
		Lpar1 =  " LEFT(situacao,1) $ LSsit "
	ELSE
		Lpar1 =  ""
	ENDIF
	Lpar2 =  UPPER(VLchvlimi)

	SET ORDER TO tag situacao
	IF !EMPTY(wl_vendedor)
	   Lpar2 =  "STR(wp_empresa,3)+STR(wl_vendedor,4)"
	   SET ORDER TO tag vend_data
    ENDIF

	IF LFtmp
		Lpar1 = ""
		Lpar2 = ""
    ENDIF
	DO loc_dlog WITH .T., Lpar1, Lpar2, "B"
    SELECT orcament
	SET ORDER TO tag orcamento
	SET RELATION TO
*------------------------------------- posiciona orcamento
	IF LFtmp
		SEEK STR(orcabrow.empresa,3)+STR(orcabrow.orcamento,6)
*------------------------------------ encerra secao orcabrow
		IF !FOUND()
			GO 	LNreg
		ENDIF
		SELECT orcabrow
		USE
		SELECT orcament
	ENDIF
	=btn_val('ATUALIZA')     && APENAS ATUALIZA A TELA E REFRESH
RETURN

FUNCTION ULreg_osi		&& REGISTRA A IMPRESSAO DA OSI PARA O ITEM

	LFind_imp = .t. 	&& INDICA que houve impressao
	IF LFalt_sit		&& = .T. altere a sit. p/ evitar dupla impressao
		ULaliant = alias()
    	SELECT orcatmp
		=REGLOCK()
		IF RIGHT(orcatmp.situacao,1) $ "EO"
			REPLACE situacao with LEFT(orcatmp.situacao,1)+"O"
		ELSE
			REPLACE situacao with LEFT(orcatmp.situacao,1)+"o"
		ENDIF	
		SELE &ULaliant
	ENDIF
RETURN("")



PROCEDURE ULimporca		&& IMPRESSAO simples do orcamento

	LFalt_sit	= .f.  && INDICA A ULreg_osi se a sit ja pode ser alterada
	LFind_imp 	= .f.  && INDICA se houve impr.de itens p/ que
	
	DO ULloc_orc WITH "ABCDdEF",.T.

	IF LASTKEY() = 27 OR EOF()
		RETURN
	ENDIF
	IF m.valor = 0
		WAIT WINDOW "Orcamento com VALOR = 0. - Lance os Itens"
		RETURN
	ENDIF

	SELE orcament
	***************  IMPRESSAO OSI  **********************
	IF !(EMPTY(ALLTRIM(wp_imporc)))
		RUN &wp_imporc > \TMP\SAIDA.TXT
	ENDIF
	SET PRINTER TO &wp_prtorc
	SELE clientes
	SET ORDER TO TAG cliente

	SELE transprt
	SET ORDER TO TAG CGC
	SELE orcatmp
	SET ORDER TO TAG ORCAMENTO
	SELE orcament
	SET ORDER TO TAG ORCAMENTO
	SET RELATION TO  STR(EMPRESA,3)+LEFT(TIPO,1)+STR(ORCAMENTO,6) ;
					 INTO ORCATMP
	SET RELATION TO  TRANSP INTO TRANSPRT ADDITIVE
	SET RELATION TO  CLIENTE INTO CLIENTES ADDITIVE

	SET SKIP TO ORCATMP
	SET POINT TO ","
	SET SEPARATOR  TO "."

	LNreginicio = RECNO()
	m.ordem = "A"
	REPORT FORM relorca ;
				  WHILE orcament.orcamento = m.orcamento ;
				  AND orcament.empresa = wp_empresa NOCONSOLE TO PRINTER
	GO LNreginicio
**********************************************************************

**********************************************************************
****  SO PARA FECHAR ARQUIVO P/ IMP
	IF !(EMPTY(ALLTRIM(wp_imposi)))
		RUN &wp_imposi > \TMP\SAIDA.TXT
	ENDIF
	SET PRINTER TO &wp_prtosi

	SET PRINTER TO SET('PRINTER',1)
	SET RELATION TO
	SET POINT TO
	SET SEPARATOR  TO
**************                          ************************

	SELECT orcament
	GO LNreginicio
	UNLOCK ALL
	=BTN_VAL1('ATUALIZAR', VLleitura, Vlcompara)
RETURN



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RMO0LFPQ2           m.natu_oper WHEN                   
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SCGC201,     Record Number:   39   
*        Variable:            m.natu_oper                        
*        Called By:           WHEN Clause                        
*        Object Type:         Popup                              
*        Snippet Number:      1                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _rmo0lfpq2     &&  m.natu_oper WHEN
#REGION 1
ON KEY LABEL ESCAPE	KEYBOARD "{END}"
IF LASTKEY() = 15
	KEYBOARD "{ESCAPE}"
ENDIF
RETURN(isadding)
*


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RMO0LFPRR           m.natu_oper VALID                  
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SCGC201,     Record Number:   39   
*        Variable:            m.natu_oper                        
*        Called By:           VALID Clause                       
*        Object Type:         Popup                              
*        Snippet Number:      2                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _rmo0lfprr     &&  m.natu_oper VALID
#REGION 1
DO ULatrmotivos
ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
RETURN .T.


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RMO0LFPTB           m.motivo WHEN                      
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SCGC201,     Record Number:   40   
*        Variable:            m.motivo                           
*        Called By:           WHEN Clause                        
*        Object Type:         Popup                              
*        Snippet Number:      3                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _rmo0lfptb     &&  m.motivo WHEN
#REGION 1
ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
RETURN(isadding AND m.natu_oper < 5)


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RMO0LFPUN           m.tipo WHEN                        
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SCGC201,     Record Number:   41   
*        Variable:            m.tipo                             
*        Called By:           WHEN Clause                        
*        Object Type:         Field                              
*        Snippet Number:      4                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _rmo0lfpun     &&  m.tipo WHEN
#REGION 1
LFtmp =(isediting and ((m.natu_oper = 1 AND m.motivo = 8) OR (m.natu_oper = 2 AND m.motivo = 5) OR (m.natu_oper = 3 AND m.motivo = 6) OR (m.natu_oper = 4 AND m.motivo = 8)))
RETURN(LFtmp and LSjanela = "SCGC201")

*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RMO0LFPVY           m.tipo VALID                       
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SCGC201,     Record Number:   41   
*        Variable:            m.tipo                             
*        Called By:           VALID Clause                       
*        Object Type:         Field                              
*        Snippet Number:      5                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _rmo0lfpvy     &&  m.tipo VALID
#REGION 1
SELECT tipooper
SET ORDER TO TAG tipo
IF LASTKEY() = 9
   ON KEY LABEL ESCAPE
   DO loc_dlog WITH .F.,.F., "'s'"
   ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
   IF LASTKEY()  =  27
		SELECT orcament
		RETURN .F.
   ENDIF
   m.tipo = tipooper.tipo
   m.natureza = tipooper.descnatu
   SHOW GET m.natureza
   SELECT orcament
ENDIF
ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
SET ORDER TO TAG tipo
SEEK "s"+m.tipo
IF !FOUND()
	SELECT orcament
	RETURN .F.
ENDIF
IF INT(VAL(tipooper.tipo)) <> m.natu_oper	
	WAIT WINDOW "Tipo nao Pertence a operacao comercial informada."
	SELECT orcament
	RETURN .F.
ENDIF
m.tipo = tipooper.tipo
m.natureza = tipooper.descnatu
SELECT orcament
SHOW GET m.natureza
SELECT orcament
RETURN .T.


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RMO0LFPZG           m.orcamento VALID                  
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SCGC201,     Record Number:   42   
*        Variable:            m.orcamento                        
*        Called By:           VALID Clause                       
*        Object Type:         Field                              
*        Snippet Number:      6                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _rmo0lfpzg     &&  m.orcamento VALID
#REGION 1
SELE orcament
SET ORDER TO TAG orcamento
IF LASTKEY() = 9
    ON KEY LABEL ESCAPE
	DO loc_dlog WITH .T.
    ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
	IF LASTKEY() <> 27
		m.orcamento = orcament.orcamento
	ENDIF	
ENDIF	

SEEK STR(wp_empresa,3)+STR(m.orcamento,6)

RETURN(UPtratachv())



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RMO0LFQ2N           m.data WHEN                        
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SCGC201,     Record Number:   44   
*        Variable:            m.data                             
*        Called By:           WHEN Clause                        
*        Object Type:         Field                              
*        Snippet Number:      7                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _rmo0lfq2n     &&  m.data WHEN
#REGION 1
IF isadding
   data = wp_dtoper
   hora = TIME()
ENDIF
SHOW GET m.data
SHOW GET m.hora
RETURN .F.


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RMO0LFQ5B           m.cliente VALID                    
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SCGC201,     Record Number:   50   
*        Variable:            m.cliente                          
*        Called By:           VALID Clause                       
*        Object Type:         Field                              
*        Snippet Number:      8                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _rmo0lfq5b     &&  m.cliente VALID
#REGION 1
SELECT clientes
IF LASTKEY() = 9
   ON KEY LABEL ESCAPE
   SET ORDER TO TAG nome
   DO loc_dlog WITH .T.
   ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
   IF LASTKEY() = 27
		SELECT orcament
		RETURN .F.
	ENDIF
    m.cliente = clientes.cliente
ENDIF
ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
IF m.cliente <> 0 AND Calc_cgc(m.cliente) = "3"
	SELECT orcament
	RETURN .F.
ENDIF

SET ORDER TO TAG cliente
SEEK m.cliente
IF m.cliente = 0 OR !FOUND()
	SELECT orcament
	IF isadding
		m.tp_pessoa = 1
		m.estado	= empresa.estado
		m.inscricao = 'ISENTO'
		m.tp_inscr	= 4
		m.nome_inscr ="OUTROS"
		m.revendedor= "N"
	ENDIF
	SHOW GET m.estado
	SHOW GET m.inscricao
	SHOW GET m.tp_inscr
	SHOW GET m.nome_inscr
	SHOW GET m.revendedor
	SHOW GET m.tp_pessoa
	RETURN .T.
ENDIF
SCATTER MEMVAR FIELDS tp_pessoa, cliente, nome,endereco,bairro,cidade,;
				  estado,cep,fone,inscricao,tp_inscr, revendedor MEMO

IF m.revendedor <> "S"
	m.revendedor = "N"
ENDIF   		
SELE tab001
SEEK 'INS'+str(m.tp_inscr,1)
m.nome_inscr = tab001.descricao
SELECT orcament
SHOW GET m.cliente
SHOW GET m.nome
SHOW GET m.endereco
SHOW GET m.bairro
SHOW GET m.cidade
SHOW GET m.estado
SHOW GET m.nome
SHOW GET m.cep
SHOW GET m.tp_inscr
SHOW GET m.nome_inscr
SHOW GET m.revendedor
SHOW GET m.tp_pessoa
SHOW GET m.inscricao
SHOW GET m.fone

RETURN .T.


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RMO0LFQB9           m.nome WHEN                        
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SCGC201,     Record Number:   52   
*        Variable:            m.nome                             
*        Called By:           WHEN Clause                        
*        Object Type:         Field                              
*        Snippet Number:      9                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _rmo0lfqb9     &&  m.nome WHEN
#REGION 1
m.cgccliente = str(m.cliente,14)
SHOW GET m.cgccliente
SELE clientes
RETURN(isediting AND LSjanela = "SCGC201" AND (!FOUND() OR m.cliente = 0))


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RMO0LFQE5           m.tp_inscr VALID                   
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SCGC201,     Record Number:   58   
*        Variable:            m.tp_inscr                         
*        Called By:           VALID Clause                       
*        Object Type:         Field                              
*        Snippet Number:      10                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _rmo0lfqe5     &&  m.tp_inscr VALID
#REGION 1
SELECT tab001
IF LASTKEY() = 9
   ON KEY LABEL ESCAPE
   DO loc_dlog WITH .T., "tab001.tabela = 'INS'"
   ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
   IF LASTKEY() = 27
		SELECT orcament
		RETURN .F.
	ENDIF
ELSE
	IF !SEEK('INS'+STR(m.tp_inscr,1))
		SELECT orcament
		RETURN .F.
	ENDIF
ENDIF
m.tp_inscr   = val(tab001.codigo)
m.nome_inscr = tab001.descricao
IF m.tp_inscr = 2 OR m.tp_inscr = 4
   m.inscricao = "ISENTO"
   SHOW GET m.inscricao
ENDIF
SHOW GET m.tp_inscr
SHOW GET m.nome_inscr
SELECT orcament
RETURN .T.


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RMO0LFQIL           m.inscricao VALID                  
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SCGC201,     Record Number:   61   
*        Variable:            m.inscricao                        
*        Called By:           VALID Clause                       
*        Object Type:         Field                              
*        Snippet Number:      11                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*


FUNCTION _rmo0lfqil     &&  m.inscricao VALID

*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RMO0LFQJV           m.fone VALID                       
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SCGC201,     Record Number:   62   
*        Variable:            m.fone                             
*        Called By:           VALID Clause                       
*        Object Type:         Field                              
*        Snippet Number:      12                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
*IF FOX_ALERT("Gravar dados basico do cliente ?")
*	SELE clientes
*	SET ORDER TO TAG cliente
*	SEEK m.cliente
*	IF !FOUND()
*		m.dt_alter = wp_dtoper
*		=edithand('SAVE')
*	ENDIF
*	SELE orcament
*	HIDE WINDOW &LSjanela
*	LSjanela = "SCGC201"
*	SHOW WINDOW SCGC201 TOP
*	_CUROBJ = LN_prxobj
*	RETURN(.T.)
*ENDIF	
*
*IF isediting AND LASTKEY() <> 5 AND LASTKEY() <> 19	
*	HIDE WINDOW &LSjanela
*	LSjanela = "SCGC201"
*	SHOW WINDOW SCGC201 TOP
*	_CUROBJ = LN_prxobj
*ENDIF
FUNCTION _rmo0lfqjv     &&  m.fone VALID
#REGION 1
RETURN(.T.)


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RMO0LFQN6           m.veiculo VALID                    
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SCGC201,     Record Number:   63   
*        Variable:            m.veiculo                          
*        Called By:           VALID Clause                       
*        Object Type:         Field                              
*        Snippet Number:      13                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _rmo0lfqn6     &&  m.veiculo VALID
#REGION 1
IF isediting AND (LASTKEY() = 5 OR LASTKEY() = 19)
	HIDE WINDOW &LSjanela
	LSjanela = "SCGC201"
	SHOW WINDOW SCGC201 TOP
	_CUROBJ = LN_prxobj
	RETURN(.T.)
ENDIF


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RMO0LFQP5           m.forma_pgto VALID                 
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SCGC201,     Record Number:   65   
*        Variable:            m.forma_pgto                       
*        Called By:           VALID Clause                       
*        Object Type:         Field                              
*        Snippet Number:      14                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _rmo0lfqp5     &&  m.forma_pgto VALID
#REGION 1
SELECT tab002
IF LASTKEY() = 9
   ON KEY LABEL ESCAPE
   DO loc_dlog WITH .T., "tab002.tabela = 'FPG'"
   ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
   IF LASTKEY() = 27
		SELECT orcament
		RETURN .F.
	ENDIF
ELSE
	IF !SEEK('FPG'+CHRTRAN(STR(m.forma_pgto,2)," ","0"))
		SELECT orcament
		RETURN .F.
	ENDIF
ENDIF
m.forma_pgto   = val(tab002.codigo)
m.nome_forma   = tab002.descricao
SHOW GET m.forma_pgto
SHOW GET m.nome_forma
SELECT orcament

***********************   ADIANTA P/ PROXIMO CAMPO
RETURN .T.


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RMO0LFQS8           m.tp_pgto VALID                    
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SCGC201,     Record Number:   67   
*        Variable:            m.tp_pgto                          
*        Called By:           VALID Clause                       
*        Object Type:         Field                              
*        Snippet Number:      15                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _rmo0lfqs8     &&  m.tp_pgto VALID
#REGION 1
SELECT tppgto
IF LASTKEY() = 9
   ON KEY LABEL ESCAPE
   DO loc_dlog WITH .T.
   ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
   IF LASTKEY() =  27
		SELECT orcament
		RETURN .F.
	ENDIF
ELSE
	IF !SEEK(m.tp_pgto)
		SELECT orcament
		RETURN .F.
	ENDIF
ENDIF
m.tp_pgto = tppgto.tipo
IF !EMPTY(ALLTRIM(LEFT(tppgto.prazo,3)))
	  m.prazo   = tppgto.prazo
ENDIF
SELECT orcament
SHOW GET m.tp_pgto
SHOW GET m.prazo
SHOW GET tppgto.descricao
RETURN .T.


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RMO0LFQW5           m.juromes WHEN                     
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SCGC201,     Record Number:   72   
*        Variable:            m.juromes                          
*        Called By:           WHEN Clause                        
*        Object Type:         Field                              
*        Snippet Number:      16                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _rmo0lfqw5     &&  m.juromes WHEN
#REGION 1
DO ULprzmedio
RETURN(isediting AND LSjanela = "SCGC201" AND m.natu_oper = 1)

*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RMO0LFQXE           m.banco VALID                      
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SCGC201,     Record Number:   73   
*        Variable:            m.banco                            
*        Called By:           VALID Clause                       
*        Object Type:         Field                              
*        Snippet Number:      17                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _rmo0lfqxe     &&  m.banco VALID
#REGION 1
SELECT banco
IF LASTKEY() = 9
   ON KEY LABEL ESCAPE
   DO loc_dlog with .t.
   ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
   m.banco = banco
   SELECT orcament
   SHOW GET m.banco
   RETURN .T.
ENDIF
IF m.banco = 0
   SELECT orcament
   RETURN .T.
ENDIF
IF SEEK(m.banco)
   SELECT orcament
   RETURN .T.
ENDIF
SELECT orcament
RETURN .F.


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RMO0LFR09           m.vlrfrete WHEN                    
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SCGC201,     Record Number:   75   
*        Variable:            m.vlrfrete                         
*        Called By:           WHEN Clause                        
*        Object Type:         Field                              
*        Snippet Number:      18                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _rmo0lfr09     &&  m.vlrfrete WHEN
#REGION 1
ON KEY LABEL ENTER
RETURN(isediting AND LSjanela = "SCGC201" AND m.natu_oper = 1)

*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RMO0LFR1J           m.pgto_frete WHEN                  
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SCGC201,     Record Number:   76   
*        Variable:            m.pgto_frete                       
*        Called By:           WHEN Clause                        
*        Object Type:         Radio Button                       
*        Snippet Number:      19                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _rmo0lfr1j     &&  m.pgto_frete WHEN
#REGION 1
IF isediting AND LSjanela = "SCGC201"  AND m.natu_oper = 1
	ON KEY LABEL ENTER  KEYBOARD "{RIGHTARROW}"
ENDIF
RETURN(isediting AND LSjanela = "SCGC201"  AND m.natu_oper = 1)

*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RMO0LFR2P           m.pgto_frete VALID                 
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SCGC201,     Record Number:   76   
*        Variable:            m.pgto_frete                       
*        Called By:           VALID Clause                       
*        Object Type:         Radio Button                       
*        Snippet Number:      20                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _rmo0lfr2p     &&  m.pgto_frete VALID
#REGION 1
IF LASTKEY() = 32
	_CUROBJ = 17
	RETURN(.T.)
ENDIF


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RMO0LFR44           m.vlrseguro WHEN                   
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SCGC201,     Record Number:   77   
*        Variable:            m.vlrseguro                        
*        Called By:           WHEN Clause                        
*        Object Type:         Field                              
*        Snippet Number:      21                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _rmo0lfr44     &&  m.vlrseguro WHEN
#REGION 1
ON KEY LABEL ENTER
RETURN(isediting AND LSjanela = "SCGC201"  AND m.natu_oper = 1)


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RMO0LFR56           m.vlrseguro VALID                  
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SCGC201,     Record Number:   77   
*        Variable:            m.vlrseguro                        
*        Called By:           VALID Clause                       
*        Object Type:         Field                              
*        Snippet Number:      22                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _rmo0lfr56     &&  m.vlrseguro VALID
#REGION 1
IF isediting AND LASTKEY() <> 5 AND LASTKEY() <> 19	
	HIDE WINDOW &LSjanela
	LSjanela = "SCGC201"
	SHOW WINDOW SCGC201 TOP
	_CUROBJ = LN_prxobj
ENDIF
RETURN(.T.)

*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RMO0LFR6T           m.operador VALID                   
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SCGC201,     Record Number:   78   
*        Variable:            m.operador                         
*        Called By:           VALID Clause                       
*        Object Type:         Field                              
*        Snippet Number:      23                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _rmo0lfr6t     &&  m.operador VALID
#REGION 1
SELECT usuario
SET ORDER TO TAG usuario
IF LASTKEY() = 9
   ON KEY LABEL ESCAPE
   DO loc_dlog WITH .T.
   ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
   IF LASTKEY =  27
		SELECT orcament
		RETURN .F.
	ENDIF
ELSE
	IF !SEEK(m.operador)
		SELECT orcament
		RETURN .F.
	ENDIF
ENDIF
SELECT orcament
m.nome_vend = usuario.nome
SHOW GET m.nome_vend
RETURN .T.


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RMO0LFRA2           m.valor VALID                      
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SCGC201,     Record Number:   82   
*        Variable:            m.valor                            
*        Called By:           VALID Clause                       
*        Object Type:         Field                              
*        Snippet Number:      24                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _rmo0lfra2     &&  m.valor VALID
#REGION 1
IF isediting AND LASTKEY() <> 5 AND LASTKEY() <> 19	
	HIDE WINDOW &LSjanela
	LSjanela = "SCGC201"
	SHOW WINDOW SCGC201 TOP
	_CUROBJ = LN_prxobj
ENDIF
RETURN(.T.)

*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RMO0LFRBO           m.VP_btn VALID                     
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SCGC201,     Record Number:   83   
*        Variable:            m.VP_btn                           
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      25                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _rmo0lfrbo     &&  m.VP_btn VALID
#REGION 1
		  	m.data = wp_dtoper
			m.hora = TIME()
			SHOW GET m.data
			SHOW GET m.hora
			m.natu_oper = 1
			m.motivo	= 1
			wl_cnta = .T.    && BUSCAR NUMERO DE COTACAO
			m.situacao = "A "
			m.empresa  = wp_empresa
			m.tab_cst  = wp_tabcst
*----> CLIENTE PADRAO
			m.cliente   = 0
			m.nome		=""
			m.tp_pessoa = 1
			m.estado	= empresa.estado
			m.inscricao = 'ISENTO'
			m.tp_inscr	= 4
			m.nome_inscr ="OUTROS"
			m.revendedor= "N"
	        m.endereco  = " "
			m.bairro	= " "
			m.cidade	= " "
			m.cep       = " "
			m.fone  	= " "
*----> OUTROS
			m.forma_pgto= 1
			m.tp_pgto	= 1
			m.vias_osi = 1
			m.vias_osi = 1
			DO OBJ_VDOR.SPR
			_CUROBJ = 1
			m.operador = wl_vendedor
			STORE 1 TO m.dd, m.md, m.td, m.idd, m.itd, m.ide, m.ite, ;
					   m.de, m.de, m.me, m.te, m.rdd, m.rtd, m.rde, m.rte, ;
					   m.rstp
   			VLnivnum = 0
			FOR VLnivnum = 1 TO 9  && reg os servid. fixos
			    VLnivstr = STR(VLnivnum,1)
                serv_&VLnivstr =  VTLservfx(VLnivnum)
                			&& Atrib. Serv. comissionados fixos
			ENDFOR	

**  BUSCA NUMERO DE ORCAMENTO
			SELECT empresa
			=REGLOCK(.T.)
			m.orcamento = orcamento   + 1
			m.juromes   = juromes
			REPLACE orcamento WITH m.orcamento
			UNLOCK
			SELECT orcament
***************************************************  SALVANDO
*->>>>>>>>>>>>>>>>> VERIFICA ALTERACOES EM CAMPOS QUE COMPROMETEM A
* 					LIBERACAO CASO TENHA OCORRIDO
			do ULprzmedio
			do ULclassifica
			=edithand('SAVE')
			=BTN_VAL1('ATUALIZAR', VLleitura, Vlcompara)
			=REGLOCK(.T.)
			DO ULitens
			SELECT orcament
			IF LASTKEY() = 27
				=REGLOCK()
				DELETE
				GO BOTT
			ENDIF
RETURN





*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RMO0LFRKJ           m.ap_btn VALID                     
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SCGC201,     Record Number:   84   
*        Variable:            m.ap_btn                           
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      26                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _rmo0lfrkj     &&  m.ap_btn VALID
#REGION 1
IF EOF() OR BOF()
   WAIT WINDOW C_ENDFILE NOWAIT
   RETURN
ENDIF

DO ULloc_orc WITH "A"

IF LASTKEY() = 27
	RETURN
ENDIF

IF m.valor = 0
	WAIT WINDOW "Orcamento com VALOR = 0. - Lance os Itens"
	RETURN
ENDIF

IF RIGHT(m.situacao,1) = "F"
	WAIT WINDOW "Orc.com cred. bloq..Nao aceita esta operacao."
	RETURN
ENDIF

IF !fox_alert(C_APROORCA)
   RETURN
ENDIF
IF !REGLOCK()
	WAIT WINDOW "Orcamento nao pode ser bloqueado para processo."
	RETURN
ENDIF

IF m.prazomedio > 0
	LSsit = "CD"
ELSE
	LSsit = "CE"
ENDIF

SELECT  orcatmp
SET ORDER TO TAG orcamento
LFflgtrans = .t.
************************************
=UPtransacao("INICIAR")
************************************
SEEK STR(wp_empresa,3)+LEFT(m.tipo,1)+STR(m.orcamento,6)
DO WHILE !eof() AND m.orcamento = orcamento AND wp_empresa = empresa ;
				AND LEFT(m.tipo,1) = LEFT(tipo,1)
   WAIT WINDOW "ITEM => "+STR(orcatmp.ordem,2) NOWAIT
   =REGLOCK(.T.)
   REPLACE situacao WITH LSsit
   SKIP
ENDDO
WAIT WINDOW " OK ! " NOWAIT

SELECT orcament
REPLACE situacao WITH LSsit
************************************
=UPtransacao("TERMINAR")
************************************
UNLOCK ALL
=BTN_VAL1('ATUALIZAR', VLleitura, Vlcompara)

RETURN


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RMO0LFRQ6           m.rm_btn VALID                     
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SCGC201,     Record Number:   85   
*        Variable:            m.rm_btn                           
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      27                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _rmo0lfrq6     &&  m.rm_btn VALID
#REGION 1
DO ULloc_orc WITH "CDd"

IF LASTKEY() = 27
	RETURN
ENDIF
IF m.valor = 0
	WAIT WINDOW "Orcamento com VALOR = 0. - Lance os Itens"
	RETURN
ENDIF
IF RIGHT(m.situacao,1) = "F"
	WAIT WINDOW "Orc.com cred. bloq..Nao aceita esta operacao."
	RETURN
ENDIF

IF !fox_alert('Confirma a Reserva de Mercadoria.' )
   RETURN
ENDIF

UNLOCK ALL
IF !UPtransacao("INICIAR")
	=UPtransacao("TERMINAR")
	=UPtransacao("ABORTAR")
    WAIT WINDOW "TRANS. NAO ATIVADA  <ENTER>"
	RETURN
ENDIF


IF !REGLOCK()
   WAIT WINDOW "Orcamento nao poder ser bloqueado para o processo."
   RETURN
ENDIF
SELECT  orcatmp
SET ORDER TO TAG orcamento
SEEK STR(wp_empresa,3)+LEFT(m.tipo,1)+STR(m.orcamento,6)
LFflgtrans = .t.
LFflgreser = .t.	&& ALTERAR STATUS P/ D=RESERVA
LFflgretod = .t.	&& IGNORA CONFIRMACOES POR ITEM
LFflgretod = fox_alert("Reservar todos ?")

DO WHILE !eof() AND m.orcamento = orcamento AND wp_empresa = empresa;
				AND LEFT(m.tipo,1) = LEFT(tipo,1)
   WAIT WINDOW "ITEM => "+STR(orcatmp.ordem,2) NOWAIT
   IF orcatmp.movestq = "S" AND LEFT(orcatmp.situacao,1) = 'C' && aprovado
	  wp_msg = 'Reservar => '+STR(orcatmp.qtde,5)+" "+;
		  		alltrim(orcatmp.codigo)+" "+orcatmp.descricao
	  IF LFflgretod OR fox_alert(wp_msg)
	      IF LOCA_SALDO()
    	     SELECT orcatmp
        	 IF REGLOCK()
                DO reserva
    	     ELSE
				LFflgtrans = .F.
				EXIT
	 		 ENDIF
    	  ELSE
			LFflgtrans = .F.
			EXIT
    	  ENDIF
      ENDIF
      SELECT  orcatmp
	  UNLOCK
   ENDIF
   SKIP
ENDDO
WAIT WINDOW " OK !" NOWAIT

SELE usuario
SET ORDER TO TAG usuario
SEEK  nUsr

SELECT orcament
IF LFflgtrans
	m.situacao 	= "D"+RIGHT(situacao,1)
	m.dt_res   	= wp_dtoper
	m.hora_res 	= time()
	m.tmp_de_res= usuario.temp_res
   	GATHER MEMVAR FIELDS situacao, dt_res, hora_res, tmp_de_res  MEMO
ENDIF
IF !UPtransacao("TERMINAR")
	=UPtransacao("TERMINAR")
	=UPtransacao("ABORTAR")
    WAIT WINDOW "TRANS. NAO DESATIVADA  <ENTER>"
ENDIF

UNLOCK ALL

=BTN_VAL1('ATUALIZAR', VLleitura, Vlcompara)
RETURN

			


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RMO0LFRY7           m.lib_btn VALID                    
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SCGC201,     Record Number:   86   
*        Variable:            m.lib_btn                          
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      28                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _rmo0lfry7     &&  m.lib_btn VALID
#REGION 1
DO ULloc_orc WITH "CDd"

IF LASTKEY() = 27
	RETURN
ENDIF
IF m.valor = 0
	WAIT WINDOW "Orcamento com VALOR = 0. - Lance os Itens"
	RETURN
ENDIF

SELE clientes
SET ORDER TO TAG cliente
SEEK m.cliente
IF !FOUND()
	WAIT WINDOW "Cliente deve ser Cadastrado . Execute <Cad> "
	SELE orcament
	RETURN
ENDIF
SELE orcament

SAVE SCREEN TO LStela
DEACTIVATE WINDOW SCGC201
DEACTIVATE WINDOW NAVEGA
DO OBJ_LIBE.spr
VLleitura = "STR(wp_empresa,3)"
                         * repassa chave de leitura p/ btn_val
VLlerfim  = "STR(wp_empresa+1,3)"
           * repassa chave de leitura p/ btn_val (POSICAO FINAL + 1 REG)

VLcompara = "orcament.empresa = wp_empresa"
                         * repassa chave de comparacao p/ btn_val

ACTIVATE WINDOW NAVEGA
ACTIVATE WINDOW SCGC201

RESTORE SCREEN FROM LStela
SELE ORCAMENT
UNLOCK ALL
=BTN_VAL1('ATUALIZAR', VLleitura, Vlcompara)
WP_RECORD = RECNO()
					


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RMO0LFS2D           m.osi_btn VALID                    
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SCGC201,     Record Number:   87   
*        Variable:            m.osi_btn                          
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      29                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _rmo0lfs2d     &&  m.osi_btn VALID
#REGION 1
PRIVATE LFalt_sit

LFalt_sit	= .f.  && INDICA A ULreg_osi se a sit ja pode ser alterada
LFind_imp 	= .f.  && INDICA se houve impr.de itens p/ que atualiza no vias
*--------------------------------------------------------------------*

DO ULloc_orc WITH "CDd"

IF LASTKEY() = 27 OR EOF()
	RETURN
ENDIF
IF m.valor = 0
	WAIT WINDOW "Orcamento com VALOR = 0. - Lance os Itens"
	RETURN
ENDIF

IF RIGHT(m.situacao,1) = "F"
	WAIT WINDOW "Orc.com cred. bloq..Nao aceita esta operacao."
	RETURN
ENDIF

SELE orcament
IF !REGLOCK()
   WAIT WINDOW "Orcamento nao poder ser bloqueado para o processo."
   UNLOCK ALL
   RETURN
ENDIF
***************  IMPRESSAO OSI  **********************
IF !(EMPTY(ALLTRIM(wp_imposi)))
	RUN &wp_imposi > \TMP\SAIDA.TXT
ENDIF
SET PRINTER TO &wp_prtosi

SELE clientes
SET ORDER TO TAG cliente

SELE transprt
SET ORDER TO TAG CGC
SELE orcatmp
SET ORDER TO TAG ORCAMENTO
SELE orcament
SET ORDER TO TAG ORCAMENTO
SET RELATION TO  STR(EMPRESA,3)+LEFT(TIPO,1)+STR(ORCAMENTO,6) INTO ORCATMP
SET RELATION TO  TRANSP INTO TRANSPRT ADDITIVE
SET RELATION TO  CLIENTE INTO CLIENTES ADDITIVE

SET SKIP TO ORCATMP
SET POINT TO ","
SET SEPARATOR  TO "."

LNreginicio = RECNO()
m.ordem = "A"
REPORT FORM relosi FOR  !(RIGHT(orcatmp.situacao,1) $ 'Oo') ;
				  WHILE orcament.orcamento = m.orcamento ;
				  AND orcament.empresa = wp_empresa NOCONSOLE TO PRINTER
GO LNreginicio
**********************************************************************

IF !(EMPTY(ALLTRIM(wp_impestq)))
	RUN &wp_impestq > \TMP\SAIDA.TXT
ENDIF
SET PRINTER TO &wp_prtestq

LFalt_sit	= .t.		&& inf. a ULreg_osi p/ alterar a sit. dos itens
m.ordem = "B"
REPORT FORM relosi FOR  !(RIGHT(orcatmp.situacao,1) $ 'Oo') ;
				   WHILE orcament.orcamento = m.orcamento ;
				   AND orcament.empresa = wp_empresa NOCONSOLE TO PRINTER

**********************************************************************
****  SO PARA FECHAR ARQUIVO P/ IMP
IF !(EMPTY(ALLTRIM(wp_imposi)))
	RUN &wp_imposi > \TMP\SAIDA.TXT
ENDIF
SET PRINTER TO &wp_prtosi

SET PRINTER TO SET('PRINTER',1)
SET RELATION TO
SET POINT TO
SET SEPARATOR  TO
**************                          ************************

SELECT orcament
GO LNreginicio
=REGLOCK()
IF RIGHT(orcament.situacao,1) $ "EO"
	REPLACE situacao with LEFT(orcament.situacao,1)+"O"
ELSE
	REPLACE situacao with LEFT(orcament.situacao,1)+"o"
ENDIF	
IF LFind_imp  && houve impressao da osi
	REPLACE vias_osi with orcament.vias_osi + 1
ENDIF
m.situacao = orcament.situacao
UNLOCK ALL
=BTN_VAL1('ATUALIZAR', VLleitura, Vlcompara)
RETURN



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RMO0LFSEW           m.fat_btn VALID                    
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SCGC201,     Record Number:   88   
*        Variable:            m.fat_btn                          
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      30                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
*****************************************************************
*****************************************************************
*****************************************************************

FUNCTION _rmo0lfsew     &&  m.fat_btn VALID
#REGION 1
DO ULloc_orc WITH "CDd"

IF LASTKEY() = 27
	RETURN
ENDIF
LNregistro = RECNO()

LSl = LEFT(m.situacao,1)
LSr = RIGHT(m.situacao,1)
IF m.valor = 0
	WAIT WINDOW "Orcamento com VALOR = 0. - Lance os Itens"
	RETURN
ENDIF
IF LSl $ "A")
	WAIT WINDOW "O orcamento nao foi aprovado. Execute <Aprova> "
	RETURN
ENDIF
IF  LSl $ "B"
	WAIT WINDOW "O orcamento Cancelado. "
	RETURN
ENDIF
IF  LSl $ "EF"
	WAIT WINDOW "O orcamento ja Faturado. "
	RETURN
ENDIF

IF  LSr $ "Do" AND m.prazomedio > 0
	WAIT WINDOW "O orcamento aguarda Liberacao. Execute <Lib.Credito> "
	RETURN
ENDIF
IF  LSr $ "F"
	WAIT WINDOW "O orcamento Com Credito Bloqueado. Execute <Lib.Credito> "
	RETURN
ENDIF

SELE clientes
SET ORDER TO TAG cliente
SEEK m.cliente
IF m.prazomedio > 0 AND (m.cliente = 0 OR !FOUND())
	WAIT WINDOW "Cliente deve ser Cadastrado . Execute <Cadastro> "
	SELE orcament
	RETURN
ENDIF
SELE orcament
IF LSr $ "E" AND  m.prazomedio >  0 AND ;
	(m.prazomedio > m.lim_prazo or ;
	 m.valor      > m.lim_libera or	;
	(m.lim_forma <> 0 and m.lim_forma <> m.forma_pgto))
	WAIT WINDOW ;
	"Orcamento nao atende condicao de Liberacao. Execute <Lib.Credito>"
	RETURN
 ENDIF


*================>>>> FICA BLOQUEADO ATE FTURAMENTO COMPLETAR .
*===============>>>>>  funciona como um sinaleiro
SELECT empresa
SELE empresa
SET ORDER TO TAG empresa
SEEK m.empresa				&& EMPRESA OPERADORA DO SISTEMA
IF !REGLOCK()
   WAIT WINDOW "Nao foi possivel bloquear reg. Empresa p/ parametros"
   SELE orcament
   RETURN
ENDIF
SELE orcament
GO LNregistro
IF !REGLOCK()
   WAIT WINDOW "Orcamento nao poder ser bloqueado para o processo."
   UNLOCK ALL
   RETURN
ENDIF
*********
LFretorno = .t.  && CASO SEJA CANCELADO VOLTA .F.
DO OBJ_FATU.SPR 		&& ULTIMAS INFORMACOES P/ FATURAMENTO

IF !LFretorno
    UNLOCK ALL
	SELE orcament
	RETURN
ENDIF
SELE orcament

GATHER MEMVAR FIELDS banco,agencia,transp, placa_tran, qtde_vol,;
					 espec_vol, numero, marca, pes_brt, pes_liq,;
		   			 vlrfrete, pgto_frete, vlrseguro
			
*********
SELECT  orcatmp
SET ORDER TO TAG orcamento
SEEK STR(wp_empresa,3)+LEFT(m.tipo,1)+STR(m.orcamento,6)
***> ((((( PREVIA )))

LNiteminicio = RECNO()
LFflgtrans = .t.
DO WHILE !eof() AND m.orcamento = orcamento AND wp_empresa = EMPRESA ;
				AND LEFT(m.tipo,1) = LEFT(tipo,1)
		IF orcatmp.movestq = "S"
		    IF !BAIXA_SALDO() OR !(LEFT(orcatmp.situacao,1) $ "DdC")
				LFflgtrans = .F.
				EXIT
			ENDIF
		ELSE
			IF !(LEFT(orcatmp.situacao,1) $ "DdC")
				LFflgtrans = .F.
				EXIT
			ENDIF
		ENDIF
		SELE orcatmp
		SKIP
ENDDO
IF !LFflgtrans
   WAIT WINDOW "Os itens apresentam irregularidades. Execute <RELINHAR>."
   SELE orcament
   UNLOCK ALL
   RETURN
ENDIF


*---->  POSICIONA ARQUIVOS RELACIONADOS
SELE empresa
SET ORDER TO TAG empresa
SEEK m.empresa

SELE tipooper
SET ORDER TO TAG tipo
SEEK 's'+m.tipo
IF !FOUND()
	SEEK 'S'+m.tipo
ENDIF
IF !FOUND()
   WAIT WINDOW "Nao foi possivel classificar a OPERACAO. PROCURE SUPORTE..."
   SELE orcament
   UNLOCK ALL
   RETURN
ENDIF

SELE tab_cita
SEEK empresa.estado+STR(tipooper.citacao,2)
m.serie 	=	"U"
m.referencia = 	m.orcamento
m.cgc_emit	= 	empresa.cgc
LTmp        =   "empresa.insc_"+empresa.estado
m.insc_emit	= 	&LTmp
m.insc_muni =	empresa.insc_munic
m.uf		=	m.estado
m.favorecido=	m.cliente
SELE clientes
SET ORDER TO TAG cliente
SEEK m.cliente
IF FOUND() AND m.cliente > 0
	m.nome		=	clientes.nome
	m.tp_pessoa = 	clientes.tp_pessoa
	m.endereco	=	clientes.endereco
	m.bairro	=	clientes.bairro
	m.cidade	=	clientes.cidade
	m.cep		=	clientes.cep
	m.fone		=	clientes.fone
	m.uf		=	clientes.estado
	m.tp_inscr	= 	clientes.tp_inscr
	m.inscricao	=	clientes.inscricao
ENDIF

m.inscsubst	= 	empresa.insc_&uf
m.aliq_iss	= 	empresa.aliq_iss
m.tmp_aliq_icms	= 	orcatmp.aliq_icms
m.natureza	=	tipooper.descnatu
m.cod_cita	=	tipooper.citacao
m.citacao 	= 	tab_cita.texto1
m.citacao1 	= 	tab_cita.texto2

SELECT  orcatmp
SET ORDER TO TAG orcamento
****  SEEK STR(wp_empresa,3)+LEFT(m.tipo,1)+STR(m.orcamento,6)
GO LNiteminicio

LNnfant = 0
m.nota = 0

SELECT empresa
m.datanf		=	wp_dtoper    && REGISTRA A DATA DA GERACAO DA NF
m.horanf		=	time()		 && REGISTRA A HORA
m.LNnfinicio   = nota + 1
m.LNnffim      = nota + 1
m.nota     = nota
m.doc_cobr = doc_cobr
SELE nota
SEEK STR(m.empresa,3)+STR(m.nota+1,6)
IF FOUND()
   WAIT WINDOW "No. Nota ja emitido."
   SELE orcament
   UNLOCK ALL
   RETURN
ENDIF
SELE orcatmp
LFflgtrans = .t.
************************************
IF 	!UPtransacao("INICIAR")
	UNLOCK ALL
	SELE ORCAMENT
	SCATTER MEMVAR MEMO
	SHOW GETS
	DO refresh
	WAIT WINDOW "TRANSACAO NAO PODE SER INICIADA. VER SUPORTE."
    UNLOCK ALL
	RETURN
ENDIF			
************************************
m.LNalqicms = 0		&& aliquota de icms

DO WHILE !eof() AND m.orcamento = orcamento AND wp_empresa = EMPRESA ;
				AND LEFT(m.tipo,1) = LEFT(tipo,1)
	*-----> BUSCA NUMERO DA NOTA FISCAL
	m.nota  = m.nota + 1
	SELE nota
	=ADIREG()
	*------>     REINICIALIZA VALORES ESPECIFICOS POR NOTA
     m.valor     = 0
	 m.LNbs_ipi  = 0         && base para calculo ipi
	 m.LNbs_icms = 0         && base para calculo icms
	 m.LNbs_subs = 0	     && base para calculo subs
	 m.LNbs_sbbrt= 0	     && base para abater icms do icms da subs
	 m.LNbs_iss  = 0        && base para calculo iss
	 m.LNbs_isen = 0        && mercadorias isentas
	 m.LNbs_outr = 0        && outras tributacoes
***	 m.LNalqicms = 0		&& aliquota de icms
	 m.LNalqiss  = 0		&& aliquota de iss
	 m.LNsubs 	 = 0		&& valor de icms por substituicao
	 m.LNicms 	 = 0		&& valor de icms
	 m.LNiss  	 = 0		&& valor de iss
	 m.LNtot  	 = 0		&& total da nota
	*----> PARA RESUMO ANEXO
	 m.LNpneus	 	= 0		&& venda de pneus p/ resumo anexo
	 m.LNcamaras 	= 0		&& venda de camaras p/ resumo anexo
	 m.LNrodas	  	= 0		&& venda de rodas p/ resumo anexo
	 m.LNacessorios = 0		&& venda de acessorios p/ resumo anexo
	 m.LNmatborrach	= 0		&& venda de mat.borracharia p/ resumo anexo
	 m.LNrecauchuta	= 0		&& venda de recauchutagem p/ resumo anexo
	 m.LNalinhament = 0		&& venda de alinhamento  p/ resumo anexo
	 m.LNbalanceame = 0		&& venda de balanceamento p/ resumo anexo
	 m.LNconserto  	= 0		&& venda de conserto p/ resumo anexo
	 m.LNoutras  	= 0
	*----------------------------
	LNctritens = 0
	SELECT  orcatmp
    DO WHILE !eof() AND m.orcamento = orcamento AND wp_empresa = empresa ;
					AND LEFT(m.tipo,1) = LEFT(tipo,1) AND LNctritens < 13
   		WAIT WINDOW "ITEM => "+STR(orcatmp.ordem,2) NOWAIT
		IF orcatmp.movestq = "S"
		    IF BAIXA_SALDO()
		    	SELECT orcatmp
				IF REGLOCK()
					DO UPimpostos     && APURA VALORES DA NOTA
					DO fatura
				ELSE
					LFflgtrans = .F.
					EXIT
				ENDIF
			ELSE
				LFflgtrans = .F.
				EXIT
			ENDIF
			SELECT  orcatmp
		ELSE
	    	SELECT orcatmp
			IF REGLOCK()
				DO UPimpostos     && APURA VALORES DA NOTA
				DO fatura
			ELSE
				LFflgtrans = .F.
				EXIT
			ENDIF
		ENDIF
		SELE orcatmp
		SKIP
		LNctritens = LNctritens + 1
	ENDDO
	IF !LFflgtrans
		EXIT
	ENDIF			
	SELE nota
	m.operacao = "S"		&& NOTA FISCAL DE SAIDA
	m.data = m.datanf
	m.hora = m.horanf
	m.status = 1
	m.aliq_icms	= 	LNalqicms
	m.vlr_ipi	=	LNbs_ipi
 	m.base_iss	=	LNbs_iss
	m.base_icms	=	LNbs_icms
	m.base_sbbrt= 	LNbs_sbbrt
	m.base_subs	=	LNbs_subs
	m.base_isent=	LNbs_isen
	m.base_outr	=	LNbs_outr
	m.icms_subs	=	LNsubs
	m.totservico=	LNbs_iss
	m.totproduto = m.valor - m.totservico
	m.total_nota=	m.valor + m.icms_subs + m.vlrfrete + m.vlrseguro + ;
					m.vlr_ipi
    GATHER MEMVAR MEMO
	SELE nf_anexo
	m.pneus			= LNpneus
	m.camaras		= LNcamaras
	m.rodas			= LNrodas
	m.acessorios    = LNacessorios
	m.matborrach	= LNmatborrach
	m.recauchuta	= LNrecauchuta
	m.alinhament	= LNalinhament
	m.balanceame	= LNbalanceame
	m.conserto		= LNconserto
   =edithand('SAVE')
	SELE orcatmp
	m.frete = 0    && valor apenas na primeira nota
	m.seguro =0    && valor apenas na primeira nota
ENDDO
WAIT WINDOW " OK ! " NOWAIT

IF !LFflgtrans   && OPERACAO ABORTADA POR FALHA NO PROCESSO
************************************
	IF 	!UPtransacao("ABORTAR")
		WAIT WINDOW "TRANSACAO NAO PODE SER DESFEITA. VER SUPORTE."
	ENDIF			
	UNLOCK ALL
	SELE ORCAMENT
	SCATTER MEMVAR MEMO
	SHOW GETS
	DO refresh
    UNLOCK ALL
	RETURN
ENDIF			
************

LVnumdup1  	= 0
LVvendup1	= ctod("  .  .  ")
LVvlrdup1	= 0

LVnumdup2  	= 0
LVvendup2	= ctod("  .  .  ")
LVvlrdup2	= 0

LVnumdup3  	= 0
LVvendup3	= ctod("  .  .  ")
LVvlrdup3	= 0

LVnumdup4  	= 0
LVvendup4	= ctod("  .  .  ")
LVvlrdup4	= 0

IF m.natu_oper = 1
	DO ULgeradupl
ENDIF
************
SELECT orcament
REPLACE situacao WITH "E"+RIGHT(situacao,1)
REPLACE nota     WITH m.LNnfinicio
REPLACE dt_fat WITH m.datanf
REPLACE	hora_fat WITH m.horanf

SELE empresa					&& altera parametros em empresa
m.doc_cobr = m.doc_cobr + 1
REPLACE nota     WITH m.nota
REPLACE doc_cobr WITH m.doc_cobr
SELECT orcament
************************************
IF 	!UPtransacao("TERMINAR")
	WAIT WINDOW "TRANSACAO PERMANECEU ABERTA. VER SUPORTE."
ENDIF			
***************  IMPRESSAO NOTA FISCAL  **********************
IF !(EMPTY(ALLTRIM(wp_impfat)))
	RUN &wp_impfat > \TMP\SAIDA.TXT
ENDIF
SET PRINTER TO &wp_prtfat

m.LNnffim      = m.nota
SELE transprt
SET ORDER TO TAG CGC
SELE orcatmp
SET ORDER TO TAG ITEMNOTA
SELE nota
SET ORDER TO TAG NOTA
SEEK STR(wp_empresa,3)+STR(m.LNnfinicio,6)
SET RELATION TO  STR(EMPRESA,3)+LEFT(TIPO,1)+STR(NOTA,6) INTO ORCATMP
SET RELATION TO  TRANSP INTO TRANSPRT ADDITIVE
SET SKIP TO ORCATMP
SET POINT TO ","
SET SEPARATOR  TO "."
REPORT FORM relnfs WHILE nota.nota <= m.LNnffim AND;
  			nota.empresa = wp_empresa NOCONSOLE TO PRINTER
SET PRINTER TO SET('PRINTER',1)
SET RELATION TO
SET POINT TO
SET SEPARATOR  TO
**************                          ************************
SELECT orcament
UNLOCK ALL
=BTN_VAL1('ATUALIZAR', VLleitura, Vlcompara)
RETURN

			


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RMO0LFTGR           m.cr_btn VALID                     
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SCGC201,     Record Number:   89   
*        Variable:            m.cr_btn                           
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      31                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _rmo0lftgr     &&  m.cr_btn VALID
#REGION 1
DO ULloc_orc WITH "Dd"

IF LASTKEY() = 27
	RETURN
ENDIF

IF !fox_alert('Confirma Cancelamento de Reserva ? ')
   RETURN
ENDIF

UNLOCK ALL
IF !UPtransacao("INICIAR")
	=UPtransacao("TERMINAR")
	=UPtransacao("ABORTAR")
    WAIT WINDOW "TRANS. NAO ATIVADA  <ENTER>"
	RETURN
ENDIF

IF !REGLOCK()
   WAIT WINDOW "Orcamento nao poder ser bloqueado para o processo."
   RETURN
ENDIF

SELECT  orcatmp
SET ORDER TO TAG orcamento
LFflgtrans = .t.
LFflgreser = .t.
LFflgretod = .t.	&& IGNORA CONFIRMACOES POR ITEM
LFflgretod = fox_alert("Cancelar Reservas de todos itens ?")

SEEK STR(wp_empresa,3)+LEFT(m.tipo,1)+STR(m.orcamento,6)
DO WHILE !eof() AND m.orcamento = orcamento AND wp_empresa = empresa ;
				AND LEFT(m.tipo,1) = LEFT(tipo,1)
   WAIT WINDOW "ITEM => "+STR(orcatmp.ordem,2) NOWAIT
   IF orcatmp.movestq = "S" AND LEFT(orcatmp.situacao,1) $ 'Dd' &&possui.res
	  wp_msg = 'Cacela Reserva de => '+STR(orcatmp.qtde,5)+" "+;
		  		alltrim(orcatmp.codigo)+" "+orcatmp.descricao
	  IF LFflgretod or fox_alert(wp_msg)
	      IF LOCA_SALDO()
    	     SELECT orcatmp
        	 IF REGLOCK()
            	DO reserva
	         ELSE
				LFflgtrans = .F.
				EXIT
	 		 ENDIF
    	  ELSE
			LFflgtrans = .F.
			EXIT
    	  ENDIF
	  ELSE
		  LFflgreser = .F.   && MANTER O ESTATUS DE RESERVA
	  ENDIF
      SELECT  orcatmp
   ENDIF
   SKIP
ENDDO
WAIT WINDOW " OK ! " NOWAIT

SELECT orcament
IF LFflgtrans AND  LFflgreser
	REPLACE situacao WITH "C"+RIGHT(situacao,1)
	REPLACE dt_res   WITH CTOD('  .  .  ')
	REPLACE hora_res WITH '        '
ELSE
	WAIT WINDOW "Processo NAO FOI concluido."
ENDIF
IF !UPtransacao("TERMINAR")
	=UPtransacao("TERMINAR")
	=UPtransacao("ABORTAR")
    WAIT WINDOW "TRANS. NAO DESATIVADA  <ENTER>"
ENDIF
UNLOCK ALL
=BTN_VAL1('ATUALIZAR', VLleitura, Vlcompara)
RETURN


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RMO0LFTNF           m.co_btn VALID                     
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SCGC201,     Record Number:   90   
*        Variable:            m.co_btn                           
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      32                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _rmo0lftnf     &&  m.co_btn VALID
#REGION 1
IF EOF() OR BOF()
   WAIT WINDOW C_ENDFILE NOWAIT
   RETURN
ENDIF

DO ULloc_orc WITH "AC"

IF LASTKEY() = 27
	RETURN
ENDIF
IF !fox_alert(C_CANCORCA)
   RETURN
ENDIF
IF !REGLOCK()
	WAIT WINDOW "Orcamento nao pode ser bloqueado para processo."
	RETURN
ENDIF
************************************
=UPtransacao("INICIAR")
************************************
SELECT  orcatmp
SET ORDER TO TAG orcamento
SEEK STR(wp_empresa,3)+LEFT(m.tipo,1)+STR(m.orcamento,6)
DO WHILE !EOF() AND m.orcamento = orcamento AND wp_empresa = empresa ;
				AND LEFT(m.tipo,1) = LEFT(tipo,1)
   =REGLOCK(.T.)
   REPLACE situacao WITH "B"+RIGHT(situacao,1)
   SKIP
ENDDO

SELECT orcament
REPLACE situacao WITH "B"+RIGHT(situacao,1)
************************************
=UPtransacao("TERMINAR")
************************************
UNLOCK ALL
=BTN_VAL1('ATUALIZAR', VLleitura, Vlcompara)

RETURN


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RMO0LFTRF           m.atva_btn VALID                   
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SCGC201,     Record Number:   91   
*        Variable:            m.atva_btn                         
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      33                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _rmo0lftrf     &&  m.atva_btn VALID
#REGION 1
IF !fox_alert('Confirma Solicitacao de Liberacao de Reservas ? ')
   RETURN
ENDIF
LNregant = RECNO()    && POSICAO DO ORCAMENTO ATUAL

SELE orcament
SET ORDER TO TAG situacao
SET NEAR ON
SEEK STR(wp_empresa,3)+"D"
SET NEAR OFF
IF !(LEFT(orcament.situacao,1) $ "Dd")
	WAIT WINDOW "Nao existem orcamentos com reserva...."
	GO LNregant
	RETURN
ENDIF

DO WHILE !EOF() AND wp_empresa = empresa ;
	            AND (LEFT(orcament.situacao,1) $ "Dd")
	IF !REGLOCK()
		SKIP
		LOOP
	ENDIF
	LNtmp = UPtempopas(dt_res, wp_dtoper, hora_res, TIME())
	IF LNtmp < orcament.tmp_de_res
		SKIP
		LOOP
	ENDIF
	SELECT  orcatmp
	SET ORDER TO TAG orcamento
	LFflgtrans = .t.
	************************************
	=UPtransacao("INICIAR")
	************************************
	SEEK STR(wp_empresa,3)+LEFT(m.tipo,1)+STR(m.orcamento,6)
	DO WHILE !eof() AND m.orcamento = orcamento AND wp_empresa = empresa ;
				AND LEFT(m.tipo,1) = LEFT(tipo,1)
	   IF orcatmp.movestq = "S" AND LEFT(orcatmp.situacao,1) $ 'Dd'
	   													 &&possui.res
	      IF LOCA_SALDO()
	         SELECT orcatmp
	         IF REGLOCK()
	            DO reserva
	         ELSE
				LFflgtrans = .F.
				EXIT
	 		 ENDIF
	      ELSE
			LFflgtrans = .F.
			EXIT
	      ENDIF
	      SELECT  orcatmp
	   ENDIF
	   SKIP
	ENDDO
	SELECT orcament
	IF LFflgtrans
		REPLACE situacao WITH "C"+RIGHT(situacao,1)
		REPLACE dt_res   WITH CTOD('  .  .  ')
		REPLACE hora_res WITH '        '
		************************************
		=UPtransacao("TERMINAR")
		************************************
	ELSE
		************************************
		=UPtransacao("ABORTAR")
		************************************
		WAIT WINDOW "Processo NAO FOI concluido."
	ENDIF
	SKIP
ENDDO
UNLOCK ALL
GO LNregant
SET ORDER TO TAG orcamento
UNLOCK ALL
=BTN_VAL1('ATUALIZAR', VLleitura, Vlcompara)
RETURN




*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RMO0LFTYA           m.tab_btn VALID                    
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SCGC201,     Record Number:   92   
*        Variable:            m.tab_btn                          
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      34                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _rmo0lftya     &&  m.tab_btn VALID
#REGION 1
SAVE SCREEN TO LStela
DEACTIVATE WINDOW SCGC201

   SELE preco
   SET ORDER TO TAG tabela
   SELECT saldo
   SET ORDER TO TAG clas_saldo
   SELECT grupo
   SET ORDER TO TAG classifica
   SET RELATION TO STR(wp_empresa,3)+STR(wp_tabela,3)+wp_serie+;
                            grupo.codigo INTO preco ADDITIVE
   SET RELATION TO STR(wp_empresa,3)+grupo.classifica+;
        STR(YEAR(wp_dtoper),4)+STR(MONTH(wp_dtoper),2) ;
        	INTO saldo ADDITIVE
*--------
    wl_tmp =  STRTRAN(STR(wp_empresa,3),' ','0')

*  antigo 	DO loc_dlog WITH .T.,;
		 " (('&wl_tmp' $ grupo.empresas OR grupo.tp_mercad = 7) AND ;
		   ('&wl_tmp' $ grupo.tab_preco )) OR grupo.cdg_tipo < 4"

	KEYBOARD "{CTRL-F10}"
 	DO loc_dlog WITH .T.,;
		 " (('&wl_tmp' $ grupo.empresas OR grupo.tp_mercad = 7) AND ;
		   ('&wl_tmp' $ grupo.tab_preco )) OR grupo.cdg_tipo < 4", ;
		   "", "B"
	SET RELATION TO

    SELECT orcament

ACTIVATE WINDOW SCGC201
RESTORE SCREEN FROM LStela

RETURN


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RMO0LFU37           m.item_btn VALID                   
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SCGC201,     Record Number:   93   
*        Variable:            m.item_btn                         
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      35                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _rmo0lfu37     &&  m.item_btn VALID
#REGION 1
DO ULitens


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RMO0LFU4G           m.oper_btn VALID                   
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SCGC201,     Record Number:   94   
*        Variable:            m.oper_btn                         
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      36                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _rmo0lfu4g     &&  m.oper_btn VALID
#REGION 1
DO OBJ_VDOR.SPR
RETURN


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RMO0LFU5S           m.cad_btn VALID                    
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SCGC201,     Record Number:   95   
*        Variable:            m.cad_btn                          
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      37                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _rmo0lfu5s     &&  m.cad_btn VALID
#REGION 1
SAVE SCREEN TO LStela
DEACTIVATE WINDOW SCGC201
DO SCGC200.SPR

*>> parametros repassados a btn_val
VLleitura = "STR(wp_empresa,3)"
                         * repassa chave de leitura p/ btn_val
VLlerfim  = "STR(wp_empresa+1,3)"
           * repassa chave de leitura p/ btn_val (POSICAO FINAL + 1 REG)

VLcompara = "orcament.empresa = wp_empresa"
                         * repassa chave de comparacao p/ btn_val
VLchvlimi = "STR(wp_empresa,3)"   && otimiza browse
**
ACTIVATE WINDOW SCGC201
RESTORE SCREEN FROM LStela
****----------
SELE clientes
SET ORDER TO TAG cliente
m.cliente = orcament.cliente
SEEK m.cliente
IF FOUND()
	SCATTER MEMVAR FIELDS tp_pessoa, cliente, nome, fone, estado,;
			 inscricao,tp_inscr, revendedor MEMO
	IF m.revendedor <> "S"
		m.revendedor = "N"
	ENDIF   		
	SELE orcament
	=REGLOCK()
   	GATHER MEMVAR FIELDS tp_pessoa, cliente, nome, fone, estado,;
			 inscricao,tp_inscr, revendedor MEMO
ENDIF
SELE orcament
UNLOCK ALL
ON KEY LABEL ESCAPE
SCATTER MEMVAR MEMO
SELE tab001
SEEK 'INS'+str(m.tp_inscr,1)
m.nome_inscr = tab001.descricao
WP_RECORD = RECNO()
m.cgccliente = str(m.cliente,14)
UNLOCK ALL
=BTN_VAL1('ATUALIZAR', VLleitura, Vlcompara)
RETURN



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RMO0LFUA9           m.nro_btn VALID                    
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SCGC201,     Record Number:   96   
*        Variable:            m.nro_btn                          
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      38                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
*****************************************************************
FUNCTION _rmo0lfua9     &&  m.nro_btn VALID
#REGION 1
SELECT empresa
SELE empresa
SET ORDER TO TAG empresa
SEEK m.empresa				&& EMPRESA OPERADORA DO SISTEMA
m.LNproxima     = nota + 1
wp_msg = "Proxima Nota Fiscal de Saida => "+STR(m.LNproxima,6)
DO OBJ_ALER.SPR WITH wp_msg
SELE orcament



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RMO0LFUC4           Read Level Activate                
*                                                                
*        Function Origin:                                        
*                                                                
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         Multiple Screens                   
*        Called By:           READ Statement                     
*        Snippet Number:      39                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _rmo0lfuc4     && Read Level Activate
*
* Activate Code from screen: SCGC201
*
#REGION 1
IF EMPTY(LSjanela)
* 	HIDE WINDOW SCGC201A, SCGC201B, SCGC201C
	LSjanela = "SCGC201"
ENDIF
RETURN(READACT())