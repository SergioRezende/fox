*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є 04/24/09             SCGC004.SPR               10:31:27 є
*       є                                                         є
*       ЗДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД¶
*       є                                                         є
*       є Author's Name                                           є
*       є                                                         є
*       є Copyright (c) 2009 Company Name                         є
*       є Address                                                 є
*       є City,     Zip                                           є
*       є                                                         є
*       є Description:                                            є
*       є This program was automatically generated by GENSCRN.    є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є          SCGC004/MS-DOS Setup Code - SECTION 1          є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1

*~ WIZARDSCREEN
#DEFINE C_DBFEMPTY		'Database is empty, add a record?'
#DEFINE C_DELREC		'Apagar Registro Selecionado ?'
#DEFINE C_ENDFILE		'Final do Arquivo.'
#DEFINE C_CANCTRF		'Confirma o Cancelamento da Devolucao ? '
#DEFINE C_APROTRF		'Confirma o Aprovacao da Devolucao ? '
*---------------------------------------------------------------------*
* ARQUIVOS UTILIZADOS :                                               *
*              - DUPLICAT
*              - ORCAMENT
*              - ORCATMP
*              - NOTAENT
*              - NOTAITE
*              - EMPRESA
*              - NOTA
*			   - NF_ANEXO
*              - ITEMMOV
*              - ITMANEXO
*              - SALDO
* OBJETIVOS : CANCELA IMPORTACAO DE FATURAMENTO DO SISTEMA ANTIGO
*	
*---------------------------------------------------------------------*
******>>>> INICIO CONTROLE AMBIENTAL
ON KEY LABEL ESCAPE
PRIVATE isediting,isadding,isreading
PRIVATE wp_record
PRIVATE isreadonly,is2table,wzalias
PRIVATE LS004areant
LS004areant	= ALLTRIM(ALIAS()) && PERMITE RETORNAR A AREA ANTER. A CHAMADA

m.wzalias	=	SELECT()
m.isediting	=	.F.
m.isadding	=	.F.
m.isreading =  	.F.
m.is2table 	= 	.F.
wp_flgfecha = 	.F. 		&& defaut nao fechamento da secao
WP_RECORD 	= 	0
wp_ref_local =  .T.     &&  POSSUI CONTROLE DE REFRESH LOCAL

LFdup004	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LForc004	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFout004	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFtmp004	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFemp004	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFtip004	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFtab004	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFpar004	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFnot004	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFanx004	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFcst004	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFsld004	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFite004	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFgru004	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFpre004	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFtra004	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LF001004	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFnfe004	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFnei004	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFmvx004	= 	.F.		&& .F. =>  ITMANEXO	DEVE SER FECHADA NA SAIDA
LFqe004		= 	.F.		&& .F. =>  qe	DEVE SER FECHADA NA SAIDA
LFgrp004		= 	.F.		&& .F. =>  qe	DEVE SER FECHADA NA SAIDA
LFrtb004		= 	.F.		&& .F. =>  qe	DEVE SER FECHADA NA SAIDA
LFrtm004		= 	.F.		&& .F. =>  qe	DEVE SER FECHADA NA SAIDA
LFci004		= 	.F.		&& .F. =>  qe	DEVE SER FECHADA NA SAIDA
LFpedido	=  .f.
LFpedite    =  .f.


********>>>>>> INTERESE LOCAL
wl_cota     = .f.
iscancela   = .f.
isitens     = .f.     && indica se houve edicao doas itens durante ed. orca.
PRIVATE LFsaida,LFentrada
STORE .F. TO LFsaida,LFentrada
	
******>>>> INICIO CONTROLE ARQUIVOS

*>> parametros repassados a btn_val


VLleitura = "" && OPERACOES DE REMESSA
                         * repassa chave de leitura p/ btn_val
VLlerfim  = ""  && 1o REG. DE OPERACOES DE REQUISICAO
           * repassa chave de leitura p/ btn_val (POSICAO FINAL + 1 REG)
VLcompara = ""
                         * repassa chave de comparacao p/ btn_val
VLchvlimi = ""  && otimiza browse
*******************************************************

IF !USED("duplicat")
	LFdup004	= .T.
	IF ! NetUse("duplicat")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("orcament")
	LForc004	= .T.
	IF ! NetUse("orcament")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("orcatmp")
	LFtmp004	= .T.
	IF ! NetUse("orcatmp")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("empresa")
	LFemp004	= .T.
	IF ! NetUse("empresa")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("nota")
	LFnot004	= .T.
	IF ! NetUse("nota")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("nf_anexo")
	LFanx004	= .T.
	IF ! NetUse("nf_anexo")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("itemmov")
	LFite004	= .T.
	IF ! NetUse("itemmov")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("itmanexo")
	LFmvx004	= .T.
	IF ! NetUse("itmanexo")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("notaite")
	LFnei004	= .T.
	IF ! NetUse("notaite")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("notaent")
	LFnfe004	= .T.
	IF ! NetUse("notaent")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("qe")
	LFqe004	= .T.
	IF ! NetUse("qe")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("saldo")
	LFsld004	= .T.
	IF ! NetUse("saldo")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("grupo")
	LFgrp004	= .T.
	IF ! NetUse("grupo")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("retornbc")
	LFrtb004	= .T.
	IF ! NetUse("retornbc")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("retornmv")
	LFrtm004	= .T.
	IF ! NetUse("retornmv")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("ci")
	LFci004	= .T.
	IF ! NetUse("ci")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("pedido")
	LFpedido = .T.
	IF ! NetUse("pedido")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF

IF !USED("pedite")
	LFpedite	= .T.
	IF ! NetUse("pedite")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF



IF wp_flgfecha
	DO ULfecha 		&& FECHA ARQUIVOS ABERTOS
	RETURN
ENDIF


#REGION 0
REGIONAL m.currarea, m.talkstat, m.compstat

IF SET("TALK") = "ON"
	SET TALK OFF
	m.talkstat = "ON"
ELSE
	m.talkstat = "OFF"
ENDIF
m.compstat = SET("COMPATIBLE")
SET COMPATIBLE FOXPLUS

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є                MS-DOS Window definitions                є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

IF NOT WEXIST("scgc004") ;
	OR UPPER(WTITLE("SCGC004")) == "SCGC004.PJX" ;
	OR UPPER(WTITLE("SCGC004")) == "SCGC004.SCX" ;
	OR UPPER(WTITLE("SCGC004")) == "SCGC004.MNX" ;
	OR UPPER(WTITLE("SCGC004")) == "SCGC004.PRG" ;
	OR UPPER(WTITLE("SCGC004")) == "SCGC004.FRX" ;
	OR UPPER(WTITLE("SCGC004")) == "SCGC004.QPR"
	DEFINE WINDOW scgc004 ;
		FROM INT((SROW()-18)/2),INT((SCOL()-70)/2) ;
		TO INT((SROW()-18)/2)+17,INT((SCOL()-70)/2)+69 ;
		TITLE "[ CANCELA IMPORTACAO - SIS.COBOL ]" ;
		FOOTER "[ 004 ]" ;
		FLOAT ;
		NOCLOSE ;
		SHADOW ;
		NOMINIMIZE ;
		NONE ;
		COLOR SCHEME 1
ENDIF


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є          SCGC004/MS-DOS Setup Code - SECTION 2          є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1
******>>>> INICIO CONTROLE LOCAL


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є              SCGC004/MS-DOS Screen Layout               є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1
IF WVISIBLE("scgc004")
	ACTIVATE WINDOW scgc004 SAME
ELSE
	ACTIVATE WINDOW scgc004 NOSHOW
ENDIF
@ 2,24 SAY "-" ;
	SIZE 1,1, 0
@ 2,9 SAY "Filial.:" ;
	SIZE 1,8, 0
@ 4,9 SAY "Cancelar a partir de" ;
	SIZE 1,20, 0
@ 0,0 TO 17,69 ;
	COLOR SCHEME 23
@ 0,24 SAY "[ Cancela Importacao ]" ;
	SIZE 1,22, 0
@ 0,63 SAY "[004]" ;
	SIZE 1,5, 0
@ 17,1 TO 17,68 ;
	COLOR SCHEME 24
@ 17,69 SAY "Щ" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,69 TO 16,69 ;
	COLOR SCHEME 24
@ 0,69 SAY "ї" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 14,4 TO 16,64 ;
	COLOR SCHEME 24
@ 16,5 TO 16,63 ;
	COLOR SCHEME 23
@ 16,64 SAY "Щ" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 15,64 SAY "і" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 14,64 SAY "ї" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 23
@ 1,4 TO 5,63 ;
	COLOR SCHEME 23
@ 5,5 TO 5,62 ;
	COLOR SCHEME 24
@ 2,63 TO 4,63 ;
	COLOR SCHEME 24
@ 5,63 SAY "Щ" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 1,63 SAY "ї" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 7,5 TO 12,62 ;
	COLOR SCHEME 23
@ 12,6 TO 12,61 ;
	COLOR SCHEME 24
@ 12,62 SAY "Щ" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 7,62 SAY "ї" ;
	SIZE 1,1, 0 ;
	COLOR SCHEME 24
@ 8,62 TO 11,62 ;
	COLOR SCHEME 24
@ 7,6 SAY "[ Opcoes de Cancelamento ]" ;
	SIZE 1,26, 0
@ 2,20 GET m.empresa ;
	SIZE 1,3 ;
	DEFAULT " " ;
	PICTURE "999" ;
	WHEN _2mx0mk2bj() ;
	VALID _2mx0mk2bk()
@ 2,25 GET m.nome_emp ;
	SIZE 1,20 ;
	DEFAULT " " ;
	PICTURE "@!K" ;
	WHEN _2mx0mk2bl()
@ 4,30 GET m.dt_inicio ;
	SIZE 1,10 ;
	DEFAULT {  /  /  } ;
	WHEN _2mx0mk2bm() ;
	VALID _2mx0mk2cw()
@ 4,44 GET m.dt_fim ;
	SIZE 1,10 ;
	DEFAULT {  /  /  } ;
	WHEN isediting ;
	VALID m.dt_fim >= m.dt_inicio ;
	MESSAGE "Data Final deve ser maior ou igual a Inicial"
@ 8,6 GET LFSaida ;
	PICTURE "@*C \<A-Cancela Importacao de Saidas/Carteira" ;
	SIZE 1,43 ;
	DEFAULT 0 ;
	WHEN _2mx0mk2cz()
@ 9,6 GET LFEntrada ;
	PICTURE "@*C \<B-Cancela Importacao de Entradas" ;
	SIZE 1,36 ;
	DEFAULT 0 ;
	WHEN _2mx0mk2d2()
@ 15,6 GET m.edit_btn ;
	PICTURE "@*HN \<Edita" ;
	SIZE 1,9,1 ;
	DEFAULT 1 ;
	WHEN _2mx0mk2d5() ;
	VALID btn_val1('EDIT') ;
	MESSAGE 'Permite a alteracao de dados do registro corrente'
@ 15,28 GET m.imp_btn ;
	PICTURE "@*HN \<Cancelar" ;
	SIZE 1,10,1 ;
	DEFAULT 1 ;
	VALID _2mx0mk2d8() ;
	DISABLE
@ 15,56 GET m.canc_btn ;
	PICTURE "@*HT \<Saida" ;
	SIZE 1,7,1 ;
	DEFAULT 1 ;
	WHEN _2mx0mk2dn() ;
	VALID _2mx0mk2dq()

IF NOT WVISIBLE("scgc004")
	ACTIVATE WINDOW scgc004
ENDIF


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є     MS-DOSREAD contains clauses from SCREEN scgc004     є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

READ CYCLE ;
	ACTIVATE READACT() ;
	DEACTIVATE READDEAC() ;
	NOLOCK

RELEASE WINDOW scgc004

#REGION 0
IF m.talkstat = "ON"
	SET TALK ON
ENDIF
IF m.compstat = "ON"
	SET COMPATIBLE ON
ENDIF


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є               SCGC004/MS-DOS Cleanup Code               є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1

DO ULfecha 		&& FECHA ARQUIVOS ABERTOS

RETURN

*********************************
*    P R O C E D I M E N T O S  *
*********************************


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є   SCGC004/MS-DOS Supporting Procedures and Functions    є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*

#REGION 1
PROCEDURE ULfecha
	IF LFdup004		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("duplicat")
	ENDIF
	IF LForc004		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("orcament")
	ENDIF
	IF LFtmp004		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("orcatmp")
	ENDIF
	IF LFemp004		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("empresa")
	ENDIF
	IF LFnot004		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("nota")
	ENDIF
	IF LFanx004		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("nf_anexo")
	ENDIF
	IF LFite004		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("itemmov")
	ENDIF
	IF LFmvx004		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("itmanexo")
	ENDIF
	IF LFnfe004		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("notaent")
	ENDIF
	IF LFnei004		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("notaite")
	ENDIF
	IF LFqe004		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("qe")
	ENDIF
	IF LFsld004		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("saldo")
	ENDIF
	IF LFgrp004		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("grupo")
	ENDIF
	IF LFrtb004		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("retornbc")
	ENDIF
	IF LFrtm004		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("retornmv")
	ENDIF
	IF LFci004		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("ci")
	ENDIF
	IF LFpedido		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("pedido")
	ENDIF
	IF LFpedite		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("pedite")
	ENDIF
	wp_flgfecha = .F. 		&& defaut nao fechamento da secao
	IF !EMPTY(LS004areant)
		SELECT &LS004areant
	ENDIF
	ON KEY LABEL ESCAPE
	SET FORMAT TO
	ON KEY LABEL CTRL-I
RETURN
*-------------->

PROCEDURE BTN_VAL1
	PARAMETER tecla, m.chv_ler, m.chv_compara, m.chv_brow
	LN_prxobj = _CUROBJ
	SHOW GET wp_empresa
	SHOW GET m.nome_emp
    DO CASE
		CASE tecla = "EDIT" AND !isediting   && INICIA EDICAO
			SHOW GET edit_btn,1 PROMPT "\<Ok"
			SHOW GET m.imp_btn DISABLE
			isediting = .t.
			_CUROBJ = 1	
		    ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
			ON KEY LABEL END DO BTN_VAL1 WITH 'DELETE'
		CASE tecla = "EDIT" AND isediting     && CONFIRMA EDICAO
			SHOW GET edit_btn,1 PROMPT "\<Edita"
			isediting = .f.
			_CUROBJ = 1	
			SHOW GET m.imp_btn ENABLE
		    ON KEY LABEL ESCAPE
			ON KEY LABEL END
		CASE tecla = "DELETE" AND isediting     && CANCELA EDICAO
			SHOW GET edit_btn,1 PROMPT "\<Edita"
			isediting = .f.
			_CUROBJ = 1	
			SHOW GET m.imp_btn DISABLE
		    ON KEY LABEL ESCAPE
			ON KEY LABEL END
	ENDCASE
RETURN



*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _2MX0MK2BJ           m.empresa WHEN                     є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC004,     Record Number:   28   є
*       є Variable:            m.empresa                          є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Field                              є
*       є Snippet Number:      1                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _2mx0mk2bj     &&  m.empresa WHEN
#REGION 1
ON KEY LABEL ESCAPE	KEYBOARD "{END}"
IF LASTKEY() = 15
	KEYBOARD "{ESCAPE}"
ENDIF
RETURN(isediting)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _2MX0MK2BK           m.empresa VALID                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC004,     Record Number:   28   є
*       є Variable:            m.empresa                          є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Field                              є
*       є Snippet Number:      2                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _2mx0mk2bk     &&  m.empresa VALID
#REGION 1
ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"

SELECT empresa
SET ORDER TO TAG empresa
IF LASTKEY() = 9
   ON KEY LABEL ESCAPE
   DO loc_dlog WITH .F.
   ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
   IF LASTKEY() = 27
		SELECT empresa
		RETURN .F.
	ENDIF
ELSE
	IF !SEEK(m.empresa)
		SELECT empresa
		RETURN .F.
	ENDIF
ENDIF
m.empresa   = empresa
m.nome_emp  = empresa.nome
SHOW GET m.empresa
SHOW GET m.nome_emp
SELECT empresa
RETURN .T.


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _2MX0MK2BL           m.nome_emp WHEN                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC004,     Record Number:   29   є
*       є Variable:            m.nome_emp                         є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Field                              є
*       є Snippet Number:      3                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _2mx0mk2bl     &&  m.nome_emp WHEN
#REGION 1
ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
RETURN(.F.)

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _2MX0MK2BM           m.dt_inicio WHEN                   є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC004,     Record Number:   30   є
*       є Variable:            m.dt_inicio                        є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Field                              є
*       є Snippet Number:      4                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _2mx0mk2bm     &&  m.dt_inicio WHEN
#REGION 1
IF isediting
	ON KEY LABEL ESCAPE	KEYBOARD "{END}"
ENDIF
RETURN(isediting)

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _2MX0MK2CW           m.dt_inicio VALID                  є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC004,     Record Number:   30   є
*       є Variable:            m.dt_inicio                        є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Field                              є
*       є Snippet Number:      5                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _2mx0mk2cw     &&  m.dt_inicio VALID
#REGION 1
m.dt_fim = m.dt_inicio
SHOW GET m.dt_fim
ON KEY LABEL ESCAPE KEYBOARD "{BACKTAB}"
RETURN (.T.)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _2MX0MK2CZ           LFSaida WHEN                       є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC004,     Record Number:   32   є
*       є Variable:            LFSaida                            є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Check Box                          є
*       є Snippet Number:      6                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _2mx0mk2cz     &&  LFSaida WHEN
#REGION 1
ON KEY LABEL ENTER  KEYBOARD "{RIGHTARROW}"
RETURN(isediting)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _2MX0MK2D2           LFEntrada WHEN                     є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC004,     Record Number:   33   є
*       є Variable:            LFEntrada                          є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Check Box                          є
*       є Snippet Number:      7                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _2mx0mk2d2     &&  LFEntrada WHEN
#REGION 1
ON KEY LABEL ENTER  KEYBOARD "{RIGHTARROW}"
RETURN(isediting)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _2MX0MK2D5           m.edit_btn WHEN                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC004,     Record Number:   34   є
*       є Variable:            m.edit_btn                         є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      8                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _2mx0mk2d5     &&  m.edit_btn WHEN
#REGION 1
ON KEY LABEL ENTER
RETURN(.T.)

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _2MX0MK2D8           m.imp_btn VALID                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC004,     Record Number:   35   є
*       є Variable:            m.imp_btn                          є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      9                                  є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _2mx0mk2d8     &&  m.imp_btn VALID
#REGION 1
	DO OBJ_ALERT.SPR WITH " ATENCAO !!! " +;
				" Voce Esta Solicitando  Cancelamento "+" Empresa... : "+;
				STR(m.empresa,3)+CHR(13)+" Periodo de : "+;
				DTOC(m.dt_inicio)+"-"+DTOC(m.dt_fim)+" <ENTER>"


	IF !fox_alert(" ATENCAO !!! " +;
				" Voce Confirma Cancelamento "+CHR(13)+CHR(13)+" Empresa... : "+;
				STR(m.empresa,3)+CHR(13)+" Periodo de : "+;
				DTOC(m.dt_inicio)+" a "+DTOC(m.dt_fim),.f.)
		RETURN
	ENDIF

	wp_msg = 'Autoriza CANCELAMENTO...(ATENCAO!!!)...'
	LNusuario = nUsr
	BTMP   =  'usuario.usuario = LNusuario '
	LNusr_ret = 0
	DO obj_prmt.SPR WITH   wp_msg , Btmp
	IF LNusr_ret =  0
	   WAIT WINDOW "Cancelamento nao Autorizado.....<ENTER>"
	   RETURN
	ENDIF


	LNwpempant = wp_empresa

	IF LFsaida
		=ULCobr_Canc((m.empresa),(m.dt_inicio),(m.dt_fim))
		=ULFatu_Canc((m.empresa),(m.dt_inicio),(m.dt_fim))
	ENDIF

	IF LFentrada
		=ULEntr_Canc((m.empresa),(m.dt_inicio),(m.dt_fim))
	ENDIF
	wp_empresa =  LNwpempant
	SHOW GET m.imp_btn DISABLE

RETURN

*-------------------------------------------------------------------*
FUNCTION ULCobr_Canc
	PARAMETERS empresa,dt_inicio,dt_fim
	PRIVATE LFretorno
	LFretorno = .t.	&& .t. => foram apagados todos os itens

	WAIT WINDOW "*>>>>>>   ELIMINANDO BORDEROS E BAIXAS >>>>>" NOWAIT

	SELE retornbc
	SET ORDER TO TAG dt_aviso
	SET NEAR ON
	SEEK  STR(m.empresa,3)+DTOS(m.dt_inicio)
	SET NEAR OFF
	DO WHILE !EOF() AND retornbc.empresa = m.empresa ;
					AND retornbc.dtaviso <= m.dt_fim
		IF CHRSAW()
			CLEAR TYPEAHEAD
			IF fox_alert("Deseja Abandonar  Processo ??? ")
				EXIT
			ENDIF
		ENDIF
		LSmsg = "Cancelando Emp.: "+STR(retornbc.empresa,3);
							+" NE: "+STR(retornbc.banco,3);
							+" DT: "+DTOC(retornbc.dtaviso)

		WAIT WINDOWS LSmsg NOWAIT
		*-----------------------------------------------------*
		=W_DEFPROC("DUPLICAT.SPR")
		=CRCancProcBaixa(retornbc.empresa,retornbc.banco,;
		  retornbc.carteira,retornbc.variacao,retornbc.aviso)
		*-----------------------------------------------------*

		SELE retornbc
		SCATTER MEMVAR MEMO
		IF m.status = "AP"
			SELECT  retornmv
			SET ORDER TO TAG aviso
			SEEK STR(m.empresa,3)+STR(m.banco,3)+;
			      m.carteira+m.variacao+STR(m.aviso,8)

			LFretorno = .t.	&& .t. => foram apagados todos os itens
		
			DO WHILE !EOF() AND retornbc.aviso   = retornmv.aviso AND ;
							retornbc.banco   = retornmv.banco AND ;
							retornbc.carteira  = retornmv.carteira AND ;
							retornbc.variacao = retornmv.variacao AND ;
							retornbc.empresa = retornmv.empresa

				IF !(retornmv.status $ "AP") && o processo nao foi cancelado
					LFretorno = .f.&& .f.=> nao foram del todos os itens
					EXIT
				ENDIF
				=REGLOCK(.T.)
				DELETE
				SKIP
			ENDDO
			SELECT retornbc
			SET ORDER TO TAG dt_aviso
			IF LFretorno
				=REGLOCK(.T.)
				DELETE
			ENDIF
		ENDIF
		SKIP
	ENDDO
RETURN(LFretorno)



FUNCTION ULFatu_Canc
	PARAMETERS LNemp,LDdt_inicio,LDdt_fim
	PRIVATE LFretorno
	LFretorno = .t.
	WAIT WINDOW "*>>>>>>>>>>>>>>>   ELIMINANDO NOTAS >>>>>" NOWAIT
	SELE nota
	SET ORDER TO TAG data
	SET NEAR ON
	SEEK STR(LNemp,3)+DTOS(LDdt_inicio)
	SET NEAR OFF
	DO WHILE !EOF() AND LNemp = nota.empresa ;
					AND nota.data <= LDdt_fim
		IF CHRSAW()
			CLEAR TYPEAHEAD
			IF fox_alert("Deseja Abandonar  Processo ??? ")
				EXIT
			ENDIF
		ENDIF
		LSmsg = "Cancelando Emp.: "+STR(nota.empresa,3);
							+" NF: "+STR(nota.nota,7);
							+" DT: "+DTOC(nota.data)

		WAIT WINDOWS LSmsg NOWAIT
		*---------------------------------------------------------*
		=W_DEFPROC("NOTA.SPR")
		LFretorno =  NFcancFatura((LNemp),nota.nota,"AUTOMATICO")
		IF LFretorno
			SELE orcament
			SET ORDER TO TAG GERAL
			SEEK STR(LNemp,3)+STR(nota.referencia,6)
			IF FOUND()			
				DO ULdelItOR WITH LNemp,nota.referencia,nota.tipo

				SELE orcament
				m.deletado= .t.
	    	    =REGLOCK(.T.)			&& P/ CONFIRMAR O BLOQUEIO PREVIO
									&& ESTAVAM ACONTECENDO ATTEMP TO LOCK
				GATHER MEMVAR MEMO
				DELETE
			ENDIF

			SELE nf_anexo
			SET ORDER TO TAG anexo
			SEEK STR(LNemp,3)+STR(nota.nota,7)
			IF FOUND()			
				=edithand('APAGA')
			ENDIF
			SELE nota
			SET ORDER TO TAG data
			=edithand('APAGA')
			SKIP
		ELSE
			EXIT
		ENDIF
	ENDDO


	*------------------------------------------------------------*
	* FECHANDO EXCLUSAO DE ORCAMENTOS
	*------------------------------------------------------------*

	SELE orcament
	SET ORDER TO TAG data_fat
	SET NEAR ON
	SEEK STR(LNemp,3)+DTOS(LDdt_inicio)
	SET NEAR OFF
	DO WHILE !EOF() AND LNemp = orcament.empresa ;
					AND orcament.dt_fat >= LDdt_inicio ;
					AND orcament.dt_fat <= LDdt_fim
					
		IF CHRSAW()
			CLEAR TYPEAHEAD
			IF fox_alert("Deseja Abandonar  Processo ??? ")
				EXIT
			ENDIF
		ENDIF
		LSmsg = "Excluindo Orcamento.: "+STR(orcament.orcamento,6)

		WAIT WINDOWS LSmsg NOWAIT
		*---------------------------------------------------------*
		=W_DEFPROC("NOTA.SPR")
		DO ULdelItOR WITH LNemp,orcament.orcamento,orcament.tipo
		SELE orcament
		m.deletado= .t.
   	    =REGLOCK(.T.)			&& P/ CONFIRMAR O BLOQUEIO PREVIO
									&& ESTAVAM ACONTECENDO ATTEMP TO LOCK
		GATHER MEMVAR MEMO
		DELETE
		SKIP
	ENDDO


RETURN(LFretorno)



PROCEDURE ULdelItOR
	PARAMETERS LNemp,LNosi,LStipo
	SELE orcatmp
	SET ORDER TO TAG orcamento
	SET NEAR ON
	IF "TIPO" $ KEY()
		SEEK STR(LNemp,3)+LEFT(LStipo,1)+STR(LNosi,6)
	ELSE
		SEEK STR(LNemp,3)+STR(LNosi,6)
	ENDIF
	SET NEAR OFF
	DO WHILE !EOF() AND LNemp = orcatmp.empresa ;
					AND LNosi = orcatmp.orcamento
			=edithand('APAGA')
		SKIP
	ENDDO
RETURN


*-----------------------------------------------------------------------*


FUNCTION ULEntr_Canc
	PARAMETERS LNemp,LDdt_inicio,LDdt_fim
	PRIVATE LFretorno

	WAIT WINDOW "*>>>>>>>>>>>>>>>   ELIMINANDO ITENS ENTRADA >>>>>" NOWAIT
	SELE notaent
	SET ORDER TO TAG rldtentr
	SET NEAR ON
	SEEK STR(LNemp,3)+DTOS(LDdt_inicio)
	SET NEAR OFF
	DO WHILE !EOF() AND LNemp = notaent.empresa ;
					AND notaent.data <= LDdt_fim

		IF CHRSAW()
			CLEAR TYPEAHEAD
			IF fox_alert("Deseja Abandonar  Processo ??? ")
				EXIT
			ENDIF
		ENDIF

		LSmsg = "Cancelando Emp.: "+STR(notaent.empresa,3);
							+" NE: "+STR(notaent.nota,6);
							+" DT: "+DTOC(notaent.data)

		WAIT WINDOWS LSmsg NOWAIT

		*----------------------------------------------------*
		* 		Cancelar Entrada registrada no Destino
		*----------------------------------------------------*
		=W_DEFPROC("NOTAENT.SPR")
		IF !NECanc_Entrada(notaent.empresa,notaent.referencia;
									,notaent.codforn)
		   	DO OBJ_MENS.SPR WITH ;
			   "Nao Foi Possivel Cancelar Entrada "+;
			   " no Destino. Tente Novamente."+;
			   "  Doc : "+notaent.tipo+"  "+str(notaent.nota,6)
		ENDIF
		SELE notaent
		SET ORDER TO TAG rldtentr
		SKIP
	ENDDO
	WAIT WINDOWS "OK !" NOWAIT							
RETURN(.T.)


*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _2MX0MK2DN           m.canc_btn WHEN                    є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC004,     Record Number:   36   є
*       є Variable:            m.canc_btn                         є
*       є Called By:           WHEN Clause                        є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      10                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _2mx0mk2dn     &&  m.canc_btn WHEN
#REGION 1
ON KEY LABEL ENTER
RETURN(.T.)

*       ЦДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДД·
*       є                                                         є
*       є _2MX0MK2DQ           m.canc_btn VALID                   є
*       є                                                         є
*       є Function Origin:                                        є
*       є                                                         є
*       є From Platform:       MS-DOS                             є
*       є From Screen:         SCGC004,     Record Number:   36   є
*       є Variable:            m.canc_btn                         є
*       є Called By:           VALID Clause                       є
*       є Object Type:         Push Button                        є
*       є Snippet Number:      11                                 є
*       є                                                         є
*       УДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДДЅ
*
FUNCTION _2mx0mk2dq     &&  m.canc_btn VALID
#REGION 1
CLEAR GETS
CLEAR READ
isediting = .f.
RETURN .T.