*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        08/24/96             SCGC208.SPR               09:46:10 
*                                                                
*       픔컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        Author's Name                                           
*                                                                
*        Copyright (c) 1996 Company Name                         
*        Address                                                 
*        City,     Zip                                           
*                                                                
*        Description:                                            
*        This program was automatically generated by GENSCRN.    
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                 SCGC208/MS-DOS Setup Code - SECTION 1          
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 1
*~ WIZARDSCREEN
#DEFINE C_DBFEMPTY		'Database is empty, add a record?'
#DEFINE C_DELREC		'Apagar Registro Selecionado ?'
#DEFINE C_ENDFILE		'Final do Arquivo.'
#DEFINE C_CANCTRF		'Confirma o Cancelamento da Requisicao? '
#DEFINE C_APROTRF		'Confirma o Aprovacao da Requisicao? '
*---------------------------------------------------------------------*
* ARQUIVOS UTILIZADOS :                                               *
*              - OUTROPER
*              - ORCATMP
*              - EMPRESA
*              - TIPOOPER
*              - TAB_CITA
*              - PARAMETR
*              - NOTA
*              - TAB_CST
*              - SALDO
*              - ITEMMOV
*	           - SERVIDOR
*	           - CENTROCUST
*	           - GRUPO       = > OBJ_ITOR
*	           - PRECO       = > OBJ_ITOR
* OBJETIVOS : REQUISICOES
*	
*---------------------------------------------------------------------*
******>>>> INICIO CONTROLE AMBIENTAL

ON KEY LABEL ESCAPE

PRIVATE isediting,isadding,isreading
PRIVATE wp_record
PRIVATE isreadonly,is2table,wzalias
PRIVATE LS208areant
LS208areant	= ALLTRIM(ALIAS()) && PERMITE RETORNAR A AREA ANTER. A CHAMADA

m.wzalias	=	SELECT()
m.isediting	=	.F.
m.isadding	=	.F.
m.isreading =   .F.
m.is2table 	= 	.F.
wp_flgfecha = 	.F. 		&& defaut nao fechamento da secao
WP_RECORD 	= 	0
wp_ref_local =  .T.     &&  POSSUI CONTROLE DE REFRESH LOCAL

LFout208	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFtmp208	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFemp208	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFtip208	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFtab208	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFpar208	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFnot208	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFcst208	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFsld208	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFite208	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFser208	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFcen208	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFgru208	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LFpre208	= 	.F.		&& .F. =>  DEVE SER FECHADA NA SAIDA
LF001208	=   .f.

********>>>>>> INTERESE LOCAL
wl_cota     = .f.
iscancela   = .f.
isitens     = .f.     && indica se houve edicao doas itens durante ed. orca.

******>>>> INICIO CONTROLE ARQUIVOS

*>> parametros repassados a btn_val

VLleitura = "STR(wp_empresa,3)+'Q'"  && OPERACOES DE TRANSFERENCIA
                         * repassa chave de leitura p/ btn_val
VLlerfim  = "STR(wp_empresa,3)+'R'"   && 1o REG. DE OPERACOES DE REMESSA
           * repassa chave de leitura p/ btn_val (POSICAO FINAL + 1 REG)

VLcompara = "outroper.empresa = wp_empresa AND LEFT(outroper.TIPO,1) = 'Q'"
                         * repassa chave de comparacao p/ btn_val
VLchvlimi = "STR(wp_empresa,3)+'Q'"  && Ootimiza browse
******>>>>>... PROCESSO DE TRANSACAO  (ARMAR ARQUIVOS P/ PROCESSO )
IF 	!UPtransacao("ARMAR","outroper.dbf") OR ;
	!UPtransacao("ARMAR","outroper.cdx") OR	;
	!UPtransacao("ARMAR","outroper.fpt") OR	;
	!UPtransacao("ARMAR","orcatmp.dbf") OR	;
	!UPtransacao("ARMAR","orcatmp.cdx") OR	;
	!UPtransacao("ARMAR","empresa.dbf") OR	;
	!UPtransacao("ARMAR","empresa.cdx") OR	;
	!UPtransacao("ARMAR","nota.dbf") OR	;
	!UPtransacao("ARMAR","nota.cdx") OR	;
	!UPtransacao("ARMAR","saldo.dbf") OR	;
	!UPtransacao("ARMAR","saldo.cdx") OR	;
	!UPtransacao("ARMAR","itemmov.dbf") OR	;
	!UPtransacao("ARMAR","itemmov.cdx")
	WAIT "NAO FOI POSSIVEL ATIVAR ARQUIVOS COM SEGURANCA.."
	DO ULdesativa   && DESATIVA ARQUIVO PARA TRANSACAO
	RETURN
ENDIF
*******************************************************
IF !USED("outroper")
	LFout208	= .T.
	IF ! NetUse("outroper")
		wp_flgfecha = .t.  && implica no 208mento da secao
	ENDIF
ENDIF
IF !USED("orcatmp")
	LFtmp208	= .T.
	IF ! NetUse("orcatmp")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("empresa")
	LFemp208	= .T.
	IF ! NetUse("empresa")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("tipooper")
	LFtip208	= .T.
	IF ! NetUse("tipooper")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("tab_cita")
	LFtab208	= .T.
	IF ! NetUse("tab_cita")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("parametr")
	LFpar208	= .T.
	IF ! NetUse("parametr")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("nota")
	LFnot208	= .T.
	IF ! NetUse("nota")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("tab_cst")
	LFcst208	= .T.
	IF ! NetUse("tab_cst")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("saldo")
	LFsld208	= .T.
	IF ! NetUse("saldo")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("itemmov")
	LFite208	= .T.
	IF ! NetUse("itemmov")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("servidor")
	LFser208	= .T.
	IF ! NetUse("servidor")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("centcust")
	LFcen208	= .T.
	IF ! NetUse("centcust")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("grupo")
	LFgru208	= .T.
	IF ! NetUse("grupo")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("tab001")
	LF001208	= .T.
	IF ! NetUse("tab001")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF !USED("preco")
	LFpre208	= .T.
	IF ! NetUse("preco")
		wp_flgfecha = .t.  && implica no fechamento da secao
	ENDIF
ENDIF
IF wp_flgfecha
	DO ULfecha 		&& FECHA ARQUIVOS ABERTOS
	DO ULdesativa   && DESATIVA ARQUIVO PARA TRANSACAO
	RETURN
ENDIF


#REGION 0
REGIONAL m.currarea, m.talkstat, m.compstat

IF SET("TALK") = "ON"
	SET TALK OFF
	m.talkstat = "ON"
ELSE
	m.talkstat = "OFF"
ENDIF
m.compstat = SET("COMPATIBLE")
SET COMPATIBLE FOXPLUS

*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                       MS-DOS Window definitions                
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

IF NOT WEXIST("scgc208") ;
	OR UPPER(WTITLE("SCGC208")) == "SCGC208.PJX" ;
	OR UPPER(WTITLE("SCGC208")) == "SCGC208.SCX" ;
	OR UPPER(WTITLE("SCGC208")) == "SCGC208.MNX" ;
	OR UPPER(WTITLE("SCGC208")) == "SCGC208.PRG" ;
	OR UPPER(WTITLE("SCGC208")) == "SCGC208.FRX" ;
	OR UPPER(WTITLE("SCGC208")) == "SCGC208.QPR"
	DEFINE WINDOW scgc208 ;
		FROM 2, 6 ;
		TO 19,70 ;
		TITLE "[ REQUISICOES ]" ;
		FOOTER "[208]" ;
		FLOAT ;
		NOCLOSE ;
		MINIMIZE ;
		COLOR SCHEME 1
ENDIF

IF NOT WEXIST("navega") ;
	OR UPPER(WTITLE("NAVEGA")) == "NAVEGA.PJX" ;
	OR UPPER(WTITLE("NAVEGA")) == "NAVEGA.SCX" ;
	OR UPPER(WTITLE("NAVEGA")) == "NAVEGA.MNX" ;
	OR UPPER(WTITLE("NAVEGA")) == "NAVEGA.PRG" ;
	OR UPPER(WTITLE("NAVEGA")) == "NAVEGA.FRX" ;
	OR UPPER(WTITLE("NAVEGA")) == "NAVEGA.QPR"
	DEFINE WINDOW navega ;
		FROM 20, 2 ;
		TO 22,74 ;
		NOFLOAT ;
		NOCLOSE ;
		SHADOW ;
		NOMINIMIZE ;
		COLOR SCHEME 1
ENDIF


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                 SCGC208/MS-DOS Setup Code - SECTION 2          
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 1
******>>>> INICIO CONTROLE LOCAL
DO CASE
	CASE !wp_flgfecha
		SELE empresa
		SET ORDER TO TAG empresa
		SEEK wp_empresa
		SELE outroper
		SET ORDER TO TAG orcamento
		SCATTER MEMVAR MEMO BLANK
		*-------------------------> criado pelo wizard
		m.wzalias=SELECT()
		m.isreadonly=IIF(ISREAD(),.T.,.F.)
		IF m.isreadonly
			WAIT WINDOW C_READONLY TIMEOUT 1
		ENDIF
		KEYBOARD "I"
		ON KEY LABEL CTRL-I DO ULitens
ENDCASE



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                     SCGC208/MS-DOS Screen Layout               
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 1
IF WVISIBLE("scgc208")
	ACTIVATE WINDOW scgc208 SAME
ELSE
	ACTIVATE WINDOW scgc208 NOSHOW
ENDIF
@ 11,38 TO 13,61
@ 13,0 TO 13,62
@ 0,61 SAY "h" ;
	SIZE 1,1, 0
@ 0,29 SAY "Emp.:" ;
	SIZE 1,5, 0
@ 0,52 SAY "-" ;
	SIZE 1,1, 0
@ 12,39 SAY "TOTAL.: " ;
	SIZE 1,8, 0
@ 1,0 TO 1,62
@ 13,38 SAY "" ;
	SIZE 1,1, 0
@ 13,61 SAY "" ;
	SIZE 1,1, 0
@ 0,0 SAY "Requisicao no." ;
	SIZE 1,14, 0
@ 2,0 SAY "Setor Requisitante:" ;
	SIZE 1,19, 0
@ 4,2 SAY "Motivo Requisicao.:" ;
	SIZE 1,19, 0
@ 2,28 SAY "-" ;
	SIZE 1,1, 0
@ 3,0 TO 8,62
@ 6,31 SAY " " ;
	SIZE 1,1, 0
@ 6,26 SAY "Requisitante :" ;
	SIZE 1,14, 0
@ 12,0 SAY "RESPONSAVEL:" ;
	SIZE 1,12, 0
@ 12,16 SAY "-" ;
	SIZE 1,1, 0
@ 11,0 SAY "Situacao...:" ;
	SIZE 1,12, 0
@ 11,16 SAY "-" ;
	SIZE 1,1, 0
@ 4,26 SAY "TIPO....:" ;
	SIZE 1,9, 0
@ 4,39 SAY "-" ;
	SIZE 1,1, 0
@ 0,15 GET m.orcamento ;
	SIZE 1,7 ;
	DEFAULT " " ;
	PICTURE "@K 999,999" ;
	WHEN isadding or isreading ;
	VALID _rd90kxx9o() ;
	ERROR wp_msg
@ 0,34 GET m.empresa ;
	SIZE 1,3 ;
	DEFAULT 0 ;
	PICTURE "999" ;
	WHEN .f.
@ 0,44 GET m.data ;
	SIZE 1,8 ;
	DEFAULT " " ;
	PICTURE "@K" ;
	WHEN _rd90kxxca()
@ 0,53 GET m.hora ;
	SIZE 1,8 ;
	DEFAULT " " ;
	PICTURE "@K XXXXXXXX" ;
	WHEN .f.
@ 2,20 GET m.centrocust ;
	SIZE 1,7 ;
	DEFAULT " " ;
	PICTURE "@R 99.99.99" ;
	WHEN isediting and !iscancela ;
	VALID _rd90kxxed()
@ 2,30 GET m.centdesc ;
	SIZE 1,32 ;
	DEFAULT " " ;
	PICTURE "@K XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX" ;
	WHEN isediting
@ 4,35 GET m.tipo ;
	SIZE 1,3 ;
	DEFAULT " " ;
	PICTURE "@!" ;
	WHEN isadding and m.motivo = 5 ;
	VALID _rd90kxxhn()
@ 4,41 GET m.natureza ;
	SIZE 1,19 ;
	DEFAULT " " ;
	WHEN .f.
@ 5,2 GET m.motivo ;
	PICTURE "@^ \<Mov.Interna de Mercadoria;Mat. de \<Uso em Servicos;Mat. de \<Consumo Interno ;Movimentacao \<Imobilizado;\<Informa TIPO" ;
	SIZE 3,17 ;
	DEFAULT "Mov.Interna de Mercadoria" ;
	WHEN isediting ;
	COLOR SCHEME 1, 2
@ 6,42 GET m.cliente ;
	SIZE 1,7 ;
	DEFAULT 0 ;
	PICTURE "999999" ;
	WHEN isediting and !iscancela ;
	VALID _rd90kxxl2()
@ 7,26 GET m.nome ;
	SIZE 1,29 ;
	DEFAULT " " ;
	PICTURE "@K XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX" ;
	WHEN m.cliente = 0 AND isediting and !iscancela
@ 9,2 EDIT m.obs ;
	SIZE 2,59,0 ;
	DEFAULT " " ;
	SCROLL ;
	WHEN isediting or iscancela
@ 11,14 GET m.situacao ;
	SIZE 1,2 ;
	DEFAULT " " ;
	WHEN .F.
@ 11,17 GET m.nome_sit ;
	SIZE 1,20 ;
	DEFAULT " " ;
	WHEN .f.
@ 12,12 GET m.operador ;
	SIZE 1,4 ;
	DEFAULT 0 ;
	PICTURE "9999" ;
	WHEN .f. ;
	ERROR "Banco nao Cadastrado no sistema"
@ 12,17 GET m.nome_vend ;
	SIZE 1,20 ;
	DEFAULT " " ;
	WHEN .F.
@ 12,48 GET m.valor ;
	SIZE 1,12 ;
	DEFAULT " " ;
	PICTURE "@K 9,999,999.99" ;
	WHEN .F.
@ 14,13 GET m.rm_btn ;
	PICTURE "@*HN \<1-Reserva" ;
	SIZE 1,11,1 ;
	DEFAULT 1 ;
	VALID _rd90kxxph() ;
	MESSAGE 'Processa Reserva de Mercadoria'
@ 14,38 GET m.cr_btn ;
	PICTURE "@*HN \<2-Canc.Rezerv" ;
	SIZE 1,15,1 ;
	DEFAULT 1 ;
	VALID _rd90kxxv7() ;
	MESSAGE 'Primeiro registro'
@ 15,2 GET m.fat_btn ;
	PICTURE "@*HN \<3-Processa" ;
	SIZE 1,12,1 ;
	DEFAULT 1 ;
	VALID _rd90kxy0q() ;
	MESSAGE 'Primeiro registro'
@ 15,22 GET m.cp_btn ;
	PICTURE "@*HN \<4-Canc.Processo" ;
	SIZE 1,20,1 ;
	DEFAULT 1 ;
	VALID _rd90kxydc() ;
	MESSAGE 'Primeiro registro'
@ 15,47 GET m.com_btn ;
	PICTURE "@*HN \<X-Historico" ;
	SIZE 1,14,1 ;
	DEFAULT 1 ;
	VALID _rd90kxyod() ;
	MESSAGE 'Primeiro registro'




*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                     OBJ_NAVE/MS-DOS Screen Layout              
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 2
IF WVISIBLE("navega")
	ACTIVATE WINDOW navega SAME
ELSE
	ACTIVATE WINDOW navega NOSHOW
ENDIF
@ 0,7 GET m.top_btn ;
	PICTURE "@*HN \<Inic" ;
	SIZE 1,6,1 ;
	DEFAULT 1 ;
	VALID BTN_VAL1('TOP', VLleitura, Vlcompara) ;
	MESSAGE 'Primeiro registro'
@ 0,13 GET m.prev_btn ;
	PICTURE "@*HN \<Ant" ;
	SIZE 1,5,1 ;
	DEFAULT 1 ;
	VALID btn_val1('PREV', VLleitura, Vlcompara) ;
	MESSAGE 'Posiciona no registro anterior.' 	
@ 0,18 GET m.next_btn ;
	PICTURE "@*HN \<Prox" ;
	SIZE 1,6,1 ;
	DEFAULT 1 ;
	VALID btn_val1('NEXT', VLleitura, Vlcompara) ;
	MESSAGE 'Avanca para proximo registro'
@ 0,24 GET m.end_btn ;
	PICTURE "@*HN \<Fim" ;
	SIZE 1,5,1 ;
	DEFAULT 1 ;
	VALID btn_val1('END', VLlerfim, Vlcompara) ;
	MESSAGE 'Ultimo registro do arquivo' 																																													
@ 0,29 GET m.loc_btn ;
	PICTURE "@*HN \<Zoom" ;
	SIZE 1,6,1 ;
	DEFAULT 1 ;
	VALID btn_val1('LOCATE', VLleitura, Vlcompara,VLchvlimi)		 ;
	MESSAGE 'Permite consulta visual ampliada a varios registros na tela'
@ 0,35 GET m.add_btn ;
	PICTURE "@*HN \<Lanca" ;
	SIZE 1,7,1 ;
	DEFAULT 1 ;
	VALID btn_val1('ADD') ;
	MESSAGE 'Abre novo registro para lancamento de dados' 
@ 0,49 GET m.edit_btn ;
	PICTURE "@*HN \<Edita" ;
	SIZE 1,7,1 ;
	DEFAULT 1 ;
	VALID btn_val1('EDIT') ;
	MESSAGE 'Permite a alteracao de dados do registro corrente'
@ 0,56 GET m.del_btn ;
	PICTURE "@*HN \<Delet" ;
	SIZE 1,7,1 ;
	DEFAULT 1 ;
	VALID btn_val1('DELETE', VLleitura, Vlcompara) ;
	MESSAGE 'Delete current record.'
@ 0,63 GET m.exit_btn ;
	PICTURE "@*HN \<Sai" ;
	SIZE 1,5,1 ;
	DEFAULT 1 ;
	VALID btn_val1('EXIT') ;
	MESSAGE 'Close screen.'
@ 0,42 GET m.cop_btn ;
	PICTURE "@*HN \<Copia" ;
	SIZE 1,7,1 ;
	DEFAULT 1 ;
	VALID btn_val1('COPY') ;
	MESSAGE 'Abre novo registro sel limpar os dados do reg corrente' 
@ 0,0 GET m.busca_btn ;
	PICTURE "@*HN \<Busca" ;
	SIZE 1,7,1 ;
	DEFAULT 1 ;
	VALID BTN_VAL1('BUSCA') ;
	MESSAGE 'Busca dirata pela chave do documento.'
@ 0,68 GET m.imp_btn ;
	PICTURE "@*HN \<M" ;
	SIZE 1,3,1 ;
	DEFAULT 1 ;
	VALID btn_val1('PRINT') ;
	MESSAGE 'Close screen.'

IF NOT WVISIBLE("navega")
	ACTIVATE WINDOW navega
ENDIF
IF NOT WVISIBLE("scgc208")
	ACTIVATE WINDOW scgc208
ENDIF



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*            MS-DOSREAD contains clauses from SCREEN scgc208     
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

READ CYCLE ;
	ACTIVATE READACT() ;
	DEACTIVATE READDEAC() ;
	NOLOCK

RELEASE WINDOW navega
RELEASE WINDOW scgc208

#REGION 0
IF m.talkstat = "ON"
	SET TALK ON
ENDIF
IF m.compstat = "ON"
	SET COMPATIBLE ON
ENDIF


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*                      SCGC208/MS-DOS Cleanup Code               
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 1
DO ULfecha 		&& FECHA ARQUIVOS ABERTOS
DO ULdesativa   && DESATIVA ARQUIVO PARA TRANSACAO
RETURN

*********************************
*    P R O C E D I M E N T O S  *
*********************************


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*          SCGC208/MS-DOS Supporting Procedures and Functions    
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

#REGION 1
PROCEDURE ULfecha
	IF LFout208		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("outroper")
	ENDIF
	IF LFtmp208		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("orcatmp")
	ENDIF
	IF LFemp208		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("empresa")
	ENDIF
	IF LFtip208		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("tipooper")
	ENDIF
	IF LFtab208		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("tab_cita")
	ENDIF
	IF LFpar208		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("parametr")
	ENDIF
	IF LFnot208		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("nota")
	ENDIF
	IF LFcst208		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("tab_cst")
	ENDIF
	IF LFsld208		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("saldo")
	ENDIF
	IF LFite208		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("itemmov")
	ENDIF
	IF LFser208		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("servidor")
	ENDIF
	IF LFcen208		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("centcust")
	ENDIF
	IF LFgru208		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("grupo")
	ENDIF
	IF LFpre208		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("preco")
	ENDIF
	IF LF001208		&& .t. =>  DEVE SER FECHADA NA SAIDA
		=UP_fecha("tab001")
	ENDIF
*******************************************************
	wp_flgfecha = .F. 		&& defaut nao fechamento da secao
	IF !EMPTY(LS208areant)
		SELECT &LS208areant
	ENDIF
	ON KEY LABEL ESCAPE
	SET FORMAT TO
	ON KEY LABEL CTRL-I
RETURN
******>>>>>... PROCESSO DE TRANSACAO  (DESARMAR ARQUIVOS P/ PROCESSO )
PROCEDURE ULdesativa
	=UPtransacao("DESARMAR","outroper.dbf")
	=UPtransacao("DESARMAR","outroper.cdx")
	=UPtransacao("DESARMAR","outroper.fpt")
	=UPtransacao("DESARMAR","orcatmp.dbf")
	=UPtransacao("DESARMAR","orcatmp.cdx")
	=UPtransacao("DESARMAR","empresa.dbf")
	=UPtransacao("DESARMAR","empresa.cdx")
	=UPtransacao("DESARMAR","nota.dbf")
	=UPtransacao("DESARMAR","nota.cdx")
	=UPtransacao("DESARMAR","saldo.dbf")
	=UPtransacao("DESARMAR","saldo.cdx")
	=UPtransacao("DESARMAR","itemmov.dbf")
	=UPtransacao("DESARMAR","itemmov.cdx")
RETURN
*-------------->
PROCEDURE ULitens
**-*-----*-*--*-*-*-*-*-*-*-*>> TALVEZ ABRA TRANZACAO
	IF isediting
		WAIT WINDOW "Conclua a Edicao p/ ativar os itens."	
 		RETURN
	ENDIF
	SELE tipooper
	IF m.motivo = 5
		SET ORDER TO TAG tipo
		SEEK 's'+m.tipo         &&  TIPO FOI INFORMADO DIRETAMENTE
	ELSE
		SET ORDER TO TAG tpopera
		SEEK 'S'+m.ch_opera+m.ch_produ+m.ch_motiv+;
					m.ch_desti+m.ch_contr+m.ch_condi
	ENDIF
	DO obj_itor.spr
	SELE outroper
	IF outroper.valor <> m.valor
		=REGLOCK()
		REPLACE valor with m.valor
	ENDIF
	UNLOCK
	SHOW GET m.valor
*-*-*-----*-*--*-*-*-*-*-*-*-*>> TALVEZ FECHE TRANZACAO
RETURN

*-------------->
PROCEDURE BTN_VAL1
	PARAMETER tecla, m.chv_ler, m.chv_compara, m.chv_brow

	SELE outroper
    DO CASE
		CASE tecla = "ADD"
		    do btn_val with tecla, m.chv_ler, m.chv_compara, m.chv_brow
			wl_cota = .T.    && BUSCAR NUMERO DE TRANSFERENCIA
			m.situacao = "A "
			m.empresa  = wp_empresa
			m.operador =   nUsr
			SHOW GET m.situacao
			SHOW GET m.empresa
			SHOW GET m.operador
			ON KEY LABEL ESCAPE do btn_val1 with 'DELETE', VLleitura, ;
												 Vlcompara
			RETURN .T.
		CASE tecla = "EDIT" AND isediting  && SALVANDO

*-*-*-*-*-*-*-*-*-*-* INICIA TRANZACAO
			do ULclassifica
            do ULcompara
		    do btn_val with tecla, m.chv_ler, m.chv_compara, m.chv_brow
			iscancela = .F.
*-*-*-*-*-*-*-*-*-*-* FIM TRANZACAO

		CASE tecla = "EDIT"
		    do btn_val with tecla, m.chv_ler, m.chv_compara, m.chv_brow
			iscancela = .F.
        CASE tecla = "DELETE"
			IF isediting     && .T. => CANCELA A EDICAO
*-*-*-*-*-*-*-*-*-*-* INICIA TRANZACAO
			    DO btn_val with tecla, m.chv_ler, m.chv_compara, m.chv_brow
*-*-*-*-*-*-*-*-*-*-* FIM TRANZACAO
			   	iscancela = .F.
			   	RETURN
			ENDIF
*	*	*	*	*	*	*	* APAGA REGISTROS RELACIONADOS			
			IF EOF() OR BOF()
			   WAIT WINDOW C_ENDFILE NOWAIT
			   RETURN
			ENDIF
			IF !fox_alert(C_DELREC)
			   RETURN
			ENDIF
*-*-*-**-*-*-*-*-*-*-*-*--*> INICIA TRANZACAO
			SELECT  orcatmp
			SET ORDER TO TAG orcamento
			SEEK STR(wp_empresa,3)+LEFT(m.tipo,1)+STR(m.orcamento,6)
			DO WHILE !EOF() AND m.orcamento = orcamento ;
							AND wp_empresa = empresa ;
							AND LEFT(m.tipo,1) = LEFT(tipo,1)
			   DELETE
			   SKIP
			ENDDO
			SELECT outroper
		    do btn_val with tecla, m.chv_ler, m.chv_compara, m.chv_brow
*-*-*-**-*-*-*-*-*-*-*-*--*> FIM TRANZACAO

			RETURN .T.
		OTHERWISE
		    do btn_val with tecla, m.chv_ler, m.chv_compara, m.chv_brow

	ENDCASE		
	SELE TAB001
	SEEK "ST1"+LEFT(m.situacao,1)
	m.nome_sit = RTRIM(tab001.descricao)
	SEEK "ST2"+RIGHT(m.situacao,1)
	m.nome_sit = m.nome_sit+" "+RTRIM(tab001.descricao)
	SHOW GET m.nome_sit

	SELE usuario
	SET ORDER TO TAG usuario
	SEEK m.operador
	m.nome_vend = usuario.nome
	SHOW GET m.nome_vend
	SELE tipooper
	IF m.motivo = 5
		SET ORDER TO TAG tipo
		SEEK 's'+m.tipo         &&  TIPO FOI INFORMADO DIRETAMENTE
	ELSE
		SET ORDER TO TAG tpopera
		SEEK 'S'+m.ch_opera+m.ch_produ+m.ch_motiv+;
				m.ch_desti+m.ch_contr+m.ch_condi
	ENDIF
    m.natureza = tipooper.descnatu
    SHOW GET m.natureza

	SELE outroper


RETURN
*------------>

PROCEDURE ULcompara

	SELECT  orcatmp
	SET ORDER TO TAG orcamento
	SEEK STR(wp_empresa,3)+LEFT(m.tipo,1)+STR(m.orcamento,6)
	IF !FOUND()
		SELECT outroper
		RETURN
	ENDIF
    IF 	m.cliente <> favorecido or  isitens or;
    	m.ch_opera <> ch_opera or m.ch_produ <> ch_produ or;
    	m.ch_motiv <> ch_motiv or m.ch_desti <> ch_desti or;
    	m.ch_contr <> ch_contr or m.ch_condi <> ch_condi
        WAIT WINDOW "Os itens serao reprocessados."
		m.valor = 0
		DO WHILE !EOF() AND m.orcamento = orcamento ;
						AND wp_empresa = empresa ;
						AND LEFT(m.tipo,1) = LEFT(tipo,1)
			=REGLOCK()
		   	GATHER MEMVAR FIELDS  ch_opera, ch_produ, ;
		   			ch_motiv, ch_desti, ch_contr, ch_condi MEMO
	       	REPLACE vlrvenda WITH ;
	          ((PRECO - (PRECO * DESCONTO / 100)) * QTDE) + ;
			  ((PRECO - (PRECO * DESCONTO / 100)) * QTDE) * TAXA / 100
	       	REPLACE favorecido WITH m.cliente

			REPLACE orcatmp.movestq    WITH  tipooper.movestq
			REPLACE orcatmp.tipo       WITH  tipooper.tipo
			REPLACE orcatmp.cfo        WITH  tipooper.cfo
			REPLACE orcatmp.aliq_icms  WITH  tipooper.aliq_icms
			REPLACE orcatmp.info_vlr   WITH  tipooper.info_vlr

			SELECT orcatmp
			DO ULapuravlr
			SKIP
		ENDDO
		isitens = .f.
    ENDIF
	SELECT outroper
RETURN
*------------->
PROCEDURE ULapuravlr
        m.valor = m.valor + vlrvenda

RETURN
*------------->
PROCEDURE ULclassifica
	DO CASE
		CASE m.motivo = 5
			SELECT tipooper
			SET ORDER TO TAG tipo
			SEEK 's'+m.tipo
		    SCATTER FIELDS ch_opera, ch_produ, ch_motiv, ch_desti,;
		    		 ch_contr, ch_condi
		OTHERWISE
			STORE "5"     TO m.ch_opera  && 5=REQUISICAO
			STORE "5"     TO m.ch_contr  && 5=CONTR. NULO SEM EFEITO OPERA
			STORE "3"	  TO m.ch_condi  && 3=CONDICAO NULA SEM EFEITO OPER.
			STORE "1"     TO m.ch_motiv  && 1=NORMAL
			m.ch_desti = "1"   && ESTADUAL
		
			IF m.motivo = 1
			   STORE "1"  TO m.ch_produ    && 1=MERCADORIAS
		    ELSE
				IF m.motivo = 2
				   STORE "5"  TO m.ch_produ    && 5=MAT.DE USO EM SERVICO
				ELSE
					IF m.motivo = 3
					   STORE "6"  TO m.ch_produ    && 6= MAT CONSUMO INTERNO
					ELSE
					   STORE "2"  TO m.ch_produ    && 2= IMOBILIZADO
					ENDIF
				ENDIF
			ENDIF
			
			SELECT tipooper
			SEEK 'S'+m.ch_opera+m.ch_produ+m.ch_motiv+;
					m.ch_desti+m.ch_contr+m.ch_condi
	ENDCASE
	IF !FOUND()
	   WAIT WINDOW;
	    "Nao foi possivel classificar a OPERACAO. PROCURE SUPORTE..."
		m.tipo = "   "
		m.cfo  = "    "
	ELSE
		m.tipo = tipo
		m.cfo  = cfo
	ENDIF
	SELE outroper
	
RETURN

*------------->
PROCEDURE local_refresh
PARAMETERS wl_branco

DO CASE
   CASE isediting or wl_branco
	  SHOW GET ct_btn   DISABLE
	  SHOW GET ap_btn   DISABLE
      SHOW GET rm_btn   DISABLE
	  SHOW GET cr_btn   DISABLE
	  SHOW GET lib_btn  DISABLE
	  SHOW GET osi_btn  DISABLE
	  SHOW GET fat_btn  DISABLE
	  SHOW GET com_btn DISABLE
	OTHERWISE
	  LSl = LEFT(m.situacao,1)
	  LSr = RIGHT(m.situacao,1)
	  IF !(LSl $ "A") or (LSl $ "B")	
	      SHOW GET rc_btn  DISABLE
		  SHOW GET ap_btn   DISABLE
	  ENDIF
	  IF !(LSl $ "AC")	or (LSl $ "B")
	  	  SHOW GET ct_btn   DISABLE
	  ENDIF
	  IF !(LSl $ "CDd") or (LSl $ "B")
		  SHOW GET rm_btn   DISABLE
	  ENDIF
	  IF !(LSl $ "Dd") or (LSl $ "B")
		  SHOW GET cr_btn   DISABLE
	  ENDIF
	  IF (LSl $ "ABDdEF")
		  SHOW GET lib_btn  DISABLE
	  ENDIF
	  IF !(LSl $ "CD") OR LSr $ "DF"
		  SHOW GET osi_btn  DISABLE
		  SHOW GET fat_btn  DISABLE
	  ENDIF
********************************** DESABILITACAO POR LIMITACAO DO USR
	  IF "1" $ LSaces			&& RETORNAR CONTATO
			SHOW GET ct_btn   DISABLE
	  ENDIF
	  IF "2" $ LSaces			&& CANCELAR ORCAMENTO
			SHOW GET ap_btn   DISABLE
	  ENDIF
	  IF "3" $ LSaces			&& aprovar ORCAMENTO
			SHOW GET rm_btn   DISABLE
	  ENDIF
	  IF "4" $ LSaces			&& reserva
			SHOW GET cr_btn   DISABLE
	  ENDIF
	  IF "5" $ LSaces			&& CANCELAR ORCAMENTO
			SHOW GET lib_btn   DISABLE
	  ENDIF
	  IF "6" $ LSaces			&& libera ORCAMENTO
			SHOW GET osi_btn   DISABLE
	  ENDIF
	  IF "7" $ LSaces			&& libera ORCAMENTO
			SHOW GET fat_btn   DISABLE
	  ENDIF
	  IF "X" $ LSaces			&& historico comercial
			SHOW GET com_btn   DISABLE
	  ENDIF
	
	

ENDCASE
RETURN

*--------------

PROCEDURE LOCA_SALDO  && VERIFICA DISPONIBILIDADE DE SALDO

   SELECT saldo
   SET ORDER TO TAG clas_saldo
   SEEK STR(wp_empresa,3)+orcatmp.classifica+;
        STR(YEAR(wp_dtoper),4)+;
        STR(MONTH(wp_dtoper),2)
   IF !FOUND()
      WAIT WINDOW RTRIM(transform(orcatmp.codigo,'@R &masc_codi'))+;
                   " nao foi aberto para movimentacao. Solicite abertura."
      RETURN .F.
   ENDIF
   IF STATUS = 'F'
      WAIT WINDOW RTRIM(transform(orcatmp.codigo,'@R &masc_codi'))+;
                   " nao permite movimentacoes neste mes"
      RETURN .F.
   ENDIF
   IF orcatmp.qtde  = 0  	 && ITENS COM QTDE = 0 NAO SAO PROCESSADOS
      WAIT WINDOW RTRIM(transform(orcatmp.codigo,'@R &masc_codi'))+;
                   " tem QUANTIDADE =  0 "
      RETURN .F.
   ENDIF
   IF orcatmp.tp_mercad = 7  && SERVICO NAO NECESSITA SALDO
      RETURN .T.
   ENDIF
   DO CASE
		CASE LEFT(orcatmp.situacao,1) = 'C'  && VE SE E POSSIVEL FAZER RES
		   wl_real_saldo = saldo.sld_atu
		   wl_bloq_saldo = saldo.sld_atu -  saldo.reserva
		   IF orcatmp.qtde > wl_real_saldo
		      WAIT WINDOW RTRIM(transform(orcatmp.codigo,'@R &masc_codi'))+;
                   " nao possui saldo para atende-lo."
		      RETURN .F.
		   ENDIF
		   IF orcatmp.qtde > wl_bloq_saldo
		      WAIT WINDOW RTRIM(transform(orcatmp.codigo,'@R &masc_codi'))+;
                   " nao possui saldo para atende-lo devido a reservas."
		      RETURN .F.
		   ENDIF
		   IF !REGLOCK()
		      WAIT WINDOW RTRIM(transform(orcatmp.codigo,'@R &masc_codi'))+;
                   " nao pode ser bloqueado para efetivar reserva."
		      RETURN .F.
		   ENDIF
		OTHERWISE
		   IF orcatmp.qtde > saldo.reserva
		      WAIT WINDOW RTRIM(transform(orcatmp.codigo,'@R &masc_codi'))+;
                   " nao possui reserva suficiente p/ baixa. Problema!"
		      RETURN .F.
		   ENDIF
	ENDCASE		
RETURN .T.


PROCEDURE RESERVA
   IF orcatmp.tp_mercad = 7  && SERVICO NAO NECESSITA SALDO
      RETURN
   ENDIF
   IF orcatmp.qtde  = 0  	 && ITENS COM QTDE = 0 NAO SAO PROCESSADOS
      RETURN
   ENDIF

   SELECT orcatmp
   SCATTER MEMVAR MEMO
   IF LEFT(orcatmp.situacao,1) $ 'Dd'
      m.situacao = 'C'+RIGHT(m.situacao,1)
      m.operacao = 'ROCS'   && RESERVA/OUTRAS OPER/CANCELADA/COM RESERVA
   ELSE
      m.situacao = 'D'+RIGHT(m.situacao,1)
      m.operacao = 'ROPS'   && RESERVA/OUTRAS OPER/PROCESSADA/COM RESERVA
   ENDIF

   SELECT orcatmp
   GATHER MEMVAR MEMO

   SELECT itemmov
	m.data = wp_dtoper
	m.hora = time()
	m.sld_estq = 0
	m.vlr_estq = 0
   =edithand('SAVE')

	DO UPatu_cmd		&& ROTINA DE VERIFICACAO E ATUALIZACAO DO SALDO
						&& VAI DEVOLVER m.sld_atu e

RETURN

*************************>

PROCEDURE BAIXA_SALDO  && VERIFICA POSSIBILIDADE DE  BAIXA  NO ESTOQUE

   SELECT saldo
   SET ORDER TO TAG clas_saldo
   SEEK STR(wp_empresa,3)+orcatmp.classifica+;
        STR(YEAR(wp_dtoper),4)+;
        STR(MONTH(wp_dtoper),2)
   IF !FOUND()
      WAIT WINDOW RTRIM(transform(orcatmp.codigo,'@R &masc_codi'))+;
                   " nao foi aberto para movimentacao. Solicite abertura."
      RETURN .F.
   ENDIF
   IF STATUS = 'F'
      WAIT WINDOW RTRIM(transform(orcatmp.codigo,'@R &masc_codi'))+;
                   " nao permite movimentacoes neste mes"
      RETURN .F.
   ENDIF
   IF orcatmp.tp_mercad = 7  && SERVICO NAO NECESSITA SALDO
      RETURN .T.
   ENDIF
   IF orcatmp.qtde  = 0  	 && ITENS COM QTDE = 0 NAO SAO PROCESSADOS
      RETURN .T.
   ENDIF
   DO CASE
		CASE LEFT(orcatmp.situacao,1) <> 'D'  && FAT. SEM RESERV. PREVIA
		   wl_real_saldo = saldo.sld_atu
		   wl_bloq_saldo = saldo.sld_atu -  saldo.reserva
		   IF orcatmp.qtde > wl_real_saldo
		      WAIT WINDOW RTRIM(transform(orcatmp.codigo,'@R &masc_codi'))+;
                   " nao possui saldo para atende-lo."
		      RETURN .F.
		   ENDIF
		   IF orcatmp.qtde > wl_bloq_saldo
		      WAIT WINDOW RTRIM(transform(orcatmp.codigo,'@R &masc_codi'))+;
                   " nao possui saldo para atende-lo devido a reservas."
		      RETURN .F.
		   ENDIF
		   IF !REGLOCK()
		      WAIT WINDOW RTRIM(transform(orcatmp.codigo,'@R &masc_codi'))+;
                   " nao pode ser bloqueado para efetivar reserva."
		      RETURN .F.
		   ENDIF
		CASE LEFT(orcatmp.situacao,1) = 'D'  && FAT. SEM RESERV. PREVIA
		   IF orcatmp.qtde > saldo.reserva
		      WAIT WINDOW RTRIM(transform(orcatmp.codigo,'@R &masc_codi'))+;
                   " nao possui reserva suficiente p/ baixa. Problema!"
		      RETURN .F.
		   ENDIF
	ENDCASE		
RETURN .T.


PROCEDURE FATURA

   SELECT orcatmp
   SCATTER MEMVAR MEMO
   IF LEFT(orcatmp.situacao,1) $ 'Dd'  && BAIXA REZERVA E SALDO
      m.operacao = 'SOPS'   && SAIDA/OUTR OPE/PROCESSADA/COM RESERVA
   ELSE
      m.operacao = 'SOPN'   && SAIDA/OUTR OPE/PROCESSADA/SEM RESERVA
   ENDIF
   m.situacao = 'E'+RIGHT(m.situacao,1)
   SELECT orcatmp
   GATHER MEMVAR MEMO
   SELECT itemmov
	m.data = m.datanf
	m.hora = m.horanf
	m.sld_estq = 0
	m.vlr_estq = 0
   =edithand('SAVE')

	DO UPatu_cmd		&& ROTINA DE VERIFICACAO E ATUALIZACAO DO SALDO
						&& VAI DEVOLVER m.sld_atu e
RETURN
**********

PROCEDURE DESFATURA
   SELECT orcatmp
   SCATTER MEMVAR MEMO
   m.situacao = 'C'+RIGHT(m.situacao,1)
   SELECT orcatmp
   GATHER MEMVAR MEMO
   SELECT itemmov
   SET ORDER TO TAG movimento
   m.data = outroper.data
   m.hora = outroper.hora
   SEEK STR(m.empresa,3)+m.codigo+DTOS(m.data)+m.hora+m.tipo+;
				STR(m.orcamento,6)+STR(m.ordem,2)
   IF !FOUND()
		LFflgtrans = .F.
		WAIT WINDOW "O registro de movimento no estoque nao foi encontrado"
		RETURN
	ELSE
		=REGLOCK()
		DELETE
	ENDIF
	DO UPatu_cmd		&& ROTINA DE VERIFICACAO E ATUALIZACAO DO SALDO
						&& VAI DEVOLVER m.sld_atu e
RETURN


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RD90KXX9O           m.orcamento VALID                  
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SCGC208,     Record Number:   24   
*        Variable:            m.orcamento                        
*        Called By:           VALID Clause                       
*        Object Type:         Field                              
*        Snippet Number:      1                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _rd90kxx9o     &&  m.orcamento VALID
#REGION 1
SELE outroper
SET ORDER TO TAG orcamento
IF LASTKEY() = 9
    ON KEY LABEL ESCAPE
	DO loc_dlog WITH .T.,VLcompara, VLchvlimi
    ON KEY LABEL ESCAPE DO BTN_VAL WITH 'DELETE'
	IF LASTKEY() <> 27
		m.orcamento = outroper.orcamento
	ENDIF	
ENDIF	

SEEK STR(WP_EMPRESA,3)+"Q"+STR(m.orcamento,6)

RETURN(UPtratachv())



*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RD90KXXCA           m.data WHEN                        
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SCGC208,     Record Number:   26   
*        Variable:            m.data                             
*        Called By:           WHEN Clause                        
*        Object Type:         Field                              
*        Snippet Number:      2                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _rd90kxxca     &&  m.data WHEN
#REGION 1
IF isadding
   data = DATE()
   hora = TIME()
ENDIF
SHOW GET m.data
SHOW GET m.hora
RETURN .F.


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RD90KXXED           m.centrocust VALID                 
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SCGC208,     Record Number:   28   
*        Variable:            m.centrocust                       
*        Called By:           VALID Clause                       
*        Object Type:         Field                              
*        Snippet Number:      3                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _rd90kxxed     &&  m.centrocust VALID
#REGION 1
SELECT centcust
SET ORDER TO TAG codigo
IF LASTKEY() = 9
   ON KEY LABEL ESCAPE
   DO loc_dlog
   ON KEY LABEL ESCAPE DO BTN_VAL WITH 'DELETE'
   m.centrocust= codigo
   m.centdesc  = descricao
   SHOW GET m.centrocust
   SHOW GET m.centdesc
   SELECT outroper
   RETURN .T.
ENDIF
IF SEEK(m.centrocust)
   m.centrocust= codigo
   m.centdesc  = descricao
   SHOW GET m.centrocust
   SHOW GET m.centdesc
   SELECT outroper
   RETURN .T.
ENDIF
SELECT outroper
RETURN .F.


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RD90KXXHN           m.tipo VALID                       
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SCGC208,     Record Number:   30   
*        Variable:            m.tipo                             
*        Called By:           VALID Clause                       
*        Object Type:         Field                              
*        Snippet Number:      4                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _rd90kxxhn     &&  m.tipo VALID
#REGION 1
SELECT tipooper
SET ORDER TO TAG tipo
IF LASTKEY() = 9
   ON KEY LABEL ESCAPE
   DO loc_dlog WITH .F.,.F., "'s'"
   ON KEY LABEL ESCAPE DO BTN_VAL WITH 'DELETE'
   m.tipo = tipooper.tipo
   m.natureza = tipooper.descnatu
   SHOW GET m.natureza
   SELECT outroper
	IF LASTKEY()  <>  27
		RETURN .T.
	ENDIF
ELSE
	IF SEEK("s"+m.tipo)
	   m.tipo = tipooper.tipo
	   m.natureza = tipooper.descnatu
	   SELECT outroper
	   SHOW GET m.natureza
	   RETURN .T.
	ENDIF
ENDIF
SELECT outroper
RETURN .F.


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RD90KXXL2           m.cliente VALID                    
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SCGC208,     Record Number:   33   
*        Variable:            m.cliente                          
*        Called By:           VALID Clause                       
*        Object Type:         Field                              
*        Snippet Number:      5                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _rd90kxxl2     &&  m.cliente VALID
#REGION 1
		SELECT usuario
		SET ORDER TO TAG usuario
		IF LASTKEY() = 9
		   ON KEY LABEL ESCAPE
		   DO loc_dlog
		   ON KEY LABEL ESCAPE DO BTN_VAL WITH 'DELETE'
		   m.cliente   = usuario
		   m.nome	   = nome
		   SHOW GET m.cliente
		   SHOW GET m.nome
		   SELECT outroper
		   RETURN .T.
		ENDIF
		IF SEEK(m.cliente)
		   m.cliente   = usuario
		   m.nome	   = nome
		   SHOW GET m.cliente
		   SHOW GET m.nome
		   SELECT outroper
		   RETURN .T.
		ENDIF
		SELECT outroper
		RETURN .F.


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RD90KXXPH           m.rm_btn VALID                     
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SCGC208,     Record Number:   41   
*        Variable:            m.rm_btn                           
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      6                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _rd90kxxph     &&  m.rm_btn VALID
#REGION 1
#DEFINE C_RESERVA			'Confirma a Reserva de Mercadoria.'
IF !fox_alert(C_RESERVA)
   RETURN
ENDIF
SELECT outroper
IF !REGLOCK()
	WAIT WINDOW "Documento pode ser bloqueado para processo."
	RETURN
ENDIF
************************************
=UPtransacao("INICIAR")
************************************
SELECT  orcatmp
SET ORDER TO TAG orcamento
LFflgtrans = .t.
SEEK STR(wp_empresa,3)+LEFT(m.tipo,1)+STR(m.orcamento,6)
DO WHILE !eof() AND m.orcamento = orcamento AND wp_empresa = empresa ;
				AND LEFT(m.tipo,1) = LEFT(tipo,1)
   IF orcatmp.movestq = "S" AND LEFT(orcatmp.situacao,1) = 'C' && aprovado
      IF LOCA_SALDO()
         SELECT orcatmp
         IF REGLOCK()
            DO reserva
         ELSE
			LFflgtrans = .F.
			EXIT
         ENDIF
      ELSE
		LFflgtrans = .F.
		EXIT
      ENDIF
      SELECT  orcatmp
   ENDIF
   SKIP
ENDDO

SELECT outroper
IF LFflgtrans
	REPLACE situacao WITH "D"+RIGHT(situacao,1)
	REPLACE dt_res   WITH wp_dtoper
	REPLACE hora_res WITH time()
	************************************
	=UPtransacao("TERMINAR")
	************************************
ELSE
	************************************
	=UPtransacao("ABORTAR")
	************************************
	WAIT WINDOW "Reserva NAO FOI concluida."
ENDIF
UNLOCK ALL
SCATTER MEMVAR MEMO
SHOW GETS
DO refresh
RETURN


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RD90KXXV7           m.cr_btn VALID                     
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SCGC208,     Record Number:   42   
*        Variable:            m.cr_btn                           
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      7                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _rd90kxxv7     &&  m.cr_btn VALID
#REGION 1
#DEFINE C_CRESERVA			'Confirma Cancelamento de Reserva ? '
IF !fox_alert(C_CRESERVA)
   RETURN
ENDIF
SELECT outroper
IF !REGLOCK()
	WAIT WINDOW "Documento pode ser bloqueado para processo."
	RETURN
ENDIF
************************************
=UPtransacao("INICIAR")
************************************
SELECT  orcatmp
SET ORDER TO TAG orcamento
LFflgtrans = .t.
SEEK STR(wp_empresa,3)+LEFT(m.tipo,1)+STR(m.orcamento,6)
DO WHILE !eof() AND m.orcamento = orcamento AND wp_empresa = empresa;
				AND LEFT(m.tipo,1) = LEFT(tipo,1)
   IF orcatmp.movestq = "S" AND LEFT(orcatmp.situacao,1) $ 'Dd' &&possui.res
      IF LOCA_SALDO()
         SELECT orcatmp
         IF REGLOCK()
            DO reserva
         ELSE
			LFflgtrans = .F.
			EXIT
         ENDIF
      ELSE
		LFflgtrans = .F.
		EXIT
      ENDIF
      SELECT  orcatmp
   ENDIF
   SKIP
ENDDO

SELECT outroper
IF LFflgtrans
	REPLACE situacao WITH "C"+RIGHT(situacao,1)
	REPLACE dt_res   WITH CTOD('  .  .  ')
	REPLACE hora_res WITH '        '
	************************************
	=UPtransacao("TERMINAR")
	************************************
ELSE
	************************************
	=UPtransacao("ABORTAR")
	************************************
	WAIT WINDOW "Processo NAO FOI concluido."
ENDIF
UNLOCK ALL
SCATTER MEMVAR MEMO
SHOW GETS
DO refresh
RETURN


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RD90KXY0Q           m.fat_btn VALID                    
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SCGC208,     Record Number:   43   
*        Variable:            m.fat_btn                          
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      8                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _rd90kxy0q     &&  m.fat_btn VALID
#REGION 1
#DEFINE C_FATURA	'Confirma a Processamento e Baixa da Requisicao ?.'

IF !fox_alert(C_FATURA)
   RETURN
ENDIF
SELECT outroper
IF !REGLOCK()
	WAIT WINDOW "Documento pode ser bloqueado para processo."
	RETURN
ENDIF
SELECT  orcatmp
SET ORDER TO TAG orcamento
SEEK STR(wp_empresa,3)+LEFT(m.tipo,1)+STR(m.orcamento,6)
***> ((((( PREVIA )))
LFflgtrans = .t.
DO WHILE !eof() AND m.orcamento = orcamento AND wp_empresa = EMPRESA ;
				AND LEFT(m.tipo,1) = LEFT(tipo,1)
		IF orcatmp.movestq = "S"
		    IF !BAIXA_SALDO() OR !(LEFT(orcatmp.situacao,1) $ "DdC")
				LFflgtrans = .F.
				EXIT
			ENDIF
		ELSE
			IF !(LEFT(orcatmp.situacao,1) $ "DdC")
				LFflgtrans = .F.
				EXIT
			ENDIF
		ENDIF
		SELE orcatmp
		SKIP
ENDDO
IF !LFflgtrans
   WAIT WINDOW "Os itens apresentam irregularidades. Execute <RELINHAR>."
   SELE outroper
   RETURN
ENDIF

*---->  POSICIONA ARQUIVOS RELACIONADOS
SELE empresa
SET ORDER TO TAG empresa
SEEK m.empresa

SELE tipooper
IF m.motivo = 5
	SET ORDER TO TAG tipo
	SEEK 's'+m.tipo         &&  TIPO FOI INFORMADO DIRETAMENTE
ELSE
	SET ORDER TO TAG tpopera
	SEEK 'S'+m.ch_opera+m.ch_produ+m.ch_motiv+;
				m.ch_desti+m.ch_contr+m.ch_condi
ENDIF
IF !FOUND()
   WAIT WINDOW "Nao foi possivel classificar a OPERACAO. PROCURE SUPORTE..."
   SELE outroper
   RETURN
ENDIF
m.datanf		=	wp_dtoper    && REGISTRA A DATA DA baixa estq DA REQ
m.horanf		=	time()		 && REGISTRA A HORA

SELECT  orcatmp
SET ORDER TO TAG orcamento

SEEK STR(wp_empresa,3)+LEFT(m.tipo,1)+STR(m.orcamento,6)
LFflgtrans = .t.
************************************
=UPtransacao("INICIAR")
************************************
DO WHILE !eof() AND m.orcamento = orcamento AND wp_empresa = EMPRESA ;
				AND LEFT(m.tipo,1) = LEFT(tipo,1)
	*------>     REINICIALIZA VALORES ESPECIFICOS POR NOTA
	m.valor    =	0   && utilizado em ULapuravlr
	SELECT  orcatmp
    DO WHILE !eof() AND m.orcamento = orcamento AND wp_empresa = empresa ;
					AND LEFT(m.tipo,1) = LEFT(m.tipo,1)
		IF orcatmp.movestq = "S"
		    IF BAIXA_SALDO()
		    	SELECT orcatmp
				IF REGLOCK()
					DO ULapuravlr
					DO fatura
				ELSE
					LFflgtrans = .F.
					EXIT
				ENDIF
			ELSE
				LFflgtrans = .F.
				EXIT
			ENDIF
			SELECT  orcatmp
		ELSE
	    	SELECT orcatmp
			IF REGLOCK()
				m.situacao = 'E'+RIGHT(m.situacao,1)
				m.dtfat = wp_dtoper
				GATHER MEMVAR MEMO
				DO ULapuravlr
			ELSE
				LFflgtrans = .F.
				EXIT
			ENDIF
		ENDIF
		SKIP
	ENDDO
	IF !LFflgtrans
		EXIT
	ENDIF			
	SELE orcatmp

ENDDO

IF !LFflgtrans   && OPERACAO ABORTADA
	************************************
	=UPtransacao("ABORTAR")
	************************************
	UNLOCK ALL
	SELE outroper
	SCATTER MEMVAR MEMO
	SHOW GETS
	DO refresh
	RETURN
ENDIF			

SELECT outroper
m.situacao =  "E"+RIGHT(m.situacao,1)
m.data = m.datanf
m.hora = m.horanf
GATHER MEMVAR FIELDS situacao, data, hora MEMO
************************************
=UPtransacao("TERMINAR")
************************************
UNLOCK ALL
SCATTER MEMVAR MEMO
SHOW GETS
DO refresh
RETURN


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RD90KXYDC           m.cp_btn VALID                     
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SCGC208,     Record Number:   44   
*        Variable:            m.cp_btn                           
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      9                                  
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*

FUNCTION _rd90kxydc     &&  m.cp_btn VALID
#REGION 1
#DEFINE C_FATURA	'Confirma Cancelamento da Saida ?.'

IF !fox_alert(C_FATURA)
   RETURN
ENDIF
SELECT outroper
IF !REGLOCK()
	WAIT WINDOW "Documento pode ser bloqueado para processo."
	RETURN
ENDIF
SELECT  orcatmp
SET ORDER TO TAG orcamento
SEEK STR(wp_empresa,3)+LEFT(m.tipo,1)+STR(m.orcamento,6)
***> ((((( PREVIA )))
LFflgtrans = .t.
DO WHILE !eof() AND m.orcamento = orcamento AND wp_empresa = EMPRESA ;
				AND LEFT(m.tipo,1) = LEFT(tipo,1)
	    IF !(LEFT(orcatmp.situacao,1) $ "E")
			LFflgtrans = .F.
			EXIT
		ENDIF
		SELE orcatmp
		SKIP
ENDDO
IF !LFflgtrans
   WAIT WINDOW "Os itens apresentam irregularidades. Execute <RELINHAR>."
   SELE outroper
   RETURN
ENDIF

*---->  POSICIONA ARQUIVOS RELACIONADOS
SELE empresa
SET ORDER TO TAG empresa
SEEK m.empresa

SELE tipooper
IF m.motivo = 5
	SET ORDER TO TAG tipo
	SEEK 's'+m.tipo         &&  TIPO FOI INFORMADO DIRETAMENTE
ELSE
	SET ORDER TO TAG tpopera
	SEEK 'S'+m.ch_opera+m.ch_produ+m.ch_motiv+;
				m.ch_desti+m.ch_contr+m.ch_condi
ENDIF
IF !FOUND()
   WAIT WINDOW "Nao foi possivel classificar a OPERACAO. PROCURE SUPORTE..."
   SELE outroper
   RETURN
ENDIF
m.datanf		=	outroper.data
m.horanf		=	outroper.hora

SELECT  orcatmp
SET ORDER TO TAG orcamento

SEEK STR(wp_empresa,3)+LEFT(m.tipo,1)+STR(m.orcamento,6)
LFflgtrans = .t.
************************************
=UPtransacao("INICIAR")
************************************
DO WHILE !eof() AND m.orcamento = orcamento AND wp_empresa = EMPRESA ;
				AND LEFT(m.tipo,1) = LEFT(tipo,1)
	*------>     REINICIALIZA VALORES ESPECIFICOS POR NOTA
	m.valor    =	0   && utilizado em ULapuravlr
	SELECT  orcatmp
    DO WHILE !eof() AND m.orcamento = orcamento AND wp_empresa = empresa ;
					AND LEFT(m.tipo,1) = LEFT(m.tipo,1)
		IF orcatmp.movestq = "S"
	    	SELECT orcatmp
			IF REGLOCK()
				DO desfatura
			ELSE
				LFflgtrans = .F.
				EXIT
			ENDIF
			SELECT  orcatmp
		ELSE
	    	SELECT orcatmp
			IF REGLOCK()
				m.situacao = 'C'+RIGHT(m.situacao,1)
				m.dtfat = m.datanf
				GATHER MEMVAR MEMO
			ELSE
				LFflgtrans = .F.
				EXIT
			ENDIF
		ENDIF
		SKIP
	ENDDO
	IF !LFflgtrans
		EXIT
	ENDIF			
	SELE orcatmp
ENDDO

IF !LFflgtrans   && OPERACAO ABORTADA
	************************************
	=UPtransacao("ABORTAR")
	************************************
	UNLOCK ALL
	SELE outroper
	SCATTER MEMVAR MEMO
	SHOW GETS
	DO refresh
	RETURN
ENDIF			

SELECT outroper
m.situacao =  "C"+RIGHT(m.situacao,1)
m.data = m.datanf
m.hora = m.horanf
GATHER MEMVAR FIELDS situacao, data, hora MEMO
************************************
=UPtransacao("TERMINAR")
************************************
UNLOCK ALL
SCATTER MEMVAR MEMO
SHOW GETS
DO refresh
RETURN


*       靈컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*                                                                
*        _RD90KXYOD           m.com_btn VALID                    
*                                                                
*        Function Origin:                                        
*                                                                
*        From Platform:       MS-DOS                             
*        From Screen:         SCGC208,     Record Number:   45   
*        Variable:            m.com_btn                          
*        Called By:           VALID Clause                       
*        Object Type:         Push Button                        
*        Snippet Number:      10                                 
*                                                                
*       聃컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴컴
*
FUNCTION _rd90kxyod     &&  m.com_btn VALID
#REGION 1
WP_RECORD = RECNO()
DO obj_come.spr
GO WP_RECORD

SCATTER MEMVAR MEMO

SHOW GETS
DO refresh
RETURN

			
